(self.webpackChunkdemo_showcase=self.webpackChunkdemo_showcase||[]).push([[792],{273:(ga,an,ln)=>{"use strict";var Wr={};ln.r(Wr),ln.d(Wr,{atomicHet:()=>Hje,atomicSequence:()=>zje,bundleElementImpl:()=>aae,bundleGenerator:()=>lae,defaultBondTest:()=>Sz,spheres:()=>Gje,water:()=>Vje});var Ms={};ln.r(Ms),ln.d(Ms,{all:()=>uae,atoms:()=>Iz,bondedAtomicPairs:()=>eUe,chains:()=>$je,none:()=>Az,querySelection:()=>Jje,residues:()=>Wje,rings:()=>Qje});var Ki={};ln.r(Ki),ln.d(Ki,{exceptBy:()=>O7e,expandProperty:()=>L7e,includeConnected:()=>j7e,includeSurroundings:()=>R7e,intersectBy:()=>F7e,querySelection:()=>N7e,surroundingLigands:()=>z7e,union:()=>B7e,wholeResidues:()=>P7e});var At={};ln.r(At),ln.d(At,{areIntersectedBy:()=>J7e,first:()=>K7e,getCurrentStructureProperties:()=>E5,isConnectedTo:()=>oVe,pick:()=>X7e,withSameAtomProperties:()=>Q7e,within:()=>eVe});var Ma={};ln.r(Ma),ln.d(Ma,{intersect:()=>aVe,merge:()=>sVe});var rs={};ln.r(rs),ln.d(rs,{atomCount:()=>lVe,countQuery:()=>cVe,propertySet:()=>uVe});var Ci={};ln.r(Ci),ln.d(Ci,{Download:()=>Pue,DownloadBlob:()=>kue,ImportJson:()=>nWe,ImportString:()=>tWe,LazyVolume:()=>iWe,ParseBlob:()=>qqe,ParseCcp4:()=>Qqe,ParseCif:()=>Wqe,ParseCube:()=>$qe,ParseDsn6:()=>Jqe,ParseDx:()=>eWe,ParseJson:()=>rWe,ParsePly:()=>Zqe,ParsePrmtop:()=>Xqe,ParsePsf:()=>Yqe,ParseTop:()=>Kqe,RawData:()=>Mue,ReadFile:()=>Rue});var rr={};ln.r(rr),ln.d(rr,{CreateGroup:()=>oWe});var or={};ln.r(or),ln.d(or,{CoordinatesFromDcd:()=>Wtt,CoordinatesFromNctraj:()=>Xtt,CoordinatesFromTrr:()=>Ytt,CoordinatesFromXtc:()=>$tt,CustomModelProperties:()=>xpe,CustomStructureProperties:()=>Spe,ModelFromTrajectory:()=>mpe,MultiStructureSelectionFromExpression:()=>gnt,ShapeFromPly:()=>Snt,StructureComplexElement:()=>xnt,StructureComplexElementTypes:()=>vpe,StructureComponent:()=>_nt,StructureFromModel:()=>pnt,StructureFromTrajectory:()=>fnt,StructureSelectionFromBundle:()=>bnt,StructureSelectionFromExpression:()=>mnt,StructureSelectionFromScript:()=>ynt,TopologyFromPrmtop:()=>Ztt,TopologyFromPsf:()=>Ktt,TopologyFromTop:()=>Qtt,TrajectoryFromBlob:()=>ent,TrajectoryFromCifCore:()=>cnt,TrajectoryFromCube:()=>lnt,TrajectoryFromGRO:()=>rnt,TrajectoryFromMOL:()=>ont,TrajectoryFromMOL2:()=>ant,TrajectoryFromMmCif:()=>tnt,TrajectoryFromModelAndCoordinates:()=>JH,TrajectoryFromPDB:()=>nnt,TrajectoryFromSDF:()=>snt,TrajectoryFromXYZ:()=>int,TransformStructureConformation:()=>hnt});var kr={};ln.r(kr),ln.d(kr,{AssignColorVolume:()=>Fnt,VolumeFromCcp4:()=>Dnt,VolumeFromCube:()=>knt,VolumeFromDensityServerCif:()=>Rnt,VolumeFromDsn6:()=>Pnt,VolumeFromDx:()=>Mnt,VolumeFromSegmentationCif:()=>Nnt});var lr={};ln.r(lr),ln.d(lr,{BoxShape3D:()=>sat,getBoxMesh:()=>LG});var Rs={};ln.r(Rs),ln.d(Rs,{ClippingStructureRepresentation3DFromBundle:()=>wat,ClippingStructureRepresentation3DFromScript:()=>Cat,ExplodeStructureRepresentation3D:()=>mat,ModelUnitcell3D:()=>Tat,OverpaintStructureRepresentation3DFromBundle:()=>bat,OverpaintStructureRepresentation3DFromScript:()=>yat,ShapeRepresentation3D:()=>Eat,SpinStructureRepresentation3D:()=>gat,StructureBoundingBox3D:()=>Dat,StructureRepresentation3D:()=>hF,StructureSelectionsAngle3D:()=>kat,StructureSelectionsDihedral3D:()=>Mat,StructureSelectionsDistance3D:()=>Pat,StructureSelectionsLabel3D:()=>Rat,StructureSelectionsOrientation3D:()=>Nat,StructureSelectionsPlane3D:()=>Fat,SubstanceStructureRepresentation3DFromBundle:()=>Sat,SubstanceStructureRepresentation3DFromScript:()=>_at,ThemeStrengthRepresentation3D:()=>Aat,TransparencyStructureRepresentation3DFromBundle:()=>xat,TransparencyStructureRepresentation3DFromScript:()=>vat,UnwindStructureAssemblyRepresentation3D:()=>hat,VolumeRepresentation3D:()=>Iat,VolumeRepresentation3DHelpers:()=>Eg});var zo={};ln.r(zo),ln.d(zo,{ApplyAction:()=>Oge,ClearHighlights:()=>zge,Highlight:()=>Uge,RemoveObject:()=>Bge,SetCurrentObject:()=>Nge,Snapshots:()=>Vge,SyncBehaviors:()=>Rge,ToggleExpanded:()=>Lge,ToggleVisibility:()=>jge,Update:()=>Fge,registerDefault:()=>Vct,setSubtreeVisibility:()=>G_});var xr={};ln.r(xr),ln.d(xr,{SyncRepresentationToCanvas:()=>Hge,SyncStructureRepresentation3DState:()=>Gge,UpdateRepresentationVisibility:()=>qge,registerDefault:()=>Gct});var ea={};ln.r(ea),ln.d(ea,{Focus:()=>Yge,OrientAxes:()=>Xge,Reset:()=>Wge,ResetAxes:()=>Kge,SetSnapshot:()=>$ge,registerDefault:()=>qct});var ta={};ln.r(ta),ln.d(ta,{Canvas3DSetSettings:()=>G0e,registerDefault:()=>Xft});var vi={};ln.r(vi),ln.d(vi,{DefaultFocusLociBindings:()=>$0e,DefaultLociLabelProvider:()=>ept,DefaultSelectLociBindings:()=>q0e,FocusLoci:()=>OF,HighlightLoci:()=>Qft,SelectLoci:()=>W0e});var to={};ln.r(to),ln.d(to,{CameraAxisHelper:()=>ipt,CameraControls:()=>spt,DefaultClickResetCameraOnEmpty:()=>Vq,DefaultClickResetCameraOnEmptySelectMode:()=>Hq,DefaultFocusLociBindings:()=>Y0e,FocusLoci:()=>rpt});var Ul={};ln.r(Ul),ln.d(Ul,{AccessibleSurfaceArea:()=>gpt,BestDatabaseSequenceMapping:()=>Dgt,CrossLinkRestraint:()=>qgt,Interactions:()=>wgt,SecondaryStructure:()=>Agt,StructureInfo:()=>apt,ValenceModel:()=>Igt});var Cc={};ln.r(Cc),ln.d(Cc,{AddTrajectory:()=>D0t,DownloadStructure:()=>C0t,EnableModelCustomProps:()=>E0t,EnableStructureCustomProps:()=>T0t,LoadTrajectory:()=>P0t,PdbDownloadProvider:()=>Sbe,UpdateTrajectory:()=>sO});var wc={};ln.r(wc),ln.d(wc,{AssignColorVolume:()=>Cbe,DownloadDensity:()=>k0t});var Ss={};ln.r(Ss),ln.d(Ss,{DownloadFile:()=>M0t,OpenFiles:()=>NW});var Cs={};ln.r(Cs),ln.d(Cs,{boolean:()=>di,booleanish:()=>wl,commaOrSpaceSeparated:()=>Lf,commaSeparated:()=>xI,number:()=>en,overloadedBoolean:()=>Jxe,spaceSeparated:()=>xs});var Al={};function Ac(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(c){return void n(c)}a.done?t(l):Promise.resolve(l).then(r,i)}function le(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(l){Ac(o,r,i,s,a,"next",l)}function a(l){Ac(o,r,i,s,a,"throw",l)}s(void 0)})}}ln.r(Al),ln.d(Al,{attentionMarkers:()=>yIt,contentInitial:()=>dIt,disable:()=>bIt,document:()=>uIt,flow:()=>pIt,flowInitial:()=>fIt,insideSpan:()=>gIt,string:()=>hIt,text:()=>mIt});let Zi=null,fr=1;const no=Symbol("SIGNAL");function hr(e){const t=Zi;return Zi=e,t}function fi(e){if((!xm(e)||e.dirty)&&(e.dirty||e.lastCleanEpoch!==fr)){if(!e.producerMustRecompute(e)&&!Ic(e))return e.dirty=!1,void(e.lastCleanEpoch=fr);e.producerRecomputeValue(e),e.dirty=!1,e.lastCleanEpoch=fr}}function Ic(e){Jg(e);for(let t=0;t<e.producerNode.length;t++){const n=e.producerNode[t],r=e.producerLastReadVersion[t];if(r!==n.version||(fi(n),r!==n.version))return!0}return!1}function G2(e,t){if(function Iv(e){e.liveConsumerNode??=[],e.liveConsumerIndexOfThis??=[]}(e),Jg(e),1===e.liveConsumerNode.length)for(let r=0;r<e.producerNode.length;r++)G2(e.producerNode[r],e.producerIndexOfThis[r]);const n=e.liveConsumerNode.length-1;if(e.liveConsumerNode[t]=e.liveConsumerNode[n],e.liveConsumerIndexOfThis[t]=e.liveConsumerIndexOfThis[n],e.liveConsumerNode.length--,e.liveConsumerIndexOfThis.length--,t<e.liveConsumerNode.length){const r=e.liveConsumerIndexOfThis[t],i=e.liveConsumerNode[t];Jg(i),i.producerIndexOfThis[r]=t}}function xm(e){return e.consumerIsAlwaysLive||(e?.liveConsumerNode?.length??0)>0}function Jg(e){e.producerNode??=[],e.producerIndexOfThis??=[],e.producerLastReadVersion??=[]}let hb=null;function Yo(e){return"function"==typeof e}function Tv(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const Dv=Tv(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function mb(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Il{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const o of n)o.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(Yo(r))try{r()}catch(o){t=o instanceof Dv?o.errors:[o]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const o of i)try{n0(o)}catch(s){t=t??[],s instanceof Dv?t=[...t,...s.errors]:t.push(s)}}if(t)throw new Dv(t)}}add(t){var n;if(t&&t!==this)if(this.closed)n0(t);else{if(t instanceof Il){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&mb(n,t)}remove(t){const{_finalizers:n}=this;n&&mb(n,t),t instanceof Il&&t._removeParent(this)}}Il.EMPTY=(()=>{const e=new Il;return e.closed=!0,e})();const $2=Il.EMPTY;function t0(e){return e instanceof Il||e&&"closed"in e&&Yo(e.remove)&&Yo(e.add)&&Yo(e.unsubscribe)}function n0(e){Yo(e)?e():e.unsubscribe()}const _m={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Pv={setTimeout(e,t,...n){const{delegate:r}=Pv;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Pv;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function qI(e){Pv.setTimeout(()=>{const{onUnhandledError:t}=_m;if(!t)throw e;t(e)})}function kv(){}const Ek=r0("C",void 0,void 0);function r0(e,t,n){return{kind:e,value:t,error:n}}let oh=null;function Sm(e){if(_m.useDeprecatedSynchronousErrorHandling){const t=!oh;if(t&&(oh={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=oh;if(oh=null,n)throw r}}else e()}class o0 extends Il{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,t0(t)&&t.add(this)):this.destination=Dk}static create(t,n,r){return new Mv(t,n,r)}next(t){this.isStopped?sh(function Tk(e){return r0("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?sh(function WI(e){return r0("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?sh(Ek,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Y2=Function.prototype.bind;function gb(e,t){return Y2.call(e,t)}class $I{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){X2(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){X2(r)}else X2(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){X2(n)}}}class Mv extends o0{constructor(t,n,r){let i;if(super(),Yo(t)||!t)i={next:t??void 0,error:n??void 0,complete:r??void 0};else{let o;this&&_m.useDeprecatedNextContext?(o=Object.create(t),o.unsubscribe=()=>this.unsubscribe(),i={next:t.next&&gb(t.next,o),error:t.error&&gb(t.error,o),complete:t.complete&&gb(t.complete,o)}):i=t}this.destination=new $I(i)}}function X2(e){_m.useDeprecatedSynchronousErrorHandling?function aL(e){_m.useDeprecatedSynchronousErrorHandling&&oh&&(oh.errorThrown=!0,oh.error=e)}(e):qI(e)}function sh(e,t){const{onStoppedNotification:n}=_m;n&&Pv.setTimeout(()=>n(e,t))}const Dk={closed:!0,next:kv,error:function lL(e){throw e},complete:kv},K2="function"==typeof Symbol&&Symbol.observable||"@@observable";function ah(e){return e}function YI(...e){return XI(e)}function XI(e){return 0===e.length?ah:1===e.length?e[0]:function(n){return e.reduce((r,i)=>i(r),n)}}let Ra=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,i){const o=function uL(e){return e&&e instanceof o0||function cL(e){return e&&Yo(e.next)&&Yo(e.error)&&Yo(e.complete)}(e)&&t0(e)}(n)?n:new Mv(n,r,i);return Sm(()=>{const{operator:s,source:a}=this;o.add(s?s.call(o,a):a?this._subscribe(o):this._trySubscribe(o))}),o}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=KI(r))((i,o)=>{const s=new Mv({next:a=>{try{n(a)}catch(l){o(l),s.unsubscribe()}},error:o,complete:i});this.subscribe(s)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[K2](){return this}pipe(...n){return XI(n)(this)}toPromise(n){return new(n=KI(n))((r,i)=>{let o;this.subscribe(s=>o=s,s=>i(s),()=>r(o))})}}return e.create=t=>new e(t),e})();function KI(e){var t;return null!==(t=e??_m.Promise)&&void 0!==t?t:Promise}const na=Tv(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let si=(()=>{class e extends Ra{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new Z2(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new na}next(n){Sm(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){Sm(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){Sm(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:i,observers:o}=this;return r||i?$2:(this.currentObservers=null,o.push(n),new Il(()=>{this.currentObservers=null,mb(o,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:i,isStopped:o}=this;r?n.error(i):o&&n.complete()}asObservable(){const n=new Ra;return n.source=this,n}}return e.create=(t,n)=>new Z2(t,n),e})();class Z2 extends si{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:$2}}class Ao extends si{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}function Rv(e){return Yo(e?.lift)}function is(e){return t=>{if(Rv(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Xo(e,t,n,r,i){return new Q2(e,t,n,r,i)}class Q2 extends o0{constructor(t,n,r,i,o,s){super(t),this.onFinalize=o,this.shouldUnsubscribe=s,this._next=n?function(a){try{n(a)}catch(l){t.error(l)}}:super._next,this._error=i?function(a){try{i(a)}catch(l){t.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){t.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function hn(e,t){return is((n,r)=>{let i=0;n.subscribe(Xo(r,o=>{r.next(e.call(t,o,i++))}))})}const ad="https://g.co/ng/security#xss";class Xt extends Error{constructor(t,n){super(function yb(e,t){return`NG0${Math.abs(e)}${t?": "+t:""}`}(t,n)),this.code=t}}function lh(e){return{toString:e}.toString()}const Cm="__parameters__";function vb(e,t,n){return lh(()=>{const r=function a0(e){return function(...n){if(e){const r=e(...n);for(const i in r)this[i]=r[i]}}}(t);function i(...o){if(this instanceof i)return r.apply(this,o),this;const s=new i(...o);return a.annotation=s,a;function a(l,c,u){const d=l.hasOwnProperty(Cm)?l[Cm]:Object.defineProperty(l,Cm,{value:[]})[Cm];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i})}const Gn=globalThis;function Qi(e){for(let t in e)if(e[t]===Qi)return t;throw Error("Could not find renamed property on target object.")}function ya(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(ya).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function nS(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const rS=Qi({__forward_ref__:Qi});function Vf(e){return e.__forward_ref__=Vf,e.toString=function(){return ya(this())},e}function Zn(e){return qd(e)?e():e}function qd(e){return"function"==typeof e&&e.hasOwnProperty(rS)&&e.__forward_ref__===Vf}function gn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function c0(e){return{providers:e.providers||[],imports:e.imports||[]}}function u0(e){return Bv(e,zl)||Bv(e,lS)}function Bv(e,t){return e.hasOwnProperty(t)?e[t]:null}function Lv(e){return e&&(e.hasOwnProperty(Am)||e.hasOwnProperty(jv))?e[Am]:null}const zl=Qi({\u0275prov:Qi}),Am=Qi({\u0275inj:Qi}),lS=Qi({ngInjectableDef:Qi}),jv=Qi({ngInjectorDef:Qi});class jn{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=gn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function tE(e){return e&&!!e.\u0275providers}const Vv=Qi({\u0275cmp:Qi}),nE=Qi({\u0275dir:Qi}),rE=Qi({\u0275pipe:Qi}),iE=Qi({\u0275mod:Qi}),uh=Qi({\u0275fac:Qi}),Hv=Qi({__NG_ELEMENT_ID__:Qi}),jk=Qi({__NG_ENV_ID__:Qi});function Tr(e){return"string"==typeof e?e:null==e?"":String(e)}function oE(e,t){throw new Xt(-201,!1)}var gi=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}(gi||{});let sE;function Uk(){return sE}function Uc(e){const t=sE;return sE=e,t}function zk(e,t,n){const r=u0(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&gi.Optional?null:void 0!==t?t:void oE()}const Gv={},uS="__NG_DI_FLAG__",qv="ngTempTokenPath",Gk=/\n/gm,d0="__source";let Sb;function Im(e){const t=Sb;return Sb=e,t}function Wk(e,t=gi.Default){if(void 0===Sb)throw new Xt(-203,!1);return null===Sb?zk(e,void 0,t):Sb.get(e,t&gi.Optional?null:void 0,t)}function Rn(e,t=gi.Default){return(Uk()||Wk)(Zn(e),t)}function qt(e,t=gi.Default){return Rn(e,dS(t))}function dS(e){return typeof e>"u"||"number"==typeof e?e:(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function wb(e){const t=[];for(let n=0;n<e.length;n++){const r=Zn(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Xt(900,!1);let i,o=gi.Default;for(let s=0;s<r.length;s++){const a=r[s],l=$k(a);"number"==typeof l?-1===l?i=a.token:o|=l:i=a}t.push(Rn(i,o))}else t.push(Rn(r))}return t}function Wv(e,t){return e[uS]=t,e.prototype[uS]=t,e}function $k(e){return e[uS]}const $v=Wv(vb("Optional"),8),fS=Wv(vb("SkipSelf"),4);function f0(e,t){return e.hasOwnProperty(uh)?e[uh]:null}function Vl(e,t){e.forEach(n=>Array.isArray(n)?Vl(n,t):t(n))}function Ab(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Yv(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function xu(e,t,n){let r=Tm(e,t);return r>=0?e[1|r]=n:(r=~r,function hS(e,t,n,r){let i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(e,r,t,n)),r}function Em(e,t){const n=Tm(e,t);if(n>=0)return e[1|n]}function Tm(e,t){return function gS(e,t,n){let r=0,i=e.length>>n;for(;i!==r;){const o=r+(i-r>>1),s=e[o<<n];if(t===s)return o<<n;s>t?i=o:r=o+1}return~(i<<n)}(e,t,1)}const Wd={},xi=[],ld=new jn(""),yS=new jn("",-1),bS=new jn("");class p0{get(t,n=Gv){if(n===Gv){const r=new Error(`NullInjectorError: No provider for ${ya(t)}!`);throw r.name="NullInjectorError",r}return n}}var Kv=function(e){return e[e.OnPush=0]="OnPush",e[e.Default=1]="Default",e}(Kv||{}),cd=function(e){return e[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",e}(cd||{}),ud=function(e){return e[e.None=0]="None",e[e.SignalBased=1]="SignalBased",e[e.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",e}(ud||{});function Kk(e,t,n){let r=e.length;for(;;){const i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){const o=t.length;if(i+o===r||e.charCodeAt(i+o)<=32)return i}n=i+1}}function vS(e,t,n){let r=0;for(;r<n.length;){const i=n[r];if("number"==typeof i){if(0!==i)break;r++;const o=n[r++],s=n[r++],a=n[r++];e.setAttribute(t,s,a,o)}else{const o=i,s=n[++r];dh(o)?e.setProperty(t,o,s):e.setAttribute(t,o,s),r++}}return r}function cE(e){return 3===e||4===e||6===e}function dh(e){return 64===e.charCodeAt(0)}function h0(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const i=t[r];"number"==typeof i?n=i:0===n||xS(e,n,i,null,-1===n||2===n?t[++r]:null)}}return e}function xS(e,t,n,r,i){let o=0,s=e.length;if(-1===t)s=-1;else for(;o<e.length;){const a=e[o++];if("number"==typeof a){if(a===t){s=-1;break}if(a>t){s=o-1;break}}}for(;o<e.length;){const a=e[o];if("number"==typeof a)break;if(a===n){if(null===r)return void(null!==i&&(e[o+1]=i));if(r===e[o+1])return void(e[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(e.splice(s,0,t),o=s+1),e.splice(o++,0,n),null!==r&&e.splice(o++,0,r),null!==i&&e.splice(o++,0,i)}const Zk="ng-template";function SL(e,t,n,r){let i=0;if(r){for(;i<t.length&&"string"==typeof t[i];i+=2)if("class"===t[i]&&-1!==Kk(t[i+1].toLowerCase(),n,0))return!0}else if(m0(e))return!1;if(i=t.indexOf(1,i),i>-1){let o;for(;++i<t.length&&"string"==typeof(o=t[i]);)if(o.toLowerCase()===n)return!0}return!1}function m0(e){return 4===e.type&&e.value!==Zk}function CL(e,t,n){return t===(4!==e.type||n?e.value:Zk)}function Qk(e,t,n){let r=4;const i=e.attrs,o=null!==i?function Zv(e){for(let t=0;t<e.length;t++)if(cE(e[t]))return t;return e.length}(i):0;let s=!1;for(let a=0;a<t.length;a++){const l=t[a];if("number"!=typeof l){if(!s)if(4&r){if(r=2|1&r,""!==l&&!CL(e,l,n)||""===l&&1===t.length){if(dd(r))return!1;s=!0}}else if(8&r){if(null===i||!SL(e,i,l,n)){if(dd(r))return!1;s=!0}}else{const c=t[++a],u=Ko(l,i,m0(e),n);if(-1===u){if(dd(r))return!1;s=!0;continue}if(""!==c){let d;if(d=u>o?"":i[u+1].toLowerCase(),2&r&&c!==d){if(dd(r))return!1;s=!0}}}}else{if(!s&&!dd(r)&&!dd(l))return!1;if(s&&dd(l))continue;s=!1,r=l|1&r}}return dd(r)||s}function dd(e){return!(1&e)}function Ko(e,t,n,r){if(null===t)return-1;let i=0;if(r||!n){let o=!1;for(;i<t.length;){const s=t[i];if(s===e)return i;if(3===s||6===s)o=!0;else{if(1===s||2===s){let a=t[++i];for(;"string"==typeof a;)a=t[++i];continue}if(4===s)break;if(0===s){i+=4;continue}}i+=o?1:2}return-1}return function Jk(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function _S(e,t,n=!1){for(let r=0;r<t.length;r++)if(Qk(e,t[r],n))return!0;return!1}function Ib(e,t){return e?":not("+t.trim()+")":t}function CS(e){let t=e[0],n=1,r=2,i="",o=!1;for(;n<e.length;){let s=e[n];if("string"==typeof s)if(2&r){const a=e[++n];i+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""!==i&&!dd(s)&&(t+=Ib(o,i),i=""),r=s,o=o||!dd(r);n++}return""!==i&&(t+=Ib(o,i)),t}function $d(e){return lh(()=>{const t=nM(e),n={...t,decls:e.decls,vars:e.vars,template:e.template,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,onPush:e.changeDetection===Kv.OnPush,directiveDefs:null,pipeDefs:null,dependencies:t.standalone&&e.dependencies||null,getStandaloneInjector:null,signals:e.signals??!1,data:e.data||{},encapsulation:e.encapsulation||cd.Emulated,styles:e.styles||xi,_:null,schemas:e.schemas||null,tView:null,id:""};wS(n);const r=e.dependencies;return n.directiveDefs=Yd(r,!1),n.pipeDefs=Yd(r,!0),n.id=function Tb(e){let t=0;const n=[e.selectors,e.ngContentSelectors,e.hostVars,e.hostAttrs,e.consts,e.vars,e.decls,e.encapsulation,e.standalone,e.signals,e.exportAs,JSON.stringify(e.inputs),JSON.stringify(e.outputs),Object.getOwnPropertyNames(e.type.prototype),!!e.contentQueries,!!e.viewQuery].join("|");for(const i of n)t=Math.imul(31,t)+i.charCodeAt(0)|0;return t+=2147483648,"c"+t}(n),n})}function wL(e){return Yr(e)||ra(e)}function tM(e){return null!==e}function g0(e){return lh(()=>({type:e.type,bootstrap:e.bootstrap||xi,declarations:e.declarations||xi,imports:e.imports||xi,exports:e.exports||xi,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function Qv(e,t){if(null==e)return Wd;const n={};for(const r in e)if(e.hasOwnProperty(r)){const i=e[r];let o,s,a=ud.None;Array.isArray(i)?(a=i[0],o=i[1],s=i[2]??o):(o=i,s=i),t?(n[o]=a!==ud.None?[r,a]:r,t[o]=s):n[o]=r}return n}function Ja(e){return lh(()=>{const t=nM(e);return wS(t),t})}function Hl(e){return{type:e.type,name:e.name,factory:null,pure:!1!==e.pure,standalone:!0===e.standalone,onDestroy:e.type.prototype.ngOnDestroy||null}}function Yr(e){return e[Vv]||null}function ra(e){return e[nE]||null}function Tl(e){return e[rE]||null}function Gl(e,t){const n=e[iE]||null;if(!n&&!0===t)throw new Error(`Type ${ya(e)} does not have '\u0275mod' property.`);return n}function nM(e){const t={};return{type:e.type,providersResolver:null,factory:null,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:t,inputTransforms:null,inputConfig:e.inputs||Wd,exportAs:e.exportAs||null,standalone:!0===e.standalone,signals:!0===e.signals,selectors:e.selectors||xi,viewQuery:e.viewQuery||null,features:e.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Qv(e.inputs,t),outputs:Qv(e.outputs),debugInfo:null}}function wS(e){e.features?.forEach(t=>t(e))}function Yd(e,t){if(!e)return null;const n=t?Tl:wL;return()=>("function"==typeof e?e():e).map(r=>n(r)).filter(tM)}function Vc(e){return{\u0275providers:e}}function Jv(...e){return{\u0275providers:Xd(0,e),\u0275fromNgModule:!0}}function Xd(e,...t){const n=[],r=new Set;let i;const o=s=>{n.push(s)};return Vl(t,s=>{const a=s;IS(a,o,[],r)&&(i||=[],i.push(a))}),void 0!==i&&AS(i,o),n}function AS(e,t){for(let n=0;n<e.length;n++){const{ngModule:r,providers:i}=e[n];ph(i,o=>{t(o,r)})}}function IS(e,t,n,r){if(!(e=Zn(e)))return!1;let i=null,o=Lv(e);const s=!o&&Yr(e);if(o||s){if(s&&!s.standalone)return!1;i=e}else{const l=e.ngModule;if(o=Lv(l),!o)return!1;i=l}const a=r.has(i);if(s){if(a)return!1;if(r.add(i),s.dependencies){const l="function"==typeof s.dependencies?s.dependencies():s.dependencies;for(const c of l)IS(c,t,n,r)}}else{if(!o)return!1;{if(null!=o.imports&&!a){let c;r.add(i);try{Vl(o.imports,u=>{IS(u,t,n,r)&&(c||=[],c.push(u))})}finally{}void 0!==c&&AS(c,t)}if(!a){const c=f0(i)||(()=>new i);t({provide:i,useFactory:c,deps:xi},i),t({provide:bS,useValue:i,multi:!0},i),t({provide:ld,useValue:()=>Rn(i),multi:!0},i)}const l=o.providers;if(null!=l&&!a){const c=e;ph(l,u=>{t(u,c)})}}}return i!==e&&void 0!==e.providers}function ph(e,t){for(let n of e)tE(n)&&(n=n.\u0275providers),Array.isArray(n)?ph(n,t):t(n)}const ex=Qi({provide:String,useValue:Qi});function Dm(e){return null!==e&&"object"==typeof e&&ex in e}function fd(e){return"function"==typeof e}const No=new jn(""),ho={},km={};let el;function Dl(){return void 0===el&&(el=new p0),el}class Na{}class Kd extends Na{get destroyed(){return this._destroyed}constructor(t,n,r,i){super(),this.parent=n,this.source=r,this.scopes=i,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,nx(t,s=>this.processProvider(s)),this.records.set(yS,hh(void 0,this)),i.has("environment")&&this.records.set(Na,hh(void 0,this));const o=this.records.get(No);null!=o&&"string"==typeof o.value&&this.scopes.add(o.value),this.injectorDefTypes=new Set(this.get(bS,xi,gi.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;const t=hr(null);try{for(const r of this._ngOnDestroyHooks)r.ngOnDestroy();const n=this._onDestroyHooks;this._onDestroyHooks=[];for(const r of n)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),hr(t)}}onDestroy(t){return this.assertNotDestroyed(),this._onDestroyHooks.push(t),()=>this.removeOnDestroy(t)}runInContext(t){this.assertNotDestroyed();const n=Im(this),r=Uc(void 0);try{return t()}finally{Im(n),Uc(r)}}get(t,n=Gv,r=gi.Default){if(this.assertNotDestroyed(),t.hasOwnProperty(jk))return t[jk](this);r=dS(r);const o=Im(this),s=Uc(void 0);try{if(!(r&gi.SkipSelf)){let l=this.records.get(t);if(void 0===l){const c=function DS(e){return"function"==typeof e||"object"==typeof e&&e instanceof jn}(t)&&u0(t);l=c&&this.injectableDefInScope(c)?hh(ql(t),ho):null,this.records.set(t,l)}if(null!=l)return this.hydrate(t,l)}return(r&gi.Self?Dl():this.parent).get(t,n=r&gi.Optional&&n===Gv?null:n)}catch(a){if("NullInjectorError"===a.name){if((a[qv]=a[qv]||[]).unshift(ya(t)),o)throw a;return function aE(e,t,n,r){const i=e[qv];throw t[d0]&&i.unshift(t[d0]),e.message=function lE(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let i=ya(t);if(Array.isArray(t))i=t.map(ya).join(" -> ");else if("object"==typeof t){let o=[];for(let s in t)if(t.hasOwnProperty(s)){let a=t[s];o.push(s+":"+("string"==typeof a?JSON.stringify(a):ya(a)))}i=`{${o.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${e.replace(Gk,"\n  ")}`}("\n"+e.message,i,n,r),e.ngTokenPath=i,e[qv]=null,e}(a,t,"R3InjectorError",this.source)}throw a}finally{Uc(s),Im(o)}}resolveInjectorInitializers(){const t=hr(null),n=Im(this),r=Uc(void 0);try{const o=this.get(ld,xi,gi.Self);for(const s of o)s()}finally{Im(n),Uc(r),hr(t)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(ya(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Xt(205,!1)}processProvider(t){let n=fd(t=Zn(t))?t:Zn(t&&t.provide);const r=function iM(e){return Dm(e)?hh(void 0,e.useValue):hh(dE(e),ho)}(t);if(!fd(t)&&!0===t.multi){let i=this.records.get(n);i||(i=hh(void 0,ho,!0),i.factory=()=>wb(i.multi),this.records.set(n,i)),n=t,i.multi.push(t)}this.records.set(n,r)}hydrate(t,n){const r=hr(null);try{return n.value===ho&&(n.value=km,n.value=n.factory()),"object"==typeof n.value&&n.value&&function mh(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}finally{hr(r)}}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Zn(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}removeOnDestroy(t){const n=this._onDestroyHooks.indexOf(t);-1!==n&&this._onDestroyHooks.splice(n,1)}}function ql(e){const t=u0(e),n=null!==t?t.factory:f0(e);if(null!==n)return n;if(e instanceof jn)throw new Xt(204,!1);if(e instanceof Function)return function TS(e){if(e.length>0)throw new Xt(204,!1);const n=function aS(e){return e&&(e[zl]||e[lS])||null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Xt(204,!1)}function dE(e,t,n){let r;if(fd(e)){const i=Zn(e);return f0(i)||ql(i)}if(Dm(e))r=()=>Zn(e.useValue);else if(function ES(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...wb(e.deps||[]));else if(function tx(e){return!(!e||!e.useExisting)}(e))r=()=>Rn(Zn(e.useExisting));else{const i=Zn(e&&(e.useClass||e.provide));if(!function oM(e){return!!e.deps}(e))return f0(i)||ql(i);r=()=>new i(...wb(e.deps))}return r}function hh(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function nx(e,t){for(const n of e)Array.isArray(n)?nx(n,t):n&&tE(n)?nx(n.\u0275providers,t):t(n)}function Hf(e,t){e instanceof Kd&&e.assertNotDestroyed();const r=Im(e),i=Uc(void 0);try{return t()}finally{Im(r),Uc(i)}}function sM(){return void 0!==Uk()||null!=function bL(){return Sb}()}const wr=0,Ht=1,Wn=2,Fs=3,Su=4,tl=5,Hc=6,bh=7,Fo=8,Os=9,Cu=10,_r=11,Tc=12,rx=13,vh=14,Io=15,b0=16,Mm=17,ef=18,v0=19,x0=20,Fa=21,Gf=22,xh=23,Ar=25,tf=1,md=7,Gc=9,Eo=10;var Pb=function(e){return e[e.None=0]="None",e[e.HasTransplantedViews=2]="HasTransplantedViews",e}(Pb||{});function Pl(e){return Array.isArray(e)&&"object"==typeof e[tf]}function Oa(e){return Array.isArray(e)&&!0===e[tf]}function kS(e){return!!(4&e.flags)}function Rm(e){return e.componentOffset>-1}function kb(e){return!(1&~e.flags)}function qc(e){return!!e.template}function MS(e){return!!(512&e[Wn])}class _0{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function ss(e,t,n,r){null!==t?t.applyValueToInputSignal(t,r):e[n]=r}function Oo(){return Ba}function Ba(e){return e.type.prototype.ngOnChanges&&(e.setInput=cx),LS}function LS(){const e=mM(this),t=e?.current;if(t){const n=e.previous;if(n===Wd)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function cx(e,t,n,r,i){const o=this.declaredInputs[r],s=mM(e)||function $l(e,t){return e[Nb]=t}(e,{previous:Wd,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[o];a[o]=new _0(c&&c.currentValue,n,l===Wd),ss(e,t,i,n)}Oo.ngInherit=!0;const Nb="__ngSimpleChanges__";function mM(e){return e[Nb]||null}const gd=function(e,t,n){};let Fb=!1;function mo(e){for(;Array.isArray(e);)e=e[wr];return e}function Ob(e,t){return mo(t[e])}function Yl(e,t){return mo(t[e.index])}function Bb(e,t){return e.data[t]}function Wc(e,t){const n=t[e];return Pl(n)?n:n[wr]}function US(e){return!(128&~e[Wn])}function Au(e,t){return null==t?null:e[t]}function yE(e){e[Mm]=0}function bE(e){1024&e[Wn]||(e[Wn]|=1024,US(e)&&Lb(e))}function VS(e){return!!(9216&e[Wn]||e[xh]?.dirty)}function HS(e){e[Cu].changeDetectionScheduler?.notify(1),VS(e)?Lb(e):64&e[Wn]&&(function gE(){return Fb}()?(e[Wn]|=1024,Lb(e)):e[Cu].changeDetectionScheduler?.notify())}function Lb(e){e[Cu].changeDetectionScheduler?.notify();let t=Nm(e);for(;null!==t&&!(8192&t[Wn])&&(t[Wn]|=8192,US(t));)t=Nm(t)}function jb(e,t){if(!(256&~e[Wn]))throw new Xt(911,!1);null===e[Fa]&&(e[Fa]=[]),e[Fa].push(t)}function Nm(e){const t=e[Fs];return Oa(t)?t[Fs]:t}const yr={lFrame:mx(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function xE(){return yr.bindingsEnabled}function _t(){return yr.lFrame.lView}function ai(){return yr.lFrame.tView}function Sh(e){return yr.lFrame.contextLView=e,e[Fo]}function qf(e){return yr.lFrame.contextLView=null,e}function ro(){let e=_E();for(;null!==e&&64===e.type;)e=e.parent;return e}function _E(){return yr.lFrame.currentTNode}function rf(e,t){const n=yr.lFrame;n.currentTNode=e,n.isParent=t}function SE(){return yr.lFrame.isParent}function Xl(){yr.lFrame.isParent=!1}function Kl(){const e=yr.lFrame;let t=e.bindingRootIndex;return-1===t&&(t=e.bindingRootIndex=e.tView.bindingStartIndex),t}function Iu(){return yr.lFrame.bindingIndex++}function xM(e,t){const n=yr.lFrame;n.bindingIndex=n.bindingRootIndex=e,fx(t)}function fx(e){yr.lFrame.currentDirectiveIndex=e}function px(){return yr.lFrame.currentQueryIndex}function w0(e){yr.lFrame.currentQueryIndex=e}function FL(e){const t=e[Ht];return 2===t.type?t.declTNode:1===t.type?e[tl]:null}function TE(e,t,n){if(n&gi.SkipSelf){let i=t,o=e;for(;!(i=i.parent,null!==i||n&gi.Host||(i=FL(o),null===i||(o=o[vh],10&i.type))););if(null===i)return!1;t=i,e=o}const r=yr.lFrame=DE();return r.currentTNode=t,r.lView=e,!0}function hx(e){const t=DE(),n=e[Ht];yr.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function DE(){const e=yr.lFrame,t=null===e?null:e.child;return null===t?mx(e):t}function mx(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function Yf(){const e=yr.lFrame;return yr.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const _M=Yf;function $S(){const e=Yf();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function kl(){return yr.lFrame.selectedIndex}function Fm(e){yr.lFrame.selectedIndex=e}function io(){const e=yr.lFrame;return Bb(e.tView,e.selectedIndex)}let SM=!0;function vn(){return SM}function Pc(e){SM=e}function gx(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const o=e.data[n].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=o;s&&(e.contentHooks??=[]).push(-n,s),a&&((e.contentHooks??=[]).push(n,a),(e.contentCheckHooks??=[]).push(n,a)),l&&(e.viewHooks??=[]).push(-n,l),c&&((e.viewHooks??=[]).push(n,c),(e.viewCheckHooks??=[]).push(n,c)),null!=u&&(e.destroyHooks??=[]).push(n,u)}}function XS(e,t,n){KS(e,t,3,n)}function Om(e,t,n,r){(3&e[Wn])===n&&KS(e,t,n,r)}function Vb(e,t){let n=e[Wn];(3&n)===t&&(n&=16383,n+=1,e[Wn]=n)}function KS(e,t,n,r){const o=r??-1,s=t.length-1;let a=0;for(let l=void 0!==r?65535&e[Mm]:0;l<s;l++)if("number"==typeof t[l+1]){if(a=t[l],null!=r&&a>=r)break}else t[l]<0&&(e[Mm]+=65536),(a<o||-1==o)&&(CM(e,n,t,l),e[Mm]=(4294901760&e[Mm])+l+2),l++}function ME(e,t){gd(4,e,t);const n=hr(null);try{t.call(e)}finally{hr(n),gd(5,e,t)}}function CM(e,t,n,r){const i=n[r]<0,o=n[r+1],a=e[i?-n[r]:n[r]];i?e[Wn]>>14<e[Mm]>>16&&(3&e[Wn])===t&&(e[Wn]+=16384,ME(a,o)):ME(a,o)}const A0=-1;class I0{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function ZS(e){return e!==A0}function $c(e){return 32767&e}function Hb(e,t){let n=function jL(e){return e>>16}(e),r=t;for(;n>0;)r=r[vh],n--;return r}let QS=!0;function yx(e){const t=QS;return QS=e,t}const AM=255,bx=5;let NE=0;const ia={};function oa(e,t){const n=nl(e,t);if(-1!==n)return n;const r=t[Ht];r.firstCreatePass&&(e.injectorIndex=t.length,Bs(r.data,e),Bs(t,null),Bs(r.blueprint,null));const i=Ql(e,t),o=e.injectorIndex;if(ZS(i)){const s=$c(i),a=Hb(i,t),l=a[Ht].data;for(let c=0;c<8;c++)t[o+c]=a[s+c]|l[s+c]}return t[o+8]=i,o}function Bs(e,t){e.push(0,0,0,0,0,0,0,0,t)}function nl(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Ql(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,i=t;for(;null!==i;){if(r=Sx(i),null===r)return A0;if(n++,i=i[vh],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return A0}function Lm(e,t,n){!function Oi(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(Hv)&&(r=n[Hv]),null==r&&(r=n[Hv]=NE++);const i=r&AM;t.data[e+(i>>bx)]|=1<<i}(e,t,n)}function Gb(e,t,n){if(n&gi.Optional||void 0!==e)return e;oE()}function jm(e,t,n,r){if(n&gi.Optional&&void 0===r&&(r=null),!(n&(gi.Self|gi.Host))){const i=e[Os],o=Uc(void 0);try{return i?i.get(t,r,n&gi.Optional):zk(t,r,n&gi.Optional)}finally{Uc(o)}}return Gb(r,0,n)}function vx(e,t,n,r=gi.Default,i){if(null!==e){if(2048&t[Wn]&&!(r&gi.Self)){const s=function FE(e,t,n,r,i){let o=e,s=t;for(;null!==o&&null!==s&&2048&s[Wn]&&!(512&s[Wn]);){const a=JS(o,s,n,r|gi.Self,ia);if(a!==ia)return a;let l=o.parent;if(!l){const c=s[x0];if(c){const u=c.get(n,ia,r);if(u!==ia)return u}l=Sx(s),s=s[vh]}o=l}return i}(e,t,n,r,ia);if(s!==ia)return s}const o=JS(e,t,n,r,ia);if(o!==ia)return o}return jm(t,n,r,i)}function JS(e,t,n,r,i){const o=function qb(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(Hv)?e[Hv]:void 0;return"number"==typeof t?t>=0?t&AM:zm:t}(n);if("function"==typeof o){if(!TE(t,e,r))return r&gi.Host?Gb(i,0,r):jm(t,n,r,i);try{let s;if(s=o(r),null!=s||r&gi.Optional)return s;oE()}finally{_M()}}else if("number"==typeof o){let s=null,a=nl(e,t),l=A0,c=r&gi.Host?t[Io][tl]:null;for((-1===a||r&gi.SkipSelf)&&(l=-1===a?Ql(e,t):t[a+8],l!==A0&&_x(r,!1)?(s=t[Ht],a=$c(l),t=Hb(l,t)):a=-1);-1!==a;){const u=t[Ht];if(Kf(o,a,u.data)){const d=xx(a,t,n,s,r,c);if(d!==ia)return d}l=t[a+8],l!==A0&&_x(r,t[Ht].data[a+8]===c)&&Kf(o,a,t)?(s=u,a=$c(l),t=Hb(l,t)):a=-1}}return i}function xx(e,t,n,r,i,o){const s=t[Ht],a=s.data[e+8],u=Rl(a,s,n,null==r?Rm(a)&&QS:r!=s&&!!(3&a.type),i&gi.Host&&o===a);return null!==u?Ch(t,s,u,a):ia}function Rl(e,t,n,r,i){const o=e.providerIndexes,s=t.data,a=1048575&o,l=e.directiveStart,u=o>>20,f=i?a+u:e.directiveEnd;for(let p=r?a:a+u;p<f;p++){const m=s[p];if(p<l&&n===m||p>=l&&m.type===n)return p}if(i){const p=s[l];if(p&&qc(p)&&p.type===n)return l}return null}function Ch(e,t,n,r){let i=e[n];const o=t.data;if(function RE(e){return e instanceof I0}(i)){const s=i;s.resolving&&function mL(e,t){throw t&&t.join(" > "),new Xt(-200,e)}(function Fi(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Tr(e)}(o[n]));const a=yx(s.canSeeViewProviders);s.resolving=!0;const c=s.injectImpl?Uc(s.injectImpl):null;TE(e,r,gi.Default);try{i=e[n]=s.factory(void 0,o,e,r),t.firstCreatePass&&n>=r.directiveStart&&function kE(e,t,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=t.type.prototype;if(r){const s=Ba(t);(n.preOrderHooks??=[]).push(e,s),(n.preOrderCheckHooks??=[]).push(e,s)}i&&(n.preOrderHooks??=[]).push(0-e,i),o&&((n.preOrderHooks??=[]).push(e,o),(n.preOrderCheckHooks??=[]).push(e,o))}(n,o[n],t)}finally{null!==c&&Uc(c),yx(a),s.resolving=!1,_M()}}return i}function Kf(e,t,n){return!!(n[t+(e>>bx)]&1<<e)}function _x(e,t){return!(e&gi.Self||e&gi.Host&&t)}class Ls{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return vx(this._tNode,this._lView,t,dS(r),n)}}function zm(){return new Ls(ro(),_t())}function Wb(e){return lh(()=>{const t=e.prototype.constructor,n=t[uh]||E0(t),r=Object.prototype;let i=Object.getPrototypeOf(e.prototype).constructor;for(;i&&i!==r;){const o=i[uh]||E0(i);if(o&&o!==n)return o;i=Object.getPrototypeOf(i)}return o=>new o})}function E0(e){return qd(e)?()=>{const t=E0(Zn(e));return t&&t()}:f0(e)}function Sx(e){const t=e[Ht],n=t.type;return 2===n?t.declTNode:1===n?e[tl]:null}function UE(e,t=null,n=null,r){const i=zE(e,t,n,r);return i.resolveInjectorInitializers(),i}function zE(e,t=null,n=null,r,i=new Set){const o=[n||xi,Jv(e)];return r=r||("object"==typeof e?void 0:ya(e)),new Kd(o,t||Dl(),r||null,i)}let Jl=(()=>{class e{static#e=this.THROW_IF_NOT_FOUND=Gv;static#t=this.NULL=new p0;static create(n,r){if(Array.isArray(n))return UE({name:""},r,n,"");{const i=n.name??"";return UE({name:i},n.parent,n.providers,i)}}static#n=this.\u0275prov=gn({token:e,providedIn:"any",factory:()=>Rn(yS)});static#r=this.__NG_ELEMENT_ID__=-1}return e})();function tC(e){return e.ngOriginalError}class af{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&tC(t);for(;n&&tC(n);)n=tC(n);return n||null}}const Hm=new jn("",{providedIn:"root",factory:()=>qt(af).handleError.bind(void 0)});let Yb=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=TM;static#t=this.__NG_ENV_ID__=n=>n}return e})();class Xb extends Yb{constructor(t){super(),this._lView=t}onDestroy(t){return jb(this._lView,t),()=>function GS(e,t){if(null===e[Fa])return;const n=e[Fa].indexOf(t);-1!==n&&e[Fa].splice(n,1)}(this._lView,t)}}function TM(){return new Xb(_t())}function DM(){return Kb(ro(),_t())}function Kb(e,t){return new Ua(Yl(e,t))}let Ua=(()=>{class e{constructor(n){this.nativeElement=n}static#e=this.__NG_ELEMENT_ID__=DM}return e})();function nC(e){return e instanceof Ua?e.nativeElement:e}function Zf(e){return t=>{setTimeout(e,void 0,t)}}const rl=class GL extends si{constructor(t=!1){super(),this.destroyRef=void 0,this.__isAsync=t,sM()&&(this.destroyRef=qt(Yb,{optional:!0})??void 0)}emit(t){const n=hr(null);try{super.next(t)}finally{hr(n)}}subscribe(t,n,r){let i=t,o=n||(()=>null),s=r;if(t&&"object"==typeof t){const l=t;i=l.next?.bind(l),o=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(o=Zf(o),i&&(i=Zf(i)),s&&(s=Zf(s)));const a=super.subscribe({next:i,error:o,complete:s});return t instanceof Il&&t.add(a),a}};function D0(){return this._results[Symbol.iterator]()}class Zb{static#e=Symbol.iterator;get changes(){return this._changes??=new rl}constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._onDirty=void 0,this._results=[],this._changesDetected=!1,this._changes=void 0,this.length=0,this.first=void 0,this.last=void 0;const n=Zb.prototype;n[Symbol.iterator]||(n[Symbol.iterator]=D0)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){this.dirty=!1;const r=function zc(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function xL(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let i=e[r],o=t[r];if(n&&(i=n(i),o=n(o)),o!==i)return!1}return!0}(this._results,r,n))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){void 0!==this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}onDirty(t){this._onDirty=t}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){void 0!==this._changes&&(this._changes.complete(),this._changes.unsubscribe())}}function iC(e){return!(128&~e.flags)}const oC=new Map;let sC=0;const Jb="__ngContext__";function Fl(e,t){Pl(t)?(e[Jb]=t[v0],function kM(e){oC.set(e[v0],e)}(t)):e[Jb]=t}function De(e){return pt(e[Tc])}function He(e){return pt(e[Su])}function pt(e){for(;null!==e&&!Oa(e);)e=e[Su];return e}let Qf;const $L=new jn("",{providedIn:"root",factory:()=>xCe}),xCe="ng",QK=new jn(""),Ex=new jn("",{providedIn:"platform",factory:()=>"unknown"}),JK=new jn("",{providedIn:"root",factory:()=>function e1(){if(void 0!==Qf)return Qf;if(typeof document<"u")return document;throw new Xt(210,!1)}().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});let eZ=()=>null;function t6(e,t,n=!1){return eZ(e,t,n)}const oZ=new jn("",{providedIn:"root",factory:()=>!1});let VM;function cZ(e){return function s6(){if(void 0===VM&&(VM=null,Gn.trustedTypes))try{VM=Gn.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:e=>e,createScript:e=>e,createScriptURL:e=>e})}catch{}return VM}()?.createScriptURL(e)||e}class uZ{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ad})`}}function t1(e){return e instanceof uZ?e.changingThisBreaksApplicationSecurity:e}function YE(e,t){const n=function jCe(e){return e instanceof uZ&&e.getTypeName()||null}(e);if(null!=n&&n!==t){if("ResourceURL"===n&&"URL"===t)return!0;throw new Error(`Required a safe ${t}, got a ${n} (see ${ad})`)}return n===t}const HCe=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var hC=function(e){return e[e.NONE=0]="NONE",e[e.HTML=1]="HTML",e[e.STYLE=2]="STYLE",e[e.SCRIPT=3]="SCRIPT",e[e.URL=4]="URL",e[e.RESOURCE_URL=5]="RESOURCE_URL",e}(hC||{});function vZ(e){const t=KE();return t?t.sanitize(hC.URL,e)||"":YE(e,"URL")?t1(e):function a6(e){return(e=String(e)).match(HCe)?e:"unsafe:"+e}(Tr(e))}function xZ(e){const t=KE();if(t)return cZ(t.sanitize(hC.RESOURCE_URL,e)||"");if(YE(e,"ResourceURL"))return cZ(t1(e));throw new Xt(904,!1)}function KE(){const e=_t();return e&&e[Cu].sanitizer}const owe=/^>|^->|<!--|-->|--!>|<!-$/g,swe=/(<|>)/g,awe="\u200b$1\u200b";function AZ(e){return e.ownerDocument.defaultView}function lf(e){return e instanceof Function?e():e}var r1=function(e){return e[e.Important=1]="Important",e[e.DashCase=2]="DashCase",e}(r1||{});let h6;function m6(e,t){return h6(e,t)}function gC(e,t,n,r,i){if(null!=r){let o,s=!1;Oa(r)?o=r:Pl(r)&&(s=!0,r=r[wr]);const a=mo(r);0===e&&null!==n?null==i?NZ(t,n,a):Tx(t,n,a,i||null,!0):1===e&&null!==n?Tx(t,n,a,i||null,!0):2===e?function JE(e,t,n){const r=YM(e,t);r&&function Awe(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,a,s):3===e&&t.destroyNode(a),null!=o&&function Twe(e,t,n,r,i){const o=n[md];o!==mo(n)&&gC(t,e,r,o,i);for(let a=Eo;a<n.length;a++){const l=n[a];KM(l[Ht],l,e,t,r,o)}}(t,e,o,n,i)}}function y6(e,t){return e.createComment(function SZ(e){return e.replace(owe,t=>t.replace(swe,awe))}(t))}function WM(e,t,n){return e.createElement(t,n)}function kZ(e,t){t[Cu].changeDetectionScheduler?.notify(1),KM(e,t,t[_r],2,null,null)}function MZ(e,t){const n=e[Gc],r=n.indexOf(t);n.splice(r,1)}function ZE(e,t){if(e.length<=Eo)return;const n=Eo+t,r=e[n];if(r){const i=r[b0];null!==i&&i!==e&&MZ(i,r),t>0&&(e[n-1][Su]=r[Su]);const o=Yv(e,Eo+t);!function bwe(e,t){kZ(e,t),t[wr]=null,t[tl]=null}(r[Ht],r);const s=o[ef];null!==s&&s.detachView(o[Ht]),r[Fs]=null,r[Su]=null,r[Wn]&=-129}return r}function $M(e,t){if(!(256&t[Wn])){const n=t[_r];n.destroyNode&&KM(e,t,n,3,null,null),function xwe(e){let t=e[Tc];if(!t)return b6(e[Ht],e);for(;t;){let n=null;if(Pl(t))n=t[Tc];else{const r=t[Eo];r&&(n=r)}if(!n){for(;t&&!t[Su]&&t!==e;)Pl(t)&&b6(t[Ht],t),t=t[Fs];null===t&&(t=e),Pl(t)&&b6(t[Ht],t),n=t&&t[Su]}t=n}}(t)}}function b6(e,t){if(256&t[Wn])return;const n=hr(null);try{t[Wn]&=-129,t[Wn]|=256,t[xh]&&function ih(e){if(Jg(e),xm(e))for(let t=0;t<e.producerNode.length;t++)G2(e.producerNode[t],e.producerIndexOfThis[t]);e.producerNode.length=e.producerLastReadVersion.length=e.producerIndexOfThis.length=0,e.liveConsumerNode&&(e.liveConsumerNode.length=e.liveConsumerIndexOfThis.length=0)}(t[xh]),function wwe(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const i=t[n[r]];if(!(i instanceof I0)){const o=n[r+1];if(Array.isArray(o))for(let s=0;s<o.length;s+=2){const a=i[o[s]],l=o[s+1];gd(4,a,l);try{l.call(a)}finally{gd(5,a,l)}}else{gd(4,i,o);try{o.call(i)}finally{gd(5,i,o)}}}}}(e,t),function Cwe(e,t){const n=e.cleanup,r=t[bh];if(null!==n)for(let o=0;o<n.length-1;o+=2)if("string"==typeof n[o]){const s=n[o+3];s>=0?r[s]():r[-s].unsubscribe(),o+=2}else n[o].call(r[n[o+1]]);null!==r&&(t[bh]=null);const i=t[Fa];if(null!==i){t[Fa]=null;for(let o=0;o<i.length;o++)(0,i[o])()}}(e,t),1===t[Ht].type&&t[_r].destroy();const r=t[b0];if(null!==r&&Oa(t[Fs])){r!==t[Fs]&&MZ(r,t);const i=t[ef];null!==i&&i.detachView(e)}!function qL(e){oC.delete(e[v0])}(t)}finally{hr(n)}}function v6(e,t,n){return function RZ(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[wr];{const{componentOffset:i}=r;if(i>-1){const{encapsulation:o}=e.data[r.directiveStart+i];if(o===cd.None||o===cd.Emulated)return null}return Yl(r,n)}}(e,t.parent,n)}function Tx(e,t,n,r,i){e.insertBefore(t,n,r,i)}function NZ(e,t,n){e.appendChild(t,n)}function FZ(e,t,n,r,i){null!==r?Tx(e,t,n,r,i):NZ(e,t,n)}function YM(e,t){return e.parentNode(t)}let x6,LZ=function BZ(e,t,n){return 40&e.type?Yl(e,n):null};function XM(e,t,n,r){const i=v6(e,r,t),o=t[_r],a=function OZ(e,t,n){return LZ(e,t,n)}(r.parent||t[tl],r,t);if(null!=i)if(Array.isArray(n))for(let l=0;l<n.length;l++)FZ(o,i,n[l],a,!1);else FZ(o,i,n,a,!1);void 0!==x6&&x6(o,r,t,n,i)}function QE(e,t){if(null!==t){const n=t.type;if(3&n)return Yl(t,e);if(4&n)return _6(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return QE(e,r);{const i=e[t.index];return Oa(i)?_6(-1,i):mo(i)}}if(32&n)return m6(t,e)()||mo(e[t.index]);{const r=UZ(e,t);return null!==r?Array.isArray(r)?r[0]:QE(Nm(e[Io]),r):QE(e,t.next)}}return null}function UZ(e,t){return null!==t?e[Io][tl].projection[t.projection]:null}function _6(e,t){const n=Eo+e+1;if(n<t.length){const r=t[n],i=r[Ht].firstChild;if(null!==i)return QE(r,i)}return t[md]}function S6(e,t,n,r,i,o,s){for(;null!=n;){const a=r[n.index],l=n.type;if(s&&0===t&&(a&&Fl(mo(a),r),n.flags|=2),32&~n.flags)if(8&l)S6(e,t,n.child,r,i,o,!1),gC(t,e,i,a,o);else if(32&l){const c=m6(n,r);let u;for(;u=c();)gC(t,e,i,u,o);gC(t,e,i,a,o)}else 16&l?VZ(e,t,r,n,i,o):gC(t,e,i,a,o);n=s?n.projectionNext:n.next}}function KM(e,t,n,r,i,o){S6(n,r,e.firstChild,t,i,o,!1)}function VZ(e,t,n,r,i,o){const s=n[Io],l=s[tl].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)gC(t,e,i,l[c],o);else{let c=l;const u=s[Fs];iC(r)&&(c.flags|=128),S6(e,t,c,u,i,o,!0)}}function HZ(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function GZ(e,t,n){const{mergedAttrs:r,classes:i,styles:o}=n;null!==r&&vS(e,t,r),null!==i&&HZ(e,t,i),null!==o&&function Pwe(e,t,n){e.setAttribute(t,"style",n)}(e,t,o)}const Gr={};function Yc(e=1){qZ(ai(),_t(),kl()+e,!1)}function qZ(e,t,n,r){if(!r)if(3&~t[Wn]){const o=e.preOrderHooks;null!==o&&Om(t,o,0,n)}else{const o=e.preOrderCheckHooks;null!==o&&XS(t,o,n)}Fm(n)}function On(e,t=gi.Default){const n=_t();return null===n?Rn(e,t):vx(ro(),n,Zn(e),t)}function $Z(e,t,n,r,i,o){const s=hr(null);try{let a=null;i&ud.SignalBased&&(a=t[r][no]),null!==a&&void 0!==a.transformFn&&(o=a.transformFn(o)),i&ud.HasDecoratorInputTransform&&(o=e.inputTransforms[r].call(t,o)),null!==e.setInput?e.setInput(t,a,o,n,r):ss(t,a,r,o)}finally{hr(s)}}function ZM(e,t,n,r,i,o,s,a,l,c,u){const d=t.blueprint.slice();return d[wr]=i,d[Wn]=204|r,(null!==c||e&&2048&e[Wn])&&(d[Wn]|=2048),yE(d),d[Fs]=d[vh]=e,d[Fo]=n,d[Cu]=s||e&&e[Cu],d[_r]=a||e&&e[_r],d[Os]=l||e&&e[Os]||null,d[tl]=o,d[v0]=function aC(){return sC++}(),d[Hc]=u,d[x0]=c,d[Io]=2==t.type?e[Io]:d,d}function yC(e,t,n,r,i){let o=e.data[t];if(null===o)o=function C6(e,t,n,r,i){const o=_E(),s=SE(),l=e.data[t]=function Lwe(e,t,n,r,i,o){let s=t?t.injectorIndex:-1,a=0;return function C0(){return null!==yr.skipHydrationRootTNode}()&&(a|=128),{type:n,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,n,t,r,i);return null===e.firstChild&&(e.firstChild=l),null!==o&&(s?null==o.child&&null!==l.parent&&(o.child=l):null===o.next&&(o.next=l,l.prev=o)),l}(e,t,n,r,i),function AE(){return yr.lFrame.inI18n}()&&(o.flags|=32);else if(64&o.type){o.type=n,o.value=r,o.attrs=i;const s=function zb(){const e=yr.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();o.injectorIndex=null===s?-1:s.injectorIndex}return rf(o,!0),o}function eT(e,t,n,r){if(0===n)return-1;const i=t.length;for(let o=0;o<n;o++)t.push(r),e.blueprint.push(r),e.data.push(null);return i}function YZ(e,t,n,r,i){const o=kl(),s=2&r;try{Fm(-1),s&&t.length>Ar&&qZ(e,t,Ar,!1),gd(s?2:0,i),n(r,i)}finally{Fm(o),gd(s?3:1,i)}}function w6(e,t,n){if(kS(t)){const r=hr(null);try{const o=t.directiveEnd;for(let s=t.directiveStart;s<o;s++){const a=e.data[s];a.contentQueries&&a.contentQueries(1,n[s],s)}}finally{hr(r)}}}function A6(e,t,n){xE()&&(function qwe(e,t,n,r){const i=n.directiveStart,o=n.directiveEnd;Rm(n)&&function Qwe(e,t,n){const r=Yl(t,e),i=XZ(n);let s=16;n.signals?s=4096:n.onPush&&(s=64);const a=QM(e,ZM(e,i,null,s,r,t,null,e[Cu].rendererFactory.createRenderer(r,n),null,null,null));e[t.index]=a}(t,n,e.data[i+n.componentOffset]),e.firstCreatePass||oa(n,t),Fl(r,t);const s=n.initialInputs;for(let a=i;a<o;a++){const l=e.data[a],c=Ch(t,e,a,n);Fl(c,t),null!==s&&Jwe(0,a-i,c,l,0,s),qc(l)&&(Wc(n.index,t)[Fo]=Ch(t,e,a,n))}}(e,t,n,Yl(n,t)),!(64&~n.flags)&&eQ(e,t,n))}function I6(e,t,n=Yl){const r=t.localNames;if(null!==r){let i=t.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?n(t,e):e[s];e[i++]=a}}}function XZ(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=E6(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts,e.id):t}function E6(e,t,n,r,i,o,s,a,l,c,u){const d=Ar+r,f=d+i,p=function Mwe(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Gr);return n}(d,f),m="function"==typeof c?c():c;return p[Ht]={type:e,blueprint:p,template:n,queries:null,viewQuery:a,declTNode:t,data:p.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:f,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:l,consts:m,incompleteFirstPass:!1,ssrId:u}}let KZ=()=>null;function ZZ(e,t,n,r,i){for(let o in t){if(!t.hasOwnProperty(o))continue;const s=t[o];if(void 0===s)continue;r??={};let a,l=ud.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=o;if(null!==i){if(!i.hasOwnProperty(o))continue;c=i[o]}0===e?QZ(r,n,c,a,l):QZ(r,n,c,a)}return r}function QZ(e,t,n,r,i){let o;e.hasOwnProperty(n)?(o=e[n]).push(t,r):o=e[n]=[t,r],void 0!==i&&o.push(i)}function T6(e,t,n,r){if(xE()){const i=null===r?null:{"":-1},o=function $we(e,t){const n=e.directiveRegistry;let r=null,i=null;if(n)for(let o=0;o<n.length;o++){const s=n[o];if(_S(t,s.selectors,!1))if(r||(r=[]),qc(s))if(null!==s.findHostDirectiveDefs){const a=[];i=i||new Map,s.findHostDirectiveDefs(s,a,i),r.unshift(...a,s),D6(e,t,a.length)}else r.unshift(s),D6(e,t,0);else i=i||new Map,s.findHostDirectiveDefs?.(s,r,i),r.push(s)}return null===r?null:[r,i]}(e,n);let s,a;null===o?s=a=null:[s,a]=o,null!==s&&JZ(e,t,n,s,i,a),i&&function Ywe(e,t,n){if(t){const r=e.localNames=[];for(let i=0;i<t.length;i+=2){const o=n[t[i+1]];if(null==o)throw new Xt(-301,!1);r.push(t[i],o)}}}(n,r,i)}n.mergedAttrs=h0(n.mergedAttrs,n.attrs)}function JZ(e,t,n,r,i,o){for(let c=0;c<r.length;c++)Lm(oa(n,t),e,r[c].type);!function Kwe(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,r.length);for(let c=0;c<r.length;c++){const u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=eT(e,t,r.length,null);for(let c=0;c<r.length;c++){const u=r[c];n.mergedAttrs=h0(n.mergedAttrs,u.hostAttrs),Zwe(e,n,t,l,u),Xwe(l,u,i),null!==u.contentQueries&&(n.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(n.flags|=64);const d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((e.preOrderHooks??=[]).push(n.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((e.preOrderCheckHooks??=[]).push(n.index),a=!0),l++}!function jwe(e,t,n){const i=t.directiveEnd,o=e.data,s=t.attrs,a=[];let l=null,c=null;for(let u=t.directiveStart;u<i;u++){const d=o[u],f=n?n.get(d):null,m=f?f.outputs:null;l=ZZ(0,d.inputs,u,l,f?f.inputs:null),c=ZZ(1,d.outputs,u,c,m);const h=null===l||null===s||m0(t)?null:eAe(l,u,s);a.push(h)}null!==l&&(l.hasOwnProperty("class")&&(t.flags|=8),l.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=a,t.inputs=l,t.outputs=c}(e,n,o)}function eQ(e,t,n){const r=n.directiveStart,i=n.directiveEnd,o=n.index,s=function EE(){return yr.lFrame.currentDirectiveIndex}();try{Fm(o);for(let a=r;a<i;a++){const l=e.data[a],c=t[a];fx(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&Wwe(l,c)}}finally{Fm(-1),fx(s)}}function Wwe(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function D6(e,t,n){t.componentOffset=n,(e.components??=[]).push(t.index)}function Xwe(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;qc(t)&&(n[""]=e)}}function Zwe(e,t,n,r,i){e.data[r]=i;const o=i.factory||(i.factory=f0(i.type)),s=new I0(o,qc(i),On);e.blueprint[r]=s,n[r]=s,function Hwe(e,t,n,r,i){const o=i.hostBindings;if(o){let s=e.hostBindingOpCodes;null===s&&(s=e.hostBindingOpCodes=[]);const a=~t.index;(function Gwe(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(s)!=a&&s.push(a),s.push(n,r,o)}}(e,t,r,eT(e,n,i.hostVars,Gr),i)}function Gm(e,t,n,r,i,o){const s=Yl(e,t);!function P6(e,t,n,r,i,o,s){if(null==o)e.removeAttribute(t,i,n);else{const a=null==s?Tr(o):s(o,r||"",i);e.setAttribute(t,i,a,n)}}(t[_r],s,o,e.value,n,r,i)}function Jwe(e,t,n,r,i,o){const s=o[t];if(null!==s)for(let a=0;a<s.length;)$Z(r,n,s[a++],s[a++],s[a++],s[a++])}function eAe(e,t,n){let r=null,i=0;for(;i<n.length;){const o=n[i];if(0!==o)if(5!==o){if("number"==typeof o)break;if(e.hasOwnProperty(o)){null===r&&(r=[]);const s=e[o];for(let a=0;a<s.length;a+=3)if(s[a]===t){r.push(o,s[a+1],s[a+2],n[i+1]);break}}i+=2}else i+=2;else i+=4}return r}function tQ(e,t,n,r){return[e,!0,0,t,null,r,null,n,null,null]}function nQ(e,t){const n=e.contentQueries;if(null!==n){const r=hr(null);try{for(let i=0;i<n.length;i+=2){const s=n[i+1];if(-1!==s){const a=e.data[s];w0(n[i]),a.contentQueries(2,t[s],s)}}}finally{hr(r)}}}function QM(e,t){return e[Tc]?e[rx][Su]=t:e[Tc]=t,e[rx]=t,t}function k6(e,t,n){w0(0);const r=hr(null);try{t(e,n)}finally{hr(r)}}function rQ(e){return e[bh]||(e[bh]=[])}function iQ(e){return e.cleanup||(e.cleanup=[])}function JM(e,t){const n=e[Os],r=n?n.get(af,null):null;r&&r.handleError(t)}function M6(e,t,n,r,i){for(let o=0;o<n.length;){const s=n[o++],a=n[o++],l=n[o++];$Z(e.data[s],t[s],r,a,l,i)}}function tAe(e,t){const n=Wc(t,e),r=n[Ht];!function nAe(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n);const i=n[wr];null!==i&&null===n[Hc]&&(n[Hc]=t6(i,n[Os])),R6(r,n,n[Fo])}function R6(e,t,n){hx(t);try{const r=e.viewQuery;null!==r&&k6(1,r,n);const i=e.template;null!==i&&YZ(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),t[ef]?.finishViewCreation(e),e.staticContentQueries&&nQ(e,t),e.staticViewQueries&&k6(2,e.viewQuery,n);const o=e.components;null!==o&&function rAe(e,t){for(let n=0;n<t.length;n++)tAe(e,t[n])}(t,o)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[Wn]&=-5,$S()}}function tT(e,t,n,r){const i=hr(null);try{const o=t.tView,l=ZM(e,o,n,4096&e[Wn]?4096:16,null,t,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null);l[b0]=e[t.index];const u=e[ef];return null!==u&&(l[ef]=u.createEmbeddedView(o)),R6(o,l,n),l}finally{hr(i)}}function sQ(e,t){const n=Eo+t;if(n<e.length)return e[n]}function bC(e,t){return!t||null===t.firstChild||iC(e)}function nT(e,t,n,r=!0){const i=t[Ht];if(function _we(e,t,n,r){const i=Eo+r,o=n.length;r>0&&(n[i-1][Su]=t),r<o-Eo?(t[Su]=n[i],Ab(n,Eo+r,t)):(n.push(t),t[Su]=null),t[Fs]=n;const s=t[b0];null!==s&&n!==s&&function Swe(e,t){const n=e[Gc];t[Io]!==t[Fs][Fs][Io]&&(e[Wn]|=Pb.HasTransplantedViews),null===n?e[Gc]=[t]:n.push(t)}(s,t);const a=t[ef];null!==a&&a.insertView(e),HS(t),t[Wn]|=128}(i,t,e,n),r){const s=_6(n,e),a=t[_r],l=YM(a,e[md]);null!==l&&function vwe(e,t,n,r,i,o){r[wr]=i,r[tl]=t,KM(e,r,n,1,i,o)}(i,e[tl],a,t,l,s)}const o=t[Hc];null!==o&&null!==o.firstChild&&(o.firstChild=null)}function N6(e,t){const n=ZE(e,t);return void 0!==n&&$M(n[Ht],n),n}function rT(e,t,n,r,i=!1){for(;null!==n;){const o=t[n.index];null!==o&&r.push(mo(o)),Oa(o)&&aQ(o,r);const s=n.type;if(8&s)rT(e,t,n.child,r);else if(32&s){const a=m6(n,t);let l;for(;l=a();)r.push(l)}else if(16&s){const a=UZ(t,n);if(Array.isArray(a))r.push(...a);else{const l=Nm(t[Io]);rT(l[Ht],l,a,r,!0)}}n=i?n.projectionNext:n.next}return r}function aQ(e,t){for(let n=Eo;n<e.length;n++){const r=e[n],i=r[Ht].firstChild;null!==i&&rT(r[Ht],r,i,t)}e[md]!==e[wr]&&t.push(e[md])}let lQ=[];const aAe={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{},consumerIsAlwaysLive:!0,consumerMarkedDirty:e=>{Lb(e.lView)},consumerOnSignalRead(){this.lView[xh]=this}},cQ=100;function e4(e,t=!0,n=0){const r=e[Cu],i=r.rendererFactory;i.begin?.();try{!function lAe(e,t){F6(e,t);let n=0;for(;VS(e);){if(n===cQ)throw new Xt(103,!1);n++,F6(e,1)}}(e,n)}catch(s){throw t&&JM(e,s),s}finally{i.end?.(),r.inlineEffectRunner?.flush()}}function cAe(e,t,n,r){const i=t[Wn];if(!(256&~i))return;t[Cu].inlineEffectRunner?.flush(),hx(t);let s=null,a=null;(function uAe(e){return 2!==e.type})(e)&&(a=function iAe(e){return e[xh]??function oAe(e){const t=lQ.pop()??Object.create(aAe);return t.lView=e,t}(e)}(t),s=function ws(e){return e&&(e.nextProducerIndex=0),hr(e)}(a));try{yE(t),function wE(e){return yr.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&YZ(e,t,n,2,r);const l=!(3&~i);if(l){const d=e.preOrderCheckHooks;null!==d&&XS(t,d,null)}else{const d=e.preOrderHooks;null!==d&&Om(t,d,0,null),Vb(t,0)}if(function dAe(e){for(let t=De(e);null!==t;t=He(t)){if(!(t[Wn]&Pb.HasTransplantedViews))continue;const n=t[Gc];for(let r=0;r<n.length;r++){bE(n[r])}}}(t),uQ(t,0),null!==e.contentQueries&&nQ(e,t),l){const d=e.contentCheckHooks;null!==d&&XS(t,d)}else{const d=e.contentHooks;null!==d&&Om(t,d,1),Vb(t,1)}!function kwe(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const i=n[r];if(i<0)Fm(~i);else{const o=i,s=n[++r],a=n[++r];xM(s,o),a(2,t[o])}}}finally{Fm(-1)}}(e,t);const c=e.components;null!==c&&fQ(t,c,0);const u=e.viewQuery;if(null!==u&&k6(2,u,r),l){const d=e.viewCheckHooks;null!==d&&XS(t,d)}else{const d=e.viewHooks;null!==d&&Om(t,d,2),Vb(t,2)}if(!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[Gf]){for(const d of t[Gf])d();t[Gf]=null}t[Wn]&=-73}catch(l){throw Lb(t),l}finally{null!==a&&(function Vo(e,t){if(hr(t),e&&void 0!==e.producerNode&&void 0!==e.producerIndexOfThis&&void 0!==e.producerLastReadVersion){if(xm(e))for(let n=e.nextProducerIndex;n<e.producerNode.length;n++)G2(e.producerNode[n],e.producerIndexOfThis[n]);for(;e.producerNode.length>e.nextProducerIndex;)e.producerNode.pop(),e.producerLastReadVersion.pop(),e.producerIndexOfThis.pop()}}(a,s),function sAe(e){e.lView[xh]!==e&&(e.lView=null,lQ.push(e))}(a)),$S()}}function uQ(e,t){for(let n=De(e);null!==n;n=He(n))for(let r=Eo;r<n.length;r++)dQ(n[r],t)}function fAe(e,t,n){dQ(Wc(t,e),n)}function dQ(e,t){US(e)&&F6(e,t)}function F6(e,t){const r=e[Ht],i=e[Wn],o=e[xh];let s=!!(0===t&&16&i);if(s||=!!(64&i&&0===t),s||=!!(1024&i),s||=!(!o?.dirty||!Ic(o)),o&&(o.dirty=!1),e[Wn]&=-9217,s)cAe(r,e,r.template,e[Fo]);else if(8192&i){uQ(e,1);const a=r.components;null!==a&&fQ(e,a,1)}}function fQ(e,t,n){for(let r=0;r<t.length;r++)fAe(e,t[r],n)}function iT(e){for(e[Cu].changeDetectionScheduler?.notify();e;){e[Wn]|=64;const t=Nm(e);if(MS(e)&&!t)return e;e=t}return null}class oT{get rootNodes(){const t=this._lView,n=t[Ht];return rT(n,t,n.firstChild,[])}constructor(t,n,r=!0){this._lView=t,this._cdRefInjectingView=n,this.notifyErrorHandler=r,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Fo]}set context(t){this._lView[Fo]=t}get destroyed(){return!(256&~this._lView[Wn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[Fs];if(Oa(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&(ZE(t,r),Yv(n,r))}this._attachedToViewContainer=!1}$M(this._lView[Ht],this._lView)}onDestroy(t){jb(this._lView,t)}markForCheck(){iT(this._cdRefInjectingView||this._lView)}detach(){this._lView[Wn]&=-129}reattach(){HS(this._lView),this._lView[Wn]|=128}detectChanges(){this._lView[Wn]|=1024,e4(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Xt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,kZ(this._lView[Ht],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Xt(902,!1);this._appRef=t,HS(this._lView)}}let qm=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=mAe}return e})();const pAe=qm,hAe=class extends pAe{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(t,n){return this.createEmbeddedViewImpl(t,n)}createEmbeddedViewImpl(t,n,r){const i=tT(this._declarationLView,this._declarationTContainer,t,{embeddedViewInjector:n,dehydratedView:r});return new oT(i)}};function mAe(){return t4(ro(),_t())}function t4(e,t){return 4&e.type?new hAe(t,e,Kb(e,t)):null}let bQ=()=>null;function vC(e,t){return bQ(e,t)}class z6{}class jAe{}class vQ{}class zAe{resolveComponentFactory(t){throw function UAe(e){const t=Error(`No component factory found for ${ya(e)}.`);return t.ngComponent=e,t}(t)}}let s4=(()=>{class e{static#e=this.NULL=new zAe}return e})();class _Q{}let a4=(()=>{class e{constructor(){this.destroyNode=null}static#e=this.__NG_ELEMENT_ID__=()=>function VAe(){const e=_t(),n=Wc(ro().index,e);return(Pl(n)?n:e)[_r]}()}return e})(),HAe=(()=>{class e{static#e=this.\u0275prov=gn({token:e,providedIn:"root",factory:()=>null})}return e})();const V6={},SQ=new Set;function Wm(e){SQ.has(e)||(SQ.add(e),performance?.mark?.("mark_feature_usage",{detail:{feature:e}}))}function CQ(...e){}class To{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new rl(!1),this.onMicrotaskEmpty=new rl(!1),this.onStable=new rl(!1),this.onError=new rl(!1),typeof Zone>"u")throw new Xt(908,!1);Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&n,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function GAe(){const e="function"==typeof Gn.requestAnimationFrame;let t=Gn[e?"requestAnimationFrame":"setTimeout"],n=Gn[e?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&t&&n){const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r);const i=n[Zone.__symbol__("OriginalDelegate")];i&&(n=i)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:n}}().nativeRequestAnimationFrame,function $Ae(e){const t=()=>{!function WAe(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Gn,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,G6(e),e.isCheckStableRunning=!0,H6(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),G6(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,o,s,a)=>{if(function YAe(e){return!(!Array.isArray(e)||1!==e.length)&&!0===e[0].data?.__ignore_ng_zone__}(a))return n.invokeTask(i,o,s,a);try{return wQ(e),n.invokeTask(i,o,s,a)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||e.shouldCoalesceRunChangeDetection)&&t(),AQ(e)}},onInvoke:(n,r,i,o,s,a,l)=>{try{return wQ(e),n.invoke(i,o,s,a,l)}finally{e.shouldCoalesceRunChangeDetection&&t(),AQ(e)}},onHasTask:(n,r,i,o)=>{n.hasTask(i,o),r===i&&("microTask"==o.change?(e._hasPendingMicrotasks=o.microTask,G6(e),H6(e)):"macroTask"==o.change&&(e.hasPendingMacrotasks=o.macroTask))},onHandleError:(n,r,i,o)=>(n.handleError(i,o),e.runOutsideAngular(()=>e.onError.emit(o)),!1)})}(i)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!To.isInAngularZone())throw new Xt(909,!1)}static assertNotInAngularZone(){if(To.isInAngularZone())throw new Xt(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,i){const o=this._inner,s=o.scheduleEventTask("NgZoneEvent: "+i,t,qAe,CQ,CQ);try{return o.runTask(s,n,r)}finally{o.cancelTask(s)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const qAe={};function H6(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function G6(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function wQ(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function AQ(e){e._nesting--,H6(e)}var Dx=function(e){return e[e.EarlyRead=0]="EarlyRead",e[e.Write=1]="Write",e[e.MixedReadWrite=2]="MixedReadWrite",e[e.Read=3]="Read",e}(Dx||{});const EQ={destroy(){}};function TQ(e,t){!t&&function Zd(e){if(!sM())throw new Xt(-203,!1)}();const n=t?.injector??qt(Jl);if(!function n1(e){return"browser"===(e??qt(Jl)).get(Ex)}(n))return EQ;Wm("NgAfterNextRender");const r=n.get(uT),i=r.handler??=new PQ,o=t?.phase??Dx.MixedReadWrite,s=()=>{i.unregister(l),a()},a=n.get(Yb).onDestroy(s),l=Hf(n,()=>new DQ(o,()=>{s(),e()}));return i.register(l),{destroy:s}}class DQ{constructor(t,n){this.phase=t,this.callbackFn=n,this.zone=qt(To),this.errorHandler=qt(af,{optional:!0}),qt(z6,{optional:!0})?.notify(1)}invoke(){try{this.zone.runOutsideAngular(this.callbackFn)}catch(t){this.errorHandler?.handleError(t)}}}class PQ{constructor(){this.executingCallbacks=!1,this.buckets={[Dx.EarlyRead]:new Set,[Dx.Write]:new Set,[Dx.MixedReadWrite]:new Set,[Dx.Read]:new Set},this.deferredCallbacks=new Set}register(t){(this.executingCallbacks?this.deferredCallbacks:this.buckets[t.phase]).add(t)}unregister(t){this.buckets[t.phase].delete(t),this.deferredCallbacks.delete(t)}execute(){this.executingCallbacks=!0;for(const t of Object.values(this.buckets))for(const n of t)n.invoke();this.executingCallbacks=!1;for(const t of this.deferredCallbacks)this.buckets[t.phase].add(t);this.deferredCallbacks.clear()}destroy(){for(const t of Object.values(this.buckets))t.clear();this.deferredCallbacks.clear()}}let uT=(()=>{class e{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){const n=[...this.internalCallbacks];this.internalCallbacks.length=0;for(const r of n)r()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}static#e=this.\u0275prov=gn({token:e,providedIn:"root",factory:()=>new e})}return e})();function c4(e,t,n){let r=n?e.styles:null,i=n?e.classes:null,o=0;if(null!==t)for(let s=0;s<t.length;s++){const a=t[s];"number"==typeof a?o=a:1==o?i=nS(i,a):2==o&&(r=nS(r,a+": "+t[++s]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}class RQ extends s4{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Yr(t);return new pT(n,this.ngModule)}}function NQ(e){const t=[];for(const n in e){if(!e.hasOwnProperty(n))continue;const r=e[n];void 0!==r&&t.push({propName:Array.isArray(r)?r[0]:r,templateName:n})}return t}class eIe{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){r=dS(r);const i=this.injector.get(t,V6,r);return i!==V6||n===V6?i:this.parentInjector.get(t,n,r)}}class pT extends vQ{get inputs(){const t=this.componentDef,n=t.inputTransforms,r=NQ(t.inputs);if(null!==n)for(const i of r)n.hasOwnProperty(i.propName)&&(i.transform=n[i.propName]);return r}get outputs(){return NQ(this.componentDef.outputs)}constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Eb(e){return e.map(CS).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}create(t,n,r,i){const o=hr(null);try{let s=(i=i||this.ngModule)instanceof Na?i:i?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const a=s?new eIe(t,s):t,l=a.get(_Q,null);if(null===l)throw new Xt(407,!1);const c=a.get(HAe,null),f={rendererFactory:l,sanitizer:c,inlineEffectRunner:null,afterRenderEventManager:a.get(uT,null),changeDetectionScheduler:a.get(z6,null)},p=l.createRenderer(null,this.componentDef),m=this.componentDef.selectors[0][0]||"div",h=r?function Rwe(e,t,n,r){const o=r.get(oZ,!1)||n===cd.ShadowDom,s=e.selectRootElement(t,o);return function Nwe(e){KZ(e)}(s),s}(p,r,this.componentDef.encapsulation,a):WM(p,m,function JAe(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(m));let g=512;this.componentDef.signals?g|=4096:this.componentDef.onPush||(g|=16);let y=null;null!==h&&(y=t6(h,a,!0));const v=E6(0,null,null,1,0,null,null,null,null,null,null),x=ZM(null,v,null,g,null,null,f,p,a,null,y);let _,w;hx(x);try{const A=this.componentDef;let M,E=null;A.findHostDirectiveDefs?(M=[],E=new Map,A.findHostDirectiveDefs(A,M,E),M.push(A)):M=[A];const D=function nIe(e,t){const n=e[Ht],r=Ar;return e[r]=t,yC(n,r,2,"#host",null)}(x,h),T=function rIe(e,t,n,r,i,o,s){const a=i[Ht];!function iIe(e,t,n,r){for(const i of e)t.mergedAttrs=h0(t.mergedAttrs,i.hostAttrs);null!==t.mergedAttrs&&(c4(t,t.mergedAttrs,!0),null!==n&&GZ(r,n,t))}(r,e,t,s);let l=null;null!==t&&(l=t6(t,i[Os]));const c=o.rendererFactory.createRenderer(t,n);let u=16;n.signals?u=4096:n.onPush&&(u=64);const d=ZM(i,XZ(n),null,u,i[e.index],e,o,c,null,null,l);return a.firstCreatePass&&D6(a,e,r.length-1),QM(i,d),i[e.index]=d}(D,h,A,M,x,f,p);w=Bb(v,Ar),h&&function sIe(e,t,n,r){if(r)vS(e,n,["ng-version","17.3.1"]);else{const{attrs:i,classes:o}=function eM(e){const t=[],n=[];let r=1,i=2;for(;r<e.length;){let o=e[r];if("string"==typeof o)2===i?""!==o&&t.push(o,e[++r]):8===i&&n.push(o);else{if(!dd(i))break;i=o}r++}return{attrs:t,classes:n}}(t.selectors[0]);i&&vS(e,n,i),o&&o.length>0&&HZ(e,n,o.join(" "))}}(p,A,h,r),void 0!==n&&function aIe(e,t,n){const r=e.projection=[];for(let i=0;i<t.length;i++){const o=n[i];r.push(null!=o?Array.from(o):null)}}(w,this.ngContentSelectors,n),_=function oIe(e,t,n,r,i,o){const s=ro(),a=i[Ht],l=Yl(s,i);JZ(a,i,s,n,null,r);for(let u=0;u<n.length;u++)Fl(Ch(i,a,s.directiveStart+u,s),i);eQ(a,i,s),l&&Fl(l,i);const c=Ch(i,a,s.directiveStart+s.componentOffset,s);if(e[Fo]=i[Fo]=c,null!==o)for(const u of o)u(c,t);return w6(a,s,i),c}(T,A,M,E,x,[lIe]),R6(v,x,null)}finally{$S()}return new tIe(this.componentType,_,Kb(w,x),x,w)}finally{hr(o)}}}class tIe extends jAe{constructor(t,n,r,i,o){super(),this.location=r,this._rootLView=i,this._tNode=o,this.previousInputValues=null,this.instance=n,this.hostView=this.changeDetectorRef=new oT(i,void 0,!1),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let i;if(null!==r&&(i=r[t])){if(this.previousInputValues??=new Map,this.previousInputValues.has(t)&&Object.is(this.previousInputValues.get(t),n))return;const o=this._rootLView;M6(o[Ht],o,i,t,n),this.previousInputValues.set(t,n),iT(Wc(this._tNode.index,o))}}get injector(){return new Ls(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function lIe(){const e=ro();gx(_t()[Ht],e)}let Ih=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=cIe}return e})();function cIe(){return BQ(ro(),_t())}const uIe=Ih,FQ=class extends uIe{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return Kb(this._hostTNode,this._hostLView)}get injector(){return new Ls(this._hostTNode,this._hostLView)}get parentInjector(){const t=Ql(this._hostTNode,this._hostLView);if(ZS(t)){const n=Hb(t,this._hostLView),r=$c(t);return new Ls(n[Ht].data[r+8],n)}return new Ls(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=OQ(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-Eo}createEmbeddedView(t,n,r){let i,o;"number"==typeof r?i=r:null!=r&&(i=r.index,o=r.injector);const s=vC(this._lContainer,t.ssrId),a=t.createEmbeddedViewImpl(n||{},o,s);return this.insertImpl(a,i,bC(this._hostTNode,s)),a}createComponent(t,n,r,i,o){const s=t&&!function Jd(e){return"function"==typeof e}(t);let a;if(s)a=n;else{const m=n||{};a=m.index,r=m.injector,i=m.projectableNodes,o=m.environmentInjector||m.ngModuleRef}const l=s?t:new pT(Yr(t)),c=r||this.parentInjector;if(!o&&null==l.ngModule){const h=(s?c:this.parentInjector).get(Na,null);h&&(o=h)}const u=Yr(l.componentType??{}),d=vC(this._lContainer,u?.id??null),p=l.create(c,i,d?.firstChild??null,o);return this.insertImpl(p.hostView,a,bC(this._hostTNode,d)),p}insert(t,n){return this.insertImpl(t,n,!0)}insertImpl(t,n,r){const i=t._lView;if(function zS(e){return Oa(e[Fs])}(i)){const a=this.indexOf(t);if(-1!==a)this.detach(a);else{const l=i[Fs],c=new FQ(l,l[tl],l[Fs]);c.detach(c.indexOf(t))}}const o=this._adjustIndex(n),s=this._lContainer;return nT(s,i,o,r),t.attachToViewContainerRef(),Ab(Y6(s),o,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=OQ(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=ZE(this._lContainer,n);r&&(Yv(Y6(this._lContainer),n),$M(r[Ht],r))}detach(t){const n=this._adjustIndex(t,-1),r=ZE(this._lContainer,n);return r&&null!=Yv(Y6(this._lContainer),n)?new oT(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function OQ(e){return e[8]}function Y6(e){return e[8]||(e[8]=[])}function BQ(e,t){let n;const r=t[e.index];return Oa(r)?n=r:(n=tQ(r,t,null,e),t[e.index]=n,QM(t,n)),LQ(n,t,e,r),new FQ(n,e,t)}let LQ=function UQ(e,t,n,r){if(e[md])return;let i;i=8&n.type?mo(r):function dIe(e,t){const n=e[_r],r=n.createComment(""),i=Yl(t,e);return Tx(n,YM(n,i),r,function Iwe(e,t){return e.nextSibling(t)}(n,i),!1),r}(t,n),e[md]=i},X6=()=>!1;class K6{constructor(t){this.queryList=t,this.matches=null}clone(){return new K6(this.queryList)}setDirty(){this.queryList.setDirty()}}class Z6{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,i=[];for(let o=0;o<r;o++){const s=n.getByIndex(o);i.push(this.queries[s.indexInDeclarationView].clone())}return new Z6(i)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}finishViewCreation(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==n8(t,n).matches&&this.queries[n].setDirty()}}class zQ{constructor(t,n,r=null){this.flags=n,this.read=r,this.predicate="string"==typeof t?function vIe(e){return e.split(",").map(t=>t.trim())}(t):t}}class Q6{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const i=null!==n?n.length:0,o=this.getByIndex(r).embeddedTView(t,i);o&&(o.indexInDeclarationView=r,null!==n?n.push(o):n=[o])}return null!==n?new Q6(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class J6{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new J6(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1&~this.metadata.flags){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const o=r[i];this.matchTNodeWithReadOption(t,n,mIe(n,o)),this.matchTNodeWithReadOption(t,n,Rl(n,t,o,!1,!1))}else r===qm?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Rl(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===Ua||i===Ih||i===qm&&4&n.type)this.addMatch(n.index,-2);else{const o=Rl(n,t,i,!1,!1);null!==o&&this.addMatch(n.index,o)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function mIe(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function yIe(e,t,n,r){return-1===n?function gIe(e,t){return 11&e.type?Kb(e,t):4&e.type?t4(e,t):null}(t,e):-2===n?function bIe(e,t,n){return n===Ua?Kb(t,e):n===qm?t4(t,e):n===Ih?BQ(t,e):void 0}(e,t,r):Ch(e,e[Ht],n,t)}function VQ(e,t,n,r){const i=t[ef].queries[r];if(null===i.matches){const o=e.data,s=n.matches,a=[];for(let l=0;null!==s&&l<s.length;l+=2){const c=s[l];a.push(c<0?null:yIe(t,o[c],s[l+1],n.metadata.read))}i.matches=a}return i.matches}function e8(e,t,n,r){const i=e.queries.getByIndex(n),o=i.matches;if(null!==o){const s=VQ(e,t,i,n);for(let a=0;a<o.length;a+=2){const l=o[a];if(l>0)r.push(s[a/2]);else{const c=o[a+1],u=t[-l];for(let d=Eo;d<u.length;d++){const f=u[d];f[b0]===f[Fs]&&e8(f[Ht],f,c,r)}if(null!==u[Gc]){const d=u[Gc];for(let f=0;f<d.length;f++){const p=d[f];e8(p[Ht],p,c,r)}}}}}return r}function HQ(e,t,n){const r=new Zb(!(4&~n));return function Bwe(e,t,n,r){const i=rQ(t);i.push(n),e.firstCreatePass&&iQ(e).push(r,i.length-1)}(e,t,r,r.destroy),(t[ef]??=new Z6).queries.push(new K6(r))-1}function WQ(e,t,n){null===e.queries&&(e.queries=new Q6),e.queries.track(new J6(t,n))}function n8(e,t){return e.queries.getByIndex(t)}function $Q(e,t){const n=e[Ht],r=n8(n,t);return r.crossesNgTemplate?e8(n,e,t,[]):VQ(n,e,r,t)}function fJ(e){const t=e.inputConfig,n={};for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];Array.isArray(i)&&i[3]&&(n[r]=i[3])}e.inputTransforms=n}class Px{}class pJ{}class i8 extends Px{constructor(t,n,r){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new RQ(this);const i=Gl(t);this._bootstrapComponents=lf(i.bootstrap),this._r3Injector=zE(t,n,[{provide:Px,useValue:this},{provide:s4,useValue:this.componentFactoryResolver},...r],ya(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class o8 extends pJ{constructor(t){super(),this.moduleType=t}create(t){return new i8(this.moduleType,t,[])}}class hJ extends Px{constructor(t){super(),this.componentFactoryResolver=new RQ(this),this.instance=null;const n=new Kd([...t.providers,{provide:Px,useValue:this},{provide:s4,useValue:this.componentFactoryResolver}],t.parent||Dl(),t.debugName,new Set(["environment"]));this.injector=n,t.runEnvironmentInitializers&&n.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function f4(e,t,n=null){return new hJ({providers:e,parent:t,debugName:n,runEnvironmentInitializers:!0}).injector}let _C=(()=>{class e{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Ao(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);const n=this.taskId++;return this.pendingTasks.add(n),n}remove(n){this.pendingTasks.delete(n),0===this.pendingTasks.size&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function s8(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function za(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Ym(e,t,n,r,i,o,s,a){const l=_t(),c=ai(),u=e+Ar,d=c.firstCreatePass?function YIe(e,t,n,r,i,o,s,a,l){const c=t.consts,u=yC(t,e,4,s||null,Au(c,a));T6(t,n,u,Au(c,l)),gx(t,u);const d=u.tView=E6(2,u,r,i,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c,null);return null!==t.queries&&(t.queries.template(t,u),d.queries=t.queries.embeddedTView(u)),u}(u,c,l,t,n,r,i,o,s):c.data[u];rf(d,!1);const f=mJ(c,l,d,e);vn()&&XM(c,l,f,d),Fl(f,l);const p=tQ(f,l,f,d);return l[u]=p,QM(l,p),function jQ(e,t,n){return X6(e,t,n)}(p,d,l),kb(d)&&A6(c,l,d),null!=s&&I6(l,d,a),Ym}let mJ=function gJ(e,t,n,r){return Pc(!0),t[_r].createComment("")};function g8(e,t,n,r){const i=_t();return za(i,Iu(),t)&&(ai(),Gm(io(),i,e,t,n,r)),g8}function _4(e,t){return e<<17|t<<2}function a1(e){return e>>17&32767}function y8(e){return 2|e}function Rx(e){return(131068&e)>>2}function b8(e,t){return-131069&e|t<<2}function v8(e){return 1|e}function $J(e,t,n,r){const i=e[n+1],o=null===t;let s=r?a1(i):Rx(i),a=!1;for(;0!==s&&(!1===a||o);){const c=e[s+1];MEe(e[s],t)&&(a=!0,e[s+1]=r?v8(c):y8(c)),s=r?a1(c):Rx(c)}a&&(e[n+1]=r?y8(i):v8(i))}function MEe(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&Tm(e,t)>=0}function R0(e,t,n){const r=_t();return za(r,Iu(),t)&&function yd(e,t,n,r,i,o,s,a){const l=Yl(t,n);let u,c=t.inputs;!a&&null!=c&&(u=c[r])?(M6(e,n,u,r,i),Rm(t)&&function zwe(e,t){const n=Wc(t,e);16&n[Wn]||(n[Wn]|=64)}(n,t.index)):3&t.type&&(r=function Uwe(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),i=null!=s?s(i,t.value||"",r):i,o.setProperty(l,r,i))}(ai(),io(),r,e,t,r[_r],n,!1),R0}function x8(e,t,n,r,i){const s=i?"class":"style";M6(e,n,t.inputs[s],s,r)}function xT(e,t,n){return Eh(e,t,n,!1),xT}function _8(e,t){return Eh(e,t,null,!0),_8}function Eh(e,t,n,r){const i=_t(),o=ai(),s=function $f(e){const t=yr.lFrame,n=t.bindingIndex;return t.bindingIndex=t.bindingIndex+e,n}(2);o.firstUpdatePass&&function tee(e,t,n,r){const i=e.data;if(null===i[n+1]){const o=i[kl()],s=function eee(e,t){return t>=e.expandoStartIndex}(e,n);(function oee(e,t){return!!(e.flags&(t?8:16))})(o,r)&&null===t&&!s&&(t=!1),t=function zEe(e,t,n,r){const i=function WS(e){const t=yr.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e);let o=r?t.residualClasses:t.residualStyles;if(null===i)0===(r?t.classBindings:t.styleBindings)&&(n=_T(n=S8(null,e,t,n,r),t.attrs,r),o=null);else{const s=t.directiveStylingLast;if(-1===s||e[s]!==i)if(n=S8(i,e,t,n,r),null===o){let l=function VEe(e,t,n){const r=n?t.classBindings:t.styleBindings;if(0!==Rx(r))return e[a1(r)]}(e,t,r);void 0!==l&&Array.isArray(l)&&(l=S8(null,e,t,l[1],r),l=_T(l,t.attrs,r),function HEe(e,t,n,r){e[a1(n?t.classBindings:t.styleBindings)]=r}(e,t,r,l))}else o=function GEe(e,t,n){let r;const i=t.directiveEnd;for(let o=1+t.directiveStylingLast;o<i;o++)r=_T(r,e[o].hostAttrs,n);return _T(r,t.attrs,n)}(e,t,r)}return void 0!==o&&(r?t.residualClasses=o:t.residualStyles=o),n}(i,o,t,r),function PEe(e,t,n,r,i,o){let s=o?t.classBindings:t.styleBindings,a=a1(s),l=Rx(s);e[r]=n;let u,c=!1;if(Array.isArray(n)?(u=n[1],(null===u||Tm(n,u)>0)&&(c=!0)):u=n,i)if(0!==l){const f=a1(e[a+1]);e[r+1]=_4(f,a),0!==f&&(e[f+1]=b8(e[f+1],r)),e[a+1]=function TEe(e,t){return 131071&e|t<<17}(e[a+1],r)}else e[r+1]=_4(a,0),0!==a&&(e[a+1]=b8(e[a+1],r)),a=r;else e[r+1]=_4(l,0),0===a?a=r:e[l+1]=b8(e[l+1],r),l=r;c&&(e[r+1]=y8(e[r+1])),$J(e,u,r,!0),$J(e,u,r,!1),function kEe(e,t,n,r,i){const o=i?e.residualClasses:e.residualStyles;null!=o&&"string"==typeof t&&Tm(o,t)>=0&&(n[r+1]=v8(n[r+1]))}(t,u,e,r,o),s=_4(a,l),o?t.classBindings=s:t.styleBindings=s}(i,o,t,n,s,r)}}(o,e,s,r),t!==Gr&&za(i,s,t)&&function ree(e,t,n,r,i,o,s,a){if(!(3&t.type))return;const l=e.data,c=l[a+1],u=function DEe(e){return!(1&~e)}(c)?iee(l,t,n,i,Rx(c),s):void 0;S4(u)||(S4(o)||function EEe(e){return!(2&~e)}(c)&&(o=iee(l,null,n,i,a,s)),function Dwe(e,t,n,r,i){if(t)i?e.addClass(n,r):e.removeClass(n,r);else{let o=-1===r.indexOf("-")?void 0:r1.DashCase;null==i?e.removeStyle(n,r,o):("string"==typeof i&&i.endsWith("!important")&&(i=i.slice(0,-10),o|=r1.Important),e.setStyle(n,r,i,o))}}(r,s,Ob(kl(),n),i,o))}(o,o.data[kl()],i,i[_r],e,i[s+1]=function YEe(e,t){return null==e||""===e||("string"==typeof t?e+=t:"object"==typeof e&&(e=ya(t1(e)))),e}(t,n),r,s)}function S8(e,t,n,r,i){let o=null;const s=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<s&&(o=t[a],r=_T(r,o.hostAttrs,i),o!==e);)a++;return null!==e&&(n.directiveStylingLast=a),r}function _T(e,t,n){const r=n?1:2;let i=-1;if(null!==t)for(let o=0;o<t.length;o++){const s=t[o];"number"==typeof s?i=s:i===r&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),xu(e,s,!!n||t[++o]))}return void 0===e?null:e}function iee(e,t,n,r,i,o){const s=null===t;let a;for(;i>0;){const l=e[i],c=Array.isArray(l),u=c?l[1]:l,d=null===u;let f=n[i+1];f===Gr&&(f=d?xi:void 0);let p=d?Em(f,r):u===r?f:void 0;if(c&&!S4(p)&&(p=Em(l,r)),S4(p)&&(a=p,s))return a;const m=e[i+1];i=s?a1(m):Rx(m)}if(null!==t){let l=o?t.residualClasses:t.residualStyles;null!=l&&(a=Em(l,r))}return a}function S4(e){return void 0!==e}class oTe{destroy(t){}updateValue(t,n){}swap(t,n){const r=Math.min(t,n),i=Math.max(t,n),o=this.detach(i);if(i-r>1){const s=this.detach(r);this.attach(r,o),this.attach(i,s)}else this.attach(r,o)}move(t,n){this.attach(n,this.detach(t))}}function C8(e,t,n,r,i){return e===n&&Object.is(t,r)?1:Object.is(i(e,t),i(n,r))?-1:0}function w8(e,t,n,r){return!(void 0===t||!t.has(r)||(e.attach(n,t.get(r)),t.delete(r),0))}function see(e,t,n,r,i){if(w8(e,t,r,n(r,i)))e.updateValue(r,i);else{const o=e.create(r,i);e.attach(r,o)}}function aee(e,t,n,r){const i=new Set;for(let o=t;o<=n;o++)i.add(r(o,e.at(o)));return i}class lee{constructor(){this.kvMap=new Map,this._vMap=void 0}has(t){return this.kvMap.has(t)}delete(t){if(!this.has(t))return!1;const n=this.kvMap.get(t);return void 0!==this._vMap&&this._vMap.has(n)?(this.kvMap.set(t,this._vMap.get(n)),this._vMap.delete(n)):this.kvMap.delete(t),!0}get(t){return this.kvMap.get(t)}set(t,n){if(this.kvMap.has(t)){let r=this.kvMap.get(t);void 0===this._vMap&&(this._vMap=new Map);const i=this._vMap;for(;i.has(r);)r=i.get(r);i.set(r,n)}else this.kvMap.set(t,n)}forEach(t){for(let[n,r]of this.kvMap)if(t(r,n),void 0!==this._vMap){const i=this._vMap;for(;i.has(r);)r=i.get(r),t(r,n)}}}function ST(e,t,n){Wm("NgControlFlow");const r=_t(),i=Iu(),o=A8(r,Ar+e);if(za(r,i,t)){const a=hr(null);try{if(N6(o,0),-1!==t){const l=I8(r[Ht],Ar+t),c=vC(o,l.tView.ssrId);nT(o,tT(r,l,n,{dehydratedView:c}),0,bC(l,c))}}finally{hr(a)}}else{const a=sQ(o,0);void 0!==a&&(a[Fo]=n)}}class aTe{constructor(t,n,r){this.lContainer=t,this.$implicit=n,this.$index=r}get $count(){return this.lContainer.length-Eo}}function CT(e){return e}class cTe{constructor(t,n,r){this.hasEmptyBlock=t,this.trackByFn=n,this.liveCollection=r}}function wT(e,t,n,r,i,o,s,a,l,c,u,d,f){Wm("NgControlFlow");const p=void 0!==l,m=_t(),h=a?s.bind(m[Io][Fo]):s,g=new cTe(p,h);m[Ar+e]=g,Ym(e+1,t,n,r,i,o),p&&Ym(e+2,l,c,u,d,f)}class uTe extends oTe{constructor(t,n,r){super(),this.lContainer=t,this.hostLView=n,this.templateTNode=r,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-Eo}at(t){return this.getLView(t)[Fo].$implicit}attach(t,n){const r=n[Hc];this.needsIndexUpdate||=t!==this.length,nT(this.lContainer,n,t,bC(this.templateTNode,r))}detach(t){return this.needsIndexUpdate||=t!==this.length-1,function dTe(e,t){return ZE(e,t)}(this.lContainer,t)}create(t,n){const r=vC(this.lContainer,this.templateTNode.tView.ssrId);return tT(this.hostLView,this.templateTNode,new aTe(this.lContainer,n,t),{dehydratedView:r})}destroy(t){$M(t[Ht],t)}updateValue(t,n){this.getLView(t)[Fo].$implicit=n}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let t=0;t<this.length;t++)this.getLView(t)[Fo].$index=t}getLView(t){return function fTe(e,t){return sQ(e,t)}(this.lContainer,t)}}function AT(e){const t=hr(null),n=kl();try{const r=_t(),i=r[Ht],o=r[n];if(void 0===o.liveCollection){const a=n+1,l=A8(r,a),c=I8(i,a);o.liveCollection=new uTe(l,r,c)}else o.liveCollection.reset();const s=o.liveCollection;if(function sTe(e,t,n){let r,i,o=0,s=e.length-1;if(Array.isArray(t)){let a=t.length-1;for(;o<=s&&o<=a;){const l=e.at(o),c=t[o],u=C8(o,l,o,c,n);if(0!==u){u<0&&e.updateValue(o,c),o++;continue}const d=e.at(s),f=t[a],p=C8(s,d,a,f,n);if(0!==p){p<0&&e.updateValue(s,f),s--,a--;continue}const m=n(o,l),h=n(s,d),g=n(o,c);if(Object.is(g,h)){const y=n(a,f);Object.is(y,m)?(e.swap(o,s),e.updateValue(s,f),a--,s--):e.move(s,o),e.updateValue(o,c),o++}else if(r??=new lee,i??=aee(e,o,s,n),w8(e,r,o,g))e.updateValue(o,c),o++,s++;else if(i.has(g))r.set(m,e.detach(o)),s--;else{const y=e.create(o,t[o]);e.attach(o,y),o++,s++}}for(;o<=a;)see(e,r,n,o,t[o]),o++}else if(null!=t){const a=t[Symbol.iterator]();let l=a.next();for(;!l.done&&o<=s;){const c=e.at(o),u=l.value,d=C8(o,c,o,u,n);if(0!==d)d<0&&e.updateValue(o,u),o++,l=a.next();else{r??=new lee,i??=aee(e,o,s,n);const f=n(o,u);if(w8(e,r,o,f))e.updateValue(o,u),o++,s++,l=a.next();else if(i.has(f)){const p=n(o,c);r.set(p,e.detach(o)),s--}else e.attach(o,e.create(o,u)),o++,s++,l=a.next()}}for(;!l.done;)see(e,r,n,e.length,l.value),l=a.next()}for(;o<=s;)e.destroy(e.detach(s--));r?.forEach(a=>{e.destroy(a)})}(s,e,o.trackByFn),s.updateIndexes(),o.hasEmptyBlock){const a=Iu(),l=0===s.length;if(za(r,a,l)){const c=n+2,u=A8(r,c);if(l){const d=I8(i,c),f=vC(u,d.tView.ssrId);nT(u,tT(r,d,void 0,{dehydratedView:f}),0,bC(d,f))}else N6(u,0)}}}finally{hr(t)}}function A8(e,t){return e[t]}function I8(e,t){return Bb(e,t)}function br(e,t,n,r){const i=_t(),o=ai(),s=Ar+e,a=i[_r],l=o.firstCreatePass?function pTe(e,t,n,r,i,o){const s=t.consts,l=yC(t,e,2,r,Au(s,i));return T6(t,n,l,Au(s,o)),null!==l.attrs&&c4(l,l.attrs,!1),null!==l.mergedAttrs&&c4(l,l.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,l),l}(s,o,i,t,n,r):o.data[s],c=cee(o,i,l,a,t,e);i[s]=c;const u=kb(l);return rf(l,!0),GZ(a,c,l),!function gT(e){return!(32&~e.flags)}(l)&&vn()&&XM(o,i,c,l),0===function DL(){return yr.lFrame.elementDepthCount}()&&Fl(c,i),function PL(){yr.lFrame.elementDepthCount++}(),u&&(A6(o,i,l),w6(o,l,i)),null!==r&&I6(i,l),br}function Sr(){let e=ro();SE()?Xl():(e=e.parent,rf(e,!1));const t=e;(function qS(e){return yr.skipHydrationRootTNode===e})(t)&&function Ub(){yr.skipHydrationRootTNode=null}(),function vM(){yr.lFrame.elementDepthCount--}();const n=ai();return n.firstCreatePass&&(gx(n,e),kS(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Bm(e){return!!(8&e.flags)}(t)&&x8(n,t,_t(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function wM(e){return!!(16&e.flags)}(t)&&x8(n,t,_t(),t.stylesWithoutHost,!1),Sr}function js(e,t,n,r){return br(e,t,n,r),Sr(),js}let cee=(e,t,n,r,i,o)=>(Pc(!0),WM(r,i,function Ml(){return yr.lFrame.currentNamespace}()));function E8(e,t,n){const r=_t(),i=ai(),o=e+Ar,s=i.firstCreatePass?function gTe(e,t,n,r,i){const o=t.consts,s=Au(o,r),a=yC(t,e,8,"ng-container",s);return null!==s&&c4(a,s,!0),T6(t,n,a,Au(o,i)),null!==t.queries&&t.queries.elementStart(t,a),a}(o,i,r,t,n):i.data[o];rf(s,!0);const a=uee(i,r,s,e);return r[o]=a,vn()&&XM(i,r,a,s),Fl(a,r),kb(s)&&(A6(i,r,s),w6(i,s,r)),null!=n&&I6(r,s),E8}function T8(){let e=ro();const t=ai();return SE()?Xl():(e=e.parent,rf(e,!1)),t.firstCreatePass&&(gx(t,e),kS(e)&&t.queries.elementEnd(e)),T8}function D8(e,t,n){return E8(e,t,n),T8(),D8}let uee=(e,t,n,r)=>(Pc(!0),y6(t[_r],""));function C4(){return _t()}const jC="en-US";let mee=jC;function Fx(e,t,n,r){const i=_t(),o=ai(),s=ro();return function M8(e,t,n,r,i,o,s){const a=kb(r),c=e.firstCreatePass&&iQ(e),u=t[Fo],d=rQ(t);let f=!0;if(3&r.type||s){const h=Yl(r,t),g=s?s(h):h,y=d.length,v=s?_=>s(mo(_[r.index])):r.index;let x=null;if(!s&&a&&(x=function y3e(e,t,n,r){const i=e.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const s=i[o];if(s===n&&i[o+1]===r){const a=t[bh],l=i[o+2];return a.length>l?a[l]:null}"string"==typeof s&&(o+=2)}return null}(e,t,i,r.index)),null!==x)(x.__ngLastListenerFn__||x).__ngNextListenerFn__=o,x.__ngLastListenerFn__=o,f=!1;else{o=Hee(r,t,u,o,!1);const _=n.listen(g,i,o);d.push(o,_),c&&c.push(i,v,y,y+1)}}else o=Hee(r,t,u,o,!1);const p=r.outputs;let m;if(f&&null!==p&&(m=p[i])){const h=m.length;if(h)for(let g=0;g<h;g+=2){const w=t[m[g]][m[g+1]].subscribe(o),A=d.length;d.push(o,w),c&&c.push(i,r.index,A,-(A+1))}}}(o,i,i[_r],s,e,t,r),Fx}function Vee(e,t,n,r){const i=hr(null);try{return gd(6,t,n),!1!==n(r)}catch(o){return JM(e,o),!1}finally{gd(7,t,n),hr(i)}}function Hee(e,t,n,r,i){return function o(s){if(s===Function)return r;iT(e.componentOffset>-1?Wc(e.index,t):t);let l=Vee(t,n,r,s),c=o.__ngNextListenerFn__;for(;c;)l=Vee(t,n,c,s)&&l,c=c.__ngNextListenerFn__;return i&&!1===l&&s.preventDefault(),l}}function Pu(e=1){return function PE(e){return(yr.lFrame.contextLView=function vE(e,t){for(;e>0;)t=t[vh],e--;return t}(e,yr.lFrame.contextLView))[Fo]}(e)}function N8(e,t,n,r){!function qQ(e,t,n,r){const i=ai();if(i.firstCreatePass){const o=ro();WQ(i,new zQ(t,n,r),o.index),function xIe(e,t){const n=e.contentQueries||(e.contentQueries=[]);t!==(n.length?n[n.length-1]:-1)&&n.push(e.queries.length-1,t)}(i,e),!(2&~n)&&(i.staticContentQueries=!0)}return HQ(i,_t(),n)}(e,t,n,r)}function F8(e,t,n){!function GQ(e,t,n){const r=ai();return r.firstCreatePass&&(WQ(r,new zQ(e,t,n),-1),!(2&~t)&&(r.staticViewQueries=!0)),HQ(r,_t(),t)}(e,t,n)}function MT(e){const t=_t(),n=ai(),r=px();w0(r+1);const i=n8(n,r);if(e.dirty&&function dx(e){return!(4&~e[Wn])}(t)===!(2&~i.metadata.flags)){if(null===i.matches)e.reset([]);else{const o=$Q(t,r);e.reset(o,nC),e.notifyOnChanges()}return!0}return!1}function RT(){return function t8(e,t){return e[ef].queries[t].queryList}(_t(),px())}function Li(e,t=""){const n=_t(),r=ai(),i=e+Ar,o=r.firstCreatePass?yC(r,i,1,t,null):r.data[i],s=lte(r,n,o,t,e);n[i]=s,vn()&&XM(r,n,s,o),rf(o,!1)}let lte=(e,t,n,r,i)=>(Pc(!0),function g6(e,t){return e.createText(t)}(t[_r],r));function T4(e){return UC("",e,""),T4}function UC(e,t,n){const r=_t(),i=function DC(e,t,n,r){return za(e,Iu(),n)?t+Tr(n)+r:Gr}(r,e,t,n);return i!==Gr&&function M0(e,t,n){const r=Ob(t,e);!function PZ(e,t,n){e.setValue(t,n)}(e[_r],r,n)}(r,kl(),i),UC}function O8(e,t,n,r,i){if(e=Zn(e),Array.isArray(e))for(let o=0;o<e.length;o++)O8(e[o],t,n,r,i);else{const o=ai(),s=_t(),a=ro();let l=fd(e)?e:Zn(e.provide);const c=dE(e),u=1048575&a.providerIndexes,d=a.directiveStart,f=a.providerIndexes>>20;if(fd(e)||!e.multi){const p=new I0(c,i,On),m=L8(l,t,i?u:u+f,d);-1===m?(Lm(oa(a,s),o,l),B8(o,e,t.length),t.push(l),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),n.push(p),s.push(p)):(n[m]=p,s[m]=p)}else{const p=L8(l,t,u+f,d),m=L8(l,t,u,u+f),g=m>=0&&n[m];if(i&&!g||!i&&!(p>=0&&n[p])){Lm(oa(a,s),o,l);const y=function z3e(e,t,n,r,i){const o=new I0(e,n,On);return o.multi=[],o.index=t,o.componentProviders=0,vte(o,i,r&&!n),o}(i?U3e:j3e,n.length,i,r,c);!i&&g&&(n[m].providerFactory=y),B8(o,e,t.length,0),t.push(l),a.directiveStart++,a.directiveEnd++,i&&(a.providerIndexes+=1048576),n.push(y),s.push(y)}else B8(o,e,p>-1?p:m,vte(n[i?m:p],c,!i&&r));!i&&r&&g&&n[m].componentProviders++}}}function B8(e,t,n,r){const i=fd(t),o=function Pm(e){return!!e.useClass}(t);if(i||o){const l=(o?Zn(t.useClass):t).prototype.ngOnDestroy;if(l){const c=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){const u=c.indexOf(n);-1===u?c.push(n,[r,l]):c[u+1].push(r,l)}else c.push(n,l)}}}function vte(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function L8(e,t,n,r){for(let i=n;i<r;i++)if(t[i]===e)return i;return-1}function j3e(e,t,n,r){return j8(this.multi,[])}function U3e(e,t,n,r){const i=this.multi;let o;if(this.providerFactory){const s=this.providerFactory.componentProviders,a=Ch(n,n[Ht],this.providerFactory.index,r);o=a.slice(0,s),j8(i,o);for(let l=s;l<a.length;l++)o.push(a[l])}else o=[],j8(i,o);return o}function j8(e,t){for(let n=0;n<e.length;n++)t.push((0,e[n])());return t}function NT(e,t=[]){return n=>{n.providersResolver=(r,i)=>function L3e(e,t,n){const r=ai();if(r.firstCreatePass){const i=qc(e);O8(n,r.data,r.blueprint,i,!0),O8(t,r.data,r.blueprint,i,!1)}}(r,i?i(e):e,t)}}let V3e=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n)){const r=Xd(0,n.type),i=r.length>0?f4([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n,i)}return this.cachedInjectors.get(n)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}static#e=this.\u0275prov=gn({token:e,providedIn:"environment",factory:()=>new e(Rn(Na))})}return e})();function Dh(e){Wm("NgStandalone"),e.getStandaloneInjector=t=>t.get(V3e).getOrCreateStandaloneInjector(e)}function Ste(e,t,n,r,i,o){const s=t+n;return za(e,s,i)?function $m(e,t,n){return e[t]=n}(e,s+1,o?r.call(o,i):r(i)):function FT(e,t){const n=e[t];return n===Gr?void 0:n}(e,s+1)}function Ox(e,t){const n=ai();let r;const i=e+Ar;n.firstCreatePass?(r=function eDe(e,t){if(t)for(let n=t.length-1;n>=0;n--){const r=t[n];if(e===r.name)return r}}(t,n.pipeRegistry),n.data[i]=r,r.onDestroy&&(n.destroyHooks??=[]).push(i,r.onDestroy)):r=n.data[i];const o=r.factory||(r.factory=f0(r.type)),a=Uc(On);try{const l=yx(!1),c=o();return yx(l),function w3e(e,t,n,r){n>=e.data.length&&(e.data[n]=null,e.blueprint[n]=null),t[n]=r}(n,_t(),i,c),c}finally{Uc(a)}}function Bx(e,t,n){const r=e+Ar,i=_t(),o=function S0(e,t){return e[t]}(i,r);return function OT(e,t){return e[Ht].data[t].pure}(i,r)?Ste(i,Kl(),t,o.transform,n,o):o.transform(n)}let Vte=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const $te=new jn("");function N4(e){return!!e&&"function"==typeof e.then}function Yte(e){return!!e&&"function"==typeof e.subscribe}const Y8=new jn("");let X8=(()=>{class e{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((n,r)=>{this.resolve=n,this.reject=r}),this.appInits=qt(Y8,{optional:!0})??[]}runInitializers(){if(this.initialized)return;const n=[];for(const i of this.appInits){const o=i();if(N4(o))n.push(o);else if(Yte(o)){const s=new Promise((a,l)=>{o.subscribe({complete:a,error:l})});n.push(s)}}const r=()=>{this.done=!0,this.resolve()};Promise.all(n).then(()=>{r()}).catch(i=>{this.reject(i)}),0===n.length&&r(),this.initialized=!0}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const F4=new jn("");let l1=(()=>{class e{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=qt(Hm),this.afterRenderEffectManager=qt(uT),this.externalTestViews=new Set,this.beforeRender=new si,this.afterTick=new si,this.componentTypes=[],this.components=[],this.isStable=qt(_C).hasPendingTasks.pipe(hn(n=>!n)),this._injector=qt(Na)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const i=n instanceof vQ;if(!this._injector.get(X8).done)throw!i&&function fh(e){const t=Yr(e)||ra(e)||Tl(e);return null!==t&&t.standalone}(n),new Xt(405,!1);let s;s=i?n:this._injector.get(s4).resolveComponentFactory(n),this.componentTypes.push(s.componentType);const a=function JDe(e){return e.isBoundToModule}(s)?void 0:this._injector.get(Px),c=s.create(Jl.NULL,[],r||s.selector,a),u=c.location.nativeElement,d=c.injector.get($te,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),O4(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this._tick(!0)}_tick(n){if(this._runningTick)throw new Xt(101,!1);const r=hr(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(n)}catch(i){this.internalErrorHandler(i)}finally{this.afterTick.next(),this._runningTick=!1,hr(r)}}detectChangesInAttachedViews(n){let r=0;const i=this.afterRenderEffectManager;for(;;){if(r===cQ)throw new Xt(103,!1);if(n){const o=0===r;this.beforeRender.next(o);for(let{_lView:s,notifyErrorHandler:a}of this._views)tPe(s,o,a)}if(r++,i.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:o})=>K8(o))&&(i.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:o})=>K8(o))))break}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;O4(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(F4,[]);[...this._bootstrapListeners,...r].forEach(i=>i(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>O4(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Xt(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function O4(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function tPe(e,t,n){!t&&!K8(e)||function nPe(e,t,n){let r;n?(r=0,e[Wn]|=1024):r=64&e[Wn]?0:1,e4(e,t,r)}(e,n,t)}function K8(e){return VS(e)}class rPe{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let Qte=(()=>{class e{compileModuleSync(n){return new o8(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),o=lf(Gl(n).declarations).reduce((s,a)=>{const l=Yr(a);return l&&s.push(new pT(l)),s},[]);return new rPe(r,o)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),sPe=(()=>{class e{constructor(){this.zone=qt(To),this.applicationRef=qt(l1)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function ene(e){return[{provide:To,useFactory:e},{provide:ld,multi:!0,useFactory:()=>{const t=qt(sPe,{optional:!0});return()=>t.initialize()}},{provide:ld,multi:!0,useFactory:()=>{const t=qt(cPe);return()=>{t.initialize()}}},{provide:Hm,useFactory:aPe}]}function aPe(){const e=qt(To),t=qt(af);return n=>e.runOutsideAngular(()=>t.handleError(n))}function lPe(e){return Vc([[],ene(()=>new To(function tne(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:e?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:e?.runCoalescing??!1}}(e)))])}let cPe=(()=>{class e{constructor(){this.subscription=new Il,this.initialized=!1,this.zone=qt(To),this.pendingTasks=qt(_C)}initialize(){if(this.initialized)return;this.initialized=!0;let n=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(n=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{To.assertNotInAngularZone(),queueMicrotask(()=>{null!==n&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(n),n=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{To.assertInAngularZone(),n??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const N0=new jn("",{providedIn:"root",factory:()=>qt(N0,gi.Optional|gi.SkipSelf)||function uPe(){return typeof $localize<"u"&&$localize.locale||jC}()}),Z8=new jn("");let c1=null;let L4=(()=>{class e{static#e=this.__NG_ELEMENT_ID__=gPe}return e})();function gPe(e){return function yPe(e,t,n){if(Rm(e)&&!n){const r=Wc(e.index,t);return new oT(r,r)}return 47&e.type?new oT(t[Io],t):null}(ro(),_t(),!(16&~e))}class pne{constructor(){}supports(t){return t instanceof Map||s8(t)}create(){return new APe}}class APe{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let n;for(n=this._mapHead;null!==n;n=n._next)t(n)}forEachPreviousItem(t){let n;for(n=this._previousMapHead;null!==n;n=n._nextPrevious)t(n)}forEachChangedItem(t){let n;for(n=this._changesHead;null!==n;n=n._nextChanged)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}diff(t){if(t){if(!(t instanceof Map||s8(t)))throw new Xt(900,!1)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let n=this._mapHead;if(this._appendAfter=null,this._forEach(t,(r,i)=>{if(n&&n.key===i)this._maybeAddToChanges(n,r),this._appendAfter=n,n=n._next;else{const o=this._getOrCreateRecordForKey(i,r);n=this._insertBeforeOrAppend(n,o)}}),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(let r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,n){if(t){const r=t._prev;return n._next=t,n._prev=r,t._prev=n,r&&(r._next=n),t===this._mapHead&&(this._mapHead=n),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=n,n._prev=this._appendAfter):this._mapHead=n,this._appendAfter=n,null}_getOrCreateRecordForKey(t,n){if(this._records.has(t)){const i=this._records.get(t);this._maybeAddToChanges(i,n);const o=i._prev,s=i._next;return o&&(o._next=s),s&&(s._prev=o),i._next=null,i._prev=null,i}const r=new IPe(t);return this._records.set(t,r),r.currentValue=n,this._addToAdditions(r),r}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,n){Object.is(n,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=n,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,n){t instanceof Map?t.forEach(n):Object.keys(t).forEach(r=>n(t[r],r))}}class IPe{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function mne(){return new z4([new pne])}let z4=(()=>{class e{static#e=this.\u0275prov=gn({token:e,providedIn:"root",factory:mne});constructor(n){this.factories=n}static create(n,r){if(r){const i=r.factories.slice();n=n.concat(i)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||mne()),deps:[[e,new fS,new $v]]}}find(n){const r=this.factories.find(i=>i.supports(n));if(r)return r;throw new Xt(901,!1)}}return e})();function HPe(e){try{const{rootComponent:t,appProviders:n,platformProviders:r}=e,i=function mPe(e=[]){if(c1)return c1;const t=function ine(e=[],t){return Jl.create({name:t,providers:[{provide:No,useValue:"platform"},{provide:Z8,useValue:new Set([()=>c1=null])},...e]})}(e);return c1=t,function Xte(){!function VI(e){hb=e}(()=>{throw new Xt(600,!1)})}(),function one(e){e.get(QK,null)?.forEach(n=>n())}(t),t}(r),o=[lPe(),...n||[]],a=new hJ({providers:o,parent:i,debugName:"",runEnvironmentInitializers:!1}).injector,l=a.get(To);return l.run(()=>{a.resolveInjectorInitializers();const c=a.get(af,null);let u;l.runOutsideAngular(()=>{u=l.onError.subscribe({next:p=>{c.handleError(p)}})});const d=()=>a.destroy(),f=i.get(Z8);return f.add(d),a.onDestroy(()=>{u.unsubscribe(),f.delete(d)}),function Kte(e,t,n){try{const r=n();return N4(r)?r.catch(i=>{throw t.runOutsideAngular(()=>e.handleError(i)),i}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(c,l,()=>{const p=a.get(X8);return p.runInitializers(),p.donePromise.then(()=>{!function gee(e){"string"==typeof e&&(mee=e.toLowerCase().replace(/_/g,"-"))}(a.get(N0,jC)||jC);const h=a.get(l1);return void 0!==t&&h.bootstrap(t),h})})})}catch(t){return Promise.reject(t)}}function sj(e){return"boolean"==typeof e?e:null!=e&&"false"!==e}function Bne(e){const t=hr(null);try{return e()}finally{hr(t)}}let Lne=null;function GC(){return Lne}class fke{}const ep=new jn("");let aj=(()=>{class e{historyGo(n){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>qt(hke),providedIn:"platform"})}return e})();const pke=new jn("");let hke=(()=>{class e extends aj{constructor(){super(),this._doc=qt(ep),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return GC().getBaseHref(this._doc)}onPopState(n){const r=GC().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=GC().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(n){this._location.pathname=n}pushState(n,r,i){this._history.pushState(n,r,i)}replaceState(n,r,i){this._history.replaceState(n,r,i)}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>new e,providedIn:"platform"})}return e})();function lj(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function jne(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function F0(e){return e&&"?"!==e[0]?"?"+e:e}let jx=(()=>{class e{historyGo(n){throw new Error("")}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>qt(zne),providedIn:"root"})}return e})();const Une=new jn("");let zne=(()=>{class e extends jx{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??qt(ep).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return lj(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+F0(this._platformLocation.search),i=this._platformLocation.hash;return i&&n?`${r}${i}`:r}pushState(n,r,i,o){const s=this.prepareExternalUrl(i+F0(o));this._platformLocation.pushState(n,r,s)}replaceState(n,r,i,o){const s=this.prepareExternalUrl(i+F0(o));this._platformLocation.replaceState(n,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(aj),Rn(Une,8))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),mke=(()=>{class e extends jx{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){const r=this._platformLocation.hash??"#";return r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=lj(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,i,o){let s=this.prepareExternalUrl(i+F0(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.pushState(n,r,s)}replaceState(n,r,i,o){let s=this.prepareExternalUrl(i+F0(o));0==s.length&&(s=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(aj),Rn(Une,8))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})(),qC=(()=>{class e{constructor(n){this._subject=new rl,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function bke(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(jne(Vne(r))),this._locationStrategy.onPopState(i=>{this._subject.emit({url:this.path(!0),pop:!0,state:i.state,type:i.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+F0(r))}normalize(n){return e.stripTrailingSlash(function yke(e,t){if(!e||!t.startsWith(e))return t;const n=t.substring(e.length);return""===n||["/",";","?","#"].includes(n[0])?n:t}(this._basePath,Vne(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",i=null){this._locationStrategy.pushState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+F0(r)),i)}replaceState(n,r="",i=null){this._locationStrategy.replaceState(i,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+F0(r)),i)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(i=>i(n,r))}subscribe(n,r,i){return this._subject.subscribe({next:n,error:r,complete:i})}static#e=this.normalizeQueryParams=F0;static#t=this.joinWithSlash=lj;static#n=this.stripTrailingSlash=jne;static#r=this.\u0275fac=function(r){return new(r||e)(Rn(jx))};static#i=this.\u0275prov=gn({token:e,factory:()=>function gke(){return new qC(Rn(jx))}(),providedIn:"root"})}return e})();function Vne(e){return e.replace(/\/index.html$/,"")}let nre=(()=>{class e{constructor(n){this._viewContainerRef=n,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(n){if(this._shouldRecreateView(n)){const r=this._viewContainerRef;if(this._viewRef&&r.remove(r.indexOf(this._viewRef)),!this.ngTemplateOutlet)return void(this._viewRef=null);const i=this._createContextForwardProxy();this._viewRef=r.createEmbeddedView(this.ngTemplateOutlet,i,{injector:this.ngTemplateOutletInjector??void 0})}}_shouldRecreateView(n){return!!n.ngTemplateOutlet||!!n.ngTemplateOutletInjector}_createContextForwardProxy(){return new Proxy({},{set:(n,r,i)=>!!this.ngTemplateOutletContext&&Reflect.set(this.ngTemplateOutletContext,r,i),get:(n,r,i)=>{if(this.ngTemplateOutletContext)return Reflect.get(this.ngTemplateOutletContext,r,i)}})}static#e=this.\u0275fac=function(r){return new(r||e)(On(Ih))};static#t=this.\u0275dir=Ja({type:e,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Oo]})}return e})();class hMe{createSubscription(t,n){return Bne(()=>t.subscribe({next:n,error:r=>{throw r}}))}dispose(t){Bne(()=>t.unsubscribe())}}class mMe{createSubscription(t,n){return t.then(n,r=>{throw r})}dispose(t){}}const gMe=new mMe,yMe=new hMe;let iR=(()=>{class e{constructor(n){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=n}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(n){if(!this._obj){if(n)try{this.markForCheckOnValueUpdate=!1,this._subscribe(n)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return n!==this._obj?(this._dispose(),this.transform(n)):this._latestValue}_subscribe(n){this._obj=n,this._strategy=this._selectStrategy(n),this._subscription=this._strategy.createSubscription(n,r=>this._updateLatestValue(n,r))}_selectStrategy(n){if(N4(n))return gMe;if(Yte(n))return yMe;throw function kh(e,t){return new Xt(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(n,r){n===this._obj&&(this._latestValue=r,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}static#e=this.\u0275fac=function(r){return new(r||e)(On(L4,16))};static#t=this.\u0275pipe=Hl({name:"async",type:e,pure:!1,standalone:!0})}return e})(),_j=(()=>{class e{transform(n){return JSON.stringify(n,null,2)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275pipe=Hl({name:"json",type:e,pure:!1,standalone:!0})}return e})(),rre=(()=>{class e{constructor(n){this.differs=n,this.keyValues=[],this.compareFn=ire}transform(n,r=ire){if(!n||!(n instanceof Map)&&"object"!=typeof n)return null;this.differ??=this.differs.find(n).create();const i=this.differ.diff(n),o=r!==this.compareFn;return i&&(this.keyValues=[],i.forEachItem(s=>{this.keyValues.push(function DMe(e,t){return{key:e,value:t}}(s.key,s.currentValue))})),(i||o)&&(this.keyValues.sort(r),this.compareFn=r),this.keyValues}static#e=this.\u0275fac=function(r){return new(r||e)(On(z4,16))};static#t=this.\u0275pipe=Hl({name:"keyvalue",type:e,pure:!1,standalone:!0})}return e})();function ire(e,t){const n=e.key,r=t.key;if(n===r)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(null===n)return 1;if(null===r)return-1;if("string"==typeof n&&"string"==typeof r)return n<r?-1:1;if("number"==typeof n&&"number"==typeof r)return n-r;if("boolean"==typeof n&&"boolean"==typeof r)return n<r?-1:1;const i=String(n),o=String(r);return i==o?0:i<o?-1:1}let L0=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275mod=g0({type:e});static#n=this.\u0275inj=c0({})}return e})();function sre(e){return"server"===e}let BMe=(()=>{class e{static#e=this.\u0275prov=gn({token:e,providedIn:"root",factory:()=>function OMe(e){return"browser"===e}(qt(Ex))?new LMe(qt(ep),window):new UMe})}return e})();class LMe{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return[this.window.scrollX,this.window.scrollY]}scrollToPosition(t){this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){const n=function jMe(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&"function"==typeof e.body.attachShadow){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const o=i.shadowRoot;if(o){const s=o.getElementById(t)||o.querySelector(`[name="${t}"]`);if(s)return s}i=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){this.window.history.scrollRestoration=t}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,i=n.top+this.window.pageYOffset,o=this.offset();this.window.scrollTo(r-o[0],i-o[1])}}class UMe{setOffset(t){}getScrollPosition(){return[0,0]}scrollToPosition(t){}scrollToAnchor(t){}setHistoryScrollRestoration(t){}}class m4e extends fke{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Aj extends m4e{static makeCurrent(){!function dke(e){Lne??=e}(new Aj)}onAndCancel(t,n,r){return t.addEventListener(n,r),()=>{t.removeEventListener(n,r)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function g4e(){return GT=GT||document.querySelector("base"),GT?GT.getAttribute("href"):null}();return null==n?null:function y4e(e){return new URL(e,document.baseURI).pathname}(n)}resetBaseElement(){GT=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function nMe(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[i,o]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(i.trim()===t)return decodeURIComponent(o)}return null}(document.cookie,t)}}let GT=null,v4e=(()=>{class e{build(){return new XMLHttpRequest}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();const Ij=new jn("");let mre=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(i=>{i.manager=this}),this._plugins=n.slice().reverse()}addEventListener(n,r,i){return this._findPluginFor(r).addEventListener(n,r,i)}getZone(){return this._zone}_findPluginFor(n){let r=this._eventNameToPlugin.get(n);if(r)return r;if(r=this._plugins.find(o=>o.supports(n)),!r)throw new Xt(5101,!1);return this._eventNameToPlugin.set(n,r),r}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(Ij),Rn(To))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();class gre{constructor(t){this._doc=t}}const Ej="ng-app-id";let yre=(()=>{class e{constructor(n,r,i,o={}){this.doc=n,this.appId=r,this.nonce=i,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=sre(o),this.resetHostNodes()}addStyles(n){for(const r of n)1===this.changeUsageCount(r,1)&&this.onStyleAdded(r)}removeStyles(n){for(const r of n)this.changeUsageCount(r,-1)<=0&&this.onStyleRemoved(r)}ngOnDestroy(){const n=this.styleNodesInDOM;n&&(n.forEach(r=>r.remove()),n.clear());for(const r of this.getAllStyles())this.onStyleRemoved(r);this.resetHostNodes()}addHost(n){this.hostNodes.add(n);for(const r of this.getAllStyles())this.addStyleToHost(n,r)}removeHost(n){this.hostNodes.delete(n)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(n){for(const r of this.hostNodes)this.addStyleToHost(r,n)}onStyleRemoved(n){const r=this.styleRef;r.get(n)?.elements?.forEach(i=>i.remove()),r.delete(n)}collectServerRenderedStyles(){const n=this.doc.head?.querySelectorAll(`style[${Ej}="${this.appId}"]`);if(n?.length){const r=new Map;return n.forEach(i=>{null!=i.textContent&&r.set(i.textContent,i)}),r}return null}changeUsageCount(n,r){const i=this.styleRef;if(i.has(n)){const o=i.get(n);return o.usage+=r,o.usage}return i.set(n,{usage:r,elements:[]}),r}getStyleElement(n,r){const i=this.styleNodesInDOM,o=i?.get(r);if(o?.parentNode===n)return i.delete(r),o.removeAttribute(Ej),o;{const s=this.doc.createElement("style");return this.nonce&&s.setAttribute("nonce",this.nonce),s.textContent=r,this.platformIsServer&&s.setAttribute(Ej,this.appId),n.appendChild(s),s}}addStyleToHost(n,r){const i=this.getStyleElement(n,r),o=this.styleRef,s=o.get(r)?.elements;s?s.push(i):o.set(r,{elements:[i],usage:1})}resetHostNodes(){const n=this.hostNodes;n.clear(),n.add(this.doc.head)}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(ep),Rn($L),Rn(JK,8),Rn(Ex))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();const Tj={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Dj=/%COMP%/g,C4e=new jn("",{providedIn:"root",factory:()=>!0});function vre(e,t){return t.map(n=>n.replace(Dj,e))}let xre=(()=>{class e{constructor(n,r,i,o,s,a,l,c=null){this.eventManager=n,this.sharedStylesHost=r,this.appId=i,this.removeStylesOnCompDestroy=o,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.rendererByCompId=new Map,this.platformIsServer=sre(a),this.defaultRenderer=new Pj(n,s,l,this.platformIsServer)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===cd.ShadowDom&&(r={...r,encapsulation:cd.Emulated});const i=this.getOrCreateRenderer(n,r);return i instanceof Sre?i.applyToHost(n):i instanceof kj&&i.applyStyles(),i}getOrCreateRenderer(n,r){const i=this.rendererByCompId;let o=i.get(r.id);if(!o){const s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(r.encapsulation){case cd.Emulated:o=new Sre(l,c,r,this.appId,u,s,a,d);break;case cd.ShadowDom:return new E4e(l,c,n,r,s,a,this.nonce,d);default:o=new kj(l,c,r,u,s,a,d)}i.set(r.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(mre),Rn(yre),Rn($L),Rn(C4e),Rn(ep),Rn(Ex),Rn(To),Rn(JK))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();class Pj{constructor(t,n,r,i){this.eventManager=t,this.doc=n,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(t,n){return n?this.doc.createElementNS(Tj[n]||n,t):this.doc.createElement(t)}createComment(t){return this.doc.createComment(t)}createText(t){return this.doc.createTextNode(t)}appendChild(t,n){(_re(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(_re(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?this.doc.querySelector(t):t;if(!r)throw new Xt(-5104,!1);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,i){if(i){n=i+":"+n;const o=Tj[i];o?t.setAttributeNS(o,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const i=Tj[r];i?t.removeAttributeNS(i,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,i){i&(r1.DashCase|r1.Important)?t.style.setProperty(n,r,i&r1.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&r1.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){null!=t&&(t[n]=r)}setValue(t,n){t.nodeValue=n}listen(t,n,r){if("string"==typeof t&&!(t=GC().getGlobalEventTarget(this.doc,t)))throw new Error(`Unsupported event target ${t} for event ${n}`);return this.eventManager.addEventListener(t,n,this.decoratePreventDefault(r))}decoratePreventDefault(t){return n=>{if("__ngUnwrap__"===n)return t;!1===(this.platformIsServer?this.ngZone.runGuarded(()=>t(n)):t(n))&&n.preventDefault()}}}function _re(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class E4e extends Pj{constructor(t,n,r,i,o,s,a,l){super(t,o,s,l),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=vre(i.id,i.styles);for(const u of c){const d=document.createElement("style");a&&d.setAttribute("nonce",a),d.textContent=u,this.shadowRoot.appendChild(d)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class kj extends Pj{constructor(t,n,r,i,o,s,a,l){super(t,o,s,a),this.sharedStylesHost=n,this.removeStylesOnCompDestroy=i,this.styles=l?vre(l,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}}class Sre extends kj{constructor(t,n,r,i,o,s,a,l){const c=i+"-"+r.id;super(t,n,r,o,s,a,l,c),this.contentAttr=function w4e(e){return"_ngcontent-%COMP%".replace(Dj,e)}(c),this.hostAttr=function A4e(e){return"_nghost-%COMP%".replace(Dj,e)}(c)}applyToHost(t){this.applyStyles(),this.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}let T4e=(()=>{class e extends gre{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,i){return n.addEventListener(r,i,!1),()=>this.removeEventListener(n,r,i)}removeEventListener(n,r,i){return n.removeEventListener(r,i)}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(ep))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();const Cre=["alt","control","meta","shift"],D4e={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},P4e={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let k4e=(()=>{class e extends gre{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,i){const o=e.parseEventName(r),s=e.eventCallback(o.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>GC().onAndCancel(n,o.domEventName,s))}static parseEventName(n){const r=n.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const o=e._normalizeKey(r.pop());let s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),Cre.forEach(c=>{const u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=o,0!=r.length||0===o.length)return null;const l={};return l.domEventName=i,l.fullKey=s,l}static matchEventFullKeyCode(n,r){let i=D4e[n.key]||n.key,o="";return r.indexOf("code.")>-1&&(i=n.code,o="code."),!(null==i||!i)&&(i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),Cre.forEach(s=>{s!==i&&(0,P4e[s])(n)&&(o+=s+".")}),o+=i,o===r)}static eventCallback(n,r,i){return o=>{e.matchEventFullKeyCode(o,n)&&i.runGuarded(()=>r(o))}}static _normalizeKey(n){return"esc"===n?"escape":n}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(ep))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();function wre(e){return{appProviders:[...L4e,...e?.providers??[]],platformProviders:O4e}}const O4e=[{provide:Ex,useValue:"browser"},{provide:QK,useValue:function R4e(){Aj.makeCurrent()},multi:!0},{provide:ep,useFactory:function F4e(){return function WL(e){Qf=e}(document),document},deps:[]}],L4e=[{provide:No,useValue:"root"},{provide:af,useFactory:function N4e(){return new af},deps:[]},{provide:Ij,useClass:T4e,multi:!0,deps:[ep,To,Ex]},{provide:Ij,useClass:k4e,multi:!0,deps:[ep]},xre,yre,mre,{provide:_Q,useExisting:xre},{provide:class zMe{},useClass:v4e,deps:[]},[]];let j4e=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(ep))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function u1(e){return this instanceof u1?(this.v=e,this):new u1(e)}function kre(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Fj(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(o){n[o]=e[o]&&function(s){return new Promise(function(a,l){!function i(o,s,a,l){Promise.resolve(l).then(function(c){o({value:c,done:a})},s)}(a,l,(s=e[o](s)).done,s.value)})}}}"function"==typeof SuppressedError&&SuppressedError;const Mre=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Rre(e){return Yo(e?.then)}function Nre(e){return Yo(e[K2])}function Fre(e){return Symbol.asyncIterator&&Yo(e?.[Symbol.asyncIterator])}function Ore(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Bre=function dRe(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function Lre(e){return Yo(e?.[Bre])}function jre(e){return function Pre(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=n.apply(e,t||[]),o=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(f){r[f]&&(i[f]=function(p){return new Promise(function(m,h){o.push([f,p,m,h])>1||a(f,p)})})}function a(f,p){try{!function l(f){f.value instanceof u1?Promise.resolve(f.value.v).then(c,u):d(o[0][2],f)}(r[f](p))}catch(m){d(o[0][3],m)}}function c(f){a("next",f)}function u(f){a("throw",f)}function d(f,p){f(p),o.shift(),o.length&&a(o[0][0],o[0][1])}}(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:i}=yield u1(n.read());if(i)return yield u1(void 0);yield yield u1(r)}}finally{n.releaseLock()}})}function Ure(e){return Yo(e?.getReader)}function vd(e){if(e instanceof Ra)return e;if(null!=e){if(Nre(e))return function fRe(e){return new Ra(t=>{const n=e[K2]();if(Yo(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Mre(e))return function pRe(e){return new Ra(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Rre(e))return function hRe(e){return new Ra(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,qI)})}(e);if(Fre(e))return zre(e);if(Lre(e))return function mRe(e){return new Ra(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Ure(e))return function gRe(e){return zre(jre(e))}(e)}throw Ore(e)}function zre(e){return new Ra(t=>{(function yRe(e,t){var n,r,i,o;return function Tre(e,t,n,r){return new(n||(n=Promise))(function(o,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?o(u.value):function i(o){return o instanceof n?o:new n(function(s){s(o)})}(u.value).then(a,l)}c((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=kre(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(s){i={error:s}}finally{try{r&&!r.done&&(o=n.return)&&(yield o.call(n))}finally{if(i)throw i.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function j0(e,t,n,r=0,i=!1){const o=t.schedule(function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(o),!i)return o}function Vre(e,t=0){return is((n,r)=>{n.subscribe(Xo(r,i=>j0(r,e,()=>r.next(i),t),()=>j0(r,e,()=>r.complete(),t),i=>j0(r,e,()=>r.error(i),t)))})}function Hre(e,t=0){return is((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function Gre(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ra(n=>{j0(n,t,()=>{const r=e[Symbol.asyncIterator]();j0(n,t,()=>{r.next().then(i=>{i.done?n.complete():n.next(i.value)})},0,!0)})})}function Is(e,t){return t?function CRe(e,t){if(null!=e){if(Nre(e))return function bRe(e,t){return vd(e).pipe(Hre(t),Vre(t))}(e,t);if(Mre(e))return function xRe(e,t){return new Ra(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Rre(e))return function vRe(e,t){return vd(e).pipe(Hre(t),Vre(t))}(e,t);if(Fre(e))return Gre(e,t);if(Lre(e))return function _Re(e,t){return new Ra(n=>{let r;return j0(n,t,()=>{r=e[Bre](),j0(n,t,()=>{let i,o;try{({value:i,done:o}=r.next())}catch(s){return void n.error(s)}o?n.complete():n.next(i)},0,!0)}),()=>Yo(r?.return)&&r.return()})}(e,t);if(Ure(e))return function SRe(e,t){return Gre(jre(e),t)}(e,t)}throw Ore(e)}(e,t):vd(e)}function qre(e){return e&&Yo(e.schedule)}function Oj(e){return e[e.length-1]}function Bj(e){return Yo(Oj(e))?e.pop():void 0}function $C(e){return qre(Oj(e))?e.pop():void 0}function Wre(e,t){return"number"==typeof Oj(e)?e.pop():t}function Mr(...e){return Is(e,$C(e))}const{isArray:wRe}=Array,{getPrototypeOf:ARe,prototype:IRe,keys:ERe}=Object;const{isArray:PRe}=Array;function $re(e){return hn(t=>function kRe(e,t){return PRe(t)?e(...t):e(t)}(e,t))}function Lj(...e){const t=$C(e),n=Bj(e),{args:r,keys:i}=function TRe(e){if(1===e.length){const t=e[0];if(wRe(t))return{args:t,keys:null};if(function DRe(e){return e&&"object"==typeof e&&ARe(e)===IRe}(t)){const n=ERe(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return Is([],t);const o=new Ra(Yre(r,t,i?s=>function MRe(e,t){return e.reduce((n,r,i)=>(n[r]=t[i],n),{})}(i,s):ah));return n?o.pipe($re(n)):o}function Yre(e,t,n=ah){return r=>{Xre(t,()=>{const{length:i}=e,o=new Array(i);let s=i,a=i;for(let l=0;l<i;l++)Xre(t,()=>{const c=Is(e[l],t);let u=!1;c.subscribe(Xo(r,d=>{o[l]=d,u||(u=!0,a--),a||r.next(n(o.slice()))},()=>{--s||r.complete()}))},r)},r)}}function Xre(e,t,n){e?j0(n,e,t):t()}const aR=Tv(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"});function Xc(e,t,n=1/0){return Yo(t)?Xc((r,i)=>hn((o,s)=>t(r,o,i,s))(vd(e(r,i))),n):("number"==typeof t&&(n=t),is((r,i)=>function RRe(e,t,n,r,i,o,s,a){const l=[];let c=0,u=0,d=!1;const f=()=>{d&&!l.length&&!c&&t.complete()},p=h=>c<r?m(h):l.push(h),m=h=>{o&&t.next(h),c++;let g=!1;vd(n(h,u++)).subscribe(Xo(t,y=>{i?.(y),o?p(y):t.next(y)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){const y=l.shift();s?j0(t,s,()=>m(y)):m(y)}f()}catch(y){t.error(y)}}))};return e.subscribe(Xo(t,p,()=>{d=!0,f()})),()=>{a?.()}}(r,i,e,n)))}function Ux(e=1/0){return Xc(ah,e)}function jj(...e){return function NRe(){return Ux(1)}()(Is(e,$C(e)))}function Kre(e){return new Ra(t=>{vd(e()).subscribe(t)})}function lR(e,t){const n=Yo(e)?e:()=>e,r=i=>i.error(n());return new Ra(t?i=>t.schedule(r,0,i):r)}const Mh=new Ra(e=>e.complete());function Uj(){return is((e,t)=>{let n=null;e._refCount++;const r=Xo(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const i=e._connection,o=n;n=null,i&&(!o||i===o)&&i.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class Zre extends Ra{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Rv(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Il;const n=this.getSubject();t.add(this.source.subscribe(Xo(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Il.EMPTY)}return t}refCount(){return Uj()(this)}}function ba(e,t){return is((n,r)=>{let i=null,o=0,s=!1;const a=()=>s&&!i&&r.complete();n.subscribe(Xo(r,l=>{i?.unsubscribe();let c=0;const u=o++;vd(e(l,u)).subscribe(i=Xo(r,d=>r.next(t?t(l,d,u,c++):d),()=>{i=null,a()}))},()=>{s=!0,a()}))})}function zx(e){return e<=0?()=>Mh:is((t,n)=>{let r=0;t.subscribe(Xo(n,i=>{++r<=e&&(n.next(i),e<=r&&n.complete())}))})}function WT(...e){const t=$C(e);return is((n,r)=>{(t?jj(e,n,t):jj(e,n)).subscribe(r)})}function xd(e,t){return is((n,r)=>{let i=0;n.subscribe(Xo(r,o=>e.call(t,o,i++)&&r.next(o)))})}function cR(e){return is((t,n)=>{let r=!1;t.subscribe(Xo(n,i=>{r=!0,n.next(i)},()=>{r||n.next(e),n.complete()}))})}function Qre(e=ORe){return is((t,n)=>{let r=!1;t.subscribe(Xo(n,i=>{r=!0,n.next(i)},()=>r?n.complete():n.error(e())))})}function ORe(){return new aR}function Vx(e,t){const n=arguments.length>=2;return r=>r.pipe(e?xd((i,o)=>e(i,o,r)):ah,zx(1),n?cR(t):Qre(()=>new aR))}function $T(e,t){return Yo(t)?Xc(e,t,1):Xc(e,1)}function Ho(e,t,n){const r=Yo(e)||t||n?{next:e,error:t,complete:n}:e;return r?is((i,o)=>{var s;null===(s=r.subscribe)||void 0===s||s.call(r);let a=!0;i.subscribe(Xo(o,l=>{var c;null===(c=r.next)||void 0===c||c.call(r,l),o.next(l)},()=>{var l;a=!1,null===(l=r.complete)||void 0===l||l.call(r),o.complete()},l=>{var c;a=!1,null===(c=r.error)||void 0===c||c.call(r,l),o.error(l)},()=>{var l,c;a&&(null===(l=r.unsubscribe)||void 0===l||l.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):ah}function YC(e){return is((t,n)=>{let o,r=null,i=!1;r=t.subscribe(Xo(n,void 0,void 0,s=>{o=vd(e(s,YC(e)(t))),r?(r.unsubscribe(),r=null,o.subscribe(n)):i=!0})),i&&(r.unsubscribe(),r=null,o.subscribe(n))})}function zj(e){return e<=0?()=>Mh:is((t,n)=>{let r=[];t.subscribe(Xo(n,i=>{r.push(i),e<r.length&&r.shift()},()=>{for(const i of r)n.next(i);n.complete()},void 0,()=>{r=null}))})}function Vj(e){return is((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const li="primary",YT=Symbol("RouteTitle");class VRe{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function XC(e){return new VRe(e)}function HRe(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const i={};for(let o=0;o<r.length;o++){const s=r[o],a=e[o];if(s.startsWith(":"))i[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}function Zm(e,t){const n=e?Hj(e):void 0,r=t?Hj(t):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let o=0;o<n.length;o++)if(i=n[o],!Jre(e[i],t[i]))return!1;return!0}function Hj(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}function Jre(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((i,o)=>r[o]===i)}return e===t}function eie(e){return e.length>0?e[e.length-1]:null}function d1(e){return function H4e(e){return!!e&&(e instanceof Ra||Yo(e.lift)&&Yo(e.subscribe))}(e)?e:N4(e)?Is(Promise.resolve(e)):Mr(e)}const qRe={exact:function rie(e,t,n){if(!Hx(e.segments,t.segments)||!uR(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!rie(e.children[r],t.children[r],n))return!1;return!0},subset:iie},tie={exact:function WRe(e,t){return Zm(e,t)},subset:function $Re(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>Jre(e[n],t[n]))},ignored:()=>!0};function nie(e,t,n){return qRe[n.paths](e.root,t.root,n.matrixParams)&&tie[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function iie(e,t,n){return oie(e,t,t.segments,n)}function oie(e,t,n,r){if(e.segments.length>n.length){const i=e.segments.slice(0,n.length);return!(!Hx(i,n)||t.hasChildren()||!uR(i,n,r))}if(e.segments.length===n.length){if(!Hx(e.segments,n)||!uR(e.segments,n,r))return!1;for(const i in t.children)if(!e.children[i]||!iie(e.children[i],t.children[i],r))return!1;return!0}{const i=n.slice(0,e.segments.length),o=n.slice(e.segments.length);return!!(Hx(e.segments,i)&&uR(e.segments,i,r)&&e.children[li])&&oie(e.children[li],t,o,r)}}function uR(e,t,n){return t.every((r,i)=>tie[n](e[i].parameters,r.parameters))}class KC{constructor(t=new Go([],{}),n={},r=null){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap??=XC(this.queryParams),this._queryParamMap}toString(){return KRe.serialize(this)}}class Go{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Object.values(n).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return dR(this)}}class XT{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap??=XC(this.parameters),this._parameterMap}toString(){return lie(this)}}function Hx(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let ZC=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>new Gj,providedIn:"root"})}return e})();class Gj{parse(t){const n=new a5e(t);return new KC(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${KT(t.root,!0)}`,r=function JRe(e){const t=Object.entries(e).map(([n,r])=>Array.isArray(r)?r.map(i=>`${fR(n)}=${fR(i)}`).join("&"):`${fR(n)}=${fR(r)}`).filter(n=>n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function ZRe(e){return encodeURI(e)}(t.fragment)}`:""}`}}const KRe=new Gj;function dR(e){return e.segments.map(t=>lie(t)).join("/")}function KT(e,t){if(!e.hasChildren())return dR(e);if(t){const n=e.children[li]?KT(e.children[li],!1):"",r=[];return Object.entries(e.children).forEach(([i,o])=>{i!==li&&r.push(`${i}:${KT(o,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function XRe(e,t){let n=[];return Object.entries(e.children).forEach(([r,i])=>{r===li&&(n=n.concat(t(i,r)))}),Object.entries(e.children).forEach(([r,i])=>{r!==li&&(n=n.concat(t(i,r)))}),n}(e,(r,i)=>i===li?[KT(e.children[li],!1)]:[`${i}:${KT(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[li]?`${dR(e)}/${n[0]}`:`${dR(e)}/(${n.join("//")})`}}function sie(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function fR(e){return sie(e).replace(/%3B/gi,";")}function qj(e){return sie(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function pR(e){return decodeURIComponent(e)}function aie(e){return pR(e.replace(/\+/g,"%20"))}function lie(e){return`${qj(e.path)}${function QRe(e){return Object.entries(e).map(([t,n])=>`;${qj(t)}=${qj(n)}`).join("")}(e.parameters)}`}const e5e=/^[^\/()?;#]+/;function Wj(e){const t=e.match(e5e);return t?t[0]:""}const t5e=/^[^\/()?;=#]+/,r5e=/^[^=?&#]+/,o5e=/^[^&#]+/;class a5e{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Go([],{}):new Go([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[li]=new Go(t,n)),r}parseSegment(){const t=Wj(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Xt(4009,!1);return this.capture(t),new XT(pR(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=function n5e(e){const t=e.match(t5e);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const i=Wj(this.remaining);i&&(r=i,this.capture(r))}t[pR(n)]=pR(r)}parseQueryParam(t){const n=function i5e(e){const t=e.match(r5e);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const s=function s5e(e){const t=e.match(o5e);return t?t[0]:""}(this.remaining);s&&(r=s,this.capture(r))}const i=aie(n),o=aie(r);if(t.hasOwnProperty(i)){let s=t[i];Array.isArray(s)||(s=[s],t[i]=s),s.push(o)}else t[i]=o}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Wj(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new Xt(4010,!1);let o;r.indexOf(":")>-1?(o=r.slice(0,r.indexOf(":")),this.capture(o),this.capture(":")):t&&(o=li);const s=this.parseChildren();n[o]=1===Object.keys(s).length?s[li]:new Go([],s),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Xt(4011,!1)}}function cie(e){return e.segments.length>0?new Go([],{[li]:e}):e}function uie(e){const t={};for(const[r,i]of Object.entries(e.children)){const o=uie(i);if(r===li&&0===o.segments.length&&o.hasChildren())for(const[s,a]of Object.entries(o.children))t[s]=a;else(o.segments.length>0||o.hasChildren())&&(t[r]=o)}return function l5e(e){if(1===e.numberOfChildren&&e.children[li]){const t=e.children[li];return new Go(e.segments.concat(t.segments),t.children)}return e}(new Go(e.segments,t))}function QC(e){return e instanceof KC}function die(e){let t;const r=function n(o){const s={};for(const l of o.children){const c=n(l);s[l.outlet]=c}const a=new Go(o.url,s);return o===e&&(t=a),a}(e.root),i=cie(r);return t??i}function fie(e,t,n,r){let i=e;for(;i.parent;)i=i.parent;if(0===t.length)return $j(i,i,i,n,r);const o=function u5e(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new hie(!0,0,e);let t=0,n=!1;const r=e.reduce((i,o,s)=>{if("object"==typeof o&&null!=o){if(o.outlets){const a={};return Object.entries(o.outlets).forEach(([l,c])=>{a[l]="string"==typeof c?c.split("/"):c}),[...i,{outlets:a}]}if(o.segmentPath)return[...i,o.segmentPath]}return"string"!=typeof o?[...i,o]:0===s?(o.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?n=!0:".."===a?t++:""!=a&&i.push(a))}),i):[...i,o]},[]);return new hie(n,t,r)}(t);if(o.toRoot())return $j(i,i,new Go([],{}),n,r);const s=function d5e(e,t,n){if(e.isAbsolute)return new mR(t,!0,0);if(!n)return new mR(t,!1,NaN);if(null===n.parent)return new mR(n,!0,0);const r=hR(e.commands[0])?0:1;return function f5e(e,t,n){let r=e,i=t,o=n;for(;o>i;){if(o-=i,r=r.parent,!r)throw new Xt(4005,!1);i=r.segments.length}return new mR(r,!1,i-o)}(n,n.segments.length-1+r,e.numberOfDoubleDots)}(o,i,e),a=s.processChildren?QT(s.segmentGroup,s.index,o.commands):mie(s.segmentGroup,s.index,o.commands);return $j(i,s.segmentGroup,a,n,r)}function hR(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function ZT(e){return"object"==typeof e&&null!=e&&e.outlets}function $j(e,t,n,r,i){let s,o={};r&&Object.entries(r).forEach(([l,c])=>{o[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`}),s=e===t?n:pie(e,t,n);const a=cie(uie(s));return new KC(a,o,i)}function pie(e,t,n){const r={};return Object.entries(e.children).forEach(([i,o])=>{r[i]=o===t?n:pie(o,t,n)}),new Go(e.segments,r)}class hie{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&hR(r[0]))throw new Xt(4003,!1);const i=r.find(ZT);if(i&&i!==eie(r))throw new Xt(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class mR{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function mie(e,t,n){if(e??=new Go([],{}),0===e.segments.length&&e.hasChildren())return QT(e,t,n);const r=function h5e(e,t,n){let r=0,i=t;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<e.segments.length;){if(r>=n.length)return o;const s=e.segments[i],a=n[r];if(ZT(a))break;const l=`${a}`,c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!yie(l,c,s))return o;r+=2}else{if(!yie(l,{},s))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const o=new Go(e.segments.slice(0,r.pathIndex),{});return o.children[li]=new Go(e.segments.slice(r.pathIndex),e.children),QT(o,0,i)}return r.match&&0===i.length?new Go(e.segments,{}):r.match&&!e.hasChildren()?Yj(e,t,n):r.match?QT(e,0,i):Yj(e,t,n)}function QT(e,t,n){if(0===n.length)return new Go(e.segments,{});{const r=function p5e(e){return ZT(e[0])?e[0].outlets:{[li]:e}}(n),i={};if(Object.keys(r).some(o=>o!==li)&&e.children[li]&&1===e.numberOfChildren&&0===e.children[li].segments.length){const o=QT(e.children[li],t,n);return new Go(e.segments,o.children)}return Object.entries(r).forEach(([o,s])=>{"string"==typeof s&&(s=[s]),null!==s&&(i[o]=mie(e.children[o],t,s))}),Object.entries(e.children).forEach(([o,s])=>{void 0===r[o]&&(i[o]=s)}),new Go(e.segments,i)}}function Yj(e,t,n){const r=e.segments.slice(0,t);let i=0;for(;i<n.length;){const o=n[i];if(ZT(o)){const l=m5e(o.outlets);return new Go(r,l)}if(0===i&&hR(n[0])){r.push(new XT(e.segments[t].path,gie(n[0]))),i++;continue}const s=ZT(o)?o.outlets[li]:`${o}`,a=i<n.length-1?n[i+1]:null;s&&a&&hR(a)?(r.push(new XT(s,gie(a))),i+=2):(r.push(new XT(s,{})),i++)}return new Go(r,{})}function m5e(e){const t={};return Object.entries(e).forEach(([n,r])=>{"string"==typeof r&&(r=[r]),null!==r&&(t[n]=Yj(new Go([],{}),0,r))}),t}function gie(e){const t={};return Object.entries(e).forEach(([n,r])=>t[n]=`${r}`),t}function yie(e,t,n){return e==n.path&&Zm(t,n.parameters)}const JT="imperative";var ji=function(e){return e[e.NavigationStart=0]="NavigationStart",e[e.NavigationEnd=1]="NavigationEnd",e[e.NavigationCancel=2]="NavigationCancel",e[e.NavigationError=3]="NavigationError",e[e.RoutesRecognized=4]="RoutesRecognized",e[e.ResolveStart=5]="ResolveStart",e[e.ResolveEnd=6]="ResolveEnd",e[e.GuardsCheckStart=7]="GuardsCheckStart",e[e.GuardsCheckEnd=8]="GuardsCheckEnd",e[e.RouteConfigLoadStart=9]="RouteConfigLoadStart",e[e.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",e[e.ChildActivationStart=11]="ChildActivationStart",e[e.ChildActivationEnd=12]="ChildActivationEnd",e[e.ActivationStart=13]="ActivationStart",e[e.ActivationEnd=14]="ActivationEnd",e[e.Scroll=15]="Scroll",e[e.NavigationSkipped=16]="NavigationSkipped",e}(ji||{});class Qm{constructor(t,n){this.id=t,this.url=n}}class gR extends Qm{constructor(t,n,r="imperative",i=null){super(t,n),this.type=ji.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class U0 extends Qm{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=ji.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}var df=function(e){return e[e.Redirect=0]="Redirect",e[e.SupersededByNewNavigation=1]="SupersededByNewNavigation",e[e.NoDataFromResolver=2]="NoDataFromResolver",e[e.GuardRejected=3]="GuardRejected",e}(df||{}),yR=function(e){return e[e.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",e[e.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",e}(yR||{});class JC extends Qm{constructor(t,n,r,i){super(t,n),this.reason=r,this.code=i,this.type=ji.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class ew extends Qm{constructor(t,n,r,i){super(t,n),this.reason=r,this.code=i,this.type=ji.NavigationSkipped}}class bR extends Qm{constructor(t,n,r,i){super(t,n),this.error=r,this.target=i,this.type=ji.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class bie extends Qm{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=ji.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class g5e extends Qm{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=ji.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class y5e extends Qm{constructor(t,n,r,i,o){super(t,n),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=o,this.type=ji.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class b5e extends Qm{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=ji.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class v5e extends Qm{constructor(t,n,r,i){super(t,n),this.urlAfterRedirects=r,this.state=i,this.type=ji.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class x5e{constructor(t){this.route=t,this.type=ji.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class _5e{constructor(t){this.route=t,this.type=ji.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class S5e{constructor(t){this.snapshot=t,this.type=ji.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class C5e{constructor(t){this.snapshot=t,this.type=ji.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class w5e{constructor(t){this.snapshot=t,this.type=ji.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class A5e{constructor(t){this.snapshot=t,this.type=ji.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vie{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=ji.Scroll}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}class Xj{}class Kj{constructor(t){this.url=t}}class I5e{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new e3,this.attachRef=null}}let e3=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const i=this.getOrCreateContext(n);i.outlet=r,this.contexts.set(n,i)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new I5e,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();class xie{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=Zj(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=Zj(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=Qj(t,this._root);return n.length<2?[]:n[n.length-2].children.map(i=>i.value).filter(i=>i!==t)}pathFromRoot(t){return Qj(t,this._root).map(n=>n.value)}}function Zj(e,t){if(e===t.value)return t;for(const n of t.children){const r=Zj(e,n);if(r)return r}return null}function Qj(e,t){if(e===t.value)return[t];for(const n of t.children){const r=Qj(e,n);if(r.length)return r.unshift(t),r}return[]}class Rh{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function tw(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class _ie extends xie{constructor(t,n){super(t),this.snapshot=n,tU(this,t)}toString(){return this.snapshot.toString()}}function Sie(e){const t=function E5e(e){const o=new eU([],{},{},"",{},li,e,null,{});return new Cie("",new Rh(o,[]))}(e),n=new Ao([new XT("",{})]),r=new Ao({}),i=new Ao({}),o=new Ao({}),s=new Ao(""),a=new nw(n,r,o,s,i,li,e,t.root);return a.snapshot=t.root,new _ie(new Rh(a,[]),t)}class nw{constructor(t,n,r,i,o,s,a,l){this.urlSubject=t,this.paramsSubject=n,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=o,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(hn(c=>c[YT]))??Mr(void 0),this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=o}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(hn(t=>XC(t))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(hn(t=>XC(t))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Jj(e,t,n="emptyOnly"){let r;const{routeConfig:i}=e;return r=null===t||"always"!==n&&""!==i?.path&&(t.component||t.routeConfig?.loadComponent)?{params:{...e.params},data:{...e.data},resolve:{...e.data,...e._resolvedData??{}}}:{params:{...t.params,...e.params},data:{...t.data,...e.data},resolve:{...e.data,...t.data,...i?.data,...e._resolvedData}},i&&Aie(i)&&(r.resolve[YT]=i.title),r}class eU{get title(){return this.data?.[YT]}constructor(t,n,r,i,o,s,a,l,c){this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=XC(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=XC(this.queryParams),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Cie extends xie{constructor(t,n){super(n),this.url=t,tU(this,n)}toString(){return wie(this._root)}}function tU(e,t){t.value._routerState=e,t.children.forEach(n=>tU(e,n))}function wie(e){const t=e.children.length>0?` { ${e.children.map(wie).join(", ")} } `:"";return`${e.value}${t}`}function nU(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Zm(t.queryParams,n.queryParams)||e.queryParamsSubject.next(n.queryParams),t.fragment!==n.fragment&&e.fragmentSubject.next(n.fragment),Zm(t.params,n.params)||e.paramsSubject.next(n.params),function GRe(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!Zm(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.urlSubject.next(n.url),Zm(t.data,n.data)||e.dataSubject.next(n.data)}else e.snapshot=e._futureSnapshot,e.dataSubject.next(e._futureSnapshot.data)}function rU(e,t){const n=Zm(e.params,t.params)&&function YRe(e,t){return Hx(e,t)&&e.every((n,r)=>Zm(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||rU(e.parent,t.parent))}function Aie(e){return"string"==typeof e.title||null===e.title}let iU=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=li,this.activateEvents=new rl,this.deactivateEvents=new rl,this.attachEvents=new rl,this.detachEvents=new rl,this.parentContexts=qt(e3),this.location=qt(Ih),this.changeDetector=qt(L4),this.environmentInjector=qt(Na),this.inputBinder=qt(vR,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:i}=n.name;if(r)return;this.isTrackedInParentContexts(i)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(i)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Xt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Xt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Xt(4012,!1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new Xt(4013,!1);this._activatedRoute=n;const i=this.location,s=n.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new T5e(n,a,i.injector);this.activated=i.createComponent(s,{index:i.length,injector:l,environmentInjector:r??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275dir=Ja({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Oo]})}return e})();class T5e{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===nw?this.route:t===e3?this.childContexts:this.parent.get(t,n)}}const vR=new jn("");let Iie=(()=>{class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(n){this.unsubscribeFromRouteData(n),this.subscribeToRouteData(n)}unsubscribeFromRouteData(n){this.outletDataSubscriptions.get(n)?.unsubscribe(),this.outletDataSubscriptions.delete(n)}subscribeToRouteData(n){const{activatedRoute:r}=n,i=Lj([r.queryParams,r.params,r.data]).pipe(ba(([o,s,a],l)=>(a={...o,...s,...a},0===l?Mr(a):Promise.resolve(a)))).subscribe(o=>{if(!n.isActivated||!n.activatedComponentRef||n.activatedRoute!==r||null===r.component)return void this.unsubscribeFromRouteData(n);const s=function uke(e){const t=Yr(e);if(!t)return null;const n=new pT(t);return{get selector(){return n.selector},get type(){return n.componentType},get inputs(){return n.inputs},get outputs(){return n.outputs},get ngContentSelectors(){return n.ngContentSelectors},get isStandalone(){return t.standalone},get isSignal(){return t.signals}}}(r.component);if(s)for(const{templateName:a}of s.inputs)n.activatedComponentRef.setInput(a,o[a]);else this.unsubscribeFromRouteData(n)});this.outletDataSubscriptions.set(n,i)}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();function t3(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const i=function P5e(e,t,n){return t.children.map(r=>{for(const i of n.children)if(e.shouldReuseRoute(r.value,i.value.snapshot))return t3(e,r,i);return t3(e,r)})}(e,t,n);return new Rh(r,i)}{if(e.shouldAttach(t.value)){const o=e.retrieve(t.value);if(null!==o){const s=o.route;return s.value._futureSnapshot=t.value,s.children=t.children.map(a=>t3(e,a)),s}}const r=function k5e(e){return new nw(new Ao(e.url),new Ao(e.params),new Ao(e.queryParams),new Ao(e.fragment),new Ao(e.data),e.outlet,e.component,e)}(t.value),i=t.children.map(o=>t3(e,o));return new Rh(r,i)}}const Eie="ngNavigationCancelingError";function Tie(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=QC(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,i=Die(!1,df.Redirect);return i.url=n,i.navigationBehaviorOptions=r,i}function Die(e,t){const n=new Error(`NavigationCancelingError: ${e||""}`);return n[Eie]=!0,n.cancellationCode=t,n}function Pie(e){return!!e&&e[Eie]}let kie=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=$d({type:e,selectors:[["ng-component"]],standalone:!0,features:[Dh],decls:1,vars:0,template:function(r,i){1&r&&js(0,"router-outlet")},dependencies:[iU],encapsulation:2})}return e})();function oU(e){const t=e.children&&e.children.map(oU),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==li&&(n.component=kie),n}function Jm(e){return e.outlet||li}function n3(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class j5e{constructor(t,n,r,i,o){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=o}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),nU(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const i=tw(n);t.children.forEach(o=>{const s=o.value.outlet;this.deactivateRoutes(o,i[s],r),delete i[s]}),Object.values(i).forEach(o=>{this.deactivateRouteAndItsChildren(o,r)})}deactivateRoutes(t,n,r){const i=t.value,o=n?n.value:null;if(i===o)if(i.component){const s=r.getContext(i.outlet);s&&this.deactivateChildRoutes(t,n,s.children)}else this.deactivateChildRoutes(t,n,r);else o&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),i=r&&t.value.component?r.children:n,o=tw(t);for(const s of Object.values(o))this.deactivateRouteAndItsChildren(s,i);if(r&&r.outlet){const s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:s,route:t,contexts:a})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),i=r&&t.value.component?r.children:n,o=tw(t);for(const s of Object.values(o))this.deactivateRouteAndItsChildren(s,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(t,n,r){const i=tw(n);t.children.forEach(o=>{this.activateRoutes(o,i[o.value.outlet],r),this.forwardEvent(new A5e(o.value.snapshot))}),t.children.length&&this.forwardEvent(new C5e(t.value.snapshot))}activateRoutes(t,n,r){const i=t.value,o=n?n.value:null;if(nU(i),i===o)if(i.component){const s=r.getOrCreateContext(i.outlet);this.activateChildRoutes(t,n,s.children)}else this.activateChildRoutes(t,n,r);else if(i.component){const s=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),nU(a.route.value),this.activateChildRoutes(t,null,s.children)}else{const a=n3(i.snapshot);s.attachRef=null,s.route=i,s.injector=a,s.outlet&&s.outlet.activateWith(i,s.injector),this.activateChildRoutes(t,null,s.children)}}else this.activateChildRoutes(t,null,r)}}class Mie{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class xR{constructor(t,n){this.component=t,this.route=n}}function U5e(e,t,n){const r=e._root;return r3(r,t?t._root:null,n,[r.value])}function rw(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function Ok(e){return null!==u0(e)}(e)?t.get(e):e:r}function r3(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=tw(t);return e.children.forEach(s=>{(function V5e(e,t,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=e.value,s=t?t.value:null,a=n?n.getContext(e.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const l=function H5e(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Hx(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Hx(e.url,t.url)||!Zm(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!rU(e,t)||!Zm(e.queryParams,t.queryParams);default:return!rU(e,t)}}(s,o,o.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new Mie(r)):(o.data=s.data,o._resolvedData=s._resolvedData),r3(e,t,o.component?a?a.children:null:n,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new xR(a.outlet.component,s))}else s&&i3(t,a,i),i.canActivateChecks.push(new Mie(r)),r3(e,null,o.component?a?a.children:null:n,r,i)})(s,o[s.value.outlet],n,r.concat([s.value]),i),delete o[s.value.outlet]}),Object.entries(o).forEach(([s,a])=>i3(a,n.getContext(s),i)),i}function i3(e,t,n){const r=tw(e),i=e.value;Object.entries(r).forEach(([o,s])=>{i3(s,i.component?t?t.children.getContext(o):null:t,n)}),n.canDeactivateChecks.push(new xR(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}function o3(e){return"function"==typeof e}function Rie(e){return e instanceof aR||"EmptyError"===e?.name}const _R=Symbol("INITIAL_VALUE");function iw(){return ba(e=>Lj(e.map(t=>t.pipe(zx(1),WT(_R)))).pipe(hn(t=>{for(const n of t)if(!0!==n){if(n===_R)return _R;if(!1===n||n instanceof KC)return n}return!0}),xd(t=>t!==_R),zx(1)))}function Nie(e){return YI(Ho(t=>{if(QC(t))throw Tie(0,t)}),hn(t=>!0===t))}class sU{constructor(t){this.segmentGroup=t||null}}class aU extends Error{constructor(t){super(),this.urlTree=t}}function ow(e){return lR(new sU(e))}class lNe{constructor(t,n){this.urlSerializer=t,this.urlTree=n}lineralizeSegments(t,n){let r=[],i=n.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return Mr(r);if(i.numberOfChildren>1||!i.children[li])return lR(new Xt(4e3,!1));i=i.children[li]}}applyRedirectCommands(t,n,r){const i=this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r);if(n.startsWith("/"))throw new aU(i);return i}applyRedirectCreateUrlTree(t,n,r,i){const o=this.createSegmentGroup(t,n.root,r,i);return new KC(o,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return Object.entries(t).forEach(([i,o])=>{if("string"==typeof o&&o.startsWith(":")){const a=o.substring(1);r[i]=n[a]}else r[i]=o}),r}createSegmentGroup(t,n,r,i){const o=this.createSegments(t,n.segments,r,i);let s={};return Object.entries(n.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(t,l,r,i)}),new Go(o,s)}createSegments(t,n,r,i){return n.map(o=>o.path.startsWith(":")?this.findPosParam(t,o,i):this.findOrReturn(o,r))}findPosParam(t,n,r){const i=r[n.path.substring(1)];if(!i)throw new Xt(4001,!1);return i}findOrReturn(t,n){let r=0;for(const i of n){if(i.path===t.path)return n.splice(r),i;r++}return t}}const lU={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function cNe(e,t,n,r,i){const o=cU(e,t,n);return o.matched?(r=function R5e(e,t){return e.providers&&!e._injector&&(e._injector=f4(e.providers,t,`Route: ${e.path}`)),e._injector??t}(t,r),function oNe(e,t,n,r){const i=t.canMatch;return i&&0!==i.length?Mr(i.map(s=>{const a=rw(s,e);return d1(function X5e(e){return e&&o3(e.canMatch)}(a)?a.canMatch(t,n):Hf(e,()=>a(t,n)))})).pipe(iw(),Nie()):Mr(!0)}(r,t,n).pipe(hn(s=>!0===s?o:{...lU}))):Mr(o)}function cU(e,t,n){if("**"===t.path)return function uNe(e){return{matched:!0,parameters:e.length>0?eie(e).parameters:{},consumedSegments:e,remainingSegments:[],positionalParamSegments:{}}}(n);if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...lU}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const i=(t.matcher||HRe)(n,e,t);if(!i)return{...lU};const o={};Object.entries(i.posParams??{}).forEach(([a,l])=>{o[a]=l.path});const s=i.consumed.length>0?{...o,...i.consumed[i.consumed.length-1].parameters}:o;return{matched:!0,consumedSegments:i.consumed,remainingSegments:n.slice(i.consumed.length),parameters:s,positionalParamSegments:i.posParams??{}}}function Fie(e,t,n,r){return n.length>0&&function pNe(e,t,n){return n.some(r=>SR(e,t,r)&&Jm(r)!==li)}(e,n,r)?{segmentGroup:new Go(t,fNe(r,new Go(n,e.children))),slicedSegments:[]}:0===n.length&&function hNe(e,t,n){return n.some(r=>SR(e,t,r))}(e,n,r)?{segmentGroup:new Go(e.segments,dNe(e,n,r,e.children)),slicedSegments:n}:{segmentGroup:new Go(e.segments,e.children),slicedSegments:n}}function dNe(e,t,n,r){const i={};for(const o of n)if(SR(e,t,o)&&!r[Jm(o)]){const s=new Go([],{});i[Jm(o)]=s}return{...r,...i}}function fNe(e,t){const n={};n[li]=t;for(const r of e)if(""===r.path&&Jm(r)!==li){const i=new Go([],{});n[Jm(r)]=i}return n}function SR(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}class yNe{}class xNe{constructor(t,n,r,i,o,s,a){this.injector=t,this.configLoader=n,this.rootComponentType=r,this.config=i,this.urlTree=o,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new lNe(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(t){return new Xt(4002,`'${t.segmentGroup}'`)}recognize(){const t=Fie(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(t).pipe(hn(n=>{const r=new eU([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},li,this.rootComponentType,null,{}),i=new Rh(r,n),o=new Cie("",i),s=function c5e(e,t,n=null,r=null){return fie(die(e),t,n,r)}(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,o.url=this.urlSerializer.serialize(s),this.inheritParamsAndData(o._root,null),{state:o,tree:s}}))}match(t){return this.processSegmentGroup(this.injector,this.config,t,li).pipe(YC(r=>{if(r instanceof aU)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof sU?this.noMatchError(r):r}))}inheritParamsAndData(t,n){const r=t.value,i=Jj(r,n,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),t.children.forEach(o=>this.inheritParamsAndData(o,r))}processSegmentGroup(t,n,r,i){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,i,!0).pipe(hn(o=>o instanceof Rh?[o]:[]))}processChildren(t,n,r){const i=[];for(const o of Object.keys(r.children))"primary"===o?i.unshift(o):i.push(o);return Is(i).pipe($T(o=>{const s=r.children[o],a=function B5e(e,t){const n=e.filter(r=>Jm(r)===t);return n.push(...e.filter(r=>Jm(r)!==t)),n}(n,o);return this.processSegmentGroup(t,a,s,o)}),function LRe(e,t){return is(function BRe(e,t,n,r,i){return(o,s)=>{let a=n,l=t,c=0;o.subscribe(Xo(s,u=>{const d=c++;l=a?e(l,u,d):(a=!0,u),r&&s.next(l)},i&&(()=>{a&&s.next(l),s.complete()})))}}(e,t,arguments.length>=2,!0))}((o,s)=>(o.push(...s),o)),cR(null),function jRe(e,t){const n=arguments.length>=2;return r=>r.pipe(e?xd((i,o)=>e(i,o,r)):ah,zj(1),n?cR(t):Qre(()=>new aR))}(),Xc(o=>{if(null===o)return ow(r);const s=Oie(o);return function _Ne(e){e.sort((t,n)=>t.value.outlet===li?-1:n.value.outlet===li?1:t.value.outlet.localeCompare(n.value.outlet))}(s),Mr(s)}))}processSegment(t,n,r,i,o,s){return Is(n).pipe($T(a=>this.processSegmentAgainstRoute(a._injector??t,n,a,r,i,o,s).pipe(YC(l=>{if(l instanceof sU)return Mr(null);throw l}))),Vx(a=>!!a),YC(a=>{if(Rie(a))return function gNe(e,t,n){return 0===t.length&&!e.children[n]}(r,i,o)?Mr(new yNe):ow(r);throw a}))}processSegmentAgainstRoute(t,n,r,i,o,s,a){return function mNe(e,t,n,r){return!!(Jm(e)===r||r!==li&&SR(t,n,e))&&cU(t,e,n).matched}(r,i,o,s)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,i,r,o,s):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(t,i,n,r,o,s):ow(i):ow(i)}expandSegmentAgainstRouteUsingRedirect(t,n,r,i,o,s){const{matched:a,consumedSegments:l,positionalParamSegments:c,remainingSegments:u}=cU(n,i,o);if(!a)return ow(n);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>31&&(this.allowRedirects=!1));const d=this.applyRedirects.applyRedirectCommands(l,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,d).pipe(Xc(f=>this.processSegment(t,r,n,f.concat(u),s,!1)))}matchSegmentAgainstRoute(t,n,r,i,o){const s=cNe(n,r,i,t);return"**"===r.path&&(n.children={}),s.pipe(ba(a=>a.matched?this.getChildConfig(t=r._injector??t,r,i).pipe(ba(({routes:l})=>{const c=r._loadedInjector??t,{consumedSegments:u,remainingSegments:d,parameters:f}=a,p=new eU(u,f,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,function CNe(e){return e.data||{}}(r),Jm(r),r.component??r._loadedComponent??null,r,function wNe(e){return e.resolve||{}}(r)),{segmentGroup:m,slicedSegments:h}=Fie(n,u,d,l);if(0===h.length&&m.hasChildren())return this.processChildren(c,l,m).pipe(hn(y=>null===y?null:new Rh(p,y)));if(0===l.length&&0===h.length)return Mr(new Rh(p,[]));const g=Jm(r)===o;return this.processSegment(c,l,m,h,g?li:o,!0).pipe(hn(y=>new Rh(p,y instanceof Rh?[y]:[])))})):ow(n)))}getChildConfig(t,n,r){return n.children?Mr({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Mr({routes:n._loadedRoutes,injector:n._loadedInjector}):function iNe(e,t,n,r){const i=t.canLoad;return void 0===i||0===i.length?Mr(!0):Mr(i.map(s=>{const a=rw(s,e);return d1(function q5e(e){return e&&o3(e.canLoad)}(a)?a.canLoad(t,n):Hf(e,()=>a(t,n)))})).pipe(iw(),Nie())}(t,n,r).pipe(Xc(i=>i?this.configLoader.loadChildren(t,n).pipe(Ho(o=>{n._loadedRoutes=o.routes,n._loadedInjector=o.injector})):function aNe(e){return lR(Die(!1,df.GuardRejected))}())):Mr({routes:[],injector:t})}}function SNe(e){const t=e.value.routeConfig;return t&&""===t.path}function Oie(e){const t=[],n=new Set;for(const r of e){if(!SNe(r)){t.push(r);continue}const i=t.find(o=>r.value.routeConfig===o.value.routeConfig);void 0!==i?(i.children.push(...r.children),n.add(i)):t.push(r)}for(const r of n){const i=Oie(r.children);t.push(new Rh(r.value,i))}return t.filter(r=>!n.has(r))}function Bie(e){const t=e.children.map(n=>Bie(n)).flat();return[e,...t]}function uU(e){return ba(t=>{const n=e(t);return n?Is(n).pipe(hn(()=>t)):Mr(t)})}let Lie=(()=>{class e{buildTitle(n){let r,i=n.root;for(;void 0!==i;)r=this.getResolvedTitleForRoute(i)??r,i=i.children.find(o=>o.outlet===li);return r}getResolvedTitleForRoute(n){return n.data[YT]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>qt(PNe),providedIn:"root"})}return e})(),PNe=(()=>{class e extends Lie{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(j4e))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const sw=new jn("",{providedIn:"root",factory:()=>({})}),aw=new jn("");let dU=(()=>{class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=qt(Qte)}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Mr(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=d1(n.loadComponent()).pipe(hn(jie),Ho(o=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=o}),Vj(()=>{this.componentLoaders.delete(n)})),i=new Zre(r,()=>new si).pipe(Uj());return this.componentLoaders.set(n,i),i}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Mr({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const o=function kNe(e,t,n,r){return d1(e.loadChildren()).pipe(hn(jie),Xc(i=>i instanceof pJ||Array.isArray(i)?Mr(i):Is(t.compileModuleAsync(i))),hn(i=>{r&&r(e);let o,s,a=!1;return Array.isArray(i)?(s=i,!0):(o=i.create(n).injector,s=o.get(aw,[],{optional:!0,self:!0}).flat()),{routes:s.map(oU),injector:o}}))}(r,this.compiler,n,this.onLoadEndListener).pipe(Vj(()=>{this.childrenLoaders.delete(r)})),s=new Zre(o,()=>new si).pipe(Uj());return this.childrenLoaders.set(r,s),s}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function jie(e){return function MNe(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let fU=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>qt(RNe),providedIn:"root"})}return e})(),RNe=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const Uie=new jn(""),zie=new jn("");function NNe(e,t,n){const r=e.get(zie),i=e.get(ep);return e.get(To).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let o;const s=new Promise(c=>{o=c}),a=i.startViewTransition(()=>(o(),function FNe(e){return new Promise(t=>{TQ(t,{injector:e})})}(e))),{onViewTransitionCreated:l}=r;return l&&Hf(e,()=>l({transition:a,from:t,to:n})),s})}let CR=(()=>{class e{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new si,this.transitionAbortSubject=new si,this.configLoader=qt(dU),this.environmentInjector=qt(Na),this.urlSerializer=qt(ZC),this.rootContexts=qt(e3),this.location=qt(qC),this.inputBindingEnabled=null!==qt(vR,{optional:!0}),this.titleStrategy=qt(Lie),this.options=qt(sw,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=qt(fU),this.createViewTransition=qt(Uie,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Mr(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=i=>this.events.next(new _5e(i)),this.configLoader.onLoadStartListener=i=>this.events.next(new x5e(i))}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n,r,i){return this.transitions=new Ao({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:JT,restoredState:null,currentSnapshot:i.snapshot,targetSnapshot:null,currentRouterState:i,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(xd(o=>0!==o.id),hn(o=>({...o,extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),ba(o=>{let s=!1,a=!1;return Mr(o).pipe(ba(l=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",df.SupersededByNewNavigation),Mh;this.currentTransition=o,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null};const c=!n.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl();if(!c&&"reload"!==(l.extras.onSameUrlNavigation??n.onSameUrlNavigation)){const d="";return this.events.next(new ew(l.id,this.urlSerializer.serialize(l.rawUrl),d,yR.IgnoredSameUrlNavigation)),l.resolve(null),Mh}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return Mr(l).pipe(ba(d=>{const f=this.transitions?.getValue();return this.events.next(new gR(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?Mh:Promise.resolve(d)}),function ANe(e,t,n,r,i,o){return Xc(s=>function bNe(e,t,n,r,i,o,s="emptyOnly"){return new xNe(e,t,n,r,i,s,o).recognize()}(e,t,n,r,s.extractedUrl,i,o).pipe(hn(({state:a,tree:l})=>({...s,targetSnapshot:a,urlAfterRedirects:l}))))}(this.environmentInjector,this.configLoader,this.rootComponentType,n.config,this.urlSerializer,this.paramsInheritanceStrategy),Ho(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation={...this.currentNavigation,finalUrl:d.urlAfterRedirects};const f=new bie(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){const{id:d,extractedUrl:f,source:p,restoredState:m,extras:h}=l,g=new gR(d,this.urlSerializer.serialize(f),p,m);this.events.next(g);const y=Sie(this.rootComponentType).snapshot;return this.currentTransition=o={...l,targetSnapshot:y,urlAfterRedirects:f,extras:{...h,skipLocationChange:!1,replaceUrl:!1}},this.currentNavigation.finalUrl=f,Mr(o)}{const d="";return this.events.next(new ew(l.id,this.urlSerializer.serialize(l.extractedUrl),d,yR.IgnoredByUrlHandlingStrategy)),l.resolve(null),Mh}}),Ho(l=>{const c=new g5e(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),hn(l=>(this.currentTransition=o={...l,guards:U5e(l.targetSnapshot,l.currentSnapshot,this.rootContexts)},o)),function K5e(e,t){return Xc(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=n;return 0===s.length&&0===o.length?Mr({...n,guardsResult:!0}):function Z5e(e,t,n,r){return Is(e).pipe(Xc(i=>function rNe(e,t,n,r,i){const o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?Mr(o.map(a=>{const l=n3(t)??i,c=rw(a,l);return d1(function Y5e(e){return e&&o3(e.canDeactivate)}(c)?c.canDeactivate(e,t,n,r):Hf(l,()=>c(e,t,n,r))).pipe(Vx())})).pipe(iw()):Mr(!0)}(i.component,i.route,n,t,r)),Vx(i=>!0!==i,!0))}(s,r,i,e).pipe(Xc(a=>a&&function G5e(e){return"boolean"==typeof e}(a)?function Q5e(e,t,n,r){return Is(t).pipe($T(i=>jj(function eNe(e,t){return null!==e&&t&&t(new S5e(e)),Mr(!0)}(i.route.parent,r),function J5e(e,t){return null!==e&&t&&t(new w5e(e)),Mr(!0)}(i.route,r),function nNe(e,t,n){const r=t[t.length-1],o=t.slice(0,t.length-1).reverse().map(s=>function z5e(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(s)).filter(s=>null!==s).map(s=>Kre(()=>Mr(s.guards.map(l=>{const c=n3(s.node)??n,u=rw(l,c);return d1(function $5e(e){return e&&o3(e.canActivateChild)}(u)?u.canActivateChild(r,e):Hf(c,()=>u(r,e))).pipe(Vx())})).pipe(iw())));return Mr(o).pipe(iw())}(e,i.path,n),function tNe(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return Mr(!0);const i=r.map(o=>Kre(()=>{const s=n3(t)??n,a=rw(o,s);return d1(function W5e(e){return e&&o3(e.canActivate)}(a)?a.canActivate(t,e):Hf(s,()=>a(t,e))).pipe(Vx())}));return Mr(i).pipe(iw())}(e,i.route,n))),Vx(i=>!0!==i,!0))}(r,o,e,t):Mr(a)),hn(a=>({...n,guardsResult:a})))})}(this.environmentInjector,l=>this.events.next(l)),Ho(l=>{if(o.guardsResult=l.guardsResult,QC(l.guardsResult))throw Tie(0,l.guardsResult);const c=new y5e(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),xd(l=>!!l.guardsResult||(this.cancelNavigationTransition(l,"",df.GuardRejected),!1)),uU(l=>{if(l.guards.canActivateChecks.length)return Mr(l).pipe(Ho(c=>{const u=new b5e(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),ba(c=>{let u=!1;return Mr(c).pipe(function INe(e,t){return Xc(n=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=n;if(!i.length)return Mr(n);const o=new Set(i.map(l=>l.route)),s=new Set;for(const l of o)if(!s.has(l))for(const c of Bie(l))s.add(c);let a=0;return Is(s).pipe($T(l=>o.has(l)?function ENe(e,t,n,r){const i=e.routeConfig,o=e._resolve;return void 0!==i?.title&&!Aie(i)&&(o[YT]=i.title),function TNe(e,t,n,r){const i=Hj(e);if(0===i.length)return Mr({});const o={};return Is(i).pipe(Xc(s=>function DNe(e,t,n,r){const i=n3(t)??r,o=rw(e,i);return d1(o.resolve?o.resolve(t,n):Hf(i,()=>o(t,n)))}(e[s],t,n,r).pipe(Vx(),Ho(a=>{o[s]=a}))),zj(1),function URe(e){return hn(()=>e)}(o),YC(s=>Rie(s)?Mh:lR(s)))}(o,e,t,r).pipe(hn(s=>(e._resolvedData=s,e.data=Jj(e,e.parent,n).resolve,null)))}(l,r,e,t):(l.data=Jj(l,l.parent,e).resolve,Mr(void 0))),Ho(()=>a++),zj(1),Xc(l=>a===s.size?Mr(n):Mh))})}(this.paramsInheritanceStrategy,this.environmentInjector),Ho({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",df.NoDataFromResolver)}}))}),Ho(c=>{const u=new v5e(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),uU(l=>{const c=u=>{const d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(Ho(f=>{u.component=f}),hn(()=>{})));for(const f of u.children)d.push(...c(f));return d};return Lj(c(l.targetSnapshot.root)).pipe(cR(null),zx(1))}),uU(()=>this.afterPreactivation()),ba(()=>{const{currentSnapshot:l,targetSnapshot:c}=o,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?Is(u).pipe(hn(()=>o)):Mr(o)}),hn(l=>{const c=function D5e(e,t,n){const r=t3(e,t._root,n?n._root:void 0);return new _ie(r,t)}(n.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=o={...l,targetRouterState:c},this.currentNavigation.targetRouterState=c,o}),Ho(()=>{this.events.next(new Xj)}),((e,t,n,r)=>hn(i=>(new j5e(t,i.targetRouterState,i.currentRouterState,n,r).activate(e),i)))(this.rootContexts,n.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),zx(1),Ho({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new U0(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),function zRe(e){return is((t,n)=>{vd(e).subscribe(Xo(n,()=>n.complete(),kv)),!n.closed&&t.subscribe(n)})}(this.transitionAbortSubject.pipe(Ho(l=>{throw l}))),Vj(()=>{!s&&!a&&this.cancelNavigationTransition(o,"",df.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),YC(l=>{if(a=!0,Pie(l))this.events.next(new JC(o.id,this.urlSerializer.serialize(o.extractedUrl),l.message,l.cancellationCode)),function M5e(e){return Pie(e)&&QC(e.url)}(l)?this.events.next(new Kj(l.url)):o.resolve(!1);else{this.events.next(new bR(o.id,this.urlSerializer.serialize(o.extractedUrl),l,o.targetSnapshot??void 0));try{o.resolve(n.errorHandler(l))}catch(c){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(c)}}return Mh}))}))}cancelNavigationTransition(n,r,i){const o=new JC(n.id,this.urlSerializer.serialize(n.extractedUrl),r,i);this.events.next(o),n.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function ONe(e){return e!==JT}let BNe=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>qt(jNe),providedIn:"root"})}return e})();class LNe{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let jNe=(()=>{class e extends LNe{static#e=this.\u0275fac=(()=>{let n;return function(i){return(n||(n=Wb(e)))(i||e)}})();static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),Vie=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:()=>qt(UNe),providedIn:"root"})}return e})(),UNe=(()=>{class e extends Vie{constructor(){super(...arguments),this.location=qt(qC),this.urlSerializer=qt(ZC),this.options=qt(sw,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=qt(fU),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new KC,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Sie(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return"computed"!==this.canceledNavigationResolution?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(n){return this.location.subscribe(r=>{"popstate"===r.type&&n(r.url,r.state)})}handleRouterEvent(n,r){if(n instanceof gR)this.stateMemento=this.createStateMemento();else if(n instanceof ew)this.rawUrlTree=r.initialUrl;else if(n instanceof bie){if("eager"===this.urlUpdateStrategy&&!r.extras.skipLocationChange){const i=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(i,r)}}else n instanceof Xj?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,"deferred"===this.urlUpdateStrategy&&(r.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,r))):n instanceof JC&&(n.code===df.GuardRejected||n.code===df.NoDataFromResolver)?this.restoreHistory(r):n instanceof bR?this.restoreHistory(r,!0):n instanceof U0&&(this.lastSuccessfulId=n.id,this.currentPageId=this.browserPageId)}setBrowserUrl(n,r){const i=this.urlSerializer.serialize(n);if(this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl){const s={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId)};this.location.replaceState(i,"",s)}else{const o={...r.extras.state,...this.generateNgRouterState(r.id,this.browserPageId+1)};this.location.go(i,"",o)}}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-this.browserPageId;0!==o?this.location.historyGo(o):this.currentUrlTree===n.finalUrl&&0===o&&(this.resetState(n),this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}static#e=this.\u0275fac=(()=>{let n;return function(i){return(n||(n=Wb(e)))(i||e)}})();static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();var s3=function(e){return e[e.COMPLETE=0]="COMPLETE",e[e.FAILED=1]="FAILED",e[e.REDIRECTING=2]="REDIRECTING",e}(s3||{});function Hie(e,t){e.events.pipe(xd(n=>n instanceof U0||n instanceof JC||n instanceof bR||n instanceof ew),hn(n=>n instanceof U0||n instanceof ew?s3.COMPLETE:n instanceof JC&&(n.code===df.Redirect||n.code===df.SupersededByNewNavigation)?s3.REDIRECTING:s3.FAILED),xd(n=>n!==s3.REDIRECTING),zx(1)).subscribe(()=>{t()})}function zNe(e){throw e}const VNe={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},HNe={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Nh=(()=>{class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=qt(Vte),this.stateManager=qt(Vie),this.options=qt(sw,{optional:!0})||{},this.pendingTasks=qt(_C),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=qt(CR),this.urlSerializer=qt(ZC),this.location=qt(qC),this.urlHandlingStrategy=qt(fU),this._events=new si,this.errorHandler=this.options.errorHandler||zNe,this.navigated=!1,this.routeReuseStrategy=qt(BNe),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=qt(aw,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!qt(vR,{optional:!0}),this.eventsSubscription=new Il,this.isNgZoneEnabled=qt(To)instanceof To&&To.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:n=>{this.console.warn(n)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){const n=this.navigationTransitions.events.subscribe(r=>{try{const i=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(null!==i&&null!==o)if(this.stateManager.handleRouterEvent(r,o),r instanceof JC&&r.code!==df.Redirect&&r.code!==df.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof U0)this.navigated=!0;else if(r instanceof Kj){const s=this.urlHandlingStrategy.merge(r.url,i.currentRawUrl),a={info:i.extras.info,skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||ONe(i.source)};this.scheduleNavigation(s,JT,null,a,{resolve:i.resolve,reject:i.reject,promise:i.promise})}(function qNe(e){return!(e instanceof Xj||e instanceof Kj)})(r)&&this._events.next(r)}catch(i){this.navigationTransitions.transitionAbortSubject.next(i)}});this.eventsSubscription.add(n)}resetRootComponentType(n){this.routerState.root.component=n,this.navigationTransitions.rootComponentType=n}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),JT,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((n,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(n,"popstate",r)},0)})}navigateToSyncWithBrowser(n,r,i){const o={replaceUrl:!0},s=i?.navigationId?i:null;if(i){const l={...i};delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(o.state=l)}const a=this.parseUrl(n);this.scheduleNavigation(a,r,s,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(n){this.config=n.map(oU),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(n,r={}){const{relativeTo:i,queryParams:o,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s;let d,u=null;switch(a){case"merge":u={...this.currentUrlTree.queryParams,...o};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=o||null}null!==u&&(u=this.removeEmptyProps(u));try{d=die(i?i.snapshot:this.routerState.snapshot.root)}catch{("string"!=typeof n[0]||!n[0].startsWith("/"))&&(n=[]),d=this.currentUrlTree.root}return fie(d,n,u,c??null)}navigateByUrl(n,r={skipLocationChange:!1}){const i=QC(n)?n:this.parseUrl(n),o=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(o,JT,null,r)}navigate(n,r={skipLocationChange:!1}){return function GNe(e){for(let t=0;t<e.length;t++)if(null==e[t])throw new Xt(4008,!1)}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){try{return this.urlSerializer.parse(n)}catch{return this.urlSerializer.parse("/")}}isActive(n,r){let i;if(i=!0===r?{...VNe}:!1===r?{...HNe}:r,QC(n))return nie(this.currentUrlTree,n,i);const o=this.parseUrl(n);return nie(this.currentUrlTree,o,i)}removeEmptyProps(n){return Object.entries(n).reduce((r,[i,o])=>(null!=o&&(r[i]=o),r),{})}scheduleNavigation(n,r,i,o,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,f)=>{a=d,l=f});const u=this.pendingTasks.add();return Hie(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:o,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})(),wR=(()=>{class e{constructor(n,r,i,o,s,a){this.router=n,this.route=r,this.tabIndexAttribute=i,this.renderer=o,this.el=s,this.locationStrategy=a,this.href=null,this.commands=null,this.onChanges=new si,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;const l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===l||"area"===l,this.isAnchorElement?this.subscription=n.events.subscribe(c=>{c instanceof U0&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",n)}ngOnChanges(n){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(n,r,i,o,s){const a=this.urlTree;return!!(null===a||this.isAnchorElement&&(0!==n||r||i||o||s||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(a,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){const n=this.urlTree;this.href=null!==n&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(n)):null;const r=null===this.href?null:function _Z(e,t,n){return function iwe(e,t){return"src"===t&&("embed"===e||"frame"===e||"iframe"===e||"media"===e||"script"===e)||"href"===t&&("base"===e||"link"===e)?xZ:vZ}(t,n)(e)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(n,r){const i=this.renderer,o=this.el.nativeElement;null!==r?i.setAttribute(o,n,r):i.removeAttribute(o,n)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static#e=this.\u0275fac=function(r){return new(r||e)(On(Nh),On(nw),function Vm(e){return function ja(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;const n=e.attrs;if(n){const r=n.length;let i=0;for(;i<r;){const o=n[i];if(cE(o))break;if(0===o)i+=2;else if("number"==typeof o)for(i++;i<r&&"string"==typeof n[i];)i++;else{if(o===t)return n[i+1];i+=2}}}return null}(ro(),e)}("tabindex"),On(a4),On(Ua),On(jx))};static#t=this.\u0275dir=Ja({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,i){1&r&&Fx("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&r&&g8("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[ud.HasDecoratorInputTransform,"preserveFragment","preserveFragment",sj],skipLocationChange:[ud.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",sj],replaceUrl:[ud.HasDecoratorInputTransform,"replaceUrl","replaceUrl",sj],routerLink:"routerLink"},standalone:!0,features:[fJ,Oo]})}return e})();class Gie{}let YNe=(()=>{class e{constructor(n,r,i,o,s){this.router=n,this.injector=i,this.preloadingStrategy=o,this.loader=s}setUpPreloading(){this.subscription=this.router.events.pipe(xd(n=>n instanceof U0),$T(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const i=[];for(const o of r){o.providers&&!o._injector&&(o._injector=f4(o.providers,n,`Route: ${o.path}`));const s=o._injector??n,a=o._loadedInjector??s;(o.loadChildren&&!o._loadedRoutes&&void 0===o.canLoad||o.loadComponent&&!o._loadedComponent)&&i.push(this.preloadConfig(s,o)),(o.children||o._loadedRoutes)&&i.push(this.processRoutes(a,o.children??o._loadedRoutes))}return Is(i).pipe(Ux())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let i;i=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Mr(null);const o=i.pipe(Xc(s=>null===s?Mr(void 0):(r._loadedRoutes=s.routes,r._loadedInjector=s.injector,this.processRoutes(s.injector??n,s.routes))));return r.loadComponent&&!r._loadedComponent?Is([o,this.loader.loadComponent(r)]).pipe(Ux()):o})}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(Nh),Rn(Qte),Rn(Na),Rn(Gie),Rn(dU))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();const pU=new jn("");let qie=(()=>{class e{constructor(n,r,i,o,s={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=i,this.zone=o,this.options=s,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},s.scrollPositionRestoration||="disabled",s.anchorScrolling||="disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof gR?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof U0?(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment)):n instanceof ew&&n.code===yR.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof vie&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new vie(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}static#e=this.\u0275fac=function(r){!function WZ(){throw new Error("invalid")}()};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac})}return e})();function Wie(e){return e.routerState.root}function eg(e,t){return{\u0275kind:e,\u0275providers:t}}function $ie(){const e=qt(Jl);return t=>{const n=e.get(l1);if(t!==n.components[0])return;const r=e.get(Nh),i=e.get(Yie);1===e.get(hU)&&r.initialNavigation(),e.get(Xie,null,gi.Optional)?.setUpPreloading(),e.get(pU,null,gi.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}const Yie=new jn("",{factory:()=>new si}),hU=new jn("",{providedIn:"root",factory:()=>1}),Xie=new jn("");function JNe(e){return eg(0,[{provide:Xie,useExisting:YNe},{provide:Gie,useExisting:e}])}function tFe(e){return eg(9,[{provide:Uie,useValue:NNe},{provide:zie,useValue:{skipNextTransition:!!e?.skipInitialTransition,...e}}])}const Kie=new jn("ROUTER_FORROOT_GUARD"),nFe=[qC,{provide:ZC,useClass:Gj},Nh,e3,{provide:nw,useFactory:Wie,deps:[Nh]},dU,[]];let mU=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[nFe,[],{provide:aw,multi:!0,useValue:n},{provide:Kie,useFactory:sFe,deps:[[Nh,new $v,new fS]]},{provide:sw,useValue:r||{}},r?.useHash?{provide:jx,useClass:mke}:{provide:jx,useClass:zne},{provide:pU,useFactory:()=>{const e=qt(BMe),t=qt(To),n=qt(sw),r=qt(CR),i=qt(ZC);return n.scrollOffset&&e.setOffset(n.scrollOffset),new qie(i,r,e,t,n)}},r?.preloadingStrategy?JNe(r.preloadingStrategy).\u0275providers:[],r?.initialNavigation?aFe(r):[],r?.bindToComponentInputs?eg(8,[Iie,{provide:vR,useExisting:Iie}]).\u0275providers:[],r?.enableViewTransitions?tFe().\u0275providers:[],[{provide:Zie,useFactory:$ie},{provide:F4,multi:!0,useExisting:Zie}]]}}static forChild(n){return{ngModule:e,providers:[{provide:aw,multi:!0,useValue:n}]}}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(Kie,8))};static#t=this.\u0275mod=g0({type:e});static#n=this.\u0275inj=c0({})}return e})();function sFe(e){return"guarded"}function aFe(e){return["disabled"===e.initialNavigation?eg(3,[{provide:Y8,multi:!0,useFactory:()=>{const t=qt(Nh);return()=>{t.setUpLocationChangeListener()}}},{provide:hU,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?eg(2,[{provide:hU,useValue:0},{provide:Y8,multi:!0,deps:[Jl],useFactory:t=>{const n=t.get(pke,Promise.resolve());return()=>n.then(()=>new Promise(r=>{const i=t.get(Nh),o=t.get(Yie);Hie(i,()=>{r(!0)}),t.get(CR).afterPreactivation=()=>(r(!0),o.closed?Mr(void 0):o),i.initialNavigation()}))}}]).\u0275providers:[]]}const Zie=new jn(""),gU={now:()=>(gU.delegate||Date).now(),delegate:void 0};class Fh extends si{constructor(t=1/0,n=1/0,r=gU){super(),this._bufferSize=t,this._windowTime=n,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=n===1/0,this._bufferSize=Math.max(1,t),this._windowTime=Math.max(1,n)}next(t){const{isStopped:n,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:o,_windowTime:s}=this;n||(r.push(t),!i&&r.push(o.now()+s)),this._trimBuffer(),super.next(t)}_subscribe(t){this._throwIfClosed(),this._trimBuffer();const n=this._innerSubscribe(t),{_infiniteTimeWindow:r,_buffer:i}=this,o=i.slice();for(let s=0;s<o.length&&!t.closed;s+=r?1:2)t.next(o[s]);return this._checkFinalizedStatuses(t),n}_trimBuffer(){const{_bufferSize:t,_timestampProvider:n,_buffer:r,_infiniteTimeWindow:i}=this,o=(i?1:2)*t;if(t<1/0&&o<r.length&&r.splice(0,r.length-o),!i){const s=n.now();let a=0;for(let l=1;l<r.length&&r[l]<=s;l+=2)a=l;a&&r.splice(0,a+1)}}}function yU(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new Mv({next:()=>{r.unsubscribe(),e()}});return vd(t(...n)).subscribe(r)}function ff(e,t,n){let r,i=!1;return e&&"object"==typeof e?({bufferSize:r=1/0,windowTime:t=1/0,refCount:i=!1,scheduler:n}=e):r=e??1/0,function uFe(e={}){const{connector:t=(()=>new si),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=e;return o=>{let s,a,l,c=0,u=!1,d=!1;const f=()=>{a?.unsubscribe(),a=void 0},p=()=>{f(),s=l=void 0,u=d=!1},m=()=>{const h=s;p(),h?.unsubscribe()};return is((h,g)=>{c++,!d&&!u&&f();const y=l=l??t();g.add(()=>{c--,0===c&&!d&&!u&&(a=yU(m,i))}),y.subscribe(g),!s&&c>0&&(s=new Mv({next:v=>y.next(v),error:v=>{d=!0,f(),a=yU(p,n,v),y.error(v)},complete:()=>{u=!0,f(),a=yU(p,r),y.complete()}}),vd(h).subscribe(s))})(o)}}({connector:()=>new Fh(r,t,n),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:i})}const{isArray:dFe}=Array;function Qie(e){return 1===e.length&&dFe(e[0])?e[0]:e}function Jie(...e){const t=Bj(e);return t?YI(Jie(...e),$re(t)):is((n,r)=>{Yre([n,...Qie(e)])(r)})}function z0(...e){return Jie(...e)}var Mc,e,ci;(e=Mc||(Mc={})).create=function t(i){return i},e.has=function n(i,o){return!!(i&o)},e.hasAll=function r(i,o){return!!o&&(i&o)===o},function(e){e.create=function t(_=512){return{current:[],offset:0,capacity:_,chunks:[]}},e.getString=function n(_){return _.chunks.length?(_.offset>0&&(_.chunks[_.chunks.length]=_.current.length===_.offset?_.current.join(""):_.current.slice(0,_.offset).join("")),_.chunks.join("")):_.current.length===_.offset?_.current.join(""):_.current.splice(0,_.offset).join("")},e.getSize=function r(_){let w=0;for(const A of _.chunks)w+=A.length;for(let A=0;A<_.offset;A++)w+=_.current[A].length;return w},e.getChunks=function i(_){return _.offset>0&&(_.chunks[_.chunks.length]=_.current.length===_.offset?_.current.join(""):_.current.slice(0,_.offset).join(""),_.offset=0),_.chunks};const o=[];function a(_,w){w>0&&u(_,o[w])}function u(_,w){_.offset===_.capacity&&(_.chunks[_.chunks.length]=_.current.join(""),_.offset=0),_.current[_.offset++]=w}!function(){let _="";for(let w=0;w<512;w++)o[w]=_,_+=" "}(),e.newline=function s(_){u(_,"\n")},e.whitespace=a,e.whitespace1=function l(_){u(_," ")},e.write=function c(_,w){w&&(_.offset===_.capacity&&(_.chunks[_.chunks.length]=_.current.join(""),_.offset=0),_.current[_.offset++]=w)},e.writeSafe=u,e.writePadLeft=function d(_,w,A){w?(a(_,A-w.length),u(_,w)):a(_,A)},e.writePadRight=function f(_,w,A){if(!w)return void a(_,A);const M=A-w.length;u(_,w),a(_,M)},e.writeInteger=function p(_,w){u(_,""+w)},e.writeIntegerAndSpace=function m(_,w){u(_,w+" ")},e.writeIntegerPadLeft=function h(_,w,A){const M=""+w;a(_,A-M.length),u(_,M)},e.writeIntegerPadRight=function g(_,w,A){const M=""+w,E=A-M.length;u(_,M),a(_,E)},e.writeFloat=function y(_,w,A){u(_,""+Math.round(A*w)/A)},e.writeFloatPadLeft=function v(_,w,A,M){const E=""+Math.round(A*w)/A;a(_,M-E.length),u(_,E)},e.writeFloatPadRight=function x(_,w,A,M){const E=""+Math.round(A*w)/A,D=M-E.length;u(_,E),a(_,D)}}(ci||(ci={}));const Bo=function(){if(typeof window<"u"&&window.performance){const e=window.performance;return()=>e.now()}return typeof process<"u"&&"undefined"!==process.hrtime&&"function"==typeof process.hrtime?()=>{const e=process.hrtime();return 1e3*e[0]+e[1]/1e6}:Date.now?()=>Date.now():()=>+new Date}();function AR(e,t=!0){if(isNaN(e))return"n/a";const n=Math.floor(e/36e5),r=Math.floor(e/6e4%60),i=Math.floor(e/1e3%60);let o=Math.floor(e%1e3).toString();for(;o.length<3;)o="0"+o;for(;!t&&o.length>1&&"0"===o[o.length-1];)o=o.substr(0,o.length-1);return n>0?`${n}h${r}m${i}.${o}s`:r>0?`${r}m${i}.${o}s`:i>0?`${i}.${o}s`:`${e.toFixed(0)}ms`}var oo,eoe,a3;function fFe(e,t){return e-t}function Kc(e=0,t=Number.MAX_SAFE_INTEGER){let n=e;return()=>{const r=n;return n=(n+1)%t,r}}!function(e){const t=typeof btoa<"u"?btoa:s=>Buffer.from(s).toString("base64"),n=[];e.create22=function r(){let s=+new Date+Bo();for(let a=0;a<16;a++)n[a]=String.fromCharCode((s+255*Math.random())%255|0),s=Math.floor(s/255);return t(n.join("")).replace(/\+/g,"-").replace(/\//g,"_").substr(0,22)},e.createv4=function i(){let s=+new Date+Bo();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(l){const c=(s+16*Math.random())%16|0;return s=Math.floor(s/16),("x"===l?c:3&c|8).toString(16)})},e.is=function o(s){return"string"==typeof s}}(oo||(oo={})),function(e){class t{has(m){return!1}forEach(m,h){return h}constructor(){this.size=0}}class n{has(m){return m===this.idx}forEach(m,h){return m(this.idx,h),h}constructor(m){this.idx=m,this.size=1}}class r{has(m){return m<this.length&&!!this.mask[m]}_forEach(m,h){for(let g=0;g<this.length;g++)this.mask[g]&&m(g,h)}forEach(m,h){return this._forEach(m,h),h}constructor(m,h){this.mask=m,this.size=h,this.length=m.length}}class i{has(m){return!0}_forEach(m,h){for(let g=0;g<this.size;g++)m(g,h)}forEach(m,h){return this._forEach(m,h),h}constructor(m){this.size=m}}class o{has(m){return this.set.has(m)}_forEach(m,h){for(const g of this.flatten())m(g,h)}flatten(){if(this._flat)return this._flat;const m=new Int32Array(this.size);let h=0;return this.set.forEach(g=>m[h++]=g),function pFe(e){Array.prototype.sort.call(e,fFe)}(m),this._flat=m,this._flat}forEach(m,h){return this._forEach(m,h),h}constructor(m){this.set=m,this._flat=void 0,this.size=m.size}}function a(p){return new o(p)}function u(p,m){return new r(p,m)}e.always=function s(p){return new i(p)},e.never=new t,e.ofSet=a,e.singleton=function l(p){return new n(p)},e.ofUniqueIndices=function c(p){const m=p.length;if(0===m)return new t;if(1===m)return new n(p[0]);let h=0;for(const v of p)v>h&&(h=v);if(m===h)return new i(m);if(m/h<1/12){const v=new Set;for(const x of p)v.add(x);return new o(v)}const y=new Int8Array(h+1);for(const v of p)y[v]=1;return new r(y,p.length)},e.ofMask=u,e.hasAny=function d(p,m){for(const h of m)if(p.has(h))return!0;return!1},e.complement=function f(p,m){let h=0,g=0;if(m.forEach(y=>{p.has(y)||(h++,y>g&&(g=y))}),h/g<1/12){const y=new Set;return m.forEach(v=>{p.has(v)||y.add(v)}),a(y)}{const y=new Uint8Array(g+1);return m.forEach(v=>{p.has(v)||(y[v]=1)}),u(y,h)}}}(eoe||(eoe={})),function(e){e.create=function t(r){return{ref:r}},e.set=function n(r,i){return r.ref=i,r}}(a3||(a3={}));const hFe=Kc(0,2147483647);var f1,O;!function(e){e.create=function t(r,i){return{id:hFe(),version:0,value:r,metadata:i}},e.withValue=function n(r,i){return{id:r.id,version:r.version+1,value:i,metadata:r.metadata}}}(f1||(f1={})),function(e){function n(o,s){return a3.set(o,f1.withValue(o.ref,s))}e.create=function t(o,s){return a3.create(f1.create(o,s))},e.update=n,e.set=function r(o,s){return a3.set(o,s)},e.updateIfChanged=function i(o,s){return o.ref.value!==s?n(o,s):o}}(O||(O={}));const rp=function(){};function Ru(e,t){const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}const IR=Object.prototype.hasOwnProperty;function tg(e,t){if(e===t)return!0;const n=Array.isArray(e),r=Array.isArray(t);if(n&&r){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!tg(e[i],t[i]))return!1;return!0}if(n!==r)return!1;if(e&&t&&"object"==typeof e&&"object"==typeof t){const i=Object.keys(e);if(i.length!==Object.keys(t).length)return!1;const o=e instanceof Date,s=t instanceof Date;if(o&&s)return e.getTime()===t.getTime();if(o!==s)return!1;const a=e instanceof RegExp,l=t instanceof RegExp;if(a&&l)return e.toString()===t.toString();if(a!==l)return!1;for(let c=0;c<i.length;c++)if(!IR.call(t,i[c]))return!1;for(let c=0;c<i.length;c++)if(!tg(e[i[c]],t[i[c]]))return!1;return!0}return!1}function l3(e,t){if(e===t)return!0;const n=Array.isArray(e),r=Array.isArray(t);return n&&r?function mFe(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1;return!0}(e,t):n===r&&!(!e||!t||"object"!=typeof e||"object"!=typeof t)&&lw(e,t)}function lw(e,t){if(e===t)return!0;if(!e||!t)return!1;const n=Object.keys(e);if(Object.keys(t).length!==n.length)return!1;for(const r of n)if(!IR.call(e,r)||e[r]!==t[r])return!1;return!0}function Ll(e,t){return void 0!==e?e:t}function noe(e){return(e<10?"0":"")+e}function xFe(e){const t=e.getHours(),n=e.getMinutes(),r=e.getSeconds();return`${t}:${noe(n)}:${noe(r)}`}function cw(e,t){return{start:t&&typeof t.start<"u"?Math.max(Math.min(t.start,e-1),0):0,end:t&&typeof t.end<"u"?Math.min(t.end,e):e}}function c3(e,t){const n=t&&typeof t.array<"u"?t.array:Array,{start:r,end:i}=cw(e,t);return{array:new n(i-r),start:r,end:i}}function tc(e,t,n){const{array:r,start:i}=c3(e,n);return function _Fe(e,t,n){for(let r=0,i=t.length;r<i;r++)t[r]=e(n+r);return t}(t,r,i)}function bU(e){return!!e.buffer&&"number"==typeof e.byteLength&&"number"==typeof e.BYTES_PER_ELEMENT}function ER(e,t){const{constructor:n,buffer:r,length:i,byteOffset:o,BYTES_PER_ELEMENT:s}=e,{start:a,end:l}=cw(i,t);return 0===a&&l===i?e:new n(r,o+s*a,Math.min(i,l-a))}const wi=1e-6;function Do(e,t,n){return Math.abs(e-t)<=n}function al(e,t,n){return Math.max(t,Math.min(n,e))}function Po(e,t,n){return e+(t-e)*n}function TR(e,t,n,r,i,o){const s=(n-e)*o,a=(r-t)*o,l=i*i;return(2*t-2*n+s+a)*(i*l)+(-3*t+3*n-2*s-a)*l+s*i+t}function _U(e,t,n,r){const i=1-r;return i*i*e+2*i*r*t+r*r*n}function roe(e,t,n){return(n=function xU(e){return al(e,0,1)}(function vU(e,t,n){return(e-t)/(n-t)}(n,e,t)))*n*(3-2*n)}const SU=isFinite;function C(){return C.zero()}!function(e){function t(){const ye=[.1,0,0];return ye[0]=0,ye}function u(ye,we,Te){const je=t();return je[0]=ye,je[1]=we,je[2]=Te,je}function p(ye,we){return ye[0]=we[0],ye[1]=we[1],ye[2]=we[2],ye}function m(ye,we,Te){return ye[0]=we[0]+Te[0],ye[1]=we[1]+Te[1],ye[2]=we[2]+Te[2],ye}function h(ye,we,Te){return ye[0]=we[0]-Te[0],ye[1]=we[1]-Te[1],ye[2]=we[2]-Te[2],ye}function v(ye,we,Te){return ye[0]=we[0]*Te,ye[1]=we[1]*Te,ye[2]=we[2]*Te,ye}function x(ye,we,Te,je){return ye[0]=we[0]+Te[0]*je,ye[1]=we[1]+Te[1]*je,ye[2]=we[2]+Te[2]*je,ye}function V(ye){const we=ye[0],Te=ye[1],je=ye[2];return we*we+Te*Te+je*je}function H(ye,we){return ye[0]=-we[0],ye[1]=-we[1],ye[2]=-we[2],ye}function te(ye,we){const Te=we[0],je=we[1],Ft=we[2];let Vt=Te*Te+je*je+Ft*Ft;return Vt>0&&(Vt=1/Math.sqrt(Vt),ye[0]=we[0]*Vt,ye[1]=we[1]*Vt,ye[2]=we[2]*Vt),ye}function K(ye,we){return ye[0]*we[0]+ye[1]*we[1]+ye[2]*we[2]}function Q(ye,we,Te){const je=we[0],Ft=we[1],Vt=we[2],pn=Te[0],Pr=Te[1],Jn=Te[2];return ye[0]=Ft*Jn-Vt*Pr,ye[1]=Vt*pn-je*Jn,ye[2]=je*Pr-Ft*pn,ye}e.zero=t,e.clone=function n(ye){const we=t();return we[0]=ye[0],we[1]=ye[1],we[2]=ye[2],we},e.isFinite=function r(ye){return SU(ye[0])&&SU(ye[1])&&SU(ye[2])},e.hasNaN=function i(ye){return isNaN(ye[0])||isNaN(ye[1])||isNaN(ye[2])},e.setNaN=function o(ye){return ye[0]=NaN,ye[1]=NaN,ye[2]=NaN,ye},e.fromObj=function s(ye){return u(ye.x,ye.y,ye.z)},e.toObj=function a(ye){return{x:ye[0],y:ye[1],z:ye[2]}},e.fromArray=function l(ye,we,Te){return ye[0]=we[Te+0],ye[1]=we[Te+1],ye[2]=we[Te+2],ye},e.toArray=function c(ye,we,Te){return we[Te+0]=ye[0],we[Te+1]=ye[1],we[Te+2]=ye[2],we},e.create=u,e.ofArray=function d(ye){const we=t();return we[0]=ye[0],we[1]=ye[1],we[2]=ye[2],we},e.set=function f(ye,we,Te,je){return ye[0]=we,ye[1]=Te,ye[2]=je,ye},e.copy=p,e.add=m,e.sub=h,e.mul=function g(ye,we,Te){return ye[0]=we[0]*Te[0],ye[1]=we[1]*Te[1],ye[2]=we[2]*Te[2],ye},e.div=function y(ye,we,Te){return ye[0]=we[0]/Te[0],ye[1]=we[1]/Te[1],ye[2]=we[2]/Te[2],ye},e.scale=v,e.scaleAndAdd=x,e.scaleAndSub=function _(ye,we,Te,je){return ye[0]=we[0]-Te[0]*je,ye[1]=we[1]-Te[1]*je,ye[2]=we[2]-Te[2]*je,ye},e.addScalar=function w(ye,we,Te){return ye[0]=we[0]+Te,ye[1]=we[1]+Te,ye[2]=we[2]+Te,ye},e.subScalar=function A(ye,we,Te){return ye[0]=we[0]-Te,ye[1]=we[1]-Te,ye[2]=we[2]-Te,ye},e.round=function M(ye,we){return ye[0]=Math.round(we[0]),ye[1]=Math.round(we[1]),ye[2]=Math.round(we[2]),ye},e.ceil=function E(ye,we){return ye[0]=Math.ceil(we[0]),ye[1]=Math.ceil(we[1]),ye[2]=Math.ceil(we[2]),ye},e.floor=function D(ye,we){return ye[0]=Math.floor(we[0]),ye[1]=Math.floor(we[1]),ye[2]=Math.floor(we[2]),ye},e.trunc=function T(ye,we){return ye[0]=Math.trunc(we[0]),ye[1]=Math.trunc(we[1]),ye[2]=Math.trunc(we[2]),ye},e.abs=function F(ye,we){return ye[0]=Math.abs(we[0]),ye[1]=Math.abs(we[1]),ye[2]=Math.abs(we[2]),ye},e.min=function R(ye,we,Te){return ye[0]=Math.min(we[0],Te[0]),ye[1]=Math.min(we[1],Te[1]),ye[2]=Math.min(we[2],Te[2]),ye},e.max=function N(ye,we,Te){return ye[0]=Math.max(we[0],Te[0]),ye[1]=Math.max(we[1],Te[1]),ye[2]=Math.max(we[2],Te[2]),ye},e.clamp=function j(ye,we,Te,je){return ye[0]=Math.max(Te[0],Math.min(je[0],we[0])),ye[1]=Math.max(Te[1],Math.min(je[1],we[1])),ye[2]=Math.max(Te[2],Math.min(je[2],we[2])),ye},e.distance=function W(ye,we){const Te=we[0]-ye[0],je=we[1]-ye[1],Ft=we[2]-ye[2];return Math.sqrt(Te*Te+je*je+Ft*Ft)},e.squaredDistance=function z(ye,we){const Te=we[0]-ye[0],je=we[1]-ye[1],Ft=we[2]-ye[2];return Te*Te+je*je+Ft*Ft},e.magnitude=function $(ye){const we=ye[0],Te=ye[1],je=ye[2];return Math.sqrt(we*we+Te*Te+je*je)},e.squaredMagnitude=V,e.setMagnitude=function X(ye,we,Te){return v(ye,te(ye,we),Te)},e.negate=H,e.inverse=function oe(ye,we){return ye[0]=1/we[0],ye[1]=1/we[1],ye[2]=1/we[2],ye},e.normalize=te,e.dot=K,e.cross=Q,e.lerp=function G(ye,we,Te,je){const Ft=we[0],Vt=we[1],pn=we[2];return ye[0]=Ft+je*(Te[0]-Ft),ye[1]=Vt+je*(Te[1]-Vt),ye[2]=pn+je*(Te[2]-pn),ye};const Z=t();function ue(ye,we){const Te=Math.sqrt(V(ye)*V(we));if(0===Te)return Math.PI/2;const je=K(ye,we)/Te;return Math.acos(al(je,-1,1))}e.slerp=function ee(ye,we,Te,je){const Ft=al(K(we,Te),-1,1),Vt=Math.acos(Ft)*je;return x(Z,Te,we,-Ft),te(Z,Z),m(ye,v(ye,we,Math.cos(Vt)),v(Z,Z,Math.sin(Vt)))},e.hermite=function se(ye,we,Te,je,Ft,Vt){const pn=Vt*Vt,Pr=pn*(2*Vt-3)+1,Jn=pn*(Vt-2)+Vt,bi=pn*(Vt-1),ns=pn*(3-2*Vt);return ye[0]=we[0]*Pr+Te[0]*Jn+je[0]*bi+Ft[0]*ns,ye[1]=we[1]*Pr+Te[1]*Jn+je[1]*bi+Ft[1]*ns,ye[2]=we[2]*Pr+Te[2]*Jn+je[2]*bi+Ft[2]*ns,ye},e.bezier=function xe(ye,we,Te,je,Ft,Vt){const pn=1-Vt,Pr=pn*pn,Jn=Vt*Vt,bi=Pr*pn,ns=3*Vt*Pr,_c=3*Jn*pn,Js=Jn*Vt;return ye[0]=we[0]*bi+Te[0]*ns+je[0]*_c+Ft[0]*Js,ye[1]=we[1]*bi+Te[1]*ns+je[1]*_c+Ft[1]*Js,ye[2]=we[2]*bi+Te[2]*ns+je[2]*_c+Ft[2]*Js,ye},e.quadraticBezier=function re(ye,we,Te,je,Ft){return ye[0]=_U(we[0],Te[0],je[0],Ft),ye[1]=_U(we[1],Te[1],je[1],Ft),ye[2]=_U(we[2],Te[2],je[2],Ft),ye},e.spline=function ae(ye,we,Te,je,Ft,Vt,pn){return ye[0]=TR(we[0],Te[0],je[0],Ft[0],Vt,pn),ye[1]=TR(we[1],Te[1],je[1],Ft[1],Vt,pn),ye[2]=TR(we[2],Te[2],je[2],Ft[2],Vt,pn),ye},e.random=function ge(ye,we){const Te=2*Math.random()*Math.PI,je=2*Math.random()-1,Ft=Math.sqrt(1-je*je)*we;return ye[0]=Math.cos(Te)*Ft,ye[1]=Math.sin(Te)*Ft,ye[2]=je*we,ye},e.transformMat4=function Ie(ye,we,Te){const je=we[0],Ft=we[1],Vt=we[2],pn=1/(Te[3]*je+Te[7]*Ft+Te[11]*Vt+Te[15]||1);return ye[0]=(Te[0]*je+Te[4]*Ft+Te[8]*Vt+Te[12])*pn,ye[1]=(Te[1]*je+Te[5]*Ft+Te[9]*Vt+Te[13])*pn,ye[2]=(Te[2]*je+Te[6]*Ft+Te[10]*Vt+Te[14])*pn,ye},e.transformDirection=function me(ye,we,Te){const je=we[0],Ft=we[1],Vt=we[2];return ye[0]=Te[0]*je+Te[4]*Ft+Te[8]*Vt,ye[1]=Te[1]*je+Te[5]*Ft+Te[9]*Vt,ye[2]=Te[2]*je+Te[6]*Ft+Te[10]*Vt,te(ye,ye)},e.transformMat4Offset=function Ae(ye,we,Te,je,Ft,Vt){const pn=we[0+Ft],Pr=we[1+Ft],Jn=we[2+Ft],bi=1/(Te[3+Vt]*pn+Te[7+Vt]*Pr+Te[11+Vt]*Jn+Te[15+Vt]||1);return ye[0+je]=(Te[0+Vt]*pn+Te[4+Vt]*Pr+Te[8+Vt]*Jn+Te[12+Vt])*bi,ye[1+je]=(Te[1+Vt]*pn+Te[5+Vt]*Pr+Te[9+Vt]*Jn+Te[13+Vt])*bi,ye[2+je]=(Te[2+Vt]*pn+Te[6+Vt]*Pr+Te[10+Vt]*Jn+Te[14+Vt])*bi,ye},e.transformMat3=function he(ye,we,Te){const je=we[0],Ft=we[1],Vt=we[2];return ye[0]=je*Te[0]+Ft*Te[3]+Vt*Te[6],ye[1]=je*Te[1]+Ft*Te[4]+Vt*Te[7],ye[2]=je*Te[2]+Ft*Te[5]+Vt*Te[8],ye},e.transformQuat=function ie(ye,we,Te){const je=we[0],Ft=we[1],Vt=we[2],pn=Te[0],Pr=Te[1],Jn=Te[2],bi=Te[3],ns=bi*je+Pr*Vt-Jn*Ft,_c=bi*Ft+Jn*je-pn*Vt,Js=bi*Vt+pn*Ft-Pr*je,id=-pn*je-Pr*Ft-Jn*Vt;return ye[0]=ns*bi+id*-pn+_c*-Jn-Js*-Pr,ye[1]=_c*bi+id*-Pr+Js*-pn-ns*-Jn,ye[2]=Js*bi+id*-Jn+ns*-Pr-_c*-pn,ye},e.angle=ue;const _e=t(),Fe=t(),Ze=t(),ct=t(),q=t(),ne=t(),be=t();e.dihedralAngle=function Ce(ye,we,Te,je){h(_e,ye,we),h(Fe,Te,we),h(Ze,we,Te),h(ct,je,Te),Q(q,_e,Fe),Q(ne,Ze,ct);const Ft=ue(q,ne);return Q(be,q,ne),K(Fe,be)>0?Ft:-Ft},e.directionFromSpherical=function Re(ye,we,Te,je){return e.set(ye,je*Math.cos(Te)*Math.sin(we),je*Math.sin(Te)*Math.sin(we),je*Math.cos(we))},e.exactEquals=function Be(ye,we){return ye[0]===we[0]&&ye[1]===we[1]&&ye[2]===we[2]},e.equals=function $e(ye,we){const Te=ye[0],je=ye[1],Ft=ye[2],Vt=we[0],pn=we[1],Pr=we[2];return Math.abs(Te-Vt)<=wi*Math.max(1,Math.abs(Te),Math.abs(Vt))&&Math.abs(je-pn)<=wi*Math.max(1,Math.abs(je),Math.abs(pn))&&Math.abs(Ft-Pr)<=wi*Math.max(1,Math.abs(Ft),Math.abs(Pr))};const nt=t();e.makeRotation=function ht(ye,we,Te){const je=ue(we,Te);if(Math.abs(je)<1e-4)return fe.setIdentity(ye);if(Math.abs(je-Math.PI)<wi)return fe.fromScaling(ye,e.negUnit);const Ft=Q(nt,we,Te);return fe.fromRotation(ye,je,Ft)},e.isZero=function Ge(ye){return 0===ye[0]&&0===ye[1]&&0===ye[2]},e.projectPointOnVector=function ft(ye,we,Te,je){return h(ye,we,je),m(ye,v(ye,Te,K(Te,ye)/V(Te)),je)};const vt=t();function St(ye,we,Te){return v(ye,Te,K(Te,we)/V(Te))}e.projectPointOnPlane=function Pt(ye,we,Te,je){return te(vt,Te),h(ye,we,je),h(ye,we,v(vt,vt,K(ye,vt)))},e.projectOnVector=St;const Mt=t();e.projectOnPlane=function Qt(ye,we,Te){return St(Mt,we,Te),h(ye,we,Mt)},e.orthogonalize=function An(ye,we,Te){return te(ye,Q(ye,Q(ye,we,Te),we))},e.matchDirection=function Kn(ye,we,Te){return K(we,Te)>0?p(ye,we):H(ye,p(ye,we)),ye};const ti=t(),ut=t();e.triangleNormal=function Et(ye,we,Te,je){return h(ti,Te,we),h(ut,je,we),te(ye,Q(ye,ti,ut))},e.toString=function Nt(ye,we){return`[${ye[0].toPrecision(we)} ${ye[1].toPrecision(we)} ${ye[2].toPrecision(we)}]`},e.origin=u(0,0,0),e.unit=u(1,1,1),e.negUnit=u(-1,-1,-1),e.unitX=u(1,0,0),e.unitY=u(0,1,0),e.unitZ=u(0,0,1),e.negUnitX=u(-1,0,0),e.negUnitY=u(0,-1,0),e.negUnitZ=u(0,0,-1)}(C||(C={}));const u3=Math.PI/2,ioe=Math.PI/180;function Xr(e){return e*ioe}function pf(e){return e/ioe}function d3(e){return 0!==e&&!(e&e-1)}function ooe(e,t){return e*t}function fe(){return fe.zero()}function In(){return In.zero()}function Ue(){return Ue.zero()}function Bn(){return Bn.zero()}function DR(e){return Object.keys(e)}function Hi(e){throw new Error("unreachable")}function PR(e){return"function"==typeof e?.then}function Ai(){return Ai.zero()}var mr,ce,Kr,wU,Wx,f3;function Gx(e,t,n){for(;t<n&&32===e.charCodeAt(t);)t++;return p1(e,t,n)}function p1(e,t,n){let r=t,i=0,o=1;for(45===e.charCodeAt(r)?(o=-1,++r):43===e.charCodeAt(r)&&++r;r<n;r++){const s=e.charCodeAt(r)-48;if(s>9||s<0)return o*i|0;i=10*i+s|0}return o*i}function soe(e,t,n,r){return 43===t.charCodeAt(n)&&n++,e*Math.pow(10,p1(t,n,r))}function V0(e,t,n){let r=t,i=1,o=0,s=0,a=1;for(45===e.charCodeAt(r)?(i=-1,++r):43===e.charCodeAt(r)&&++r;r<n;){let l=e.charCodeAt(r)-48;if(!(l>=0&&l<10)){if(-2===l){for(++r;r<n;){if(l=e.charCodeAt(r)-48,!(l>=0&&l<10))return 53===l||21===l?soe(i*(o+s/a),e,r+1,n):i*(o+s/a);s=10*s+l,a*=10,++r}return i*(o+s/a)}if(53===l||21===l)return soe(i*o,e,r+1,n);break}o=10*o+l,++r}return i*o}function loe(e,t,n,r){return{schema:n,__array:void 0,isDefined:0===r,rowCount:t,value:o=>e,valueKind:o=>r,toArray:o=>{const{array:s}=c3(t,o);for(let a=0,l=s.length;a<l;a++)s[a]=e;return s},areValuesEqual:(o,s)=>!0}}function kR({value:e,valueKind:t,areValuesEqual:n,rowCount:r,schema:i}){return{schema:i,__array:void 0,isDefined:!0,rowCount:r,value:e,valueKind:t||(o=>0),toArray:o=>{const{array:s,start:a}=c3(r,o);for(let l=0,c=s.length;l<c;l++)s[l]=e(l+a);return s},areValuesEqual:n||((o,s)=>e(o)===e(s))}}function H0({array:e,schema:t,valueKind:n}){const r=e.length,i=t.T,o="str"===t.valueType?"lowercase"===t.transform?a=>{const l=e[a];return"string"==typeof l?l.toLowerCase():`${l??i}`.toLowerCase()}:"uppercase"===t.transform?a=>{const l=e[a];return"string"==typeof l?l.toUpperCase():`${l??i}`.toUpperCase()}:a=>{const l=e[a];return"string"==typeof l?l:`${l??i}`}:a=>e[a],s=bU(e);return{schema:t,__array:e,isDefined:!0,rowCount:r,value:o,valueKind:n||(a=>0),toArray:"str"===t.valueType?"lowercase"===t.transform?a=>{const{start:l,end:c}=cw(r,a),u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,f=c-l;d<f;d++){const p=e[l+d];u[d]="string"==typeof p?p.toLowerCase():`${p??i}`.toLowerCase()}return u}:"uppercase"===t.transform?a=>{const{start:l,end:c}=cw(r,a),u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,f=c-l;d<f;d++){const p=e[l+d];u[d]="string"==typeof p?p.toUpperCase():`${p??i}`.toUpperCase()}return u}:a=>{const{start:l,end:c}=cw(r,a),u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,f=c-l;d<f;d++){const p=e[l+d];u[d]="string"==typeof p?p:`${p??i}`}return u}:s?a=>ER(e,a):a=>{const{start:l,end:c}=cw(r,a);if(0===l&&c===e.length)return e;const u=new(a&&typeof a.array<"u"?a.array:e.constructor)(c-l);for(let d=0,f=c-l;d<f;d++)u[d]=e[l+d];return u},areValuesEqual:(a,l)=>e[a]===e[l]}}function MR(e,t,n){return e[t]-e[n]}function qx(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function coe(e,t,n,r){const i=n+r>>1;return t(e,n,r)>0?t(e,n,i)>0?t(e,i,r)>0?i:r:n:t(e,r,i)>0?t(e,i,n)>0?i:n:r}function UFe(e,t,n){const{cmp:r,swap:i,data:o,parts:s}=e;let a=t+1,l=n;for(i(o,t,coe(o,r,t,n));r(o,l,t)>0;)--l;for(let c=t+1;c<=l;c++){const u=r(o,c,t);if(u>0){for(i(o,c,l),--l;r(o,l,t)>0;)--l;c--}else 0===u&&(i(o,c,a),a++)}for(let c=t;c<a;c++)i(o,c,t+l-c);s[0]=l-a+t+1,s[1]=l}function zFe({data:e,cmp:t,swap:n},r,i){for(let o=r+1;o<=i;o++){let s=o-1;for(;s>=r&&t(e,s,s+1)>0;)n(e,s,s+1),s-=1}}function RR(e,t,n){const{parts:r}=e;for(;t<n;){if(n-t<16)return void zFe(e,t,n);UFe(e,t,n);const i=r[0],o=r[1];i-t<n-o?(RR(e,t,i-1),t=o+1):(RR(e,o+1,n),n=i-1)}}function VFe(e,t,n,r){let i=n+1,o=r;qx(e,n,coe(e,MR,n,r));const s=e[n];for(;e[o]>s;)--o;for(let a=n+1;a<=o;a++){const l=e[a];if(l>s){for(qx(e,a,o),--o;e[o]>s;)--o;a--}else l===s&&(qx(e,a,i),++i)}for(let a=n;a<i;a++)qx(e,a,n+o-a);t[0]=o-i+n+1,t[1]=o}function HFe(e,t,n){for(let r=t+1;r<=n;r++){const i=e[r];let o=r-1;for(;o>=t&&e[o]>i;)e[o+1]=e[o],o-=1;e[o+1]=i}}function CU(e,t,n,r){for(;n<r;){if(r-n<16)return void HFe(e,n,r);VFe(e,t,n,r);const i=t[0],o=t[1];i-n<r-o?(CU(e,t,n,i-1),n=o+1):(CU(e,t,o+1,r),r=i-1)}}function ip(e,t=MR){return function GFe(e,t,n,r=MR){return r===MR?CU(e,[0,0],t,n-1):RR({data:e,cmp:r,swap:qx,parts:[0,0]},t,n-1),e}(e,0,e.length,t)}function uoe(e,t,n,r,i){return RR({data:e,cmp:r,swap:i,parts:[0,0]},t,n-1),e}function _d(e,t){return{value:e,unit:t}}function hf(e){return e}!function(e){function t(){const q=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];return q[0]=0,q}function n(){const q=t();return q[0]=1,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=1,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=1,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q}function r(q){return q[0]=1,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=1,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=1,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q}function i(q){for(let ne=0;ne<16;ne++)q[ne]=0;return q}e.zero=t,e.identity=n,e.setIdentity=r,e.setZero=i,e.ofRows=function o(q){const ne=t();for(let be=0;be<4;be++){const Ce=q[be];for(let Re=0;Re<4;Re++)ne[4*Re+be]=Ce[Re]}return ne};const s=n();function c(q,ne,be){for(let Ce=0;Ce<16;Ce++)if(Math.abs(q[Ce]-ne[Ce])>be)return!1;return!0}function u(q,ne,be,Ce){q[4*be+ne]=Ce}function h(q,ne){return q[0]=ne[0],q[1]=ne[1],q[2]=ne[2],q[3]=ne[3],q[4]=ne[4],q[5]=ne[5],q[6]=ne[6],q[7]=ne[7],q[8]=ne[8],q[9]=ne[9],q[10]=ne[10],q[11]=ne[11],q[12]=ne[12],q[13]=ne[13],q[14]=ne[14],q[15]=ne[15],q}function x(q,ne){const be=ne[0]+ne[5]+ne[10];let Ce=0;return be>0?(Ce=2*Math.sqrt(be+1),q[3]=.25*Ce,q[0]=(ne[6]-ne[9])/Ce,q[1]=(ne[8]-ne[2])/Ce,q[2]=(ne[1]-ne[4])/Ce):ne[0]>ne[5]&&ne[0]>ne[10]?(Ce=2*Math.sqrt(1+ne[0]-ne[5]-ne[10]),q[3]=(ne[6]-ne[9])/Ce,q[0]=.25*Ce,q[1]=(ne[1]+ne[4])/Ce,q[2]=(ne[8]+ne[2])/Ce):ne[5]>ne[10]?(Ce=2*Math.sqrt(1+ne[5]-ne[0]-ne[10]),q[3]=(ne[8]-ne[2])/Ce,q[0]=(ne[1]+ne[4])/Ce,q[1]=.25*Ce,q[2]=(ne[6]+ne[9])/Ce):(Ce=2*Math.sqrt(1+ne[10]-ne[0]-ne[5]),q[3]=(ne[1]-ne[4])/Ce,q[0]=(ne[8]+ne[2])/Ce,q[1]=(ne[6]+ne[9])/Ce,q[2]=.25*Ce),q}function A(q,ne){const be=ne[0],Ce=ne[1],Re=ne[2],Be=ne[3],$e=ne[4],nt=ne[5],ht=ne[6],Ge=ne[7],ft=ne[8],vt=ne[9],Pt=ne[10],St=ne[11],Mt=ne[12],Qt=ne[13],An=ne[14],Kn=ne[15],ti=be*nt-Ce*$e,ut=be*ht-Re*$e,Et=be*Ge-Be*$e,Nt=Ce*ht-Re*nt,ye=Ce*Ge-Be*nt,we=Re*Ge-Be*ht,Te=ft*Qt-vt*Mt,je=ft*An-Pt*Mt,Ft=ft*Kn-St*Mt,Vt=vt*An-Pt*Qt,pn=vt*Kn-St*Qt,Pr=Pt*Kn-St*An;let Jn=ti*Pr-ut*pn+Et*Vt+Nt*Ft-ye*je+we*Te;return!!Jn&&(Jn=1/Jn,q[0]=(nt*Pr-ht*pn+Ge*Vt)*Jn,q[1]=(Re*pn-Ce*Pr-Be*Vt)*Jn,q[2]=(Qt*we-An*ye+Kn*Nt)*Jn,q[3]=(Pt*ye-vt*we-St*Nt)*Jn,q[4]=(ht*Ft-$e*Pr-Ge*je)*Jn,q[5]=(be*Pr-Re*Ft+Be*je)*Jn,q[6]=(An*Et-Mt*we-Kn*ut)*Jn,q[7]=(ft*we-Pt*Et+St*ut)*Jn,q[8]=($e*pn-nt*Ft+Ge*Te)*Jn,q[9]=(Ce*Ft-be*pn-Be*Te)*Jn,q[10]=(Mt*ye-Qt*Et+Kn*ti)*Jn,q[11]=(vt*Et-ft*ye-St*ti)*Jn,q[12]=(nt*je-$e*Vt-ht*Te)*Jn,q[13]=(be*Vt-Ce*je+Re*Te)*Jn,q[14]=(Qt*ut-Mt*Nt-An*ti)*Jn,q[15]=(ft*Nt-vt*ut+Pt*ti)*Jn,!0)}function E(q,ne,be){const Ce=ne[0],Re=ne[1],Be=ne[2],$e=ne[3],nt=ne[4],ht=ne[5],Ge=ne[6],ft=ne[7],vt=ne[8],Pt=ne[9],St=ne[10],Mt=ne[11],Qt=ne[12],An=ne[13],Kn=ne[14],ti=ne[15];let ut=be[0],Et=be[1],Nt=be[2],ye=be[3];return q[0]=ut*Ce+Et*nt+Nt*vt+ye*Qt,q[1]=ut*Re+Et*ht+Nt*Pt+ye*An,q[2]=ut*Be+Et*Ge+Nt*St+ye*Kn,q[3]=ut*$e+Et*ft+Nt*Mt+ye*ti,ut=be[4],Et=be[5],Nt=be[6],ye=be[7],q[4]=ut*Ce+Et*nt+Nt*vt+ye*Qt,q[5]=ut*Re+Et*ht+Nt*Pt+ye*An,q[6]=ut*Be+Et*Ge+Nt*St+ye*Kn,q[7]=ut*$e+Et*ft+Nt*Mt+ye*ti,ut=be[8],Et=be[9],Nt=be[10],ye=be[11],q[8]=ut*Ce+Et*nt+Nt*vt+ye*Qt,q[9]=ut*Re+Et*ht+Nt*Pt+ye*An,q[10]=ut*Be+Et*Ge+Nt*St+ye*Kn,q[11]=ut*$e+Et*ft+Nt*Mt+ye*ti,ut=be[12],Et=be[13],Nt=be[14],ye=be[15],q[12]=ut*Ce+Et*nt+Nt*vt+ye*Qt,q[13]=ut*Re+Et*ht+Nt*Pt+ye*An,q[14]=ut*Be+Et*Ge+Nt*St+ye*Kn,q[15]=ut*$e+Et*ft+Nt*Mt+ye*ti,q}function z(q,ne,be){let Ce=be[0],Re=be[1],Be=be[2],$e=Math.sqrt(Ce*Ce+Re*Re+Be*Be);if(Math.abs($e)<wi)return r(q);$e=1/$e,Ce*=$e,Re*=$e,Be*=$e;const nt=Math.sin(ne),ht=Math.cos(ne),Ge=1-ht;return q[0]=Ce*Ce*Ge+ht,q[1]=Re*Ce*Ge+Be*nt,q[2]=Be*Ce*Ge-Re*nt,q[3]=0,q[4]=Ce*Re*Ge-Be*nt,q[5]=Re*Re*Ge+ht,q[6]=Be*Re*Ge+Ce*nt,q[7]=0,q[8]=Ce*Be*Ge+Re*nt,q[9]=Re*Be*Ge-Ce*nt,q[10]=Be*Be*Ge+ht,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q}e.isIdentity=function a(q,ne){return c(q,s,typeof ne>"u"?wi:ne)},e.hasNaN=function l(q){for(let ne=0;ne<16;ne++)if(isNaN(q[ne]))return!0;return!1},e.areEqual=c,e.setValue=u,e.getValue=function d(q,ne,be){return q[4*be+ne]},e.toArray=function f(q,ne,be){return ne[be+0]=q[0],ne[be+1]=q[1],ne[be+2]=q[2],ne[be+3]=q[3],ne[be+4]=q[4],ne[be+5]=q[5],ne[be+6]=q[6],ne[be+7]=q[7],ne[be+8]=q[8],ne[be+9]=q[9],ne[be+10]=q[10],ne[be+11]=q[11],ne[be+12]=q[12],ne[be+13]=q[13],ne[be+14]=q[14],ne[be+15]=q[15],ne},e.fromArray=function p(q,ne,be){return q[0]=ne[be+0],q[1]=ne[be+1],q[2]=ne[be+2],q[3]=ne[be+3],q[4]=ne[be+4],q[5]=ne[be+5],q[6]=ne[be+6],q[7]=ne[be+7],q[8]=ne[be+8],q[9]=ne[be+9],q[10]=ne[be+10],q[11]=ne[be+11],q[12]=ne[be+12],q[13]=ne[be+13],q[14]=ne[be+14],q[15]=ne[be+15],q},e.fromBasis=function m(q,ne,be,Ce){return i(q),u(q,0,0,ne[0]),u(q,1,0,ne[1]),u(q,2,0,ne[2]),u(q,0,1,be[0]),u(q,1,1,be[1]),u(q,2,1,be[2]),u(q,0,2,Ce[0]),u(q,1,2,Ce[1]),u(q,2,2,Ce[2]),u(q,3,3,1),q},e.copy=h,e.clone=function g(q){return h(t(),q)},e.getTranslation=function y(q,ne){return q[0]=ne[12],q[1]=ne[13],q[2]=ne[14],q},e.getScaling=function v(q,ne){const be=ne[0],Ce=ne[1],Re=ne[2],Be=ne[4],$e=ne[5],nt=ne[6],ht=ne[8],Ge=ne[9],ft=ne[10];return q[0]=Math.sqrt(be*be+Ce*Ce+Re*Re),q[1]=Math.sqrt(Be*Be+$e*$e+nt*nt),q[2]=Math.sqrt(ht*ht+Ge*Ge+ft*ft),q},e.getRotation=x,e.extractRotation=function _(q,ne){const be=1/Math.sqrt(ne[0]*ne[0]+ne[1]*ne[1]+ne[2]*ne[2]),Ce=1/Math.sqrt(ne[4]*ne[4]+ne[5]*ne[5]+ne[6]*ne[6]),Re=1/Math.sqrt(ne[8]*ne[8]+ne[9]*ne[9]+ne[10]*ne[10]);return q[0]=ne[0]*be,q[1]=ne[1]*be,q[2]=ne[2]*be,q[3]=0,q[4]=ne[4]*Ce,q[5]=ne[5]*Ce,q[6]=ne[6]*Ce,q[7]=0,q[8]=ne[8]*Re,q[9]=ne[9]*Re,q[10]=ne[10]*Re,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q},e.transpose=function w(q,ne){if(q===ne){const be=ne[1],Ce=ne[2],Re=ne[3],Be=ne[6],$e=ne[7],nt=ne[11];q[1]=ne[4],q[2]=ne[8],q[3]=ne[12],q[4]=be,q[6]=ne[9],q[7]=ne[13],q[8]=Ce,q[9]=Be,q[11]=ne[14],q[12]=Re,q[13]=$e,q[14]=nt}else q[0]=ne[0],q[1]=ne[4],q[2]=ne[8],q[3]=ne[12],q[4]=ne[1],q[5]=ne[5],q[6]=ne[9],q[7]=ne[13],q[8]=ne[2],q[9]=ne[6],q[10]=ne[10],q[11]=ne[14],q[12]=ne[3],q[13]=ne[7],q[14]=ne[11],q[15]=ne[15];return q},e.tryInvert=A,e.invert=function M(q,ne){return A(q,ne)||console.warn("non-invertible matrix.",ne),q},e.mul=E,e.mulOffset=function D(q,ne,be,Ce,Re,Be){const $e=ne[0+Re],nt=ne[1+Re],ht=ne[2+Re],Ge=ne[3+Re],ft=ne[4+Re],vt=ne[5+Re],Pt=ne[6+Re],St=ne[7+Re],Mt=ne[8+Re],Qt=ne[9+Re],An=ne[10+Re],Kn=ne[11+Re],ti=ne[12+Re],ut=ne[13+Re],Et=ne[14+Re],Nt=ne[15+Re];let ye=be[0+Be],we=be[1+Be],Te=be[2+Be],je=be[3+Be];return q[0+Ce]=ye*$e+we*ft+Te*Mt+je*ti,q[1+Ce]=ye*nt+we*vt+Te*Qt+je*ut,q[2+Ce]=ye*ht+we*Pt+Te*An+je*Et,q[3+Ce]=ye*Ge+we*St+Te*Kn+je*Nt,ye=be[4+Be],we=be[5+Be],Te=be[6+Be],je=be[7+Be],q[4+Ce]=ye*$e+we*ft+Te*Mt+je*ti,q[5+Ce]=ye*nt+we*vt+Te*Qt+je*ut,q[6+Ce]=ye*ht+we*Pt+Te*An+je*Et,q[7+Ce]=ye*Ge+we*St+Te*Kn+je*Nt,ye=be[8+Be],we=be[9+Be],Te=be[10+Be],je=be[11+Be],q[8+Ce]=ye*$e+we*ft+Te*Mt+je*ti,q[9+Ce]=ye*nt+we*vt+Te*Qt+je*ut,q[10+Ce]=ye*ht+we*Pt+Te*An+je*Et,q[11+Ce]=ye*Ge+we*St+Te*Kn+je*Nt,ye=be[12+Be],we=be[13+Be],Te=be[14+Be],je=be[15+Be],q[12+Ce]=ye*$e+we*ft+Te*Mt+je*ti,q[13+Ce]=ye*nt+we*vt+Te*Qt+je*ut,q[14+Ce]=ye*ht+we*Pt+Te*An+je*Et,q[15+Ce]=ye*Ge+we*St+Te*Kn+je*Nt,q},e.mul3=function T(q,ne,be,Ce){return E(q,E(q,ne,be),Ce)},e.translate=function F(q,ne,be){const Ce=be[0],Re=be[1],Be=be[2];let $e,nt,ht,Ge,ft,vt,Pt,St,Mt,Qt,An,Kn;return ne===q?(q[12]=ne[0]*Ce+ne[4]*Re+ne[8]*Be+ne[12],q[13]=ne[1]*Ce+ne[5]*Re+ne[9]*Be+ne[13],q[14]=ne[2]*Ce+ne[6]*Re+ne[10]*Be+ne[14],q[15]=ne[3]*Ce+ne[7]*Re+ne[11]*Be+ne[15]):($e=ne[0],nt=ne[1],ht=ne[2],Ge=ne[3],ft=ne[4],vt=ne[5],Pt=ne[6],St=ne[7],Mt=ne[8],Qt=ne[9],An=ne[10],Kn=ne[11],q[0]=$e,q[1]=nt,q[2]=ht,q[3]=Ge,q[4]=ft,q[5]=vt,q[6]=Pt,q[7]=St,q[8]=Mt,q[9]=Qt,q[10]=An,q[11]=Kn,q[12]=$e*Ce+ft*Re+Mt*Be+ne[12],q[13]=nt*Ce+vt*Re+Qt*Be+ne[13],q[14]=ht*Ce+Pt*Re+An*Be+ne[14],q[15]=Ge*Ce+St*Re+Kn*Be+ne[15]),q},e.fromTranslation=function R(q,ne){return q[0]=1,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=1,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=1,q[11]=0,q[12]=ne[0],q[13]=ne[1],q[14]=ne[2],q[15]=1,q},e.setTranslation=function N(q,ne){return q[12]=ne[0],q[13]=ne[1],q[14]=ne[2],q},e.setAxes=function j(q,ne,be,Ce){return q[0]=be[0],q[4]=be[1],q[8]=be[2],q[1]=Ce[0],q[5]=Ce[1],q[9]=Ce[2],q[2]=ne[0],q[6]=ne[1],q[10]=ne[2],q},e.rotate=function W(q,ne,be,Ce){let Re=Ce[0],Be=Ce[1],$e=Ce[2],nt=Math.sqrt(Re*Re+Be*Be+$e*$e);if(Math.abs(nt)<wi)return n();nt=1/nt,Re*=nt,Be*=nt,$e*=nt;const ht=Math.sin(be),Ge=Math.cos(be),ft=1-Ge,vt=ne[0],Pt=ne[1],St=ne[2],Mt=ne[3],Qt=ne[4],An=ne[5],Kn=ne[6],ti=ne[7],ut=ne[8],Et=ne[9],Nt=ne[10],ye=ne[11],we=Re*Re*ft+Ge,Te=Be*Re*ft+$e*ht,je=$e*Re*ft-Be*ht,Ft=Re*Be*ft-$e*ht,Vt=Be*Be*ft+Ge,pn=$e*Be*ft+Re*ht,Pr=Re*$e*ft+Be*ht,Jn=Be*$e*ft-Re*ht,bi=$e*$e*ft+Ge;return q[0]=vt*we+Qt*Te+ut*je,q[1]=Pt*we+An*Te+Et*je,q[2]=St*we+Kn*Te+Nt*je,q[3]=Mt*we+ti*Te+ye*je,q[4]=vt*Ft+Qt*Vt+ut*pn,q[5]=Pt*Ft+An*Vt+Et*pn,q[6]=St*Ft+Kn*Vt+Nt*pn,q[7]=Mt*Ft+ti*Vt+ye*pn,q[8]=vt*Pr+Qt*Jn+ut*bi,q[9]=Pt*Pr+An*Jn+Et*bi,q[10]=St*Pr+Kn*Jn+Nt*bi,q[11]=Mt*Pr+ti*Jn+ye*bi,ne!==q&&(q[12]=ne[12],q[13]=ne[13],q[14]=ne[14],q[15]=ne[15]),q},e.fromRotation=z,e.scale=function $(q,ne,be){const Ce=be[0],Re=be[1],Be=be[2];return q[0]=ne[0]*Ce,q[1]=ne[1]*Ce,q[2]=ne[2]*Ce,q[3]=ne[3]*Ce,q[4]=ne[4]*Re,q[5]=ne[5]*Re,q[6]=ne[6]*Re,q[7]=ne[7]*Re,q[8]=ne[8]*Be,q[9]=ne[9]*Be,q[10]=ne[10]*Be,q[11]=ne[11]*Be,q[12]=ne[12],q[13]=ne[13],q[14]=ne[14],q[15]=ne[15],q},e.scaleUniformly=function V(q,ne,be){return q[0]=ne[0]*be,q[1]=ne[1]*be,q[2]=ne[2]*be,q[3]=ne[3]*be,q[4]=ne[4]*be,q[5]=ne[5]*be,q[6]=ne[6]*be,q[7]=ne[7]*be,q[8]=ne[8]*be,q[9]=ne[9]*be,q[10]=ne[10]*be,q[11]=ne[11]*be,q[12]=ne[12],q[13]=ne[13],q[14]=ne[14],q[15]=ne[15],q},e.fromScaling=function X(q,ne){return q[0]=ne[0],q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=ne[1],q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=ne[2],q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q},e.fromUniformScaling=function H(q,ne){return q[0]=ne,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=ne,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=ne,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q},e.fromMat3=function oe(q,ne){return q[0]=ne[0],q[1]=ne[1],q[2]=ne[2],q[4]=ne[3],q[5]=ne[4],q[6]=ne[5],q[8]=ne[6],q[9]=ne[7],q[10]=ne[8],q},e.compose=function te(q,ne,be,Ce){const[Re,Be,$e,nt]=be,ht=Re+Re,Ge=Be+Be,ft=$e+$e,vt=Re*ht,Pt=Re*Ge,St=Re*ft,Mt=Be*Ge,Qt=Be*ft,An=$e*ft,Kn=nt*ht,ti=nt*Ge,ut=nt*ft,[Et,Nt,ye]=Ce;return q[0]=(1-(Mt+An))*Et,q[1]=(Pt+ut)*Et,q[2]=(St-ti)*Et,q[3]=0,q[4]=(Pt-ut)*Nt,q[5]=(1-(vt+An))*Nt,q[6]=(Qt+Kn)*Nt,q[7]=0,q[8]=(St+ti)*ye,q[9]=(Qt-Kn)*ye,q[10]=(1-(vt+Mt))*ye,q[11]=0,q[12]=ne[0],q[13]=ne[1],q[14]=ne[2],q[15]=1,q};const K=[0,0,0],Q=t();function ee(q){const ne=q[0],be=q[1],Ce=q[2],Re=q[3],Be=q[4],$e=q[5],nt=q[6],ht=q[7],Ge=q[8],ft=q[9],vt=q[10],Pt=q[11],St=q[12],Mt=q[13],Qt=q[14],An=q[15];return(ne*$e-be*Be)*(vt*An-Pt*Qt)-(ne*nt-Ce*Be)*(ft*An-Pt*Mt)+(ne*ht-Re*Be)*(ft*Qt-vt*Mt)+(be*nt-Ce*$e)*(Ge*An-Pt*St)-(be*ht-Re*$e)*(Ge*Qt-vt*St)+(Ce*ht-Re*nt)*(Ge*Mt-ft*St)}e.decompose=function G(q,ne,be,Ce){let Re=C.magnitude(C.set(K,q[0],q[1],q[2]));const Be=C.magnitude(C.set(K,q[4],q[5],q[6])),$e=C.magnitude(C.set(K,q[8],q[9],q[10]));ee(q)<0&&(Re=-Re),ne[0]=q[12],ne[1]=q[13],ne[2]=q[14],h(Q,q);const ht=1/Re,Ge=1/Be,ft=1/$e;return Q[0]*=ht,Q[1]*=ht,Q[2]*=ht,Q[4]*=Ge,Q[5]*=Ge,Q[6]*=Ge,Q[8]*=ft,Q[9]*=ft,Q[10]*=ft,x(be,Q),Ce[0]=Re,Ce[1]=Be,Ce[2]=$e,q},e.makeTable=function Z(q){let ne="";for(let be=0;be<4;be++){for(let Ce=0;Ce<4;Ce++)ne+=q[4*Ce+be].toString(),Ce<3&&(ne+=" ");be<3&&(ne+="\n")}return ne},e.determinant=ee,e.isRotationAndTranslation=function se(q,ne){return function xe(q,ne){const be=q[0],Ce=q[1],Re=q[2],Be=q[3],$e=q[4],nt=q[5],ht=q[6],Ge=q[7],ft=q[8],vt=q[9],Pt=q[10],St=q[11];return!!(Do(q[15],1,ne)&&Do(Be,0,ne)&&Do(Ge,0,ne)&&Do(St,0,ne))&&!!Do(Math.abs(be*(nt*Pt-ht*vt)-Ce*($e*Pt-ht*ft)+Re*($e*vt-nt*ft)),1,ne)}(q,typeof ne<"u"?ne:wi)},e.isTranslationAndUniformScaling=function re(q,ne){return function ae(q,ne){const be=q[0];return Do(q[1],0,ne)&&Do(q[2],0,ne)&&Do(q[3],0,ne)&&Do(q[4],0,ne)&&Do(q[5],be,ne)&&Do(q[6],0,ne)&&Do(q[7],0,ne)&&Do(q[8],0,ne)&&Do(q[9],0,ne)&&Do(q[10],be,ne)&&Do(q[11],0,ne)&&Do(q[15],1,ne)}(q,typeof ne<"u"?ne:wi)},e.fromQuat=function ge(q,ne){const be=ne[0],Ce=ne[1],Re=ne[2],Be=ne[3],$e=be+be,nt=Ce+Ce,ht=Re+Re,Ge=be*$e,ft=Ce*$e,vt=Ce*nt,Pt=Re*$e,St=Re*nt,Mt=Re*ht,Qt=Be*$e,An=Be*nt,Kn=Be*ht;return q[0]=1-vt-Mt,q[1]=ft+Kn,q[2]=Pt-An,q[3]=0,q[4]=ft-Kn,q[5]=1-Ge-Mt,q[6]=St+Qt,q[7]=0,q[8]=Pt+An,q[9]=St-Qt,q[10]=1-Ge-vt,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q},e.fromEuler=function Ie(q,ne,be){const Ce=ne[0],Re=ne[1],Be=ne[2],$e=Math.cos(Ce),nt=Math.sin(Ce),ht=Math.cos(Re),Ge=Math.sin(Re),ft=Math.cos(Be),vt=Math.sin(Be);if("XYZ"===be){const Pt=$e*ft,St=$e*vt,Mt=nt*ft,Qt=nt*vt;q[0]=ht*ft,q[4]=-ht*vt,q[8]=Ge,q[1]=St+Mt*Ge,q[5]=Pt-Qt*Ge,q[9]=-nt*ht,q[2]=Qt-Pt*Ge,q[6]=Mt+St*Ge,q[10]=$e*ht}else if("YXZ"===be){const Pt=ht*ft,St=ht*vt,Mt=Ge*ft,Qt=Ge*vt;q[0]=Pt+Qt*nt,q[4]=Mt*nt-St,q[8]=$e*Ge,q[1]=$e*vt,q[5]=$e*ft,q[9]=-nt,q[2]=St*nt-Mt,q[6]=Qt+Pt*nt,q[10]=$e*ht}else if("ZXY"===be){const Pt=ht*ft,St=ht*vt,Mt=Ge*ft,Qt=Ge*vt;q[0]=Pt-Qt*nt,q[4]=-$e*vt,q[8]=Mt+St*nt,q[1]=St+Mt*nt,q[5]=$e*ft,q[9]=Qt-Pt*nt,q[2]=-$e*Ge,q[6]=nt,q[10]=$e*ht}else if("ZYX"===be){const Pt=$e*ft,St=$e*vt,Mt=nt*ft,Qt=nt*vt;q[0]=ht*ft,q[4]=Mt*Ge-St,q[8]=Pt*Ge+Qt,q[1]=ht*vt,q[5]=Qt*Ge+Pt,q[9]=St*Ge-Mt,q[2]=-Ge,q[6]=nt*ht,q[10]=$e*ht}else if("YZX"===be){const Pt=$e*ht,St=$e*Ge,Mt=nt*ht,Qt=nt*Ge;q[0]=ht*ft,q[4]=Qt-Pt*vt,q[8]=Mt*vt+St,q[1]=vt,q[5]=$e*ft,q[9]=-nt*ft,q[2]=-Ge*ft,q[6]=St*vt+Mt,q[10]=Pt-Qt*vt}else if("XZY"===be){const Pt=$e*ht,St=$e*Ge,Mt=nt*ht,Qt=nt*Ge;q[0]=ht*ft,q[4]=-vt,q[8]=Ge*ft,q[1]=Pt*vt+Qt,q[5]=$e*ft,q[9]=St*vt-Mt,q[2]=Mt*vt-St,q[6]=nt*ft,q[10]=Qt*vt+Pt}return q[3]=0,q[7]=0,q[11]=0,q[12]=0,q[13]=0,q[14]=0,q[15]=1,q},e.perspective=function me(q,ne,be,Ce,Re,Be,$e){const ht=2*Be/(Ce-Re),Ge=(be+ne)/(be-ne),ft=(Ce+Re)/(Ce-Re),vt=-($e+Be)/($e-Be),Pt=-2*$e*Be/($e-Be);return q[0]=2*Be/(be-ne),q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=ht,q[6]=0,q[7]=0,q[8]=Ge,q[9]=ft,q[10]=vt,q[11]=-1,q[12]=0,q[13]=0,q[14]=Pt,q[15]=0,q},e.ortho=function Ae(q,ne,be,Ce,Re,Be,$e){const nt=1/(be-ne),ht=1/(Ce-Re),Ge=1/($e-Be),ft=(be+ne)*nt,vt=(Ce+Re)*ht,Pt=($e+Be)*Ge;return q[0]=2*nt,q[1]=0,q[2]=0,q[3]=0,q[4]=0,q[5]=2*ht,q[6]=0,q[7]=0,q[8]=0,q[9]=0,q[10]=-2*Ge,q[11]=0,q[12]=-ft,q[13]=-vt,q[14]=-Pt,q[15]=1,q},e.lookAt=function he(q,ne,be,Ce){let Re,Be,$e,nt,ht,Ge,ft,vt,Pt,St;const Mt=ne[0],Qt=ne[1],An=ne[2],Kn=Ce[0],ti=Ce[1],ut=Ce[2],Et=be[0],Nt=be[1],ye=be[2];return Math.abs(Mt-Et)<wi&&Math.abs(Qt-Nt)<wi&&Math.abs(An-ye)<wi?r(q):(ft=Mt-Et,vt=Qt-Nt,Pt=An-ye,St=1/Math.sqrt(ft*ft+vt*vt+Pt*Pt),ft*=St,vt*=St,Pt*=St,Re=ti*Pt-ut*vt,Be=ut*ft-Kn*Pt,$e=Kn*vt-ti*ft,St=Math.sqrt(Re*Re+Be*Be+$e*$e),St?(St=1/St,Re*=St,Be*=St,$e*=St):(Re=0,Be=0,$e=0),nt=vt*$e-Pt*Be,ht=Pt*Re-ft*$e,Ge=ft*Be-vt*Re,St=Math.sqrt(nt*nt+ht*ht+Ge*Ge),St?(St=1/St,nt*=St,ht*=St,Ge*=St):(nt=0,ht=0,Ge=0),q[0]=Re,q[1]=nt,q[2]=ft,q[3]=0,q[4]=Be,q[5]=ht,q[6]=vt,q[7]=0,q[8]=$e,q[9]=Ge,q[10]=Pt,q[11]=0,q[12]=-(Re*Mt+Be*Qt+$e*An),q[13]=-(nt*Mt+ht*Qt+Ge*An),q[14]=-(ft*Mt+vt*Qt+Pt*An),q[15]=1,q)},e.targetTo=function ie(q,ne,be,Ce){const Re=ne[0],Be=ne[1],$e=ne[2],nt=Ce[0],ht=Ce[1],Ge=Ce[2];let ft=Re-be[0],vt=Be-be[1],Pt=$e-be[2],St=ft*ft+vt*vt+Pt*Pt;St>0&&(St=1/Math.sqrt(St),ft*=St,vt*=St,Pt*=St);let Mt=ht*Pt-Ge*vt,Qt=Ge*ft-nt*Pt,An=nt*vt-ht*ft;return St=Mt*Mt+Qt*Qt+An*An,St>0&&(St=1/Math.sqrt(St),Mt*=St,Qt*=St,An*=St),q[0]=Mt,q[1]=Qt,q[2]=An,q[3]=0,q[4]=vt*An-Pt*Qt,q[5]=Pt*Mt-ft*An,q[6]=ft*Qt-vt*Mt,q[7]=0,q[8]=ft,q[9]=vt,q[10]=Pt,q[11]=0,q[12]=Re,q[13]=Be,q[14]=$e,q[15]=1,q},e.fromPermutation=function ue(q,ne){i(q);for(let be=0;be<4;be++)u(q,be,ne[be],1);return q},e.getMaxScaleOnAxis=function _e(q){return Math.sqrt(Math.max(q[0]*q[0]+q[1]*q[1]+q[2]*q[2],q[4]*q[4]+q[5]*q[5]+q[6]*q[6],q[8]*q[8]+q[9]*q[9]+q[10]*q[10]))};const Fe=[1,0,0],Ze=[0,1,0],ct=[0,0,1];e.rotX90=z(t(),Xr(90),Fe),e.rotX180=z(t(),Xr(180),Fe),e.rotY90=z(t(),Xr(90),Ze),e.rotY180=z(t(),Xr(180),Ze),e.rotY270=z(t(),Xr(270),Ze),e.rotZ90=z(t(),Xr(90),ct),e.rotZ180=z(t(),Xr(180),ct),e.rotXY90=E(t(),e.rotX90,e.rotY90),e.rotZY90=E(t(),e.rotZ90,e.rotY90),e.rotZYZ90=E(t(),e.rotZY90,e.rotZ90),e.rotZ90X180=E(t(),e.rotZ90,e.rotX180),e.rotY90Z180=E(t(),e.rotY90,e.rotZ180),e.id=n()}(fe||(fe={})),function(e){function t(){const G=[.1,0,0,0,0,0,0,0,0];return G[0]=0,G}function n(){const G=t();return G[0]=1,G[1]=0,G[2]=0,G[3]=0,G[4]=1,G[5]=0,G[6]=0,G[7]=0,G[8]=1,G}function a(G,Z){return G[0]=Z[0],G[1]=Z[1],G[2]=Z[2],G[3]=Z[4],G[4]=Z[5],G[5]=Z[6],G[6]=Z[8],G[7]=Z[9],G[8]=Z[10],G}e.zero=t,e.identity=n,e.setIdentity=function r(G){return G[0]=1,G[1]=0,G[2]=0,G[3]=0,G[4]=1,G[5]=0,G[6]=0,G[7]=0,G[8]=1,G},e.toArray=function i(G,Z,ee){return Z[ee+0]=G[0],Z[ee+1]=G[1],Z[ee+2]=G[2],Z[ee+3]=G[3],Z[ee+4]=G[4],Z[ee+5]=G[5],Z[ee+6]=G[6],Z[ee+7]=G[7],Z[ee+8]=G[8],Z},e.fromArray=function o(G,Z,ee){return G[0]=Z[ee+0],G[1]=Z[ee+1],G[2]=Z[ee+2],G[3]=Z[ee+3],G[4]=Z[ee+4],G[5]=Z[ee+5],G[6]=Z[ee+6],G[7]=Z[ee+7],G[8]=Z[ee+8],G},e.fromColumns=function s(G,Z,ee,se){return G[0]=Z[0],G[1]=Z[1],G[2]=Z[2],G[3]=ee[0],G[4]=ee[1],G[5]=ee[2],G[6]=se[0],G[7]=se[1],G[8]=se[2],G},e.fromMat4=a,e.create=function l(G,Z,ee,se,xe,re,ae,ge,Ie){const me=t();return me[0]=G,me[1]=Z,me[2]=ee,me[3]=se,me[4]=xe,me[5]=re,me[6]=ae,me[7]=ge,me[8]=Ie,me};const c=n();function p(G,Z,ee){for(let se=0;se<9;se++)if(Math.abs(G[se]-Z[se])>ee)return!1;return!0}function g(G,Z){return G[0]=Z[0],G[1]=Z[1],G[2]=Z[2],G[3]=Z[3],G[4]=Z[4],G[5]=Z[5],G[6]=Z[6],G[7]=Z[7],G[8]=Z[8],G}function y(G,Z){if(G===Z){const ee=Z[1],se=Z[2],xe=Z[5];G[1]=Z[3],G[2]=Z[6],G[3]=ee,G[5]=Z[7],G[6]=se,G[7]=xe}else G[0]=Z[0],G[1]=Z[3],G[2]=Z[6],G[3]=Z[1],G[4]=Z[4],G[5]=Z[7],G[6]=Z[2],G[7]=Z[5],G[8]=Z[8];return G}function v(G,Z){const ee=Z[0],se=Z[1],xe=Z[2],re=Z[3],ae=Z[4],ge=Z[5],Ie=Z[6],me=Z[7],Ae=Z[8],he=Ae*ae-ge*me,ie=-Ae*re+ge*Ie,ue=me*re-ae*Ie;let _e=ee*he+se*ie+xe*ue;return _e?(_e=1/_e,G[0]=he*_e,G[1]=(-Ae*se+xe*me)*_e,G[2]=(ge*se-xe*ae)*_e,G[3]=ie*_e,G[4]=(Ae*ee-xe*Ie)*_e,G[5]=(-ge*ee+xe*re)*_e,G[6]=ue*_e,G[7]=(-me*ee+se*Ie)*_e,G[8]=(ae*ee-se*re)*_e,G):(console.warn("non-invertible matrix.",Z),G)}function w(G){const xe=G[3],re=G[4],ae=G[5],ge=G[6],Ie=G[7],me=G[8];return G[0]*(me*re-ae*Ie)+G[1]*(-me*xe+ae*ge)+G[2]*(Ie*xe-re*ge)}function A(G){return G[0]+G[4]+G[8]}function M(G,Z,ee){return G[0]=Z[0]-ee[0],G[1]=Z[1]-ee[1],G[2]=Z[2]-ee[2],G[3]=Z[3]-ee[3],G[4]=Z[4]-ee[4],G[5]=Z[5]-ee[5],G[6]=Z[6]-ee[6],G[7]=Z[7]-ee[7],G[8]=Z[8]-ee[8],G}function R(G,Z,ee){return G[0]=Z[0]*ee,G[1]=Z[1]*ee,G[2]=Z[2]*ee,G[3]=Z[3]*ee,G[4]=Z[4]*ee,G[5]=Z[5]*ee,G[6]=Z[6]*ee,G[7]=Z[7]*ee,G[8]=Z[8]*ee,G}e.isIdentity=function u(G,Z){return p(G,c,typeof Z>"u"?wi:Z)},e.hasNaN=function d(G){for(let Z=0;Z<9;Z++)if(isNaN(G[Z]))return!0;return!1},e.clone=function f(G){return g(t(),G)},e.areEqual=p,e.setValue=function m(G,Z,ee,se){G[3*ee+Z]=se},e.getValue=function h(G,Z,ee){return G[3*ee+Z]},e.copy=g,e.transpose=y,e.invert=v,e.symmtricFromUpper=function x(G,Z){return G===Z?(G[3]=Z[1],G[6]=Z[2],G[7]=Z[5]):(G[0]=Z[0],G[1]=Z[1],G[2]=Z[2],G[3]=Z[1],G[4]=Z[4],G[5]=Z[5],G[6]=Z[2],G[7]=Z[5],G[8]=Z[8]),G},e.symmtricFromLower=function _(G,Z){return G===Z?(G[1]=Z[3],G[2]=Z[6],G[5]=Z[7]):(G[0]=Z[0],G[1]=Z[3],G[2]=Z[6],G[3]=Z[3],G[4]=Z[4],G[5]=Z[7],G[6]=Z[6],G[7]=Z[7],G[8]=Z[8]),G},e.determinant=w,e.trace=A,e.sub=M,e.add=function E(G,Z,ee){return G[0]=Z[0]+ee[0],G[1]=Z[1]+ee[1],G[2]=Z[2]+ee[2],G[3]=Z[3]+ee[3],G[4]=Z[4]+ee[4],G[5]=Z[5]+ee[5],G[6]=Z[6]+ee[6],G[7]=Z[7]+ee[7],G[8]=Z[8]+ee[8],G},e.mul=function D(G,Z,ee){const se=Z[0],xe=Z[1],re=Z[2],ae=Z[3],ge=Z[4],Ie=Z[5],me=Z[6],Ae=Z[7],he=Z[8],ie=ee[0],ue=ee[1],_e=ee[2],Fe=ee[3],Ze=ee[4],ct=ee[5],q=ee[6],ne=ee[7],be=ee[8];return G[0]=ie*se+ue*ae+_e*me,G[1]=ie*xe+ue*ge+_e*Ae,G[2]=ie*re+ue*Ie+_e*he,G[3]=Fe*se+Ze*ae+ct*me,G[4]=Fe*xe+Ze*ge+ct*Ae,G[5]=Fe*re+Ze*Ie+ct*he,G[6]=q*se+ne*ae+be*me,G[7]=q*xe+ne*ge+be*Ae,G[8]=q*re+ne*Ie+be*he,G},e.subScalar=function T(G,Z,ee){return G[0]=Z[0]-ee,G[1]=Z[1]-ee,G[2]=Z[2]-ee,G[3]=Z[3]-ee,G[4]=Z[4]-ee,G[5]=Z[5]-ee,G[6]=Z[6]-ee,G[7]=Z[7]-ee,G[8]=Z[8]-ee,G},e.addScalar=function F(G,Z,ee){return G[0]=Z[0]+ee,G[1]=Z[1]+ee,G[2]=Z[2]+ee,G[3]=Z[3]+ee,G[4]=Z[4]+ee,G[5]=Z[5]+ee,G[6]=Z[6]+ee,G[7]=Z[7]+ee,G[8]=Z[8]+ee,G},e.mulScalar=R;const N=Math.PI/3,j=t();e.symmetricEigenvalues=function W(G,Z){const ee=Z[1]*Z[1]+Z[2]*Z[2]+Z[5]*Z[5];if(0===ee)G[0]=Z[0],G[1]=Z[4],G[2]=Z[8];else{const se=A(Z)/3,xe=Z[0]-se,re=Z[4]-se,ae=Z[8]-se,Ie=Math.sqrt((xe*xe+re*re+ae*ae+2*ee)/6);R(j,e.Identity,se),M(j,Z,j),R(j,j,1/Ie);const me=w(j)/2,Ae=me<=-1?N:me>=1?0:Math.acos(me)/3;G[0]=se+2*Ie*Math.cos(Ae),G[2]=se+2*Ie*Math.cos(Ae+2*N),G[1]=3*se-G[0]-G[2]}return G};const z=[.1,0,0],$=[.1,0,0],V=[.1,0,0],X=[.1,0,0],H=[.1,0,0],oe=[.1,0,0];e.eigenvector=function te(G,Z,ee){C.set(z,Z[0]-ee,Z[1],Z[2]),C.set($,Z[1],Z[4]-ee,Z[5]),C.set(V,Z[2],Z[5],Z[8]-ee),C.cross(X,z,$),C.cross(H,z,V),C.cross(oe,$,V);const se=C.dot(X,X),xe=C.dot(H,H),re=C.dot(oe,oe);let ae=se,ge=0;return xe>ae&&(ae=xe,ge=1),re>ae&&(ge=2),0===ge?C.scale(G,X,1/Math.sqrt(se)):1===ge?C.scale(G,H,1/Math.sqrt(xe)):C.scale(G,oe,1/Math.sqrt(re)),G},e.directionTransform=function K(G,Z){return a(G,Z),v(G,G),y(G,G),G},e.Identity=n(),e.innerProduct=function Q(G,Z){return G[0]*Z[0]+G[1]*Z[1]+G[2]*Z[2]+G[3]*Z[3]+G[4]*Z[4]+G[5]*Z[5]+G[6]*Z[6]+G[7]*Z[7]+G[8]*Z[8]}}(In||(In={})),function(e){function t(){const E=[.1,0];return E[0]=0,E}e.zero=t,e.clone=function n(E){const D=t();return D[0]=E[0],D[1]=E[1],D},e.create=function r(E,D){const T=t();return T[0]=E,T[1]=D,T},e.hasNaN=function i(E){return isNaN(E[0])||isNaN(E[1])},e.toArray=function o(E,D,T){return D[T+0]=E[0],D[T+1]=E[1],D},e.fromArray=function s(E,D,T){return E[0]=D[T+0],E[1]=D[T+1],E},e.copy=function a(E,D){return E[0]=D[0],E[1]=D[1],E},e.set=function l(E,D,T){return E[0]=D,E[1]=T,E},e.add=function c(E,D,T){return E[0]=D[0]+T[0],E[1]=D[1]+T[1],E},e.sub=function u(E,D,T){return E[0]=D[0]-T[0],E[1]=D[1]-T[1],E},e.mul=function d(E,D,T){return E[0]=D[0]*T[0],E[1]=D[1]*T[1],E},e.div=function f(E,D,T){return E[0]=D[0]/T[0],E[1]=D[1]/T[1],E},e.scale=function p(E,D,T){return E[0]=D[0]*T,E[1]=D[1]*T,E},e.round=function m(E,D){return E[0]=Math.round(D[0]),E[1]=Math.round(D[1]),E},e.ceil=function h(E,D){return E[0]=Math.ceil(D[0]),E[1]=Math.ceil(D[1]),E},e.floor=function g(E,D){return E[0]=Math.floor(D[0]),E[1]=Math.floor(D[1]),E},e.distance=function y(E,D){const T=D[0]-E[0],F=D[1]-E[1];return Math.sqrt(T*T+F*F)},e.squaredDistance=function v(E,D){const T=D[0]-E[0],F=D[1]-E[1];return T*T+F*F},e.magnitude=function x(E){const D=E[0],T=E[1];return Math.sqrt(D*D+T*T)},e.squaredMagnitude=function _(E){const D=E[0],T=E[1];return D*D+T*T},e.inverse=function w(E,D){return E[0]=1/D[0],E[1]=1/D[1],E},e.areEqual=function A(E,D){return E[0]===D[0]&&E[1]===D[1]},e.toString=function M(E,D){return`[${E[0].toPrecision(D)} ${E[1].toPrecision(D)}}]`}}(Ue||(Ue={})),function(e){function t(){const R=[.1,0,0,0];return R[0]=0,R}function i(R,N){return R[0]=N.center[0],R[1]=N.center[1],R[2]=N.center[2],R[3]=N.radius,R}e.zero=t,e.clone=function n(R){const N=t();return N[0]=R[0],N[1]=R[1],N[2]=R[2],N[3]=R[3],N},e.create=function r(R,N,j,W){const z=t();return z[0]=R,z[1]=N,z[2]=j,z[3]=W,z},e.fromSphere=i,e.ofSphere=function o(R){return i(t(),R)},e.hasNaN=function s(R){return isNaN(R[0])||isNaN(R[1])||isNaN(R[2])||isNaN(R[3])},e.toArray=function a(R,N,j){return N[j+0]=R[0],N[j+1]=R[1],N[j+2]=R[2],N[j+3]=R[3],N},e.fromArray=function l(R,N,j){return R[0]=N[j+0],R[1]=N[j+1],R[2]=N[j+2],R[3]=N[j+3],R},e.toVec3Array=function c(R,N,j){N[j+0]=R[0],N[j+1]=R[1],N[j+2]=R[2]},e.fromVec3Array=function u(R,N,j){return R[0]=N[j+0],R[1]=N[j+1],R[2]=N[j+2],R[3]=0,R},e.copy=function d(R,N){return R[0]=N[0],R[1]=N[1],R[2]=N[2],R[3]=N[3],R},e.set=function f(R,N,j,W,z){return R[0]=N,R[1]=j,R[2]=W,R[3]=z,R},e.add=function p(R,N,j){return R[0]=N[0]+j[0],R[1]=N[1]+j[1],R[2]=N[2]+j[2],R[3]=N[3]+j[3],R},e.distance=function m(R,N){const j=N[0]-R[0],W=N[1]-R[1],z=N[2]-R[2],$=N[3]-R[3];return Math.sqrt(j*j+W*W+z*z+$*$)},e.scale=function h(R,N,j){return R[0]=N[0]*j,R[1]=N[1]*j,R[2]=N[2]*j,R[4]=N[4]*j,R},e.round=function g(R,N){return R[0]=Math.round(N[0]),R[1]=Math.round(N[1]),R[2]=Math.round(N[2]),R[3]=Math.round(N[3]),R},e.ceil=function y(R,N){return R[0]=Math.ceil(N[0]),R[1]=Math.ceil(N[1]),R[2]=Math.ceil(N[2]),R[3]=Math.ceil(N[3]),R},e.floor=function v(R,N){return R[0]=Math.floor(N[0]),R[1]=Math.floor(N[1]),R[2]=Math.floor(N[2]),R[3]=Math.floor(N[3]),R},e.squaredDistance=function x(R,N){const j=N[0]-R[0],W=N[1]-R[1],z=N[2]-R[2],$=N[3]-R[3];return j*j+W*W+z*z+$*$},e.norm=function _(R){const N=R[0],j=R[1],W=R[2],z=R[3];return Math.sqrt(N*N+j*j+W*W+z*z)},e.squaredNorm=function w(R){const N=R[0],j=R[1],W=R[2],z=R[3];return N*N+j*j+W*W+z*z},e.transformMat4=function A(R,N,j){const W=N[0],z=N[1],$=N[2],V=N[3];return R[0]=j[0]*W+j[4]*z+j[8]*$+j[12]*V,R[1]=j[1]*W+j[5]*z+j[9]*$+j[13]*V,R[2]=j[2]*W+j[6]*z+j[10]*$+j[14]*V,R[3]=j[3]*W+j[7]*z+j[11]*$+j[15]*V,R},e.dot=function M(R,N){return R[0]*N[0]+R[1]*N[1]+R[2]*N[2]+R[3]*N[3]},e.inverse=function E(R,N){return R[0]=1/N[0],R[1]=1/N[1],R[2]=1/N[2],R[3]=1/N[3],R},e.exactEquals=function D(R,N){return R[0]===N[0]&&R[1]===N[1]&&R[2]===N[2]&&R[3]===N[3]},e.equals=function T(R,N){const j=R[0],W=R[1],z=R[2],$=R[3],V=N[0],X=N[1],H=N[2],oe=N[3];return Math.abs(j-V)<=wi*Math.max(1,Math.abs(j),Math.abs(V))&&Math.abs(W-X)<=wi*Math.max(1,Math.abs(W),Math.abs(X))&&Math.abs(z-H)<=wi*Math.max(1,Math.abs(z),Math.abs(H))&&Math.abs($-oe)<=wi*Math.max(1,Math.abs($),Math.abs(oe))},e.toString=function F(R,N){return`[${R[0].toPrecision(N)} ${R[1].toPrecision(N)} ${R[2].toPrecision(N)}  ${R[3].toPrecision(N)}]`}}(Bn||(Bn={})),function(e){function t(){const Q=[.1,0,0,0];return Q[0]=0,Q}function n(){const Q=t();return Q[3]=1,Q}function s(Q,G,Z){Z*=.5;const ee=Math.sin(Z);return Q[0]=ee*G[0],Q[1]=ee*G[1],Q[2]=ee*G[2],Q[3]=Math.cos(Z),Q}function p(Q,G,Z,ee){const se=G[0],xe=G[1],re=G[2],ae=G[3];let he,ie,ue,_e,Fe,ge=Z[0],Ie=Z[1],me=Z[2],Ae=Z[3];return ie=se*ge+xe*Ie+re*me+ae*Ae,ie<0&&(ie=-ie,ge=-ge,Ie=-Ie,me=-me,Ae=-Ae),1-ie>1e-6?(he=Math.acos(ie),ue=Math.sin(he),_e=Math.sin((1-ee)*he)/ue,Fe=Math.sin(ee*he)/ue):(_e=1-ee,Fe=ee),Q[0]=_e*se+Fe*ge,Q[1]=_e*xe+Fe*Ie,Q[2]=_e*re+Fe*me,Q[3]=_e*ae+Fe*Ae,Q}function y(Q,G){const Z=G[0]+G[4]+G[8];let ee;if(Z>0)ee=Math.sqrt(Z+1),Q[3]=.5*ee,ee=.5/ee,Q[0]=(G[5]-G[7])*ee,Q[1]=(G[6]-G[2])*ee,Q[2]=(G[1]-G[3])*ee;else{let se=0;G[4]>G[0]&&(se=1),G[8]>G[3*se+se]&&(se=2);const xe=(se+1)%3,re=(se+2)%3;ee=Math.sqrt(G[3*se+se]-G[3*xe+xe]-G[3*re+re]+1),Q[se]=.5*ee,ee=.5/ee,Q[3]=(G[3*xe+re]-G[3*re+xe])*ee,Q[xe]=(G[3*xe+se]+G[3*se+xe])*ee,Q[re]=(G[3*re+se]+G[3*se+re])*ee}return Q}e.zero=t,e.identity=n,e.setIdentity=function r(Q){Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1},e.hasNaN=function i(Q){return isNaN(Q[0])||isNaN(Q[1])||isNaN(Q[2])||isNaN(Q[3])},e.create=function o(Q,G,Z,ee){const se=n();return se[0]=Q,se[1]=G,se[2]=Z,se[3]=ee,se},e.setAxisAngle=s,e.getAxisAngle=function a(Q,G){const Z=2*Math.acos(G[3]),ee=Math.sin(Z/2);return 0!==ee?(Q[0]=G[0]/ee,Q[1]=G[1]/ee,Q[2]=G[2]/ee):(Q[0]=1,Q[1]=0,Q[2]=0),Z},e.multiply=function l(Q,G,Z){const ee=G[0],se=G[1],xe=G[2],re=G[3],ae=Z[0],ge=Z[1],Ie=Z[2],me=Z[3];return Q[0]=ee*me+re*ae+se*Ie-xe*ge,Q[1]=se*me+re*ge+xe*ae-ee*Ie,Q[2]=xe*me+re*Ie+ee*ge-se*ae,Q[3]=re*me-ee*ae-se*ge-xe*Ie,Q},e.rotateX=function c(Q,G,Z){Z*=.5;const ee=G[0],se=G[1],xe=G[2],re=G[3],ae=Math.sin(Z),ge=Math.cos(Z);return Q[0]=ee*ge+re*ae,Q[1]=se*ge+xe*ae,Q[2]=xe*ge-se*ae,Q[3]=re*ge-ee*ae,Q},e.rotateY=function u(Q,G,Z){Z*=.5;const ee=G[0],se=G[1],xe=G[2],re=G[3],ae=Math.sin(Z),ge=Math.cos(Z);return Q[0]=ee*ge-xe*ae,Q[1]=se*ge+re*ae,Q[2]=xe*ge+ee*ae,Q[3]=re*ge-se*ae,Q},e.rotateZ=function d(Q,G,Z){Z*=.5;const ee=G[0],se=G[1],xe=G[2],re=G[3],ae=Math.sin(Z),ge=Math.cos(Z);return Q[0]=ee*ge+se*ae,Q[1]=se*ge-ee*ae,Q[2]=xe*ge+re*ae,Q[3]=re*ge-xe*ae,Q},e.calculateW=function f(Q,G){const Z=G[0],ee=G[1],se=G[2];return Q[0]=Z,Q[1]=ee,Q[2]=se,Q[3]=Math.sqrt(Math.abs(1-Z*Z-ee*ee-se*se)),Q},e.slerp=p,e.invert=function m(Q,G){const Z=G[0],ee=G[1],se=G[2],xe=G[3],re=Z*Z+ee*ee+se*se+xe*xe,ae=re?1/re:0;return Q[0]=-Z*ae,Q[1]=-ee*ae,Q[2]=-se*ae,Q[3]=xe*ae,Q},e.conjugate=function h(Q,G){return Q[0]=-G[0],Q[1]=-G[1],Q[2]=-G[2],Q[3]=G[3],Q},e.dot=function g(Q,G){return Q[0]*G[0]+Q[1]*G[1]+Q[2]*G[2]+Q[3]*G[3]},e.fromMat3=y,e.fromEuler=function v(Q,G,Z){const[ee,se,xe]=G,re=Math.cos(ee/2),ae=Math.cos(se/2),ge=Math.cos(xe/2),Ie=Math.sin(ee/2),me=Math.sin(se/2),Ae=Math.sin(xe/2);switch(Z){case"XYZ":Q[0]=Ie*ae*ge+re*me*Ae,Q[1]=re*me*ge-Ie*ae*Ae,Q[2]=re*ae*Ae+Ie*me*ge,Q[3]=re*ae*ge-Ie*me*Ae;break;case"YXZ":Q[0]=Ie*ae*ge+re*me*Ae,Q[1]=re*me*ge-Ie*ae*Ae,Q[2]=re*ae*Ae-Ie*me*ge,Q[3]=re*ae*ge+Ie*me*Ae;break;case"ZXY":Q[0]=Ie*ae*ge-re*me*Ae,Q[1]=re*me*ge+Ie*ae*Ae,Q[2]=re*ae*Ae+Ie*me*ge,Q[3]=re*ae*ge-Ie*me*Ae;break;case"ZYX":Q[0]=Ie*ae*ge-re*me*Ae,Q[1]=re*me*ge+Ie*ae*Ae,Q[2]=re*ae*Ae-Ie*me*ge,Q[3]=re*ae*ge+Ie*me*Ae;break;case"YZX":Q[0]=Ie*ae*ge+re*me*Ae,Q[1]=re*me*ge+Ie*ae*Ae,Q[2]=re*ae*Ae-Ie*me*ge,Q[3]=re*ae*ge-Ie*me*Ae;break;case"XZY":Q[0]=Ie*ae*ge-re*me*Ae,Q[1]=re*me*ge-Ie*ae*Ae,Q[2]=re*ae*Ae+Ie*me*ge,Q[3]=re*ae*ge+Ie*me*Ae;break;default:Hi()}return Q};const x=[0,0,0];function N(Q,G){const Z=G[0],ee=G[1],se=G[2],xe=G[3];let re=Z*Z+ee*ee+se*se+xe*xe;return re>0&&(re=1/Math.sqrt(re),Q[0]=Z*re,Q[1]=ee*re,Q[2]=se*re,Q[3]=xe*re),Q}e.fromUnitVec3=function _(Q,G,Z){let ee=C.dot(G,Z)+1;return ee<wi?(ee=0,Math.abs(G[0])>Math.abs(G[2])?C.set(x,-G[1],G[0],0):C.set(x,0,-G[2],G[1])):C.cross(x,G,Z),Q[0]=x[0],Q[1]=x[1],Q[2]=x[2],Q[3]=ee,N(Q,Q),Q},e.clone=function w(Q){const G=t();return G[0]=Q[0],G[1]=Q[1],G[2]=Q[2],G[3]=Q[3],G},e.toArray=function A(Q,G,Z){return G[Z+0]=Q[0],G[Z+1]=Q[1],G[Z+2]=Q[2],G[Z+3]=Q[3],G},e.fromArray=function M(Q,G,Z){return Q[0]=G[Z+0],Q[1]=G[Z+1],Q[2]=G[Z+2],Q[3]=G[Z+3],Q},e.copy=function E(Q,G){return Q[0]=G[0],Q[1]=G[1],Q[2]=G[2],Q[3]=G[3],Q},e.set=function D(Q,G,Z,ee,se){return Q[0]=G,Q[1]=Z,Q[2]=ee,Q[3]=se,Q},e.exactEquals=function T(Q,G){return Q[0]===G[0]&&Q[1]===G[1]&&Q[2]===G[2]&&Q[3]===G[3]},e.equals=function F(Q,G){const Z=Q[0],ee=Q[1],se=Q[2],xe=Q[3],re=G[0],ae=G[1],ge=G[2],Ie=G[3];return Math.abs(Z-re)<=wi*Math.max(1,Math.abs(Z),Math.abs(re))&&Math.abs(ee-ae)<=wi*Math.max(1,Math.abs(ee),Math.abs(ae))&&Math.abs(se-ge)<=wi*Math.max(1,Math.abs(se),Math.abs(ge))&&Math.abs(xe-Ie)<=wi*Math.max(1,Math.abs(xe),Math.abs(Ie))},e.add=function R(Q,G,Z){return Q[0]=G[0]+Z[0],Q[1]=G[1]+Z[1],Q[2]=G[2]+Z[2],Q[3]=G[3]+Z[3],Q},e.normalize=N;const j=[0,0,0],W=[1,0,0],z=[0,1,0];e.rotationTo=function $(Q,G,Z){const ee=C.dot(G,Z);return ee<-.999999?(C.cross(j,W,G),C.magnitude(j)<1e-6&&C.cross(j,z,G),C.normalize(j,j),s(Q,j,Math.PI),Q):ee>.999999?(Q[0]=0,Q[1]=0,Q[2]=0,Q[3]=1,Q):(C.cross(j,G,Z),Q[0]=j[0],Q[1]=j[1],Q[2]=j[2],Q[3]=1+ee,N(Q,Q))};const V=t(),X=t();e.sqlerp=function H(Q,G,Z,ee,se,xe){return p(V,G,se,xe),p(X,Z,ee,xe),p(Q,V,X,2*xe*(1-xe)),Q};const oe=[0,0,0,0,0,0,0,0,0];e.setAxes=function te(Q,G,Z,ee){return oe[0]=Z[0],oe[3]=Z[1],oe[6]=Z[2],oe[1]=ee[0],oe[4]=ee[1],oe[7]=ee[2],oe[2]=-G[0],oe[5]=-G[1],oe[8]=-G[2],N(Q,y(Q,oe))},e.toString=function K(Q,G){return`[${Q[0].toPrecision(G)} ${Q[1].toPrecision(G)} ${Q[2].toPrecision(G)}  ${Q[3].toPrecision(G)}]`},e.Identity=n()}(Ai||(Ai={})),function(e){function r(w,A,M){const E=function t(w,A,M){const E=[];for(let T=0;T<A.length;T++)E[T]=A[A.length-T-1];const D=[1];for(let T=1;T<w.length;T++)D[T]=w[E[T-1]];return{dimensions:w,axisOrderFastToSlow:E,axisOrderSlowToFast:A,accessDimensions:D,defaultCtor:M||Float64Array}}(w,A,M),{get:D,set:T,add:F,dataOffset:R,getCoords:N}=function p(w){const{dimensions:A,axisOrderFastToSlow:M}=w;switch(A.length){case 1:return{get:(E,D)=>E[D],set:(E,D,T)=>E[D]=T,add:(E,D,T)=>E[D]+=T,dataOffset:E=>E,getCoords:(E,D)=>(D[0]=E,D)};case 2:if(0===M[0]&&1===M[1]){const E=A[0];return{get:(D,T,F)=>D[F*E+T],set:(D,T,F,R)=>D[F*E+T]=R,add:(D,T,F,R)=>D[F*E+T]+=R,dataOffset:(D,T)=>T*E+D,getCoords:(D,T)=>(T[0]=D%E,T[1]=Math.floor(D/E),T)}}if(1===M[0]&&0===M[1]){const E=A[1];return{get:(D,T,F)=>D[T*E+F],set:(D,T,F,R)=>D[T*E+F]=R,add:(D,T,F,R)=>D[T*E+F]+=R,dataOffset:(D,T)=>D*E+T,getCoords:(D,T)=>(T[0]=Math.floor(D/E),T[1]=D%E,T)}}throw new Error("bad axis order");case 3:if(0===M[0]&&1===M[1]&&2===M[2]){const E=A[0],D=A[1],T=E*D;return{get:(F,R,N,j)=>F[R+N*E+j*T],set:(F,R,N,j,W)=>F[R+N*E+j*T]=W,add:(F,R,N,j,W)=>F[R+N*E+j*T]+=W,dataOffset:(F,R,N)=>F+R*E+N*T,getCoords:(F,R)=>{const N=Math.floor(F/E);return R[0]=F%E,R[1]=N%D,R[2]=Math.floor(N/D),R}}}if(0===M[0]&&2===M[1]&&1===M[2]){const E=A[0],D=A[2],T=E*D;return{get:(F,R,N,j)=>F[R+j*E+N*T],set:(F,R,N,j,W)=>F[R+j*E+N*T]=W,add:(F,R,N,j,W)=>F[R+j*E+N*T]+=W,dataOffset:(F,R,N)=>F+N*E+R*T,getCoords:(F,R)=>{const N=Math.floor(F/E);return R[0]=F%E,R[1]=Math.floor(N/D),R[2]=N%D,R}}}if(1===M[0]&&0===M[1]&&2===M[2]){const E=A[1],D=A[0],T=E*D;return{get:(F,R,N,j)=>F[N+R*E+j*T],set:(F,R,N,j,W)=>F[N+R*E+j*T]=W,add:(F,R,N,j,W)=>F[N+R*E+j*T]+=W,dataOffset:(F,R,N)=>R+F*E+N*T,getCoords:(F,R)=>{const N=Math.floor(F/E);return R[0]=N%D,R[1]=F%E,R[2]=Math.floor(N/D),R}}}if(1===M[0]&&2===M[1]&&0===M[2]){const E=A[1],D=A[2],T=E*D;return{get:(F,R,N,j)=>F[N+j*E+R*T],set:(F,R,N,j,W)=>F[N+j*E+R*T]=W,add:(F,R,N,j,W)=>F[N+j*E+R*T]+=W,dataOffset:(F,R,N)=>R+N*E+F*T,getCoords:(F,R)=>{const N=Math.floor(F/E);return R[0]=Math.floor(N/D),R[1]=F%E,R[2]=N%D,R}}}if(2===M[0]&&0===M[1]&&1===M[2]){const E=A[2],D=A[0],T=E*D;return{get:(F,R,N,j)=>F[j+R*E+N*T],set:(F,R,N,j,W)=>F[j+R*E+N*T]=W,add:(F,R,N,j,W)=>F[j+R*E+N*T]+=W,dataOffset:(F,R,N)=>N+F*E+R*T,getCoords:(F,R)=>{const N=Math.floor(F/E);return R[0]=N%D,R[1]=Math.floor(N/D),R[2]=F%E,R}}}if(2===M[0]&&1===M[1]&&0===M[2]){const E=A[2],D=A[1],T=E*D;return{get:(F,R,N,j)=>F[j+N*E+R*T],set:(F,R,N,j,W)=>F[j+N*E+R*T]=W,add:(F,R,N,j,W)=>F[j+N*E+R*T]+=W,dataOffset:(F,R,N)=>N+R*E+F*T,getCoords:(F,R)=>{const N=Math.floor(F/E);return R[0]=Math.floor(N/D),R[1]=N%D,R[2]=F%E,R}}}throw new Error("bad axis order");default:return{get:(E,...D)=>E[h(w,D)],set:(E,...D)=>E[h(w,D)]=D[D.length-1],add:(E,...D)=>E[h(w,D)]+=D[D.length-1],dataOffset:(...E)=>h(w,E),getCoords:(E,D)=>function g(w,A,M){const{dimensions:E,axisOrderFastToSlow:D}=w,T=E.length;let F=A;for(let R=0;R<T;R++){const N=E[D[R]];M[D[R]]=F%N,F=Math.floor(F/N)}return M[D[T+1]]=F,M}(w,E,D)}}}(E);return{rank:w.length,dimensions:w,axisOrderSlowToFast:A,create:m(E),get:D,set:T,add:F,dataOffset:R,getCoords:N}}function m(w){const{dimensions:A}=w;let M=1;for(let E=0,D=A.length;E<D;E++)M*=A[E];return E=>new(E||w.defaultCtor)(M)}function h(w,A){const{accessDimensions:M,axisOrderFastToSlow:E}=w,D=M.length-1;let T=M[D]*A[E[D]];for(let F=D-1;F>=0;F--)T=(T+A[E[F]])*M[F];return T}function v(w,A){const M=[];for(let E=0;E<w.length;E++)M[E]=w[A[E]];return M}e.create=function n(w,A){return{space:w,data:A}},e.Space=r,e.Data1=function i(w){return w},e.Vector=function o(w,A){return r([w],[0],A)},e.ColumnMajorMatrix=function s(w,A,M){return r([w,A],[1,0],M)},e.RowMajorMatrix=function a(w,A,M){return r([w,A],[0,1],M)},e.toMat4=function l(w,A,M){if(2!==A.rank)throw new Error("Invalid tensor rank");const E=Math.min(4,A.dimensions[0]),D=Math.min(4,A.dimensions[1]);for(let T=0;T<E;T++)for(let F=0;F<D;F++)fe.setValue(w,T,F,A.get(M,T,F));return w},e.toMat3=function c(w,A,M){if(2!==A.rank)throw new Error("Invalid tensor rank");const E=Math.min(3,A.dimensions[0]),D=Math.min(3,A.dimensions[1]);for(let T=0;T<E;T++)for(let F=0;F<D;F++)In.setValue(w,T,F,A.get(M,T,F));return w},e.toVec3=function u(w,A,M){if(1!==A.rank)throw new Error("Invalid tensor rank");const E=Math.min(3,A.dimensions[0]);for(let D=0;D<E;D++)w[D]=M[D];return w},e.toVec4=function d(w,A,M){if(1!==A.rank)throw new Error("Invalid tensor rank");const E=Math.min(4,A.dimensions[0]);for(let D=0;D<E;D++)w[D]=M[D];return w},e.areEqualExact=function f(w,A){const M=w.length;if(M!==A.length)return!1;for(let E=0;E<M;E++)if(w[E]!==A[E])return!1;return!0},e.invertAxisOrder=function y(w){const A=[];for(let M=0;M<w.length;M++)A[M]=w[w.length-M-1];return A},e.convertToCanonicalAxisIndicesFastToSlow=function x(w){const A=new Int32Array(w.length);for(let M=0;M<w.length;M++)A[w[M]]=M;return M=>v(M,A)},e.convertToCanonicalAxisIndicesSlowToFast=function _(w){const A=new Int32Array(w.length);for(let M=0;M<w.length;M++)A[w[w.length-M-1]]=M;return M=>v(M,A)}}(mr||(mr={})),function(e){let t;function r(T,F){return loe(F.T,T,F,1)}function o(T){return kR(T)}!function(T){function j(X,H=T.float){return{"@type":"tensor",T:X.create(),space:X,valueType:"tensor",baseType:H}}T.str={"@type":"str",T:"",valueType:"str"},T.ustr={"@type":"str",T:"",valueType:"str",transform:"uppercase"},T.lstr={"@type":"str",T:"",valueType:"str",transform:"lowercase"},T.int={"@type":"int",T:0,valueType:"int"},T.coord={"@type":"coord",T:0,valueType:"float"},T.float={"@type":"float",T:0,valueType:"float"},T.Str=function F(X){var H;return{"@type":"str",T:null!==(H=X?.defaultValue)&&void 0!==H?H:"",transform:X?.transform,valueType:"str"}},T.Int=function R(X=0){return{"@type":"int",T:X,valueType:"int"}},T.Float=function N(X=0){return{"@type":"float",T:X,valueType:"float"}},T.Tensor=j,T.Vector=function W(X,H=T.float){return j(mr.Vector(X,"int"===H["@type"]?Int32Array:Float64Array),H)},T.Matrix=function z(X,H,oe=T.float){return j(mr.ColumnMajorMatrix(X,H,"int"===oe["@type"]?Int32Array:Float64Array),oe)},T.Aliased=function $(X){return X},T.List=function V(X,H,oe=[]){return{"@type":"list",T:oe,separator:X,itemParse:H,valueType:"list"}}}(t=e.Schema||(e.Schema={})),e.is=function n(T){return!!T&&!!T.schema&&!!T.value},e.ValueKind={Present:0,NotPresent:1,Unknown:2},e.Undefined=r,e.ofConst=function i(T,F,R){return loe(T,F,R,0)},e.ofLambda=o,e.range=function s(T,F){return o({value:R=>R+T,rowCount:Math.max(F-T+1,0),schema:t.int})},e.ofArray=function a(T){return H0(T)},e.ofIntArray=function l(T){return H0({array:T,schema:t.int})},e.ofFloatArray=function c(T){return H0({array:T,schema:t.float})},e.ofStringArray=function u(T){return H0({array:T,schema:t.str})},e.ofStringAliasArray=function d(T){return H0({array:T,schema:t.Aliased(t.str)})},e.ofStringListArray=function f(T,F=","){return H0({array:T,schema:t.List(F,R=>R)})},e.ofIntTokens=function p(T){const{count:F,data:R,indices:N}=T;return kR({value:j=>p1(R,N[2*j],N[2*j+1])||0,rowCount:F,schema:t.int})},e.ofFloatTokens=function m(T){const{count:F,data:R,indices:N}=T;return kR({value:j=>V0(R,N[2*j],N[2*j+1])||0,rowCount:F,schema:t.float})},e.ofStringTokens=function h(T){const{count:F,data:R,indices:N}=T;return kR({value:j=>{const W=R.substring(N[2*j],N[2*j+1]);return"."===W||"?"===W?"":W},rowCount:F,schema:t.str})},e.window=function g(T,F,R){return function TFe(e,t,n){return e.isDefined?0===t&&n===e.rowCount?e:e.__array&&bU(e.__array)?function DFe(e,t,n){const r=ER(e.__array,{start:t,end:n}),i=e.valueKind;return H0({array:r,schema:e.schema,valueKind:o=>i(t+o)})}(e,t,n):function PFe(e,t,n){const r=e.value,i=e.valueKind,o=e.areValuesEqual,s=0===t?r:l=>r(l+t),a=n-t;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:a,value:s,valueKind:0===t?i:l=>i(l+t),toArray:l=>{const{array:c}=c3(a,l);for(let u=0,d=c.length;u<d;u++)c[u]=r(u+t);return c},areValuesEqual:0===t?o:(l,c)=>o(l+t,c+t)}}(e,t,n):ce.Undefined(n-t,e.schema)}(T,F,R)},e.view=function y(T,F,R=!0){return function MFe(e,t,n){return 0===e.rowCount||n&&function kFe(e,t){if(e.length!==t)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==n)return!1;return!0}(t,e.rowCount)?e:e.__array&&typeof e.value(0)==typeof e.__array[0]?function RFe(e,t){const n=e.__array,r=new n.constructor(t.length);for(let o=0,s=t.length;o<s;o++)r[o]=n[t[o]];const i=e.valueKind;return H0({array:r,schema:e.schema,valueKind:o=>i(t[o])})}(e,t):function NFe(e,t){const n=e.value,r=e.valueKind,i=e.areValuesEqual,s=t.length;return{schema:e.schema,__array:void 0,isDefined:e.isDefined,rowCount:s,value:a=>n(t[a]),valueKind:a=>r(t[a]),toArray:a=>{const{array:l}=c3(s,a);for(let c=0,u=l.length;c<u;c++)l[c]=n(t[c]);return l},areValuesEqual:(a,l)=>i(t[a],t[l])}}(e,t)}(T,F,R)},e.createFirstIndexMap=function v(T){return function IFe(e){const t=new Map;for(let n=0,r=e.rowCount;n<r;n++){const i=e.value(n);t.has(i)||t.set(e.value(n),n)}return t}(T)},e.createIndexer=function x(T){return function EFe(e){const t=new Map;for(let n=0,r=e.rowCount;n<r;n++){const i=e.value(n);t.has(i)||t.set(e.value(n),n)}return n=>t.has(n)?t.get(n):-1}(T)},e.mapToArray=function _(T,F,R){return function FFe(e,t,n){const r=new n(e.rowCount);for(let i=0,o=e.rowCount;i<o;i++)r[i]=t(e.value(i));return r}(T,F,R||Array)},e.areEqual=function w(T,F){return function OFe(e,t){return e===t||e.rowCount===t.rowCount&&e.isDefined===t.isDefined&&e.schema.valueType===t.schema.valueType&&(e.__array&&t.__array?function BFe(e,t){const n=e.__array,r=t.__array;for(let i=0,o=e.rowCount;i<o;i++)if(n[i]!==r[i])return!1;return!0}(e,t):function LFe(e,t){const n=e.value,r=t.value;for(let i=0,o=e.rowCount;i<o;i++)if(n(i)!==r(i))return!1;return!0}(e,t))}(T,F)},e.indicesOf=function A(T,F){return function jFe(e,t){const n=[],r=e.value;for(let i=0,o=e.rowCount;i<o;i++)t(r(i))&&(n[n.length]=i);return n}(T,F)},e.asArrayColumn=function M(T,F){return T.__array?T:T.isDefined?H0({array:T.toArray({array:F}),schema:T.schema,valueKind:T.valueKind}):r(T.rowCount,T.schema)},e.copyToArray=function E(T,F,R=0){if(!T.isDefined)return;const N=T.__array;if(N)for(let j=0,W=N.length;j<W;j++)F[R+j]=N[j];else for(let j=0,W=T.rowCount;j<W;j++)F[R+j]=T.value(j)},e.isIdentity=function D(T){for(let F=0,R=T.rowCount;F<R;F++)if(F!==T.value(F))return!1;return!0}}(ce||(ce={})),function(e){function l(_,w,A){const M=Object.create(null),E=Object.keys(w);M._rowCount=A.length,M._columns=E,M._schema=w;for(const D of E)M[D]=ce.view(_[D],A);return M}function h(_,w){const A=Object.create(null),{_columns:M}=_;for(let E=0;E<M.length;E++){const D=M[E];A[D]=_[D].value(w)}return A}e.is=function t(_){return _&&"number"==typeof _._rowCount&&!!_._columns&&!!_._schema},e.pickColumns=function n(_,w,A={}){const M=Object.create(null),E=Object.keys(_);M._rowCount=w._rowCount,M._columns=E,M._schema=_;for(const D of E)if(w[D])M[D]=w[D];else{if(!A[D])throw Error(`Cannot find column '${D}'.`);M[D]=A[D]}return M},e.ofColumns=function r(_,w){const A=Object.keys(w);return{_rowCount:w[A[0]].rowCount,_columns:A,_schema:_,...w}},e.ofPartialColumns=function i(_,w,A){const M=Object.create(null),E=Object.keys(_);M._rowCount=A,M._columns=E,M._schema=_;for(const D of E)M[D]=D in w?w[D]:ce.Undefined(A,_[D]);return M},e.ofUndefinedColumns=function o(_,w){const A=Object.create(null),M=Object.keys(_);A._rowCount=w,A._columns=M,A._schema=_;for(const E of M)A[E]=ce.Undefined(w,_[E]);return A},e.ofRows=function s(_,w){const A=Object.create(null),M=w.length,E=Object.keys(_);A._rowCount=M,A._columns=E,A._schema=_;for(const D of E)A[D]=ce.ofLambda({rowCount:M,schema:_[D],value:T=>w[T][D],valueKind:T=>typeof w[T][D]>"u"?1:0});return A},e.ofArrays=function a(_,w){var A;const M=Object.create(null),E=Object.keys(_);M._rowCount=0,M._columns=E,M._schema=_;for(const D of E)typeof w[D]<"u"?(M[D]=ce.ofArray({array:w[D],schema:_[D]}),M._rowCount=null===(A=w[D])||void 0===A?void 0:A.length):M[D]=ce.Undefined(M._rowCount,_[D]);return M},e.view=l,e.pick=function c(_,w,A){const M=[];for(let E=0,D=_._rowCount;E<D;++E)A(E)&&M.push(E);return l(_,w,M)},e.window=function u(_,w,A,M){if(0===A&&M===_._rowCount)return _;const E=Object.create(null),D=Object.keys(w);E._rowCount=M-A,E._columns=D,E._schema=w;for(const T of D)E[T]=ce.window(_[T],A,M);return E},e.concat=function d(_,w){const A=Object.create(null),M=Object.keys(w);A._rowCount=0;for(const T of _)A._rowCount+=T._rowCount;const E={};for(const T of M)E[T]=new Array(A._rowCount);A._columns=M,A._schema=w;let D=0;for(const T of _){for(const F of M)ce.copyToArray(T[F],E[F],D);D+=T._rowCount}for(const T of M)A[T]=ce.ofArray({array:E[T],schema:w[T]});return A},e.columnToArray=function f(_,w,A){_[w]=ce.asArrayColumn(_[w],A)},e.sort=function p(_,w){const A=new Int32Array(_._rowCount);for(let D=0,T=A.length;D<T;D++)A[D]=D;ip(A,(D,T,F)=>w(T,F));let M=!0;for(let D=0,T=A.length;D<T;D++)if(A[D]!==D){M=!1;break}if(M)return _;const E=Object.create(null);E._rowCount=_._rowCount,E._columns=_._columns,E._schema=_._schema;for(const D of _._columns)E[D]=ce.view(_[D],A,!1);return E},e.areEqual=function m(_,w){if(_._rowCount!==w._rowCount||_._columns.length!==w._columns.length)return!1;for(const A of _._columns)if(!w[A])return!1;for(const A of _._columns)if(!ce.areEqual(_[A],w[A]))return!1;return!0},e.getRow=h,e.pickRow=function g(_,w){for(let A=0,M=_._rowCount;A<M;++A)if(w(A))return h(_,A)},e.getRows=function y(_){const w=[],{_rowCount:A}=_;for(let M=0;M<A;M++)w[M]=h(_,M);return w},e.toArrays=function v(_){const w={},{_columns:A}=_;for(let M=0;M<A.length;M++){const E=A[M];w[E]=_[E].toArray()}return w},e.formatToString=function x(_){const w=ci.create(),{_columns:A,_rowCount:M}=_;let E=1;ci.write(w,"|");for(let D=0;D<A.length;D++)ci.write(w,A[D]),ci.write(w,"|"),E+=A[D].length+1;ci.newline(w),ci.write(w,new Array(E+1).join("-")),ci.newline(w);for(let D=0;D<M;D++){ci.write(w,"|");for(let T=0;T<A.length;T++){const F=_[A[T]];0===F.valueKind(D)?(ci.write(w,F.value(D)),ci.write(w,"|")):ci.write(w,".|")}ci.newline(w)}return ci.getString(w)}}(Kr||(Kr={})),function(e){e.ofTables=function t(r,i,o){const s=Object.keys(o),a=Object.create(null),l=[];a._name=r,a._tableNames=l,a._schema=i;for(const c of s)Kr.is(o[c])&&(a[c]=o[c],l[l.length]=c);return a},e.getTablesAsRows=function n(r){const i={};for(const o of r._tableNames)i[o]=Kr.getRows(r[o]);return i}}(wU||(wU={})),function(e){e.create=function t(l,c,u){const d=!!l[0].cell,f=!!l[0].velocities,p=!!l[0].forces;return{id:oo.create22(),frames:l,hasCell:d,hasVelocities:f,hasForces:p,deltaTime:c,timeOffset:u}},e.getAtomicConformation=function n(l,c,u){var d,f;let{x:p,y:m,z:h}=l;return l.xyzOrdering.frozen?u?l.xyzOrdering.isIdentity?(p=s(p,u),m=s(m,u),h=s(h,u)):Ru(l.xyzOrdering.index,u)||(p=o(p,l.xyzOrdering.index,u),m=o(m,l.xyzOrdering.index,u),h=o(h,l.xyzOrdering.index,u)):l.xyzOrdering.isIdentity||(p=a(p,l.xyzOrdering.index),m=a(m,l.xyzOrdering.index),h=a(h,l.xyzOrdering.index)):u&&(l.xyzOrdering.isIdentity?(l.xyzOrdering.isIdentity=!1,l.xyzOrdering.index=u,i(p,u),i(m,u),i(h,u)):Ru(l.xyzOrdering.index,u)||(p=o(p,l.xyzOrdering.index,u),m=o(m,l.xyzOrdering.index,u),h=o(h,l.xyzOrdering.index,u))),l.xyzOrdering.frozen=!0,{id:oo.create22(),atomId:c.atomId,occupancy:null!==(d=c.occupancy)&&void 0!==d?d:ce.ofConst(1,l.elementCount,ce.Schema.int),B_iso_or_equiv:null!==(f=c.B_iso_or_equiv)&&void 0!==f?f:ce.ofConst(0,l.elementCount,ce.Schema.float),xyzDefined:!0,x:p,y:m,z:h}};const r=[.123];function i(l,c){const u=r;for(let d=0,f=l.length;d<f;d++)u[d]=l[c[d]];for(let d=0,f=l.length;d<f;d++)l[d]=u[d]}function o(l,c,u){const d=new Float32Array(l.length);for(let f=0,p=l.length;f<p;f++)d[f]=l[c[u[f]]];return d}function s(l,c){const u=new Float32Array(l.length);for(let d=0,f=l.length;d<f;d++)u[d]=l[c[d]];return u}function a(l,c){const u=new Float32Array(l.length);for(let d=0,f=l.length;d<f;d++)u[c[d]]=l[d];return u}}(Wx||(Wx={})),function(e){e.create=function t(n,r,i,o){return{id:oo.create22(),label:n,basic:r,sourceData:o,bonds:i}}}(f3||(f3={})),function(e){e.getUUID=function t(n){return n.__key||(n.__key=oo.create22()),n.__key}}(hf||(hf={}));class Oh{constructor(){this._list=[],this._set=new Set,this._refs=new Map,this._assets=new Map}get all(){return this._list}add(t){this._set.has(t)||(this._list.push(t),this._set.add(t))}reference(t,n){let r=this._refs.get(t)||0;r+=n?1:-1,this._refs.set(t,Math.max(r,0))}hasReference(t){return(this._refs.get(t)||0)>0}has(t){return this._set.has(t)}assets(t,n){const r=this._assets.get(t);if(r)for(const i of r)i.dispose();n?this._assets.set(t,n):this._assets.delete(t)}dispose(){this._assets.forEach(t=>{for(const n of t)n.dispose()})}}const NR=Object.prototype.hasOwnProperty;function WFe(e,t){let n=!1;for(const r of Object.keys(t))if(NR.call(t,r)&&t[r]!==e[r]){n=!0;break}return n?Object.assign({},e,t):e}function FR(e,t){if(!e)return!t;if(!t)return!1;const n=Object.keys(e);if(Object.keys(t).length!==n.length)return!1;for(const r of n)if(!NR.call(e,r)||e[r]!==t[r])return!1;return!0}function op(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Array){const t=[];for(let n=0,r=e.length;n<r;n++)t[n]=op(e[n]);return t}if("object"==typeof e&&!("prototype"in e)){const t={};for(const n in e)NR.call(e,n)&&(t[n]=op(e[n]));return t}throw new Error(`Can't clone, type "${typeof e}" unsupported`)}function Nu(e,t){if(e)for(const n of Object.keys(e))t(e[n],n)}function Bh(e){let t=-1/0;for(let n=0,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}function OR(e){let t=1/0;for(let n=0,r=e.length;n<r;++n)e[n]<t&&(t=e[n]);return t}function mf(e){let t=1/0,n=-1/0;for(let r=0,i=e.length;r<i;++r)e[r]<t&&(t=e[r]),e[r]>n&&(n=e[r]);return[t,n]}function foe(e,t=1,n=0){const r=e.length;let i=0;for(let o=n;o<r;o+=t)i+=e[o];return i}function BR(e,t=1,n=0){return foe(e,t,n)/(e.length/t)}function LR(e){const t=e.length;let n=0;for(let r=0;r<t;++r){const i=e[r];n+=i*i}return Math.sqrt(n/t)}function Sd(e,t){for(let n=0,r=t?Math.min(t,e.length):e.length;n<r;++n)e[n]=n;return e}function p3(e,t){let n=0,r=!1;for(const i=e.length;n<i;n++)if(e[n]===t){r=!0;break}return!!r&&(h3(e,n),!0)}function h3(e,t){for(let n=t,r=e.length-1;n<r;n++)e[n]=e[n+1];e.pop()}function Us(e,t){return!(e.indexOf(t)>=0||(e.push(t),0))}function $x(e,t){const n=e.indexOf(t);if(n<0)return!1;for(let r=n,i=e.length-1;r<i;r++)e[r]=e[r+1];return e.pop(),!0}function jR(e,t){let n=0;for(let r=0,i=e.length;r<i;++r)t.includes(e[r])&&(n+=1);return n}function IU(e,t){if(!e||0===e.length)return!t||0===t.length;if(!t)return!1;const n=e.length;if(n!==t.length)return!1;for(let r=0;r<n;r++)if(e[r]!==t[r])return!1;return!0}function UR(e,t,n){for(let r=0,i=e.length;r<i;++r)if(e[r][0]===t)return void(e[r][1]=n);e.push([t,n])}const EU=typeof setImmediate<"u"?typeof window<"u"?{setImmediate:(e,...t)=>window.setImmediate(e,...t),clearImmediate:e=>window.clearImmediate(e)}:{setImmediate,clearImmediate}:function JFe(){const e=function(){const h=typeof window<"u"&&window,g=typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self;return h||typeof global<"u"&&global||g}(),t={},n=typeof document<"u"?document:void 0;let i,r=1;function s(h){delete t[h]}function l(h){const g=t[h];s(h),function a(h){const g=h.callback,y=h.args;switch(y.length){case 0:g();break;case 1:g(y[0]);break;case 2:g(y[0],y[1]);break;case 3:g(y[0],y[1],y[2]);break;default:g.apply(void 0,y)}}(g)}return typeof process<"u"&&"[object process]"==={}.toString.call(process)?function c(){i=function(h){process.nextTick(function(){l(h)})}}():function u(){if(e&&e.postMessage&&!e.importScripts){let h=!0;const g=e.onmessage;return e.onmessage=function(){h=!1},e.postMessage("","*"),e.onmessage=g,h}}()?function d(){const h="setImmediate$"+Math.random()+"$",g=function(y){y.source===e&&"string"==typeof y.data&&0===y.data.indexOf(h)&&l(+y.data.slice(h.length))};window.addEventListener?window.addEventListener("message",g,!1):window.attachEvent("onmessage",g),i=function(y){window.postMessage(h+y,"*")}}():typeof MessageChannel<"u"?function f(){const h=new MessageChannel;h.port1.onmessage=function(g){l(g.data)},i=function(g){h.port2.postMessage(g)}}():n&&"onreadystatechange"in n.createElement("script")?function p(){const h=n.documentElement;i=function(g){let y=n.createElement("script");y.onreadystatechange=function(){l(g),y.onreadystatechange=null,h.removeChild(y),y=null},h.appendChild(y)}}():function m(){i=function(h){setTimeout(l,0,h)}}(),{setImmediate:function o(h,...g){return"function"!=typeof h&&(h=new Function(""+h)),t[r]={callback:h,args:g},i(r),r++},clearImmediate:s}}();function eOe(e){EU.setImmediate(e)}const m3={setImmediate:EU.setImmediate,clearImmediate:EU.clearImmediate,immediatePromise:()=>new Promise(eOe),delay:(e,t=void 0)=>new Promise(n=>setTimeout(n,e,t))};let g3=function(){try{return!0}catch{return!1}}(),$n=function(){try{const t=process.env.DEBUG;return"*"===t||"molstar"===t}catch{return!1}}(),It=!1;const y3=[],TU=typeof performance<"u"&&!!performance.mark&&performance.measure&&It;var b3;function iOe(e,t,n=250){const r=moe(e,t,n);return new zR(r,r.root)}function poe(e,t){return DU(t,e)}function hoe(e){return{taskId:e.id,taskName:e.name,message:"",startedTime:0,canAbort:!0,isIndeterminate:!0,current:0,max:0}}function moe(e,t,n){const r={abortRequested:!1,treeAborted:!1,reason:""};return{updateRateMs:n,lastNotified:Bo(),observer:t,abortToken:r,taskId:e.id,root:{progress:hoe(e),children:[]},tryAbort:sOe(r)}}function sOe(e){return t=>{e.abortRequested=!0,e.reason=t||e.reason}}function goe(e){return{progress:{...e.progress},children:e.children.map(goe)}}function yoe(e){return e.progress.canAbort&&e.children.every(yoe)}function DU(e,t){return PU.apply(this,arguments)}function PU(){return PU=le(function*(e,t){b3.markStart(e),t.node.progress.startedTime=Bo();try{const n=yield e.f(t);return b3.markEnd(e),b3.measure(e),t.info.abortToken.abortRequested&&boe(t.info),n}catch(n){throw Ke.isAbort(n)&&(t.isAborted=!0,t.node.children.length>0&&(yield new Promise(r=>{t.onChildrenFinished=r})),e.onAbort&&e.onAbort()),n}}),PU.apply(this,arguments)}function boe(e){throw e.abortToken.treeAborted||(e.abortToken.treeAborted=!0,voe(e.root),xoe(e,Bo())),Ke.Aborted(e.abortToken.reason)}function voe(e){const t=e.progress;t.isIndeterminate=!0,t.canAbort=!1,t.message="Aborting...";for(const n of e.children)voe(n)}function xoe(e,t){e.lastNotified=t;const n=function aOe(e){return{root:goe(e.root),canAbort:yoe(e.root),requestAbort:e.tryAbort}}(e);e.observer(n)}!function(e){function t(s){return`startTask${s.id}`}function n(s){return`endTask${s.id}`}e.markStart=function r(s){TU&&performance.mark(t(s))},e.markEnd=function i(s){TU&&performance.mark(n(s))},e.measure=function o(s){TU&&performance.measure(`\u2733\ufe0f ${s.name}`,t(s),n(s))}}(b3||(b3={}));class zR{checkAborted(){this.info.abortToken.abortRequested&&(this.isAborted=!0,boe(this.info))}get shouldUpdate(){return this.checkAborted(),Bo()-this.lastUpdatedTime>this.info.updateRateMs}updateProgress(t){if(this.checkAborted(),!t)return;const n=this.node.progress;"string"==typeof t?(n.message=t,n.isIndeterminate=!0):(typeof t.canAbort<"u"&&(n.canAbort=t.canAbort),typeof t.message<"u"&&(n.message=t.message),typeof t.current<"u"&&(n.current=t.current),typeof t.max<"u"&&(n.max=t.max),n.isIndeterminate=typeof n.current>"u"||typeof n.max>"u",typeof t.isIndeterminate<"u"&&(n.isIndeterminate=t.isIndeterminate))}update(t,n){if(this.lastUpdatedTime=Bo(),this.updateProgress(t),!n)return xoe(this.info,this.lastUpdatedTime),this.checkAborted(),m3.immediatePromise()}runChild(t,n){var r=this;return le(function*(){r.updateProgress(n);const i={progress:hoe(t),children:[]},o=r.node.children;o.push(i);const s=new zR(r.info,i);try{return yield DU(t,s)}catch(a){if(Ke.isAbort(a)&&r.isAborted)return;throw a}finally{const a=o.indexOf(i);if(a>=0){for(let l=a,c=o.length-1;l<c;l++)o[l]=o[l+1];o.pop()}0===o.length&&r.onChildrenFinished&&r.onChildrenFinished()}})()}constructor(t,n){this.isSynchronous=!1,this.isExecuting=!0,this.lastUpdatedTime=0,this.onChildrenFinished=void 0,this.node=n,this.info=t}}const VR=new class lOe{constructor(){this.shouldUpdate=!1,this.isSynchronous=!0}update(t,n){}};var Ke,_oe,tt,va;function G0(e,t,n,r,i){return kU.apply(this,arguments)}function kU(){return kU=le(function*(e,t,n,r,i){let o=Math.max(t,0),s=0,a=0;if(e.isSynchronous)return r(Number.MAX_SAFE_INTEGER,n),n;let l=Bo(),c=0,u=0;for(;(c=r(o,n))>0;){s+=c;const d=Bo()-l;u+=d,a+=d,e.shouldUpdate&&(yield i(e,n,s),o=Math.round(u*s/a)+1,l=Bo(),u=0)}return e.shouldUpdate&&(yield i(e,n,s)),n}),kU.apply(this,arguments)}function uOe(e,t,n){return e[t].key<e[n].key?-1:1}function MU(e,t,n){const r=n&&n.start||0,i=n&&n.end||e.length;if(i-r<=0)throw new Error("Can only bucket non-empty collections.");return function dOe(e,t,n,r,i){const o=new Map,s=[];let a=t(e[0]),l=!0;for(let p=r;p<i;p++){const m=t(e[p]);if(o.has(m))o.get(m).count++,a!==m&&(l=!1);else{const h={key:m,count:1,offset:p};o.set(m,h),s[s.length]=h}a=m}const c=new Int32Array(s.length+1);c[s.length]=i;let u=!0;if(n)for(let p=1,m=s.length;p<m;p++)if(s[p-1].key>s[p].key){u=!1;break}if(l&&u){for(let p=0;p<s.length;p++)c[p]=s[p].offset;return c}n&&!u&&uoe(s,0,s.length,uOe,qx);let d=0;for(let p=0;p<s.length;p++){const m=s[p];m.offset=d,d+=m.count}const f=new Int32Array(i-r);for(let p=r;p<i;p++){const m=t(e[p]);f[o.get(m).offset++]=e[p]}for(let p=0,m=f.length;p<m;p++)e[p+r]=f[p];c[0]=r;for(let p=1;p<s.length;p++)c[p]=s[p-1].offset+r;return c}(e,t,!(!n||!n.sort),r,i)}!function(e){class t{run(f,p=250){return f?function rOe(e,t,n=250){const r=moe(e,t,n);return DU(e,new zR(r,r.root))}(this,f,p):this.f(VR)}runAsChild(f,p){return f.isSynchronous?this.f(VR):function oOe(e,t,n){return e.runChild(t,n)}(f,this,p)}runInContext(f){return f.isSynchronous?this.f(VR):poe(f,this)}constructor(f,p,m){this.name=f,this.f=p,this.onAbort=m,this.id=u()}}function n(d){return!!d&&"number"==typeof d.id&&"string"==typeof d.name&&!!d.run}function o(d,f,p){return new t(d,f,p)}e.is=n,e.isAbort=function r(d){return!!d&&!!d.isAborted},e.Aborted=function i(d){return{isAborted:!0,reason:d,toString:()=>"Aborted"+(d?": "+d:"")}},e.create=o,e.constant=function s(d,f){return o(d,function(){var p=le(function*(m){return f});return function(m){return p.apply(this,arguments)}}())},e.empty=function a(){return o("",function(){var d=le(function*(f){});return function(f){return d.apply(this,arguments)}}())},e.fail=function l(d,f){return o(d,function(){var p=le(function*(m){throw new Error(f)});return function(m){return p.apply(this,arguments)}}())},e.resolveInContext=function c(d,f){return n(d)?f?d.runInContext(f):d.run():d};const u=Kc(0,1073741823)}(Ke||(Ke={})),function(e){function t(r,i=""){const o=r.progress;if(!r.children.length)return o.isIndeterminate?`${i}${o.taskName}: ${o.message}`:`${i}${o.taskName}: [${o.current}/${o.max}] ${o.message}`;const s=i+"  |_ ",a=r.children.map(l=>t(l,s));return o.isIndeterminate?`${i}${o.taskName}: ${o.message}\n${a.join("\n")}`:`${i}${o.taskName}: [${o.current}/${o.max}] ${o.message}\n${a.join("\n")}`}e.format=function n(r){return t(r.root)}}(_oe||(_oe={})),function(e){function n(f){const p=f.growBy*f.elementSize;f.currentSize=p,f.currentIndex=0,f.currentChunk=new f.ctor(p),f.allocatedSize+=p,f.chunks[f.chunks.length]=f.currentChunk}function u(f,p){const{ctor:m,chunks:h,currentIndex:g}=f;if(!h.length)return new m(0);if(1===h.length&&(p||g===f.allocatedSize))return h[0];let y=0;for(let w=0,A=h.length-1;w<A;w++)y+=h[w].length;y+=f.currentIndex;const v=new m(y);let x=0;if(v.buffer)for(let w=0,A=h.length-1;w<A;w++)v.set(h[w],x),x+=h[w].length;else for(let w=0,A=h.length-1;w<A;w++){const M=h[w];for(let E=0,D=M.length;E<D;E++)v[x+E]=M[E];x+=M.length}const _=h[h.length-1];if(v.buffer&&g>=f.currentSize)v.set(_,x);else for(let w=0,A=_.length;w<A;w++)v[x+w]=_[w];return v}e.is=function t(f){return f.creator&&f.chunkSize},e.add4=function r(f,p,m,h,g){f.currentIndex>=f.currentSize&&n(f);const y=f.currentChunk,v=f.currentIndex;return y[v]=p,y[v+1]=m,y[v+2]=h,y[v+3]=g,f.currentIndex+=4,f.elementCount++},e.add3=function i(f,p,m,h){f.currentIndex>=f.currentSize&&n(f);const g=f.currentChunk,y=f.currentIndex;return g[y]=p,g[y+1]=m,g[y+2]=h,f.currentIndex+=3,f.elementCount++},e.add2=function o(f,p,m){f.currentIndex>=f.currentSize&&n(f);const h=f.currentChunk,g=f.currentIndex;return h[g]=p,h[g+1]=m,f.currentIndex+=2,f.elementCount++},e.add=function s(f,p){return f.currentIndex>=f.currentSize&&n(f),f.currentChunk[f.currentIndex]=p,f.currentIndex+=1,f.elementCount++},e.addRepeat=function a(f,p,m){for(let h=0;h<p;h++)f.currentIndex>=f.currentSize&&n(f),f.currentChunk[f.currentIndex++]=m,f.elementCount++;return f.elementCount},e.addMany=function l(f,p){const{elementSize:m}=f;for(let h=0,g=p.length;h<g;h+=m){f.currentIndex>=f.currentSize&&n(f);const{currentChunk:y}=f;for(let v=0;v<m;v++)y[f.currentIndex++]=p[h+v];f.elementCount++}return f.elementCount},e.compact=function c(f,p=!1){return u(f,p)},e._compact=u,e.create=function d(f,p,m,h){const g={ctor:f,elementSize:p,growBy:Math.max(1,Math.ceil(m)),allocatedSize:0,elementCount:0,currentSize:0,currentChunk:void 0,currentIndex:0,chunks:[]};if(typeof h>"u")return g;if("number"==typeof h)return g.currentChunk=new f(h*p),g.allocatedSize=h*p,g.currentSize=g.currentChunk.length,g.chunks[0]=g.currentChunk,g;const y=h;if(y.length%p!=0)throw new Error("initialChunk length must be a multiple of the element size.");return g.currentChunk=y,g.allocatedSize=y.length,g.currentSize=y.length,g.chunks[0]=y,g}}(tt||(tt={}));class fOe{createGroup(t,n){const r=this.id++,i=[t];return this.groups[r]=i,{id:r,keys:i,value:n}}add(t,n){const r=this.getHash(n);if(this.byHash.has(r)){const i=this.byHash.get(r);for(let s=0,a=i.length;s<a;s++){const l=i[s];if(this.areEqual(n,l.value))return l.keys[l.keys.length]=t,l.value}const o=this.createGroup(t,n);return i[i.length]=o,o.value}{const i=this.createGroup(t,n);return this.byHash.set(r,[i]),i.value}}constructor(t,n){this.getHash=t,this.areEqual=n,this.id=0,this.byHash=new Map,this.groups=[]}}function Soe(e){let t=e^e>>4;return t=(3735928559^t)+(t<<5),t^=t>>11,t}function Yx(e,t){let n=23;return n=31*n+e|0,n=31*n+t|0,n^=n>>4,n=(3735928559^n)+(n<<5),n^=n>>11,n}function RU(e){let t=0;for(let n=0,r=e.length;n<r;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t}function gf(e,t){return(e+t)*(e+t+1)/2+t}function v3(e,t){return e<t?gf(e,t):gf(t,e)}function Coe(e,t){const n=Math.floor((Math.sqrt(8*t+1)-1)/2),i=t-(n*n+n)/2;return e[0]=n-i,e[1]=i,e}function Zc(e){let t=2166136261;for(let n=0,r=e.length;n<r;++n)t^=e[n],t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}function NU(e,t){for(let n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n]}function FU(e){if(Array.from)return Array.from(e);const t=[];for(;;){const{done:n,value:r}=e.next();if(n)break;t[t.length]=r}return t}function OU(e,t,n){const r=t-e+1,i=n?new n(r):new Int32Array(r);for(let o=0;o<r;o++)i[o]=o+e;return i}function bOe(e,t){const n=new(function vOe(e){const t=e.constructor;if(!t)throw new Error("data does not define a constructor and it should");return t}(e))(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=e[t[r]];return n}!function(e){e.Zero=0;const{_int32:t,_float64:n,_int32_1:r,_float64_1:i}=function(){const h=new ArrayBuffer(8),g=new ArrayBuffer(8);return{_int32:new Int32Array(h),_float64:new Float64Array(h),_int32_1:new Int32Array(g),_float64_1:new Float64Array(g)}}();e.is=function o(h){return"number"==typeof h},e.create=function s(h,g){return t[0]=h,t[1]=g,n[0]},e.diff=function a(h){return n[0]=h,t[1]-t[0]},e.fst=function l(h){return n[0]=h,t[0]},e.snd=function c(h){return n[0]=h,t[1]},e.areEqual=function u(h,g){return n[0]=h,i[0]=g,t[0]===r[0]&&t[1]===r[1]},e.compare=function d(h,g){n[0]=h,i[0]=g;const y=t[0]-r[0];return 0!==y?y:t[1]-r[1]},e.compareInArray=function f(h,g,y){n[0]=h[g],i[0]=h[y];const v=t[0]-r[0];return 0!==v?v:t[1]-r[1]},e.hashCode=function p(h){return n[0]=h,Yx(t[0],t[1])},e.toString=function m(h){return n[0]=h,`(${t[0]}, ${t[1]})`}}(va||(va={}));const woe=va.Zero;function Aoe(e,t){return va.create(e,t<e?e:t+1)}function BU(e,t){return va.create(e,t<=e?e:t)}function xOe(e){return va.create(0,e<0?0:e)}const _Oe=va.is,q0=va.fst,h1=va.snd,HR=va.fst;function GR(e){return va.snd(e)-1}const Xx=va.diff,SOe=va.hashCode,COe=va.toString;function wOe(e,t){return va.fst(e)<=t&&t<va.snd(e)}function AOe(e,t){const n=q0(e);return t>=n&&t<h1(e)?t-n:-1}function IOe(e,t){return va.fst(e)+t}const EOe=va.areEqual;function Ioe(e,t){const n=Xx(e),r=Xx(t);return 0===n&&0===r||n>0&&r>0&&GR(e)>=HR(t)&&HR(e)<=GR(t)}function TOe(e,t){return Xx(e)?!Xx(t)||q0(e)<=q0(t)&&h1(e)>=h1(t):0===Xx(t)}function LU(e,t){const n=q0(e);if(t<=n)return 0;const r=h1(e);return t>=r?r-n:t-n}function DOe(e,t,n){const r=q0(n),i=q0(e);if(t<=r+i)return r;const o=h1(n);return t>=o+i?o:t-i}function Eoe(e,t,n){return BU(LU(e,t),LU(e,n+1))}function POe(e,t){return Ioe(e,t)?BU(Math.max(q0(e),q0(t)),Math.min(h1(e),h1(t))):woe}function kOe(e,t){return Xx(Eoe(e,HR(t),GR(t)))}var Pe;!function(e){e.Empty=woe,e.ofSingleton=t=>Aoe(t,t),e.ofRange=Aoe,e.ofBounds=BU,e.ofLength=xOe,e.is=_Oe,e.has=wOe,e.indexOf=AOe,e.getAt=IOe,e.start=q0,e.end=h1,e.min=HR,e.max=GR,e.size=Xx,e.hashCode=SOe,e.toString=COe,e.areEqual=EOe,e.areIntersecting=Ioe,e.isSubInterval=TOe,e.findPredecessorIndex=LU,e.findPredecessorIndexInInterval=DOe,e.findRange=Eoe,e.intersectionSize=kOe,e.intersect=POe}(Pe||(Pe={}));const x3=[];function MOe(e){return[e]}function ROe(e){return e}function NOe(e){return ip(e),e}function Toe(e,t){if(t<e)return[];const n=new Int32Array(t-e+1);for(let r=e;r<=t;r++)n[r-e]=r;return n}function FOe(e){return e&&(Array.isArray(e)||!!e.buffer)}function Doe(e){return e[e.length-1]-e[0]+1===e.length}function jU(e){return e[0]}function UU(e){return e[e.length-1]+1}function OOe(e){return e[0]}function BOe(e){return e[e.length-1]}function Poe(e){return e.length}function LOe(e){const t=e.length;return t?t>2?function mOe(e,t,n,r){let i=23;return i=31*i+e|0,i=31*i+t|0,i=31*i+n|0,i=31*i+r|0,i^=i>>4,i=(3735928559^i)+(i<<5),i^=i>>11,i}(t,e[0],e[t-1],e[t>>1]):function hOe(e,t,n){let r=23;return r=31*r+e|0,r=31*r+t|0,r=31*r+n|0,r^=r>>4,r=(3735928559^r)+(r<<5),r^=r>>11,r}(t,e[0],e[t-1]):0}function jOe(e){const t=e.length;return t>5?`[${e[0]}, ${e[1]}, ..., ${e[t-1]}], length ${t}`:`[${e.join(", ")}]`}function koe(e,t){const n=e.length;return 0===n?-1:e[0]<=t&&t<=e[n-1]?Noe(e,t,0,n):-1}function UOe(e,t,n){return Moe(e,t,Pe.start(n),Pe.end(n))}function Moe(e,t,n,r){return 0===e.length||r<=n?-1:e[n]<=t&&t<=e[r-1]?Noe(e,t,n,r):-1}function zOe(e,t){return koe(e,t)>=0}function Roe(e,t){if(e===t)return!0;let n=e.length;if(n!==t.length||e[0]!==t[0]||e[n-1]!==t[n-1])return!1;if(Doe(e))return!0;n--;for(let r=1;r<n;r++)if(e[r]!==t[r])return!1;return!0}function Kx(e,t){const n=e.length;return t<=e[0]?0:t>e[n-1]?n:Foe(e,t,0,n)}function VOe(e,t,n){const r=Pe.start(n),i=Pe.end(n),o=e[r];return t<=o?r:i>r&&t>e[i-1]?i:t-o<=11?function GOe(e,t,n,r){for(let i=n;i<r;i++)if(t<=e[i])return i;return r}(e,t,r+1,i):Foe(e,t,r,i)}function HOe(e,t,n){return Pe.ofBounds(Kx(e,t),Kx(e,n+1))}function Noe(e,t,n,r){let i=n,o=r-1;for(;i<=o;){if(i+11>o){for(let l=i;l<=o;l++)if(t===e[l])return l;return-1}const s=i+o>>1,a=e[s];if(t<a)o=s-1;else{if(!(t>a))return s;i=s+1}}return-1}function Foe(e,t,n,r){let i=n,o=r-1;for(;i<o;){if(i+11>o){for(let l=i;l<=o;l++)if(t<=e[l])return l;return o+1}const s=i+o>>1,a=e[s];if(t<a)o=s-1;else{if(!(t>a))return s;i=s+1}}return i>o?o+1:e[i]>=t?i:i+1}function qOe(e,t){if(e===t)return!0;let{startI:n,startJ:r,endI:i,endJ:o}=Zx(e,t);for(;n<i&&r<o;){const s=e[n],a=t[r];if(s<a)n++;else{if(!(s>a))return!0;r++}}return!1}function WOe(e,t){if(e===t)return!0;const n=t.length;let{startI:r,startJ:i,endI:o,endJ:s}=Zx(e,t);if(s-i<n||o-r<n)return!1;let a=0;for(;r<o&&i<s;){const l=e[r],c=t[i];l<c?r++:l>c?i++:(r++,i++,a++)}return a===n}function Ooe(e,t){if(e===t)return e;const n=e.length,r=t.length;if(0===n)return t;if(0===r)return e;if(e[0]>t[0])return Ooe(t,e);const{startI:i,startJ:o,endI:s,endJ:a}=Zx(e,t),l=zU(e,t,i,o,s,a);if(l===n&&l===r||l===r)return e;if(l===n)return t;const c=new Int32Array(n+r-l);let u=0,d=0,f=0;for(u=0;u<i;u++)c[f++]=e[u];for(;d<a&&e[i]>t[d];)c[f++]=t[d++];for(;u<s&&d<a;){const p=e[u],m=t[d];p<m?(c[f++]=p,u++):p>m?(c[f++]=m,d++):(c[f++]=p,u++,d++)}for(;u<s;u++)c[f++]=e[u];for(;d<a;d++)c[f++]=t[d];for(;u<n;u++)c[f++]=e[u];for(;d<r;d++)c[f++]=t[d];return c}function $Oe(e,t){if(e===t)return Poe(e);const{startI:n,startJ:r,endI:i,endJ:o}=Zx(e,t);return zU(e,t,n,r,i,o)}function zU(e,t,n,r,i,o){let s=n,a=r,l=0;for(;s<i&&a<o;){const c=e[s],u=t[a];c<u?s++:c>u?a++:(s++,a++,l++)}return l}function YOe(e,t){if(e===t)return e;const{startI:n,startJ:r,endI:i,endJ:o}=Zx(e,t),s=zU(e,t,n,r,i,o),a=e.length,l=t.length;if(!s)return x3;if(s===a&&s===l||s===l)return t;if(s===a)return e;const c=new Int32Array(s);let u=0,d=n,f=r;for(;d<i&&f<o;){const p=e[d],m=t[f];p<m?d++:(p>m||(c[u++]=p,d++),f++)}return c}function XOe(e,t){if(e===t)return x3;const n=e.length,{startI:r,startJ:i,endI:o,endJ:s}=Zx(e,t);let a=r,l=i,c=0;for(;a<o&&l<s;){const f=e[a],p=t[l];f<p?a++:f>p?l++:(a++,l++,c++)}if(!c)return e;if(c>=n)return x3;const u=new Int32Array(n-c);let d=0;for(let f=0;f<r;f++)u[d++]=e[f];for(a=r,l=i;a<o&&l<s;){const f=e[a],p=t[l];f<p?(u[d++]=f,a++):(f>p||a++,l++)}for(;a<n;a++)u[d++]=e[a];return u}function KOe(e){if(e.length<2)return e;let t=1;for(let i=0,o=e.length-1;i<o;i++)e[i]!==e[i+1]&&t++;if(t===e.length)return e;const n=new Int32Array(t);let r=0;for(let i=0,o=e.length-1;i<o;i++)e[i]!==e[i+1]&&(n[r++]=e[i]);return n[r]=e[e.length-1],n}function ZOe(e,t){if(Roe(e,t))return OU(0,e.length-1);const{startI:n,startJ:r,endI:i,endJ:o}=Zx(e,t);let s=n,a=r,l=0;for(;s<i&&a<o;){const f=e[s],p=t[a];f<p?s++:f>p?a++:(s++,a++,l++)}if(!l)return x3;if(l===e.length)return OU(0,e.length-1);const u=new Int32Array(l);let d=0;for(s=n,a=r;s<i&&a<o;){const f=e[s],p=t[a];f<p?s++:(f>p||(u[d++]=s,s++),a++)}return u}const W0={startI:0,startJ:0,endI:0,endJ:0};function Zx(e,t){const n=e.length,r=t.length,i=n/r;return n>=128||r>=128||i<=.34||i>=2.99?(W0.startI=Kx(e,jU(t)),W0.startJ=Kx(t,jU(e)),W0.endI=Kx(e,UU(t)),W0.endJ=Kx(t,UU(e))):(W0.startI=0,W0.startJ=0,W0.endI=n,W0.endJ=r),W0}var rt;!function(e){e.Empty=x3,e.ofUnsortedArray=NOe,e.ofSingleton=MOe,e.ofSortedArray=ROe,e.ofRange=Toe,e.ofBounds=(t,n)=>Toe(t,n-1),e.is=FOe,e.isRange=Doe,e.has=zOe,e.indexOf=koe,e.indexOfInInterval=UOe,e.indexOfInRange=Moe,e.start=jU,e.end=UU,e.min=OOe,e.max=BOe,e.size=Poe,e.hashCode=LOe,e.toString=jOe,e.areEqual=Roe,e.areIntersecting=qOe,e.isSubset=WOe,e.union=Ooe,e.intersect=YOe,e.subtract=XOe,e.findPredecessorIndex=Kx,e.findPredecessorIndexInInterval=VOe,e.findRange=HOe,e.intersectionSize=$Oe,e.deduplicate=KOe,e.indicesOf=ZOe}(rt||(rt={}));const ng=Pe.Empty,QOe=Pe.ofSingleton,JOe=Pe.ofRange,eBe=Pe.ofBounds;function Lh(e){return e.length?rt.isRange(e)?Pe.ofRange(e[0],e[e.length-1]):e:ng}function Qx(e){return Pe.is(e)?Pe.size(e):rt.size(e)}function tBe(e,t){return Pe.is(e)?Pe.has(e,t):rt.has(e,t)}function nBe(e,t){return Pe.is(e)?Pe.indexOf(e,t):rt.indexOf(e,t)}function VU(e,t){return Pe.is(e)?Pe.getAt(e,t):e[t]}function uw(e){return Pe.is(e)?Pe.min(e):rt.min(e)}function dw(e){return Pe.is(e)?Pe.max(e):rt.max(e)}function rBe(e){return Pe.is(e)?Pe.start(e):rt.start(e)}function iBe(e){return Pe.is(e)?Pe.end(e):rt.end(e)}function oBe(e){return Pe.is(e)?Pe.hashCode(e):rt.hashCode(e)}function aBe(e,t){return Pe.is(e)?Pe.is(t)?Pe.areEqual(e,t):Boe(e,t):Pe.is(t)?Boe(t,e):rt.areEqual(e,t)}function lBe(e,t){return Pe.is(e)?Pe.is(t)?Pe.areIntersecting(e,t):Loe(t,e):Pe.is(t)?Loe(e,t):rt.areIntersecting(e,t)}function cBe(e,t){return Pe.is(e)?Pe.is(t)?Pe.isSubInterval(e,t):function bBe(e,t){const n=Pe.min(e),r=Pe.max(e);if(r-n+1==0)return!1;const i=rt.min(t),o=rt.max(t);return i>=n&&o<=r}(e,t):Pe.is(t)?function yBe(e,t){const n=Pe.min(t),r=Pe.max(t);if(r-n+1==0)return!0;const i=rt.min(e),o=rt.max(e);if(n<i||r>o)return!1;const s=rt.findRange(e,n,r);return Pe.size(s)===Pe.size(t)}(e,t):rt.isSubset(e,t)}function uBe(e,t){return Pe.is(e)?Pe.findPredecessorIndex(e,t):rt.findPredecessorIndex(e,t)}function dBe(e,t,n){return Pe.is(e)?Pe.findPredecessorIndexInInterval(e,t,n):rt.findPredecessorIndexInInterval(e,t,n)}function fBe(e,t,n){return Pe.is(e)?Pe.findRange(e,t,n):rt.findRange(e,t,n)}function pBe(e,t){return Pe.is(e)?Pe.is(t)?Pe.intersectionSize(e,t):Uoe(t,e):Pe.is(t)?Uoe(e,t):rt.intersectionSize(e,t)}function hBe(e,t){return Pe.is(e)?Pe.is(t)?function _Be(e,t){if(Pe.areEqual(e,t))return e;const n=Pe.size(e),r=Pe.size(t);if(!r)return e;if(!n)return t;const i=Pe.min(e),o=Pe.min(t);if(function vBe(e,t){const n=Qx(e),r=Qx(t);return 0===n&&0===r||n>0&&r>0&&dw(e)>=uw(t)&&uw(e)<=dw(t)}(e,t))return Pe.ofRange(Math.min(i,o),Math.max(Pe.max(e),Pe.max(t)));let s,a,l,c;i<o?(s=n,a=i,l=r,c=o):(s=r,a=o,l=n,c=i);const u=new Int32Array(n+r);for(let d=0;d<s;d++)u[d]=d+a;for(let d=0;d<l;d++)u[d+s]=d+c;return Lh(u)}(e,t):joe(t,e):Pe.is(t)?joe(e,t):Lh(rt.union(e,t))}function mBe(e,t){return Pe.is(e)?Pe.is(t)?Pe.intersect(e,t):zoe(t,e):Pe.is(t)?zoe(e,t):Lh(rt.intersect(e,t))}function gBe(e,t){return Pe.is(e)?Pe.is(t)?function SBe(e,t){if(Pe.areEqual(e,t))return ng;if(!Pe.areIntersecting(e,t))return e;const n=Pe.min(e),r=Pe.max(e),i=Pe.min(t),o=Pe.max(t);if(r<n||o<i)return e;if(Pe.isSubInterval(t,e))return ng;if(Pe.isSubInterval(e,t)){const s=i-n,a=r-o;if(s<=0)return Pe.ofRange(o+1,o+a);if(a<=0)return Pe.ofRange(n,n+s-1);const l=new Int32Array(s+a);let c=0;for(let u=0;u<s;u++)l[c++]=n+u;for(let u=1;u<=a;u++)l[c++]=o+u;return Lh(l)}return n<i?Pe.ofRange(n,i-1):Pe.ofRange(o+1,r)}(e,t):function wBe(e,t){const n=Pe.min(e),r=Pe.max(e);if(r<n)return e;const i=r-n+1,o=rt.findRange(t,n,r),s=Pe.start(o),a=Pe.end(o),l=a-s;if(0===l)return e;const c=i-l;if(c<=0)return ng;const u=new Int32Array(c),d=t.length-1,f=t[Math.min(s,d)],p=t[Math.min(a,d)];let m=0;for(let h=n;h<f;h++)u[m++]=h;for(let h=f;h<=p;h++)rt.indexOfInInterval(t,h,o)<0&&(u[m++]=h);for(let h=p+1;h<=r;h++)u[m++]=h;return Lh(u)}(e,t):Pe.is(t)?function CBe(e,t){const n=Pe.min(t),r=Pe.max(t);if(r<n)return e;const i=rt.findRange(e,n,r),o=Pe.start(i),s=Pe.end(i),a=e.length-(s-o);if(a<=0)return ng;if(a===e.length)return e;const l=new Int32Array(a);let c=0;for(let u=0;u<o;u++)l[c++]=e[u];for(let u=s,d=e.length;u<d;u++)l[c++]=e[u];return Lh(l)}(e,t):Lh(rt.subtract(e,t))}function Boe(e,t){return Pe.size(e)===rt.size(t)&&Pe.start(e)===rt.start(t)&&Pe.end(e)===rt.end(t)}function Loe(e,t){return 0!==e.length&&0!==Pe.size(rt.findRange(e,Pe.min(t),Pe.max(t)))}function joe(e,t){const n=Pe.size(t);if(!n)return e;if(function xBe(e,t){return Qx(e)?!Qx(t)||uw(e)<=uw(t)&&dw(e)>=dw(t):0===Qx(t)}(t,e))return t;const r=Pe.min(t),i=Pe.max(t),o=rt.findRange(e,r,i),s=Pe.start(o),a=Pe.end(o),l=new Int32Array(s+(e.length-a)+n);let c=0;for(let u=0;u<s;u++)l[c++]=e[u];for(let u=r;u<=i;u++)l[c++]=u;for(let u=a,d=e.length;u<d;u++)l[c++]=e[u];return Lh(l)}function Uoe(e,t){if(!Pe.size(t))return 0;const n=rt.findRange(e,Pe.min(t),Pe.max(t));return Pe.end(n)-Pe.start(n)}function zoe(e,t){if(!Pe.size(t))return ng;const n=rt.findRange(e,Pe.min(t),Pe.max(t)),r=Pe.start(n),i=Pe.end(n),o=i-r;if(!o)return ng;if(o===e.length)return e;const s=new Int32Array(o);let a=0;for(let l=r;l<i;l++)s[a++]=e[l];return Lh(s)}function EBe(e,t,n){if(t===n)return e;const r=Qx(e),i=t.length,o=n.length;if(0===r||0===i||0===o)return ng;const s=rt.findPredecessorIndex(n,t[uw(e)]),a=rt.findPredecessorIndex(n,t[dw(e)]+1);let l=0,c=0,u=0,d=s;for(;u<r&&d<a;){const p=t[VU(e,u)],m=n[d];p<m?u++:(p>m||(l++,u++),d++)}if(0===l)return ng;if(l===i&&l===o)return e;const f=new Int32Array(l);for(c=0,u=0,d=s;u<r&&d<a;){const p=t[VU(e,u)],m=n[d];p<m?u++:(p>m||(f[c++]=d,u++),d++)}return Lh(f)}var Ve,En,sp,qR,Cd,jh,nc,Tt,fw,ko;function Voe(e){const t=rt.ofSortedArray(e),n=rt.max(t),r=new Int32Array(n);for(let i=0,o=e.length-1;i<o;i++)for(let s=e[i],a=e[i+1];s<a;s++)r[s]=i;return{offsets:t,index:r,count:e.length-1}}function TBe(e,t){const n=Pe.start(t),r=new Int32Array(e.length+1);for(let i=0,o=e.length;i<o;i++)r[i]=e[i]-n;return r[e.length]=Pe.end(t)-n,Voe(r)}function DBe({count:e}){return e}function PBe({index:e},t){return e[t]}function kBe({offsets:e},t,n){const i=n>=Ve.max(e)?-1:Ve.findPredecessorIndex(e,n-1);return Ve.findRange(t,Ve.getAt(e,i),Ve.getAt(e,i+1)-1)}!function(e){e.Empty=ng,e.ofSingleton=QOe,e.ofRange=JOe,e.ofBounds=eBe,e.ofSortedArray=Lh,e.has=tBe,e.indexOf=nBe,e.getAt=VU,e.min=uw,e.max=dw,e.start=rBe,e.end=iBe,e.size=Qx,e.hashCode=oBe,e.areEqual=aBe,e.areIntersecting=lBe,e.isSubset=cBe,e.union=hBe,e.intersect=mBe,e.indexedIntersect=EBe,e.subtract=gBe,e.findPredecessorIndex=uBe,e.findPredecessorIndexInInterval=dBe,e.findRange=fBe,e.intersectionSize=pBe,e.forEach=function t(a,l,c){return function ABe(e,t,n){if(Pe.is(e)){const r=Pe.min(e);for(let i=r,o=Pe.max(e);i<=o;i++)t(i,i-r,n)}else for(let r=0,i=e.length;r<i;r++)t(e[r],r,n);return n}(a,l,c)},e.forEachSegment=function n(a,l,c,u){return function IBe(e,t,n,r){if(Pe.is(e)){let i=0;for(let o=Pe.min(e),s=Pe.max(e);o<=s;o++){const a=t(o);let l=o+1;for(;l<s&&t(l)===a;)l++;o=l-1,n(a,i,r),i++}}else{let i=0;for(let o=0,s=e.length;o<s;o++){const a=t(e[o]);let l=o+1;for(;l<s&&t(e[l])===a;)l++;o=l-1,n(a,i,r),i++}}return r}(a,l,c,u)},e.isInterval=function r(a){return Pe.is(a)},e.isSortedArray=function i(a){return!Pe.is(a)},e.toArray=function o(a){const l=[];return e.forEach(a,c=>l.push(c)),l},e.toString=function s(a){return function sBe(e){return Pe.is(e)?Pe.toString(e):rt.toString(e)}(a)}}(Ve||(Ve={}));class MBe{move(){for(;this.hasNext;){if(this.updateValue()){this.value.index=this.segmentMin++,this.hasNext=this.segmentMax>=this.segmentMin&&Pe.size(this.setRange)>0;break}this.updateSegmentRange()}return this.value}updateValue(){const n=Ve.findPredecessorIndexInInterval(this.set,this.segments[this.segmentMin+1],this.setRange);return this.value.start=Pe.start(this.setRange),this.value.end=n,this.setRange=Pe.ofBounds(n,Pe.end(this.setRange)),n>this.value.start}updateSegmentRange(){const t=Pe.min(this.setRange),n=Pe.max(this.setRange);n<t?this.hasNext=!1:(this.segmentMin=this.segmentMap[Ve.getAt(this.set,t)],this.segmentMax=this.segmentMap[Ve.getAt(this.set,n)],this.hasNext=this.segmentMax>=this.segmentMin)}setSegment(t){this.setRange=Pe.ofBounds(t.start,t.end),this.updateSegmentRange()}constructor(t,n,r,i){this.segments=t,this.segmentMap=n,this.set=r,this.segmentMin=0,this.segmentMax=0,this.setRange=Pe.Empty,this.value={index:0,start:0,end:0},this.hasNext=!1,this.setRange=i,this.updateSegmentRange()}}function RBe(e,t,n){const r=typeof n<"u"?Pe.ofBounds(n.start,n.end):Pe.ofBounds(0,Ve.size(t));return new MBe(e.offsets,e.index,t,r)}!function(e){e.create=Voe,e.ofOffsets=TBe,e.count=DBe,e.getSegment=PBe,e.projectValue=kBe,e.transientSegments=RBe}(En||(En={}));class FBe{remove(t){const{prev:n,next:r}=this,i=n[t],o=r[t];i>=0&&(r[i]=o,n[t]=-1),o>=0&&(n[o]=i,r[t]=-1),t===this.head&&(this.head=i<0?o:i)}has(t){return this.prev[t]>=0||this.next[t]>=0||this.head===t}constructor(t){this.head=t>0?0:-1,this.prev=new Int32Array(t),this.next=new Int32Array(t);for(let n=0;n<t;n++)this.next[n]=n+1,this.prev[n]=n-1;this.prev[0]=-1,this.next[t-1]=-1}}!function(e){function n(){return new Map}e.Empty=new Map,e.keyArray=function t(s){return FU(s.keys())},e.Mutable=n,e.asImmutable=function r(s){return s},e.copy=function i(s){const a=n(),l=s.keys();for(;;){const{done:c,value:u}=l.next();if(c)break;a.set(u,s.get(u))}return a},e.addFrom=function o(s,a){const l=a.keys();for(;;){const{done:c,value:u}=l.next();if(c)break;s.set(u,a.get(u))}return s}}(sp||(sp={}));class OBe{move(){return++this.index,this.lastValue=this.xs[this.index],this.hasNext=this.index<this.length-1,this.lastValue}constructor(t){this.xs=[],this.index=-1,this.length=0,this.hasNext=!1,this.length=t.length,this.hasNext=t.length>0,this.xs=t,this.index=-1,this.lastValue=t.length>0?t[0]:void 0}}class Hoe{move(){return++this.value,this.hasNext=this.value<this.max,this.value}constructor(t,n){this.max=n,this.value=0,this.hasNext=!1,this.value=t-1,this.hasNext=n>=t}}class BBe{move(){return this.hasNext=!1,this.value}constructor(t){this.value=t,this.hasNext=!0}}class LBe{move(){const t=this.f(this.base.move());return this.hasNext=this.base.hasNext,t}constructor(t,n){this.base=t,this.f=n,this.hasNext=!1,this.hasNext=t.hasNext}}class jBe{move(){const t=this.next;return this.hasNext=this.findNext(),t}findNext(){for(;this.base.hasNext;)if(this.next=this.base.move(),this.p(this.next))return!0;return!1}constructor(t,n){this.base=t,this.p=n,this.hasNext=this.findNext()}}function Goe(e,t,n,r,i){const{b:o,offset:s}=e,a=[];for(let l=0,c=t.length;l<c;++l){const u=t[l];for(let d=s[u],f=s[u+1];d<f;++d){const p=o[d];if(!i.has(p)){if(rt.has(n,p))return!0;i.add(p),a[a.length]=p}}}return r>1&&Goe(e,a,n,r-1,i)}!function(e){e.Empty=new Hoe(0,-1),e.Array=function t(a){return new OBe(a)},e.Value=function n(a){return new BBe(a)},e.Range=function r(a,l){return new Hoe(a,l)},e.map=function i(a,l){return new LBe(a,l)},e.filter=function o(a,l){return new jBe(a,l)},e.forEach=function s(a,l,c){for(;a.hasNext;)if(l(a.move(),c))return c;return c}}(qR||(qR={})),function(e){e.areEqual=function t(d,f){if(d===f)return!0;if(d.vertexCount!==f.vertexCount||d.edgeCount!==f.edgeCount)return!1;const{a:p,b:m,offset:h}=d,{a:g,b:y,offset:v}=f;for(let x=0,_=d.a.length;x<_;x++)if(p[x]!==g[x])return!1;for(let x=0,_=d.b.length;x<_;x++)if(m[x]!==y[x])return!1;for(let x=0,_=d.offset.length;x<_;x++)if(h[x]!==v[x])return!1;for(const x of Object.keys(d.edgeProps)){const _=d.edgeProps[x],w=f.edgeProps[x];if(!w)return!1;for(let A=0,M=_.length;A<M;A++)if(_[A]!==w[A])return!1}return!0};class n{getEdgeIndex(f,p){let m,h;f<p?(m=f,h=p):(m=p,h=f);for(let g=this.offset[m],y=this.offset[m+1];g<y;g++)if(this.b[g]===h)return g;return-1}getDirectedEdgeIndex(f,p){for(let m=this.offset[f],h=this.offset[f+1];m<h;m++)if(this.b[m]===p)return m;return-1}getVertexEdgeCount(f){return this.offset[f+1]-this.offset[f]}constructor(f,p,m,h,g,y){this.offset=f,this.a=p,this.b=m,this.edgeCount=h,this.props=y,this.vertexCount=f.length-1,this.edgeProps=g||{}}}function r(d,f,p,m,h,g){return new n(d,f,p,m,h,g)}e.create=r;class i{createGraph(f,p){return r(this.offsets,this.a,this.b,this.edgeCount,f,p)}addNextEdge(){const f=this.xs[this.current],p=this.ys[this.current],m=this.offsets[f]+this.bucketFill[f];this.a[m]=f,this.b[m]=p,this.bucketFill[f]++;const h=this.offsets[p]+this.bucketFill[p];this.a[h]=p,this.b[h]=f,this.bucketFill[p]++,this.current++,this.curA=m,this.curB=h}addAllEdges(){for(let f=0;f<this.edgeCount;f++)this.addNextEdge()}assignProperty(f,p){f[this.curA]=p,f[this.curB]=p}assignDirectedProperty(f,p,m,h){f[this.curA]=p,f[this.curB]=h,m[this.curB]=p,m[this.curA]=h}constructor(f,p,m){this.vertexCount=f,this.xs=p,this.ys=m,this.current=0,this.curA=0,this.curB=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);const h=new Int32Array(this.vertexCount);for(let y=0,v=this.xs.length;y<v;y++)h[this.xs[y]]++;for(let y=0,v=this.ys.length;y<v;y++)h[this.ys[y]]++;let g=0;for(let y=0;y<this.vertexCount;y++)this.offsets[y]=g,g+=h[y];this.offsets[this.vertexCount]=g,this.slotCount=g,this.a=new Int32Array(g),this.b=new Int32Array(g)}}function a(d,f,p){const m=new e.EdgeBuilder(d,f,p);return m.addAllEdges(),m.createGraph({})}e.EdgeBuilder=i,e.DirectedEdgeBuilder=class o{createGraph(f,p){return r(this.offsets,this.a,this.b,this.edgeCount,f,p)}addNextEdge(){const f=this.xs[this.current],p=this.ys[this.current],m=this.offsets[f]+this.bucketFill[f];this.a[m]=f,this.b[m]=p,this.bucketFill[f]++,this.current++,this.curA=m}addAllEdges(){for(let f=0;f<this.edgeCount;f++)this.addNextEdge()}assignProperty(f,p){f[this.curA]=p}constructor(f,p,m){this.vertexCount=f,this.xs=p,this.ys=m,this.current=0,this.curA=0,this.edgeCount=p.length,this.offsets=new Int32Array(this.vertexCount+1),this.bucketFill=new Int32Array(this.vertexCount);const h=new Int32Array(this.vertexCount);for(let y=0,v=this.xs.length;y<v;y++)h[this.xs[y]]++;let g=0;for(let y=0;y<this.vertexCount;y++)this.offsets[y]=g,g+=h[y];this.offsets[this.vertexCount]=g,this.slotCount=g,this.a=new Int32Array(g),this.b=new Int32Array(g)}},e.UniqueEdgeBuilder=class s{addEdge(f,p){let m=f,h=p;f>p&&(m=p,h=f);const g=gf(m,h);return!this.included.has(g)&&(this.included.add(g),this.xs[this.xs.length]=m,this.ys[this.ys.length]=h,!0)}getGraph(){return a(this.vertexCount,this.xs,this.ys)}getEdgeBuiler(){return new i(this.vertexCount,this.xs,this.ys)}constructor(f){this.vertexCount=f,this.xs=[],this.ys=[],this.included=new Set}},e.fromVertexPairs=a,e.induceByVertices=function l(d,f,p){const{b:m,offset:h,vertexCount:g,edgeProps:y}=d,v=new Int32Array(g);for(let F=0,R=f.length;F<R;F++)v[f[F]]=F+1;let x=0;for(let F=0;F<g;F++)if(0!==v[F])for(let R=h[F],N=h[F+1];R<N;R++)m[R]>F&&0!==v[m[R]]&&x++;const _=new Int32Array(f.length+1),w=new Int32Array(2*x),A=new Int32Array(2*x),M=new Int32Array(2*x);let E=0,D=0;for(let F=0;F<g;F++){if(0===v[F])continue;const R=v[F]-1;for(let N=h[F],j=h[F+1];N<j;N++){const W=v[m[N]];0!==W&&(A[E]=R,M[E]=W-1,w[E]=N,E++)}_[++D]=E}const T={};for(const F of Object.keys(y))T[F]=bOe(y[F],w);return r(_,A,M,x,T,p)},e.connectedComponents=function c(d){const f=d.vertexCount;if(0===f)return{componentCount:0,componentIndex:new Int32Array(0)};if(0===d.edgeCount){const x=new Int32Array(f);for(let _=0,w=f;_<w;_++)x[_]=_;return{componentCount:f,componentIndex:x}}const p=new Int32Array(f);for(let x=0,_=f;x<_;x++)p[x]=-1;let m=0;p[0]=m;const{offset:h,b:g}=d,y=[0],v=function NBe(e){return new FBe(e)}(f);for(v.remove(0);y.length>0;){const x=y.pop(),_=p[x];for(let w=h[x],A=h[x+1];w<A;w++){const M=g[w];v.has(M)&&(v.remove(M),y.push(M),p[M]=_)}0===y.length&&v.head>=0&&(y.push(v.head),p[v.head]=++m,v.remove(v.head))}return{componentCount:f,componentIndex:p}},e.areVertexSetsConnected=function u(d,f,p,m){if(rt.areIntersecting(f,p))return!0;if(m<1)return!1;const h=new Set;for(let g=0,y=f.length;g<y;++g)h.add(f[g]);return Goe(d,f,p,m,h)}}(Cd||(Cd={}));class UBe{constructor(){this.map=new Map,this.applicable=new Map}add(t,n,r){this.map.set(t,n),r&&this.applicable.set(t,r)}remove(t){this.map.delete(t),this.applicable.delete(t)}get(t){return this.map.get(t)}isApplicable(t){if(!this.map.has(t.sourceData.kind))return!1;const n=this.applicable.get(t.sourceData.kind);return!n||n(t)}}function zBe(e,t,n,r){const i=new Cd.EdgeBuilder(r,e,t),o=new Int32Array(i.slotCount),s=new Array(i.slotCount),a=new Array(i.slotCount),l=new Int8Array(i.slotCount),c=new Array(i.slotCount),u=new Array(i.slotCount);for(let d=0,f=i.edgeCount;d<f;d++)i.addNextEdge(),i.assignProperty(o,n.key?n.key[d]:-1),i.assignDirectedProperty(s,n.operatorA?n.operatorA[d]:-1,a,n.operatorB?n.operatorB[d]:-1),i.assignProperty(l,n.order?n.order[d]:1),i.assignProperty(c,n.distance?n.distance[d]:-1),i.assignProperty(u,n.flag?n.flag[d]:1);return i.createGraph({key:o,operatorA:s,operatorB:a,order:l,distance:c,flag:u})}function Pn(e){return function(t){return HU(e,t)}}function HU(e,t){const{data:n,indices:r,count:i}=e,{valueType:o}=t,s="str"===o?a=>n.substring(r[2*a],r[2*a+1]):"int"===o?a=>p1(n,r[2*a],r[2*a+1])||0:a=>V0(n,r[2*a],r[2*a+1])||0;return{schema:t,__array:void 0,isDefined:!0,rowCount:i,value:s,valueKind:a=>0,toArray:a=>tc(i,s,a),areValuesEqual:qoe(e)}}function qoe(e){const{data:t,indices:n}=e;return function(r,i){const o=n[2*r],s=n[2*i],a=n[2*r+1]-o;if(a!==n[2*i+1]-s)return!1;for(let l=0;l<a;l++)if(t.charCodeAt(l+o)!==t.charCodeAt(l+s))return!1;return!0}}function VBe(e){const{count:t,indices:n}=e;for(let r=0;r<t;++r)if(n[2*r]!==n[2*r+1])return!1;return!0}function Woe(e,t){return{name:t,blocks:e}}function GU(e,t,n,r=[]){return{categoryNames:e,header:n,categories:t,saveFrames:r,getField(i){const[o,s]=i.split(".");return t[o].getField(s||"")}}}function ll(e,t,n,r){return{rowCount:t,name:e,fieldNames:[...n],getField:i=>r[i]}}function rg(e,t,n){return function QBe(e,t,n){const r=Object.create(null);for(const i of Object.keys(e))r[i]=tLe(i,e[i],t,n);return wU.ofTables(t.header,e,r)}(e,t,n)}function YBe(e){switch(e.valueType){case"str":return(t,n,r)=>function XBe(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:"lowercase"===e.transform?i=>n(i).toLowerCase():"uppercase"===e.transform?i=>n(i).toUpperCase():n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:"lowercase"===e.transform?i=>Array.from(r(i)).map(o=>o.toLowerCase()):"uppercase"===e.transform?i=>Array.from(r(i)).map(o=>o.toUpperCase()):r}}(e,t,t.str,t.toStringArray);case"int":return(t,n,r)=>$oe(e,t,t.int,t.toIntArray);case"float":return(t,n,r)=>$oe(e,t,t.float,t.toFloatArray);case"list":throw new Error("Use createListColumn instead.");case"tensor":throw new Error("Use createTensorColumn instead.")}}function $oe(e,t,n,r){return{schema:e,__array:t.__array,isDefined:t.isDefined,rowCount:t.rowCount,value:n,valueKind:t.valueKind,areValuesEqual:t.areValuesEqual,toArray:r}}function KBe(e,t,n){const r=e.separator,i=e.itemParse,o=t.getField(n),s=o?l=>o.str(l).split(r).map(c=>i(c.trim())).filter(c=>!!c):l=>[];return{schema:e,__array:void 0,isDefined:!!o,rowCount:t.rowCount,value:s,valueKind:o?o.valueKind:()=>1,areValuesEqual:(l,c)=>Ru(s(l),s(c)),toArray:l=>tc(t.rowCount,s,l)}}function ZBe(e,t,n){const r=e.space,i=t.fieldNames.includes(`${n}[0]`)||t.fieldNames.includes(`${n}[0][0]`)||t.fieldNames.includes(`${n}[0][0][0]`),o=i?0:1,s=t.fieldNames.includes(`${n}_1`)||t.fieldNames.includes(`${n}_11`)||t.fieldNames.includes(`${n}_111`)?"underscore":"brackets",a=function GBe(e,t,n,r){const i=n?0:1;switch(t){case 1:return"brackets"===r?o=>`${e}[${o+i}]`:o=>`${e}_${o+i}`;case 2:return"brackets"===r?(o,s)=>`${e}[${o+i}][${s+i}]`:(o,s)=>`${e}_${o+i}${s+i}`;case 3:return"brackets"===r?(o,s,a)=>`${e}[${o+i}][${s+i}][${a+i}]`:(o,s,a)=>`${e}_${o+i}${s+i}${a+i}`;default:throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.")}}(n,r.rank,i,s),l=t.getField(a(o,o,o))||ce.Undefined(t.rowCount,e),c=d=>function qBe(e,t,n,r){const i=t.create();if(1===t.rank){const o=t.dimensions[0];for(let s=0;s<o;s++){const a=e.getField(r(s));t.set(i,s,a?a.float(n):0)}}else if(2===t.rank){const o=t.dimensions[0],s=t.dimensions[1];for(let a=0;a<o;a++)for(let l=0;l<s;l++){const c=e.getField(r(a,l));t.set(i,a,l,c?c.float(n):0)}}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const o=t.dimensions[0],s=t.dimensions[1],a=t.dimensions[2];for(let l=0;l<o;l++)for(let c=0;c<s;c++)for(let u=0;u<a;u++){const d=e.getField(r(l,c,u));t.set(i,l,c,u,d?d.float(n):0)}}}return i}(t,r,d,a);return{schema:e,__array:void 0,isDefined:l.isDefined,rowCount:t.rowCount,value:c,valueKind:l.valueKind,areValuesEqual:(d,f)=>mr.areEqualExact(c(d),c(f)),toArray:d=>tc(t.rowCount,c,d)}}!function(e){e.create=function t(n,r){const{name:i}=n,o=new UBe;return{descriptor:n,formatRegistry:o,isApplicable:s=>o.isApplicable(s),get(s){const a=r?.asDynamic?s._dynamicPropertyData:s._staticPropertyData;if(a[i])return a[i];if(s.customProperties.has(n))return;const l=o.get(s.sourceData.kind);return l?(a[i]=l(s),s.customProperties.add(n),a[i]):void 0},set(s,a){r?.asDynamic?s._dynamicPropertyData[i]=a:s._staticPropertyData[i]=a},delete(s){r?.asDynamic?delete s._dynamicPropertyData[i]:delete s._staticPropertyData[i]}}}}(jh||(jh={})),function(e){e.Descriptor={name:"index_pair_bonds"},e.Provider=jh.create(e.Descriptor,{asDynamic:!0}),e.DefaultProps={maxDistance:-1},e.fromData=function t(r,i={}){const o={...e.DefaultProps,...i},{pairs:s,count:a}=r;return{bonds:zBe(s.indexA.toArray(),s.indexB.toArray(),{key:s.key&&s.key.toArray(),operatorA:s.operatorA&&s.operatorA.toArray(),operatorB:s.operatorB&&s.operatorB.toArray(),order:s.order&&s.order.toArray(),distance:s.distance&&s.distance.toArray(),flag:s.flag&&s.flag.toArray()},a),maxDistance:o.maxDistance}},e.getEdgeIndexForOperators=function n(r,i,o,s,a){let l,c,u,d;i<o?(l=i,c=o,u=s,d=a):(l=o,c=i,u=a,d=s);for(let f=r.offset[l],p=r.offset[l+1];f<p;f++)if(r.b[f]===c&&r.edgeProps.operatorA[f]===u&&r.edgeProps.operatorB[f]===d)return f;return-1}}(nc||(nc={})),function(e){function n(i,o){const s=Object.keys(o);return{rowCount:s.length>0?o[s[0]].rowCount:0,name:i,fieldNames:s,getField:a=>o[a]}}e.empty=function t(i){return{rowCount:0,name:i,fieldNames:[],getField(o){}}},e.ofFields=n,e.ofTable=function r(i,o){const s={};for(const a of o._columns)s[a]=Tt.ofColumn(o[a]);return n(i,s)}}(ll||(ll={})),function(e){function n(a){const l=a.length,c=p=>{const m=a[p];return m&&"."!==m&&"?"!==m?m:""},u=p=>{const m=a[p];return p1(m,0,m.length)||0},d=p=>{const m=a[p];return V0(m,0,m.length)||0};return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:c,int:u,float:d,valueKind:p=>{const m=a[p],h=m.length;if(h>1)return 0;if(0===h)return 1;const g=m.charCodeAt(0);return 46===g?1:63===g?2:0},areValuesEqual:(p,m)=>a[p]===a[m],toStringArray:p=>p?tc(l,c,p):a,toIntArray:p=>tc(l,u,p),toFloatArray:p=>tc(l,d,p)}}function o(a){const{rowCount:l,valueKind:c,areValuesEqual:u,isDefined:d}=a;let f,p,m;switch(a.schema.valueType){case"float":case"int":f=g=>""+a.value(g),p=a.value,m=a.value;break;case"str":f=a.value,p=g=>{const y=a.value(g);return p1(y,0,y.length)||0},m=g=>{const y=a.value(g);return V0(y,0,y.length)||0};break;case"list":const{separator:h}=a.schema;f=g=>a.value(g).join(h),p=g=>NaN,m=g=>NaN;break;default:throw new Error(`unsupported valueType '${a.schema.valueType}'`)}return{__array:void 0,binaryEncoding:void 0,isDefined:d,rowCount:l,str:f,int:p,float:m,valueKind:c,areValuesEqual:u,toStringArray:h=>tc(l,f,h),toIntArray:h=>tc(l,p,h),toFloatArray:h=>tc(l,m,h)}}e.ofString=function t(a){return n([a])},e.ofStrings=n,e.ofNumbers=function r(a){const l=a.length,c=p=>""+a[p],u=p=>a[p],f=p=>!p||p.array&&a instanceof p.array?a:tc(l,u,p);return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:l,str:c,int:u,float:u,valueKind:p=>0,areValuesEqual:(p,m)=>a[p]===a[m],toStringArray:p=>tc(l,c,p),toIntArray:f,toFloatArray:f}},e.ofTokens=function i(a){const{data:l,indices:c,count:u}=a,d=h=>{const g=l.substring(c[2*h],c[2*h+1]);return"."===g||"?"===g?"":g},f=h=>p1(l,c[2*h],c[2*h+1])||0,p=h=>V0(l,c[2*h],c[2*h+1])||0;return{__array:void 0,binaryEncoding:void 0,isDefined:!0,rowCount:u,str:d,int:f,float:p,valueKind:h=>{const g=c[2*h],y=c[2*h+1]-g;if(y>1)return 0;if(0===y)return 1;const v=l.charCodeAt(g);return 46===v?1:63===v?2:0},areValuesEqual:qoe(a),toStringArray:h=>tc(u,d,h),toIntArray:h=>tc(u,f,h),toFloatArray:h=>tc(u,p,h)}},e.ofColumn=o,e.ofUndefined=function s(a,l){return o(ce.Undefined(a,l))}}(Tt||(Tt={})),function(e){function t(i){return i.replace(".","_").replace(/\[/,"_").replace(/(\[|\])/g,"")}e.canonical=t,e.equal=function n(i,o){return t(i)===t(o)},e.create=function r(i,o,s=!1){const a=`${i}${o?`.${o}`:""}`;return s?t(a):a}}(fw||(fw={}));class Yoe{constructor(t,n,r){this._isDefined=r;const i=Object.keys(n);this._rowCount=t.rowCount,this._columns=i,this._schema=n;const o=Object.create(null);for(const s of i)Object.defineProperty(this,s,{get:function(){if(o[s])return o[s];const a=n[s];if("list"===a.valueType)o[s]=KBe(a,t,s);else if("tensor"===a.valueType)o[s]=ZBe(a,t,s);else{const l=YBe(a),c=t.getField(s);o[s]=c?l(c,t,s):ce.Undefined(t.rowCount,a)}return o[s]},enumerable:!0,configurable:!1})}}function eLe(e,t,n,r){const i=fw.create(t,e),o=fw.canonical(i);if(o in n)return n[o];if(r&&i in r)for(const s of r[i]){const a=fw.canonical(s);if(a in n)return n[a]}}function tLe(e,t,n,r){let i=n.categories[e];if(r){const o=function JBe(e){const t=Object.create(null);for(const n of Object.keys(e.categories))for(const r of e.categories[n].fieldNames)t[fw.create(n,r,!0)]=e.categories[n].getField(r);return t}(n),s=Object.create(null),a=[];let l=0;for(const c of Object.keys(t)){const u=eLe(c,e,o,r);u&&(s[c]=u,a.push(c),l=u.rowCount)}i={rowCount:l,name:e,fieldNames:[...a],getField:c=>s[c]}}return new Yoe(i||ll.empty(e),t,!!i)}function pw(e,t,n){const r=new Float32Array(e);for(let i=0;i<r.length;i++)r[i]=t+n*i;return r}function WR(e){return 0}!function(e){function t(v,x,_){let{assembly:w,ncsId:A,hkl:M,spgrOp:E,key:D}=_||{};const T=M?C.clone(M):C();E=E??-1,D=D??-1,A=A||-1;const F=fe.isIdentity(x),R=function r(v,x){if(!v)return"";if(v.assembly)return function n(v){return!!v&&!!v.matrix&&!!v.inverse&&"string"==typeof v.name}(v)?v.suffix:x?"":`_${v.assembly.operId}`;if(typeof v.spgrOp<"u"&&typeof v.hkl<"u"&&-1!==v.spgrOp){const[_,w,A]=v.hkl;return`-${v.spgrOp+1}_${5+_}${5+w}${5+A}`}return-1!==v.ncsId?`_${v.ncsId}`:""}(_,F);return F?{name:v,assembly:w,matrix:x,inverse:fe.identity(),isIdentity:!0,hkl:T,spgrOp:E,ncsId:A,suffix:R,key:D}:(fe.isRotationAndTranslation(x,e.RotationTranslationEpsilon)||console.warn(`Symmetry operator (${v}) should be a composition of rotation and translation.`),{name:v,assembly:w,matrix:x,inverse:fe.invert(fe(),x),isIdentity:!1,hkl:T,spgrOp:E,key:D,ncsId:A,suffix:R})}e.DefaultName="1_555",e.Default=t(e.DefaultName,fe.identity()),e.RotationTranslationEpsilon=.005,e.create=t;const i=fe();e.checkIfRotationAndTranslation=function o(v,x){fe.setIdentity(i);for(let _=0;_<3;_++)for(let w=0;w<3;w++)fe.setValue(i,_,w,In.getValue(v,_,w));return fe.setTranslation(i,x),fe.isRotationAndTranslation(i,e.RotationTranslationEpsilon)},e.ofRotationAndOffset=function s(v,x,_,w){const A=fe.identity();for(let M=0;M<3;M++)for(let E=0;E<3;E++)fe.setValue(A,M,E,In.getValue(x,M,E));return fe.setTranslation(A,_),t(v,A,{ncsId:w})};const a=Ai.identity(),l=Ai(),c=Ai(),u=C();e.lerpFromIdentity=function d(v,x,_){const w=x.inverse;if(x.isIdentity)return fe.copy(v,w);const A=1-_;fe.getRotation(l,w),Ai.slerp(l,a,l,A);const M=Ai.getAxisAngle(u,l);return fe.fromRotation(v,M,u),fe.setValue(v,0,3,A*fe.getValue(w,0,3)),fe.setValue(v,1,3,A*fe.getValue(w,1,3)),fe.setValue(v,2,3,A*fe.getValue(w,2,3)),v},e.slerp=function f(v,x,_,w){if(Math.abs(w)<=1e-5)return fe.copy(v,x);if(Math.abs(w-1)<=1e-5)return fe.copy(v,_);fe.getRotation(l,x),fe.getRotation(c,_),Ai.slerp(c,l,c,w);const A=Ai.getAxisAngle(u,c);return fe.fromRotation(v,A,u),fe.setValue(v,0,3,Po(fe.getValue(x,0,3),fe.getValue(_,0,3),w)),fe.setValue(v,1,3,Po(fe.getValue(x,1,3),fe.getValue(_,1,3),w)),fe.setValue(v,2,3,Po(fe.getValue(x,2,3),fe.getValue(_,2,3),w)),v},e.compose=function p(v,x){const _=fe.mul(fe(),x.matrix,v.matrix);return t(x.name,_,x)};class m{constructor(x,_,w=WR){this.operator=x,this.coordinates=_,this.r=w,this._x=_.x,this._y=_.y,this._z=_.z,this._m=x.matrix}invariantPosition(x,_){return _[0]=this._x[x],_[1]=this._y[x],_[2]=this._z[x],_}position(x,_){return _[0]=this._x[x],_[1]=this._y[x],_[2]=this._z[x],C.transformMat4(_,_,this._m),_}x(x){const _=this._m,D=this._x[x],T=this._y[x],F=this._z[x];return(_[0]*D+_[4]*T+_[8]*F+_[12])/(_[3]*D+_[7]*T+_[11]*F+_[15]||1)}y(x){const _=this._m,D=this._x[x],T=this._y[x],F=this._z[x];return(_[1]*D+_[5]*T+_[9]*F+_[13])/(_[3]*D+_[7]*T+_[11]*F+_[15]||1)}z(x){const _=this._m,D=this._x[x],T=this._y[x],F=this._z[x];return(_[2]*D+_[6]*T+_[10]*F+_[14])/(_[3]*D+_[7]*T+_[11]*F+_[15]||1)}}class h{constructor(x,_,w=WR){this.operator=x,this.coordinates=_,this.r=w,this._x=_.x,this._y=_.y,this._z=_.z,this._m=x.matrix}invariantPosition(x,_){return _[0]=this._x[x],_[1]=this._y[x],_[2]=this._z[x],_}position(x,_){return _[0]=this.x(x),_[1]=this.y(x),_[2]=this.z(x),_}x(x){const _=this._m;return _[0]*this._x[x]+_[4]*this._y[x]+_[8]*this._z[x]+_[12]}y(x){const _=this._m;return _[1]*this._x[x]+_[5]*this._y[x]+_[9]*this._z[x]+_[13]}z(x){const _=this._m;return _[2]*this._x[x]+_[6]*this._y[x]+_[10]*this._z[x]+_[14]}}class g{constructor(x,_,w=WR){this.operator=x,this.coordinates=_,this.r=w,this._x=_.x,this._y=_.y,this._z=_.z}invariantPosition(x,_){return _[0]=this._x[x],_[1]=this._y[x],_[2]=this._z[x],_}position(x,_){return _[0]=this._x[x],_[1]=this._y[x],_[2]=this._z[x],_}x(x){return this._x[x]}y(x){return this._y[x]}z(x){return this._z[x]}}e.createMapping=function y(v,x,_=WR){return fe.isIdentity(v.matrix)?new g(v,x,_):function nLe(e){return 0===e[3]&&0===e[7]&&0===e[11]&&1===e[15]}(v.matrix)?new h(v,x,_):new m(v,x,_)}}(ko||(ko={}));const qU=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,1/3],[0,0,1,2/3],[1,0,0,2/3],[0,1,0,1/3],[0,-1,0,2/3],[1,-1,0,1/3],[-1,1,0,2/3],[-1,0,0,1/3],[1,0,0,1/3],[0,1,0,2/3],[0,-1,0,1/3],[1,-1,0,2/3],[-1,1,0,1/3],[-1,0,0,2/3],[0,0,-1,1/3],[0,0,-1,2/3],[0,0,1,5/6],[0,0,1,1/6],[0,0,-1,5/6],[0,0,-1,1/6]],rLe=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]],iLe=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,15,1,9],[0,5,1,8],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]],_3={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"P 1 21/n 1":253,"P 1 21/a 1":254,"B 1 1 2/b":255,"P 21 2 2":256,"P 2 21 2":257,"P 21 21 2 (a)":258,"P 21 2 21":259,"P 2 21 21":260,"C 2 2 21a)":261,"C 2 2 2a":262,"F 2 2 2a":263,"I 2 2 2a":264,"P 21/m 21/m 2/n a":265,"P 42 21 2a":266,"I 2 3a":267};function sLe(e){if(e<146)return e+1;if(146===e)return 1146;if(e<149)return e+1-1;if(149===e)return 1148;if(e<157)return e+1-2;if(157===e)return 1155;if(e<163)return e+1-3;if(163===e)return 1160;if(e<165)return e+1-4;if(165===e)return 1161;if(e<171)return e+1-5;if(171===e)return 1166;if(e<173)return e+1-6;if(173===e)return 1167;if(e<237)return e+1-7;if(237===e)return 1003;if(238===e)return 1004;if(239===e)return 1005;if(240===e)return 2005;if(241===e)return 3005;if(242===e)return 4005;if(243===e)return 5005;if(244===e)return 1006;if(245===e)return 1007;if(246===e)return 1008;if(247===e)return 1009;if(248===e)return 1010;if(249===e)return 1011;if(250===e)return 1012;if(251===e)return 1013;if(252===e)return 1014;if(253===e)return 2014;if(254===e)return 3014;if(255===e)return 1015;if(256===e)return 1017;if(257===e)return 2017;if(258===e)return 1018;if(259===e)return 2018;if(260===e)return 3018;if(261===e)return 1020;if(262===e)return 1021;if(263===e)return 1022;if(264===e)return 1023;if(265===e)return 1059;if(266===e)return 1094;if(267===e)return 1197;throw new Error(`unknown spacegroup index '${e}'`)}const Xoe=function(){const e=Object.create(null);for(const t of Object.keys(_3))e[_3[t]]=t;return e}(),aLe=function(){const e=Object.create(null);for(const t of Object.keys(_3)){const n=_3[t];e[n]=sLe(n)}return e}();var Qc,wd,ap,Zr;function rc(){return rc.empty()}function WU(e,t,n,r){r=e[t],e[t]=e[n],e[n]=r}function cLe(e,t){return(e=Math.abs(e))>(t=Math.abs(t))?(t/=e,e*Math.sqrt(1+t*t)):t>0?(e/=t,t*Math.sqrt(1+e*e)):0}!function(e){function n(r,i,o){const s=function lLe(e){const t="number"==typeof e?function oLe(e){switch(e){case 1146:return 146;case 1148:return 149;case 1155:return 157;case 1160:return 163;case 1161:return 165;case 1166:return 171;case 1167:return 173;case 1003:return 237;case 1004:return 238;case 1005:return 239;case 2005:return 240;case 3005:return 241;case 4005:return 242;case 5005:return 243;case 1006:return 244;case 1007:return 245;case 1008:return 246;case 1009:return 247;case 1010:return 248;case 1011:return 249;case 1012:return 250;case 1013:return 251;case 1014:return 252;case 2014:return 253;case 3014:return 254;case 1015:return 255;case 1017:return 256;case 2017:return 257;case 1018:return 258;case 2018:return 259;case 3018:return 260;case 1020:return 261;case 1021:return 262;case 1022:return 263;case 1023:return 264;case 1059:return 265;case 1094:return 266;case 1197:return 267}let t=0;return e>146&&++t,e>148&&++t,e>155&&++t,e>160&&++t,e>161&&++t,e>166&&++t,e>167&&++t,e-1+t}(e):_3[e];return typeof t>"u"||typeof Xoe[t]>"u"?-1:t}(r);if(s<0)return console.warn(`Unknown spacegroup '${r}', returning a 'P 1' with cellsize [1, 1, 1]`),e.Zero;const a=i[0]*i[1]*i[2],l=o[0],c=o[1],u=o[2],d=i[0],f=i[1],p=i[2],m=Math.cos(c),h=(Math.cos(l)-Math.cos(c)*Math.cos(u))/Math.sin(u),g=Math.sqrt(1-m*m-h*h),y=[d,0,0],v=[Math.cos(u)*f,Math.sin(u)*f,0],x=[m*p,h*p,g*p],_=fe.ofRows([[y[0],v[0],x[0],0],[0,v[1],x[1],0],[0,0,x[2],0],[0,0,0,1]]);return{index:s,size:i,volume:a,anglesInRadians:o,toFractional:fe.invert(fe.zero(),_),fromFractional:_}}e.Zero=n("P 1",C.create(1,1,1),C.create(Math.PI/2,Math.PI/2,Math.PI/2)),e.isZero=function t(r){return!r||0===r.index&&1===r.size[0]&&1===r.size[1]&&1===r.size[1]},e.create=n}(Qc||(Qc={})),function(e){function t(g){const y=iLe[g.index].map(_=>function d(g){return fe.ofRows([qU[g[0]],qU[g[1]],qU[g[2]],[0,0,0,1]])}(rLe[_]));return{name:Xoe[g.index],num:aLe[g.index],cell:g,operators:y}}e.ZeroP1=t(Qc.Zero),e.create=t;const n=C(),r=fe();function i(g,y,v,x,_,w){return C.set(n,v,x,_),fe.fromTranslation(r,n),fe.mul(w,fe.mul(w,fe.mul(w,g.cell.fromFractional,r),g.operators[y]),g.cell.toFractional)}e.setOperatorMatrix=i,e.getSymmetryOperator=function o(g,y,v,x,_){const w=i(g,y,v,x,_,fe.zero());return ko.create(`${y+1}_${5+v}${5+x}${5+_}`,w,{hkl:C.create(v,x,_),spgrOp:y})};const s=C(),a=C(),l=C(),c=C();function p(g,y,v){const x=[];if(g>0?x.push("+X"):g<0&&x.push("-X"),y>0?x.push("+Y"):y<0&&x.push("-Y"),v>0?x.push("+Z"):v<0&&x.push("-Z"),1===x.length)return"+"===x[0].charAt(0)?x[0].substr(1):x[0];if(2===x.length){const _=x[0].charAt(0),w=x[1].charAt(0);if("+"===_)return`${x[0].substr(1)}${x[1]}`;if("+"===w)return`${x[1].substr(1)}${x[0]}`}throw new Error(`unknown rotation '${x}', ${g} ${y} ${v}`)}function m(g){switch(g){case.5:return"1/2";case 1/4:return"1/4";case 3/4:return"3/4";case 1/3:return"1/3";case 2/3:return"2/3";case 1/6:return"1/6";case 5/6:return"5/6"}return""}function h(g,y){return""===y?g:g.length>2?`${g}+${y}`:"-"===g.charAt(0)?`${y}${g}`:`${y}+${g}`}e.getSymmetryOperatorRef=function u(g,y,v,x,_,w){const A=fe.zero();C.set(n,v,x,_),C.floor(s,w),fe.copy(A,g.operators[y]),C.floor(a,C.transformMat4(a,w,A)),fe.getTranslation(c,A),C.sub(c,c,a),C.add(c,c,s),C.add(c,c,n),fe.setTranslation(A,c),fe.mul(A,g.cell.fromFractional,A),fe.mul(A,A,g.cell.toFractional),C.sub(l,a,s);const M=v-l[0],E=x-l[1],D=_-l[2];return ko.create(`${y+1}_${5+M}${5+E}${5+D}`,A,{hkl:C.create(M,E,D),spgrOp:y})},e.getOperatorXyz=function f(g){return[h(p(g[0],g[4],g[8]),m(g[12])),h(p(g[1],g[5],g[9]),m(g[13])),h(p(g[2],g[6],g[10]),m(g[14]))].join(",")}}(wd||(wd={})),function(e){e.add=function t(o,s,a){o.squaredDistances[o.count]=a,o.indices[o.count++]=s},e.reset=function n(o){o.count=0},e.create=function r(){return{count:0,indices:[],squaredDistances:[]}},e.copy=function i(o,s){for(let a=0;a<s.count;++a)o.indices[a]=s.indices[a],o.squaredDistances[a]=s.squaredDistances[a];return o.count=s.count,o}}(ap||(ap={})),function(e){function n(){return{origin:C(),dirA:C(),dirB:C(),dirC:C()}}function r(f,p){return C.copy(f.origin,p.origin),C.copy(f.dirA,p.dirA),C.copy(f.dirB,p.dirB),C.copy(f.dirC,p.dirC),f}function o(f,p){return C.set(f,2*C.magnitude(p.dirA),2*C.magnitude(p.dirB),2*C.magnitude(p.dirC))}e.create=function t(f,p,m,h){return{origin:f,dirA:p,dirB:m,dirC:h}},e.empty=n,e.copy=r,e.clone=function i(f){return r(n(),f)},e.size=o;const s=C();e.volume=function a(f){return o(s,f),s[0]*s[1]*s[2]},e.normalize=function l(f,p){return C.copy(f.origin,p.origin),C.normalize(f.dirA,p.dirA),C.normalize(f.dirB,p.dirB),C.normalize(f.dirC,p.dirC),f};const c=In();e.transform=function u(f,p,m){C.transformMat4(f.origin,p.origin,m);const h=In.directionTransform(c,m);return C.transformMat3(f.dirA,p.dirA,h),C.transformMat3(f.dirB,p.dirB,h),C.transformMat3(f.dirC,p.dirC,h),f},e.scale=function d(f,p,m){return C.scale(f.dirA,p.dirA,m),C.scale(f.dirB,p.dirB,m),C.scale(f.dirC,p.dirC,m),f}}(rc||(rc={})),function(e){e.create=function t(f,p,m=Float32Array){const h=f*p;return{data:new m(h),size:h,cols:f,rows:p}},e.get=function n(f,p,m){return f.data[f.rows*m+p]},e.set=function r(f,p,m,h){return f.data[f.rows*m+p]=h,f},e.add=function i(f,p,m,h){return f.data[f.rows*m+p]+=h,f},e.makeZero=function o(f){return f.data.fill(0),f},e.clone=function s(f){return{data:f.data.slice(),size:f.size,cols:f.cols,rows:f.rows}},e.fromArray=function a(f,p,m){return{data:f,size:p*m,cols:p,rows:m}},e.transpose=function l(f,p){if(f.cols!==p.rows||f.rows!==p.cols)throw new Error("transpose: matrix dimensions incompatible");if(f.data===p.data)throw new Error("transpose: matrices share memory");const m=p.rows,h=p.cols,g=p.data,y=f.data;for(let v=0,x=0,_=0;v<m;_+=1,x+=h,++v){let w=_;for(let A=0;A<h;w+=m,A++)y[w]=g[x+A]}return f},e.multiplyABt=function c(f,p,m){const h=p.cols,g=p.rows,y=m.rows,v=p.data,x=m.data,_=f.data;for(let w=0,A=0,M=0;w<g;A+=h,w++)for(let E=0,D=0;D<y;M++,D++){let T=0,F=A;for(let R=0;R<h;F++,E++,R++)T+=v[F]*x[E];_[M]=T}return f},e.meanRows=function u(f){const p=f.rows,m=f.cols,h=f.data,g=new Array(m);for(let y=0;y<m;++y)g[y]=0;for(let y=0,v=0;y<p;++y)for(let x=0;x<m;++x,++v)g[x]+=h[v];for(let y=0;y<m;++y)g[y]/=p;return g},e.subRows=function d(f,p){const m=f.rows,h=f.cols,g=f.data;for(let y=0,v=0;y<m;++y)for(let x=0;x<h;++x,++v)g[v]-=p[x];return f}}(Zr||(Zr={}));var Uh;function ke(){return ke.zero()}function Gt(){return Gt.zero()}!function(e){function n(s){if(3===s.length)return rc.create(C.fromArray(C(),s,0),C.create(1,0,0),C.create(0,1,0),C.create(0,0,1));const a=Zr.fromArray(s,3,s.length/3),l=a.rows,c=l/3,u=Zr.create(3,3),d=Zr.create(1,3),f=Zr.create(3,3),p=Zr.create(3,3),m=Zr.meanRows(a),h=Zr.subRows(Zr.clone(a),m),g=Zr.transpose(Zr.create(l,3),h);Zr.multiplyABt(u,g,g),function pLe(e,t,n,r){let i=0,o=0;const s=e.rows,a=e.cols;let l=s,c=a;l<c&&(i=1,o=l,l=c,c=o);const u=Zr.create(l,l),d=Zr.create(1,c),f=Zr.create(c,c);if(0===i)Zr.transpose(u,e);else{for(o=0;o<a*s;o++)u.data[o]=e.data[o];for(;o<c*l;o++)u.data[o]=0}if(function fLe(e,t,n,r,i,o,s,a){let u=0,d=0,f=0,p=0;const m=Math.max(o,30);let h=0,g=0,y=0,v=0,x=0,_=0,w=0,A=0,M=0,E=0,D=0,T=0,F=0,R=0,N=0,j=0,W=0,z=4660,$=0,V=0,X=0;const H=new Float64Array(s<<3);for(;u<s;u++){for(f=0,D=0;f<o;f++)A=e[u*t+f],D+=A*A;if(H[u]=D,r){for(f=0;f<s;f++)r[u*i+f]=0;r[u*i+u]=1}}for(;p<m;p++){for(x=0,u=0;u<s-1;u++)for(d=u+1;d<s;d++){for(h=u*t|0,g=d*t|0,N=H[u],j=0,W=H[d],f=2,j+=e[h]*e[g],j+=e[h+1]*e[g+1];f<o;f++)j+=e[h+f]*e[g+f];if(!(Math.abs(j)<=2.384185792e-7*Math.sqrt(N*W))){for(j*=2,T=N-W,F=cLe(j,T),T<0?(R=.5*(F-T),w=Math.sqrt(R/F),_=j/(F*w*2)):(_=Math.sqrt((F+T)/(2*F)),w=j/(F*_*2)),N=0,W=0,f=2,M=_*e[h]+w*e[g],E=-w*e[h]+_*e[g],e[h]=M,e[g]=E,N+=M*M,W+=E*E,M=_*e[h+1]+w*e[g+1],E=-w*e[h+1]+_*e[g+1],e[h+1]=M,e[g+1]=E,N+=M*M,W+=E*E;f<o;f++)M=_*e[h+f]+w*e[g+f],E=-w*e[h+f]+_*e[g+f],e[h+f]=M,e[g+f]=E,N+=M*M,W+=E*E;if(H[u]=N,H[d]=W,x=1,r)for(y=u*i|0,v=d*i|0,f=2,M=_*r[y]+w*r[v],E=-w*r[y]+_*r[v],r[y]=M,r[v]=E,M=_*r[y+1]+w*r[v+1],E=-w*r[y+1]+_*r[v+1],r[y+1]=M,r[v+1]=E;f<s;f++)M=_*r[y+f]+w*r[v+f],E=-w*r[y+f]+_*r[v+f],r[y+f]=M,r[v+f]=E}}if(0===x)break}for(u=0;u<s;u++){for(f=0,D=0;f<o;f++)A=e[u*t+f],D+=A*A;H[u]=Math.sqrt(D)}for(u=0;u<s-1;u++){for(d=u,f=u+1;f<s;f++)H[d]<H[f]&&(d=f);if(u!==d&&(WU(H,u,d,D),r)){for(f=0;f<o;f++)WU(e,u*t+f,d*t+f,A);for(f=0;f<s;f++)WU(r,u*i+f,d*i+f,A)}}for(u=0;u<s;u++)n[u]=H[u];if(r)for(u=0;u<a;u++){for(D=u<s?H[u]:0;D<=1e-37;){for(V=1/o,f=0;f<o;f++)z=214013*z+2531011,$=256&z>>16?V:-V,e[u*t+f]=$;for(p=0;p<2;p++)for(d=0;d<u;d++){for(D=0,f=0;f<o;f++)D+=e[u*t+f]*e[d*t+f];for(X=0,f=0;f<o;f++)A=e[u*t+f]-D*e[d*t+f],e[u*t+f]=A,X+=Math.abs(A);for(X=X?1/X:0,f=0;f<o;f++)e[u*t+f]*=X}for(D=0,f=0;f<o;f++)A=e[u*t+f],D+=A*A;D=Math.sqrt(D)}for(w=1/D,f=0;f<o;f++)e[u*t+f]*=w}}(u.data,l,d.data,f.data,c,l,c,l),t){for(o=0;o<c;o++)t.data[o]=d.data[o];for(;o<a;o++)t.data[o]=0}0===i?(n&&Zr.transpose(n,u),r&&Zr.transpose(r,f)):(n&&Zr.transpose(n,f),r&&Zr.transpose(r,u))}(u,d,f,p);const y=C.create(m[0],m[1],m[2]),v=C.create(f.data[0],f.data[3],f.data[6]),x=C.create(f.data[1],f.data[4],f.data[7]),_=C.create(f.data[2],f.data[5],f.data[8]);return C.scale(v,v,Math.sqrt(d.data[0]/c)),C.scale(x,x,Math.sqrt(d.data[1]/c)),C.scale(_,_,Math.sqrt(d.data[2]/c)),rc.create(y,v,x,_)}function r(s){const a=rc.clone(s);return C.magnitude(a.dirC)<wi&&C.cross(a.dirC,a.dirA,a.dirB),rc.normalize(a,a)}e.ofPositions=function t(s){const a=n(s);return{momentsAxes:a,boxAxes:o(s,a)}},e.calculateMomentsAxes=n,e.calculateNormalizedAxes=r;const i=C();function o(s,a){if(3===s.length)return rc.clone(a);let l=-1/0,c=-1/0,u=-1/0,d=-1/0,f=-1/0,p=-1/0;const m=C(),h=C(),g=a.origin,y=r(a);for(let T=0,F=s.length;T<F;T+=3){C.projectPointOnVector(m,C.fromArray(m,s,T),y.dirA,g);const R=C.dot(y.dirA,C.normalize(h,C.sub(h,m,g))),N=C.distance(m,g);R>0?N>l&&(l=N):N>c&&(c=N),C.projectPointOnVector(m,C.fromArray(m,s,T),y.dirB,g);const j=C.dot(y.dirB,C.normalize(h,C.sub(h,m,g))),W=C.distance(m,g);j>0?W>u&&(u=W):W>d&&(d=W),C.projectPointOnVector(m,C.fromArray(m,s,T),y.dirC,g);const z=C.dot(y.dirC,C.normalize(h,C.sub(h,m,g))),$=C.distance(m,g);z>0?$>f&&(f=$):$>p&&(p=$)}const v=C.setMagnitude(C(),y.dirA,(l+c)/2),x=C.setMagnitude(C(),y.dirB,(u+d)/2),_=C.setMagnitude(C(),y.dirC,(f+p)/2),w=C.isFinite(v),A=C.isFinite(x),M=C.isFinite(_),E=C(),D=function(T,F,R){C.copy(i,g),w&&C.scaleAndAdd(i,i,y.dirA,T),A&&C.scaleAndAdd(i,i,y.dirB,F),M&&C.scaleAndAdd(i,i,y.dirC,R),C.add(E,E,i)};return D(l,u,f),D(l,u,-p),D(l,-d,-p),D(l,-d,f),D(-c,-d,-p),D(-c,-d,f),D(-c,u,f),D(-c,u,-p),C.scale(E,E,1/8),rc.create(E,v,x,_)}e.calculateBoxAxes=o}(Uh||(Uh={})),function(e){function t(R){return void 0!==R.extrema}function n(R,N){return{center:R,radius:N}}function a(R,N){return void 0!==R.extrema?(R.extrema.length=0,R.extrema.push(...N)):R.extrema=N,R}e.hasExtrema=t,e.create=n,e.zero=function r(){return{center:C(),radius:0}},e.clone=function i(R){const N=n(C.clone(R.center),R.radius);return t(R)&&(N.extrema=R.extrema.map(j=>C.clone(j))),N},e.set=function o(R,N,j){return C.copy(R.center,N),R.radius=j,R},e.copy=function s(R,N){return C.copy(R.center,N.center),R.radius=N.radius,t(N)&&a(R,N.extrema.map(j=>C.clone(j))),R},e.setExtrema=a,e.computeBounding=function l(R){const{x:N,y:j,z:W,indices:z}=R;let $=0,V=0,X=0,H=0;const oe=Ve.size(z);for(let te=0;te<oe;te++){const K=Ve.getAt(z,te);$+=N[K],V+=j[K],X+=W[K]}oe>0&&($/=oe,V/=oe,X/=oe);for(let te=0;te<oe;te++){const K=Ve.getAt(z,te),Q=N[K]-$,G=j[K]-V,Z=W[K]-X,ee=Q*Q+G*G+Z*Z;ee>H&&(H=ee)}return{center:C.create($,V,X),radius:Math.sqrt(H)}},e.transform=function c(R,N,j){return C.transformMat4(R.center,N.center,j),R.radius=N.radius*fe.getMaxScaleOnAxis(j),t(N)&&a(R,N.extrema.map(W=>C.transformMat4(C(),W,j))),R},e.translate=function u(R,N,j){return C.add(R.center,N.center,j),t(N)&&a(R,N.extrema.map(W=>C.add(C(),W,j))),R},e.toArray=function d(R,N,j){return C.toArray(R.center,N,j),N[j+3]=R.radius,N},e.fromArray=function f(R,N,j){return C.fromArray(R.center,N,j),R.radius=N[j+3],R},e.fromBox3D=function p(R,N){return C.scale(R.center,C.add(R.center,N.max,N.min),.5),R.radius=C.distance(R.center,N.max),e.setExtrema(R,[C.create(N.min[0],N.min[1],N.min[2]),C.create(N.max[0],N.max[1],N.max[2]),C.create(N.max[0],N.min[1],N.min[2]),C.create(N.min[0],N.max[1],N.max[2]),C.create(N.min[0],N.min[1],N.max[2]),C.create(N.max[0],N.min[1],N.max[2]),C.create(N.max[0],N.max[1],N.min[2]),C.create(N.min[0],N.max[1],N.min[2])]),R},e.fromAxes3D=function m(R,N){return C.copy(R.center,N.origin),R.radius=Math.max(C.magnitude(N.dirA),C.magnitude(N.dirB),C.magnitude(N.dirC)),R};const h=C();e.fromDimensionsAndTransform=function g(R,N,j){const[W,z,$]=N,V=C.create(0,0,0);C.transformMat4(V,V,j);const X=C.create(W,z,$);C.transformMat4(X,X,j);const H=C.create(W,0,0);C.transformMat4(H,H,j);const oe=C.create(0,z,$);C.transformMat4(oe,oe,j);const te=C.create(0,0,$);C.transformMat4(te,te,j);const K=C.create(W,0,$);C.transformMat4(K,K,j);const Q=C.create(W,z,0);C.transformMat4(Q,Q,j);const G=C.create(0,z,0);C.transformMat4(G,G,j),C.add(h,V,X),C.scale(h,h,.5);const Z=Math.max(C.distance(V,X),C.distance(H,oe));return e.set(R,h,Z/2),e.setExtrema(R,[V,X,H,oe,te,K,Q,G]),R};const y=C();e.addVec3=function v(R,N,j){return C.distance(N.center,j)<N.radius?e.copy(R,N):(C.sub(y,N.center,j),C.sub(y,N.center,y),C.setMagnitude(y,y,N.radius),C.scale(R.center,C.add(y,y,j),.5),R.radius=C.distance(R.center,j),R)},e.expandBySphere=function x(R,N,j){return C.copy(R.center,N.center),R.radius=Math.max(N.radius,C.distance(N.center,j.center)+j.radius),t(N)&&t(j)&&a(R,[...N.extrema.map(W=>C.clone(W)),...j.extrema.map(W=>C.clone(W))]),R};const _=C();e.expand=function w(R,N,j){var W,z;if(C.copy(R.center,N.center),R.radius=N.radius+j,N.radius<1e-12||(null!==(z=null===(W=N.extrema)||void 0===W?void 0:W.length)&&void 0!==z?z:0)<=1)return R.extrema=void 0,R;if(t(N)){const $=new Float32Array(3*N.extrema.length);for(let X=0;X<N.extrema.length;X++)C.toArray(N.extrema[X],$,3*X);const V=Uh.calculateMomentsAxes($);rc.scale(V,rc.normalize(V,V),j),a(R,N.extrema.map(X=>{C.normalize(_,C.sub(_,X,N.center));const H=C.clone(X),oe=C.dot(_,V.dirA)<0?-1:1;C.scaleAndAdd(H,H,V.dirA,oe);const te=C.dot(_,V.dirB)<0?-1:1;C.scaleAndAdd(H,H,V.dirB,te);const K=C.dot(_,V.dirC)<0?-1:1;return C.scaleAndAdd(H,H,V.dirC,K),C.distance(R.center,H)>R.radius&&(N.extrema.length>=14&&C.normalize(_,C.sub(_,H,N.center)),C.scaleAndAdd(H,R.center,_,R.radius)),H}))}return R},e.exactEquals=function A(R,N){return R.radius===N.radius&&C.exactEquals(R.center,N.center)},e.equals=function M(R,N){const j=R.radius,W=N.radius;return Math.abs(j-W)<=wi*Math.max(1,Math.abs(j),Math.abs(W))&&C.equals(R.center,N.center)},e.includes=function E(R,N){if(t(N)){for(const j of N.extrema)if(C.distance(R.center,j)>R.radius)return!1;return!0}return C.distance(R.center,N.center)+N.radius<=R.radius},e.overlaps=function D(R,N){return C.distance(R.center,N.center)<=R.radius+N.radius},e.distance=function T(R,N){return C.distance(R.center,N.center)-R.radius+N.radius},e.distanceToVec=function F(R,N){const{center:j,radius:W}=R;return C.distance(N,j)-W}}(ke||(ke={})),function(e){function n(){return{min:C(),max:C()}}function r(D,T){return C.copy(D.min,T.min),C.copy(D.max,T.max),D}e.create=function t(D,T){return{min:D,max:T}},e.zero=n,e.copy=r,e.clone=function i(D){return r(n(),D)};const o=C();function a(D,T){for(let F=0,R=T.length;F<R;F++)g(D,T[F]);return D}function l(D,T){return h(D),a(D,T),D}function f(D,T){return C.sub(D,T.max,T.min)}e.fromSphere3D=function s(D,T){return ke.hasExtrema(T)&&T.extrema.length>=14?l(D,T.extrema):(C.set(o,T.radius,T.radius,T.radius),C.sub(D.min,T.center,o),C.add(D.max,T.center,o),D)},e.addVec3Array=a,e.fromVec3Array=l,e.addSphere3D=function c(D,T){return ke.hasExtrema(T)&&T.extrema.length>=14?a(D,T.extrema):(g(D,C.subScalar(o,T.center,T.radius)),g(D,C.addScalar(o,T.center,T.radius)),D)},e.intersectsSphere3D=function u(D,T){return C.clamp(o,T.center,D.min,D.max),C.squaredDistance(o,T.center)<=T.radius*T.radius},e.computeBounding=function d(D){const T=C.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),F=C.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),{x:R,y:N,z:j,indices:W}=D;for(let z=0,$=Ve.size(W);z<$;z++){const V=Ve.getAt(W,z);T[0]=Math.min(R[V],T[0]),T[1]=Math.min(N[V],T[1]),T[2]=Math.min(j[V],T[2]),F[0]=Math.max(R[V],F[0]),F[1]=Math.max(N[V],F[1]),F[2]=Math.max(j[V],F[2])}return{min:T,max:F}},e.size=f;const p=C();function h(D){return C.set(D.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),C.set(D.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),D}function g(D,T){return C.min(D.min,D.min,T),C.max(D.max,D.max,T),D}e.volume=function m(D){return f(p,D),p[0]*p[1]*p[2]},e.setEmpty=h,e.add=g,e.expand=function y(D,T,F){return C.sub(D.min,T.min,F),C.add(D.max,T.max,F),D},e.scale=function v(D,T,F){return C.scale(D.min,T.min,F),C.scale(D.max,T.max,F),D};const x=C();e.transform=function _(D,T,F){const[R,N,j]=T.min,[W,z,$]=T.max;return h(D),g(D,C.transformMat4(x,C.set(x,R,N,j),F)),g(D,C.transformMat4(x,C.set(x,R,N,$),F)),g(D,C.transformMat4(x,C.set(x,R,z,j),F)),g(D,C.transformMat4(x,C.set(x,R,z,$),F)),g(D,C.transformMat4(x,C.set(x,W,N,j),F)),g(D,C.transformMat4(x,C.set(x,W,N,$),F)),g(D,C.transformMat4(x,C.set(x,W,z,j),F)),g(D,C.transformMat4(x,C.set(x,W,z,$),F)),D},e.containsVec3=function w(D,T){return!(T[0]<D.min[0]||T[0]>D.max[0]||T[1]<D.min[1]||T[1]>D.max[1]||T[2]<D.min[2]||T[2]>D.max[2])},e.overlaps=function A(D,T){return!(D.max[0]<T.min[0]||D.min[0]>T.max[0]||D.max[1]<T.min[1]||D.min[1]>T.max[1]||D.max[2]<T.min[2]||D.min[2]>T.max[2])},e.containsSphere3D=function M(D,T){const F=T.center,R=T.radius;return!(F[0]-R<D.min[0]||F[0]+R>D.max[0]||F[1]-R<D.min[1]||F[1]+R>D.max[1]||F[2]-R<D.min[2]||F[2]+R>D.max[2])},e.nearestIntersectionWithRay=function E(D,T,F,R){const[N,j,W]=T.min,[z,$,V]=T.max,[X,H,oe]=F,te=1/R[0],K=1/R[1],Q=1/R[2];let G,Z,ee,se,xe,re;return te>=0?(G=(N-X)*te,Z=(z-X)*te):(G=(z-X)*te,Z=(N-X)*te),K>=0?(ee=(j-H)*K,se=($-H)*K):(ee=($-H)*K,se=(j-H)*K),Q>=0?(xe=(W-oe)*Q,re=(V-oe)*Q):(xe=(V-oe)*Q,re=(W-oe)*Q),ee>G&&(G=ee),se<Z&&(Z=se),xe>G&&(G=xe),re<Z&&(Z=re),C.scale(D,R,G),C.set(D,D[0]+X,D[1]+H,D[2]+oe)}}(Gt||(Gt={}));class hLe{constructor(t,n){this.parent=null,this.child=null,this.degree=0,this.isMarked=!1,this.key=t,this.value=n,this.prev=this,this.next=this}}const $U=new class mLe{constructor(t){if(this._index=-1,this._items=[],this._len=0,t){let n=t,r=0;do{this._items[r++]=n,n=n.next}while(t!==n);this._len=r}}hasNext(){return this._index<this._len-1}next(){return this._items[++this._index]}reset(t){this._index=-1,this._len=0;let n=t,r=0;do{this._items[r++]=n,n=n.next}while(t!==n);this._len=r}};class Koe{constructor(t){this._minNode=null,this._nodeCount=0,this._compare=t||this._defaultCompare}clear(){this._minNode=null,this._nodeCount=0}decreaseKey(t,n){if(!t)throw new Error("Cannot decrease key of non-existent node");if(this._compare({key:n},{key:t.key})>0)throw new Error("New key is larger than old key");t.key=n;const r=t.parent;r&&this._compare(t,r)<0&&(this._cut(t,r,this._minNode),this._cascadingCut(r,this._minNode)),this._compare(t,this._minNode)<0&&(this._minNode=t)}delete(t){const n=t.parent;n&&(this._cut(t,n,this._minNode),this._cascadingCut(n,this._minNode)),this._minNode=t,this.extractMinimum()}extractMinimum(){const t=this._minNode;if(t){if(t.child){let r=t.child;do{r.parent=null,r=r.next}while(r!==t.child)}let n=null;t.next!==t&&(n=t.next),this._removeNodeFromList(t),this._nodeCount--,this._minNode=this._mergeLists(n,t.child),this._minNode&&(this._minNode=this._consolidate(this._minNode))}return t}findMinimum(){return this._minNode}insert(t,n){const r=new hLe(t,n);return this._minNode=this._mergeLists(this._minNode,r),this._nodeCount++,r}isEmpty(){return null===this._minNode}size(){return null===this._minNode?0:this._getNodeListSize(this._minNode)}union(t){this._minNode=this._mergeLists(this._minNode,t._minNode),this._nodeCount+=t._nodeCount}_defaultCompare(t,n){return t.key>n.key?1:t.key<n.key?-1:0}_cut(t,n,r){t.parent=null,n.degree--,n.child=t.next===t?null:t.next,this._removeNodeFromList(t);const i=this._mergeLists(r,t);return t.isMarked=!1,i}_cascadingCut(t,n){const r=t.parent;return r&&(t.isMarked?(n=this._cut(t,r,n),n=this._cascadingCut(r,n)):t.isMarked=!0),n}_consolidate(t){const n=[];for($U.reset(t);$U.hasNext();){let i=$U.next(),o=n[i.degree];for(;o;){if(this._compare(i,o)>0){const s=i;i=o,o=s}this._linkHeaps(o,i),n[i.degree]=null,i.degree++,o=n[i.degree]}n[i.degree]=i}let r=null;for(let i=0;i<n.length;i++){const o=n[i];o&&(o.next=o,o.prev=o,r=this._mergeLists(r,o))}return r}_removeNodeFromList(t){const n=t.prev,r=t.next;n.next=r,r.prev=n,t.next=t,t.prev=t}_linkHeaps(t,n){this._removeNodeFromList(t),n.child=this._mergeLists(t,n.child),t.parent=n,t.isMarked=!1}_mergeLists(t,n){if(!t)return n||null;if(!n)return t;const r=t.next;return t.next=n.next,t.next.prev=t,n.next=r,n.next.prev=n,this._compare(t,n)<0?t:n}_getNodeListSize(t){let n=0,r=t;do{n++,r.child&&(n+=this._getNodeListSize(r.child)),r=r.next}while(r!==t);return n}}function zh(e,t,n){return new gLe(e,t,n)}class gLe{find(t,n,r,i,o){this.ctx.x=t,this.ctx.y=n,this.ctx.z=r,this.ctx.radius=i,this.ctx.isCheck=!1;const s=o??this.result;return Zoe(this.ctx,s),s}nearest(t,n,r,i=1,o,s){this.ctx.x=t,this.ctx.y=n,this.ctx.z=r,this.ctx.k=i,this.ctx.stopIf=o;const a=s??this.result;return function CLe(e,t){const{min:n,expandedBox:r,boundingSphere:{center:i},size:[o,s,a],bucketOffset:l,bucketCounts:c,bucketArray:u,grid:d,data:{x:f,y:p,z:m,indices:h,radius:g},delta:y,maxRadius:v}=e.grid,{x,y:_,z:w,k:A,stopIf:M}=e,E=Ve.size(h);if(ap.reset(t),0===E||A<=0)return!1;let D,T,F,H,R=!1,N=1,j=!0,W=0,z=xLe,$=_Le,V=0,X=!0,oe=!1;const te=SLe,K=v*v;z.length=0,te.length=0,S3.clear(),hw.clear(),C.set(m1,x,_,w),Gt.containsVec3(r,m1)?(D=Math.floor((x-n[0])/y[0]),T=Math.floor((_-n[1])/y[1]),F=Math.floor((w-n[2])/y[2])):(Gt.nearestIntersectionWithRay(m1,r,m1,C.normalize(Qoe,C.sub(Qoe,i,m1))),D=Math.max(0,Math.min(o-1,Math.floor((m1[0]-n[0])/y[0]))),T=Math.max(0,Math.min(s-1,Math.floor((m1[1]-n[1])/y[1]))),F=Math.max(0,Math.min(a-1,Math.floor((m1[2]-n[2])/y[2]))));const Q=0!==v?Math.max(1,Math.min(o-1,Math.ceil(v/y[0]))):1,G=0!==v?Math.max(1,Math.min(s-1,Math.ceil(v/y[1]))):1,Z=0!==v?Math.max(1,Math.min(a-1,Math.ceil(v/y[2]))):1;for(z.push(D,T,F,(D*s+T)*a+F);t.count<E;){const ee=4*N;for(let se=0;se<ee;se+=4)if(H=z[se+3],!S3.has(H)){S3.add(H),oe=S3.size>=d.length;const xe=d[H];if(0!==xe){const re=V,ae=xe-1,ge=l[ae],me=ge+c[ae];for(let Ae=ge;Ae<me;Ae++){const he=u[Ae],ie=Ve.getAt(h,he),ue=f[ie]-x,_e=p[ie]-_,Fe=m[ie]-w;let Ze=ue*ue+_e*_e+Fe*Fe;if(0!==v){const ct=g[ie];Ze-=ct*ct}X&&Ze>V&&(V=Ze),hw.insert(Ze,he)}re<V&&(X=!1)}}$.length=0,W=0,YU.clear();for(let se=0;se<ee;se+=4){D=z[se],T=z[se+1],F=z[se+2];for(let xe=-Q;xe<=Q;xe++){const re=D+xe;if(!(re<0||re>=o))for(let ae=-G;ae<=G;ae++){const ge=T+ae;if(!(ge<0||ge>=s))for(let Ie=-Z;Ie<=Z;Ie++){const me=F+Ie;if(!(me<0||me>=a||(H=(re*s+ge)*a+me,YU.has(H)||(YU.add(H),S3.has(H))))){if(!j){const Ae=n[0]+re*y[0]-x,he=n[1]+ge*y[1]-_,ie=n[2]+me*y[2]-w;if(Ae*Ae+he*he+ie*ie-K>V){te.push(re,ge,me,H);continue}}$.push(re,ge,me,H),W++}}}}}if(j=!1,0===W){if(1===A){const se=hw.findMinimum();if(se){const{key:xe,value:re}=se;return ap.add(t,re,xe),!0}}else for(;!hw.isEmpty()&&(oe||hw.findMinimum().key<=V)&&t.count<A;){const se=hw.extractMinimum(),xe=se.key,re=se.value;ap.add(t,re,xe),M&&!R&&(R=M(re,xe))}if(t.count>=A||R||t.count>=E)return t.count>0;if(j=!0,X=!0,te.length>0){for(let se=0,xe=te.length;se<xe;se++)z.push(te[se]);te.length=0,N=z.length}}else{const se=z;z=$,$=se,N=W}}}(this.ctx,a),a}check(t,n,r,i){return this.ctx.x=t,this.ctx.y=n,this.ctx.z=r,this.ctx.radius=i,this.ctx.isCheck=!0,Zoe(this.ctx,this.result)}constructor(t,n,r){const i=function bLe(e,t,n){const r=Gt.expand(Gt(),t.box,C.create(.5,.5,.5)),{indices:i}=e,o=Gt.size(C(),r);let s,a;const l=Ve.size(i),c="number"==typeof n?n:32,u=Array.isArray(n)&&n;if(u&&!C.isZero(u))a=[Math.ceil(o[0]/u[0]),Math.ceil(o[1]/u[1]),Math.ceil(o[2]/u[2])],s=u;else if(l>0){const p=Math.ceil(l/c),m=Math.pow(p/(o[0]*o[1]*o[2]),1/3);a=[Math.ceil(o[0]*m),Math.ceil(o[1]*m),Math.ceil(o[2]*m)],s=[o[0]/a[0],o[1]/a[1],o[2]/a[2]]}else s=o,a=[1,1,1];return function yLe(e){const{expandedBox:t,size:[n,r,i],data:{x:o,y:s,z:a,radius:l,indices:c},elementCount:u,delta:d}=e,f=n*r*i,{min:[p,m,h]}=t;let g=0,y=0;const v=new Uint32Array(f),x=new Int32Array(u);for(let E=0;E<u;E++){const D=Ve.getAt(c,E),N=(Math.floor((o[D]-p)/d[0])*r+Math.floor((s[D]-m)/d[1]))*i+Math.floor((a[D]-h)/d[2]);1===(v[N]+=1)&&(y+=1),x[E]=N}if(l)for(let E=0;E<u;E++){const D=Ve.getAt(c,E);l[D]>g&&(g=l[D])}const _=new Int32Array(y);for(let E=0,D=0;E<f;E++){const T=v[E];T>0&&(v[E]=D+1,_[D]=T,D+=1)}const w=new Uint32Array(y);for(let E=1;E<y;++E)w[E]+=w[E-1]+_[E-1];const A=new Int32Array(y),M=new Int32Array(u);for(let E=0;E<u;E++){const D=v[x[E]];if(D>0){const T=D-1;M[w[T]+A[T]]=E,A[T]+=1}}return{size:e.size,bucketArray:M,bucketCounts:_,bucketOffset:w,grid:v,delta:d,min:e.expandedBox.min,data:e.data,maxRadius:g,expandedBox:e.expandedBox,boundingBox:e.boundingBox,boundingSphere:e.boundingSphere}}({size:a,data:{x:e.x,y:e.y,z:e.z,indices:i,radius:e.radius},expandedBox:r,boundingBox:t.box,boundingSphere:t.sphere,elementCount:l,delta:s})}(t,n,r);this.ctx=function vLe(e){return{grid:e,x:.1,y:.1,z:.1,k:1,stopIf:void 0,radius:.1,isCheck:!1}}(i),this.boundary={box:i.boundingBox,sphere:i.boundingSphere},this.buckets={offset:i.bucketOffset,count:i.bucketCounts,array:i.bucketArray},this.result=ap.create()}}function Zoe(e,t){const{min:n,size:[r,i,o],bucketOffset:s,bucketCounts:a,bucketArray:l,grid:c,data:{x:u,y:d,z:f,indices:p,radius:m},delta:h,maxRadius:g}=e.grid,{radius:y,isCheck:v,x,y:_,z:w}=e,A=y+g,M=A*A;ap.reset(t);const E=Math.max(0,Math.floor((x-A-n[0])/h[0])),D=Math.max(0,Math.floor((_-A-n[1])/h[1])),T=Math.max(0,Math.floor((w-A-n[2])/h[2])),F=Math.min(r-1,Math.floor((x+A-n[0])/h[0])),R=Math.min(i-1,Math.floor((_+A-n[1])/h[1])),N=Math.min(o-1,Math.floor((w+A-n[2])/h[2]));if(E>F||D>R||T>N)return!1;for(let j=E;j<=F;j++)for(let W=D;W<=R;W++)for(let z=T;z<=N;z++){const $=c[(j*i+W)*o+z];if(0===$)continue;const V=$-1,X=s[V],oe=X+a[V];for(let te=X;te<oe;te++){const K=Ve.getAt(p,l[te]),Q=u[K]-x,G=d[K]-_,Z=f[K]-w,ee=Q*Q+G*G+Z*Z;if(ee<=M){if(g>0&&Math.sqrt(ee)-m[K]>y)continue;if(v)return!0;ap.add(t,l[te],ee)}}}return t.count>0}const Qoe=C(),m1=C(),S3=new Set,YU=new Set,xLe=[.1],_Le=[.1],SLe=[.1],hw=new Koe;var dt,Ti,Oe,cl,dn,Or;!function(e){function t(p,m,h){return{kind:"element-location",structure:p,unit:m,element:h||0}}e.create=t,e.clone=function n(p){return t(p.structure,p.unit,p.element)},e.set=function r(p,m,h,g){return m&&(p.structure=m),h&&(p.unit=h),void 0!==g&&(p.element=g),p},e.copy=function i(p,m){return p.unit=m.unit,p.element=m.element,p},e.is=function o(p){return!!p&&"element-location"===p.kind},e.areEqual=function s(p,m){return p.unit===m.unit&&p.element===m.element};const a=C(),l=C();e.distance=function c(p,m){return p.unit.conformation.position(p.element,a),m.unit.conformation.position(m.element,l),C.distance(a,l)},e.position=function u(p,m){return m.unit.conformation.position(m.element,p)},e.residueIndex=function d(p){return p.unit.model.atomicHierarchy.residueAtomSegments.index[p.element]},e.chainIndex=function f(p){return p.unit.model.atomicHierarchy.chainAtomSegments.index[p.element]}}(dt||(dt={}));class wLe{add(t){const n=this.getHash(t);if(this.byHash.has(n)){const r=this.byHash.get(n);for(let i=0,o=r.length;i<o;i++)if(this.areEqual(t,r[i]))return!1;return r[r.length]=t,this.size++,!0}return this.byHash.set(n,[t]),this.size++,!0}has(t){const n=this.getHash(t);if(!this.byHash.has(n))return!1;const r=this.byHash.get(n);for(let i=0,o=r.length;i<o;i++)if(this.areEqual(t,r[i]))return!0;return!1}constructor(t,n){this.getHash=t,this.areEqual=n,this.size=0,this.byHash=new Map}}function XU(e,t){return new wLe(e,t)}function KU(){return new ALe}function Joe(e){return{previous:null,next:null,inList:!0,value:e}}class ALe{constructor(){this.count=0,this.first=null,this.last=null}addFirst(t){const n=Joe(t);return n.inList=!0,this.first&&(this.first.previous=n),n.next=this.first,this.first=n,this.count++,this.last||(this.last=n),n}addLast(t){const n=Joe(t);return null!==this.last&&(this.last.next=n),n.previous=this.last,this.last=n,null===this.first&&(this.first=n),n.inList=!0,this.count++,n}removeFirst(){const t=this.first;if(t)return this.remove(t),t.value}removeLast(){const t=this.last;if(t)return this.remove(t),t.value}remove(t){t.inList&&(t.inList=!1,null!==t.previous?t.previous.next=t.next:null===t.previous&&(this.first=t.next),null!==t.next?t.next.previous=t.previous:null===t.next&&(this.last=t.previous),t.next=null,t.previous=null,this.count--)}find(t){let n=this.first;for(;null!==n;){if(n.value===t)return n;n=n.next}}}function wt(e,t){const{description:n,isOptional:r=!1,isRest:i=!1,defaultValue:o}=t||{};return{type:e,isOptional:r,isRest:i,defaultValue:o,description:n}}function C3(e,t,n,r){const i=function(o){return cl.Apply(cl.Symbol(i.id),o)};return i.info={namespace:"",name:e,description:r},i.id="",i.args=t,i.type=n,i}function ese(e,t,n,r){const i=function(o){return cl.Apply(cl.Symbol(i.id),o)};return i.info={namespace:e,name:t,description:r},i.id=`${e}.${t}`,i.args=dn.None,i.type=n,i}function $R(e){return"function"==typeof e&&!!e.info&&!!e.args&&"string"==typeof e.info.namespace&&!!e.type}function wn(e,t,n){return C3("",e,t,n)}function tse(e){ise("","",e)}function nse(e){const t=[];return ose(e,t),t}function rse(e){const t=/([a-z])([A-Z])([a-z]|$)/g;return e.replace(t,(n,r,i,o)=>`${r}-${i.toLocaleLowerCase()}${o}`).replace(t,(n,r,i,o)=>`${r}-${i.toLocaleLowerCase()}${o}`)}function ise(e,t,n){if($R(n))return n.info.namespace=e,n.info.name=n.info.name||rse(t),void(n.id=`${n.info.namespace}.${n.info.name}`);const r=`${n["@namespace"]||rse(t)}`,i=e?`${e}.${r}`:r;for(const o of Object.keys(n))"object"!=typeof n[o]&&!$R(n[o])||ise(i,o,n[o])}function ose(e,t){if($R(e))t.push(e);else for(const n of Object.keys(e))"object"!=typeof e[n]&&!$R(e[n])||ose(e[n],t)}function Ga(e,t){return wn(dn.Dictionary({0:wt(e)}),e,t)}function g1(e,t){return wn(dn.List(e,{nonEmpty:!0}),e,t)}function lp(e,t,n){return wn(dn.Dictionary({0:wt(e),1:wt(e)}),t,n)}!function(e){e.create=function t(){return{keys:new Set,array:[]}},e.add=function n({keys:i,array:o},s,a){return!i.has(s)&&(i.add(s),o[o.length]=a,!0)},e.has=function r({keys:i},o){return i.has(o)}}(Ti||(Ti={})),function(e){function n(a,l,c){return{kind:"value",namespace:a,name:l,parent:c}}function o(a,l,c,u){const d=Object.create(null);for(const f of u)d[f]=!0;return{kind:"oneof",namespace:a,name:l,type:c,values:d}}e.Variable=function t(a,l,c){return{kind:"variable",name:a,type:l,isConstraint:c}},e.Value=n,e.Container=function r(a,l,c,u){return{kind:"container",namespace:a,name:l,child:c,alias:u}},e.Union=function i(a){return{kind:"union",types:a}},e.OneOf=o,e.Any={kind:"any"},e.AnyValue={kind:"any-value"},e.Num=n("","Number"),e.Str=n("","String"),e.Bool=o("","Bool",e.Str,["true","false"]),e.oneOfValues=function s({values:a}){return Object.keys(a).sort()}}(Oe||(Oe={})),function(e){function s(l){return!!l&&!!l.head&&"object"==typeof l}function a(l){return!!l&&"string"==typeof l.name}e.Symbol=function t(l){return{name:l}},e.Apply=function n(l,c){return c?{head:l,args:c}:{head:l}},e.isArgumentsArray=function r(l){return!!l&&Array.isArray(l)},e.isArgumentsMap=function i(l){return!!l&&!Array.isArray(l)},e.isLiteral=function o(l){return!s(l)&&!a(l)},e.isApply=s,e.isSymbol=a}(cl||(cl={})),function(e){function t(r){return{kind:"dictionary",map:r,"@type":0}}e.None=t({}),e.Dictionary=t,e.List=function n(r,i){const{nonEmpty:o=!1}=i||{};return{kind:"list",type:r,nonEmpty:o,"@type":0}}}(dn||(dn={})),function(e){e.AnyVar=Oe.Variable("a",Oe.Any),e.AnyValueVar=Oe.Variable("a",Oe.Any),e.ConstrainedVar=Oe.Variable("a",Oe.Any,!0),e.Regex=Oe.Value("Core","Regex"),e.Set=t=>Oe.Container("Core","Set",t||e.AnyValueVar),e.List=t=>Oe.Container("Core","List",t||e.AnyVar),e.Fn=(t,n)=>Oe.Container("Core","Fn",t||e.AnyVar,n),e.Flags=(t,n)=>Oe.Container("Core","Flags",t,n),e.BitFlags=e.Flags(Oe.Num,"BitFlags")}(Or||(Or={})),dn.Dictionary({0:wt(Oe.Num),1:wt(Oe.Num)});const ZU={"@header":"Language Primitives",type:{"@header":"Types",bool:wn(dn.Dictionary({0:wt(Oe.AnyValue)}),Oe.Bool,"Convert a value to boolean."),num:wn(dn.Dictionary({0:wt(Oe.AnyValue)}),Oe.Num,"Convert a value to number."),str:wn(dn.Dictionary({0:wt(Oe.AnyValue)}),Oe.Str,"Convert a value to string."),regex:wn(dn.Dictionary({0:wt(Oe.Str,{description:"Expression"}),1:wt(Oe.Str,{isOptional:!0,description:"Flags, e.g. 'i' for ignore case"})}),Or.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:wn(dn.List(Or.AnyVar),Or.List()),set:wn(dn.List(Or.AnyValueVar),Or.Set()),bitflags:wn(dn.Dictionary({0:wt(Oe.Num)}),Or.BitFlags,"Interpret a number as bitflags."),compositeKey:wn(dn.List(Oe.AnyValue),Oe.AnyValue)},logic:{"@header":"Logic",not:Ga(Oe.Bool),and:g1(Oe.Bool),or:g1(Oe.Bool)},ctrl:{"@header":"Control",eval:wn(dn.Dictionary({0:wt(Or.Fn(Or.AnyVar))}),Or.AnyVar,"Evaluate a function."),fn:wn(dn.Dictionary({0:wt(Or.AnyVar)}),Or.Fn(Or.AnyVar),'Wrap an expression to a "lazy" function.'),if:wn(dn.Dictionary({0:wt(Oe.Bool,{description:"Condition"}),1:wt(Oe.Variable("a",Oe.Any),{description:"If true"}),2:wt(Oe.Variable("b",Oe.Any),{description:"If false"})}),Oe.Union([Oe.Variable("a",Oe.Any),Oe.Variable("b",Oe.Any)])),assoc:wn(dn.Dictionary({0:wt(Oe.Str,{description:"Name"}),1:wt(Oe.Variable("a",Oe.Any),{description:"Value to assign"})}),Oe.Variable("a",Oe.Any))},rel:{"@header":"Relational",eq:lp(Oe.Variable("a",Oe.AnyValue,!0),Oe.Bool),neq:lp(Oe.Variable("a",Oe.AnyValue,!0),Oe.Bool),lt:lp(Oe.Num,Oe.Bool),lte:lp(Oe.Num,Oe.Bool),gr:lp(Oe.Num,Oe.Bool),gre:lp(Oe.Num,Oe.Bool),inRange:wn(dn.Dictionary({0:wt(Oe.Num,{description:"Value to test"}),1:wt(Oe.Num,{description:"Minimum value"}),2:wt(Oe.Num,{description:"Maximum value"})}),Oe.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")},math:{"@header":"Math",add:g1(Oe.Num),sub:g1(Oe.Num),mult:g1(Oe.Num),div:lp(Oe.Num,Oe.Num),pow:lp(Oe.Num,Oe.Num),mod:lp(Oe.Num,Oe.Num),min:g1(Oe.Num),max:g1(Oe.Num),cantorPairing:lp(Oe.Num,Oe.Num),sortedCantorPairing:lp(Oe.Num,Oe.Num),invertCantorPairing:wn(dn.Dictionary({0:wt(Oe.Num)}),Or.List(Oe.Num)),floor:Ga(Oe.Num),ceil:Ga(Oe.Num),roundInt:Ga(Oe.Num),trunc:Ga(Oe.Num),abs:Ga(Oe.Num),sign:Ga(Oe.Num),sqrt:Ga(Oe.Num),cbrt:Ga(Oe.Num),sin:Ga(Oe.Num),cos:Ga(Oe.Num),tan:Ga(Oe.Num),asin:Ga(Oe.Num),acos:Ga(Oe.Num),atan:Ga(Oe.Num),sinh:Ga(Oe.Num),cosh:Ga(Oe.Num),tanh:Ga(Oe.Num),exp:Ga(Oe.Num),log:Ga(Oe.Num),log10:Ga(Oe.Num),atan2:lp(Oe.Num,Oe.Num)},str:{"@header":"Strings",concat:g1(Oe.Str),match:wn(dn.Dictionary({0:wt(Or.Regex),1:wt(Oe.Str)}),Oe.Bool)},list:{"@header":"Lists",getAt:wn(dn.Dictionary({0:wt(Or.List()),1:wt(Oe.Num)}),Or.AnyVar),equal:wn(dn.Dictionary({0:wt(Or.List()),1:wt(Or.List())}),Oe.Bool)},set:{"@header":"Sets",has:wn(dn.Dictionary({0:wt(Or.Set(Or.ConstrainedVar)),1:wt(Or.ConstrainedVar)}),Oe.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:wn(dn.Dictionary({0:wt(Or.Set(Or.ConstrainedVar)),1:wt(Or.Set(Or.ConstrainedVar))}),Oe.Bool,"Check if the the 1st argument is a subset of the 2nd.")},flags:{"@header":"Flags",hasAny:wn(dn.Dictionary({0:wt(Or.Flags(Or.ConstrainedVar)),1:wt(Or.Flags(Or.ConstrainedVar))}),Oe.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:wn(dn.Dictionary({0:wt(Or.Flags(Or.ConstrainedVar)),1:wt(Or.Flags(Or.ConstrainedVar))}),Oe.Bool,"Check if the the 1st argument has all 2nd one's flags.")}};tse(ZU);const FLe=nse(ZU);var $t;function Rr(e,t){return wn(dn.Dictionary({0:wt($t.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"})}),e,t)}function mw(e,t){return wn(dn.None,e,t)}!function(){const e=Object.create(null);for(const t of FLe)e[t.id]=t}(),function(e){e.ElementSymbol=Oe.Value("Structure","ElementSymbol"),e.AtomName=Oe.Value("Structure","AtomName"),e.BondFlag=Oe.OneOf("Structure","BondFlag",Oe.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]),e.BondFlags=Or.Flags(e.BondFlag,"BondFlags"),e.SecondaryStructureFlag=Oe.OneOf("Structure","SecondaryStructureFlag",Oe.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]),e.SecondaryStructureFlags=Or.Flags(e.SecondaryStructureFlag,"SecondaryStructureFlag"),e.RingFingerprint=Oe.Value("Structure","RingFingerprint"),e.EntityType=Oe.OneOf("Structure","EntityType",Oe.Str,["polymer","non-polymer","water","branched"]),e.EntitySubtype=Oe.OneOf("Structure","EntitySubtype",Oe.Str,["other","polypeptide(D)","polypeptide(L)","polydeoxyribonucleotide","polyribonucleotide","polydeoxyribonucleotide/polyribonucleotide hybrid","cyclic-pseudo-peptide","peptide nucleic acid","oligosaccharide"]),e.ObjectPrimitive=Oe.OneOf("Structure","ObjectPrimitive",Oe.Str,["atomistic","sphere","gaussian","other"]),e.ResidueId=Oe.Value("Structure","ResidueId"),e.ElementSet=Oe.Value("Structure","ElementSet"),e.ElementSelection=Oe.Value("Structure","ElementSelection"),e.ElementReference=Oe.Value("Structure","ElementReference"),e.ElementSelectionQuery=Or.Fn(e.ElementSelection,"ElementSelectionQuery")}($t||($t={}));const Ee={core:ZU,structureQuery:{"@header":"Structure Queries",type:{"@header":"Types",elementSymbol:wn(dn.Dictionary({0:wt(Oe.Str)}),$t.ElementSymbol,"Create element symbol representation from a string value."),atomName:wn(dn.Dictionary({0:wt(Oe.AnyValue)}),$t.AtomName,"Convert a value to an atom name."),entityType:wn(dn.Dictionary({0:wt($t.EntityType)}),$t.EntityType,`Create normalized representation of entity type: ${Oe.oneOfValues($t.EntityType).join(", ")}.`),bondFlags:wn(dn.List($t.BondFlag),$t.BondFlags,`Create bond flags representation from a list of strings. Allowed flags: ${Oe.oneOfValues($t.BondFlag).join(", ")}.`),ringFingerprint:wn(dn.List($t.ElementSymbol,{nonEmpty:!0}),$t.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:wn(dn.List($t.SecondaryStructureFlag),$t.SecondaryStructureFlags,`Create secondary structure flags representation from a list of strings. Allowed flags: ${Oe.oneOfValues($t.SecondaryStructureFlag).join(", ")}.`),authResidueId:wn(dn.Dictionary({0:wt(Oe.Str,{description:"auth_asym_id"}),1:wt(Oe.Num,{description:"auth_seq_id"}),2:wt(Oe.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),$t.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:wn(dn.Dictionary({0:wt(Oe.Str,{description:"label_entity_id"}),1:wt(Oe.Str,{description:"label_asym_id"}),2:wt(Oe.Num,{description:"label_seq_id"}),3:wt(Oe.Str,{description:"pdbx_PDB_ins_code",isOptional:!0})}),$t.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')},slot:{"@header":"Iteration Slots",element:wn(dn.None,$t.ElementReference,"A reference to the current element."),elementSetReduce:wn(dn.None,Oe.Variable("a",Oe.AnyValue,!0),"Current value of the element set reducer.")},generator:{"@header":"Generators",all:wn(dn.None,$t.ElementSelectionQuery,"The entire structure."),atomGroups:wn(dn.Dictionary({"entity-test":wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every entity"}),"chain-test":wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom of every chain"}),"residue-test":wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"Test for the 1st atom every residue"}),"atom-test":wt(Oe.Bool,{isOptional:!0,defaultValue:!0}),"group-by":wt(Oe.Any,{isOptional:!0,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),$t.ElementSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),bondedAtomicPairs:wn(dn.Dictionary({0:wt(Oe.Bool,{isOptional:!0,defaultValue:"true for covalent bonds",description:"Test each bond with this predicate. Each bond is visited twice with swapped atom order."})}),$t.ElementSelectionQuery,"Return all pairs of atoms for which the test is satisfied."),rings:wn(dn.Dictionary({fingerprint:wt($t.RingFingerprint,{isOptional:!0}),"only-aromatic":wt(Oe.Bool,{isOptional:!0,defaultValue:!1})}),$t.ElementSelectionQuery,"Return all rings or those with the specified fingerprint and/or only aromatic rings."),queryInSelection:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),query:wt($t.ElementSelectionQuery),"in-complement":wt(Oe.Bool,{isOptional:!0,defaultValue:!1})}),$t.ElementSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:wn(dn.None,$t.ElementSelectionQuery,"Nada.")},modifier:{"@header":"Selection Modifications",queryEach:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),query:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),by:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),by:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),by:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),"min-distance":wt(Oe.Num,{isOptional:!0,defaultValue:0}),"max-distance":wt(Oe.Num),"min-size":wt(Oe.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:!0,defaultValue:2}),"max-size":wt(Oe.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:!0})}),$t.ElementSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),radius:wt(Oe.Num),"atom-radius":wt(Oe.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":wt(Oe.Bool,{isOptional:!0})}),$t.ElementSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),surroundingLigands:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),radius:wt(Oe.Num),"include-water":wt(Oe.Bool,{isOptional:!0,defaultValue:!0})}),$t.ElementSelectionQuery,"Find all ligands components around the source query."),includeConnected:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),"bond-test":wt(Oe.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),"layer-count":wt(Oe.Num,{isOptional:!0,defaultValue:1,description:"Number of bonded layers to include."}),"fixed-point":wt(Oe.Bool,{isOptional:!0,defaultValue:!1,description:"Continue adding layers as long as new connections exist."}),"as-whole-residues":wt(Oe.Bool,{isOptional:!0})}),$t.ElementSelectionQuery,"Pick all atom sets that are connected to the target."),wholeResidues:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Expand the selection to whole residues."),expandProperty:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),property:wt(Oe.AnyValue)}),$t.ElementSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")},filter:{"@header":"Selection Filters",pick:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),test:wt(Oe.Bool)}),$t.ElementSelectionQuery,"Pick all atom sets that satisfy the test."),first:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Take the 1st atom set in the sequence."),withSameAtomProperties:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),source:wt($t.ElementSelectionQuery),property:wt(Oe.Any)}),$t.ElementSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),by:wt($t.ElementSelectionQuery)}),$t.ElementSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),target:wt($t.ElementSelectionQuery),"min-radius":wt(Oe.Num,{isOptional:!0,defaultValue:0}),"max-radius":wt(Oe.Num),"atom-radius":wt(Oe.Num,{isOptional:!0,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:wt(Oe.Bool,{isOptional:!0,defaultValue:!1,description:"If true, pick only atom sets that are further than the specified radius."})}),$t.ElementSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery),target:wt($t.ElementSelectionQuery),"bond-test":wt(Oe.Bool,{isOptional:!0,defaultValue:"true for covalent bonds"}),disjunct:wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:wt(Oe.Bool,{isOptional:!0,defaultValue:!1,description:"If true, return atom sets that are not connected."})}),$t.ElementSelectionQuery,"Pick all atom sets that are connected to the target.")},combinator:{"@header":"Selection Combinators",intersect:wn(dn.List($t.ElementSelectionQuery),$t.ElementSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:wn(dn.List($t.ElementSelectionQuery),$t.ElementSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:wn(dn.Dictionary({matrix:wt(Or.List(Or.List(Oe.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:wt(Or.List($t.ElementSelectionQuery),{description:"A list of held selections."})}),$t.ElementSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")},atomSet:{"@header":"Atom Sets",atomCount:wn(dn.None,Oe.Num),countQuery:wn(dn.Dictionary({0:wt($t.ElementSelectionQuery)}),Oe.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:wn(dn.Dictionary({initial:wt(Oe.Variable("a",Oe.AnyValue,!0),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:wt(Oe.Variable("a",Oe.AnyValue,!0),{description:"Expression executed for each atom in the set"})}),Oe.Variable("a",Oe.AnyValue,!0),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:wn(dn.Dictionary({0:wt(Or.ConstrainedVar)}),Or.Set(Or.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")},atomProperty:{"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:Rr($t.ElementSymbol),vdw:Rr(Oe.Num,"Van der Waals radius"),mass:Rr(Oe.Num,"Atomic weight"),atomicNumber:Rr(Oe.Num,"Atomic number"),x:Rr(Oe.Num,"Cartesian X coordinate"),y:Rr(Oe.Num,"Cartesian Y coordinate"),z:Rr(Oe.Num,"Cartesian Z coordinate"),atomKey:Rr(Oe.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:wn(dn.Dictionary({0:wt($t.ElementReference,{isOptional:!0,defaultValue:"slot.current-atom"}),flags:wt($t.BondFlags,{isOptional:!0,defaultValue:"covalent"})}),Oe.Num,"Number of bonds (by default only covalent bonds are counted)."),sourceIndex:Rr(Oe.Num,"Index of the atom/element in the input file."),operatorName:Rr(Oe.Str,"Name of the symmetry operator applied to this element."),operatorKey:Rr(Oe.Num,"Key of the symmetry operator applied to this element."),modelIndex:Rr(Oe.Num,"Index of the model in the input file."),modelLabel:Rr(Oe.Str,"Label/header of the model in the input file.")},topology:{connectedComponentKey:Rr(Oe.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:Rr($t.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:Rr($t.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:Rr(Oe.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id, auth_seq_id, pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:Rr(Oe.AnyValue,"Unique value for each tuple ``(label_entity_id, auth_asym_id)``, main use case is grouping of atoms"),entityKey:Rr(Oe.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:Rr(Oe.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:Rr(Oe.Num,"_atom_site.id"),label_atom_id:Rr($t.AtomName),label_alt_id:Rr(Oe.Str),label_comp_id:Rr(Oe.Str),label_asym_id:Rr(Oe.Str),label_entity_id:Rr(Oe.Str),label_seq_id:Rr(Oe.Num),auth_atom_id:Rr($t.AtomName),auth_comp_id:Rr(Oe.Str),auth_asym_id:Rr(Oe.Str),auth_seq_id:Rr(Oe.Num),pdbx_PDB_ins_code:Rr(Oe.Str),pdbx_formal_charge:Rr(Oe.Num),occupancy:Rr(Oe.Num),B_iso_or_equiv:Rr(Oe.Num),entityType:Rr($t.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, branched, water)"),entitySubtype:Rr($t.EntitySubtype,"Subtype of the entity as defined in mmCIF _entity_poly.type and _pdbx_entity_branch.type (other, polypeptide(D), polypeptide(L), polydeoxyribonucleotide, polyribonucleotide, polydeoxyribonucleotide/polyribonucleotide hybrid, cyclic-pseudo-peptide, peptide nucleic acid, oligosaccharide)"),entityPrdId:Rr(Oe.Str,"The PRD ID of the entity."),entityDescription:Rr(Or.List(Oe.Str)),objectPrimitive:Rr($t.ObjectPrimitive,"Type of the primitive object used to model this segment as defined in mmCIF/IHM (atomistic, sphere, gaussian, other)"),secondaryStructureKey:Rr(Oe.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:Rr($t.SecondaryStructureFlags),isModified:Rr(Oe.Bool,"True if the atom belongs to modification of a standard residue."),modifiedParentName:Rr(Oe.Str,"'3-letter' code of the modifed parent residue."),isNonStandard:Rr(Oe.Bool,"True if this is a non-standard residue."),chemCompType:Rr(Oe.Str,"Type of the chemical component as defined in mmCIF.")}},bondProperty:{"@header":"Bond Properties",flags:mw($t.BondFlags),order:mw(Oe.Num),key:mw(Oe.Num),length:mw(Oe.Num),atomA:mw($t.ElementReference),atomB:mw($t.ElementReference)}},internal:{"@header":"Internal Queries",generator:{"@header":"Generators",bundleElement:wn(dn.Dictionary({groupedUnits:wt(Oe.Any),set:wt(Oe.Any),ranges:wt(Oe.Any)}),Oe.Any),bundle:wn(dn.Dictionary({elements:wt(Oe.Any)}),$t.ElementSelectionQuery,"A selection with single structure containing represented by the bundle."),current:wn(dn.None,$t.ElementSelectionQuery,"Current selection provided by the query context. Avoid using this in State Transforms.")}}};tse(Ee);const $Le=nse(Ee);var pe;function qa(){return qa.zero()}function Vh(){return Vh.zero()}function st(e){return e}function Br(e,t,n,r){return{label:e,description:n,list:r,type:t}}function YR(e,t,n){const r={};for(const i in e){let o=e[i];o=st.saturate(o,t),o=st.darken(o,-n),r[i]=o}return r}function sse(e,t=" "){return e.replace(/([a-z\xE0-\xFF])([A-Z\xC0\xDF])/g,`$1${t}$2`)}function Rc(e){return y1(sse(e))}!function(){const e=Object.create(null);for(const t of $Le)e[t.id]=t}(),function(e){e.core=Ee.core,e.struct=Ee.structureQuery,e.internal=Ee.internal,e.atomName=function t(v){return e.struct.type.atomName([v])},e.es=function n(v){return e.struct.type.elementSymbol([v])},e.list=function r(...v){return e.core.type.list(v)},e.set=function i(...v){return e.core.type.set(v)},e.re=function o(v,x){return e.core.type.regex([v,x])},e.fn=function s(v){return e.core.ctrl.fn([v])},e.evaluate=function a(v){return e.core.ctrl.eval([v])};const l=e.struct.atomProperty.core,c=e.struct.atomProperty.macromolecular,u=e.struct.atomProperty.topology;function d(v){return l[v]()}function f(v){return u[v]()}function p(v){return c[v]()}e.acp=d,e.atp=f,e.ammp=p;const m=e.struct.atomSet.propertySet;e.acpSet=function h(v){return m([d(v)])},e.atpSet=function g(v){return m([f(v)])},e.ammpSet=function y(v){return m([p(v)])}}(pe||(pe={})),function(e){function t(){const R=[.1,0,0];return R[0]=0,R}function l(R,N){const[j,W,z]=N,$=Math.sqrt(W*W+z*z);let V=(pf(Math.atan2(z,W))+360)%360;return 0===Math.round(1e4*$)&&(V=Number.NaN),R[0]=V,R[1]=$,R[2]=j,R}function u(R,N,j){return R[0]=N[0]-h*j,R[1]=N[1],R[2]=N[2],R}e.zero=t,e.create=function n(R,N,j){const W=t();return W[0]=R,W[1]=N,W[2]=j,W},e.set=function r(R,N,j,W){return R[0]=N,R[1]=j,R[2]=W,R},e.distance=function i(R,N){const j=N[0]-R[0],W=N[1]-R[1],z=N[2]-R[2];return Math.sqrt(j*j+W*W+z*z)},e.fromColor=function o(R,N){const[j,W,z]=st.toRgb(N),[$,V,X]=function F(R,N,j){return[T((.4124564*(R=D(R))+.3575761*(N=D(N))+.1804375*(j=D(j)))/g),T((.2126729*R+.7151522*N+.072175*j)/y),T((.0193339*R+.119192*N+.9503041*j)/v)]}(j,W,z),H=116*V-16;return R[0]=H<0?0:H,R[1]=500*($-V),R[2]=200*(V-X),R},e.fromHcl=function s(R,N){return Vh.toLab(R,N)},e.toColor=function a(R){let N=(R[0]+16)/116,j=isNaN(R[1])?N:N+R[1]/500,W=isNaN(R[2])?N:N-R[2]/200;N=y*E(N),j=g*E(j),W=v*E(W);const z=M(3.2404542*j-1.5371385*N-.4985314*W),$=M(-.969266*j+1.8760108*N+.041556*W),V=M(.0556434*j-.2040259*N+1.0572252*W);return st.fromRgb(Math.round(al(z,0,255)),Math.round(al($,0,255)),Math.round(al(V,0,255)))},e.toHcl=l,e.copy=function c(R,N){return R[0]=N[0],R[1]=N[1],R[2]=N[2],R},e.darken=u,e.lighten=function d(R,N,j){return u(R,N,-j)};const f=[0,0,0];function p(R,N,j){return l(f,N),Vh.toLab(R,Vh.saturate(f,f,j))}e.saturate=p,e.desaturate=function m(R,N,j){return p(R,N,-j)};const h=18,g=.95047,y=1,v=1.08883,x=.137931034,_=.206896552,w=.12841855,A=.008856452;function M(R){return 255*(R<=.00304?12.92*R:1.055*Math.pow(R,1/2.4)-.055)}function E(R){return R>_?R*R*R:w*(R-x)}function D(R){return(R/=255)<=.04045?R/12.92:Math.pow((R+.055)/1.055,2.4)}function T(R){return R>A?Math.pow(R,1/3):R/w+x}}(qa||(qa={})),function(e){function t(){const v=[.1,0,0];return v[0]=0,v}e.zero=t,e.create=function n(v,x,_){const w=t();return w[0]=v,w[1]=x,w[2]=_,w},e.set=function r(v,x,_,w){return v[0]=x,v[1]=_,v[2]=w,v},e.hasHue=function i(v){return!isNaN(v[0])};const o=[0,0,0];e.fromColor=function s(v,x){return qa.toHcl(v,qa.fromColor(o,x))},e.fromLab=function a(v,x){return qa.toHcl(v,x)};const l=[0,0,0];function u(v,x){let[_,w,A]=x;return isNaN(_)&&(_=0),_=Xr(_),v[0]=A,v[1]=Math.cos(_)*w,v[2]=Math.sin(_)*w,v}function f(v,x,_){return v[0]=x[0],v[1]=Math.max(0,x[1]+y*_),v[2]=x[2],v}e.toColor=function c(v){return qa.toColor(u(l,v))},e.toLab=u,e.copy=function d(v,x){return v[0]=x[0],v[1]=x[1],v[2]=x[2],v},e.saturate=f,e.desaturate=function p(v,x,_){return f(v,x,-_)};const m=[0,0,0];function h(v,x,_){return u(m,x),qa.toHcl(v,qa.darken(m,m,_))}e.darken=h,e.lighten=function g(v,x,_){return h(v,x,-_)};const y=18}(Vh||(Vh={})),function(e){function c(z,$,V){return z<<16|$<<8|V}function u(z,$,V){return 255*z<<16|255*$<<8|255*V}function v(z){const $=z>>16&255;return $!==(z>>8&255)||$!==(255&z)}e.toStyle=function t(z){return`rgb(${z>>16&255}, ${z>>8&255}, ${255&z})`},e.toHexStyle=function n(z){return"#"+("000000"+z.toString(16)).slice(-6)},e.toHexString=function r(z){return"0x"+("000000"+z.toString(16)).slice(-6)},e.toRgbString=function i(z){return`RGB: ${e.toRgb(z).join(", ")}`},e.toRgb=function o(z){return[z>>16&255,z>>8&255,255&z]},e.toRgbNormalized=function s(z){return[(z>>16&255)/255,(z>>8&255)/255,(255&z)/255]},e.fromHexStyle=function a(z){return parseInt(z.replace("#","0x"))},e.fromHexString=function l(z){return parseInt(z)},e.fromRgb=c,e.fromNormalizedRgb=u,e.fromArray=function d(z,$){return c(z[$],z[$+1],z[$+2])},e.fromNormalizedArray=function f(z,$){return u(z[$],z[$+1],z[$+2])},e.toArray=function p(z,$,V){return $[V]=z>>16&255,$[V+1]=z>>8&255,$[V+2]=255&z,$},e.toArrayNormalized=function m(z,$,V){return $[V]=(z>>16&255)/255,$[V+1]=(z>>8&255)/255,$[V+2]=(255&z)/255,$},e.toVec3=function h(z,$){return z[0]=$>>16&255,z[1]=$>>8&255,z[2]=255&$,z},e.toVec3Normalized=function g(z,$){return z[0]=($>>16&255)/255,z[1]=($>>8&255)/255,z[2]=(255&$)/255,z},e.interpolate=function y(z,$,V){const X=z>>16&255,H=z>>8&255,oe=255&z;return X+(($>>16&255)-X)*V<<16|H+(($>>8&255)-H)*V<<8|oe+((255&$)-oe)*V},e.hasHue=v;const x=[0,0,0];function _(z,$){return v(z)?(Vh.fromColor(x,z),Vh.toColor(Vh.saturate(x,x,$))):z}e.saturate=_,e.desaturate=function w(z,$){return _(z,-$)};const A=[0,0,0];function M(z,$){return qa.fromColor(A,z),qa.toColor(qa.darken(A,A,$))}function D(z){return z<=.03928?z/12.92:Math.pow((z+.055)/1.055,2.4)}function T(z){return.2126*D((z>>16&255)/255)+.7152*D((z>>8&255)/255)+.0722*D((255&z)/255)}function R(z){return z<.04045?.0773993808*z:Math.pow(.9478672986*z+.0521327014,2.4)}function j(z){return z<.0031308?12.92*z:1.055*Math.pow(z,.41666)-.055}e.darken=M,e.lighten=function E(z,$){return M(z,-$)},e.luminance=T,e.contrast=function F(z,$){const V=T(z),X=T($);return V>X?(V+.05)/(X+.05):(X+.05)/(V+.05)},e.sRGBToLinear=function N(z){return u(R((z>>16&255)/255),R((z>>8&255)/255),R((255&z)/255))},e.linearToSRGB=function W(z){return u(j((z>>16&255)/255),j((z>>8&255)/255),j((255&z)/255))}}(st||(st={}));const XLe=e=>e.toUpperCase();function y1(e){return e.toLowerCase().replace(/^\w|\s\w/g,XLe)}function yf(e){return y1(sse(function ase(e){return e.replace(/_/g," ")}(function lse(e){return e.replace(/-/g," ")}(e))))}function zs(e,t,n,r){const i=r.length;if(i>n-t)return!1;for(let o=0;o<i;o++)if(e.charCodeAt(t+o)!==r.charCodeAt(o))return!1;return!0}function b1(e){return e.replace(/<\/?[^>]+>/g,"")}function w3(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Ad={"orange-red":Br("Orange-Red","sequential","Orange-Red, sequential color scheme from ColorBrewer 2.0",[16775148,16705736,16635038,16628612,16551257,15689032,14102559,11730944,8323072]),"purple-blue":Br("Purple-Blue","sequential","Purple-Blue, sequential color scheme from ColorBrewer 2.0",[16775163,15525874,13685222,10927579,7645647,3576e3,356528,285325,145496]),"blue-purple":Br("Blue-Purple","sequential","Blue-Purple, sequential color scheme from ColorBrewer 2.0",[16252157,14740724,12571622,10403034,9213638,9202609,8929693,8458108,5046347]),oranges:Br("Oranges","sequential","",[16774635,16705230,16634018,16625259,16616764,15821075,14239745,10892803,8333060]),"blue-green":Br("Blue-Green","sequential","",[16252157,15070713,13429990,10082505,6734500,4304502,2329413,27948,17435]),"yellow-orange-brown":Br("Yellow-Orange-Brown","sequential","",[16777189,16775100,16704401,16696399,16685353,15495188,13388802,10040324,6694150]),"yellow-green":Br("Yellow-Green","sequential","",[16777189,16252089,14282915,11394446,7915129,4303709,2327619,26679,17705]),reds:Br("Reds","sequential","",[16774640,16703698,16563105,16552562,16476746,15678252,13309981,10817301,6750221]),"red-purple":Br("Red-Purple","sequential","",[16775155,16638173,16565696,16424885,16214177,14496919,11403646,7995767,4784234]),greens:Br("Greens","sequential","",[16252149,15070688,13101504,10607003,7652470,4303709,2329413,27948,17435]),"yellow-green-blue":Br("Yellow-Green-Blue","sequential","",[16777177,15595697,13101492,8375739,4306628,1937856,2252456,2438292,531800]),purples:Br("Purples","sequential","",[16579581,15724021,14342891,12369372,10394312,8420794,6967715,5515151,4128893]),"green-blue":Br("Green-Blue","sequential","",[16252144,14742491,13429701,11066805,8113348,5157843,2854078,551084,540801]),greys:Br("Greys","sequential","",[16777215,15790320,14277081,12434877,9868950,7566195,5395026,2434341,0]),"yellow-orange-red":Br("Yellow-Orange-Red","sequential","",[16777164,16772512,16701814,16691788,16616764,16535082,14883356,12386342,8388646]),"purple-red":Br("Purple-Red","sequential","",[16250105,15196655,13941210,13210823,14640560,15149450,13505110,9961539,6750239]),blues:Br("Blues","sequential","",[16251903,14609399,13032431,10406625,7057110,4362950,2191797,545180,536683]),"purple-blue-green":Br("Purple-Blue-Green","sequential","",[16775163,15524592,13685222,10927579,6793679,3576e3,164234,93273,83510]),spectral:Br("Spectral","diverging","",[10355010,13975119,16018755,16625249,16703627,16777151,15136152,11263396,6734501,3311805,6180770]),"red-yellow-green":Br("Red-Yellow-Green","diverging","",[10813478,14102567,16018755,16625249,16703627,16777151,14282635,10934634,6733155,1742928,26679]),"red-blue":Br("Red-Blue","diverging","",[6750239,11671595,14049357,16033154,16636871,16250871,13755888,9618910,4428739,2188972,340065]),"pink-yellow-green":Br("Pink-Yellow-Green","diverging","",[9306450,12917629,14579630,15840986,16638191,16250871,15136208,12116358,8371265,5083681,2581529]),"purple-green":Br("Purple-Green","diverging","",[4194379,7744131,10055851,12756431,15193320,16250871,14282963,10935200,5942881,1800247,17435]),"red-yellow-blue":Br("Red-Yellow-Blue","diverging","Red-Yellow-Blue, diverging color scheme from ColorBrewer 2.0",[10813478,14102567,16018755,16625249,16703632,16777151,14742520,11262441,7646673,4552116,3225237]),"brown-white-green":Br("Brown-White-Green","diverging","",[5517317,9195786,12550445,14664317,16181443,16119285,13101797,8441281,3512207,91742,15408]),"red-grey":Br("Red-Grey","diverging","",[6750239,11671595,14049357,16033154,16636871,16777215,14737632,12237498,8882055,5066061,1710618]),"orange-purple":Br("Orange-Purple","diverging","",[8338184,11753478,14713364,16627811,16703670,16250871,14211819,11709394,8418220,5515144,2949195]),"set-2":Br("Set-2","qualitative","",[6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),accent:Br("Accent","qualitative","",[8374655,12496596,16629894,16777113,3697840,15729279,12540695,6710886]),"set-1":Br("Set-1","qualitative","",[14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329]),"set-3":Br("Set-3","qualitative","",[9294791,16777139,12499674,16482418,8434131,16626786,11787881,16567781,14277081,12353725,13429701,16772463]),"dark-2":Br("Dark-2","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886]),paired:Br("Paired","qualitative","",[10931939,2062516,11722634,3383340,16489113,14883356,16629615,16744192,13284054,6962586,16777113,11622696]),"pastel-2":Br("Pastel-2","qualitative","",[11789005,16633260,13358568,16042724,15136201,16773806,15852236,13421772]),"pastel-1":Br("Pastel-1","qualitative","",[16495790,11783651,13429701,14601188,16701862,16777164,15063229,16636652,15921906]),"many-distinct":Br("Many-Distinct","qualitative","",[1810039,14245634,7696563,15149450,6727198,15117058,10909213,6710886,14948892,3636920,5091146,9981603,16744192,16777011,10901032,16220607,10066329,6734501,16551266,9281739,15174339,10934356,16767279,15058068,11776947]),magma:Br("Magma","sequential","Perceptually uniform shades of black-red-white",[4329332,4853881,5378684,5903742,6363263,6888576,7413633,7938689,8463745,8988801,9513600,10038655,10563454,11088508,11613562,12138360,12728949,13254258,13714030,14239338,14699366,15094114,15489119,15753309,16017499,16216411,16350045,16483424,16551523,16619368,16621934,16689780,16692091,16694402,16696969,16633746,16636058,16638371,16575148,16577461,16514239]),inferno:Br("Inferno","sequential","Perceptually uniform shades of black-red-yellow",[4721514,5246316,5771373,6296430,6821486,7346542,7871597,8396651,8921450,9446504,9971557,10496610,10956127,11481435,12006486,12466258,12926285,13386056,13780802,14241085,14570295,14965297,15229227,15558693,15757342,15956248,16154897,16288267,16421638,16489734,16492043,16494612,16496926,16368426,16305463,16111429,15982678,15853928,15856253,16119953,16580260]),plasma:Br("Plasma","sequential","Perceptually uniform shades of blue-red-yellow",[1771148,2426257,3081365,3671193,4195228,4784799,5308834,5833124,6357158,6815911,7340200,7864744,8324007,8783782,9309348,9769377,10164126,10624154,11018902,11413393,11808141,12137352,12466307,12795519,13124730,13453685,13717361,14046573,14309992,14573668,14837344,15035483,15299159,15497299,15695438,15893834,16091974,16224833,16357693,16425017,16557877,16625457,16627245,16629289,16631334,16567845,16438820,16310052,16115494,15921190,15726625]),viridis:Br("Viridis","sequential","Perceptually uniform shades of blue-green-yellow",[4524123,4656994,4658793,4726127,4727668,4663929,4599933,4535937,4406404,4276870,4081800,3952010,3822475,3627148,3497356,3302029,3172237,3042446,2912654,2782862,2652814,2523022,2393229,2328973,2198924,2069132,2004874,2005897,2007175,2139525,2337154,2666111,3060348,3520376,4045684,4570991,5227369,5883748,6605661,7392854,8180303,8967495,9819967,10672695,11525166,12443174,13295646,14148121,15000344,15852828,16639780]),cividis:Br("Cividis","sequential","Perceptually uniform shades of blue-green-yellow, should look effectively identical to colorblind and non-colorblind users",[11367,12400,537456,1455727,2046574,2571629,3031404,3425388,3754092,4148075,4476779,4805227,5133932,5396844,5725549,5988462,6317166,6580079,6843249,7171698,7434867,7697781,7960951,8289656,8618104,8881272,9209976,9538679,9867127,10195830,10524533,10853235,11181938,11510640,11839343,12168045,12497002,12891240,13219941,13548642,13943134,14271834,14666326,14995025,15389516,15718470,16112703,16507190,16639799]),twilight:Br("Twilight","sequential","Perceptually uniform shades of white-blue-black-red-white, cyclic",[14670305,14211037,13554648,12766675,11847630,10993866,10139847,9351365,8628419,8036290,7509952,7048895,6718653,6519739,6386105,6252470,6184114,6181293,6112935,6044831,5976470,5777291,5447293,5052270,4592479,4067665,3674181,3281211,3150646,3543352,4067644,4657728,5379141,6166345,6953549,7741007,8463184,9120336,9777743,10304079,10830671,11291984,11687762,12083541,12348505,12613471,12878439,13077872,13211771,13411209,13545111,13809830,14074293,14338756,14537169,14735067,14801121]),turbo:Br("Turbo","sequential","Improved (smooth) rainbow colormap for visualization",[4866485,4872413,4354034,3770361,3120629,2667241,2475736,2611140,3073454,3928216,5109892,6487408,8126047,9829201,11531332,13167162,14605618,15780908,16693543,16753699,16748063,16741916,16146200,15026195,13644558,12198408,10818563,9833728]),rainbow:Br("Rainbow","sequential","",[3367393,3516485,16383744,15501073,12526114]),"red-white-blue":Br("Red-White-Blue","diverging","",[12526114,16777215,3367393])},QU=Object.keys(Ad).map(e=>[e,Ad[e].label,y1(Ad[e].type)]),QLe=QU.filter(e=>"diverging"===Ad[e[0]].type||"sequential"===Ad[e[0]].type),JLe=QU.filter(e=>"qualitative"===Ad[e[0]].type);function cp(e){return e in Ad?Ad[e]:(console.warn(`unknown color list named '${e}'`),Ad["red-yellow-blue"])}function v1(e){return{kind:"table-legend",table:e}}const t6e={domain:[0,1],reverse:!1,listOrName:"red-yellow-blue",minLabel:"",maxLabel:""};var up;!function(e){e.create=function t(n){const{domain:r,reverse:i,listOrName:o}={...t6e,...n},s="string"==typeof o?cp(o).list:o,a=i?s.slice().reverse():s,l=a.length-1;let c=0,u=0,d=0;function f(y,v){u=y,d=v,c=d-u||1}f(r[0],r[1]);const p=Ll(n.minLabel,u.toString()),m=Ll(n.maxLabel,d.toString());let h;if(a.every(y=>Array.isArray(y))){const y=[...a];y.sort((w,A)=>w[1]-A[1]);const v=y.map(w=>w[0]),x=rt.ofSortedArray(y.map(w=>w[1])),_=v.length-1;h=w=>{const A=al((w-u)/c,0,1),M=rt.findPredecessorIndex(x,A);if(0===M)return v[u];if(M>_)return v[_];const E=x[M-1],T=al((A-E)/(x[M]-E),0,1);return st.interpolate(v[M-1],v[M],T)}}else h=y=>{const v=Math.min(a.length-1,Math.max(0,(y-u)/c*l)),x=Math.floor(v),_=a[x],w=a[Math.ceil(v)];return st.interpolate(_,w,v-x)};return{color:h,colorToArray:(y,v,x)=>{st.toArray(h(y),v,x)},normalizedColorToArray:(y,v,x)=>{st.toArrayNormalized(h(y),v,x)},setDomain:f,get legend(){return function e6e(e,t,n){return{kind:"scale-legend",minLabel:e,maxLabel:t,colors:n}}(p,m,a)}}}}(up||(up={}));const cse=new Set(["145","147","149","289","291","293","445","475","491","510","604","045","05L","07E","07Y","08U","09X","0AT","0BD","0H0","0HX","0LP","0MK","0NZ","0TS","0UB","0V4","0WK","0XY","0YT","10M","12E","14T","15L","16F","16G","16O","17T","18D","18O","18T","1AR","1BW","1CF","1FT","1GL","1GN","1JB","1LL","1NA","1S3","1S4","1SD","1X4","20S","20X","22O","22S","23V","24S","25E","26M","26O","26Q","26R","26V","26W","26Y","27C","2DG","2DR","2F8","2FG","2FL","2FP","2GL","2GS","2H5","2HA","2M4","2M5","2M8","2OS","2SI","2WP","2WS","32O","34V","38J","3BU","3CM","3DO","3DY","3FM","3GR","3HD","3J3","3J4","3LJ","3LR","3MF","3MG","3MK","3R3","3S6","3SA","3YW","40J","42D","44S","46D","46M","46Z","48Z","49A","49S","49T","49V","4AM","4CQ","4GC","4GL","4GP","4JA","4N2","4NN","4QY","4R1","4RS","4SG","4U0","4U1","4U2","4UZ","4V5","50A","51N","56N","57S","5DI","5GF","5GO","5II","5KQ","5KS","5KT","5KV","5L2","5L3","5LS","5LT","5MM","5N6","5QP","5RP","5SA","5SP","5TH","5TJ","5TK","5TM","61J","62I","64K","66O","6BG","6C2","6DM","6GB","6GP","6GR","6K3","6KH","6KL","6KS","6KU","6KW","6LA","6LS","6LW","6MJ","6MN","6PG","6PY","6PZ","6S2","6SA","6UD","6Y6","6YR","6ZC","73E","79J","7CV","7D1","7GP","7JZ","7K2","7K3","7NU","7SA","83Y","89Y","8B7","8B9","8EX","8GA","8GG","8GP","8I4","8LM","8LR","8OQ","8PK","8S0","8YV","95Z","96O","98U","9AM","9C1","9CD","9GP","9KJ","9MR","9OK","9PG","9QG","9QZ","9S7","9SG","9SJ","9SM","9SP","9T1","9T7","9VP","9WJ","9WN","9WZ","9YW","A0K","A1Q","A2G","A5C","A6P","AAL","AAO","ABC","ABD","ABE","ABF","ABL","AC1","ACG","ACR","ACX","ADA","ADG","ADR","AF1","AFD","AFL","AFO","AFP","AFR","AGC","AGH","AGL","AGR","AH2","AH8","AHG","AHM","AHR","AIG","ALL","ALX","AMG","AMN","AMU","AMV","ANA","AOG","AOS","AQA","ARA","ARB","ARE","ARI","ARW","ASC","ASG","ASO","AXP","AXR","AY9","AZC","B0D","B16","B1H","B1N","B2G","B4G","B6D","B7G","B8D","B9D","BBK","BBV","BCD","BCW","BDF","BDG","BDP","BDR","BDZ","BEM","BFN","BFP","BG6","BG8","BGC","BGL","BGN","BGP","BGS","BHG","BM3","BM7","BMA","BMX","BND","BNG","BNX","BO1","BOG","BQY","BRI","BS7","BTG","BTU","BW3","BWG","BXF","BXP","BXX","BXY","BZD","C3B","C3G","C3X","C4B","C4W","C4X","C5X","CAP","CBF","CBI","CBK","CDR","CE5","CE6","CE8","CEG","CEX","CEY","CEZ","CGF","CJB","CKB","CKP","CNP","CR1","CR6","CRA","CT3","CTO","CTR","CTT","D0N","D1M","D5E","D6G","DAF","DAG","DAN","DDA","DDB","DDL","DEG","DEL","DFR","DFX","DG0","DGC","DGD","DGM","DGO","DGS","DGU","DIG","DJB","DJE","DK4","DKX","DKZ","DL6","DLD","DLF","DLG","DMU","DNO","DO8","DOM","DP5","DPC","DQQ","DQR","DR2","DR3","DR4","DR5","DRI","DSR","DT6","DVC","DYM","E3M","E4P","E5G","EAG","EBG","EBQ","EEN","EEQ","EGA","EJT","EMP","EMZ","EPG","EQP","EQV","ERE","ERI","ETT","EUS","F1P","F1X","F55","F58","F6P","F8X","FBP","FCA","FCB","FCT","FDP","FDQ","FFC","FFX","FIF","FIX","FK9","FKD","FMF","FMO","FNG","FNY","FRU","FSA","FSI","FSM","FSR","FSW","FU4","FUB","FUC","FUD","FUF","FUL","FUY","FVQ","FX1","FYJ","G0S","G16","G1P","G20","G28","G2F","G3F","G3I","G4D","G4S","G6D","G6P","G6S","G7P","G8Z","GAA","GAC","GAD","GAF","GAL","GAT","GBH","GC1","GC4","GC9","GCB","GCD","GCN","GCO","GCS","GCT","GCU","GCV","GCW","GDA","GDL","GE1","GE3","GFP","GIV","GL0","GL1","GL2","GL4","GL5","GL6","GL7","GL9","GLA","GLB","GLC","GLD","GLF","GLG","GLO","GLP","GLS","GLT","GLW","GM0","GMB","GMH","GMT","GMZ","GN1","GN4","GNS","GNX","GP0","GP1","GP4","GPH","GPK","GPM","GPO","GPQ","GPU","GPV","GPW","GQ1","GRF","GRX","GS1","GS4","GS9","GSA","GSD","GTE","GTH","GTK","GTM","GTR","GU0","GU1","GU2","GU3","GU4","GU5","GU6","GU8","GU9","GUF","GUL","GUP","GUZ","GXL","GXV","GYE","GYG","GYP","GYU","GYV","GZL","H1M","H1S","H2P","H3S","H53","H6Q","H6Z","HBZ","HD4","HDL","HMS","HNV","HNW","HSG","HSH","HSJ","HSQ","HSR","HSU","HSX","HSY","HSZ","HTG","HTM","HVC","I57","IAB","IDC","IDF","IDG","IDR","IDS","IDT","IDU","IDX","IDY","IEM","IN1","IPT","ISD","ISL","ISX","IVG","IXD","J5B","JFZ","JHM","JLT","JRV","JS2","JSV","JV4","JVA","JVS","JZR","K5B","K99","KBA","KBG","KD5","KDA","KDB","KDD","KDE","KDF","KDM","KDN","KDO","KDR","KFN","KG1","KGM","KHP","KME","KO1","KO2","KOT","KQC","KTU","L1L","L6N","L6S","L6T","LAG","LAH","LAI","LAK","LAO","LAT","LB2","LBS","LBT","LCN","LDY","LEC","LER","LFC","LFR","LGC","LGU","LKA","LKS","LM2","LMO","LMT","LMU","LNV","LOG","LOX","LPK","LRH","LSM","LTG","LTM","LVO","LVZ","LXB","LXC","LXZ","LZ0","M1F","M1P","M2F","M3M","M3N","M55","M6D","M6P","M7B","M7P","M8C","MA1","MA2","MA3","MA8","MAB","MAF","MAG","MAL","MAN","MAT","MAV","MAW","MBE","MBF","MBG","MCU","MDA","MDP","MFA","MFB","MFU","MG5","MGA","MGC","MGL","MGS","MJJ","MLB","MLR","MMA","MMN","MN0","MNA","MQG","MQT","MRH","MRP","MSX","MTT","MUB","MUG","MUR","MVP","MXY","MXZ","MYG","N1L","N3U","N9S","NA1","NAA","NAG","NBG","NBX","NBY","NDG","NED","NFG","NG1","NG6","NGA","NGB","NGC","NGE","NGF","NGK","NGL","NGR","NGS","NGY","NGZ","NHF","NLC","NM6","NM9","NNG","NPF","NSQ","NT1","NTF","NTO","NTP","NXD","NYT","O1G","OAK","OEL","OI7","OPM","ORP","OSU","OTG","OTN","OTU","OX2","P53","P6P","P8E","PA1","PA5","PAV","PDX","PH5","PKM","PNA","PNG","PNJ","PNW","PPC","PRP","PSG","PSJ","PSV","PTQ","PUF","PZU","QDK","QIF","QKH","QPS","QV4","R1P","R1X","R2B","R2G","R5P","RAA","RAE","RAF","RAM","RAO","RAT","RB5","RBL","RCD","RDP","REL","RER","RF5","RG1","RGG","RHA","RHC","RI2","RIB","RIP","RM4","RNS","RNT","ROB","ROR","RP3","RP5","RP6","RPA","RR7","RRJ","RRY","RST","RTG","RTV","RUB","RUG","RUU","RV7","RVG","RVM","RWI","RY7","RZM","S6P","S7P","S81","SA0","SCG","SCR","SDD","SDY","SEJ","SF6","SF9","SFJ","SFU","SG4","SG5","SG6","SG7","SGA","SGC","SGD","SGN","SGS","SHB","SHD","SHG","SI3","SIA","SID","SIO","SIZ","SLB","SLM","SLT","SMD","SN5","SNG","SOE","SOG","SOL","SOR","SR1","SSG","SSH","STW","STZ","SUC","SUP","SUS","SWE","SZZ","T68","T6D","T6P","T6T","TA6","TAG","TCB","TCG","TDG","TEU","TF0","TFU","TGA","TGK","TGR","TGY","TH1","TM5","TM6","TM9","TMR","TMX","TNX","TOA","TOC","TQY","TRE","TRV","TS8","TT7","TTV","TTZ","TU4","TUG","TUJ","TUP","TUR","TVD","TVG","TVM","TVS","TVV","TVY","TW7","TWA","TWD","TWG","TWJ","TWY","TXB","TY6","TYV","U1Y","U2A","U2D","U63","U8V","U97","U9A","U9D","U9G","U9J","U9M","UAP","UBH","UBO","UCD","UDC","UEA","V3M","V3P","V71","VDF","VG1","VJ1","VJ4","VKN","VTB","W9T","WIA","WOO","WUN","WZ1","WZ2","WZ4","X0X","X1P","X1X","X2F","X2Y","X34","X4S","X5S","X6X","X6Y","XBP","XDP","XDX","XGP","XIL","XKJ","XLF","XLS","XMM","XS2","XUL","XXM","XXR","XXX","XY6","XY9","XYB","XYF","XYL","XYP","XYS","XYT","XYZ","YDR","YIO","YJM","YKR","YO5","YX0","YX1","YYB","YYD","YYH","YYJ","YYK","YYM","YYQ","YYR","YZ0","YZT","Z0F","Z15","Z16","Z2D","Z2T","Z3K","Z3L","Z3Q","Z3U","Z4K","Z4R","Z4S","Z4U","Z4V","Z4W","Z4Y","Z57","Z5J","Z5L","Z61","Z6G","Z6H","Z6J","Z6W","Z8H","Z8T","Z9D","Z9E","Z9H","Z9K","Z9L","Z9M","Z9N","Z9W","ZB0","ZB1","ZB2","ZB3","ZCD","ZCZ","ZD0","ZDC","ZDM","ZDO","ZEE","ZEL","ZGE","ZMR","UMQ","SQD"]);var Gi=function(e){return e[e.FilledSphere=0]="FilledSphere",e[e.FilledCube=1]="FilledCube",e[e.CrossedCube=2]="CrossedCube",e[e.DividedDiamond=3]="DividedDiamond",e[e.FilledCone=4]="FilledCone",e[e.DevidedCone=5]="DevidedCone",e[e.FlatBox=6]="FlatBox",e[e.FilledStar=7]="FilledStar",e[e.FilledDiamond=8]="FilledDiamond",e[e.FlatDiamond=9]="FlatDiamond",e[e.FlatHexagon=10]="FlatHexagon",e[e.Pentagon=11]="Pentagon",e[e.DiamondPrism=12]="DiamondPrism",e[e.PentagonalPrism=13]="PentagonalPrism",e[e.HexagonalPrism=14]="HexagonalPrism",e[e.HeptagonalPrism=15]="HeptagonalPrism",e}(Gi||{});var zt=function(e){return e[e.Hexose=0]="Hexose",e[e.HexNAc=1]="HexNAc",e[e.Hexosamine=2]="Hexosamine",e[e.Hexuronate=3]="Hexuronate",e[e.Deoxyhexose=4]="Deoxyhexose",e[e.DeoxyhexNAc=5]="DeoxyhexNAc",e[e.DiDeoxyhexose=6]="DiDeoxyhexose",e[e.Pentose=7]="Pentose",e[e.Deoxynonulosonate=8]="Deoxynonulosonate",e[e.DiDeoxynonulosonate=9]="DiDeoxynonulosonate",e[e.Unknown=10]="Unknown",e[e.Assigned=11]="Assigned",e}(zt||{});const r6e={[zt.Hexose]:Gi.FilledSphere,[zt.HexNAc]:Gi.FilledCube,[zt.Hexosamine]:Gi.CrossedCube,[zt.Hexuronate]:Gi.DividedDiamond,[zt.Deoxyhexose]:Gi.FilledCone,[zt.DeoxyhexNAc]:Gi.DevidedCone,[zt.DiDeoxyhexose]:Gi.FlatBox,[zt.Pentose]:Gi.FilledStar,[zt.Deoxynonulosonate]:Gi.FilledDiamond,[zt.DiDeoxynonulosonate]:Gi.FlatDiamond,[zt.Unknown]:Gi.FlatHexagon,[zt.Assigned]:Gi.Pentagon};function i6e(e,t){return e===zt.Unknown?4===t?Gi.DiamondPrism:5===t?Gi.PentagonalPrism:6===t?Gi.HexagonalPrism:7===t?Gi.HeptagonalPrism:Gi.FlatHexagon:r6e[e]}const JU={abbr:"Unk",name:"Unknown",color:15854817,type:zt.Unknown},gw=[{abbr:"Glc",name:"Glucose",color:37052,type:zt.Hexose},{abbr:"Man",name:"Mannose",color:42577,type:zt.Hexose},{abbr:"Gal",name:"Galactose",color:16765952,type:zt.Hexose},{abbr:"Gul",name:"Gulose",color:16021792,type:zt.Hexose},{abbr:"Alt",name:"Altrose",color:16162465,type:zt.Hexose},{abbr:"All",name:"Allose",color:10830745,type:zt.Hexose},{abbr:"Tal",name:"Talose",color:9424105,type:zt.Hexose},{abbr:"Ido",name:"Idose",color:10582605,type:zt.Hexose},{abbr:"GlcNAc",name:"N-Acetyl Glucosamine",color:37052,type:zt.HexNAc},{abbr:"ManNAc",name:"N-Acetyl Mannosamine",color:42577,type:zt.HexNAc},{abbr:"GalNAc",name:"N-Acetyl Galactosamine",color:16765952,type:zt.HexNAc},{abbr:"GulNAc",name:"N-Acetyl Gulosamine",color:16021792,type:zt.HexNAc},{abbr:"AltNAc",name:"N-Acetyl Altrosamine",color:16162465,type:zt.HexNAc},{abbr:"AllNAc",name:"N-Acetyl Allosamine",color:10830745,type:zt.HexNAc},{abbr:"TalNAc",name:"N-Acetyl Talosamine",color:9424105,type:zt.HexNAc},{abbr:"IdoNAc",name:"N-Acetyl Idosamine",color:10582605,type:zt.HexNAc},{abbr:"GlcN",name:"Glucosamine",color:37052,type:zt.Hexosamine},{abbr:"ManN",name:"Mannosamine",color:42577,type:zt.Hexosamine},{abbr:"GalN",name:"Galactosamine",color:16765952,type:zt.Hexosamine},{abbr:"GulN",name:"Gulosamine",color:16021792,type:zt.Hexosamine},{abbr:"AltN",name:"Altrosamine",color:16162465,type:zt.Hexosamine},{abbr:"AllN",name:"Allosamine",color:10830745,type:zt.Hexosamine},{abbr:"TalN",name:"Talosamine",color:9424105,type:zt.Hexosamine},{abbr:"IdoN",name:"Idosamine",color:10582605,type:zt.Hexosamine},{abbr:"GlcA",name:"Glucuronic Acid",color:37052,type:zt.Hexuronate},{abbr:"ManA",name:"Mannuronic Acid",color:42577,type:zt.Hexuronate},{abbr:"GalA",name:"Galacturonic Acid",color:16765952,type:zt.Hexuronate},{abbr:"GulA",name:"Guluronic Acid",color:16021792,type:zt.Hexuronate},{abbr:"AltA",name:"Altruronic Acid",color:16162465,type:zt.Hexuronate},{abbr:"AllA",name:"Alluronic Acid",color:10830745,type:zt.Hexuronate},{abbr:"TalA",name:"Taluronic Acid",color:9424105,type:zt.Hexuronate},{abbr:"IdoA",name:"Iduronic Acid",color:10582605,type:zt.Hexuronate},{abbr:"Qui",name:"Quinovose",color:37052,type:zt.Deoxyhexose},{abbr:"Rha",name:"Rhamnose",color:42577,type:zt.Deoxyhexose},{abbr:"6dGul",name:"6-Deoxy Gulose",color:16021792,type:zt.Deoxyhexose},{abbr:"6dAlt",name:"6-Deoxy Altrose",color:16162465,type:zt.Deoxyhexose},{abbr:"6dTal",name:"6-Deoxy Talose",color:9424105,type:zt.Deoxyhexose},{abbr:"Fuc",name:"Fucose",color:15539236,type:zt.Deoxyhexose},{abbr:"QuiNAc",name:"N-Acetyl Quinovosamine",color:37052,type:zt.DeoxyhexNAc},{abbr:"RhaNAc",name:"N-Acetyl Rhamnosamine",color:42577,type:zt.DeoxyhexNAc},{abbr:"6dAltNAc",name:"N-Acetyl 6-Deoxy Altrosamine",color:16162465,type:zt.DeoxyhexNAc},{abbr:"6dTalNAc",name:"N-Acetyl 6-Deoxy Talosamine",color:9424105,type:zt.DeoxyhexNAc},{abbr:"FucNAc",name:"N-Acetyl Fucosamine",color:15539236,type:zt.DeoxyhexNAc},{abbr:"Oli",name:"Olivose",color:37052,type:zt.DiDeoxyhexose},{abbr:"Tyv",name:"Tyvelose",color:42577,type:zt.DiDeoxyhexose},{abbr:"Abe",name:"Abequose",color:16021792,type:zt.DiDeoxyhexose},{abbr:"Par",name:"Paratose",color:16162465,type:zt.DiDeoxyhexose},{abbr:"Dig",name:"Digitoxose",color:10830745,type:zt.DiDeoxyhexose},{abbr:"Col",name:"Colitose",color:9424105,type:zt.DiDeoxyhexose},{abbr:"Ara",name:"Arabinose",color:42577,type:zt.Pentose},{abbr:"Lyx",name:"Lyxose",color:16765952,type:zt.Pentose},{abbr:"Xyl",name:"Xylose",color:16021792,type:zt.Pentose},{abbr:"Rib",name:"Ribose",color:16162465,type:zt.Pentose},{abbr:"Kdn",name:"Keto-Deoxy Nonulonic Acid",color:42577,type:zt.Deoxynonulosonate},{abbr:"Neu5Ac",name:"N-Acetyl Neuraminic Acid",color:10830745,type:zt.Deoxynonulosonate},{abbr:"Neu5Gc",name:"N-Glycolyl Neuraminic Acid",color:9424105,type:zt.Deoxynonulosonate},{abbr:"Neu",name:"Neuraminic Acid",color:10582605,type:zt.Deoxynonulosonate},{abbr:"Sia",name:"Sialic acid",color:15539236,type:zt.Deoxynonulosonate},{abbr:"Pse",name:"Pseudaminic Acid",color:42577,type:zt.DiDeoxynonulosonate},{abbr:"Leg",name:"Legionaminic Acid",color:16765952,type:zt.DiDeoxynonulosonate},{abbr:"Aci",name:"Acinetaminic Acid",color:16162465,type:zt.DiDeoxynonulosonate},{abbr:"4eLeg",name:"4-Epilegionaminic Acid",color:9424105,type:zt.DiDeoxynonulosonate},{abbr:"Bac",name:"Bacillosamine",color:37052,type:zt.Unknown},{abbr:"LDmanHep",name:"L-Glycero-D-Manno Heptose",color:42577,type:zt.Unknown},{abbr:"Kdo",name:"Keto-Deoxy Octulonic Acid",color:16765952,type:zt.Unknown},{abbr:"Dha",name:"3-Deoxy Lyxo-Heptulosaric Acid",color:16021792,type:zt.Unknown},{abbr:"DDmanHep",name:"D-Glycero-D-Manno-Heptose",color:16162465,type:zt.Unknown},{abbr:"MurNAc",name:"N-Acetyl Muramic Acid",color:10830745,type:zt.Unknown},{abbr:"MurNGc",name:"N-Glycolyl Muramic Acid",color:9424105,type:zt.Unknown},{abbr:"Mur",name:"Muramic Acid",color:10582605,type:zt.Unknown},{abbr:"Api",name:"Apicose",color:42577,type:zt.Assigned},{abbr:"Fru",name:"Fructose",color:42577,type:zt.Assigned},{abbr:"Tag",name:"Tagatose",color:16765952,type:zt.Assigned},{abbr:"Sor",name:"Sorbose",color:16021792,type:zt.Assigned},{abbr:"Psi",name:"Psicose",color:16162465,type:zt.Assigned}],o6e=function(){const e=new Map;for(let t=0,n=gw.length;t<n;++t){const r=gw[t];e.set(r.abbr,r)}return e}(),s6e=[["Glc-family",37052],["Man-family",42577],["Gal-family",16765952],["Gul-family",16021792],["Alt-family",16162465],["All-family",10830745],["Tal-family",9424105],["Ido-family",10582605],["Fuc-family",15539236],["Generic/Unknown/Secondary",15854817]],use={Glc:["GLC","BGC","Z8T","TRE","MLR"],Man:["MAN","BMA"],Gal:["GLA","GAL","GZL","GXL","GIV"],Gul:["4GL","GL0","GUP","Z8H"],Alt:["Z6H","3MK","SHD"],All:["AFD","ALL","WOO","Z2D"],Tal:["ZEE","A5C","SDY"],Ido:["ZCD","Z0F","4N2"],GlcNAc:["NDG","NAG","NGZ"],ManNAc:["BM3","BM7"],GalNAc:["A2G","NGA","YYQ"],GulNAc:["LXB"],AltNAc:[],AllNAc:["NAA"],TalNAc:[],IdoNAc:["LXZ","HSQ"],GlcN:["PA1","GCS"],ManN:["95Z"],GalN:["X6X","1GN"],GulN:[],AltN:[],AllN:[],TalN:[],IdoN:[],GlcA:["GCU","BDP"],ManA:["MAV","BEM"],GalA:["ADA","GTR","GTK"],GulA:["LGU"],AltA:[],AllA:[],TalA:["X1X","X0X"],IdoA:["IDR"],Qui:["G6D","YYK"],Rha:["RAM","RM4","XXR"],"6dGul":["66O"],"6dAlt":[],"6dTal":[],Fuc:["FUC","FUL","FCA","FCB","GYE"],QuiNAc:["Z9W"],RhaNAc:[],"6dAltNAc":[],"6dTalNAc":[],FucNAc:["49T"],Oli:["DDA","RAE","Z5J"],Tyv:["TYV"],Abe:["ABE"],Par:["PZU"],Dig:["Z3U"],Col:[],Ara:["64K","ARA","ARB","AHR","FUB","BXY","BXX","SEJ"],Lyx:["LDY","Z4W"],Xyl:["XYS","XYP","XYZ","HSY","LXC"],Rib:["YYM","RIP","RIB","BDR","0MK","Z6J","32O"],Kdn:["KDM","KDN"],Neu5Ac:["SIA","SLB"],Neu5Gc:["NGC","NGE"],Neu:[],Sia:[],Pse:[],Leg:[],Aci:[],"4eLeg":[],Bac:[],LDmanHep:["GMH"],Kdo:["KDO"],Dha:[],DDmanHep:["289"],MurNAc:["MUB","AMU"],MurNGc:[],Mur:["1S4","MUR"],Api:["XXM"],Fru:["BDF","Z9N","FRU","LFR"],Tag:["T6T"],Sor:["SOE","UEA"],Psi:["PSV","SF6","SF9","TTV"]},dse={Glc:["AGLC","BGLC"],GlcNAc:["AGLCNA","BGLCNA","BGLCN0"],GlcA:["AGLCA","BGLCA","BGLCA0"],Man:["AMAN","BMAN"],Rha:["ARHM","BRHM"],Ara:["AARB","BARB"],Gal:["AGAL","BGAL"],GalNAc:["AGALNA","BGALNA"],Gul:["AGUL","BGUL"],Alt:["AALT","BALT"],All:["AALL","BALL"],Tal:["ATAL","BTAL"],Ido:["AIDO","BIDO"],IdoA:["AIDOA","BIDOA"],Fuc:["AFUC","BFUC"],Lyx:["ALYF","BLYF"],Xyl:["AXYL","BXYL","AXYF","BXYF"],Rib:["ARIB","BRIB"],Fru:["AFRU","BFRU"],Neu5Ac:["ANE5AC","BNE5AC"]},a6e={Glc:["0GA","0GB","1GA","1GB","2GA","2GB","3GA","3GB","4GA","4GB","6GA","6GB","ZGA","ZGB","YGA","YGB","XGA","XGB","WGA","WGB","VGA","VGB","UGA","UGB","TGA","TGB","SGA","SGB","RGA","RGB","QGA","QGB","PGA","PGB","0gA","0gB","1gA","1gB","2gA","2gB","3gA","3gB","4gA","4gB","6gA","6gB","ZgA","ZgB","YgA","YgB","XgA","XgB","WgA","WgB","VgA","VgB","UgA","UgB","TgA","TgB","SgA","SgB","RgA","RgB","QgA","QgB","PgA","PgB"],GlcNAc:["0YA","0YB","1YA","1YB","3YA","3YB","4YA","4YB","6YA","6YB","WYA","WYB","VYA","VYB","UYA","UYB","QYA","QYB","0yA","0yB","1yA","1yB","3yA","3yB","4yA","4yB","6yA","6yB","WyA","WyB","VyA","VyB","UyA","UyB","QyA","QyB","0YS","0Ys","3YS","3Ys","4YS","4Ys","6YS","6Ys","QYS","QYs","UYS","UYs","VYS","VYs","WYS","WYs","0yS","0ys","3yS","3ys","4yS","4ys"],GlcA:["0ZA","0ZB","1ZA","1ZB","2ZA","2ZB","3ZA","3ZB","4ZA","4ZB","ZZA","ZZB","YZA","YZB","WZA","WZB","TZA","TZB","0zA","0zB","1zA","1zB","2zA","2zB","3zA","3zB","4zA","4zB","ZzA","ZzB","YzA","YzB","WzA","WzB","TzA","TzB","0ZBP"],GlcN:["0YN","3YN","4YN","6YN","WYN","VYN","UYN","QYN","3Yn","4Yn","WYn","0Yn","0YP","3YP","4YP","6YP","WYP","VYP","UYP","QYP","0Yp","3Yp","4Yp","WYp"],Man:["0MA","0MB","1MA","1MB","2MA","2MB","3MA","3MB","4MA","4MB","6MA","6MB","ZMA","ZMB","YMA","YMB","XMA","XMB","WMA","WMB","VMA","VMB","UMA","UMB","TMA","TMB","SMA","SMB","RMA","RMB","QMA","QMB","PMA","PMB","0mA","0mB","1mA","1mB","2mA","2mB","3mA","3mB","4mA","4mB","6mA","6mB","ZmA","ZmB","YmA","YmB","XmA","XmB","WmA","WmB","VmA","VmB","UmA","UmB","TmA","TmB","SmA","SmB","RmA","RmB","QmA","QmB","PmA","PmB"],ManNAc:["0WA","0WB","1WA","1WB","3WA","3WB","4WA","4WB","6WA","6WB","WWA","WWB","VWA","VWB","UWA","UWB","QWA","QWB","0wA","0wB","1wA","1wB","3wA","3wB","4wA","4wB","6wA","6wB","WwA","WwB","VwA","VwB","UwA","UwB","QwA","QwB"],Ara:["0AA","0AB","1AA","1AB","2AA","2AB","3AA","3AB","4AA","4AB","ZAA","ZAB","YAA","YAB","WAA","WAB","TAA","TAB","0AD","0AU","1AD","1AU","2AD","2AU","3AD","3AU","5AD","5AU","ZAD","ZAU","0aA","0aB","1aA","1aB","2aA","2aB","3aA","3aB","4aA","4aB","ZaA","ZaB","YaA","YaB","WaA","WaB","TaA","TaB","0aD","0aU","1aD","1aU","2aD","2aU","3aD","3aU","5aD","5aU","ZaD","ZaU"],Gal:["0LA","0LB","1LA","1LB","2LA","2LB","3LA","3LB","4LA","4LB","6LA","6LB","ZLA","ZLB","YLA","YLB","XLA","XLB","WLA","WLB","VLA","VLB","ULA","ULB","TLA","TLB","SLA","SLB","RLA","RLB","QLA","QLB","PLA","PLB","0lA","0lB","1lA","1lB","2lA","2lB","3lA","3lB","4lA","4lB","6lA","6lB","ZlA","ZlB","YlA","YlB","XlA","XlB","WlA","WlB","VlA","VlB","UlA","UlB","TlA","TlB","SlA","SlB","RlA","RlB","QlA","QlB","PlA","PlB"],GalNAc:["0VA","0VB","1VA","1VB","3VA","3VB","4VA","4VB","6VA","6VB","WVA","WVB","VVA","VVB","UVA","UVB","QVA","QVB","0vA","0vB","1vA","1vB","3vA","3vB","4vA","4vB","6vA","6vB","WvA","WvB","VvA","VvB","UvA","UvB","QvA","QvB"],GalA:["0OA","0OB","1OA","1OB","2OA","2OB","3OA","3OB","4OA","4OB","ZOA","ZOB","YOA","YOB","WOA","WOB","TOA","TOB","0oA","0oB","1oA","1oB","2oA","2oB","3oA","3oB","4oA","4oB","ZoA","ZoB","YoA","YoB","WoA","WoB","ToA","ToB"],Gul:["0KA","0KB","1KA","1KB","2KA","2KB","3KA","3KB","4KA","4KB","6KA","6KB","ZKA","ZKB","YKA","YKB","XKA","XKB","WKA","WKB","VKA","VKB","UKA","UKB","TKA","TKB","SKA","SKB","RKA","RKB","QKA","QKB","PKA","PKB","0kA","0kB","1kA","1kB","2kA","2kB","3kA","3kB","4kA","4kB","6kA","6kB","ZkA","ZkB","YkA","YkB","XkA","XkB","WkA","WkB","VkA","VkB","UkA","UkB","TkA","TkB","SkA","SkB","RkA","RkB","QkA","QkB","PkA","PkB"],Alt:["0EA","0EB","1EA","1EB","2EA","2EB","3EA","3EB","4EA","4EB","6EA","6EB","ZEA","ZEB","YEA","YEB","XEA","XEB","WEA","WEB","VEA","VEB","UEA","UEB","TEA","TEB","SEA","SEB","REA","REB","QEA","QEB","PEA","PEB","0eA","0eB","1eA","1eB","2eA","2eB","3eA","3eB","4eA","4eB","6eA","6eB","ZeA","ZeB","YeA","YeB","XeA","XeB","WeA","WeB","VeA","VeB","UeA","UeB","TeA","TeB","SeA","SeB","ReA","ReB","QeA","QeB","PeA","PeB"],All:["0NA","0NB","1NA","1NB","2NA","2NB","3NA","3NB","4NA","4NB","6NA","6NB","ZNA","ZNB","YNA","YNB","XNA","XNB","WNA","WNB","VNA","VNB","UNA","UNB","TNA","TNB","SNA","SNB","RNA","RNB","QNA","QNB","PNA","PNB","0nA","0nB","1nA","1nB","2nA","2nB","3nA","3nB","4nA","4nB","6nA","6nB","ZnA","ZnB","YnA","YnB","XnA","XnB","WnA","WnB","VnA","VnB","UnA","UnB","TnA","TnB","SnA","SnB","RnA","RnB","QnA","QnB","PnA","PnB"],Tal:["0TA","0TB","1TA","1TB","2TA","2TB","3TA","3TB","4TA","4TB","6TA","6TB","ZTA","ZTB","YTA","YTB","XTA","XTB","WTA","WTB","VTA","VTB","UTA","UTB","TTA","TTB","STA","STB","RTA","RTB","QTA","QTB","PTA","PTB","0tA","0tB","1tA","1tB","2tA","2tB","3tA","3tB","4tA","4tB","6tA","6tB","ZtA","ZtB","YtA","YtB","XtA","XtB","WtA","WtB","VtA","VtB","UtA","UtB","TtA","TtB","StA","StB","RtA","RtB","QtA","QtB","PtA","PtB"],Ido:["0IA","0IB","1IA","1IB","2IA","2IB","3IA","3IB","4IA","4IB","6IA","6IB","ZIA","ZIB","YIA","YIB","XIA","XIB","WIA","WIB","VIA","VIB","UIA","UIB","TIA","TIB","SIA","SIB","RIA","RIB","QIA","QIB","PIA","PIB","0iA","0iB","1iA","1iB","2iA","2iB","3iA","3iB","4iA","4iB","6iA","6iB","ZiA","ZiB","YiA","YiB","XiA","XiB","WiA","WiB","ViA","ViB","UiA","UiB","TiA","TiB","SiA","SiB","RiA","RiB","QiA","QiB","PiA","PiB"],IdoA:["0UA","0UB","1UA","1UB","2UA","2UB","3UA","3UB","4UA","4UB","ZUA","ZUB","YUA","YUB","WUA","WUB","TUA","TUB","0uA","0uB","1uA","1uB","2uA","2uB","3uA","3uB","4uA","4uB","ZuA","ZuB","YuA","YuB","WuA","WuB","TuA","TuB","YuAP"],Fuc:["0FA","0FB","1FA","1FB","2FA","2FB","3FA","3FB","4FA","4FB","ZFA","ZFB","YFA","YFB","WFA","WFB","TFA","TFB","0fA","0fB","1fA","1fB","2fA","2fB","3fA","3fB","4fA","4fB","ZfA","ZfB","YfA","YfB","WfA","WfB","TfA","TfB"],Rha:["0HA","0HB","1HA","1HB","2HA","2HB","3HA","3HB","4HA","4HB","ZHA","ZHB","YHA","YHB","WHA","WHB","THA","THB","0hA","0hB","1hA","1hB","2hA","2hB","3hA","3hB","4hA","4hB","ZhA","ZhB","YhA","YhB","WhA","WhB","ThA","ThB"],Qui:["0QA","0QB","1QA","1QB","2QA","2QB","3QA","3QB","4QA","4QB","ZQA","ZQB","YQA","YQB","WQA","WQB","TQA","TQB","0qA","0qB","1qA","1qB","2qA","2qB","3qA","3qB","4qA","4qB","ZqA","ZqB","YqA","YqB","WqA","WqB","TqA","TqB"],Lyx:["0DA","0DB","1DA","1DB","2DA","2DB","3DA","3DB","4DA","4DB","ZDA","ZDB","YDA","YDB","WDA","WDB","TDA","TDB","0DD","0DU","1DD","1DU","2DD","2DU","3DD","3DU","5DD","5DU","ZDD","ZDU","0dA","0dB","1dA","1dB","2dA","2dB","3dA","3dB","4dA","4dB","ZdA","ZdB","YdA","YdB","WdA","WdB","TdA","TdB","0dD","0dU","1dD","1dU","2dD","2dU","3dD","3dU","5dD","5dU","ZdD","ZdU"],Xyl:["0XA","0XB","1XA","1XB","2XA","2XB","3XA","3XB","4XA","4XB","ZXA","ZXB","YXA","YXB","WXA","WXB","TXA","TXB","0XD","0XU","1XD","1XU","2XD","2XU","3XD","3XU","5XD","5XU","ZXD","ZXU","0xA","0xB","1xA","1xB","2xA","2xB","3xA","3xB","4xA","4xB","ZxA","ZxB","YxA","YxB","WxA","WxB","TxA","TxB","0xD","0xU","1xD","1xU","2xD","2xU","3xD","3xU","5xD","5xU","ZxD","ZxU"],Rib:["0RA","0RB","1RA","1RB","2RA","2RB","3RA","3RB","4RA","4RB","ZRA","ZRB","YRA","YRB","WRA","WRB","TRA","TRB","0RD","0RU","1RD","1RU","2RD","2RU","3RD","3RU","5RD","5RU","ZRD","ZRU","0rA","0rB","1rA","1rB","2rA","2rB","3rA","3rB","4rA","4rB","ZrA","ZrB","YrA","YrB","WrA","WrB","TrA","TrB","0rD","0rU","1rD","1rU","2rD","2rU","3rD","3rU","5rD","5rU","ZrD","ZrU"],Fru:["0CA","0CB","1CA","1CB","2CA","2CB","3CA","3CB","4CA","4CB","5CA","5CB","WCA","WCB","0CD","0CU","1CD","1CU","2CD","2CU","3CD","3CU","4CD","4CU","6CD","6CU","WCD","WCU","VCD","VCU","UCD","UCU","QCD","QCU","0cA","0cB","1cA","1cB","2cA","2cB","3cA","3cB","4cA","4cB","5cA","5cB","WcA","WcB","0cD","0cU","1cD","1cU","2cD","2cU","3cD","3cU","4cD","4cU","6cD","6cU","WcD","WcU","VcD","VcU","UcD","UcU","QcD","QcU"],Tag:["0JA","0JB","1JA","1JB","2JA","2JB","3JA","3JB","4JA","4JB","5JA","5JB","WJA","WJB","0JD","0JU","1JD","1JU","2JD","2JU","3JD","3JU","4JD","4JU","6JD","6JU","WJD","WJU","VJD","VJU","UJD","UJU","QJD","QJU","0jA","0jB","1jA","1jB","2jA","2jB","3jA","3jB","4jA","4jB","5jA","5jB","WjA","WjB","0jD","0jU","1jD","1jU","2jD","2jU","3jD","3jU","4jD","4jU","6jD","6jU","WjD","WjU","VjD","VjU","UjD","UjU","QjD","QjU"],Sor:["0BA","0BB","1BA","1BB","2BA","2BB","3BA","3BB","4BA","4BB","5BA","5BB","WBA","WBB","0BD","0BU","1BD","1BU","2BD","2BU","3BD","3BU","4BD","4BU","6BD","6BU","WBD","WBU","VBD","VBU","UBD","UBU","QBD","QBU","0bA","0bB","1bA","1bB","2bA","2bB","3bA","3bB","4bA","4bB","5bA","5bB","WbA","WbB","0bD","0bU","1bD","1bU","2bD","2bU","3bD","3bU","4bD","4bU","6bD","6bU","WbD","WbU","VbD","VbU","UbD","UbU","QbD","QbU"],Psi:["0PA","0PB","1PA","1PB","2PA","2PB","3PA","3PB","4PA","4PB","5PA","5PB","WPA","WPB","0PD","0PU","1PD","1PU","2PD","2PU","3PD","3PU","4PD","4PU","6PD","6PU","WPD","WPU","VPD","VPU","UPD","UPU","QPD","QPU","0pA","0pB","1pA","1pB","2pA","2pB","3pA","3pB","4pA","4pB","5pA","5pB","WpA","WpB","0pD","0pU","1pD","1pU","2pD","2pU","3pD","3pU","4pD","4pU","6pD","6pU","WpD","WpU","VpD","VpU","UpD","UpU","QpD","QpU"],Neu5Ac:["0SA","0SB","4SA","4SB","7SA","7SB","8SA","8SB","9SA","9SB","ASA","ASB","BSA","BSB","CSA","CSB","DSA","DSB","ESA","ESB","FSA","FSB","GSA","GSB","HSA","HSB","ISA","ISB","JSA","JSB","KSA","KSB","0sA","0sB","4sA","4sB","7sA","7sB","8sA","8sB","9sA","9sB","AsA","AsB","BsA","BsB","CsA","CsB","DsA","DsB","EsA","EsB","FsA","FsB","GsA","GsB","HsA","HsB","IsA","IsB","JsA","JsB","KsA","KsB"],Neu5Gc:["0GL","4GL","7GL","8GL","9GL","CGL","DGL","EGL","FGL","GGL","HGL","IGL","JGL","KGL","0gL","4gL","7gL","8gL","9gL","AgL","BgL","CgL","DgL","EgL","FgL","GgL","HgL","IgL","JgL","KgL"],Tyv:["0TV","0Tv","1TV","1Tv","2TV","2Tv","4TV","4Tv","YTV","YTv","0tV","0tv","1tV","1tv","2tV","2tv","4tV","4tv","YtV","Ytv"],Abe:["0AE","2AE","4AE","YGa","0AF","2AF","4AF","YAF"],Bac:["0BC","3BC","0bC","3bC"],Kdn:["0KN","4KN","5KN","7KN","8KN","9KN","AKN","BKN","CKN","DKN","EKN","FKN","GKN","HKN","IKN","JKN","KKN","LKN","MKN","NKN","OKN","PKN","QKN","RKN","SKN","TKN","UKN","VKN","WKN","XKN","YKN","0Kn","4Kn","5Kn","7Kn","8Kn","9Kn","AKn","BKn","CKn","DKn","EKn","FKn","GKn","HKn","IKn","JKn","KKn","LKn","MKn","NKn","OKn","PKn","QKn","RKn","SKn","TKn","UKn","VKn","WKn","XKn","YKn"],Kdo:["0KO","4KO","5KO","7KO","8KO","AKO","BKO","CKO","DKO","EKO","FKO","GKO","HKO","IKO","JKO","KKO","0Ko","4Ko","5Ko","7Ko","8Ko","AKo","BKo","CKo","DKo","EKo","FKo","GKo","HKo","IKo","JKo","KKo"]},fse=function(){const e=new Map;for(let t=0,n=gw.length;t<n;++t){const r=gw[t],i=use[r.abbr];if(i)for(let s=0,a=i.length;s<a;++s)e.set(i[s],r);const o=dse[r.abbr];if(o)for(let s=0,a=o.length;s<a;++s)e.set(o[s],r)}return cse.forEach(t=>{e.has(t)||e.set(t,JU)}),e}(),l6e=function(){const e=new Map;for(let t=0,n=gw.length;t<n;++t){const r=gw[t],i=use[r.abbr];if(i)for(let a=0,l=i.length;a<l;++a)e.set(i[a],r);const o=dse[r.abbr];if(o)for(let a=0,l=o.length;a<l;++a)e.set(o[a],r);const s=a6e[r.abbr];if(s)for(let a=0,l=s.length;a<l;++a)e.has(s[a])||e.set(s[a],r)}return cse.forEach(t=>{e.has(t)||e.set(t,JU)}),e}();let $0=fse;var Lo;!function(e){e.toArray=function t(p){return Array.from(p.values())},e.isSuperset=function n(p,m){if(p.size<m.size)return!1;for(const h of m)if(!p.has(h))return!1;return!0},e.add=function r(p,...m){for(let h=0;h<m.length;h++)for(const g of m[h])p.add(g);return p},e.union=function i(p,m){const h=new Set(p);for(const g of m)h.add(g);return h},e.unionMany=function o(...p){if(0===p.length)return new Set;const m=new Set(p[0]);for(let h=1,g=p.length;h<g;h++)for(const y of p[h])m.add(y);return m},e.unionManyArrays=function s(p){if(0===p.length)return new Set;const m=new Set(p[0]);for(let h=1;h<p.length;h++)for(const g of p[h])m.add(g);return m},e.intersection=function a(p,m){const h=new Set;for(const g of m)p.has(g)&&h.add(g);return h},e.areIntersecting=function l(p,m){p.size<m.size&&([p,m]=[m,p]);for(const h of m)if(p.has(h))return!0;return!1},e.intersectionSize=function c(p,m){p.size<m.size&&([p,m]=[m,p]);let h=0;for(const g of m)p.has(g)&&(h+=1);return h},e.difference=function u(p,m){const h=new Set(p);for(const g of m)h.delete(g);return h},e.differenceSize=function d(p,m){let h=p.size;for(const g of p)m.has(g)&&(h-=1);return h},e.areEqual=function f(p,m){if(p.size!==m.size)return!1;for(const h of m)if(!p.has(h))return!1;return!0}}(Lo||(Lo={}));const pse=new Set(["DAPC","DBPC","DFPC","DGPC","DIPC","DLPC","DNPC","DOPC","DPPC","DRPC","DTPC","DVPC","DXPC","DYPC","LPPC","PAPC","PEPC","PGPC","PIPC","POPC","PRPC","PUPC","DAPE","DBPE","DFPE","DGPE","DIPE","DLPE","DNPE","DOPE","DPPE","DRPE","DTPE","DUPE","DVPE","DXPE","DYPE","LPPE","PAPE","PGPE","PIPE","POPE","PQPE","PRPE","PUPE","DAPS","DBPS","DFPS","DGPS","DIPS","DLPS","DNPS","DOPS","DPPS","DRPS","DTPS","DUPS","DVPS","DXPS","DYPS","LPPS","PAPS","PGPS","PIPS","POPS","PQPS","PRPS","PUPS","DAPG","DBPG","DFPG","DGPG","DIPG","DLPG","DNPG","DOPG","DPPG","DRPG","DTPG","DVPG","DXPG","DYPG","LPPG","PAPG","PGPG","PIPG","POPG","PRPG","DAPA","DBPA","DFPA","DGPA","DIPA","DLPA","DNPA","DOPA","DPPA","DRPA","DTPA","DVPA","DXPA","DYPA","LPPA","PAPA","PGPA","PIPA","POPA","PRPA","PUPA","DPP","DPPI","PAPI","PIPI","POP","POPI","PUPI","PVP","PVPI","PADG","PIDG","PODG","PUDG","PVDG","APC","CPC","IPC","LPC","OPC","PPC","TPC","UPC","VPC","BNSM","DBSM","DPSM","DXSM","PGSM","PNSM","POSM","PVSM","XNSM","DPCE","DXCE","PNCE","XNCE","DMPC"]),hse=new Set(["118","119","543","1AL","1CU","2FK","2HP","2OF","3CO","3MT","3NI","3OF","3P8","4MO","4PU","4TI","6MO","ACT","AG","AL","ALF","AM","ATH","AU","AU3","AUC","AZI","BA","BCT","BEF","BF4","BO4","BR","BS3","BSY","CA","CAC","CD","CD1","CD3","CD5","CE","CF","CHT","CL","CO","CO3","CO5","CON","CR","CS","CSB","CU","CU1","CU3","CUA","CUZ","CYN","DME","DMI","DSC","DTI","DY","E4N","EDR","EMC","ER3","EU","EU3","F","FE","FE2","FPO","GA","GD3","GEP","HAI","HG","HGC","IN","IOD","IR","IR3","IRI","IUM","K","KO4","LA","LCO","LCP","LI","LU","MAC","MG","MH2","MH3","MLI","MMC","MN","MN3","MN5","MN6","MO1","MO2","MO3","MO4","MO5","MO6","MOO","MOS","MOW","MW1","MW2","MW3","NA","NA2","NA5","NA6","NAO","NAW","ND","NET","NH4","NI","NI1","NI2","NI3","NO2","NO3","NRU","NT3","O4M","OAA","OC1","OC2","OC3","OC4","OC5","OC6","OC7","OC8","OCL","OCM","OCN","OCO","OF1","OF2","OF3","OH","OS","OS4","OXL","PB","PBM","PD","PDV","PER","PI","PO3","PO4","PR","PT","PT4","PTN","RB","RH3","RHD","RHF","RU","SB","SCN","SE4","SEK","SM","SMO","SO3","SO4","SR","T1A","TB","TBA","TCN","TEA","TH","THE","TL","TMA","TRA","UNX","V","VN3","VO4","W","WO5","Y1","YB","YB2","YH","YT3","ZCM","ZN","ZN2","ZN3","ZNO","ZO3","ZR","NCO","OHX"]),u6e=function(){const e=Object.create(null),t=[];for(let n=65;n<=90;n++)t[t.length]=String.fromCharCode(n);for(let n=97;n<=122;n++)t[t.length]=String.fromCharCode(n);for(let n=48;n<=57;n++)t[t.length]=String.fromCharCode(n);for(const n of t){e[n]=n.toUpperCase();for(const r of t){e[n+r]=(n+r).toUpperCase();for(const i of t)e[n+r+i]=(n+r+i).toUpperCase()}}return e}();function Jx(e){return u6e[e]||e.toUpperCase()}const mse=new Map([[1,"H"],[2,"He"],[3,"Li"],[4,"Be"],[5,"B"],[6,"C"],[7,"N"],[8,"O"],[9,"F"],[10,"Ne"],[11,"Na"],[12,"Mg"],[13,"Al"],[14,"Si"],[15,"P"],[16,"S"],[17,"Cl"],[18,"Ar"],[19,"K"],[20,"Ca"],[21,"Sc"],[22,"Ti"],[23,"V"],[24,"Cr"],[25,"Mn"],[26,"Fe"],[27,"Co"],[28,"Ni"],[29,"Cu"],[30,"Zn"],[31,"Ga"],[32,"Ge"],[33,"As"],[34,"Se"],[35,"Br"],[36,"Kr"],[37,"Rb"],[38,"Sr"],[39,"Y"],[40,"Zr"],[41,"Nb"],[42,"Mo"],[43,"Tc"],[44,"Ru"],[45,"Rh"],[46,"Pd"],[47,"Ag"],[48,"Cd"],[49,"In"],[50,"Sn"],[51,"Sb"],[52,"Te"],[53,"I"],[54,"Xe"],[55,"Cs"],[56,"Ba"],[57,"La"],[58,"Ce"],[59,"Pr"],[60,"Nd"],[61,"Pm"],[62,"Sm"],[63,"Eu"],[64,"Gd"],[65,"Tb"],[66,"Dy"],[67,"Ho"],[68,"Er"],[69,"Tm"],[70,"Yb"],[71,"Lu"],[72,"Hf"],[73,"Ta"],[74,"W"],[75,"Re"],[76,"Os"],[77,"Ir"],[78,"Pt"],[79,"Au"],[80,"Hg"],[81,"Tl"],[82,"Pb"],[83,"Bi"],[84,"Po"],[85,"At"],[86,"Rn"],[87,"Fr"],[88,"Ra"],[89,"Ac"],[90,"Th"],[91,"Pa"],[92,"U"],[93,"Np"],[94,"Pu"],[95,"Am"],[96,"Cm"],[97,"Bk"],[98,"Cf"],[99,"Es"],[100,"Fm"],[101,"Md"],[102,"No"],[103,"Lr"],[104,"Rf"],[105,"Db"],[106,"Sg"],[107,"Bh"],[108,"Hs"],[109,"Mt"],[110,"Ds"],[111,"Rg"],[112,"Cn"],[113,"Uut"],[114,"Fl"],[115,"Uup"],[116,"Lv"],[117,"Uus"],[118,"Uuo"]].map(e=>[e[0],Jx(e[1])])),p6e={0:{trace:new Set,directionFrom:new Set,directionTo:new Set,backboneStart:new Set,backboneEnd:new Set,coarseBackbone:new Set},1:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O","OC1","O1","OX1","OXT","OT1"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["C"]),coarseBackbone:new Set(["CA","BB","CA1"])},2:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CD"]),coarseBackbone:new Set(["CA"])},3:{trace:new Set(["CA"]),directionFrom:new Set(["C"]),directionTo:new Set(["O"]),backboneStart:new Set(["N"]),backboneEnd:new Set(["CG"]),coarseBackbone:new Set(["CA"])},4:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C4'","C4*"]),directionTo:new Set(["C3'","C3*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},5:{trace:new Set(["O3'","O3*"]),directionFrom:new Set(["C3'","C3*"]),directionTo:new Set(["C1'","C1*"]),backboneStart:new Set(["P"]),backboneEnd:new Set(["O3'","O3*"]),coarseBackbone:new Set(["P"])},6:{trace:new Set(["N4'","N4*"]),directionFrom:new Set(["N4'","N4*"]),directionTo:new Set(["C7'","C7*"]),backboneStart:new Set(["N1'","N1*"]),backboneEnd:new Set(["C'","C*"]),coarseBackbone:new Set(["P"])}},Y0=new Set(["CA","C","N","O","O1","O2","OC1","OC2","OT1","OT2","OX1","OXT","H","H1","H2","H3","HA","HN","HXT","BB"]),XR=new Set(["P","OP1","OP2","HOP2","HOP3","O2'","O3'","O4'","O5'","C1'","C2'","C3'","C4'","C5'","H1'","H2'","H2''","HO2'","H3'","H4'","H5'","H5''","HO3'","HO5'","O2*","O3*","O4*","O5*","C1*","C2*","C3*","C4*","C5*"]),gse=new Set(["d-peptide linking","d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","d-gamma-peptide, c-delta linking","d-beta-peptide, c-gamma linking"]),yse=new Set(["l-peptide linking","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus","l-gamma-peptide, c-delta linking","l-beta-peptide, c-gamma linking"]),h6e=new Set(["d-gamma-peptide, c-delta linking","l-gamma-peptide, c-delta linking"]),m6e=new Set(["d-beta-peptide, c-gamma linking","l-beta-peptide, c-gamma linking"]),g6e=new Set(["d-peptide nh3 amino terminus","d-peptide cooh carboxy terminus","l-peptide nh3 amino terminus","l-peptide cooh carboxy terminus"]),bse=new Set(["peptide linking","peptide-like"]),y6e=Lo.unionMany(gse,yse,bse),vse=new Set(["dna linking","l-dna linking","dna oh 5 prime terminus","dna oh 3 prime terminus"]),xse=new Set(["rna linking","l-rna linking","rna oh 5 prime terminus","rna oh 3 prime terminus"]),_se=Lo.unionMany(new Set(["d-saccharide, beta linking","l-saccharide, beta linking","d-saccharide, alpha linking","l-saccharide, alpha linking","l-saccharide","d-saccharide","saccharide"]),new Set(["d-saccharide 1,4 and 1,4 linking","l-saccharide 1,4 and 1,4 linking","d-saccharide 1,4 and 1,6 linking","l-saccharide 1,4 and 1,6 linking"])),b6e=new Set(["non-polymer","other"]),v6e=new Set(["ion"]),x6e=new Set(["lipid"]),KR=new Set(["SOL","WAT","HOH","H2O","W","DOD","D3O","TIP","TIP3","TIP4","SPC"]),ez=new Set(["HIS","ARG","LYS","ILE","PHE","LEU","TRP","ALA","MET","PRO","CYS","ASN","VAL","GLY","SER","GLN","TYR","ASP","GLU","THR","SEC","PYL","UNK","MSE","SEP","TPO","PTR","PCA","HYP","HSD","HSE","HSP","LSN","ASPP","GLUP","HID","HIE","HIP","LYN","ASH","GLH"]),Sse=new Set(["DAL","DAR","DSG","DAS","DCY","DGL","DGN","DHI","DIL","DLE","DLY","MED","DPN","DPR","DSN","DTH","DTR","DTY","DVA","DNE"]),A3=Lo.unionMany(ez,Sse),_6e=new Set(["NME","ACE","NH2","FOR","FMT"]),I3=new Set(["A","C","T","G","I","U","N"]),E3=new Set(["DA","DC","DT","DG","DI","DU","DN"]),tz=new Set(["APN","CPN","TPN","GPN"]),S6e=new Set(["A","G","I","DA","DG","DI","APN","GPN"]),C6e=new Set(["C","T","U","DC","DT","DU","CPN","TPN"]),ZR=Lo.unionMany(I3,E3,tz),w6e=e=>S6e.has(e.toUpperCase()),A6e=e=>C6e.has(e.toUpperCase()),yw=Lo.unionMany(A3,ZR);function x1(e,t){return t=t.toUpperCase(),tz.has(t)?8:y6e.has(e)?5:xse.has(e)?6:vse.has(e)?7:_se.has(e)?9:KR.has(t)?2:hse.has(t)?3:pse.has(t)?4:b6e.has(e)?$0.has(t)?9:A3.has(t)?5:I3.has(t)?6:E3.has(t)?7:1:0}function I6e(e,t){return 5===t?h6e.has(e)?2:m6e.has(e)?3:g6e.has(e)?0:1:6===t?4:7===t?5:8===t?6:0}function Cse(e){return e=e.toUpperCase(),A3.has(e)?"peptide linking":I3.has(e)?"rna linking":E3.has(e)?"dna linking":$0.has(e)?"saccharide":"other"}function T6e(e){return e=e.toUpperCase(),KR.has(e)?"water":yw.has(e)?"polymer":$0.has(e)?"branched":"non-polymer"}function D6e(e,t){return e=e.toUpperCase(),yse.has(t)?"polypeptide(L)":gse.has(t)?"polypeptide(D)":xse.has(t)?"polyribonucleotide":vse.has(t)?"polydeoxyribonucleotide":_se.has(t)||$0.has(e)?"oligosaccharide":tz.has(e)?"peptide nucleic acid":ez.has(e)?"polypeptide(L)":Sse.has(e)?"polypeptide(D)":I3.has(e)?"polyribonucleotide":E3.has(e)?"polydeoxyribonucleotide":v6e.has(t)||hse.has(e)?"ion":x6e.has(t)||pse.has(e)?"lipid":bse.has(t)?"peptide-like":"other"}function QR(e){return Fu(e)||wse(e)}function Fu(e){return 7===e||6===e||8===e}function wse(e){return 5===e}var pi,Lr;!function(e){e.is=Mc.has,e.create=Mc.create,e.SecondaryStructureMmcif={helx_lh_27_p:1058,helx_lh_3t_p:2082,helx_lh_al_p:4130,helx_lh_a_n:524321,helx_lh_b_n:1048609,helx_lh_ga_p:8226,helx_lh_n:33,helx_lh_om_p:16418,helx_lh_ot_n:131105,helx_lh_ot_p:546,helx_lh_p:34,helx_lh_pi_p:32802,helx_lh_pp_p:65570,helx_lh_z_n:262177,helx_n:1,helx_ot_n:1,helx_ot_p:2,helx_p:2,helx_rh_27_p:1090,helx_rh_3t_p:2114,helx_rh_al_p:4162,helx_rh_a_n:524353,helx_rh_b_n:1048641,helx_rh_ga_p:8258,helx_rh_n:65,helx_rh_om_p:16450,helx_rh_ot_n:131137,helx_rh_ot_p:578,helx_rh_p:66,helx_rh_pi_p:32834,helx_rh_pp_p:65602,helx_rh_z_n:262209,strn:4194308,turn_ot_p:33554448,turn_p:16,turn_ty1p_p:67109136,turn_ty1_p:67109008,turn_ty2p_p:134218e3,turn_ty2_p:134217872,turn_ty3p_p:268435728,turn_ty3_p:268435600,bend:8,other:0},e.SecondaryStructurePdb={1:4162,2:16450,3:32834,4:8258,5:2114,6:4130,7:16418,8:8226,9:1026,10:65538},e.SecondaryStructureStride={H:4098,G:2050,I:32770,E:8388612,B:4194308,T:16,C:536870912},e.SecondaryStructureDssp={H:4098,B:4194308,E:8388612,G:2050,I:32770,T:16,S:8}}(pi||(pi={})),function(e){function o(a){switch(a){case"covalent":return 1;case"metal-coordination":return 2;case"hydrogen-bond":return 4;case"disulfide":return 8;case"aromatic":return 16;case"computed":return 32}}e.is=Mc.has,e.create=function t(a){return Mc.create(a)},e.isCovalent=function n(a){return!!(1&a)},e.isAll=function r(a){return a===Math.pow(2,6)-1},e.Names={covalent:1,"metal-coordination":2,"hydrogen-bond":4,disulfide:8,aromatic:16,computed:32},e.isName=function i(a){return a in e.Names},e.fromName=o,e.fromNames=function s(a){let l=0;for(let c=0,u=a.length;c<u;++c)l|=o(a[c]);return l}}(Lr||(Lr={}));const nz={ALA:[.17,.5,.33],ARG:[.81,1.81,1],ASN:[.42,.85,.43],ASP:[1.23,3.64,2.41],ASH:[-.07,.43,.5],CYS:[-.24,-.02,.22],GLN:[.58,.77,.19],GLU:[2.02,3.63,1.61],GLH:[-.01,.11,.12],GLY:[.01,1.15,1.14],HIS:[.17,.11,-.06],ILE:[-.31,-1.12,-.81],LEU:[-.56,-1.25,-.69],LYS:[.99,2.8,1.81],MET:[-.23,-.67,-.44],PHE:[-1.13,-1.71,-.58],PRO:[.45,.14,-.31],SER:[.13,.46,.33],THR:[.14,.25,.11],TRP:[-1.85,-2.09,-.24],TYR:[-.94,-.71,.23],VAL:[.07,-.46,-.53],HSD:[.17,.11,-.06],HSE:[.17,.11,-.06],HSP:[.96,2.33,1.37],HID:[.17,.11,-.06],HIE:[.17,.11,-.06],HIP:[.96,2.33,1.37]},P6e=C.add,k6e=C.squaredDistance,M6e=C.distance;class X0{reset(){C.set(this.center,0,0,0),this.radiusSq=0,this.count=0}includeStep(t){P6e(this.center,this.center,t),this.count++}finishedIncludeStep(){0!==this.count&&C.scale(this.center,this.center,1/this.count)}radiusStep(t){const n=k6e(t,this.center);n>this.radiusSq&&(this.radiusSq=n)}radiusSphereStep(t,n){const r=M6e(t,this.center)+n,i=r*r;i>this.radiusSq&&(this.radiusSq=i)}getSphere(t){return t||(t=ke()),C.copy(t.center,this.center),t.radius=Math.sqrt(this.radiusSq),t}getCount(){return this.count}constructor(){this.count=0,this.center=C(),this.radiusSq=0}}!function(e){const t=new e,n=C(),r=C();e.fromArrays=function i({x:a,y:l,z:c},u){t.reset();const d=a.length;for(let f=0;f<d;f++)C.set(n,a[f],l[f],c[f]),t.includeStep(n);t.finishedIncludeStep();for(let f=0;f<d;f++)C.set(n,a[f],l[f],c[f]),t.radiusStep(n);return C.copy(u.center,t.center),u.radius=Math.sqrt(t.radiusSq),u},e.fromProvider=function o(a,l,c){t.reset();for(let u=0;u<a;u++)l(u,n),t.includeStep(n);t.finishedIncludeStep();for(let u=0;u<a;u++)l(u,n),t.radiusStep(n);return C.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c},e.fromPairProvider=function s(a,l,c){t.reset();for(let u=0;u<a;u++)l(u,n,r),t.includeStep(n),t.includeStep(r);t.finishedIncludeStep();for(let u=0;u<a;u++)l(u,n,r),t.radiusStep(n),t.radiusStep(r);return C.copy(c.center,t.center),c.radius=Math.sqrt(t.radiusSq),c}}(X0||(X0={}));class dp{getConnectedUnits(t){return this.map.has(t)?this.map.get(t):Ase}getEdgeIndex(t,n,r,i){const o=dp.getEdgeKey(t,n,r,i),s=this.edgeKeyIndex.get(o);return void 0!==s?s:-1}hasEdge(t,n,r,i){return-1!==this.getEdgeIndex(t,n,r,i)}getEdge(t,n,r,i){const o=this.getEdgeIndex(t,n,r,i);return-1!==o?this.edges[o]:void 0}getEdgeIndices(t,n){return this.vertexKeyIndex.get(dp.getVertexKey(t,n))||[]}constructor(t){this.map=t;let n=0;const r=[],i=new Map,o=new Map;this.map.forEach(s=>{s.forEach(a=>{n+=a.edgeCount,a.connectedIndices.forEach(l=>{a.getEdges(l).forEach(c=>{const{unitA:u,unitB:d}=a,f=dp.getEdgeKey(l,u,c.indexB,d);i.set(f,r.length);const p=dp.getVertexKey(l,u),m=o.get(p);void 0===m?o.set(p,[r.length]):m.push(r.length),r.push({...c,indexA:l,unitA:u,unitB:d})})})})}),this.edgeCount=n,this.edges=r,this.edgeKeyIndex=i,this.vertexKeyIndex=o}}!function(e){class t{hasEdges(a){return this.edgeMap.has(a)}getEdges(a){return this.edgeMap.has(a)?this.edgeMap.get(a):Ase}get areUnitsOrdered(){return this.unitA<this.unitB}constructor(a,l,c,u,d){this.unitA=a,this.unitB=l,this.edgeCount=c,this.connectedIndices=u,this.edgeMap=d}}function i(s,a,l){s.has(a)?s.get(a).push(l):s.set(a,[l])}e.UnitPairEdges=t,e.getEdgeKey=function n(s,a,l,c){return`${s}|${a}|${l}|${c}`},e.getVertexKey=function r(s,a){return`${s}|${a}`},e.Builder=class o{constructor(){this.map=new Map}startUnitPair(a,l){this.uA=a,this.uB=l,this.mapAB=new Map,this.mapBA=new Map,this.linkedA=Ti.create(),this.linkedB=Ti.create(),this.linkCount=0}finishUnitPair(){0!==this.linkCount&&(i(this.map,this.uA,new t(this.uA,this.uB,this.linkCount,this.linkedA.array,this.mapAB)),i(this.map,this.uB,new t(this.uB,this.uA,this.linkCount,this.linkedB.array,this.mapBA)))}add(a,l,c){i(this.mapAB,a,{indexB:l,props:c}),i(this.mapBA,l,{indexB:a,props:c}),Ti.add(this.linkedA,a,a),Ti.add(this.linkedB,l,l),this.linkCount+=1}getMap(){return this.map}}}(dp||(dp={}));const Ase=[];var rz;!function(e){e.Empty=Cd.create([],[],[],0,{flags:[],order:[],key:[]})}(rz||(rz={}));class T3 extends dp{getBondFromLocation(t){return ze.isAtomic(t.aUnit)&&ze.isAtomic(t.bUnit)?this.getEdge(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):void 0}getBondIndexFromLocation(t){return ze.isAtomic(t.aUnit)&&ze.isAtomic(t.bUnit)?this.getEdgeIndex(t.aIndex,t.aUnit.id,t.bIndex,t.bUnit.id):-1}}!function(e){e.UnitPairBonds=class t extends dp.UnitPairEdges{}}(T3||(T3={}));const Ise={forceCompute:!1,noCompute:!1,maxRadius:4},iz={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109},R6e={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:2,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88},N6e={0:.8,20:1.31,27:1.2,35:1.15,44:1.1,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.6,113:1.59,114:1.36,129:1.45,135:1.47,144:1.6,152:1.45,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,316:1.8,420:2.37,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81},Ese=2.001,D3=function(){const e=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"],t=new Set;for(const n of e)t.add(iz[n]);return t}();function ig(e){const t=iz[e];return void 0===t?-1:t}function _1(e){if(e<0)return Ese;const t=R6e[e];return void 0===t?Ese:t}function JR(e,t,n,r){const i=function O6e(e,t){if(e<0||t<0)return-1;const n=N6e[function F6e(e,t){return e<t?(e+t)*(e+t+1)/2+t:(e+t)*(e+t+1)/2+e}(e,t)];return void 0===n?-1:n}(e,t);return i>0?i:t<0?n:(n+r)/1.95}const B6e=iz.H;function K0(e){return e===B6e}const L6e=new Map([["HIS|CD2|CG",2],["HIS|CE1|ND1",2],["ARG|CZ|NH2",2],["PHE|CE1|CZ",2],["PHE|CD2|CE2",2],["PHE|CD1|CG",2],["TRP|CD1|CG",2],["TRP|CD2|CE2",2],["TRP|CE3|CZ3",2],["TRP|CH2|CZ2",2],["ASN|CG|OD1",2],["GLN|CD|OE1",2],["TYR|CD1|CG",2],["TYR|CD2|CE2",2],["TYR|CE1|CZ",2],["ASP|CG|OD1",2],["GLU|CD|OE1",2],["G|C8|N7",2],["G|C4|C5",2],["G|C2|N3",2],["G|C6|O6",2],["C|C4|N3",2],["C|C5|C6",2],["C|C2|O2",2],["A|C2|N3",2],["A|C6|N1",2],["A|C4|C5",2],["A|C8|N7",2],["U|C5|C6",2],["U|C2|O2",2],["U|C4|O4",2],["DG|C8|N7",2],["DG|C4|C5",2],["DG|C2|N3",2],["DG|C6|O6",2],["DC|C4|N3",2],["DC|C5|C6",2],["DC|C2|O2",2],["DA|C2|N3",2],["DA|C6|N1",2],["DA|C4|C5",2],["DA|C8|N7",2],["DT|C5|C6",2],["DT|C2|O2",2],["DT|C4|O4",2]]);function j6e(e,t,n){return[t,n]=t<n?[t,n]:[n,t],A3.has(e)&&"C"===t&&"O"===n||ZR.has(e)&&"OP1"===t&&"P"===n?2:L6e.get(`${e}|${t}|${n}`)||1}const U6e=new Map([["LYS|NZ|RET|C15",2]]);function Tse(e,t,n,r){return e>n&&([e,n]=[n,e],[t,r]=[r,t]),U6e.get(`${e}|${t}|${n}|${r}`)||1}var Z0=ce.Schema;const de=Z0.str,Le=Z0.int,dr=Z0.float,oz=Z0.coord,Kt=Z0.Aliased,S1=Z0.Matrix,e5=Z0.Vector,Ii=Z0.lstr,e_=Z0.List,Nr={atom_site:{auth_asym_id:de,auth_atom_id:de,auth_comp_id:de,auth_seq_id:Le,B_iso_or_equiv:dr,Cartn_x:oz,Cartn_y:oz,Cartn_z:oz,group_PDB:Kt(de),id:Le,label_alt_id:de,label_asym_id:de,label_atom_id:de,label_comp_id:de,label_entity_id:de,label_seq_id:Le,occupancy:dr,type_symbol:de,pdbx_PDB_ins_code:de,pdbx_PDB_model_num:Le,pdbx_formal_charge:Le,pdbx_label_index:Le,pdbx_sifts_xref_db_name:de,pdbx_sifts_xref_db_acc:de,pdbx_sifts_xref_db_num:de,pdbx_sifts_xref_db_res:de,ihm_model_id:Le},atom_site_anisotrop:{id:Le,type_symbol:de,U:S1(3,3),U_esd:S1(3,3),pdbx_auth_seq_id:de,pdbx_auth_asym_id:de,pdbx_auth_atom_id:de,pdbx_auth_comp_id:de,pdbx_label_seq_id:Le,pdbx_label_alt_id:de,pdbx_label_asym_id:de,pdbx_label_atom_id:de,pdbx_label_comp_id:de,pdbx_PDB_ins_code:de},atom_sites:{entry_id:de,fract_transf_matrix:S1(3,3),fract_transf_vector:e5(3)},audit_author:{name:de,pdbx_ordinal:Le,identifier_ORCID:de},audit_conform:{dict_location:de,dict_name:de,dict_version:de},cell:{angle_alpha:dr,angle_beta:dr,angle_gamma:dr,entry_id:de,length_a:dr,length_b:dr,length_c:dr,Z_PDB:Le,pdbx_unique_axis:de},chem_comp:{formula:de,formula_weight:dr,id:de,mon_nstd_flag:Kt(Ii),name:de,type:Kt(Ii),pdbx_synonyms:e_(";",e=>e)},chem_comp_bond:{atom_id_1:de,atom_id_2:de,comp_id:de,value_order:Kt(Ii),pdbx_ordinal:Le,pdbx_stereo_config:Kt(Ii),pdbx_aromatic_flag:Kt(Ii)},citation:{book_publisher:de,country:de,id:de,journal_abbrev:de,journal_id_ASTM:de,journal_id_CSD:de,journal_id_ISSN:de,journal_volume:de,page_first:de,page_last:de,title:de,year:Le,pdbx_database_id_DOI:de,pdbx_database_id_PubMed:Le},citation_author:{citation_id:de,name:de,ordinal:Le},database_2:{database_id:Kt(Ii),database_code:de},entity:{details:de,formula_weight:dr,id:de,src_method:Kt(Ii),type:Kt(Ii),pdbx_description:e_(",",e=>e),pdbx_number_of_molecules:Le,pdbx_mutation:de,pdbx_fragment:de,pdbx_ec:e_(",",e=>e)},entity_poly:{entity_id:de,nstd_linkage:Kt(Ii),nstd_monomer:Kt(Ii),type:Kt(de),pdbx_strand_id:e_(",",e=>e),pdbx_seq_one_letter_code:de,pdbx_seq_one_letter_code_can:de,pdbx_target_identifier:de},entity_poly_seq:{entity_id:de,hetero:Kt(Ii),mon_id:de,num:Le},entry:{id:de},exptl:{entry_id:de,method:Kt(de)},software:{classification:de,date:de,description:de,name:de,type:Kt(Ii),version:de,pdbx_ordinal:Le},struct:{entry_id:de,title:de,pdbx_descriptor:de},struct_asym:{details:de,entity_id:de,id:de,pdbx_modified:de,pdbx_blank_PDB_chainid_flag:Kt(de)},struct_conf:{beg_label_asym_id:de,beg_label_comp_id:de,beg_label_seq_id:Le,beg_auth_asym_id:de,beg_auth_comp_id:de,beg_auth_seq_id:Le,conf_type_id:Kt(Ii),details:de,end_label_asym_id:de,end_label_comp_id:de,end_label_seq_id:Le,end_auth_asym_id:de,end_auth_comp_id:de,end_auth_seq_id:Le,id:de,pdbx_beg_PDB_ins_code:de,pdbx_end_PDB_ins_code:de,pdbx_PDB_helix_class:de,pdbx_PDB_helix_length:Le,pdbx_PDB_helix_id:de},struct_conn:{conn_type_id:Kt(Ii),details:de,id:de,ptnr1_label_asym_id:de,ptnr1_label_atom_id:de,ptnr1_label_comp_id:de,ptnr1_label_seq_id:Le,ptnr1_auth_asym_id:de,ptnr1_auth_comp_id:de,ptnr1_auth_seq_id:Le,ptnr1_symmetry:de,ptnr2_label_asym_id:de,ptnr2_label_atom_id:de,ptnr2_label_comp_id:de,ptnr2_label_seq_id:Le,ptnr2_auth_asym_id:de,ptnr2_auth_comp_id:de,ptnr2_auth_seq_id:Le,ptnr2_symmetry:de,pdbx_ptnr1_PDB_ins_code:de,pdbx_ptnr1_label_alt_id:de,pdbx_ptnr1_standard_comp_id:de,pdbx_ptnr2_PDB_ins_code:de,pdbx_ptnr2_label_alt_id:de,pdbx_ptnr3_PDB_ins_code:de,pdbx_ptnr3_label_alt_id:de,pdbx_ptnr3_label_asym_id:de,pdbx_ptnr3_label_atom_id:de,pdbx_ptnr3_label_comp_id:de,pdbx_ptnr3_label_seq_id:Le,pdbx_PDB_id:de,pdbx_dist_value:dr,pdbx_value_order:Kt(Ii)},struct_conn_type:{criteria:de,id:Kt(Ii),reference:de},struct_keywords:{entry_id:de,text:e_(",",e=>e),pdbx_keywords:de},struct_ncs_oper:{code:Kt(de),details:de,id:Le,matrix:S1(3,3),vector:e5(3)},struct_sheet_range:{beg_label_asym_id:de,beg_label_comp_id:de,beg_label_seq_id:Le,end_label_asym_id:de,end_label_comp_id:de,end_label_seq_id:Le,beg_auth_asym_id:de,beg_auth_comp_id:de,beg_auth_seq_id:Le,end_auth_asym_id:de,end_auth_comp_id:de,end_auth_seq_id:Le,id:de,sheet_id:de,pdbx_beg_PDB_ins_code:de,pdbx_end_PDB_ins_code:de},struct_site:{details:de,id:de,pdbx_num_residues:Le,pdbx_evidence_code:de,pdbx_auth_asym_id:de,pdbx_auth_comp_id:de,pdbx_auth_seq_id:de,pdbx_auth_ins_code:de},struct_site_gen:{details:de,id:de,label_alt_id:de,label_asym_id:de,label_atom_id:de,label_comp_id:de,label_seq_id:Le,auth_asym_id:de,auth_comp_id:de,auth_seq_id:de,site_id:de,symmetry:de,pdbx_auth_ins_code:de,pdbx_num_res:Le},symmetry:{entry_id:de,cell_setting:Kt(Ii),Int_Tables_number:Le,space_group_name_Hall:de,"space_group_name_H-M":de},pdbx_database_status:{status_code:Kt(de),status_code_sf:Kt(de),status_code_mr:Kt(de),entry_id:de,recvd_initial_deposition_date:de,SG_entry:Kt(Ii),deposit_site:Kt(de),process_site:Kt(de),status_code_cs:Kt(de),methods_development_category:Kt(de),pdb_format_compatible:Kt(Ii)},pdbx_nonpoly_scheme:{asym_id:de,entity_id:de,mon_id:de,pdb_strand_id:de,ndb_seq_num:de,pdb_seq_num:de,auth_seq_num:de,pdb_mon_id:de,auth_mon_id:de,pdb_ins_code:de},pdbx_database_related:{db_name:de,details:de,db_id:de,content_type:Kt(de)},pdbx_entity_nonpoly:{entity_id:de,comp_id:de,name:de},pdbx_chem_comp_synonyms:{name:de,comp_id:de,provenance:Kt(de)},pdbx_chem_comp_identifier:{comp_id:de,identifier:de,type:Kt(de),program:de,program_version:de},pdbx_unobs_or_zero_occ_residues:{id:Le,polymer_flag:Kt(Ii),occupancy_flag:Kt(Le),PDB_model_num:Le,auth_asym_id:de,auth_comp_id:de,auth_seq_id:de,PDB_ins_code:de,label_asym_id:de,label_comp_id:de,label_seq_id:Le},pdbx_struct_mod_residue:{id:Le,auth_asym_id:de,auth_comp_id:de,auth_seq_id:Le,PDB_ins_code:de,label_asym_id:de,label_comp_id:de,label_seq_id:Le,parent_comp_id:de,details:de},pdbx_struct_oper_list:{id:de,type:Kt(de),name:de,symmetry_operation:de,matrix:S1(3,3),vector:e5(3)},pdbx_struct_assembly:{method_details:de,oligomeric_details:de,oligomeric_count:Le,details:de,id:de},pdbx_struct_assembly_gen:{asym_id_list:e_(",",e=>e),assembly_id:de,oper_expression:de},pdbx_reference_entity_list:{prd_id:de,ref_entity_id:de,type:Kt(Ii),details:de,component_id:Le},pdbx_reference_entity_link:{link_id:Le,prd_id:de,details:de,ref_entity_id_1:de,ref_entity_id_2:de,entity_seq_num_1:Le,entity_seq_num_2:Le,comp_id_1:de,comp_id_2:de,atom_id_1:de,atom_id_2:de,value_order:Kt(Ii),component_1:Le,component_2:Le,link_class:Kt(de)},pdbx_reference_entity_poly_link:{link_id:Le,prd_id:de,ref_entity_id:de,component_id:Le,entity_seq_num_1:Le,entity_seq_num_2:Le,comp_id_1:de,comp_id_2:de,atom_id_1:de,atom_id_2:de,value_order:Kt(Ii)},pdbx_molecule:{prd_id:de,instance_id:Le,asym_id:de},pdbx_molecule_features:{prd_id:de,class:Kt(Ii),type:Kt(Ii),name:de,details:de},entity_src_nat:{entity_id:de,pdbx_organism_scientific:de,pdbx_plasmid_name:de,pdbx_src_id:Le,pdbx_beg_seq_num:Le,pdbx_end_seq_num:Le},entity_src_gen:{entity_id:de,pdbx_gene_src_gene:e_(",",e=>e),pdbx_gene_src_scientific_name:de,plasmid_name:de,pdbx_src_id:Le,pdbx_beg_seq_num:Le,pdbx_end_seq_num:Le},pdbx_entity_src_syn:{organism_scientific:de,entity_id:de,pdbx_src_id:Le,pdbx_beg_seq_num:Le,pdbx_end_seq_num:Le},pdbx_entity_branch_descriptor:{entity_id:de,descriptor:de,type:Kt(Ii),program:de,program_version:de,ordinal:Le},pdbx_entity_instance_feature:{details:de,feature_type:Kt(de),auth_asym_id:de,asym_id:de,auth_seq_num:de,seq_num:Le,comp_id:de,auth_comp_id:de,ordinal:Le},pdbx_entity_branch_list:{entity_id:de,hetero:Kt(Ii),comp_id:de,num:Le},pdbx_entity_branch_link:{link_id:Le,details:de,entity_id:de,entity_branch_list_num_1:Le,entity_branch_list_num_2:Le,comp_id_1:de,comp_id_2:de,atom_id_1:de,leaving_atom_id_1:de,atom_stereo_config_1:Kt(Ii),atom_id_2:de,leaving_atom_id_2:de,atom_stereo_config_2:Kt(Ii),value_order:Kt(Ii)},pdbx_entity_branch:{entity_id:de,type:Kt(de)},pdbx_branch_scheme:{entity_id:de,hetero:Kt(Ii),asym_id:de,mon_id:de,num:Le,pdb_asym_id:de,pdb_seq_num:de,pdb_mon_id:de,auth_asym_id:de,auth_seq_num:de,auth_mon_id:de},pdbx_chem_comp_related:{comp_id:de,related_comp_id:de,relationship_type:Kt(de),details:de},ihm_starting_model_details:{starting_model_id:de,entity_id:de,entity_description:de,asym_id:de,entity_poly_segment_id:Le,starting_model_source:Kt(de),starting_model_auth_asym_id:de,starting_model_sequence_offset:Le,dataset_list_id:Le},ihm_starting_comparative_models:{id:Le,starting_model_id:de,starting_model_auth_asym_id:de,starting_model_seq_id_begin:Le,starting_model_seq_id_end:Le,template_auth_asym_id:de,template_seq_id_begin:Le,template_seq_id_end:Le,template_sequence_identity:dr,template_sequence_identity_denominator:Kt(Le),template_dataset_list_id:Le,alignment_file_id:Le},ihm_starting_model_seq_dif:{id:Le,entity_id:de,asym_id:de,seq_id:Le,comp_id:de,starting_model_id:de,db_asym_id:de,db_seq_id:Le,db_comp_id:de,details:de},ihm_model_representation:{id:Le,name:de,details:de},ihm_model_representation_details:{id:Le,representation_id:Le,entity_poly_segment_id:Le,entity_id:de,entity_description:de,entity_asym_id:de,model_object_primitive:Kt(de),starting_model_id:de,model_mode:Kt(de),model_granularity:Kt(de),model_object_count:Le},ihm_struct_assembly_details:{id:Le,assembly_id:Le,parent_assembly_id:Le,entity_description:de,entity_id:de,asym_id:de,entity_poly_segment_id:Le},ihm_struct_assembly:{id:Le,name:de,description:de},ihm_modeling_protocol:{id:Le,num_steps:Le,protocol_name:de},ihm_modeling_protocol_details:{id:Le,protocol_id:Le,step_id:Le,struct_assembly_id:Le,dataset_group_id:Le,struct_assembly_description:de,step_name:de,step_method:de,num_models_begin:Le,num_models_end:Le,multi_scale_flag:Kt(Ii),multi_state_flag:Kt(Ii),ordered_flag:Kt(Ii),script_file_id:Le,software_id:Le},ihm_multi_state_modeling:{state_id:Le,state_group_id:Le,population_fraction:dr,population_fraction_sd:dr,state_type:de,state_name:de,experiment_type:Kt(de),details:de},ihm_modeling_post_process:{id:Le,protocol_id:Le,analysis_id:Le,step_id:Le,type:Kt(de),feature:Kt(de),num_models_begin:Le,num_models_end:Le},ihm_ensemble_info:{ensemble_id:Le,ensemble_name:de,post_process_id:Le,model_group_id:Le,ensemble_clustering_method:Kt(de),ensemble_clustering_feature:Kt(de),num_ensemble_models:Le,num_ensemble_models_deposited:Le,ensemble_precision_value:dr,ensemble_file_id:Le},ihm_model_list:{model_id:Le,model_name:de,assembly_id:Le,protocol_id:Le,representation_id:Le},ihm_model_group:{id:Le,name:de,details:de},ihm_model_group_link:{model_id:Le,group_id:Le},ihm_model_representative:{id:Le,model_group_id:Le,model_id:Le,selection_criteria:Kt(de)},ihm_dataset_list:{id:Le,data_type:Kt(de),database_hosted:Kt(Ii)},ihm_dataset_group:{id:Le,name:de,application:Kt(de),details:de},ihm_dataset_group_link:{dataset_list_id:Le,group_id:Le},ihm_related_datasets:{dataset_list_id_derived:Le,dataset_list_id_primary:Le},ihm_dataset_related_db_reference:{id:Le,dataset_list_id:Le,db_name:Kt(de),accession_code:de,version:de,details:de},ihm_external_reference_info:{reference_id:Le,reference_provider:de,reference_type:Kt(de),reference:de,refers_to:Kt(de),associated_url:de},ihm_external_files:{id:Le,reference_id:Le,file_path:de,content_type:Kt(de),file_size_bytes:dr,details:de},ihm_dataset_external_reference:{id:Le,dataset_list_id:Le,file_id:Le},ihm_localization_density_files:{id:Le,file_id:Le,ensemble_id:Le,entity_id:de,entity_poly_segment_id:Le,asym_id:de},ihm_predicted_contact_restraint:{id:Le,group_id:Le,entity_id_1:de,entity_id_2:de,asym_id_1:de,asym_id_2:de,comp_id_1:de,comp_id_2:de,seq_id_1:Le,seq_id_2:Le,rep_atom_1:Kt(de),rep_atom_2:Kt(de),distance_lower_limit:dr,distance_upper_limit:dr,probability:dr,restraint_type:Kt(de),model_granularity:Kt(de),dataset_list_id:Le,software_id:Le},ihm_cross_link_list:{id:Le,group_id:Le,entity_description_1:de,entity_description_2:de,entity_id_1:de,entity_id_2:de,comp_id_1:de,comp_id_2:de,seq_id_1:Le,seq_id_2:Le,linker_type:Kt(de),dataset_list_id:Le},ihm_cross_link_restraint:{id:Le,group_id:Le,entity_id_1:de,entity_id_2:de,asym_id_1:de,asym_id_2:de,comp_id_1:de,comp_id_2:de,seq_id_1:Le,seq_id_2:Le,atom_id_1:de,atom_id_2:de,restraint_type:Kt(de),conditional_crosslink_flag:Kt(de),model_granularity:Kt(de),distance_threshold:dr,psi:dr,sigma_1:dr,sigma_2:dr},ihm_cross_link_result_parameters:{id:Le,restraint_id:Le,model_id:Le,psi:dr,sigma_1:dr,sigma_2:dr},ihm_2dem_class_average_restraint:{id:Le,dataset_list_id:Le,number_raw_micrographs:Le,pixel_size_width:dr,pixel_size_height:dr,image_resolution:dr,image_segment_flag:Kt(Ii),number_of_projections:Le,struct_assembly_id:Le,details:de},ihm_2dem_class_average_fitting:{id:Le,restraint_id:Le,model_id:Le,cross_correlation_coefficient:dr,rot_matrix:S1(3,3),tr_vector:e5(3)},ihm_3dem_restraint:{id:Le,dataset_list_id:Le,model_id:Le,struct_assembly_id:Le,fitting_method:de,number_of_gaussians:Le,cross_correlation_coefficient:dr},ihm_sas_restraint:{id:Le,dataset_list_id:Le,model_id:Le,struct_assembly_id:Le,profile_segment_flag:Kt(Ii),fitting_atom_type:de,fitting_method:de,fitting_state:Kt(de),radius_of_gyration:dr,chi_value:dr,details:de},ihm_starting_model_coord:{ordinal_id:Le,starting_model_id:de,group_PDB:Kt(de),id:Le,type_symbol:de,entity_id:de,atom_id:de,comp_id:de,seq_id:Le,asym_id:de,Cartn_x:dr,Cartn_y:dr,Cartn_z:dr,B_iso_or_equiv:dr},ihm_sphere_obj_site:{id:Le,entity_id:de,seq_id_begin:Le,seq_id_end:Le,asym_id:de,Cartn_x:dr,Cartn_y:dr,Cartn_z:dr,object_radius:dr,rmsf:dr,model_id:Le},ihm_gaussian_obj_site:{id:Le,entity_id:de,seq_id_begin:Le,seq_id_end:Le,asym_id:de,mean_Cartn_x:dr,mean_Cartn_y:dr,mean_Cartn_z:dr,weight:dr,covariance_matrix:S1(3,3),model_id:Le},ihm_gaussian_obj_ensemble:{id:Le,entity_id:de,seq_id_begin:Le,seq_id_end:Le,asym_id:de,mean_Cartn_x:dr,mean_Cartn_y:dr,mean_Cartn_z:dr,weight:dr,covariance_matrix:S1(3,3),ensemble_id:Le},ihm_feature_list:{feature_id:Le,feature_type:Kt(de),entity_type:Kt(de)},ihm_poly_residue_feature:{ordinal_id:Le,feature_id:Le,entity_id:de,asym_id:de,comp_id_begin:de,comp_id_end:de,seq_id_begin:Le,seq_id_end:Le},ihm_derived_distance_restraint:{id:Le,group_id:Le,feature_id_1:Le,feature_id_2:Le,group_conditionality:Kt(de),random_exclusion_fraction:dr,distance_upper_limit:dr,restraint_type:Kt(de),dataset_list_id:Le},ma_model_list:{ordinal_id:Le,model_id:Le,model_group_id:Le,model_name:de,model_group_name:de,model_type:Kt(de),data_id:Le},ma_target_entity:{entity_id:de,data_id:Le,origin:Kt(de)},ma_target_entity_instance:{asym_id:de,entity_id:de,details:de},ma_target_ref_db_details:{target_entity_id:de,db_name:Kt(de),db_code:de,db_accession:de,seq_db_isoform:de,seq_db_align_begin:de,seq_db_align_end:de,ncbi_taxonomy_id:de,organism_scientific:de},ma_data:{id:Le,content_type:Kt(de),content_type_other_details:de,name:de},ma_software_group:{ordinal_id:Le,group_id:Le,software_id:Le},ma_qa_metric:{id:Le,name:de,type:Kt(de),mode:Kt(de),software_group_id:Le},ma_qa_metric_global:{ordinal_id:Le,model_id:Le,metric_id:Le,metric_value:dr},ma_qa_metric_local:{ordinal_id:Le,model_id:Le,label_asym_id:de,label_seq_id:Le,label_comp_id:de,metric_id:Le,metric_value:dr}};var ni;!function(e){let t;var o;let n;(o=t=e.IntDataType||(e.IntDataType={}))[o.Int8=1]="Int8",o[o.Int16=2]="Int16",o[o.Int32=3]="Int32",o[o.Uint8=4]="Uint8",o[o.Uint16=5]="Uint16",o[o.Uint32=6]="Uint32",function(o){o[o.Float32=32]="Float32",o[o.Float64=33]="Float64"}(n=e.FloatDataType||(e.FloatDataType={})),e.getDataType=function r(o){let s;return s=o instanceof Int8Array?e.IntDataType.Int8:o instanceof Int16Array?e.IntDataType.Int16:o instanceof Int32Array?e.IntDataType.Int32:o instanceof Uint8Array?e.IntDataType.Uint8:o instanceof Uint16Array?e.IntDataType.Uint16:o instanceof Uint32Array?e.IntDataType.Uint32:o instanceof Float32Array?e.FloatDataType.Float32:o instanceof Float64Array?e.FloatDataType.Float64:e.IntDataType.Int32,s},e.isSignedIntegerDataType=function i(o){if(o instanceof Int8Array||o instanceof Int16Array||o instanceof Int32Array)return!0;for(let s=0,a=o.length;s<a;s++)if(s<0)return!1;return!0}}(ni||(ni={}));const V6e=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0];function t5(e){let t=e.data;for(let n=e.encoding.length-1;n>=0;n--)t=q6e(t,e.encoding[n]);return t}function q6e(e,t){switch(t.kind){case"ByteArray":switch(t.type){case ni.IntDataType.Uint8:return e;case ni.IntDataType.Int8:return function W6e(e){return new Int8Array(e.buffer,e.byteOffset)}(e);case ni.IntDataType.Int16:return function $6e(e){return bw(e,2,Int16Array)}(e);case ni.IntDataType.Uint16:return function Y6e(e){return bw(e,2,Uint16Array)}(e);case ni.IntDataType.Int32:return function X6e(e){return bw(e,4,Int32Array)}(e);case ni.IntDataType.Uint32:return function K6e(e){return bw(e,4,Uint32Array)}(e);case ni.FloatDataType.Float32:return function Z6e(e){return bw(e,4,Float32Array)}(e);case ni.FloatDataType.Float64:return function Q6e(e){return bw(e,8,Float64Array)}(e);default:Hi()}case"FixedPoint":return function J6e(e,t){const n=e.length,r=Pse(t.srcType,n),i=1/t.factor;for(let o=0;o<n;o++)r[o]=i*e[o];return r}(e,t);case"IntervalQuantization":return function e8e(e,t){const n=e.length,r=Pse(t.srcType,n),i=(t.max-t.min)/(t.numSteps-1),o=t.min;for(let s=0;s<n;s++)r[s]=o+i*e[s];return r}(e,t);case"RunLength":return function t8e(e,t){const n=Dse(t.srcType,t.srcSize);let r=0;for(let i=0,o=e.length;i<o;i+=2){const s=e[i],a=e[i+1];for(let l=0;l<a;++l)n[r++]=s}return n}(e,t);case"Delta":return function n8e(e,t){const n=e.length,r=Dse(t.srcType,n);if(!n)return e;r[0]=e[0]+(0|t.origin);for(let i=1;i<n;++i)r[i]=e[i]+r[i-1];return r}(e,t);case"IntegerPacking":return function o8e(e,t){return e.length===t.srcSize?e:t.isUnsigned?function i8e(e,t){const n=1===t.byteCount?255:65535,r=e.length,i=new Int32Array(t.srcSize);let o=0,s=0;for(;o<r;){let a=0,l=e[o];for(;l===n;)a+=l,o++,l=e[o];a+=l,i[s]=a,o++,s++}return i}(e,t):function r8e(e,t){const n=1===t.byteCount?127:32767,r=-n-1,i=e.length,o=new Int32Array(t.srcSize);let s=0,a=0;for(;s<i;){let l=0,c=e[s];for(;c===n||c===r;)l+=c,s++,c=e[s];l+=c,o[a]=l,s++,a++}return o}(e,t)}(e,t);case"StringArray":return function s8e(e,t){const n=t5({encoding:t.offsetEncoding,data:t.offsets}),r=t5({encoding:t.dataEncoding,data:e}),i=t.stringData,o=new Array(n.length);o[0]="";for(let l=1,c=n.length;l<c;l++)o[l]=i.substring(n[l-1],n[l]);let s=0;const a=new Array(r.length);for(let l=0,c=r.length;l<c;l++)a[s++]=o[r[l]+1];return a}(e,t)}}function Dse(e,t){switch(e){case ni.IntDataType.Int8:return new Int8Array(t);case ni.IntDataType.Int16:return new Int16Array(t);case ni.IntDataType.Int32:return new Int32Array(t);case ni.IntDataType.Uint8:return new Uint8Array(t);case ni.IntDataType.Uint16:return new Uint16Array(t);case ni.IntDataType.Uint32:return new Uint32Array(t);default:return new Int32Array(t)}}function Pse(e,t){return e===ni.FloatDataType.Float32?new Float32Array(t):new Float64Array(t)}function bw(e,t,n){return new n(V6e?e.buffer:function H6e(e,t){const n=new ArrayBuffer(e.length),r=new Uint8Array(n);for(let i=0,o=e.length;i<o;i+=t)for(let s=0;s<t;s++)r[i+t-s-1]=e[i+s];return n}(e,t))}function a8e(e,t,n){let i,r=1;for(i=0;i<t;i++){const o=r*e;if(Math.abs(Math.round(o)-o)<=n)return i;r*=10}return-1}function n5(e){if(!isFinite(e))return 0;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,++n;return n}function az(e,t){return parseFloat(e.toPrecision(t))}function lz(e){return P3.classify(e)}var P3,cz,C1,Fr,uz,bf,dz;!function(e){function t(p,m){return p>=0?Math.ceil((p+1)/m):Math.ceil((p+1)/(-m-1))}function i({limit8:p,limit16:m},h,g){h.pack8+=t(g,p),h.pack16+=t(g,m),h.count+=1}function o(p,m){p.pack8+=t(m,127),p.pack16+=t(m,32767),p.count+=1}function s(p){return 4*p.count<2*p.pack16?{length:4*p.count,elem:4}:2*p.pack16<p.pack8?{length:2*p.pack16,elem:2}:{length:p.pack8,elem:1}}function a(p,m){const h={pack8:0,pack16:0,count:0};for(let g=0,y=p.length;g<y;g++)i(m,h,p[g]);return{...s(h),kind:"pack"}}function l(p,m){const h={pack8:0,pack16:0,count:0};let g=p[0];for(let y=1,v=p.length;y<v;y++)o(h,p[y]-g),g=p[y];return{...s(h),kind:"delta"}}function c(p,m){const h={pack8:0,pack16:0,count:0};let g=1;for(let y=1,v=p.length;y<v;y++)p[y-1]!==p[y]?(i(m,h,p[y-1]),i(m,h,g),g=1):g++;return i(m,h,p[p.length-1]),i(m,h,g),{...s(h),kind:"rle"}}function u(p,m){const h={pack8:0,pack16:0,count:0};let g=1,y=0,v=0;for(let x=1,_=p.length;x<_;x++){const w=p[x]-y;v!==w?(o(h,v),o(h,g),g=1):g++,v=w,y=p[x]}return o(h,v),o(h,g),{...s(h),kind:"delta-rle"}}function d(p){const m=function n(p){let m=!1;for(let h=0,g=p.length;h<g;h++)if(p[h]<0){m=!0;break}return m?{signed:m,limit8:127,limit16:32767}:{signed:m,limit8:255,limit16:65535}}(p),h=[a(p,m),c(p,m),l(p),u(p)];return h.sort((g,y)=>g.length-y.length),h}e.getSize=d,e.classify=function f(p){if(p.length<2)return Fr.by(Fr.byteArray);switch(d(p)[0].kind){case"pack":return Fr.by(Fr.integerPacking);case"rle":return Fr.by(Fr.runLength).and(Fr.integerPacking);case"delta":return Fr.by(Fr.delta).and(Fr.integerPacking);case"delta-rle":return Fr.by(Fr.delta).and(Fr.runLength).and(Fr.integerPacking);default:Hi()}}}(P3||(P3={})),function(e){e.classify=function n(i){const{mantissaDigits:s,integerDigits:a}=function c8e(e,t,n){let r=1,i=0;for(let o=0,s=e.length;o<s;o++){if(r>=0){const l=a8e(e[o],t,n);l<0?r=-1:l>r&&(r=l)}const a=Math.abs(e[o]);if(a>n){const l=Math.floor(Math.log10(Math.abs(a)))+1;l>i&&(i=l)}}return{mantissaDigits:r,integerDigits:i}}(i,4,1e-6);if(s<0||s+a>10)return Fr.by(Fr.byteArray);if(0===s)return P3.classify(i);const l=function r(i){let o=1;for(let s=0;s<i;s++)o*=10;return o}(s),c=new Int32Array(i.length);for(let p=0,m=i.length;p<m;p++)c[p]=Math.round(l*i[p]);const d=P3.getSize(c)[0],f=Fr.by(Fr.fixedPoint(l));switch(d.kind){case"pack":return f.and(Fr.integerPacking);case"rle":return f.and(Fr.runLength).and(Fr.integerPacking);case"delta":return f.and(Fr.delta).and(Fr.integerPacking);case"delta-rle":return f.and(Fr.delta).and(Fr.runLength).and(Fr.integerPacking);default:Hi()}}}(cz||(cz={}));class r5{and(t){return new r5(this.providers.concat([t]))}encode(t){const n=[];for(const r of this.providers){const i=r(t);if(!i.encodings.length)throw new Error("Encodings must be non-empty.");t=i.data;for(const o of i.encodings)n.push(o)}if(!(t instanceof Uint8Array))throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.");return{encoding:n,data:t}}constructor(t){this.providers=t}}function fz(e){return(t,n)=>n[e].value(t)}function f8e(e){return(t,n)=>n[e].value(t).join(n[e].schema.separator)}function pz(e,...t){return(n,r)=>r[e].schema.space.get(r[e].value(n),...t)}function k3(e){return(t,n)=>n[e].valueKind(t)}function p8e(e,t){const n=[],i=k3(e);if(1===t.rank){const o=t.dimensions[0];for(let s=0;s<o;s++)n.push({name:`${e}[${s+1}]`,type:2,value:pz(e,s),valueKind:i})}else if(2===t.rank){const o=t.dimensions[0],s=t.dimensions[1];for(let a=0;a<o;a++)for(let l=0;l<s;l++)n.push({name:`${e}[${a+1}][${l+1}]`,type:2,value:pz(e,a,l),valueKind:i})}else{if(3!==t.rank)throw new Error("Tensors with rank > 3 or rank 0 are currently not supported.");{const o=t.dimensions[0],s=t.dimensions[1],a=t.dimensions[2];for(let l=0;l<o;l++)for(let c=0;c<s;c++)for(let u=0;u<a;u++)n.push({name:`${e}[${l+1}][${c+1}][${u+1}]`,type:2,value:pz(e,l,c,u),valueKind:i})}}return n}function kse(e){const t=[];for(const n of Object.keys(e)){const r=e[n];"int"===r.valueType?t.push({name:n,type:1,value:fz(n),valueKind:k3(n)}):"float"===r.valueType?t.push({name:n,type:2,value:fz(n),valueKind:k3(n)}):"str"===r.valueType?t.push({name:n,type:0,value:fz(n),valueKind:k3(n)}):"list"===r.valueType?t.push({name:n,type:0,value:f8e(n),valueKind:k3(n)}):"tensor"===r.valueType?t.push(...p8e(n,r.space)):Hi()}return t}function h8e(e){return e.defaultFormat&&typeof e.defaultFormat.digitCount<"u"?Math.max(0,Math.min(e.defaultFormat.digitCount,16)):6}function hz(e){return e.fields.some(t=>!!t.shouldInclude)?e.fields.filter(t=>!t.shouldInclude||e.source.some(n=>t.shouldInclude(n.data))):e.fields}function Mse(e,t){const n=e.instance(t),r=n.source.filter(s=>s.rowCount>0);return r.length?{instance:n,rowCount:r.reduce((s,a)=>s+a.rowCount,0),source:r.map(s=>({data:s.data,keys:()=>s.keys?s.keys():qR.Range(0,s.rowCount-1),rowCount:s.rowCount}))}:{instance:n,rowCount:0,source:[]}}!function(e){function t(i){return new r5([i])}function r(i){switch(i.kind){case"ByteArray":return Fr.byteArray;case"FixedPoint":return Fr.fixedPoint(i.factor);case"IntervalQuantization":return Fr.intervalQuantizaiton(i.min,i.max,i.numSteps);case"RunLength":return Fr.runLength;case"Delta":return Fr.delta;case"IntegerPacking":return Fr.integerPacking;case"StringArray":return Fr.stringArray}}e.by=t,e.fromEncoding=function n(i){let o=t(r(i[0]));for(let s=1;s<i.length;s++)o=o.and(r(i[s]));return o}}(C1||(C1={})),function(e){e.by=function t(_){return new r5([_])};const i={[ni.IntDataType.Int16]:function(_,w,A){_.setInt16(2*w,A,!0)},[ni.IntDataType.Uint16]:function(_,w,A){_.setUint16(2*w,A,!0)},[ni.IntDataType.Int32]:function(_,w,A){_.setInt32(4*w,A,!0)},[ni.IntDataType.Uint32]:function(_,w,A){_.setUint32(4*w,A,!0)},[ni.FloatDataType.Float32]:function(_,w,A){_.setFloat32(4*w,A,!0)},[ni.FloatDataType.Float64]:function(_,w,A){_.setFloat64(8*w,A,!0)}},o={[ni.IntDataType.Int16]:2,[ni.IntDataType.Uint16]:2,[ni.IntDataType.Int32]:4,[ni.IntDataType.Uint32]:4,[ni.FloatDataType.Float32]:4,[ni.FloatDataType.Float64]:8};function s(_){const w=ni.getDataType(_);if(w===ni.IntDataType.Int8)return function r(_){return{encodings:[{kind:"ByteArray",type:ni.IntDataType.Int8}],data:new Uint8Array(_.buffer,_.byteOffset)}}(_);if(w===ni.IntDataType.Uint8)return function n(_){return{encodings:[{kind:"ByteArray",type:ni.IntDataType.Uint8}],data:_}}(_);const A=new Uint8Array(_.length*o[w]),M=i[w],E=new DataView(A.buffer);for(let D=0,T=_.length;D<T;D++)M(E,D,_[D]);return{encodings:[{kind:"ByteArray",type:w}],data:A}}function m(_,w){let A=0;for(let M=0,E=_.length;M<E;M++)A+=_[M]/w|0;return A+=_.length,A}function h(_,w){const A=-w-1;let M=0;for(let E=0,D=_.length;E<D;E++){const T=_[E];M+=T>=0?T/w|0:T/A|0}return M+=_.length,M}e.byteArray=s,e.fixedPoint=function l(_){return w=>function a(_,w){const A=ni.getDataType(_),M=new Int32Array(_.length);for(let E=0,D=_.length;E<D;E++)M[E]=Math.round(_[E]*w);return{encodings:[{kind:"FixedPoint",factor:w,srcType:A}],data:M}}(w,_)},e.intervalQuantizaiton=function u(_,w,A,M=Int32Array){return E=>function c(_,w,A,M,E){const D=ni.getDataType(_);if(!_.length)return{encodings:[{kind:"IntervalQuantization",min:w,max:A,numSteps:M,srcType:D}],data:new Int32Array(0)};if(A<w){const R=w;w=A,A=R}const T=(A-w)/(M-1),F=new E(_.length);for(let R=0,N=_.length;R<N;R++){const j=_[R];F[R]=j<=w?0:j>=A?M-1:0|Math.round((j-w)/T)}return{encodings:[{kind:"IntervalQuantization",min:w,max:A,numSteps:M,srcType:D}],data:F}}(E,_,w,A,M)},e.runLength=function d(_){let w=ni.getDataType(_);if(void 0===w&&(_=new Int32Array(_),w=ni.IntDataType.Int32),!_.length)return{encodings:[{kind:"RunLength",srcType:w,srcSize:0}],data:new Int32Array(0)};let A=2;for(let T=1,F=_.length;T<F;T++)_[T-1]!==_[T]&&(A+=2);const M=new Int32Array(A);let E=0,D=1;for(let T=1,F=_.length;T<F;T++)_[T-1]!==_[T]?(M[E]=_[T-1],M[E+1]=D,D=1,E+=2):++D;return M[E]=_[_.length-1],M[E+1]=D,{encodings:[{kind:"RunLength",srcType:w,srcSize:_.length}],data:M}},e.delta=function f(_){if(!ni.isSignedIntegerDataType(_))throw new Error("Only signed integer types can be encoded using delta encoding.");let w=ni.getDataType(_);if(void 0===w&&(_=new Int32Array(_),w=ni.IntDataType.Int32),!_.length)return{encodings:[{kind:"Delta",origin:0,srcType:w}],data:new _.constructor(0)};const A=new _.constructor(_.length),M=_[0];A[0]=_[0];for(let E=1,D=_.length;E<D;E++)A[E]=_[E]-_[E-1];return A[0]=0,{encodings:[{kind:"Delta",origin:M,srcType:w}],data:A}},e.integerPacking=function v(_){const w=function g(_){const w=function p(_){for(let w=0,A=_.length;w<A;w++)if(_[w]<0)return!0;return!1}(_),A=w?h(_,127):m(_,255),M=w?h(_,32767):m(_,65535);return 4*_.length<2*M?{isSigned:w,size:_.length,bytesPerElement:4}:2*M<A?{isSigned:w,size:M,bytesPerElement:2}:{isSigned:w,size:A,bytesPerElement:1}}(_);return 4===w.bytesPerElement?s(_):function y(_,w){const A=w.isSigned?1===w.bytesPerElement?127:32767:1===w.bytesPerElement?255:65535,M=-A-1,E=_.length,D=w.isSigned?1===w.bytesPerElement?new Int8Array(w.size):new Int16Array(w.size):1===w.bytesPerElement?new Uint8Array(w.size):new Uint16Array(w.size);let T=0;for(let R=0;R<E;R++){let N=_[R];if(N>=0)for(;N>=A;)D[T]=A,++T,N-=A;else for(;N<=M;)D[T]=M,++T,N-=M;D[T]=N,++T}const F=s(D);return{encodings:[{kind:"IntegerPacking",byteCount:w.bytesPerElement,isUnsigned:!w.isSigned,srcSize:E},F.encodings[0]],data:F.data}}(_,w)},e.stringArray=function x(_){const w=Object.create(null),A=[],M=new Int32Array(_.length),E=tt.create(Int32Array,1,Math.min(1024,_.length<32?_.length+1:Math.round(_.length/8)+1));tt.add(E,0);let D=0,T=0;for(const z of _){if(null==z){M[T++]=-1;continue}let $=w[z];void 0===$&&(D+=z.length,$=A.length,A[$]=z,w[z]=$,tt.add(E,D)),M[T++]=$}const F=tt.compact(E),N=lz(F).encode(F),W=lz(M).encode(M);return{encodings:[{kind:"StringArray",dataEncoding:W.encoding,stringData:A.join(""),offsetEncoding:N.encoding,offsets:N.data}],data:W.data}}}(Fr||(Fr={})),function(e){function n(a,l,c){return{name:a,type:1,value:l,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray}:void 0,shouldInclude:c&&c.shouldInclude}}e.str=function t(a,l,c){return{name:a,type:0,value:l,valueKind:c&&c.valueKind,defaultFormat:c&&c.encoder?{encoder:c.encoder}:void 0,shouldInclude:c&&c.shouldInclude}},e.int=n,e.float=function r(a,l,c){return{name:a,type:2,value:l,valueKind:c&&c.valueKind,defaultFormat:c?{encoder:c.encoder,typedArray:c.typedArray,digitCount:typeof c.digitCount<"u"?c.digitCount:void 0}:void 0,shouldInclude:c&&c.shouldInclude}},e.index=function i(a){return n(a,(l,c,u)=>u+1,{typedArray:Int32Array,encoder:Fr.by(Fr.delta).and(Fr.runLength).and(Fr.integerPacking)})};class o{constructor(){this.fields=[]}index(l){return this.fields.push(e.index(l)),this}str(l,c,u){return this.fields.push(e.str(l,c,u)),this}int(l,c,u){return this.fields.push(e.int(l,c,u)),this}vec(l,c,u){for(let d=0;d<c.length;d++)this.fields.push(e.int(`${l}[${d+1}]`,c[d],u));return this}float(l,c,u){return this.fields.push(e.float(l,c,u)),this}many(l){for(let c=0;c<l.length;c++)this.fields.push(l[c]);return this}add(l){return this.fields.push(l),this}getFields(){return this.fields}}e.Builder=o,e.build=function s(){return new o}}(uz||(uz={})),function(e){e.Empty={fields:[],source:[]},e.filterOf=function t(r){const i=[],o=[],s=[],a=[];for(let c of r.split(/[\r\n]+/)){if(c=c.trim(),0===c.length)continue;const u=/^!/.test(c);u&&(c=c.substr(1));const d=c.split(/\./),f=d[1],p=u?f?a:o:f?s:i;p[p.length]=c,f&&!i.includes(d[0])&&(i[i.length]=d[0])}const l=s.map(c=>c.split(".")[0]);return{includeCategory:c=>!o.includes(c)&&(i.length<=0||-1!==i.indexOf(c)),includeField(c,u){const d=c+"."+u;return!a.includes(d)&&(!l.includes(c)||s.includes(d))}}},e.DefaultFilter={includeCategory:r=>!0,includeField:(r,i)=>!0},e.DefaultFormatter={getFormat(r,i){}},e.ofTable=function n(r,i){return i?{fields:kse(r._schema),source:[{data:r,rowCount:i.length,keys:()=>qR.Array(i)}]}:{fields:kse(r._schema),source:[{data:r,rowCount:r._rowCount}]}}}(bf||(bf={})),function(e){function t(r,i,o){r.startDataBlock(i);for(const s of o._tableNames)r.writeCategory({name:s,instance:()=>bf.ofTable(o[s])})}e.writeDatabase=t,e.writeDatabaseCollection=function n(r,i){for(const o of Object.keys(i))t(r,o,i[o])}}(dz||(dz={}));class m8e{constructor(){this.builder=ci.create(),this.encoded=!1,this.dataBlockCreated=!1,this.filter=bf.DefaultFilter,this.formatter=bf.DefaultFormatter,this.isBinary=!1,this.binaryEncodingProvider=void 0}setFilter(t){this.filter=t||bf.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||bf.DefaultFormatter}startDataBlock(t){this.dataBlockCreated=!0,ci.write(this.builder,`data_${(t||"").replace(/[ \n\t]/g,"").toUpperCase()}\n#\n`)}writeCategory(t,n,r){if(this.encoded)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlockCreated)throw new Error("No data block created.");if(!r?.ignoreFilter&&!this.filter.includeCategory(t.name))return;const{instance:i,rowCount:o,source:s}=Mse(t,n);o&&(1===o?function g8e(e,t,n,r,i,o){const s=hz(t),a=n[0],l=a.data;let c=s.reduce((p,m)=>i.includeField(e.name,m.name)?Math.max(p,m.name.length):0,0);if(0===c)return;c+=e.name.length+6;const d=a.keys().move(),f=Nse(e.name,t.fields,o);for(let p=0;p<s.length;p++){const m=s[p];i.includeField(e.name,m.name)&&(ci.writePadRight(r,`_${e.name}.${m.name}`,c),Rse(r,l,d,m,f[p],0)||ci.newline(r))}ci.write(r,"#\n")}(t,i,s,this.builder,this.filter,this.formatter):function y8e(e,t,n,r,i,o){const s=hz(t),a=i===bf.DefaultFilter?s:s.filter(d=>i.includeField(e.name,d.name)),l=a.length;if(0===l)return;const c=Nse(e.name,a,o);Fse(r,"loop_");for(let d=0;d<l;d++)Fse(r,`_${e.name}.${a[d].name}`);let u=0;for(let d=0;d<n.length;d++){const f=n[d],p=f.data;if(0===f.rowCount)continue;const m=f.keys();for(;m.hasNext;){const h=m.move();let g=!1;for(let y=0;y<l;y++)g=Rse(r,p,h,a[y],c[y],u);g||ci.newline(r),u++}}ci.write(r,"#\n")}(t,i,s,this.builder,this.filter,this.formatter))}encode(){this.encoded=!0}writeTo(t){const n=ci.getChunks(this.builder);for(let r=0,i=n.length;r<i;r++)t.writeString(n[r])}getSize(){return ci.getSize(this.builder)}getData(){return ci.getString(this.builder)}}function Rse(e,t,n,r,i,o){const s=r.valueKind,a=s?s(n,t):0;if(0!==a)1===a?function _8e(e){ci.writeSafe(e,". ")}(e):function S8e(e){ci.writeSafe(e,"? ")}(e);else{const l=r.value(n,t,o),c=r.type;if(0===c)return function b8e(e){return"string"==typeof e&&e.indexOf("\n")>=0}(l)?(i5(e,l),!0):function C8e(e,t){if(!t)return ci.writeSafe(e,". "),!1;const n=t.charCodeAt(0);let r=!1,i=0,o=!1,s=!1;for(let a=0,l=t.length-1;a<=l;a++)switch(t.charCodeAt(a)){case 9:case 32:r=!0;break;case 10:return i5(e,t),!0;case 34:if(a&&a===l)break;if(o)return i5(e,t),!0;s=!0,r=!0,i=0;break;case 39:if(a&&a===l)break;if(s)return i5(e,t),!0;o=!0,r=!0,i=1}return!r&&(35===n||36===n||59===n||91===n||93===n||95===n)&&(r=!0),r?(ci.writeSafe(e,i?'"':"'"),ci.writeSafe(e,t),ci.writeSafe(e,i?'" ':"' ")):(ci.writeSafe(e,t),ci.writeSafe(e," ")),!1}(e,l);1===c?function v8e(e,t){ci.writeInteger(e,t),ci.whitespace1(e)}(e,l):function x8e(e,t,n){ci.writeFloat(e,t,n),ci.whitespace1(e)}(e,l,i)}return!1}function Nse(e,t,n){const r=[];for(const i of t){const o=n.getFormat(e,i.name);r[r.length]=o&&typeof o.digitCount<"u"?2===i.type?Math.pow(10,Math.max(0,Math.min(o.digitCount,15))):0:2===i.type?Math.pow(10,h8e(i)):0}return r}function Fse(e,t){ci.write(e,t),ci.newline(e)}function i5(e,t){ci.writeSafe(e,"\n;"+t),ci.writeSafe(e,"\n;\n")}function vw(e,t,n){for(let r=0,i=n.length;r<i;r++){const o=n.charCodeAt(r);if(o<128)e[t++]=o>>>0&127;else if(o<2048)e[t++]=o>>>6&31|192,e[t++]=o>>>0&63|128;else if(o<65536)e[t++]=o>>>12&15|224,e[t++]=o>>>6&63|128,e[t++]=o>>>0&63|128;else{if(!(o<1114112))throw new Error("bad codepoint "+o);e[t++]=o>>>18&7|240,e[t++]=o>>>12&63|128,e[t++]=o>>>6&63|128,e[t++]=o>>>0&63|128}}}const w8e=function(){const e=[];for(let t=0;t<1024;t++)e[t]=String.fromCharCode(t);return e}();function Ose(e){throw new Error(e)}const Bse=typeof TextDecoder<"u"?new TextDecoder:void 0;function mz(e,t,n){if(Bse){const r=t||n!==e.length?e.subarray(t,t+n):e;return Bse.decode(r)}return function A8e(e,t,n){const r=w8e;let i,o=0;const s=[];for(let l=t,c=t+n;l<c;l++){const u=e[l];128&u?192==(224&u)?s[o++]=r[(15&u)<<6|63&e[++l]]:224==(240&u)?s[o++]=String.fromCharCode((15&u)<<12|(63&e[++l])<<6|63&e[++l]):240==(248&u)?s[o++]=String.fromCharCode((7&u)<<18|(63&e[++l])<<12|(63&e[++l])<<6|63&e[++l]):Ose("Invalid byte "+u.toString(16)):s[o++]=r[u],512===o&&(i=i||[],i[i.length]=s.join(""),o=0)}return i?(o>0&&(i[i.length]=s.slice(0,o).join("")),i.join("")):s.slice(0,o).join("")}(e,t,n)}function o5(e){let t=0;for(let n=0,r=e.length;n<r;n++){const i=e.charCodeAt(n);i<128?t+=1:i<2048?t+=2:i<65536?t+=3:i<1114112?t+=4:Ose("bad codepoint "+i)}return t}function I8e(e){const t=new ArrayBuffer(s5(e)),n=new DataView(t),r=new Uint8Array(t);return a5(e,n,r,0),r}function s5(e){const t=typeof e;if("string"===t){const n=o5(e);if(n<32)return 1+n;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if(e instanceof Uint8Array){const n=e.byteLength;if(n<256)return 2+n;if(n<65536)return 3+n;if(n<4294967296)return 5+n}if("number"===t){if(Math.floor(e)!==e)return 9;if(e>=0){if(e<128)return 1;if(e<256)return 2;if(e<65536)return 3;if(e<4294967296)return 5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return 1;if(e>=-128)return 2;if(e>=-32768)return 3;if(e>=-2147483648)return 5;throw new Error("Number too small -0x"+e.toString(16).substr(1))}if("boolean"===t||null==e)return 1;if("object"===t){let n,r=0;if(Array.isArray(e)){n=e.length;for(let i=0;i<n;i++)r+=s5(e[i])}else{const i=Object.keys(e);n=i.length;for(let o=0;o<n;o++){const s=i[o];r+=s5(s)+s5(e[s])}}if(n<16)return 1+r;if(n<65536)return 3+r;if(n<4294967296)return 5+r;throw new Error("Array or object too long 0x"+n.toString(16))}throw new Error("Unknown type "+t)}function a5(e,t,n,r){const i=typeof e;if("string"===i){const o=o5(e);if(o<32)return t.setUint8(r,160|o),vw(n,r+1,e),1+o;if(o<256)return t.setUint8(r,217),t.setUint8(r+1,o),vw(n,r+2,e),2+o;if(o<65536)return t.setUint8(r,218),t.setUint16(r+1,o),vw(n,r+3,e),3+o;if(o<4294967296)return t.setUint8(r,219),t.setUint32(r+1,o),vw(n,r+5,e),5+o}if(e instanceof Uint8Array){const o=e.byteLength,s=new Uint8Array(t.buffer);if(o<256)return t.setUint8(r,196),t.setUint8(r+1,o),s.set(e,r+2),2+o;if(o<65536)return t.setUint8(r,197),t.setUint16(r+1,o),s.set(e,r+3),3+o;if(o<4294967296)return t.setUint8(r,198),t.setUint32(r+1,o),s.set(e,r+5),5+o}if("number"===i){if(!isFinite(e))throw new Error("Number not finite: "+e);if(Math.floor(e)!==e)return t.setUint8(r,203),t.setFloat64(r+1,e),9;if(e>=0){if(e<128)return t.setUint8(r,e),1;if(e<256)return t.setUint8(r,204),t.setUint8(r+1,e),2;if(e<65536)return t.setUint8(r,205),t.setUint16(r+1,e),3;if(e<4294967296)return t.setUint8(r,206),t.setUint32(r+1,e),5;throw new Error("Number too big 0x"+e.toString(16))}if(e>=-32)return t.setInt8(r,e),1;if(e>=-128)return t.setUint8(r,208),t.setInt8(r+1,e),2;if(e>=-32768)return t.setUint8(r,209),t.setInt16(r+1,e),3;if(e>=-2147483648)return t.setUint8(r,210),t.setInt32(r+1,e),5;throw new Error("Number too small -0x"+(-e).toString(16).substr(1))}if(null==e)return t.setUint8(r,192),1;if("boolean"===i)return t.setUint8(r,e?195:194),1;if("object"===i){let o,s=0;const a=Array.isArray(e);let l;if(a?o=e.length:(l=Object.keys(e),o=l.length),o<16?(t.setUint8(r,o|(a?144:128)),s=1):o<65536?(t.setUint8(r,a?220:222),t.setUint16(r+1,o),s=3):o<4294967296&&(t.setUint8(r,a?221:223),t.setUint32(r+1,o),s=5),a)for(let c=0;c<o;c++)s+=a5(e[c],t,n,r+s);else for(let c=0,u=l.length;c<u;c++){const d=l[c];s+=a5(d,t,n,r+s),s+=a5(e[d],t,n,r+s)}return s}throw new Error("Unknown type "+i)}class E8e{setFilter(t){this.filter=t||bf.DefaultFilter}isCategoryIncluded(t){return this.filter.includeCategory(t)}setFormatter(t){this.formatter=t||bf.DefaultFormatter}startDataBlock(t){this.dataBlocks.push({header:(t||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})}writeCategory(t,n,r){if(!this.data)throw new Error("The writer contents have already been encoded, no more writing.");if(!this.dataBlocks.length)throw new Error("No data block created.");if(!r?.ignoreFilter&&!this.filter.includeCategory(t.name))return;const{instance:i,rowCount:o,source:s}=Mse(t,n);if(!o)return;const a={name:"_"+t.name,columns:[],rowCount:o},l=hz(i);for(const c of l){if(!this.filter.includeField(t.name,c.name))continue;const u=this.formatter.getFormat(t.name,c.name);a.columns.push(M8e(t.name,c,s,o,u,this.binaryEncodingProvider,this.autoClassify))}a.columns.length&&this.dataBlocks[this.dataBlocks.length-1].categories.push(a)}encode(){this.encodedData||(this.encodedData=I8e(this.data),this.data=null,this.dataBlocks=null)}writeTo(t){t.writeBinary(this.encodedData)}getData(){return this.encode(),this.encodedData}getSize(){return this.encodedData.length}constructor(t,n,r){this.autoClassify=r,this.dataBlocks=[],this.filter=bf.DefaultFilter,this.formatter=bf.DefaultFormatter,this.isBinary=!0,this.binaryEncodingProvider=void 0,this.binaryEncodingProvider=n,this.data={encoder:t,version:"0.3.0",dataBlocks:this.dataBlocks}}}function M8e(e,t,n,r,i,o,s){const{array:a,allPresent:l,mask:c}=function R8e(e,t,n,r){const i=0===e.type,o=new t(n),s=new Uint8Array(n),a=e.valueKind,l=e.value;let c=!0,u=0;for(let d=0;d<r.length;d++){const f=r[d].data,p=r[d].keys();for(;p.hasNext;){const m=p.move(),h=a?a(m,f):0;if(0!==h)s[u]=h,i&&(o[u]=""),c=!1;else{const g=l(m,f,u);"string"!=typeof g||g?s[u]=0:(s[u]=1,c=!1),o[u]=g}u++}}return{array:o,allPresent:c,mask:s}}(t,function T8e(e,t){return t&&t.typedArray?t.typedArray:e.defaultFormat&&e.defaultFormat.typedArray?e.defaultFormat.typedArray:0===e.type?Array:1===e.type?Int32Array:Float64Array}(t,i),r,n);let u=function P8e(e,t,n,r){return n&&n.encoder?n.encoder:t.defaultFormat&&t.defaultFormat.encoder?t.defaultFormat.encoder:r?r.get(e,t.name):void 0}(e,t,i,o);u||(u=s?function k8e(e,t){return 0===e?C1.by(Fr.stringArray):1===e?lz(t):function d8e(e){return cz.classify(e)}(t)}(t.type,a):function D8e(e){return C1.by(0===e?Fr.stringArray:Fr.byteArray)}(t.type));const d=u.encode(a);let f;if(!l){const p=C1.by(Fr.runLength).and(Fr.byteArray).encode(c);f=p.data.length<c.length?p:C1.by(Fr.byteArray).encode(c)}return{name:t.name,data:d,mask:f}}var us,t_,vf;!function(e){e.Encoder=dz,e.Category=bf,e.Field=uz,e.Encoding=Fr,e.createEncoder=function t(l){const{binary:c=!1,encoderName:u="mol*"}=l||{};return c?new E8e(u,l?l.binaryEncodingPovider:void 0,!!l&&!!l.binaryAutoClassifyEncoding):new m8e},e.fields=function n(){return e.Field.build()};var r=e.Encoding;function a(l){const c=l.precision;if(void 0!==c){const u=Math.pow(10,c),d=r.by(r.fixedPoint(u));switch(l.encoding){case"pack":return d.and(r.integerPacking);case"rle":return d.and(r.runLength).and(r.integerPacking);case"delta":return d.and(r.delta).and(r.integerPacking);case"delta-rle":return d.and(r.delta).and(r.runLength).and(r.integerPacking)}}else switch(l.encoding){case"pack":return r.by(r.integerPacking);case"rle":return r.by(r.runLength).and(r.integerPacking);case"delta":return r.by(r.delta).and(r.integerPacking);case"delta-rle":return r.by(r.delta).and(r.runLength).and(r.integerPacking)}throw new Error("cannot be reached")}e.Encodings={deltaRLE:r.by(r.delta).and(r.runLength).and(r.integerPacking),fixedPoint2:r.by(r.fixedPoint(100)).and(r.delta).and(r.integerPacking),fixedPoint3:r.by(r.fixedPoint(1e3)).and(r.delta).and(r.integerPacking)},e.categoryInstance=function i(l,c){return{fields:l,source:[c]}},e.createEncodingProviderFromCifFrame=function o(l){return{get(c,u){const d=l.categories[c];if(!d)return;const f=d.getField(u);return f&&f.binaryEncoding?C1.fromEncoding(f.binaryEncoding):void 0}}},e.createEncodingProviderFromJsonConfig=function s(l){return{get(c,u){for(let d=0;d<l.length;d++){const f=l[d];if(f.categoryName===c&&f.columnName===u)return a(f)}}}}}(us||(us={})),function(e){e.Descriptor={name:"chem_comp_bond",cifExport:{prefix:"",categories:[{name:"chem_comp_bond",instance(i){const o=e.Provider.get(i.firstModel);if(!o)return us.Category.Empty;const s=o.data;if(!s)return us.Category.Empty;const a=i.structures[0].uniqueResidueNames,{comp_id:l,_rowCount:c}=s,u=[];for(let d=0;d<c;d++)a.has(l.value(d))&&(u[u.length]=d);return us.Category.ofTable(s,u)}}]}},e.Provider=jh.create(e.Descriptor),e.chemCompBondFromTable=function t(i,o){return Kr.pick(o,Nr.chem_comp_bond,s=>i.properties.chemicalComponentMap.has(o.comp_id.value(s)))},e.getEntriesFromChemCompBond=function n(i){const o=new Map;function s(h){if(o.has(h))return o.get(h);const g=new r(h);return o.set(h,g),g}const{comp_id:a,atom_id_1:l,atom_id_2:c,value_order:u,pdbx_aromatic_flag:d,_rowCount:f,pdbx_ordinal:p}=i;let m=s(a.value(0));for(let h=0;h<f;h++){const g=a.value(h),y=l.value(h),v=c.value(h),x=u.value(h),_="y"===d.value(h),w=p.value(h);m.id!==g&&(m=s(g));let A=1,M=1;switch(_&&(A|=16),x.toLowerCase()){case"delo":A|=16;break;case"doub":M=2;break;case"trip":M=3;break;case"quad":M=4}m.add(y,v,M,A,w)}return o};class r{add(o,s,a,l,c,u=!0){const d=this.map.get(o);if(void 0!==d)void 0===d.get(s)&&d.set(s,{order:a,flags:l,key:c});else{const f=new Map;f.set(s,{order:a,flags:l,key:c}),this.map.set(o,f)}u&&this.add(s,o,a,l,c,!1)}constructor(o){this.id=o,this.map=new Map}}e.Entry=r}(t_||(t_={})),function(e){function n({units:o},s){for(let a=0,l=o.length;a<l;a++)if(rt.indexOf(o[a].elements,s)>=0)return!0;return!1}e.Descriptor={name:"struct_conn",cifExport:{prefix:"",categories:[{name:"struct_conn",instance(o){const s=e.Provider.get(o.firstModel);if(!s||0===s.entries.length)return us.Category.Empty;const a=o.structures[0],l=[];for(const c of s.entries)n(a,c.partnerA.atomIndex)&&n(a,c.partnerB.atomIndex)&&(l[l.length]=c.rowIndex);return us.Category.ofTable(s.data,l)}}]}},e.Provider=jh.create(e.Descriptor),e.isExhaustive=function t(o){const s=e.Provider.get(o);return!!s&&s.data.id.rowCount/o.atomicConformation.atomId.rowCount>.95},e.getAtomIndexFromEntries=function r(o){const s=new Map;for(const a of o){const{partnerA:{atomIndex:l},partnerB:{atomIndex:c}}=a;s.has(l)?s.get(l).push(a):s.set(l,[a]),s.has(c)?s.get(c).push(a):s.set(c,[a])}return s},e.getEntriesFromStructConn=function i(o,s){const{conn_type_id:a,pdbx_dist_value:l,pdbx_value_order:c}=o,u={label_asym_id:o.ptnr1_label_asym_id,label_seq_id:o.ptnr1_label_seq_id,auth_seq_id:o.ptnr1_auth_seq_id,label_atom_id:o.ptnr1_label_atom_id,label_alt_id:o.pdbx_ptnr1_label_alt_id,ins_code:o.pdbx_ptnr1_PDB_ins_code,symmetry:o.ptnr1_symmetry},d={label_asym_id:o.ptnr2_label_asym_id,label_seq_id:o.ptnr2_label_seq_id,auth_seq_id:o.ptnr2_auth_seq_id,label_atom_id:o.ptnr2_label_atom_id,label_alt_id:o.pdbx_ptnr2_label_alt_id,ins_code:o.pdbx_ptnr2_PDB_ins_code,symmetry:o.ptnr2_symmetry},f=Array.from(s.entities.data.id.toArray()),p=(h,g)=>{if(0!==g.label_asym_id.valueKind(h))return;const y=g.label_asym_id.value(h),v=g.label_atom_id.value(h);if(!v)return;const x=g.auth_seq_id.valueKind(h)===ce.ValueKind.Present?g.auth_seq_id.value(h):g.label_seq_id.value(h),_=g.ins_code.value(h),w=g.label_alt_id.value(h);for(const A of f){const M=s.atomicHierarchy.index.findResidue(A,y,x,_);if(M<0)continue;const E=s.atomicHierarchy.index.findAtomOnResidue(M,v,w);if(!(E<0))return{residueIndex:M,atomIndex:E,symmetry:g.symmetry.value(h)}}},m=[];for(let h=0;h<o._rowCount;h++){const g=p(h,u),y=p(h,d);if(void 0===g||void 0===y)continue;const v=a.value(h);let _=0,w=1;switch(c.value(h)||""){case"sing":w=1;break;case"doub":w=2;break;case"trip":w=3;break;case"quad":w=4;break;default:w=Tse(o.ptnr1_label_comp_id.value(h),o.ptnr1_label_atom_id.value(h),o.ptnr2_label_comp_id.value(h),o.ptnr2_label_atom_id.value(h))}switch(v){case"covale":_=1;break;case"disulf":_=9;break;case"hydrog":_=4;break;case"metalc":_=2}m.push({rowIndex:h,flags:_,order:w,distance:l.value(h),partnerA:g,partnerB:y})}return m}}(vf||(vf={}));const N8e=C.distance;function Lse(e,t,n,r,i,o,s){const a=new Cd.EdgeBuilder(o,e,t),l=new Uint16Array(a.slotCount),c=new Int8Array(a.slotCount),u=new Uint32Array(a.slotCount);for(let d=0,f=a.edgeCount;d<f;d++)a.addNextEdge(),a.assignProperty(l,r[d]),a.assignProperty(c,n[d]),a.assignProperty(u,i[d]);return a.createGraph({flags:l,order:c,key:u},{canRemap:s})}const jse=C(),Use=C();function F8e(e,t,n){return e.conformation.position(t,jse),e.conformation.position(n,Use),N8e(jse,Use)}const O8e=new Set;const U8e=C.distance,z8e=C.set,V8e=C.squaredDistance,H8e=C.transformMat4,zse=C(),Vse=C();function Hse(e,t,n,r){return e.conformation.position(t,zse),n.conformation.position(r,Vse),U8e(zse,Vse)}const G8e=fe(),n_=C(),W8e={...Ise,ignoreWater:!0,ignoreIon:!0};function Y8e(e,t){const n={...W8e,...t};return function $8e(e,t){const n=new dp.Builder,r=e.models.some(o=>nc.Provider.get(o)),i=e.models.some(o=>vf.isExhaustive(o));return t.noCompute||e.isCoarseGrained&&!r&&!i||Xe.eachUnitPair(e,(o,s)=>{!function q8e(e,t,n,r){const{maxRadius:i}=n,{elements:o,residueIndex:s}=e,{x:a,y:l,z:c}=e.model.atomicConformation,{elements:u,residueIndex:d}=t,f=e.elements.length,{type_symbol:p,label_alt_id:m,label_atom_id:h,label_comp_id:g}=e.model.atomicHierarchy.atoms,{type_symbol:y,label_alt_id:v,label_atom_id:x,label_comp_id:_}=t.model.atomicHierarchy.atoms,{auth_seq_id:w}=e.model.atomicHierarchy.residues,{auth_seq_id:A}=t.model.atomicHierarchy.residues,{occupancy:M}=e.model.atomicConformation,{occupancy:E}=t.model.atomicConformation,D=M.isDefined&&E.isDefined,T=e.model===t.model&&vf.Provider.get(e.model),F=!n.forceCompute&&e.model===t.model&&nc.Provider.get(e.model),{atomSourceIndex:R}=e.model.atomicHierarchy,{invertedIndex:N}=F?Sn.getInvertedAtomSourceIndex(t.model):{invertedIndex:void 0},j=e.model===t.model&&vf.isExhaustive(e.model),W=fe.mul(G8e,t.conformation.operator.inverse,e.conformation.operator.matrix),z=!fe.isIdentity(W),{center:$,radius:V}=t.boundary.sphere,X=(V+i)*(V+i);r.startUnitPair(e.id,t.id);const H=e.conformation.operator.key,oe=t.conformation.operator.key;for(let te=0;te<f;te++){const K=o[te];if(z8e(n_,a[K],l[K],c[K]),z&&H8e(n_,n_,W),V8e(n_,$)>X)continue;if(!n.forceCompute&&F){const{maxDistance:ie}=F,{offset:ue,b:_e,edgeProps:{order:Fe,distance:Ze,flag:ct,key:q,operatorA:ne,operatorB:be}}=F.bonds,Ce=R.value(K),Re=ig(p.value(K));for(let Be=ue[Ce],$e=ue[Ce+1];Be<$e;++Be){const nt=N[_e[Be]],ht=rt.indexOf(t.elements,nt);if(ht<0)continue;const Ge=ne[Be],ft=be[Be];if(Ge>=0&&Ge!==H&&Ge!==oe||ft>=0&&ft!==oe&&ft!==H)continue;const vt=ig(p.value(nt)),Pt=Ze[Be],St=Hse(e,K,t,nt);let Mt=!1;Pt>=0?Mt=Do(St,Pt,.3):ie>=0?Mt=St<ie:(Mt=St<JR(Re,vt,_1(Re),_1(vt)),K0(Re)&&K0(vt)&&(Mt=!1)),Mt&&r.add(te,ht,{order:Fe[Be],flag:ct[Be],key:q[Be]})}continue}const Q=n.forceCompute?void 0:T&&T.byAtomIndex.get(K);if(Q&&Q.length){let ie=!1;for(const ue of Q){const{partnerA:_e,partnerB:Fe}=ue,Ze=_e.atomIndex===K?Fe:_e,ct=rt.indexOf(t.elements,Ze.atomIndex);ct<0||Hse(e,K,t,Ze.atomIndex)>i||(r.add(te,ct,{order:ue.order,flag:ue.flags,key:ue.rowIndex}),ie=!0)}if(ie)continue}if(j)continue;const G=M.value(K),{lookup3d:Z}=t,{indices:ee,count:se,squaredDistances:xe}=Z.find(n_[0],n_[1],n_[2],i);if(0===se)continue;const re=ig(p.value(K)),ae=K0(re),ge=_1(re),Ie=m.value(K),me=D3.has(re),Ae=h.value(K),he=g.value(s[K]);for(let ie=0;ie<se;ie++){const ue=ee[ie],_e=u[ue],Fe=v.value(_e);if(Ie&&Fe&&Ie!==Fe||D&&E.value(_e)<1&&G<1&&w.value(K)===A.value(_e))continue;const Ze=ig(y.value(_e)),ct=K0(Ze);if(ae&&ct)continue;const q=(me||D3.has(Ze))&&!(ae||ct),ne=Math.sqrt(xe[ie]);if(0!==ne&&ne<=JR(re,Ze,ge,_1(Ze))){const Ce=x.value(_e),Re=_.value(d[_e]);r.add(te,ue,{order:Tse(he,Re,Ae,Ce),flag:32|(q?2:1),key:-1})}}}r.finishUnitPair()}(o,s,t,n)},{maxRadius:t.maxRadius,validUnit:o=>t.validUnit(o),validUnitPair:(o,s)=>t.validUnitPair(e,o,s)}),new T3(n.getMap())}(e,{...n,validUnit:t&&t.validUnit||(r=>ze.isAtomic(r)),validUnitPair:t&&t.validUnitPair||((r,i,o)=>{if(!Xe.validUnitPair(r,i,o))return!1;const a=i.model.atomicHierarchy.derived.residue.moleculeType,l=o.model.atomicHierarchy.derived.residue.moleculeType,c=!(ze.isAtomic(i)&&2===a[i.residueIndex[i.elements[0]]]||ze.isAtomic(o)&&2===l[o.residueIndex[o.elements[0]]]),u=!ze.isAtomic(i)||3!==a[i.residueIndex[i.elements[0]]],d=!ze.isAtomic(o)||3!==l[o.residueIndex[o.elements[0]]];return!(!c&&n.ignoreWater||(!u||!d)&&n.ignoreIon)||function X8e(e,t){if(e.model!==t.model||!ze.isAtomic(e)||!ze.isAtomic(t))return!1;const n=vf.Provider.get(e.model);if(!n)return!1;const r=e.elements.length<t.elements.length?e:t,i=e.elements.length>=t.elements.length?e:t,{elements:o}=r,{elements:s}=i,{indexOf:a}=rt;for(let l=0,c=o.length;l<c;l++){const u=o[l],d=n.byAtomIndex.get(u);if(d?.length)for(const f of d)if(a(s,f.partnerA.atomIndex===u?f.partnerB.atomIndex:f.partnerA.atomIndex)>=0)return!0}return!1}(i,o)})})}var fn;function Gse(e){e.count=e.endVertex-e.startVertex;const{isRingAtom:t,pred:n,color:r,depth:i,marked:o}=e;for(let s=0;s<e.count;s++)t[s]=0,n[s]=-1,o[s]=-1,r[s]=0,i[s]=0;e.currentColor=0,e.currentAltLoc="",e.hasAltLoc=!1}function qse(e){const{depth:t}=e;for(let n=0;n<e.count;n++)t[n]=e.count+1}function Wse(e,t){const n=e.bonds.offset,r=e.startVertex+t,s=n[r+1]-n[r];return!(s<=1||e.isRingAtom[t]&&2===s)}function J8e(e,t,n){if(e.startVertex=t,e.endVertex=n,e.endVertex-e.startVertex<3)return;e.currentRings=[];const{elements:r}=e.unit,i=[];for(let s=e.startVertex;s<e.endVertex;s++)Us(i,e.altLoc.value(r[s]));$x(i,"");let o=1;if(0===i.length){Gse(e);for(let s=0;s<e.count;s++)Wse(e,s)&&(qse(e),o=$se(e,s,o))}else for(let s=0;s<i.length;s++){Gse(e),e.hasAltLoc=!0,e.currentAltLoc=i[s];for(let a=0;a<e.count;a++){if(!Wse(e,a))continue;const l=e.altLoc.value(r[e.startVertex+a]);l&&l!==e.currentAltLoc||(qse(e),o=$se(e,a,o))}}for(let s=0,a=e.currentRings.length;s<a;s++)e.rings.push(e.currentRings[s])}function eje(e,t,n,r){if(n<t)return!1;const{pred:i,color:o,left:s,right:a}=e,l=++e.currentColor;let c=t;for(let y=0;y<5&&(o[c]=l,c=i[c],!(c<0));y++);let u=0,d=0,f=!1,p=0;c=n;for(let y=0;y<5;y++){if(o[c]===l){p=c,f=!0;break}if(a[d++]=c,c=i[c],c<0)break}if(!f)return!1;c=t;for(let y=0;y<5&&(s[u++]=c,!(p===c||(c=i[c],c<0)));y++);const m=u+d;if(m<3)return!1;const h=new Int32Array(m);let g=0;for(let y=0;y<u;y++)h[g++]=e.startVertex+s[y],r[s[y]]=1;for(let y=d-1;y>=0;y--)h[g++]=e.startVertex+a[y],r[a[y]]=1;ip(h);for(let y=0,v=e.currentRings.length;y<v;y++){const x=e.currentRings[y];if(h.length===x.length){if(rt.areEqual(h,x))return!1}else if(h.length>x.length&&rt.isSubset(h,x))return!1}return e.currentRings.push(rt.ofSortedArray(h)),!0}function $se(e,t,n){const{bonds:r,startVertex:i,endVertex:o,isRingAtom:s,marked:a,queue:l,pred:c,depth:u}=e,{elements:d}=e.unit,{b:f,edgeProps:{flags:p},offset:m}=r;a[t]=n,u[t]=0,l[0]=t;let h=0,g=1;for(;h<g;){const y=l[h++],v=u[y],x=i+y,w=m[x+1];for(let A=m[x];A<w;A++){const M=f[A];if(M<i||M>=o||!Lr.isCovalent(p[A]))continue;if(e.hasAltLoc){const T=e.altLoc.value(d[M]);if(T&&e.currentAltLoc!==T)continue}const E=M-i;if(a[E]===n){if(c[E]!==y&&c[y]!==E&&eje(e,y,E,s))return n+1;continue}const D=Math.min(u[E],v+1);D>5||(u[E]=D,a[E]=n,l[g++]=E,c[E]=y)}}return n+1}function Yse(e){const t=e.length,n=new Int32Array(2*t);for(let s=0;s<n.length;s++)n[s]=-1;let r="",i="",o=0;for(let s=1;s<n.length;s++){let a=n[s-o-1];for(;-1!==a&&(r=e[s%t],i=e[(o+a+1)%t],r!==i);)r<i&&(o=s-a-1),a=n[a];-1===a?(r=e[s%t],i=e[(o+a+1)%t],r!==i?(r<i&&(o=s),n[s-o]=-1):n[s-o]=a+1):n[s-o]=a+1}return o}function Xse(e,t){const n=e.length,r=[];let i;for(i=0;i<n-1;i++)r.push(e[(i+t)%n]),r.push("-");return r.push(e[(i+t)%n]),r.join("")}function gz(e,t){switch(e.kind){case 0:return e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[t]];case 1:case 2:const n=function rje(e,t){const r=e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence,i=e.coarseElements.seq_id_begin.value(t);return r.compId.value(i-1)}(e,t),r=e.model.properties.chemicalComponentMap.get(n);if(r)return x1(r.type,n)}return 0}!function(e){function t(g,y,v,x,_,w){return{kind:"bond-location",aStructure:g,aUnit:y,aIndex:v,bStructure:x,bUnit:_,bIndex:w}}function r(g,y){return g.aStructure.label===y.aStructure.label&&g.bStructure.label===y.bStructure.label&&g.aIndex===y.aIndex&&g.bIndex===y.bIndex&&g.aUnit.id===y.aUnit.id&&g.bUnit.id===y.bUnit.id}function i(g,y){return{kind:"bond-loci",structure:g,bonds:y}}e.Location=t,e.isLocation=function n(g){return!!g&&"bond-location"===g.kind},e.areLocationsEqual=r,e.Loci=i,e.isLoci=function o(g){return!!g&&"bond-loci"===g.kind},e.areLociEqual=function s(g,y){if(g.structure!==y.structure||g.bonds.length!==y.bonds.length)return!1;for(let v=0,x=g.bonds.length;v<x;++v)if(!r(g.bonds[v],y.bonds[v]))return!1;return!0},e.isLociEmpty=function a(g){return 0===g.bonds.length},e.remapLoci=function l(g,y){if(y===g.structure)return g;const v=[];return g.bonds.forEach(x=>{const _=y.unitMap.get(x.aUnit.id);if(!_)return;const w=y.unitMap.get(x.bUnit.id);if(!w)return;const M=rt.indexOf(_.elements,x.aUnit.elements[x.aIndex]);if(-1===M)return;const D=rt.indexOf(w.elements,x.bUnit.elements[x.bIndex]);-1!==D&&v.push(t(g.structure,_,M,g.structure,w,D))}),i(y,v)},e.toStructureElementLoci=function c(g){const y=[],v=new Map;for(const x of g.bonds){const{aIndex:_,aUnit:w,bIndex:A,bUnit:M}=x;w===M?v.has(w.id)?v.get(w.id).push(_,A):v.set(w.id,[_,A]):(v.has(w.id)?v.get(w.id).push(_):v.set(w.id,[_]),v.has(M.id)?v.get(M.id).push(A):v.set(M.id,[A]))}return v.forEach((x,_)=>{y.push({unit:g.structure.unitMap.get(_),indices:rt.deduplicate(rt.ofUnsortedArray(x))})}),Me(g.structure,y)},e.toFirstStructureElementLoci=function u(g){const{aUnit:y,aIndex:v}=g.bonds[0];return Me(g.structure,[{unit:y,indices:Ve.ofSingleton(v)}])},e.getType=function d(g,y){if(y.aUnit===y.bUnit){const v=y.aUnit.bonds,x=v.getEdgeIndex(y.aIndex,y.bIndex);return Lr.create(x<0?0:v.edgeProps.flags[x])}{const v=g.interUnitBonds.getBondFromLocation(y);return Lr.create(v?v.props.flag:0)}},e.getOrder=function f(g,y){if(y.aUnit===y.bUnit){const v=y.aUnit.bonds,x=v.getEdgeIndex(y.aIndex,y.bIndex);return x<0?0:v.edgeProps.order[x]}{const v=g.interUnitBonds.getBondFromLocation(y);return v?v.props.order:0}},e.getIntraUnitBondCount=function p(g){let y=0;for(let v=0,x=g.units.length;v<x;++v){const _=g.units[v];ze.isAtomic(_)&&(y+=_.bonds.edgeCount)}return y},e.ElementBondIterator=class m{move(){return this.advance(),this.current}setElement(y,v,x){this.structure=y,this.unit=v,this.index=x,this.interBondIndices=y.interUnitBonds.getEdgeIndices(x,v.id),this.interBondCount=this.interBondIndices.length,this.interBondIndex=0,this.intraBondEnd=v.bonds.offset[x+1],this.intraBondIndex=v.bonds.offset[x],this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}advance(){if(this.intraBondIndex<this.intraBondEnd)this.current.otherUnit=this.unit,this.current.otherIndex=this.unit.bonds.b[this.intraBondIndex],this.current.type=this.unit.bonds.edgeProps.flags[this.intraBondIndex],this.current.order=this.unit.bonds.edgeProps.order[this.intraBondIndex],this.intraBondIndex+=1;else{if(!(this.interBondIndex<this.interBondCount))return void(this.hasNext=!1);{const y=this.structure.interUnitBonds.edges[this.interBondIndex];this.current.otherUnit=this.structure.unitMap.get(y.unitA!==this.unit.id?y.unitA:y.unitB),this.current.otherIndex=y.indexA!==this.index?y.indexA:y.indexB,this.current.type=y.props.flag,this.current.order=y.props.order,this.interBondIndex+=1}}this.hasNext=this.interBondIndex<this.interBondCount||this.intraBondIndex<this.intraBondEnd}constructor(){this.current={},this.hasNext=!1}},e.getBoundingSphere=function h(g,y){return X0.fromPairProvider(g.bonds.length,(v,x,_)=>{const{aUnit:w,aIndex:A,bUnit:M,bIndex:E}=g.bonds[v];w.conformation.position(w.elements[A],x),M.conformation.position(M.elements[E],_)},y)}}(fn||(fn={}));const ije=new Set;function w1(e,t){const n=p6e[e];if(void 0!==n){const r=n[t];if(void 0!==r)return r}return ije}const Kse=C.zero();function Zse(e,t){const n=e.conformation,r=new Float32Array(3*t.length),{elements:i}=e;for(let o=0,s=t.length;o<s;++o)n.position(i[t[o]],Kse),C.toArray(Kse,r,3*o);return r}class l5{get index(){return this._index||(this._index=function nje(e,t){const n=new Map,r=new Map;for(let l=0,c=e.length;l<c;l++){const u=e[l];for(let d=0,f=u.length;d<f;d++){const p=u[d];n.has(p)?n.get(p).push(l):n.set(p,[l])}}for(let l=0,c=t.length;l<c;l++){const u=t[l],d=e[u];for(let f=0,p=d.length;f<p;f++){const m=d[f];r.has(m)?r.get(m).push(u):r.set(m,[u])}}const i=new Cd.UniqueEdgeBuilder(e.length);for(let l=0,c=e.length;l<c;l++){const u=e[l];for(let d=0,f=u.length;d<f;d++){const m=n.get(u[d]);if(1!==m.length)for(let h=0,g=m.length;h<g;h++){const y=m[h];l>=y||i.addEdge(l,y)}}}const o=Cd.connectedComponents(i.getGraph()),s=o.componentIndex,a=[];for(let l=0;l<o.componentCount;l++)a[l]=[];for(let l=0,c=e.length;l<c;l++)a[s[l]].push(l);return{elementRingIndices:n,elementAromaticRingIndices:r,ringComponentIndex:s,ringComponents:a}}(this.all,this.aromaticRings)),this._index}get byFingerprint(){return this._byFingerprint||(this._byFingerprint=function oje(e,t){const n=new Map;let r=0;for(let i=0,o=t.length;i<o;i++){const a=fp.fingerprint(e,t[i]);n.has(a)?n.get(a).push(r):n.set(a,[r]),r++}return n}(this.unit,this.all)),this._byFingerprint}get elementRingIndices(){return this.index.elementRingIndices}get elementAromaticRingIndices(){return this.index.elementAromaticRingIndices}get ringComponentIndex(){return this.index.ringComponentIndex}get ringComponents(){return this.index.ringComponents}get aromaticRings(){return this._aromaticRings||(this._aromaticRings=function lje(e,t){const n=[];for(let r=0,i=t.length;r<i;++r)fp.isAromatic(e,t[r])&&n.push(r);return n}(this.unit,this.all)),this._aromaticRings}constructor(t,n){this.unit=n,this.all=t}}var fp,Di;function sje(e,t){const{elements:n}=e,r=e.model.atomicHierarchy.residueAtomSegments.index,i=r[n[t[0]]];for(let o=1,s=t.length;o<s;o++)if(i!==r[n[t[o]]])return-1;return i}function aje(e,t,n){const r=e.byFingerprint.get(t);if(r)for(let i=0,o=r.length;i<o;i++){const s=r[i],a=sje(e.unit,e.all[s]);a>=0&&(n.has(a)?n.get(a).push(s):n.set(a,[s]))}}(function(e){function n(a){return function tje(e){const t=e.length,n=new Array(t);for(let s=0;s<t;s++)n[s]=e[t-s-1];const r=Yse(e),i=Yse(n);let o=!1;for(let s=0;s<t;s++){const a=e[(s+r)%t],l=n[(s+i)%t];if(a!==l){o=a<l;break}}return o?Xse(e,r):Xse(n,i)}(a)}e.fingerprint=function t(a,l){const{elements:c}=a,{type_symbol:u}=a.model.atomicHierarchy.atoms,d=[];for(let f=0,p=l.length;f<p;f++)d[d.length]=u.value(c[l[f]]);return n(d)},e.elementFingerprint=n;const r=new Set(["B","C","N","O","SI","P","S","GE","AS","SN","SB","BI"]);e.isAromatic=function o(a,l){const{elements:c,bonds:{b:u,offset:d,edgeProps:{flags:f}}}=a,{type_symbol:p,label_comp_id:m}=a.model.atomicHierarchy.atoms;if("PRO"===m.value(a.elements[l[0]]))return!1;let h=0,g=!1;for(let v=0,x=l.length;v<x;++v){const _=l[v];!g&&r.has(p.value(c[_]))&&(g=!0);for(let w=d[_],A=d[_+1];w<A;++w)Lr.is(16,f[w])&&rt.has(l,u[w])&&(h+=1)}if(h===2*l.length)return!0;if(!g||l.length<5||h>0)return!1;const y=Uh.calculateMomentsAxes(Zse(a,l));return C.magnitude(y.dirC)<.05},e.getAltId=function s(a,l){const{label_alt_id:c}=a.model.atomicHierarchy.atoms,{elements:u}=a;for(let d=0,f=l.length;d<f;++d){const m=c.value(u[l[d]]);if(m)return m}return""}})(fp||(fp={})),function(e){e.create=function t(r){const i=function K8e(e){const t=function Q8e(e){const t=En.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);let n=0;for(;t.hasNext;){const r=t.move();n=Math.max(n,r.end-r.start)}return n}(e),n=function Z8e(e,t){return{startVertex:0,endVertex:0,count:0,isRingAtom:new Int32Array(t),marked:new Int32Array(t),queue:new Int32Array(t),pred:new Int32Array(t),depth:new Int32Array(t),left:new Int32Array(5),right:new Int32Array(5),color:new Int32Array(t),currentColor:0,currentAltLoc:"",hasAltLoc:!1,rings:[],currentRings:[],unit:e,bonds:e.bonds,altLoc:e.model.atomicHierarchy.atoms.label_alt_id}}(e,t),r=En.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements);for(;r.hasNext;){const i=r.move();J8e(n,i.start,i.end)}return n.rings}(r);return new e(i,r)},e.byFingerprintAndResidue=function n(r,i){const o=new Map;for(let s=0,a=i.length;s<a;s++)aje(r,i[s],o);return o}}(l5||(l5={})),function(e){function o(_){return _[_.length-1]}function a(_){return _.length/2}function l(_,w){return _[2*w]}function c(_,w){return _[2*w+1]+1}function u(_,w){return _[2*w]}function d(_,w){return _[2*w+1]}function g(_,w){return y(_,w,0)}function y(_,w,A){if(u(_,A)>Ve.max(w)||o(_)<Ve.min(w))return-1;for(let M=A,E=a(_);M<E;++M){const D=Pe.ofRange(u(_,M),d(_,M));if(Ve.areIntersecting(D,w))return M}return-1}e.ofSortedRanges=function t(_){return rt.ofSortedArray(_)},e.start=function n(_){return _[0]},e.end=function r(_){return _[_.length-1]+1},e.min=function i(_){return _[0]},e.max=o,e.size=function s(_){let w=0;for(let A=0,M=_.length;A<M;A+=2)w+=_[A+1]-_[A]+1;return w},e.count=a,e.startAt=l,e.endAt=c,e.minAt=u,e.maxAt=d,e.areEqual=function f(_,w){if(_.length!==w.length)return!1;for(let A=0,M=_.length;A<M;++A)if(_[A]!==w[A])return!1;return!0},e.forEach=function p(_,w){let A=0;for(let M=0,E=_.length;M<E;M+=2)for(let D=_[M],T=_[M+1];D<=T;++D)w(D,A),++A},e.has=function m(_,w){return-1!==g(_,w)},e.hasFrom=function h(_,w,A){return-1!==y(_,w,A)},e.firstIntersectionIndex=g,e.firstIntersectionIndexFrom=y,e.transientSegments=function v(_,w){return new x(_,w)};class x{updateValue(){this.value.index=this.curIndex,this.value.start=Ve.findPredecessorIndex(this.set,l(this.ranges,this.curIndex)),this.value.end=Ve.findPredecessorIndex(this.set,c(this.ranges,this.curIndex))}move(){return this.hasNext&&(this.updateValue(),this.curIndex=y(this.ranges,this.set,this.curIndex+1),this.hasNext=-1!==this.curIndex),this.value}constructor(w,A){this.ranges=w,this.set=A,this.value={index:0,start:0,end:0},this.curIndex=0,this.hasNext=!1,this.curIndex=g(w,A),this.hasNext=-1!==this.curIndex}}e.Iterator=x}(Di||(Di={}));const Qse=C();function Jse(e){const t=function mje(e){const{elements:t,conformation:n}=e,r=new Float32Array(3*t.length);for(let i=0,o=t.length;i<o;i++)n.invariantPosition(t[i],Qse),C.toArray(Qse,r,3*i);return r}(e);return Uh.ofPositions(t)}const eae=C.dot,tae=C.copy,gje=C.scaleAndSub,yje=C.scaleAndAdd;class xf{computeExtrema(t,n){const r=eae(this.dir[t],n);r<this.minDist[t]&&(this.minDist[t]=r,tae(this.extrema[2*t],n)),r>this.maxDist[t]&&(this.maxDist[t]=r,tae(this.extrema[2*t+1],n))}computeSphereExtrema(t,n,r){const i=this.dir[t],o=eae(i,n);o-r<this.minDist[t]&&(this.minDist[t]=o-r,gje(this.extrema[2*t],n,i,r)),o+r>this.maxDist[t]&&(this.maxDist[t]=o+r,yje(this.extrema[2*t+1],n,i,r))}includeSphere(t){if(ke.hasExtrema(t)&&t.extrema.length>1)for(const n of t.extrema)this.includePosition(n);else this.includePositionRadius(t.center,t.radius)}includePosition(t){for(let n=0;n<this.dirLength;++n)this.computeExtrema(n,t)}includePositionRadius(t,n){for(let r=0;r<this.dirLength;++r)this.computeSphereExtrema(r,t,n)}finishedIncludeStep(){for(let t=0;t<this.extrema.length;t++)this.centroidHelper.includeStep(this.extrema[t]);this.centroidHelper.finishedIncludeStep()}radiusSphere(t){if(ke.hasExtrema(t)&&t.extrema.length>1)for(const n of t.extrema)this.radiusPosition(n);else this.radiusPositionRadius(t.center,t.radius)}radiusPosition(t){this.centroidHelper.radiusStep(t)}radiusPositionRadius(t,n){this.centroidHelper.radiusSphereStep(t,n)}getSphere(t){return ke.setExtrema(this.centroidHelper.getSphere(t),this.extrema.slice())}getBox(t){return Gt.fromVec3Array(t||Gt(),this.extrema)}reset(){for(let t=0;t<this.dirLength;++t)this.minDist[t]=1/0,this.maxDist[t]=-1/0,this.extrema[2*t]=C(),this.extrema[2*t+1]=C();this.centroidHelper.reset()}constructor(t){this.minDist=[],this.maxDist=[],this.extrema=[],this.centroidHelper=new X0,this.dir=function bje(e){let t;switch(e){case"6":t=[...c5];break;case"14":t=[...c5,...yz];break;case"26":t=[...c5,...yz,...nae];break;case"98":t=[...c5,...yz,...nae,...vje,...xje,..._je]}return t.map(n=>{const r=C.create(n[0],n[1],n[2]);return C.normalize(r,r)})}(t),this.dirLength=this.dir.length,this.reset()}}const c5=[[1,0,0],[0,1,0],[0,0,1]],yz=[[1,1,1],[-1,1,1],[-1,-1,1],[1,-1,1]],nae=[[1,1,0],[1,-1,0],[1,0,1],[1,0,-1],[0,1,1],[0,1,-1]],vje=[[0,1,2],[0,2,1],[1,0,2],[2,0,1],[1,2,0],[2,1,0],[0,1,-2],[0,2,-1],[1,0,-2],[2,0,-1],[1,-2,0],[2,-1,0]],xje=[[1,1,2],[2,1,1],[1,2,1],[1,-1,2],[1,1,-2],[1,-1,-2],[2,-1,1],[2,1,-1],[2,-1,-1],[1,-2,1],[1,2,-1],[1,-2,-1]],_je=[[2,2,1],[1,2,2],[2,1,2],[2,-2,1],[2,2,-1],[2,-2,-1],[1,-2,2],[1,2,-2],[1,-2,-2],[2,-1,2],[2,1,-2],[2,-1,-2]],rae=C.set,Sje=new xf("14"),Cje=new xf("98");function bz(e){const t=Gt.computeBounding(e);return{box:t,sphere:ke.fromBox3D(ke(),t)}}const u5=C();function Q0(e){const{x:t,y:n,z:r,radius:i,indices:o}=e,s=Ve.size(o);if(s>25e4)return bz(e);const a=function wje(e){return e>1e4?Sje:Cje}(s);a.reset();for(let c=0;c<s;c++){const u=Ve.getAt(o,c);rae(u5,t[u],n[u],r[u]),a.includePositionRadius(u5,i&&i[u]||0)}a.finishedIncludeStep();for(let c=0;c<s;c++){const u=Ve.getAt(o,c);rae(u5,t[u],n[u],r[u]),a.radiusPositionRadius(u5,i&&i[u]||0)}const l=a.getSphere();if(!i&&ke.hasExtrema(l)&&s<=l.extrema.length){const c=[];for(let u=0;u<s;u++){const d=Ve.getAt(o,u);c.push(C.create(t[d],n[d],r[d]))}ke.setExtrema(l,c)}return{box:a.getBox(),sphere:l}}class vz{constructor(){this.data=new Map}get(t){const n=rt.hashCode(t);if(this.data.has(n))for(const[r,i]of this.data.get(n))if(rt.areEqual(t,r))return i}set(t,n){const r=rt.hashCode(t);if(this.data.has(r)){const i=this.data.get(r);for(const o of i)if(rt.areEqual(t,o[0]))return void(o[1]=n);i.push([t,n])}else this.data.set(r,[[t,n]])}static get(t){return t._dynamicPropertyData.ElementSetIntraBondCache||(t._dynamicPropertyData.ElementSetIntraBondCache=new vz),t._dynamicPropertyData.ElementSetIntraBondCache}}class xz{get operatorGroups(){return this._operators||(this._operators=this.operatorsProvider()),this._operators}constructor(t,n,r){this.operatorsProvider=r,this.id=t,this.details=n}}var M3,Vs,ze,xw,Dt,Qr,Cz;function Ije(e,t,n,r){const i=e.id.value(n),o=e.details.value(n),s=[],{assembly_id:a,oper_expression:l,asym_id_list:c}=t;for(let u=0,d=t._rowCount;u<d;u++)a.value(u)===i&&(s[s.length]={assemblyId:i,expression:l.value(u),asymIds:c.value(u)});return xz.create(i,o,function Eje(e,t){return()=>{const n=[];let r=0;for(let i=0;i<e.length;i++){const o=e[i],a=Dje(kje(o.expression)),l=Pje(t,a,r,o.assemblyId),c=_i.generators.atoms({chainTest:_i.pred.and(_i.pred.eq(u=>Je.unit.operator_name(u.element),ko.DefaultName),_i.pred.inSet(u=>Je.chain.label_asym_id(u.element),o.asymIds))});n[n.length]={selector:c,operators:l,asymIds:o.asymIds},r+=l.length}return n}}(s,r))}function Dje(e){const t=[],n=[];for(let r=0;r<e.length;r++)n[r]="";return iae(e,t,e.length-1,n),t}function iae(e,t,n,r){if(n<0)return void(t[t.length]=r.slice(0));const i=e[n],o=i.length;for(let s=0;s<o;s++)r[n]=i[s],iae(e,t,n-1,r)}function Pje(e,t,n,r){const i=[];let o=n;for(const s of t){const a=fe.identity();for(let l=0;l<s.length;l++)fe.mul(a,a,e.get(s[l]));o++,i[i.length]=ko.create(`ASM_${o}`,a,{assembly:{id:r,operId:o,operList:s}})}return i}function kje(e){const t=/\(?([^\(\)]+)\)?]*/g,n=[],r=[];let i;for(;i=t.exec(e);)n[n.length]=i[1];return n.forEach(o=>{const s=[];o.split(",").forEach(a=>{const l=a.indexOf("-");if(l>0){const c=parseInt(a.substring(0,l)),u=parseInt(a.substr(l+1));for(let d=c;d<=u;d++)s[s.length]=d.toString()}else s[s.length]=a.trim()}),r[r.length]=s}),r}function Fje(e){if(0===e._rowCount)return;const{id:t,matrix:n,vector:r}=e,i=Nr.struct_ncs_oper.matrix.space,o=Nr.struct_ncs_oper.vector.space,s=[];for(let a=0;a<e._rowCount;a++){const l=mr.toMat3(In(),i,n.value(a)),c=mr.toVec3(C(),o,r.value(a));if(!ko.checkIfRotationAndTranslation(l,c)||"given"===e.code.value(a)&&!In.isIdentity(l)&&!C.isZero(c))continue;const u=t.value(a);s[s.length]=ko.ofRotationAndOffset(`ncs_${u}`,l,c,u)}return s}function Bje(e){const t=e.bonds,{b:n,edgeProps:r,offset:i}=t,{flags:s}=r,{elementAromaticRingIndices:a}=e.rings,l=[],c=new Map,u=new Map,d=(f,p,m)=>{const h=l.length;l.push(rt.ofUnsortedArray([f,p,m])),c.set(v3(f,p),m),u.has(f)?u.get(f).push(h):u.set(f,[h])};for(let f=0;f<e.elements.length;f++){if(a.has(f)||i[f+1]-i[f]+1<2)continue;const m=[];for(let h=i[f],g=i[f+1];h<g;h++)Lr.is(s[h],16)&&m.push(n[h]);if(m.length>=2){d(f,m[0],m[1]);for(let h=1,g=m.length;h<g;h++)d(f,m[h],m[0])}}return{getThirdElement:(f,p)=>c.get(v3(f,p)),getTripletIndices:f=>u.get(f),triplets:l}}function oae(){return{result:xw.create(),closeUnitsResult:ap.create(),unitGroupResult:ap.create()}}!function(e){e.create=function t(n,r,i){return new e(n,r,i)}}(xz||(xz={})),function(e){e.Default={assemblies:[],spacegroup:wd.ZeroP1,isNonStandardCrystalFrame:!1},e.findAssembly=function t(r,i){const o=i.toLocaleLowerCase(),s=Vs.Provider.get(r);return s?NU(s.assemblies,a=>a.id.toLowerCase()===o):void 0},e.getUnitcellLabel=function n(r){const{cell:i,name:o,num:s}=r.spacegroup,{size:a,anglesInRadians:l}=i,c=a[0].toFixed(2),u=a[1].toFixed(2),d=a[2].toFixed(2),f=pf(l[0]).toFixed(2),p=pf(l[1]).toFixed(2),m=pf(l[2]).toFixed(2),h=[];return h.push(`Unit Cell <b>${o}</b> #${s}`),h.push(`${c}\xd7${u}\xd7${d} \u212b`),h.push(`\u03b1=${f}\xb0 \u03b2=${p}\xb0 \u03b3=${m}\xb0`),h.join(" | ")}}(M3||(M3={})),function(e){e.Descriptor={name:"model_symmetry"},e.Provider=jh.create(e.Descriptor),e.fromData=function t(r){const i=function Aje(e,t,n){if(!e._rowCount)return[];const r=function Tje(e){const{id:t,matrix:n,vector:r,_schema:i}=e,o=new Map,s=C();for(let a=0,l=e._rowCount;a<l;a++){const c=mr.toMat4(fe(),i.matrix.space,n.value(a));mr.toVec3(s,i.vector.space,r.value(a)),fe.setTranslation(c,s),fe.setValue(c,3,3,1),o.set(t.value(a),c)}return o}(n),i=[];for(let o=0;o<e._rowCount;o++)i[i.length]=Ije(e,t,o,r);return i}(r.pdbx_struct_assembly,r.pdbx_struct_assembly_gen,r.pdbx_struct_oper_list),o=function Nje(e,t){if(0===e._rowCount||0===t._rowCount)return wd.ZeroP1;const n=t.length_a.value(0),r=t.length_b.value(0),i=t.length_c.value(0);if(0===n||0===r||0===i)return wd.ZeroP1;const o=t.angle_alpha.value(0),s=t.angle_beta.value(0),a=t.angle_gamma.value(0);if(0===o||0===s||0===a)return wd.ZeroP1;const l=function Rje(e){const t=e.Int_Tables_number.value(0),n=e["space_group_name_H-M"].value(0);return e.Int_Tables_number.isDefined?e["space_group_name_H-M"].isDefined?n:t:n}(e),c=Qc.create(l,C.create(n,r,i),C.scale(C(),C.create(o,s,a),Math.PI/180));return wd.create(c)}(r.symmetry,r.cell);return{assemblies:i,spacegroup:o,isNonStandardCrystalFrame:!1,ncsOperators:Fje(r.struct_ncs_oper)}},e.fromCell=function n(r,i){const o=Qc.create("P 1",r,i);return{assemblies:[],spacegroup:wd.create(o),isNonStandardCrystalFrame:!1}}}(Vs||(Vs={})),function(e){let t;var V;function l(V){const X=[];for(let H=0,oe=V.length;H<oe;H++)X.push(V[H].id);return Zc(X)}function c(V){const X={};return{elements:V[0].elements,units:V,get unitIndexMap(){return X.unitIndexMap||(X.unitIndexMap=function a(V){const X=sp.Mutable();for(let H=0,oe=V.length;H<oe;H++)X.set(V[H].id,H);return X}(V)),X.unitIndexMap},hashCode:d(V[0]),transformHash:l(V)}}function d(V){return Yx(V.invariantId,rt.hashCode(V.elements))}let f,p;function h(V){const X=V.coarseConformation.spheres.radius;return H=>X[H]}(V=t=e.Kinds||(e.Kinds={}))[V.Atomic=0]="Atomic",V[V.Spheres=1]="Spheres",V[V.Gaussians=2]="Gaussians",e.isAtomic=function n(V){return 0===V.kind},e.isCoarse=function r(V){return 1===V.kind||2===V.kind},e.isSpheres=function i(V){return 1===V.kind},e.isGaussians=function o(V){return 2===V.kind},e.create=function s(V,X,H,oe,te,K,Q,G,Z){switch(te){case 0:return new y(V,X,H,oe,K,G,ko.createMapping(Q,K.atomicConformation),Z??{});case 1:return E(V,X,H,oe,K,1,G,ko.createMapping(Q,K.coarseConformation.spheres,h(K)),Z??{});case 2:return E(V,X,H,oe,K,2,G,ko.createMapping(Q,K.coarseConformation.gaussians,X=>0),Z??{})}},e.SymmetryGroup=c,function(V){V.areInvariantElementsEqual=function X(oe,te){return oe.hashCode===te.hashCode&&rt.areEqual(oe.elements,te.elements)},V.getUnitSymmetryGroupsIndexMap=function H(oe){const te=sp.Mutable();for(let K=0,Q=oe.length;K<Q;++K){const G=oe[K];for(let Z=0,ee=G.units.length;Z<ee;++Z)te.set(G.units[Z].id,K)}return te}}(c=e.SymmetryGroup||(e.SymmetryGroup={})),e.conformationId=function u(V){return e.isAtomic(V)?V.model.atomicConformation.id:V.model.coarseConformation.id},e.hashUnit=d,function(V){V[V.None=0]="None",V[V.MultiChain=1]="MultiChain",V[V.Partitioned=2]="Partitioned",V[V.FastBoundary=4]="FastBoundary"}(f=e.Trait||(e.Trait={})),function(V){V.is=Mc.has,V.create=Mc.create}(p=e.Traits||(e.Traits={}));class y{getChild(X){return X.length===this.elements.length?this:new y(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,X,this.conformation,{})}applyOperator(X,H,oe=!1){const te=oe?H:ko.compose(this.conformation.operator,H);return new y(X,this.invariantId,this.chainGroupId,this.traits,this.model,this.elements,ko.createMapping(te,this.model.atomicConformation,this.conformation.r),this.props)}remapModel(X,H,oe){var te,K;oe||(oe={...this.props,bonds:!H||null!==(K=null===(te=this.props.bonds)||void 0===te?void 0:te.props)&&void 0!==K&&K.canRemap?R(this,this.props.bonds,X,H):void 0},e.isSameConformation(this,X)||(oe.boundary=void 0,oe.lookup3d=void 0,oe.principalAxes=void 0));let Q=this.conformation.operator;const G=Vs.Provider.get(X);if(-1!==Q.spgrOp&&G&&G!==Vs.Provider.get(this.model)){const[ee,se,xe]=Q.hkl,{toFractional:re}=G.spacegroup.cell,ae=C.transformMat4(C(),Sn.getCenter(X),re);Q=wd.getSymmetryOperatorRef(G.spacegroup,Q.spgrOp,ee,se,xe,ae)}const Z=this.model.atomicConformation!==X.atomicConformation||Q!==this.conformation.operator?ko.createMapping(Q,X.atomicConformation):this.conformation;return new y(this.id,this.invariantId,this.chainGroupId,this.traits,X,this.elements,Z,oe)}get boundary(){if(this.props.boundary)return this.props.boundary;const{x:X,y:H,z:oe}=this.model.atomicConformation;return this.props.boundary=p.is(this.traits,f.FastBoundary)?bz({x:X,y:H,z:oe,indices:this.elements}):Q0({x:X,y:H,z:oe,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;const{x:X,y:H,z:oe}=this.model.atomicConformation;return this.props.lookup3d=zh({x:X,y:H,z:oe,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=Jse(this)),this.props.principalAxes}get bonds(){if(this.props.bonds)return this.props.bonds;const X=vz.get(this.model);let H=X.get(this.elements);return H||(H=function j8e(e,t){const n={...Ise,...t};return n.noCompute||Sn.isCoarseGrained(e.model)&&!nc.Provider.get(e.model)&&!vf.isExhaustive(e.model)?rz.Empty:!n.forceCompute&&nc.Provider.get(e.model)?function B8e(e){const t=nc.Provider.get(e.model),{elements:n}=e,{type_symbol:r}=e.model.atomicHierarchy.atoms,i=e.elements.length,{maxDistance:o}=t,{offset:s,b:a,edgeProps:{order:l,distance:c,flag:u,key:d,operatorA:f,operatorB:p}}=t.bonds,{atomSourceIndex:m}=e.model.atomicHierarchy,{invertedIndex:h}=Sn.getInvertedAtomSourceIndex(e.model),g=[],y=[],v=[],x=[],_=[],w=e.conformation.operator.key;for(let A=0;A<i;A++){const M=n[A],E=ig(r.value(M)),D=K0(E),T=m.value(M);for(let F=s[T],R=s[T+1];F<R;++F){const N=h[a[F]];if(M>=N)continue;const j=rt.indexOf(e.elements,N);if(j<0)continue;const W=f[F],z=p[F];if(W>=0&&W!==w||z>=0&&z!==w)continue;const $=ig(r.value(N)),V=c[F],X=F8e(e,M,N);let H=!1;V>=0?H=Do(X,V,.3):o>=0?H=X<o:(H=X<JR(E,$,_1(E),_1($)),D&&K0($)&&(H=!1)),H&&(g[g.length]=A,y[y.length]=j,x[x.length]=l[F],v[v.length]=u[F],_[_.length]=d[F])}}return Lse(g,y,x,v,_,i,!1)}(e):function L8e(e,t){const{maxRadius:n}=t,{x:r,y:i,z:o}=e.model.atomicConformation,s=e.elements.length,{elements:a,residueIndex:l,chainIndex:c}=e,{type_symbol:u,label_atom_id:d,label_alt_id:f,label_comp_id:p}=e.model.atomicHierarchy.atoms,{label_seq_id:m}=e.model.atomicHierarchy.residues,{index:h}=e.model.atomicHierarchy,{byEntityKey:g}=e.model.sequence,y=e.lookup3d,v=vf.Provider.get(e.model),x=t_.Provider.get(e.model),_=vf.isExhaustive(e.model),w=[],A=[],M=[],E=[],D=[];let F,T=-1,R=!0,N=!0,j=!0;const W=O8e;for(let $=0;$<s;$++){const V=a[$],X=u.value(V);R&&"H"!==X&&"O"!==X&&(R=!1);const H=t.forceCompute?void 0:v&&v.byAtomIndex.get(V);let oe=!1;if(H)for(const Ae of H){const{partnerA:he,partnerB:ie}=Ae;if(he.symmetry!==ie.symmetry)continue;const _e=rt.indexOf(e.elements,(he.atomIndex===V?ie:he).atomIndex);_e<0||a[_e]<V||(w[w.length]=$,A[A.length]=_e,M[M.length]=Ae.flags,E[E.length]=Ae.order,D[D.length]=Ae.rowIndex,oe||W.clear(),oe=!0,W.add(_e))}if(_)continue;const te=l[V],K=m.value(te),Q=p.value(V);if(!t.forceCompute&&te!==T)if(x&&x.entries.has(Q)){const Ae=g[h.getEntityFromChain(c[V])];F=Ae&&Ae.sequence.microHet.has(K)?void 0:x.entries.get(Q).map}else F=void 0;T=te;const G=ig(X),Z=d.value(V),ee=F?F.get(Z):void 0,{indices:se,count:xe,squaredDistances:re}=y.find(r[V],i[V],o[V],n),ae=K0(G),ge=_1(G),Ie=f.value(V),me=D3.has(G);for(let Ae=0;Ae<xe;Ae++){const he=se[Ae];if(oe&&W.has(he))continue;const ie=a[he];if(ie<=V)continue;const ue=f.value(ie);if(Ie&&ue&&Ie!==ue)continue;const _e=ig(u.value(ie)),Fe=K0(_e);if(ae&&Fe)continue;const Ze=(me||D3.has(_e))&&!(ae||Fe),ct=l[ie];if(te===ct&&ee){const be=ee.get(d.value(ie));if(be){w[w.length]=$,A[A.length]=he,E[E.length]=be.order;let Ce=be.flags;Ze&&(1|Ce&&(Ce^=1),Ce|=2),M[M.length]=Ce,D[D.length]=be.key}continue}const q=Math.sqrt(re[Ae]);if(0!==q&&q<=JR(G,_e,ge,_1(_e))){w[w.length]=$,A[A.length]=he,E[E.length]=j6e(Q,Z,d.value(ie)),M[M.length]=32|(Ze?2:1),D[D.length]=-1;const be=m.value(ct);K===be&&(N=!1),Math.abs(K-be)>1&&(j=!1)}}}return Lse(w,A,E,M,D,s,R||N&&j)}(e,n)}(this),X.set(this.elements,H)),this.props.bonds=H,this.props.bonds}get rings(){return this.props.rings||(this.props.rings=l5.create(this)),this.props.rings}get resonance(){return this.props.resonance||(this.props.resonance=function Oje(e){return{delocalizedTriplets:Bje(e)}}(this)),this.props.resonance}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=function cje(e){const t=[],{elements:n,model:r}=e,{residueAtomSegments:i}=e.model.atomicHierarchy,{traceElementIndex:o}=r.atomicHierarchy.derived.residue,s=Di.transientSegments(e.model.atomicRanges.polymerRanges,n),a=En.transientSegments(i,n);for(;s.hasNext;){const l=s.move();for(a.setSegment(l);a.hasNext;){const c=a.move(),{start:u,end:d,index:f}=c;if(Ve.areIntersecting(Pe.ofRange(n[u],n[d-1]),n)){const p=o[f];t.push(-1===p?i.offsets[f]:p)}}}return rt.ofSortedArray(t)}(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=function dje(e){const t=[],{elements:n,model:r,residueIndex:i}=e,{residueAtomSegments:o}=e.model.atomicHierarchy,{traceElementIndex:s}=r.atomicHierarchy.derived.residue,a=Di.transientSegments(e.model.atomicRanges.gapRanges,e.elements);for(;a.hasNext;){const l=a.move(),c=i[n[l.start]],u=i[n[l.end-1]],d=s[c],f=s[u];t.push(-1===d?o.offsets[c]:d),t.push(-1===f?o.offsets[u]:f)}return rt.ofSortedArray(t)}(this)),this.props.gapElements}get nucleotideElements(){return this.props.nucleotideElements||(this.props.nucleotideElements=function pje(e){const t=[],{elements:n,model:r}=e,{chainAtomSegments:i,residueAtomSegments:o}=r.atomicHierarchy,{moleculeType:s,traceElementIndex:a}=r.atomicHierarchy.derived.residue,l=En.transientSegments(i,n),c=En.transientSegments(o,n);for(;l.hasNext;)for(c.setSegment(l.move());c.hasNext;){const{index:u}=c.move();if(Fu(s[u])){const d=a[u];t.push(-1===d?o.offsets[u]:d)}}return rt.ofSortedArray(t)}(this)),this.props.nucleotideElements}get proteinElements(){return this.props.proteinElements||(this.props.proteinElements=function hje(e){const t=[],{elements:n,model:r}=e,{chainAtomSegments:i,residueAtomSegments:o}=r.atomicHierarchy,{moleculeType:s,traceElementIndex:a}=r.atomicHierarchy.derived.residue,l=En.transientSegments(i,n),c=En.transientSegments(o,n);for(;l.hasNext;)for(c.setSegment(l.move());c.hasNext;){const{index:u}=c.move();if(wse(s[u])){const d=a[u];t.push(-1===d?o.offsets[u]:d)}}return rt.ofSortedArray(t)}(this)),this.props.proteinElements}get residueCount(){if(void 0!==this.props.residueCount)return this.props.residueCount;let X=0;const H=En.transientSegments(this.model.atomicHierarchy.residueAtomSegments,this.elements);for(;H.hasNext;)H.move(),X+=1;return this.props.residueCount=X,this.props.residueCount}getResidueIndex(X){return this.residueIndex[this.elements[X]]}constructor(X,H,oe,te,K,Q,G,Z){this.kind=0,this.objectPrimitive="atomistic",this.id=X,this.invariantId=H,this.chainGroupId=oe,this.traits=te,this.model=K,this.elements=Q,this.conformation=G,this.residueIndex=K.atomicHierarchy.residueAtomSegments.index,this.chainIndex=K.atomicHierarchy.chainAtomSegments.index,this.props=Z}}e.Atomic=y;class x{getChild(X){return X.length===this.elements.length?this:E(this.id,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,X,this.conformation,{})}applyOperator(X,H,oe=!1){const te=oe?H:ko.compose(this.conformation.operator,H);return E(X,this.invariantId,this.chainGroupId,this.traits,this.model,this.kind,this.elements,ko.createMapping(te,this.getCoarseConformation(),this.conformation.r),this.props)}remapModel(X,H,oe){const te=this.getCoarseConformation(),K=_(this.kind,X);oe||(oe={...this.props},e.isSameConformation(this,X)||(oe.boundary=void 0,oe.lookup3d=void 0,oe.principalAxes=void 0));const Q=te!==K?ko.createMapping(this.conformation.operator,K,1===this.kind?h(X):X=>0):this.conformation;return new x(this.id,this.invariantId,this.chainGroupId,this.traits,X,this.kind,this.elements,Q,oe)}get boundary(){if(this.props.boundary)return this.props.boundary;const{x:X,y:H,z:oe}=this.getCoarseConformation();return this.props.boundary=p.is(this.traits,f.FastBoundary)?bz({x:X,y:H,z:oe,indices:this.elements}):Q0({x:X,y:H,z:oe,indices:this.elements}),this.props.boundary}get lookup3d(){if(this.props.lookup3d)return this.props.lookup3d;const{x:X,y:H,z:oe}=this.getCoarseConformation();return this.props.lookup3d=zh({x:X,y:H,z:oe,indices:this.elements},this.boundary),this.props.lookup3d}get principalAxes(){return this.props.principalAxes||(this.props.principalAxes=Jse(this)),this.props.principalAxes}get polymerElements(){return this.props.polymerElements||(this.props.polymerElements=function uje(e){const t=[],{elements:n,model:r}=e,{spheres:i,gaussians:o}=r.coarseHierarchy,s=ze.isSpheres(e)?i.polymerRanges:o.polymerRanges,a=Di.transientSegments(s,n);for(;a.hasNext;){const{start:l,end:c}=a.move();for(let u=l;u<c;++u)t.push(n[u])}return rt.ofSortedArray(t)}(this)),this.props.polymerElements}get gapElements(){return this.props.gapElements||(this.props.gapElements=function fje(e){const t=[],{elements:n,model:r}=e,{spheres:i,gaussians:o}=r.coarseHierarchy,s=ze.isSpheres(e)?i.gapRanges:o.gapRanges,a=Di.transientSegments(s,n);for(;a.hasNext;){const{start:l,end:c}=a.move();t.push(n[l],n[c-1])}return rt.ofSortedArray(t)}(this)),this.props.gapElements}getCoarseConformation(){return _(this.kind,this.model)}constructor(X,H,oe,te,K,Q,G,Z,ee){this.kind=Q,this.objectPrimitive=1===Q?"sphere":"gaussian",this.id=X,this.invariantId=H,this.chainGroupId=oe,this.traits=te,this.model=K,this.elements=G,this.conformation=Z,this.coarseElements=1===Q?K.coarseHierarchy.spheres:K.coarseHierarchy.gaussians,this.coarseConformation=1===Q?K.coarseConformation.spheres:K.coarseConformation.gaussians,this.props=ee}}function _(V,X){return 1===V?X.coarseConformation.spheres:X.coarseConformation.gaussians}function E(V,X,H,oe,te,K,Q,G,Z){return new x(V,X,H,oe,te,K,Q,G,Z)}function R(V,X,H,oe){var te;if(!X)return;if(V.model.atomicConformation.id===H.atomicConformation.id)return X;const K=nc.Provider.get(V.model);if(K){const Q=nc.Provider.get(H);return Q&&K!==Q?void 0:X}return null!==(te=X.props)&&void 0!==te&&te.canRemap||!oe||N(V,H)?X:void 0}function N(V,X){const H=Sn.CoordinatesHistory.get(Sn.getRoot(X));if(H)return H.areEqual(V.elements,V.kind,X);const oe=V.elements,{x:te,y:K,z:Q}=V.conformation.coordinates,{x:G,y:Z,z:ee}=j(V.kind,X);for(let se=0,xe=oe.length;se<xe;se++){const re=oe[se];if(te[re]!==G[re]||K[re]!==Z[re]||Q[re]!==ee[re])return!1}return!0}function j(V,X){return 0===V?X.atomicConformation:1===V?X.coarseConformation.spheres:X.coarseConformation.gaussians}function z(V,X){return 0===V?X.atomicHierarchy:1===V?X.coarseHierarchy.spheres:X.coarseHierarchy.gaussians}e.Spheres=class A extends x{},e.Gaussians=class M extends x{},e.areSameChainOperatorGroup=function D(V,X){return V.chainGroupId===X.chainGroupId&&V.conformation.operator.name===X.conformation.operator.name},e.areOperatorsEqual=function T(V,X){return fe.areEqual(V.conformation.operator.matrix,X.conformation.operator.matrix,1e-6)},e.areConformationsEqual=function F(V,X){return V===X||!!rt.areEqual(V.elements,X.elements)&&N(V,X.model)},e.isSameConformation=N,e.getModelConformationOfKind=j,e.getConformation=function W(V){return j(V.kind,V.model)},e.getModelHierarchyOfKind=z,e.getHierarchy=function $(V){return z(V.kind,V.model)}}(ze||(ze={})),function(e){e.add=function t(i,o,s,a){i.indices[i.count]=s,i.units[i.count]=o,i.squaredDistances[i.count]=a,i.count++},e.create=function n(){return{count:0,indices:[],units:[],squaredDistances:[]}},e.copy=function r(i,o){for(let s=0;s<o.count;++s)i.indices[s]=o.indices[s],i.units[s]=o.units[s],i.squaredDistances[s]=o.squaredDistances[s];return i.count=o.count,i}}(xw||(xw={}));class Lje{findUnitIndices(t,n,r,i){return this.unitLookup.find(t,n,r,i)}find(t,n,r,i,o){return this._find(t,n,r,i,o??this.findContext)}_find(t,n,r,i,o){ap.reset(o.result);const{units:s}=this.structure,a=this.unitLookup.find(t,n,r,i,o.closeUnitsResult);if(0===a.count)return o.result;for(let l=0,c=a.count;l<c;l++){const u=s[a.indices[l]];C.set(this.pivot,t,n,r),u.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse);const f=u.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],i,o.unitGroupResult);for(let p=0,m=f.count;p<m;p++)xw.add(o.result,u,f.indices[p],f.squaredDistances[p])}return o.result}nearest(t,n,r,i=1,o){return this._nearest(t,n,r,i,o??this.findContext)}_nearest(t,n,r,i,o){const s=o.result,a=this.heap;ap.reset(s),a.clear();const{units:l}=this.structure;let c=0;const u=this.unitLookup.nearest(t,n,r,l.length,p=>(c+=l[p].elements.length)>=i,o.closeUnitsResult);if(0===u.count)return s;let d=0,f=-Number.MAX_VALUE;for(let p=0,m=u.count;p<m&&!(d>=i&&f<u.squaredDistances[p]);p++){C.set(this.pivot,t,n,r);const g=l[u.indices[p]];g.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,g.conformation.operator.inverse);const v=g.lookup3d.nearest(this.pivot[0],this.pivot[1],this.pivot[2],i,void 0,o.unitGroupResult);if(0!==v.count){d+=v.count,f=Math.max(f,v.squaredDistances[v.count-1]);for(let x=0,_=v.count;x<_;x++)a.insert(v.squaredDistances[x],{index:v.indices[x],unit:g})}}if(1===i){const p=a.findMinimum();if(p){const{key:m}=p,{unit:h,index:g}=p.value;xw.add(s,h,g,m)}}else for(;!a.isEmpty()&&s.count<i;){const p=a.extractMinimum(),{key:m}=p,{unit:h,index:g}=p.value;xw.add(s,h,g,m)}return s}findIntoBuilder(t,n,r,i,o){const{units:s}=this.structure,a=this.unitLookup.find(t,n,r,i);if(0!==a.count)for(let l=0,c=a.count;l<c;l++){const u=s[a.indices[l]];C.set(this.pivot,t,n,r),u.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,u.conformation.operator.inverse);const f=u.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(0===f.count)continue;const p=u.elements;o.beginUnit(u.id);for(let m=0,h=f.count;m<h;m++)o.addElement(p[f.indices[m]]);o.commitUnit()}}findIntoBuilderIf(t,n,r,i,o,s){const{units:a}=this.structure,l=this.unitLookup.find(t,n,r,i);if(0===l.count)return;const c=dt.create(this.structure);for(let u=0,d=l.count;u<d;u++){const f=a[l.indices[u]];C.set(this.pivot,t,n,r),f.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,f.conformation.operator.inverse);const m=f.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],i);if(0===m.count)continue;const h=f.elements;c.unit=f,o.beginUnit(f.id);for(let g=0,y=m.count;g<y;g++)c.element=h[m.indices[g]],s(c)&&o.addElement(c.element);o.commitUnit()}}findIntoBuilderWithRadius(t,n,r,i,o,s,a,l){const{units:c}=this.structure,u=this.unitLookup.find(t,n,r,s);if(0===u.count)return;const d=dt.create(this.structure),f=i+o+s;for(let p=0,m=u.count;p<m;p++){const h=c[u.indices[p]];C.set(this.pivot,t,n,r),h.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,h.conformation.operator.inverse);const y=h.lookup3d.find(this.pivot[0],this.pivot[1],this.pivot[2],f);if(0===y.count)continue;const v=h.elements;d.unit=h,l.beginUnit(h.id);for(let x=0,_=y.count;x<_;x++){d.element=v[y.indices[x]];const w=a(d);Math.sqrt(y.squaredDistances[x])-i-w>s||l.addElement(v[y.indices[x]])}l.commitUnit()}}check(t,n,r,i){const{units:o}=this.structure,s=this.unitLookup.find(t,n,r,i);if(0===s.count)return!1;for(let a=0,l=s.count;a<l;a++){const c=o[s.indices[a]];if(C.set(this.pivot,t,n,r),c.conformation.operator.isIdentity||C.transformMat4(this.pivot,this.pivot,c.conformation.operator.inverse),c.lookup3d.check(this.pivot[0],this.pivot[1],this.pivot[2],i))return!0}return!1}get boundary(){return this.structure.boundary}constructor(t){this.structure=t,this.pivot=C(),this.heap=new Koe,this.findContext=oae();const{units:n,boundary:r}=t,i=n.length,o=new Float32Array(i),s=new Float32Array(i),a=new Float32Array(i),l=new Float32Array(i),c=C();for(let d=0;d<i;d++){const f=n[d],p=f.boundary.sphere;C.transformMat4(c,p.center,f.conformation.operator.matrix),o[d]=c[0],s[d]=c[1],a[d]=c[2],l[d]=p.radius}const u={x:o,y:s,z:a,radius:l,indices:Ve.ofBounds(0,i)};this.unitLookup=zh(u,r)}}function R3(e,t){if(0===t.length)return Xe.Empty;if(1===t.length)return t[0];const n=new Map,r=new Set;for(const{units:o}of t)for(let s=0,a=o.length;s<a;s++){const l=o[s];if(n.has(l.id)){if(r.has(l.id))continue;const c=rt.union(n.get(l.id),l.elements);n.set(l.id,c),c.length===e.unitMap.get(l.id).elements.length&&r.add(l.id)}else n.set(l.id,l.elements),l.elements.length===e.unitMap.get(l.id).elements.length&&r.add(l.id)}const i=e.subsetBuilder(!0);return n.forEach(jje,i),i.getStructure()}function jje(e,t){this.setUnit(t,e)}function Uje(e,t){if(e===t)return!0;if(e.units.length!==t.units.length)return!1;const n=e.units,r=t.unitMap;for(let i=0,o=n.length;i<o;i++){const s=n[i];if(!r.has(s.id))return!1;const a=r.get(s.id);if(!rt.areEqual(s.elements,a.elements))return!1}return!0}function d5(e,t){if(e===t)return!0;let n,r;e.units.length<t.units.length?(n=e,r=t):(n=t,r=e);const i=n.units,o=r.unitMap;for(let s=0,a=i.length;s<a;s++){const l=i[s];if(!o.has(l.id))continue;const c=o.get(l.id);if(rt.areIntersecting(l.elements,c.elements))return!0}return!1}function sae(e,t){if(e===t)return e;if(!d5(e,t))return Xe.Empty;let n,r;e.units.length<t.units.length?(n=e,r=t):(n=t,r=e);const i=n.units,o=r.unitMap,s=[];for(let a=0,l=i.length;a<l;a++){const c=i[a];if(!o.has(c.id))continue;const u=o.get(c.id);if(rt.areIntersecting(c.elements,u.elements)){const d=rt.intersect(c.elements,u.elements);s[s.length]=c.getChild(d)}}return Xe.create(s,{parent:e.parent||t.parent})}function _z(e,t){if(e===t)return Xe.Empty;if(!d5(e,t))return e;const n=e.units,r=t.unitMap,i=[];for(let o=0,s=n.length;o<s;o++){const a=n[o];if(!r.has(a.id)){i[i.length]=a;continue}const l=r.get(a.id),c=rt.subtract(a.elements,l.elements);c.length>0&&(i[i.length]=a.getChild(c))}return Xe.create(i,{parent:e.parent||t.parent})}function Sz(e){return Lr.isCovalent(e.atomicBond.type)}function zje(){return function(t){const{inputStructure:n}=t,r=dt.create(n),i=[];for(const o of n.units){if(0!==o.kind)continue;r.unit=o;const s=o.elements;if(r.element=s[0],"polymer"!==Je.entity.type(r))continue;const a=En.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);let l=0;for(;a.hasNext;)l++,a.move();l<8||i.push(o)}return Dt.Singletons(n,Xe.create(i,{parent:n}))}}function Vje(){return function(t){const{inputStructure:n}=t,r=dt.create(n),i=[];for(const o of n.units)0===o.kind&&(r.unit=o,r.element=o.elements[0],"water"===Je.entity.type(r)&&i.push(o));return Dt.Singletons(n,Xe.create(i,{parent:n}))}}function Hje(){return function(t){const{inputStructure:n}=t,r=dt.create(n),i=[];for(const o of n.units){if(0!==o.kind)continue;r.unit=o;const s=o.elements;if(r.element=s[0],"water"!==Je.entity.type(r)){if("polymer"===Je.entity.type(r)){const a=En.transientSegments(o.model.atomicHierarchy.residueAtomSegments,s);let l=0;for(;a.hasNext;)l++,a.move();if(l>=8)continue}i.push(o)}}return Dt.Singletons(n,Xe.create(i,{parent:n}))}}function Gje(){return function(t){const{inputStructure:n}=t,r=[];for(const i of n.units)1===i.kind&&r.push(i);return Dt.Singletons(n,Xe.create(r,{parent:n}))}}function aae(e,t,n){return{groupedUnits:e,ranges:t,set:n}}function lae(e){return function(n){return Dt.Sequence(n.inputStructure,[Qr.toStructure({hash:n.inputStructure.hashCode,elements:e},n.inputStructure)])}}!function(e){function t(y,v){return{kind:"singletons",source:y,structure:v}}function n(y,v){return{kind:"sequence",source:y,structures:v}}function r(y){return t(y,Xe.Empty)}function i(y){return"singletons"===y.kind}function o(y){return i(y)?0===y.structure.units.length:0===y.structures.length}function a(y){return o(y)?Xe.Empty:i(y)?y.structure:R3(y.source,y.structures)}function u(y,v,x){return 0===v.length?r(y):x?t(y,R3(y,v)):n(y,v)}e.Singletons=t,e.Sequence=n,e.Empty=r,e.isSingleton=i,e.isEmpty=o,e.structureCount=function s(y){return i(y)?y.structure.elementCount:y.structures.length},e.unionStructure=a,e.toLociWithCurrentUnits=function l(y){const v=[],{unitMap:x}=y.source;for(const _ of a(y).units)v[v.length]=_===x.get(_.id)?{unit:_,indices:Ve.ofBounds(0,_.elements.length)}:{unit:_,indices:Ve.ofSortedArray(rt.indicesOf(x.get(_.id).elements,_.elements))};return Me(y.source,v)},e.toLociWithSourceUnits=function c(y){const v=[],{unitMap:x}=y.source;for(const _ of a(y).units){const w=x.get(_.id);v[v.length]=w===_?{unit:w,indices:Ve.ofBounds(0,w.elements.length)}:{unit:w,indices:Ve.ofSortedArray(rt.indicesOf(w.elements,_.elements))}}return Me(y.source,v)};class d{add(v){const x=v.elementCount;0!==x&&(this.structures[this.structures.length]=v,1!==x&&(this.allSingletons=!1))}getSelection(){return u(this.source,this.structures,this.allSingletons)}constructor(v){this.source=v,this.structures=[],this.allSingletons=!0}}class f{add(v){const x=v.elementCount;0===x||!this.uniqueSets.add(v)||(this.structures[this.structures.length]=v,1!==x&&(this.allSingletons=!1))}getSelection(){return u(this.structure,this.structures,this.allSingletons)}constructor(v){this.structure=v,this.structures=[],this.allSingletons=!0,this.uniqueSets=XU(Xe.hashCode,Xe.areUnitIdsAndIndicesEqual)}}e.LinearBuilder=function p(y){return new d(y)},e.UniqueBuilder=function m(y){return new f(y)},e.forEach=function h(y,v){let x=0;if(e.isSingleton(y))for(const _ of y.structure.units){const{elements:w}=_;for(let A=0,M=w.length;A<M;A++)v(Xe.create([_.getChild(rt.ofSingleton(w[A]))],{parent:y.source}),x++)}else for(const _ of y.structures)v(_,x++)},e.withInputStructure=function g(y,v){return i(y)?t(v,y.structure):n(v,y.structures)}}(Dt||(Dt={})),function(e){function r(u){const d=[];for(const m of u.elements){const{unit:h,indices:g}=m;if(0===Ve.size(g))continue;const y=[],v=[];if(Ve.isInterval(g))1===Ve.size(g)?v.push(Pe.min(g)):y.push(Pe.min(g),Pe.max(g));else{let x=0;const _=g.length;for(;x<_;){const w=x;for(x++;x<_&&g[x-1]+1===g[x];)x++;const A=x;if(A-w>2)y.push(g[w],g[A-1]);else for(let M=w;M<A;M++)v[v.length]=g[M]}}d.push({unit:h,set:rt.ofSortedArray(v),ranges:Di.ofSortedRanges(y)})}const f=new Map;for(let m=0,h=d.length;m<h;++m){const g=d[m],y=Yx(Zc(g.ranges),Zc(g.set));if(f.has(y)){const{groupedUnits:v}=f.get(y);v.has(g.unit.invariantId)?v.get(g.unit.invariantId).push(g.unit.id):v.set(g.unit.invariantId,[g.unit.id])}else{const v=new Map;v.set(g.unit.invariantId,[g.unit.id]),f.set(y,{groupedUnits:v,set:g.set,ranges:g.ranges})}}const p=[];return f.forEach(m=>{const h=[];m.groupedUnits.forEach(g=>h.push(rt.ofUnsortedArray(g))),h.sort((g,y)=>g[0]-y[0]),p.push({groupedUnits:h,set:m.set,ranges:m.ranges})}),{hash:u.structure.hashCode,elements:p}}function i(u,d){const f=[];for(let p=0,m=u.length;p<m;++p){const h=u[p];d.unitMap.has(h)&&f.push(d.unitMap.get(h))}return f}function a(u){return pe.internal.generator.bundleElement({groupedUnits:pe.core.type.list(u.groupedUnits.map(d=>pe.core.type.list(d))),ranges:pe.core.type.list(u.ranges),set:pe.core.type.list(u.set)})}e.Empty={hash:-1,elements:[]},e.fromSubStructure=function t(u,d){return r(Dt.toLociWithSourceUnits(Dt.Singletons(u,d)))},e.fromSelection=function n(u){return r(Dt.toLociWithSourceUnits(u))},e.fromLoci=r,e.toLoci=function o(u,d){-1!==u.hash&&u.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");const f=[];for(const p of u.elements)for(const m of p.groupedUnits){const h=i(m,d);if(0===h.length)continue;let g;if(0===p.ranges.length)g=p.set;else if(0===p.set.length)if(2===p.ranges.length)g=Pe.ofRange(p.ranges[0],p.ranges[1]);else{const y=new Int32Array(Di.size(p.ranges));Di.forEach(p.ranges,(v,x)=>y[x]=v),g=rt.ofSortedArray(y)}else{const y=Di.size(p.ranges),v=new Int32Array(p.set.length+y);Di.forEach(p.ranges,(x,_)=>v[_]=x),v.set(p.set,y),g=rt.ofUnsortedArray(v)}for(const y of h)f.push({unit:y,indices:g})}return Me(d,f)},e.toStructure=function s(u,d){-1!==u.hash&&u.hash!==d.hashCode&&new Error("Bundle not compatible with given structure");const f=[];for(const p of u.elements)for(const m of p.groupedUnits){const h=i(m,d);if(0===h.length)continue;const g=h[0].elements,y=Di.size(p.ranges),v=p.set.length,x=new Int32Array(v+y);let _;if(0===y){for(let w=0,A=v;w<A;++w)x[w]=g[p.set[w]];_=rt.ofSortedArray(x)}else if(0===v)Di.forEach(p.ranges,(w,A)=>x[A]=g[w]),_=rt.ofSortedArray(x);else if(rt.min(p.set)>Di.max(p.ranges)){Di.forEach(p.ranges,(w,A)=>x[A]=g[w]);for(let w=0,A=v;w<A;++w)x[w+y]=g[p.set[w]];_=rt.ofSortedArray(x)}else if(Di.min(p.ranges)>rt.max(p.set)){for(let w=0,A=v;w<A;++w)x[w]=g[p.set[w]];Di.forEach(p.ranges,(w,A)=>x[A+v]=g[w]),_=rt.ofSortedArray(x)}else{Di.forEach(p.ranges,(w,A)=>x[A]=g[w]);for(let w=0,A=v;w<A;++w)x[w+y]=g[p.set[w]];_=rt.ofUnsortedArray(x)}for(const w of h)f.push(w.getChild(_))}return Xe.create(f,{parent:d})},e.toExpression=function l(u){return pe.internal.generator.bundle({elements:pe.core.type.list(u.elements.map(a))})},e.areEqual=function c(u,d){if(u.elements.length!==d.elements.length)return!1;for(let f=0,p=u.elements.length;f<p;++f){const m=u.elements[f],h=d.elements[f];if(m.groupedUnits.length!==h.groupedUnits.length)return!1;for(let g=0,y=h.groupedUnits.length;g<y;++g)if(!rt.areEqual(m.groupedUnits[g],h.groupedUnits[g]))return!1;if(!rt.areEqual(m.set,h.set)||!Di.areEqual(m.ranges,h.ranges))return!1}return!0}}(Qr||(Qr={}));class _f{pushCurrentElement(){return this.currentElementStack[this.currentElementStack.length]=this.element,this.element=dt.create(void 0),this.element}popCurrentElement(){this.element=this.currentElementStack.pop()}pushCurrentBond(){return this.atomicBond&&this.currentAtomicBondStack.push(this.atomicBond),this.atomicBond=new cae,this.atomicBond}popCurrentBond(){this.atomicBond=this.currentAtomicBondStack.length>0?this.currentAtomicBondStack.pop():void 0}pushCurrentStructure(){this.currentStructure&&this.currentStructureStack.push(this.currentStructure)}popCurrentStructure(){this.currentStructure=this.currentStructureStack.length?this.currentStructureStack.pop():void 0}pushInputStructure(t){this.inputStructureStack.push(this.inputStructure),this.inputStructure=t}popInputStructure(){if(0===this.inputStructureStack.length)throw new Error("Must push before pop.");this.inputStructure=this.inputStructureStack.pop()}throwIfTimedOut(){if(0!==this.timeoutMs&&Bo()-this.timeCreated>this.timeoutMs)throw new Error(`The query took too long to execute (> ${this.timeoutMs/1e3}s).`)}tryGetCurrentSelection(){if(!this.currentSelection)throw new Error("The current selection is not assigned.");return this.currentSelection}constructor(t,n){this.currentElementStack=[],this.currentAtomicBondStack=[],this.currentStructureStack=[],this.inputStructureStack=[],this.timeCreated=Bo(),this.element=dt.create(void 0),this.currentStructure=void 0,this.atomicBond=new cae,this.currentSelection=void 0,this.inputStructure=t,this.timeoutMs=n&&n.timeoutMs||0,this.currentSelection=n&&n.currentSelection}}class cae{constructor(){this.a=dt.create(void 0),this.aIndex=0,this.b=dt.create(void 0),this.bIndex=0,this.type=0,this.order=0,this.key=-1,this.testFn=Sz}setStructure(t){this.a.structure=t,this.b.structure=t}setTestFn(t){this.testFn=t||Sz}test(t,n){return!!this.testFn(t)||!!n&&(this.swap(),this.testFn(t))}swap(){const t=this.aIndex;this.aIndex=this.bIndex,this.bIndex=t;const n=this.a.unit;this.a.unit=this.b.unit,this.b.unit=n;const r=this.a.element;this.a.element=this.b.element,this.b.element=r}get length(){return dt.distance(this.a,this.b)}}!function(e){e.run=function t(n,r,i){return n(new _f(r,i))}}(Cz||(Cz={}));class wz{add(t){t.elementCount&&(1!==t.elementCount&&(this.allSingletons=!1),this.set.add(t)&&(this.structures[this.structures.length]=t))}getSelection(){return this.allSingletons?Dt.Singletons(this.source,R3(this.source,this.structures)):Dt.Sequence(this.source,this.structures)}constructor(t){this.source=t,this.set=XU(Xe.hashCode,Xe.areUnitIdsAndIndicesEqual),this.structures=[],this.allSingletons=!0}}class qje{add(t,n,r){let i=this.builderMap.get(t);i||(i=this.source.subsetBuilder(!0),this.builders[this.builders.length]=i,this.builderMap.set(t,i)),i.addToUnit(n,r)}allSingletons(){for(let t=0,n=this.builders.length;t<n;t++)if(this.builders[t].elementCount>1)return!1;return!0}singletonSelection(){const t=this.source.subsetBuilder(!0),n=dt.create(this.source);for(let r=0,i=this.builders.length;r<i;r++)this.builders[r].setSingletonLocation(n),t.addToUnit(n.unit.id,n.element);return Dt.Singletons(this.source,t.getStructure())}fullSelection(){const t=new Array(this.builders.length);for(let n=0,r=this.builders.length;n<r;n++)t[n]=this.builders[n].getStructure();return Dt.Sequence(this.source,t)}getSelection(){return 0===this.builders.length?Dt.Empty(this.source):this.allSingletons()?this.singletonSelection():this.fullSelection()}constructor(t){this.source=t,this.builders=[],this.builderMap=new Map}}const Az=e=>Dt.Sequence(e.inputStructure,[]),uae=e=>Dt.Singletons(e.inputStructure,e.inputStructure);function Wje(e){return Iz({...e,groupBy:t=>Je.residue.key(t.element)})}function $je(e){return Iz({...e,groupBy:t=>Je.chain.key(t.element)})}function A1(e){return!0}function Yje(e){return 0}function Iz(e){if(!e||!(e.atomTest||e.residueTest||e.chainTest||e.entityTest||e.unitTest||e.groupBy))return uae;if(e.atomTest&&!e.residueTest&&!e.chainTest&&!e.entityTest&&!e.unitTest&&!e.groupBy)return function Xje(e){return function(n){const{inputStructure:r}=n,{units:i}=r,o=n.pushCurrentElement(),s=r.subsetBuilder(!0);o.structure=r;for(const a of i){o.unit=a;const l=a.elements;s.beginUnit(a.id);for(let c=0,u=l.length;c<u;c++)o.element=l[c],e(n)&&s.addElement(o.element);s.commitUnit(),n.throwIfTimedOut()}return n.popCurrentElement(),Dt.Singletons(r,s.getStructure())}}(e.atomTest);const t={unitTest:e.unitTest||A1,entityTest:e.entityTest||A1,chainTest:e.chainTest||A1,residueTest:e.residueTest||A1,atomTest:e.atomTest||A1,groupBy:e.groupBy||Yje};return e.groupBy?function Zje({unitTest:e,entityTest:t,chainTest:n,residueTest:r,atomTest:i,groupBy:o}){return function(a){const{inputStructure:l}=a,{units:c}=l,u=a.pushCurrentElement(),d=new qje(l);u.structure=l;for(const f of c){if(u.unit=f,!e(a))continue;const{elements:p,model:m}=f;if(0===f.kind){const h=En.transientSegments(m.atomicHierarchy.chainAtomSegments,p),g=En.transientSegments(m.atomicHierarchy.residueAtomSegments,p);for(;h.hasNext;){const y=h.move();if(u.element=p[y.start],t(a)&&n(a))for(g.setSegment(y);g.hasNext;){const v=g.move();if(u.element=p[v.start],r(a))for(let x=v.start,_=v.end;x<_;x++)u.element=p[x],i(a)&&d.add(o(a),f.id,u.element)}}}else{const{chainElementSegments:h}=m.coarseHierarchy.spheres,g=En.transientSegments(h,p);for(;g.hasNext;){const y=g.move();if(u.element=p[y.start],t(a)&&n(a))for(let v=y.start,x=y.end;v<x;v++)u.element=p[v],r(a)&&d.add(o(a),f.id,u.element)}}a.throwIfTimedOut()}return a.popCurrentElement(),d.getSelection()}}(t):function Kje({unitTest:e,entityTest:t,chainTest:n,residueTest:r,atomTest:i}){return function(s){const{inputStructure:a}=s,{units:l}=a,c=s.pushCurrentElement(),u=a.subsetBuilder(!0),d=r===A1&&i===A1,f=i===A1;c.structure=a;for(const p of l){if(c.unit=p,!e(s))continue;const{elements:m,model:h}=p;if(u.beginUnit(p.id),0===p.kind){const g=En.transientSegments(p.model.atomicHierarchy.chainAtomSegments,m),y=En.transientSegments(p.model.atomicHierarchy.residueAtomSegments,m);for(;g.hasNext;){const v=g.move();if(c.element=m[v.start],t(s)&&n(s)){if(d){u.addElementRange(m,v.start,v.end);continue}for(y.setSegment(v);y.hasNext;){const x=y.move();if(c.element=m[x.start],r(s)){if(f){u.addElementRange(m,x.start,x.end);continue}for(let _=x.start,w=x.end;_<w;_++)c.element=m[_],i(s)&&u.addElement(c.element)}}}}}else{const{chainElementSegments:g}=h.coarseHierarchy.spheres,y=En.transientSegments(g,m);for(;y.hasNext;){const v=y.move();if(c.element=m[v.start],t(s)&&n(s)){if(d){u.addElementRange(m,v.start,v.end);continue}for(let x=v.start,_=v.end;x<_;x++)c.element=m[x],r(s)&&u.addElement(c.element)}}}u.commitUnit(),s.throwIfTimedOut()}return s.popCurrentElement(),Dt.Singletons(a,u.getStructure())}}(t)}function Ez(e,t,n){const r=new Int32Array(t.length);for(let i=0,o=t.length;i<o;i++)r[i]=e.elements[t[i]];return Xe.create([e.getChild(rt.ofSortedArray(r))],{parent:n})}function Qje(e,t){return function(r){const{units:i}=r.inputStructure,o=Dt.LinearBuilder(r.inputStructure);if(e&&0!==e.length){const s=Ti.create();for(let a=0;a<e.length;a++)Ti.add(s,e[a],e[a]);for(const a of i){if(!ze.isAtomic(a))continue;const l=a.rings;for(const c of s.array)if(l.byFingerprint.has(c))for(const u of l.byFingerprint.get(c))t&&!l.aromaticRings.includes(u)||o.add(Ez(a,l.all[u],r.inputStructure))}}else for(const s of i)if(ze.isAtomic(s))if(t)for(const a of s.rings.aromaticRings)o.add(Ez(s,s.rings.all[a],r.inputStructure));else for(const a of s.rings.all)o.add(Ez(s,a,r.inputStructure));return o.getSelection()}}function Jje(e,t,n=!1){return function(i){const o=e(i);if(0===Dt.structureCount(o))return o;const s=n?_z(i.inputStructure,Dt.unionStructure(o)):Dt.unionStructure(o);if(0===s.elementCount)return Dt.Empty(i.inputStructure);i.throwIfTimedOut(),i.pushInputStructure(s);const a=t(i);return i.popInputStructure(),Dt.withInputStructure(a,i.inputStructure)}}function eUe(e){return function(n){const r=n.inputStructure,i=r.interUnitBonds,o=Dt.UniqueBuilder(n.inputStructure);n.pushCurrentBond();const s=n.atomicBond;s.setTestFn(e),s.setStructure(r);for(const a of r.units){if(0!==a.kind)continue;const{offset:l,b:c,edgeProps:{flags:u,order:d,key:f}}=a.bonds;s.a.unit=a,s.b.unit=a;for(let p=0,m=a.elements.length;p<m;p++){s.aIndex=p,s.a.element=a.elements[p];for(let h=l[p],g=l[p+1];h<g;h++)if(s.bIndex=c[h],s.b.element=a.elements[c[h]],s.type=u[h],s.order=d[h],s.key=f[h],s.test(n,!1)){const y=r.subsetBuilder(!1);y.beginUnit(a.id),y.addElement(s.a.element),y.addElement(s.b.element),y.commitUnit(),o.add(y.getStructure())}}}for(const a of i.edges)if(s.a.unit=r.unitMap.get(a.unitA),s.a.element=s.a.unit.elements[a.indexA],s.aIndex=a.indexA,s.b.unit=r.unitMap.get(a.unitB),s.b.element=s.b.unit.elements[a.indexB],s.bIndex=a.indexB,s.order=a.props.order,s.type=a.props.flag,s.key=a.props.key,s.test(n,!1)){const l=r.subsetBuilder(!1);l.addToUnit(s.a.unit.id,s.a.element),l.addToUnit(s.b.unit.id,s.b.element),o.add(l.getStructure())}return n.popCurrentBond(),o.getSelection()}}class f5{addToUnit(t,n){const r=this.unitMap.get(t);if(r)Ti.add(r,n,n)&&this.elementCount++;else{const i=Ti.create();Ti.add(i,n,n),this.unitMap.set(t,i),this.ids[this.ids.length]=t,this.elementCount++}}has(t,n){const r=this.unitMap.get(t);return!!r&&Ti.has(r,n)}beginUnit(t){this.parentId=t,this.currentUnit=this.unitMap.has(t)?this.unitMap.get(t):this.currentUnit.array.length>0?Ti.create():this.currentUnit}addElement(t){Ti.add(this.currentUnit,t,t)&&this.elementCount++}commitUnit(){0===this.currentUnit.array.length||this.unitMap.has(this.parentId)||(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}getStructure(){if(this.isEmpty)return Xe.Empty;const t=[];ip(this.ids);const n=lg.UnitEquivalenceBuilder();for(let r=0,i=this.ids.length;r<i;r++){const o=this.ids[r],s=this.parent.unitMap.get(o),a=this.unitMap.get(o).array,l=a.length;if(a.length===s.elements.length){t[t.length]=s,n.add(s.id,s);continue}l>1&&ip(a);let c=s.getChild(rt.ofSortedArray(a));const u=n.add(c.id,c);c!==u&&(c=u.applyOperator(c.id,c.conformation.operator,!0)),t[t.length]=c}return Xe.create(t,{parent:this.parent})}get isEmpty(){return 0===this.elementCount}constructor(t){this.parent=t,this.ids=[],this.unitMap=sp.Mutable(),this.parentId=-1,this.currentUnit=Ti.create(),this.elementCount=0}}function kt(e){return{data:e,position:0,length:e.length,lineNumber:1,tokenStart:0,tokenEnd:0}}var ot,qi;function dae(e){for(;e.position<e.length;)switch(e.data.charCodeAt(e.position)){case 9:case 10:case 13:case 32:return void(e.tokenEnd=e.position);default:++e.position}e.tokenEnd=e.position}function fae(e){return!(e.length-e.position<2||39!==e.data.charCodeAt(e.position+1)||39!==e.data.charCodeAt(e.position+2))}function fUe(e,t,n){let r;const i=n-t,o=e.tokenStart-t,s=e.tokenEnd-e.tokenStart;if(s<i)return!1;for(r=t;r<n;++r)if(e.data.charCodeAt(r)!==e.data.charCodeAt(r+o))return!1;return i===s||46===e.data.charCodeAt(r+o)}function pae(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return t;return t}function hae(e,t){return e.data.substring(e.tokenStart,t)}function Tz(e){return e.data.substring(e.tokenStart,e.tokenEnd)}function mae(e){const t=function aUe(e){let t=10;for(;e.position<e.length;){const n=e.data.charCodeAt(e.position);switch(n){case 9:case 32:t=n,++e.position;break;case 10:13!==t&&++e.lineNumber,t=n,++e.position;break;case 13:t=n,++e.position,++e.lineNumber;break;default:return t}}return t}(e);if(e.position>=e.length)return void(e.tokenType=6);e.tokenStart=e.position,e.tokenEnd=e.position,e.isEscaped=!1;const n=e.data.charCodeAt(e.position);switch(n){case 35:(function sUe(e){for(;e.position<e.length;){const t=e.data.charCodeAt(e.position);if(10===t||13===t)return;++e.position}})(e),e.tokenType=5;break;case 39:if(fae(e)){(function rUe(e){for(e.position+=3;e.position<e.length;){if(39===e.data.charCodeAt(e.position)&&fae(e))return e.tokenStart+=3,e.tokenEnd=e.position,e.isEscaped=!0,void(e.position+=3);++e.position}e.tokenEnd=e.position})(e),e.tokenType=3;break}case 34:(function nUe(e,t){let n,r;for(++e.position;e.position<e.length;)if(r=e.data.charCodeAt(e.position),r===t)switch(n=e.data.charCodeAt(e.position+1),n){case 9:case 10:case 13:case 32:return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;default:if(void 0===n)return e.tokenStart++,e.tokenEnd=e.position,e.isEscaped=!0,void++e.position;++e.position}else{if(10===r||13===r)return void(e.tokenEnd=e.position);++e.position}e.tokenEnd=e.position})(e,n),e.tokenType=3;break;case 59:10===t||13===t?function iUe(e){let r,t=59,n=e.position+1;for(;n<e.length;){if(r=e.data.charCodeAt(n),59===r&&(10===t||13===t)){for(e.position=n+1,e.tokenStart++,n--,r=e.data.charCodeAt(n);10===r||13===r;)n--,r=e.data.charCodeAt(n);return e.tokenEnd=n+1,void(e.isEscaped=!0)}(13===r||10===r&&13!==t)&&e.lineNumber++,t=r,++n}e.position=n}(e):dae(e),e.tokenType=3;break;default:e.isImportGet?function oUe(e){for(;e.position<e.length;){if(93===e.data.charCodeAt(e.position))return++e.position,e.tokenEnd=e.position,void(e.isImportGet=!1);++e.position}}(e):dae(e),e.isEscaped?e.tokenType=3:95===e.data.charCodeAt(e.tokenStart)?(e.inSaveFrame&&function dUe(e){return!(e.tokenEnd-e.tokenStart!=11||105!==e.data.charCodeAt(e.tokenStart+1)||109!==e.data.charCodeAt(e.tokenStart+2)||112!==e.data.charCodeAt(e.tokenStart+3)||111!==e.data.charCodeAt(e.tokenStart+4)||114!==e.data.charCodeAt(e.tokenStart+5)||116!==e.data.charCodeAt(e.tokenStart+6)||46!==e.data.charCodeAt(e.tokenStart+7)||103!==e.data.charCodeAt(e.tokenStart+8)||101!==e.data.charCodeAt(e.tokenStart+9)||116!==e.data.charCodeAt(e.tokenStart+10))}(e)&&(e.isImportGet=!0),e.tokenType=4):e.tokenType=e.tokenEnd-e.tokenStart>=5&&95===e.data.charCodeAt(e.tokenStart+4)?function lUe(e){let t=e.data.charCodeAt(e.tokenStart);return!(68!==t&&100!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t)||(t=e.data.charCodeAt(e.tokenStart+2),84!==t&&116!==t)||(t=e.data.charCodeAt(e.tokenStart+3),65!==t&&97!==t))}(e)?0:function cUe(e){let t=e.data.charCodeAt(e.tokenStart);return!(83!==t&&115!==t||(t=e.data.charCodeAt(e.tokenStart+1),65!==t&&97!==t)||(t=e.data.charCodeAt(e.tokenStart+2),86!==t&&118!==t)||(t=e.data.charCodeAt(e.tokenStart+3),69!==t&&101!==t))}(e)?1:function uUe(e){if(e.tokenEnd-e.tokenStart!=5)return!1;let t=e.data.charCodeAt(e.tokenStart);return!(76!==t&&108!==t||(t=e.data.charCodeAt(e.tokenStart+1),79!==t&&111!==t)||(t=e.data.charCodeAt(e.tokenStart+2),79!==t&&111!==t)||(t=e.data.charCodeAt(e.tokenStart+3),80!==t&&112!==t))}(e)?2:3:3}}function I1(e){for(mae(e);5===e.tokenType;)mae(e)}function p5(){return{categoryNames:[],categoryData:Object.create(null)}}function Dz(e,t){const n=Object.create(null);for(const r of e){const i=t[r];n[r]=ll(i.name,i.rowCount,i.fieldNames,i.fields)}return n}function gae(e,t,n){return GU(e.categoryNames,Dz(e.categoryNames,e.categoryData),t,n)}function mUe(e,t){return GU(e.categoryNames,Dz(e.categoryNames,e.categoryData),t)}function Pz(e,t,n,r,i){if(t in e.categoryData){const o=e.categoryData[t];o.fieldNames.push(...r),Object.assign(o.fields,i)}else e.categoryData[t]={name:t,rowCount:n,fieldNames:r,fields:i},e.categoryNames.push(t)}function gUe(e,t){const n=e.tokenStart,r=pae(e),i=hae(e,r),o=Object.create(null),s=[];let a=!0;for(;a;){if(4!==e.tokenType||!fUe(e,n,r)){a=!1;break}const l=Tz(e).substring(i.length+1);if(I1(e),3!==e.tokenType)return{hasError:!0,errorLine:e.lineNumber,errorMessage:"Expected value."};o[l]=Tt.ofTokens({data:e.data,indices:[e.tokenStart,e.tokenEnd],count:1}),s[s.length]=l,I1(e)}return Pz(t,i.substr(1),1,s,o),{hasError:!1,errorLine:0,errorMessage:""}}function yUe(e,t){const{tokenizer:n,tokens:r,fieldCount:i}=t;let o=t.tokenCount,s=0;for(;3===n.tokenType&&s<e;)ot.add(r[o++%i],n.tokenStart,n.tokenEnd),I1(n),s++;return t.tokenCount=o,s}function bUe(e,t){return e.update({message:"Parsing...",current:t.tokenizer.position,max:t.tokenizer.data.length})}function vUe(e,t){return kz.apply(this,arguments)}function kz(){return kz=le(function*(e,t){const n=e.lineNumber;I1(e);const r=hae(e,pae(e)),i=function pUe(e){let t;for(t=e.tokenStart;t<e.tokenEnd;++t)if(46===e.data.charCodeAt(t))return!1;return!0}(e),o=[];for(;4===e.tokenType;)o[o.length]=i?Tz(e):Tz(e).substring(r.length+1),I1(e);const s="_atom_site"===r?e.data.length/100|0:32,a=[],l=o.length;for(let d=0;d<l;d++)a[d]=ot.create(e.data,s);const c={fieldCount:l,tokenCount:0,tokenizer:e,tokens:a};if(yield G0(e.runtimeCtx,1e6,c,yUe,bUe),c.tokenCount%l!=0)return{hasError:!0,errorLine:e.lineNumber,errorMessage:`The number of values for loop starting at line ${n} is not a multiple of the number of columns.`};const u=c.tokenCount/l|0;if(i)for(let d=0;d<l;d++){const f={"":Tt.ofTokens(a[d])};Pz(t,o[d].substr(1),u,[""],f)}else{const d=Object.create(null);for(let f=0;f<l;f++)d[o[f]]=Tt.ofTokens(a[f]);Pz(t,r.substr(1),u,o,d)}return{hasError:!1,errorLine:0,errorMessage:""}}),kz.apply(this,arguments)}function _w(e,t){return qi.error(t,e)}function Mz(){return Mz=le(function*(e,t){const n=[],r=function hUe(e,t){return{data:e,length:e.length,position:0,tokenStart:0,tokenEnd:0,tokenType:6,lineNumber:1,isEscaped:!1,isImportGet:!1,inSaveFrame:!1,runtimeCtx:t}}(e,t);let i="",o=p5(),s=[],a=p5();const l=function HBe(e,t,n){return{categoryNames:e,header:n,categories:t}}(a.categoryNames,Dz(a.categoryNames,a.categoryData),"");let c="";for(t.update({message:"Parsing...",current:0,max:e.length}),I1(r);6!==r.tokenType;){const u=r.tokenType;if(0===u){if(r.inSaveFrame)return _w(r.lineNumber,"Unexpected data block inside a save frame.");o.categoryNames.length>0&&n.push(gae(o,i,s)),i=e.substring(r.tokenStart+5,r.tokenEnd),o=p5(),s=[],I1(r)}else if(1===u){if(r.tokenEnd-r.tokenStart==5)a.categoryNames.length>0&&(s[s.length]=mUe(a,c)),r.inSaveFrame=!1;else{if(r.inSaveFrame)return _w(r.lineNumber,"Save frames cannot be nested.");r.inSaveFrame=!0,c=e.substring(r.tokenStart+5,r.tokenEnd),a=p5()}I1(r)}else if(2===u){const d=yield vUe(r,r.inSaveFrame?a:o);if(d.hasError)return _w(d.errorLine,d.errorMessage)}else{if(4!==u)return console.log(r.tokenType,kt.getTokenString(r)),_w(r.lineNumber,"Unexpected token. Expected data_, loop_, or data name.");{const d=gUe(r,r.inSaveFrame?a:o);if(d.hasError)return _w(d.errorLine,d.errorMessage)}}}return r.inSaveFrame?_w(r.lineNumber,`Unfinished save frame (${l.header}).`):((o.categoryNames.length>0||s.length>0)&&n.push(gae(o,i,s)),function xUe(e){return qi.success(e)}(Woe(n)))}),Mz.apply(this,arguments)}function yae(e){return Ke.create("Parse CIF",function(){var t=le(function*(n){return yield function _Ue(e,t){return Mz.apply(this,arguments)}(e,n)});return function(n){return t.apply(this,arguments)}}())}function bae(e){return m5({buffer:e,offset:0,dataView:new DataView(e.buffer)})}function Rz(e,t){const n={};for(let r=0;r<t;r++)n[m5(e)]=m5(e);return n}function Nz(e,t){const n=new Uint8Array(t),r=e.offset;for(let i=0;i<t;i++)n[i]=e.buffer[i+r];return e.offset+=t,n}function h5(e,t){const n=mz(e.buffer,e.offset,t);return e.offset+=t,n}function Fz(e,t){const n=new Array(t);for(let r=0;r<t;r++)n[r]=m5(e);return n}function m5(e){const t=e.buffer[e.offset];let n,r;if(!(128&t))return e.offset++,t;if(128==(240&t))return r=15&t,e.offset++,Rz(e,r);if(144==(240&t))return r=15&t,e.offset++,Fz(e,r);if(160==(224&t))return r=31&t,e.offset++,h5(e,r);if(!(224&~t))return n=e.dataView.getInt8(e.offset),e.offset++,n;switch(t){case 192:return e.offset++,null;case 194:return e.offset++,!1;case 195:return e.offset++,!0;case 196:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,Nz(e,r);case 197:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,Nz(e,r);case 198:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,Nz(e,r);case 202:return n=e.dataView.getFloat32(e.offset+1),e.offset+=5,n;case 203:return n=e.dataView.getFloat64(e.offset+1),e.offset+=9,n;case 204:return n=e.buffer[e.offset+1],e.offset+=2,n;case 205:return n=e.dataView.getUint16(e.offset+1),e.offset+=3,n;case 206:return n=e.dataView.getUint32(e.offset+1),e.offset+=5,n;case 208:return n=e.dataView.getInt8(e.offset+1),e.offset+=2,n;case 209:return n=e.dataView.getInt16(e.offset+1),e.offset+=3,n;case 210:return n=e.dataView.getInt32(e.offset+1),e.offset+=5,n;case 217:return r=e.dataView.getUint8(e.offset+1),e.offset+=2,h5(e,r);case 218:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,h5(e,r);case 219:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,h5(e,r);case 220:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,Fz(e,r);case 221:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,Fz(e,r);case 222:return r=e.dataView.getUint16(e.offset+1),e.offset+=3,Rz(e,r);case 223:return r=e.dataView.getUint32(e.offset+1),e.offset+=5,Rz(e,r)}throw new Error("Unknown type 0x"+t.toString(16))}function wUe(e){const t=Object.create(null),n=Object.create(null);for(const r of e.columns)t[r.name]=r;return{rowCount:e.rowCount,name:e.name.substr(1),fieldNames:e.columns.map(r=>r.name),getField(r){const i=t[r];if(i)return n[r]||(n[r]=function SUe(e){const t=e.mask?t5(e.mask):void 0,n=t5(e.data),r=bU(n),i=r?t?c=>0===t[c]?""+n[c]:"":c=>""+n[c]:t?c=>0===t[c]?n[c]:"":c=>n[c],o=r?c=>n[c]:c=>{const u=n[c];return p1(u,0,u.length)},s=r?c=>n[c]:c=>{const u=n[c];return V0(u,0,u.length)},l=n.length;return{__array:n,binaryEncoding:e.data.encoding,isDefined:!0,rowCount:l,str:i,int:o,float:s,valueKind:t?c=>t[c]:c=>0,areValuesEqual:(c,u)=>n[c]===n[u],toStringArray:c=>tc(l,i,c),toIntArray:r?c=>ER(n,c):c=>tc(l,o,c),toFloatArray:r?c=>ER(n,c):c=>tc(l,s,c)}}(i)),n[r]}}}function vae(e){return Ke.create("Parse BinaryCIF",function(){var t=le(function*(n){const r=[0,3];try{const i=bae(e);if(!function CUe(e,t){for(let n=0;n<2;n++)if(e[n]>t[n])return!1;return!0}(r,i.version.match(/(\d)\.(\d)\.\d/).slice(1).map(s=>+s)))return qi.error(`Unsupported format version. Current ${i.version}, required ${r.join(".")}.`);const o=Woe(i.dataBlocks.map(s=>{const a=Object.create(null);for(const l of s.categories)a[l.name.substr(1)]=wUe(l);return GU(s.categories.map(l=>l.name.substr(1)),a,s.header)}));return qi.success(o)}catch(i){return qi.error(""+i)}});return function(n){return t.apply(this,arguments)}}())}!function(e){function t(_){return _.data.substring(_.tokenStart,_.tokenEnd)}function r(_){const{data:w}=_;for(;_.position<_.length;)switch(w.charCodeAt(_.position)){case 10:return _.tokenEnd=_.position,++_.position,++_.lineNumber,!0;case 13:return _.tokenEnd=_.position,++_.position,++_.lineNumber,10===w.charCodeAt(_.position)&&++_.position,!0;default:++_.position}return _.tokenEnd=_.position,_.tokenStart!==_.tokenEnd}function o(_){return _.tokenStart=_.position,r(_)}function l(_,w,A){let M=0;for(let E=0;E<w;E++){if(!o(_))return M;ot.addUnchecked(A,_.tokenStart,_.tokenEnd),M++}return M}function f(){return(f=le(function*(_,w,A,M=1e5){const E=ot.create(_.data,2*w);let D=0;return yield G0(A,M,_,(T,F)=>{const R=Math.min(w-D,T);return l(F,R,E),D+=R,R},(T,F)=>T.update({message:"Parsing...",current:F.position,max:F.length})),E})).apply(this,arguments)}function g(){return(g=le(function*(_,w,A=1e5){const M=e(_),E=ot.create(M.data,Math.max(_.length/80,2));return yield G0(w,A,M,(D,T)=>(function m(_,w,A){let M=0;for(let E=0;E<w;E++){if(!o(_))return M;ot.add(A,_.tokenStart,_.tokenEnd),M++}}(T,D,E),T.position<T.length?D:0),(D,T)=>D.update({message:"Parsing...",current:T.position,max:T.length})),E})).apply(this,arguments)}function x(_,w,A){const{data:M}=_;let E=w,D=A-1,T=M.charCodeAt(E);for(;(9===T||32===T)&&E<=D;)T=M.charCodeAt(++E);for(T=M.charCodeAt(D);(9===T||32===T)&&D>=E;)T=M.charCodeAt(--D);return _.tokenStart=E,_.tokenEnd=D+1,_.position=A,_}e.getTokenString=t,e.reset=function n(_){_.position=0,_.lineNumber=1,_.tokenStart=0,_.tokenEnd=0},e.eatLine=r,e.markStart=function i(_){_.tokenStart=_.position},e.markLine=o,e.readLine=function s(_){return o(_),t(_)},e.readLineTrim=function a(_){o(_);const w=_.position;return x(_,_.tokenStart,_.tokenEnd),_.position=w,t(_)},e.markLines=function c(_,w){const A=ot.create(_.data,2*w);return l(_,w,A),A},e.readLines=function u(_,w){const A=[];for(let M=0;M<w;M++)A.push(e.readLine(_));return A},e.readLinesAsync=function d(_,w,A){return f.apply(this,arguments)},e.readAllLines=function p(_){const w=e(_),A=ot.create(w.data,Math.max(_.length/80,2));for(;o(w);)ot.add(A,w.tokenStart,w.tokenEnd);return A},e.readAllLinesAsync=function h(_,w){return g.apply(this,arguments)},e.eatValue=function y(_){for(;_.position<_.length;)switch(_.data.charCodeAt(_.position)){case 9:case 10:case 13:case 32:return void(_.tokenEnd=_.position);default:++_.position}_.tokenEnd=_.position},e.skipWhitespace=function v(_){let w=-1;for(;_.position<_.length;){const A=_.data.charCodeAt(_.position);switch(A){case 9:case 32:w=A,++_.position;break;case 10:13!==w&&++_.lineNumber,w=A,++_.position;break;case 13:w=A,++_.position,++_.lineNumber;break;default:return w}}return w},e.trim=x}(kt||(kt={})),function(e){function n(s,a,l){const c=s;c.offset>c.indicesLenMinus2&&function t(s){const a=new Uint32Array(1.61*s.indices.length|0);a.set(s.indices),s.indices=a,s.indicesLenMinus2=a.length-2|0}(c),c.indices[c.offset++]=a,c.indices[c.offset++]=l,s.count++}e.add=n,e.addToken=function r(s,a){n(s,a.tokenStart,a.tokenEnd)},e.addUnchecked=function i(s,a,l){s.indices[s.offset++]=a,s.indices[s.offset++]=l,s.count++},e.create=function o(s,a){return{data:s,indicesLenMinus2:(a=Math.max(10,a))-2|0,count:0,offset:0,indices:new Uint32Array(a)}}}(ot||(ot={})),function(e){e.error=function t(o,s=-1){return new r(o,s)},e.success=function n(o,s=[]){return new i(o,s)};class r{toString(){return this.line>=0?`[Line ${this.line}] ${this.message}`:this.message}constructor(s,a){this.message=s,this.line=a,this.isError=!0}}e.Error=r;class i{constructor(s,a){this.result=s,this.warnings=a,this.isError=!1}}e.Success=i}(qi||(qi={}));var r_=ce.Schema;const so=r_.str,xae=r_.List,og=r_.lstr,Sf=r_.Aliased,N3=r_.int,Sw=r_.coord,IUe={chem_comp:{formula:so,formula_weight:r_.float,id:so,mon_nstd_parent_comp_id:xae(",",e=>e),name:so,one_letter_code:so,three_letter_code:so,type:Sf(og),pdbx_synonyms:xae(";",e=>e),pdbx_type:so,pdbx_ambiguous_flag:so,pdbx_replaced_by:so,pdbx_replaces:so,pdbx_formal_charge:N3,pdbx_model_coordinates_details:so,pdbx_model_coordinates_db_code:so,pdbx_ideal_coordinates_details:so,pdbx_ideal_coordinates_missing_flag:Sf(og),pdbx_model_coordinates_missing_flag:Sf(og),pdbx_initial_date:so,pdbx_modified_date:so,pdbx_release_status:Sf(so),pdbx_processing_site:Sf(so)},chem_comp_atom:{alt_atom_id:so,atom_id:so,charge:N3,model_Cartn_x:Sw,model_Cartn_y:Sw,model_Cartn_z:Sw,comp_id:so,type_symbol:so,pdbx_align:N3,pdbx_ordinal:N3,pdbx_model_Cartn_x_ideal:Sw,pdbx_model_Cartn_y_ideal:Sw,pdbx_model_Cartn_z_ideal:Sw,pdbx_stereo_config:Sf(og),pdbx_aromatic_flag:Sf(og),pdbx_leaving_atom_flag:Sf(og)},chem_comp_bond:{atom_id_1:so,atom_id_2:so,comp_id:so,value_order:Sf(og),pdbx_ordinal:N3,pdbx_stereo_config:Sf(og),pdbx_aromatic_flag:Sf(og)},pdbx_chem_comp_descriptor:{comp_id:so,descriptor:so,type:Sf(og),program:so,program_version:so},pdbx_chem_comp_identifier:{comp_id:so,identifier:so,type:Sf(so),program:so,program_version:so}};var F3=ce.Schema;const tr=F3.str,J0=F3.lstr,Ou=F3.Aliased,pp=F3.int,TUe={pdbx_reference_molecule:{prd_id:tr,formula_weight:F3.float,formula:tr,type:Ou(J0),type_evidence_code:tr,class:Ou(J0),class_evidence_code:tr,name:tr,represent_as:Ou(J0),chem_comp_id:tr,compound_details:tr,description:tr,representative_PDB_id_code:tr,release_status:Ou(J0),replaces:tr,replaced_by:tr},pdbx_reference_entity_list:{prd_id:tr,ref_entity_id:tr,type:Ou(J0),details:tr,component_id:pp},pdbx_reference_entity_nonpoly:{prd_id:tr,ref_entity_id:tr,name:tr,chem_comp_id:tr},pdbx_reference_entity_link:{link_id:pp,prd_id:tr,details:tr,ref_entity_id_1:tr,ref_entity_id_2:tr,entity_seq_num_1:pp,entity_seq_num_2:pp,comp_id_1:tr,comp_id_2:tr,atom_id_1:tr,atom_id_2:tr,value_order:Ou(J0),component_1:pp,component_2:pp,link_class:Ou(tr)},pdbx_reference_entity_poly_link:{link_id:pp,prd_id:tr,ref_entity_id:tr,component_id:pp,entity_seq_num_1:pp,entity_seq_num_2:pp,comp_id_1:tr,comp_id_2:tr,atom_id_1:tr,atom_id_2:tr,value_order:Ou(J0)},pdbx_reference_entity_poly:{prd_id:tr,ref_entity_id:tr,type:Ou(tr),db_code:tr,db_name:tr},pdbx_reference_entity_poly_seq:{prd_id:tr,ref_entity_id:tr,mon_id:tr,parent_mon_id:tr,num:pp,observed:Ou(J0),hetero:Ou(J0)},pdbx_reference_entity_sequence:{prd_id:tr,ref_entity_id:tr,type:Ou(tr),NRP_flag:Ou(tr),one_letter_codes:tr},pdbx_reference_entity_src_nat:{prd_id:tr,ref_entity_id:tr,ordinal:pp,organism_scientific:tr,taxid:tr,db_code:tr,db_name:tr},pdbx_prd_audit:{prd_id:tr,date:tr,processing_site:Ou(tr),action_type:Ou(tr)}};var _ae=ce.Schema;const xa=_ae.str,PUe={datablock:{id:xa,description:xa},dictionary:{title:xa,datablock_id:xa,version:xa},dictionary_history:{version:xa,update:xa,revision:xa},sub_category:{id:xa,description:xa},category_group_list:{id:xa,parent_id:xa,description:xa},item_type_list:{code:xa,primitive_code:xa,construct:xa,detail:xa},item_units_list:{code:xa,detail:xa},item_units_conversion:{from_code:xa,to_code:xa,operator:xa,factor:_ae.float}};var O3=ce.Schema;const sg=O3.str,g5=O3.int,ey=O3.float,y5=O3.Aliased,E1=O3.Vector,Sae=(y5(sg),y5(sg),y5(sg),y5(sg),E1(3),E1(3),{volume_data_3d_info:{name:sg,axis_order:E1(3,g5),origin:E1(3),dimensions:E1(3),sample_rate:g5,sample_count:E1(3,g5),spacegroup_number:g5,spacegroup_cell_size:E1(3),spacegroup_cell_angles:E1(3),mean_source:ey,mean_sampled:ey,sigma_source:ey,sigma_sampled:ey,min_source:ey,min_sampled:ey,max_source:ey,max_sampled:ey},volume_data_3d:{values:ey}});var b5=ce.Schema;const Hs=b5.float,Oz=b5.int,bo=b5.str,MUe={cell:{angle_alpha:Hs,angle_beta:Hs,angle_gamma:Hs,formula_units_z:Oz,length_a:Hs,length_b:Hs,length_c:Hs,volume:Hs},chemical:{melting_point:Hs,name_common:bo,name_systematic:bo},chemical_formula:{moiety:bo,sum:bo,weight:Hs},space_group:{crystal_system:bo,it_number:Oz,"name_h-m_full":bo},space_group_symop:{operation_xyz:bo},geom_bond:{atom_site_label_1:bo,atom_site_label_2:bo,distance:Hs,publ_flag:bo,site_symmetry_1:bo,site_symmetry_2:bo,valence:Hs},audit:{block_doi:bo},database_code:{cod:bo,csd:bo,depnum_ccdc_archive:bo,depnum_ccdc_fiz:bo,icsd:bo,mdf:bo,nbs:bo},atom_site:{adp_type:bo,calc_flag:bo,disorder_assembly:bo,disorder_group:bo,fract_x:Hs,fract_y:Hs,fract_z:Hs,label:bo,occupancy:Hs,refinement_flags:bo,site_symmetry_multiplicity:Oz,type_symbol:bo,u_iso_or_equiv:Hs},atom_site_aniso:{label:bo,u_11:Hs,u:(0,b5.Matrix)(3,3),u_12:Hs,u_13:Hs,u_22:Hs,u_23:Hs,u_33:Hs},atom_type:{description:bo,symbol:bo},atom_type_scat:{dispersion_imag:Hs,dispersion_real:Hs,source:bo}},RUe={"cell.formula_units_z":["cell_formula_units_Z"],"space_group.it_number":["space_group_IT_number","symmetry_Int_Tables_number"],"space_group.name_h-m_full":["symmetry_space_group_name_H-M"],"space_group_symop.operation_xyz":["symmetry_equiv_pos_as_xyz"],"geom_bond.atom_site_label_1":["geom_bond_atom_site_id_1"],"geom_bond.atom_site_label_2":["geom_bond_atom_site_id_2"],"geom_bond.distance":["geom_bond_dist"],"audit.block_doi":["audit_block_DOI"],"database_code.cod":["database_code_COD"],"database_code.csd":["database_code_CSD"],"database_code.depnum_ccdc_archive":["database_code_depnum_CCDC_archive"],"database_code.depnum_ccdc_fiz":["database_code_depnum_CCDC_fiz"],"database_code.icsd":["database_code_ICSD"],"database_code.mdf":["database_code_MDF"],"database_code.nbs":["database_code_NBS"],"atom_site.adp_type":["atom_site_ADP_type","atom_site_thermal_displace_type"],"atom_site.label":["atom_site_id"],"atom_site.site_symmetry_multiplicity":["atom_site_symmetry_multiplicity"],"atom_site.u_iso_or_equiv":["atom_site_U_iso_or_equiv"],"atom_site_aniso.label":["atom_site_anisotrop_id"],"atom_site_aniso.u_11":["atom_site_aniso_U_11","atom_site_anisotrop_U_11"],"atom_site_aniso.u_12":["atom_site_aniso_U_12","atom_site_anisotrop_U_12"],"atom_site_aniso.u_13":["atom_site_aniso_U_13","atom_site_anisotrop_U_13"],"atom_site_aniso.u_22":["atom_site_aniso_U_22","atom_site_anisotrop_U_22"],"atom_site_aniso.u_23":["atom_site_aniso_U_23","atom_site_anisotrop_U_23"],"atom_site_aniso.u_33":["atom_site_aniso_U_33","atom_site_anisotrop_U_33"]},Bz=ce.Schema.int,FUe={volume_data_3d_info:Sae.volume_data_3d_info,segmentation_data_table:{set_id:Bz,segment_id:Bz},segmentation_data_3d:{values:Bz}},Hh={parse:e=>"string"==typeof e?yae(e):vae(e),parseText:yae,parseBinary:vae,toDatabaseCollection:function WBe(e,t,n){const r={};for(const i of t.blocks)r[i.header]=rg(e,i,n);return r},toDatabase:rg,schema:{mmCIF:e=>rg(Nr,e),CCD:e=>rg(IUe,e),BIRD:e=>rg(TUe,e),dic:e=>rg(PUe,e),cifCore:e=>rg(MUe,e,RUe),densityServer:e=>rg(Sae,e),segmentation:e=>rg(FUe,e)}},OUe={type_symbol:ce.Schema.Aliased(Nr.atom_site.type_symbol),label_atom_id:Nr.atom_site.label_atom_id,auth_atom_id:Nr.atom_site.auth_atom_id,label_alt_id:Nr.atom_site.label_alt_id,label_comp_id:Nr.atom_site.label_comp_id,auth_comp_id:Nr.atom_site.auth_comp_id,pdbx_formal_charge:Nr.atom_site.pdbx_formal_charge},BUe={group_PDB:Nr.atom_site.group_PDB,label_seq_id:Nr.atom_site.label_seq_id,auth_seq_id:Nr.atom_site.auth_seq_id,pdbx_PDB_ins_code:Nr.atom_site.pdbx_PDB_ins_code},LUe={label_asym_id:Nr.atom_site.label_asym_id,auth_asym_id:Nr.atom_site.auth_asym_id,label_entity_id:Nr.atom_site.label_entity_id};var Lz,i_;!function(e){e.EmptyResidueKey=function t(){return{label_entity_id:"",label_asym_id:"",auth_seq_id:0,pdbx_PDB_ins_code:void 0}}}(Lz||(Lz={})),function(e){function t(i,o){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[o]]}function n(i,o){return i.residueAtomSegments.index[i.chainAtomSegments.offsets[o+1]-1]+1}e.chainStartResidueIndex=t,e.chainEndResidueIndexExcl=n,e.chainResidueCount=function r(i,o){return n(i,o)-t(i,o)}}(i_||(i_={}));const v5={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109},jUe={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2},UUe={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156},zUe=1.7,HUe=0;function B3(e){const t=v5[e];return void 0===t?zUe:jUe[t]}function L3(e){const t=v5[e];return void 0===t?HUe:t}function Cae(e,t,n,r){return{type:e,key:t,elements:n,getIndex:r}}var o_;function YUe(e,t,n,r,i,o){const{auth_seq_id:s,label_seq_id:a,pdbx_PDB_ins_code:l}=e.residues,{endSeqId:c,endInsCode:u,key:d,type:f}=n,p="label"===t?a:s;let m=r;for(;m<i;){const h=p.value(m);if(o.type[m]=f,o.key[m]=d,h>c||h===c&&l.value(m)===u)break;m++}}!function(e){e.Descriptor={name:"model_secondary_structure"},e.Provider=jh.create(e.Descriptor),e.fromStruct=function t(n,r,i){const o=new Map,s=[{kind:"none"}],a=function qUe(e,t){if(e._rowCount>0){if(0!==e.beg_label_seq_id.valueKind(0)||0!==e.end_label_seq_id.valueKind(0))return"auth"}else if(t&&(0!==t.beg_label_seq_id.valueKind(0)||0!==t.end_label_seq_id.valueKind(0)))return"auth";return"label"}(n,r);(function WUe(e,t,n,r){if(!e._rowCount)return;const{beg_label_asym_id:i,beg_label_seq_id:o,beg_auth_seq_id:s,pdbx_beg_PDB_ins_code:a}=e,{end_label_seq_id:l,end_auth_seq_id:c,pdbx_end_PDB_ins_code:u}=e,{pdbx_PDB_helix_class:d,conf_type_id:f,details:p}=e,m="label"===t?o:s,h="label"===t?l:c;for(let g=0,y=e._rowCount;g<y;g++){const v=pi.create(0===d.valueKind(g)?pi.SecondaryStructurePdb[d.value(g)]:0===f.valueKind(g)?pi.SecondaryStructureMmcif[f.value(g)]:536870912),x={kind:"helix",flags:v,type_id:0===f.valueKind(g)?f.value(g):"helx_p",helix_class:d.value(g),details:0===p.valueKind(g)?p.value(g):void 0},_={startSeqId:m.value(g),startInsCode:a.value(g),endSeqId:h.value(g),endInsCode:u.value(g),type:v,key:r.length};r[r.length]=x;const w=i.value(g);if(n.has(w)){const A=n.get(w);A.has(_.startSeqId)?A.get(_.startSeqId).push(_):A.set(_.startSeqId,[_])}else n.set(w,new Map([[_.startSeqId,[_]]]))}})(n,a,o,s),function $Ue(e,t,n,r,i){if(!e._rowCount)return;const{beg_label_asym_id:o,beg_label_seq_id:s,beg_auth_seq_id:a,pdbx_beg_PDB_ins_code:l}=e,{end_label_seq_id:c,end_auth_seq_id:u,pdbx_end_PDB_ins_code:d}=e,{sheet_id:f}=e,p="label"===t?s:a,m="label"===t?c:u,h=new Map;let g=r+1;for(let y=0,v=e._rowCount;y<v;y++){const x=f.value(y);let _;h.has(x)?_=h.get(x):(_=g++,h.set(x,_));const w=pi.create(8388612),A={kind:"sheet",flags:w,sheet_id:x,symmetry:void 0},M={startSeqId:p.value(y),startInsCode:l.value(y),endSeqId:m.value(y),endInsCode:d.value(y),type:w,key:i.length};i[i.length]=A;const E=o.value(y);if(n.has(E)){const D=n.get(E);D.has(M.startSeqId)?D.get(M.startSeqId).push(M):D.set(M.startSeqId,[M])}else n.set(E,new Map([[M.startSeqId,[M]]]))}}(r,a,o,n._rowCount,s);const l=i.residues._rowCount,u={type:new Int32Array(l),key:new Int32Array(l),elements:s};return o.size>0&&function XUe(e,t,n,r){const{count:i}=e.chainAtomSegments,{label_asym_id:o}=e.chains,{auth_seq_id:s,label_seq_id:a,pdbx_PDB_ins_code:l}=e.residues,c="label"===t?a:s;for(let u=0;u<i;u++){const d=i_.chainStartResidueIndex(e,u),f=i_.chainEndResidueIndexExcl(e,u),p=o.value(u);if(n.has(p)){const m=n.get(p);for(let h=d;h<f;h++){const g=c.value(h);if(m.has(g)){const y=m.get(g);for(const v of y){const x=l.value(h);v.startInsCode===x&&YUe(e,t,v,h,f,r)}}}}}}(i,a,o,u),Cae(u.type,u.key,u.elements,d=>d)}}(o_||(o_={}));const KUe={U:Nr.atom_site_anisotrop.U,U_esd:Nr.atom_site_anisotrop.U_esd};var ag,s_;!function(e){e.Schema=KUe,e.Descriptor={name:"atom_site_anisotrop",cifExport:{prefix:"",categories:[{name:"atom_site_anisotrop",instance:r=>e.Provider.get(r.firstModel)&&Ui.is(r.firstModel.sourceData)?us.Category.ofTable(r.firstModel.sourceData.data.db.atom_site_anisotrop):us.Category.Empty}]}},e.Provider=jh.create(e.Descriptor),e.getElementToAnsiotrop=function t(r,i){const o=new Int32Array(r.rowCount);o.fill(-1);for(let a=0,l=r.rowCount;a<l;a++)o[r.value(a)]=a;const s=new Int32Array(r.rowCount);s.fill(-1);for(let a=0,l=i.rowCount;a<l;++a){const c=o[i.value(a)];-1!==c&&(s[c]=a)}return s},e.getElementToAnsiotropFromLabel=function n(r,i){const o={};for(let a=0,l=r.rowCount;a<l;a++)o[r.value(a)]=a;const s=new Int32Array(r.rowCount);s.fill(-1);for(let a=0,l=i.rowCount;a<l;++a){const c=o[i.value(a)];void 0!==c&&(s[c]=a)}return s}}(ag||(ag={})),function(e){const t="molstar_global_model_transform_info";function r(a){return e.Provider.get(a)}e.Schema={[t]:{matrix:ce.Schema.Matrix(4,4,ce.Schema.float)}},e.Descriptor=hf({name:t,cifExport:{categories:[{name:t,instance(a){const l=r(a.firstModel);if(!l)return us.Category.Empty;const c=Kr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return us.Category.ofTable(c)}}],prefix:"molstar"}}),e.Provider=jh.create(e.Descriptor),e.attach=function n(a,l){a.customProperties.has(e.Descriptor)||a.customProperties.add(e.Descriptor),e.Provider.set(a,l)},e.get=r,e.fromMmCif=function i(a){if(!Ui.is(a.sourceData))return;const l=a.sourceData.data.frame.categories[t];if(!l)return;const c=function $Be(e,t){return new Yoe(t,e,!0)}(e.Schema[t],l);return 0!==c._rowCount?c.matrix.value(0):void 0},e.hasData=function o(a){if(!Ui.is(a.sourceData))return!1;const l=a.sourceData.data.frame.categories[t];return!!l&&l.rowCount>0},e.writeMmCif=function s(a,l){a.writeCategory({name:t,instance(){const c=Kr.ofRows(e.Schema.molstar_global_model_transform_info,[{matrix:l}]);return us.Category.ofTable(c)}})}}(s_||(s_={})),ce.Schema.Str();const ZUe={...Nr.chem_comp,type:ce.Schema.Aliased(ce.Schema.str)};function QUe(e,t){const{ihm_model_group:n,ihm_model_group_link:r}=t,i=Kr.pickRow(r,o=>r.model_id.value(o)===e);if(i){const o=Kr.pickRow(n,s=>n.id.value(s)===i.group_id);if(o)return o.name}return""}function wae(e){for(let t=0,n=e.rowCount;t<n;t++)if(0===e.valueKind(t))return!0;return!1}function x5(e,t,n){(!e[t].isDefined||!wae(e[t]))&&(e[t]=e[n]),(!e[n].isDefined||!wae(e[n]))&&(e[n]=e[t])}const ic={entry:Nr.entry,struct:Nr.struct,struct_asym:Nr.struct_asym,ihm_model_list:Nr.ihm_model_list,ihm_model_group:Nr.ihm_model_group,ihm_model_group_link:Nr.ihm_model_group_link,entity:Nr.entity,entity_poly:Nr.entity_poly,entity_poly_seq:Nr.entity_poly_seq,pdbx_entity_branch:Nr.pdbx_entity_branch,chem_comp:ZUe,pdbx_chem_comp_identifier:Nr.pdbx_chem_comp_identifier,atom_site:Nr.atom_site,ihm_sphere_obj_site:Nr.ihm_sphere_obj_site,ihm_gaussian_obj_site:Nr.ihm_gaussian_obj_site,pdbx_unobs_or_zero_occ_residues:Nr.pdbx_unobs_or_zero_occ_residues,pdbx_molecule:Nr.pdbx_molecule};function hp(e,t=!1){const n=Object.create(null);for(const r of Object.keys(ic))n[r]=r in e?e[r]:Kr.ofUndefinedColumns(ic[r],0);return t&&(n.atom_site=function JUe(e){const t=Kr.ofColumns(e._schema,e);return x5(t,"label_atom_id","auth_atom_id"),x5(t,"label_comp_id","auth_comp_id"),x5(t,"label_seq_id","auth_seq_id"),x5(t,"label_asym_id","auth_asym_id"),t}(n.atom_site)),n}class Gh{constructor(){this.count=0,this.ids=[],this.types=[],this.descriptions=[],this.compoundsMap=new Map,this.namesMap=new Map,this.heteroMap=new Map,this.chainMap=new Map}set(t,n){this.count+=1,this.ids.push(`${this.count}`),this.types.push(t),this.descriptions.push([n])}getEntityId(t,n,r,i){return 2===n?(void 0===this.waterId&&(this.set("water",i?.customName||"Water"),this.waterId=`${this.count}`),this.waterId):QR(n)?this.compoundsMap.has(r)?this.compoundsMap.get(r):(this.chainMap.has(r)||(this.set("polymer",i?.customName||`Polymer ${this.chainMap.size+1}`),this.chainMap.set(r,`${this.count}`)),this.chainMap.get(r)):(this.heteroMap.has(t)||(this.set("non-polymer",i?.customName||this.namesMap.get(t)||t),this.heteroMap.set(t,`${this.count}`)),this.heteroMap.get(t))}getEntityTable(){return Kr.ofPartialColumns(ic.entity,{id:ce.ofStringArray(this.ids),type:ce.ofStringAliasArray(this.types),pdbx_description:ce.ofStringListArray(this.descriptions)},this.count)}setCompounds(t){for(let n=0,r=t.length;n<r;++n){const{chains:i,description:o}=t[n];this.set("polymer",o);for(let s=0,a=i.length;s<a;++s)this.compoundsMap.set(i[s],`${this.count}`)}}setNames(t){t.forEach(n=>this.namesMap.set(n[0],n[1]))}}const eze=[new Set(["CA"]),new Set(["C"]),new Set(["N"])],tze=[new Set(["P","O3'","O3*"]),new Set(["C4'","C4*"]),new Set(["O2'","O2*","F2'","F2*"])],nze=[new Set(["P","O3'","O3*"]),new Set(["C3'","C3*"]),new Set(["O2'","O2*","F2'","F2*"])],rze=new Set(["FMN","NCN","FNS","FMA","ATP","ADP","AMP","GTP","GDP","GMP","LIG"]),Aae=function(){const e=new Map;return[{id:"HIS",name:"HISTIDINE",type:"l-peptide linking"},{id:"ARG",name:"ARGININE",type:"l-peptide linking"},{id:"LYS",name:"LYSINE",type:"l-peptide linking"},{id:"ILE",name:"ISOLEUCINE",type:"l-peptide linking"},{id:"PHE",name:"PHENYLALANINE",type:"l-peptide linking"},{id:"LEU",name:"LEUCINE",type:"l-peptide linking"},{id:"TRP",name:"TRYPTOPHAN",type:"l-peptide linking"},{id:"ALA",name:"ALANINE",type:"l-peptide linking"},{id:"MET",name:"METHIONINE",type:"l-peptide linking"},{id:"CYS",name:"CYSTEINE",type:"l-peptide linking"},{id:"ASN",name:"ASPARAGINE",type:"l-peptide linking"},{id:"VAL",name:"VALINE",type:"l-peptide linking"},{id:"GLY",name:"GLYCINE",type:"peptide linking"},{id:"SER",name:"SERINE",type:"l-peptide linking"},{id:"GLN",name:"GLUTAMINE",type:"l-peptide linking"},{id:"TYR",name:"TYROSINE",type:"l-peptide linking"},{id:"ASP",name:"ASPARTIC ACID",type:"l-peptide linking"},{id:"GLU",name:"GLUTAMIC ACID",type:"l-peptide linking"},{id:"THR",name:"THREONINE",type:"l-peptide linking"},{id:"PRO",name:"PROLINE",type:"l-peptide linking"},{id:"SEC",name:"SELENOCYSTEINE",type:"l-peptide linking"},{id:"PYL",name:"PYRROLYSINE",type:"l-peptide linking"},{id:"MSE",name:"SELENOMETHIONINE",type:"l-peptide linking"},{id:"SEP",name:"PHOSPHOSERINE",type:"l-peptide linking"},{id:"TPO",name:"PHOSPHOTHREONINE",type:"l-peptide linking"},{id:"PTR",name:"O-PHOSPHOTYROSINE",type:"l-peptide linking"},{id:"PCA",name:"PYROGLUTAMIC ACID",type:"l-peptide linking"},{id:"A",name:"ADENOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"C",name:"CYTIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"T",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"G",name:"GUANOSINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"I",name:"INOSINIC ACID",type:"rna linking"},{id:"U",name:"URIDINE-5'-MONOPHOSPHATE",type:"rna linking"},{id:"DA",name:"2'-DEOXYADENOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DC",name:"2'-DEOXYCYTIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DT",name:"THYMIDINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DG",name:"2'-DEOXYGUANOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DI",name:"2'-DEOXYINOSINE-5'-MONOPHOSPHATE",type:"dna linking"},{id:"DU",name:"2'-DEOXYURIDINE-5'-MONOPHOSPHATE",type:"dna linking"}].forEach(n=>e.set(n.id,n)),e}(),Iae=function(){const e=new Map;return[{id:"ZN2",name:"ZINC ION",type:"ion"},{id:"SOD",name:"SODIUM ION",type:"ion"},{id:"CES",name:"CESIUM ION",type:"ion"},{id:"CLA",name:"CHLORIDE ION",type:"ion"},{id:"CAL",name:"CALCIUM ION",type:"ion"},{id:"POT",name:"POTASSIUM ION",type:"ion"}].forEach(n=>e.set(n.id,n)),e}();class qh{set(t){this.comps.set(t.id,t),this.ids.push(t.id),this.names.push(t.name),this.types.push(t.type),this.mon_nstd_flags.push(yw.has(t.id)?"y":"n")}getAtomIds(t){const n=new Set,r=this.seqId.value(t);for(;t<this.seqId.rowCount;){if(this.seqId.value(t)!==r)break;n.add(this.atomId.value(t)),t+=1}return n}hasAtomIds(t,n){for(let r=0,i=n.length;r<i;++r)if(!Lo.areIntersecting(t,n[r]))return!1;return!0}getType(t){return this.hasAtomIds(t,eze)?"peptide linking":this.hasAtomIds(t,tze)?"rna linking":this.hasAtomIds(t,nze)?"dna linking":"other"}has(t){return this.comps.has(t)}get(t){return this.comps.get(t)}add(t,n){if(!this.has(t))if(Aae.has(t))this.set(Aae.get(t));else if(KR.has(t))this.set({id:t,name:"WATER",type:"non-polymer"});else if(rze.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"non-polymer"});else if($0.has(t.toUpperCase()))this.set({id:t,name:this.namesMap.get(t)||t,type:"saccharide"});else{const r=this.getAtomIds(n);if(1===r.size&&Iae.has(t))this.set(Iae.get(t));else{const i=this.getType(r);this.set({id:t,name:this.namesMap.get(t)||t,type:i})}}return this.get(t)}getChemCompTable(){return Kr.ofPartialColumns(ic.chem_comp,{id:ce.ofStringArray(this.ids),name:ce.ofStringArray(this.names),type:ce.ofStringAliasArray(this.types),mon_nstd_flag:ce.ofStringAliasArray(this.mon_nstd_flags)},this.ids.length)}setNames(t){t.forEach(n=>this.namesMap.set(n[0],n[1]))}constructor(t,n){this.seqId=t,this.atomId=n,this.namesMap=new Map,this.comps=new Map,this.ids=[],this.names=[],this.types=[],this.mon_nstd_flags=[]}}var Ui,j3;function jz(e,t){const n=Ui.fromFrame(e,void 0,void 0,t),r=hp(n.data.db,!0);return Ke.create("Create mmCIF Model",i=>cg(r,n,i))}function Uz(){return Uz=le(function*(e,t,n){const r=yield Eae(e,t,{coordinateType:"ideal",cartn_x:"pdbx_model_Cartn_x_ideal",cartn_y:"pdbx_model_Cartn_y_ideal",cartn_z:"pdbx_model_Cartn_z_ideal"},n),i=yield Eae(e,t,{coordinateType:"model",cartn_x:"model_Cartn_x",cartn_y:"model_Cartn_y",cartn_z:"model_Cartn_z"},n),o=[];r&&o.push(r),i&&o.push(i);for(let s=0,a=o.length;s<a;++s)Sn.TrajectoryInfo.set(o[s],{index:s,size:o.length});return new ay(o)}),Uz.apply(this,arguments)}function Eae(e,t,n,r){return zz.apply(this,arguments)}function zz(){return zz=le(function*(e,t,n,r){const{chem_comp:i,chem_comp_atom:o,chem_comp_bond:s}=e,{coordinateType:a,cartn_x:l,cartn_y:c,cartn_z:u}=n,d=i.name.value(0),f=i.id.value(0),{atom_id:p,charge:m,comp_id:h,pdbx_ordinal:g,type_symbol:y}=o,v=o._rowCount,x=[];for(let G=0;G<v;G++)o[l].valueKind(G)>0||(x[x.length]=G);const _=x.length,w=ce.ofConst("A",_,ce.Schema.str),A=ce.ofConst(1,_,ce.Schema.int),M=ce.ofConst("1",_,ce.Schema.str),E=ce.ofConst(1,_,ce.Schema.float),D=ce.ofConst(1,_,ce.Schema.int),T=ce.view(p,x),F=ce.view(h,x),R=ce.view(o[l],x),N=ce.view(o[c],x),j=ce.view(o[u],x),W=ce.view(g,x),z=ce.view(y,x),$=ce.view(m,x),V=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:w,auth_atom_id:T,auth_comp_id:F,auth_seq_id:A,Cartn_x:R,Cartn_y:N,Cartn_z:j,id:W,label_asym_id:w,label_atom_id:T,label_comp_id:F,label_seq_id:A,label_entity_id:M,occupancy:E,type_symbol:z,pdbx_PDB_model_num:D,pdbx_formal_charge:$},_),X=new Gh;X.setNames([[f,`${d} (${a})`]]),X.getEntityId(f,0,"A");const H=new qh(A,y);H.setNames([[f,`${d} (${a})`]]),H.add(f,0);const oe=hp({entity:X.getEntityTable(),chem_comp:H.getChemCompTable(),atom_site:V}),te=yield cg(oe,t,r);if(!te.representative)return;const K=te.representative,Q=t_.getEntriesFromChemCompBond(s);return t_.Provider.set(K,{data:s,entries:Q}),j3.CoordinateType.set(K,a),te.representative}),zz.apply(this,arguments)}Vs.Provider.formatRegistry.add("mmCIF",function ize(e){if(Ui.is(e.sourceData))return Vs.fromData(e.sourceData.data.db)}),o_.Provider.formatRegistry.add("mmCIF",function oze(e){if(!Ui.is(e.sourceData))return;const{struct_conf:t,struct_sheet_range:n}=e.sourceData.data.db;return o_.fromStruct(t,n,e.atomicHierarchy)}),ag.Provider.formatRegistry.add("mmCIF",function sze(e){if(!Ui.is(e.sourceData))return;const{atom_site_anisotrop:t}=e.sourceData.data.db;return{data:Kr.ofColumns(ag.Schema,t),elementToAnsiotrop:ag.getElementToAnsiotrop(e.atomicConformation.atomId,t.id)}},function aze(e){return!!Ui.is(e.sourceData)&&e.sourceData.data.db.atom_site_anisotrop.U.isDefined}),t_.Provider.formatRegistry.add("mmCIF",function lze(e){if(!Ui.is(e.sourceData))return;const{chem_comp_bond:t}=e.sourceData.data.db;return 0!==t._rowCount?{data:t,entries:t_.getEntriesFromChemCompBond(t)}:void 0}),vf.Provider.formatRegistry.add("mmCIF",function cze(e){if(!Ui.is(e.sourceData))return;const{struct_conn:t}=e.sourceData.data.db;if(0===t._rowCount)return;const n=vf.getEntriesFromStructConn(t,e);return{data:t,byAtomIndex:vf.getAtomIndexFromEntries(n),entries:n}}),s_.Provider.formatRegistry.add("mmCIF",s_.fromMmCif,s_.hasData),function(e){e.is=function t(r){return"mmCIF"===r?.kind},e.fromFrame=function n(r,i,o,s){return i||(i=Hh.schema.mmCIF(r)),{kind:"mmCIF",name:i._name,data:{db:i,file:s,frame:r,source:o}}}}(Ui||(Ui={})),function(e){const t="__CcdCoordinateType__";e.CoordinateType={get:i=>i._staticPropertyData[t],set:(i,o)=>i._staticPropertyData[t]=o},e.is=function n(i){return"CCD"===i?.kind},e.fromFrame=function r(i,o){return o||(o=Hh.schema.CCD(i)),{kind:"CCD",name:o._name,data:{db:o,frame:i}}}}(j3||(j3={}));const a_=typeof process<"u"&&null!=process.versions&&null!=process.versions.node,U3=function fze(){return typeof XMLHttpRequest>"u"||a_?ln(684):XMLHttpRequest}(),Vz=function pze(){if(typeof File>"u"||a_){class e{arrayBuffer(){return this.blob.arrayBuffer()}slice(n,r,i){return this.blob.slice(n,r,i)}stream(){return this.blob.stream()}text(){return this.blob.text()}constructor(n,r,i){var o;this.blob=new Blob(n,i),this.size=this.blob.size,this.type=this.blob.type,this.name=r,this.lastModified=null!==(o=i?.lastModified)&&void 0!==o?o:0,this.webkitRelativePath=""}}return e}return File}();function ty(e,t){return e[t]|e[t+1]<<8}function l_(e,t,n){e[t]=255&n,e[t+1]=n>>8&255}function c_(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])}function ny(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255}function gze(e){return e.length<2?"0"+e:e}function Tae(e){const t=e.length;let n=0;for(let r=0;r<t;r++){const i=e.charCodeAt(r);if(4294967168&i)if(4294965248&i)if(4294901760&i){if(4292870144&i)throw new Error("e");n+=4}else n+=3;else n+=2;else n++}return n}const vze=function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let n=t;for(let r=0;r<8;r++)1&n?n=3988292384^n>>>1:n>>>=1;e[t]=n}return e}();function Dae(e,t,n){return 4294967295^function xze(e,t,n,r){for(let i=0;i<r;i++)e=vze[255&(e^t[n+i])]^e>>>8;return e}(4294967295,e,t,n)}const Rt=function(){const e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}();function z3(e,t,n){const r=e.length,i=Rt.rev15;for(let o=0;o<r;o+=2)if(0!==e[o+1]){const a=e[o+1],l=o>>1<<4|a,c=t-a;let u=e[o]<<c;const d=u+(1<<c);for(;u!==d;)n[i[u]>>>15-t]=l,u++}}function T1(e,t){const n=e.length,r=Rt.bl_count;for(let s=0;s<=t;s++)r[s]=0;for(let s=1;s<n;s+=2)r[e[s]]++;const i=Rt.next_code;let o=0;r[0]=0;for(let s=1;s<=t;s++)o=o+r[s-1]<<1,i[s]=o;for(let s=0;s<n;s+=2){const a=e[s+1];0!==a&&(e[s]=i[a],i[a]++)}}function V3(e,t){const n=Rt.rev15,r=15-t;for(let i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r}function Sze(e,t){const{data:n,noBuf:r}=e;let{buf:i,BFINAL:o,off:s,pos:a}=e,l=0;for(;0===o&&l<t;){let c,u,d=0,f=0;o=qz(n,a,1),l+=1;const p=qz(n,a+1,2);if(a+=3,0!==p){if(r&&(i=Gz(i,s+(1<<17))),1===p)c=Rt.flmap,u=Rt.fdmap,d=511,f=31;else{if(2!==p)throw new Error(`unknown BTYPE ${p}`);{const m=D1(n,a,5)+257,h=D1(n,a+5,5)+1,g=D1(n,a+10,4)+4;a+=14;for(let _=0;_<38;_+=2)Rt.itree[_]=0,Rt.itree[_+1]=0;let y=1;for(let _=0;_<g;_++){const w=D1(n,a+3*_,3);Rt.itree[1+(Rt.ordr[_]<<1)]=w,w>y&&(y=w)}a+=3*g,T1(Rt.itree,y),z3(Rt.itree,y,Rt.imap),c=Rt.lmap,u=Rt.dmap,a=wze(Rt.imap,(1<<y)-1,m+h,n,a,Rt.ttree);const v=Pae(Rt.ttree,0,m,Rt.ltree);d=(1<<v)-1;const x=Pae(Rt.ttree,m,h,Rt.dtree);f=(1<<x)-1,T1(Rt.ltree,v),z3(Rt.ltree,v,c),T1(Rt.dtree,x),z3(Rt.dtree,x,u)}}for(;;){const m=c[Wz(n,a)&d];a+=15&m;const h=m>>>4;if(h>>>8){if(256===h)break;{let g=s+h-254;if(h>264){const w=Rt.ldef[h-257];g=s+(w>>>3)+D1(n,a,7&w),a+=7&w}const y=u[Wz(n,a)&f];a+=15&y;const x=Rt.ddef[y>>>4],_=(x>>>4)+qz(n,a,15&x);for(a+=15&x,r&&(i=Gz(i,s+(1<<17)));s<g;)i[s]=i[s++-_],i[s]=i[s++-_],i[s]=i[s++-_],i[s]=i[s++-_];s=g}}else i[s++]=h}}else{7&a&&(a+=8-(7&a));const m=4+(a>>>3),h=n[m-4]|n[m-3]<<8;r&&(i=Gz(i,s+h)),i.set(new Uint8Array(n.buffer,n.byteOffset+m,h),s),a=m+h<<3,s+=h}}e.buf=i,e.BFINAL=o,e.off=s,e.pos=a}function Hz(){return Hz=le(function*(e,t,n){if(3===t[0]&&0===t[1])return n||new Uint8Array(0);const r=function _ze(e,t){const n=void 0===t;return void 0===t&&(t=new Uint8Array(e.length>>>2<<3)),{data:e,buf:t,noBuf:n,BFINAL:0,off:0,pos:0}}(t,n);for(;0===r.BFINAL;)e.shouldUpdate&&(yield e.update({message:"Inflating blocks...",current:r.pos,max:t.length})),Sze(r,100);return r.buf.length===r.off?r.buf:r.buf.slice(0,r.off)}),Hz.apply(this,arguments)}function Gz(e,t){const n=e.length;if(t<=n)return e;const r=new Uint8Array(Math.max(n<<1,t));return r.set(e,0),r}function wze(e,t,n,r,i,o){let s=0;for(;s<n;){const a=e[Wz(r,i)&t];i+=15&a;const l=a>>>4;if(l<=15)o[s]=l,s++;else{let c=0,u=0;16===l?(u=3+D1(r,i,2),i+=2,c=o[s-1]):17===l?(u=3+D1(r,i,3),i+=3):18===l&&(u=11+D1(r,i,7),i+=7);const d=s+u;for(;s<d;)o[s]=c,s++}}return i}function Pae(e,t,n,r){let i=0,o=0;const s=r.length>>>1;for(;o<n;){const a=e[o+t];r[o<<1]=0,r[1+(o<<1)]=a,a>i&&(i=a),o++}for(;o<s;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i}function D1(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1}function qz(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1}function Wz(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)}function $z(e,t,n){const r=[],i=e.length,o=t.length;for(let m=0;m<o;m+=2)t[m]=0,t[m+1]=0;for(let m=0;m<i;m++)0!==e[m]&&r.push({lit:m,f:e[m],d:void 0});const s=r.length,a=r.slice(0);if(0===s)return 0;if(1===s){const m=r[0].lit,h=0===m?1:0;return t[1+(m<<1)]=1,t[1+(h<<1)]=1,1}r.sort(function(m,h){return m.f-h.f});let l=r[0],c=r[1],u=0,d=1,f=2;for(r[0]={lit:-1,f:l.f+c.f,l,r:c,d:0};d!==s-1;)l=u!==d&&(f===s||r[u].f<r[f].f)?r[u++]:r[f++],c=u!==d&&(f===s||r[u].f<r[f].f)?r[u++]:r[f++],r[d++]={lit:-1,f:l.f+c.f,l,r:c,d:void 0};let p=Yz(r[d-1],0);p>n&&(function Aze(e,t,n){let r=0,i=0;const o=1<<n-t;for(e.sort(function(s,a){return a.d===s.d?s.f-a.f:a.d-s.d}),r=0;r<e.length&&e[r].d>t;r++){const s=e[r].d;e[r].d=t,i+=o-(1<<n-s)}for(i>>>=n-t;i>0;){const s=e[r].d;s<t?(e[r].d++,i-=1<<t-s-1):r++}for(;r>=0;r--)e[r].d===t&&i<0&&(e[r].d--,i++);0!==i&&console.log("debt left")}(a,n,p),p=n);for(let m=0;m<s;m++)t[1+(a[m].lit<<1)]=a[m].d;return p}function Yz(e,t){return-1!==e.lit?(e.d=t,t):Math.max(Yz(e.l,t+1),Yz(e.r,t+1))}function Eze(e,t){const{data:n,dlen:r,out:i,opt:o}=e;let{i:s,pos:a,cvrd:l,li:c,lc:u,bs:d,ebits:f,c:p,nc:m}=e;const{lits:h,strt:g,prev:y}=Rt,v=Math.min(s+t,r);for(;s<v;s++){if(p=m,s+1<r-2){m=Kz(n,s+1);const x=s+1&32767;y[x]=g[m],g[m]=x}if(l<=s){(c>14e3||u>26697)&&r-s>100&&(l<s&&(h[c]=s-l,c+=2,l=s),a=kae(s===r-1||l===r?1:0,h,c,f,n,d,s-d,i,a),c=u=f=0,d=s);let x=0;if(s<r-2&&(x=Pze(n,s,y,p,Math.min(o[2],r-s),o[3])),0!==x){const _=x>>>16,w=65535&x,A=Fae(_,Rt.of0);Rt.lhst[257+A]++;const M=Fae(w,Rt.df0);Rt.dhst[M]++,f+=Rt.exb[A]+Rt.dxb[M],h[c]=_<<23|s-l,h[c+1]=w<<16|A<<8|M,c+=2,l=s+_}else Rt.lhst[n[s]]++;u++}}e.i=s,e.pos=a,e.cvrd=l,e.li=c,e.lc=u,e.bs=d,e.ebits=f,e.c=p,e.nc=m}!function(){for(let n=0;n<32768;n++){let r=n;r=(2863311530&r)>>>1|(1431655765&r)<<1,r=(3435973836&r)>>>2|(858993459&r)<<2,r=(4042322160&r)>>>4|(252645135&r)<<4,r=(4278255360&r)>>>8|(16711935&r)<<8,Rt.rev15[n]=(r>>>16|r<<16)>>>17}function t(n,r,i){for(;0!=r--;)n.push(0,i)}for(let n=0;n<32;n++)Rt.ldef[n]=Rt.of0[n]<<3|Rt.exb[n],Rt.ddef[n]=Rt.df0[n]<<4|Rt.dxb[n];t(Rt.fltree,144,8),t(Rt.fltree,112,9),t(Rt.fltree,24,7),t(Rt.fltree,8,8),T1(Rt.fltree,9),z3(Rt.fltree,9,Rt.flmap),V3(Rt.fltree,9),t(Rt.fdtree,32,5),T1(Rt.fdtree,5),z3(Rt.fdtree,5,Rt.fdmap),V3(Rt.fdtree,5),t(Rt.itree,19,0),t(Rt.ltree,286,0),t(Rt.dtree,30,0),t(Rt.ttree,320,0)}();const Tze=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]];function Xz(){return Xz=le(function*(e,t,n,r,i){const o=function Ize(e,t,n,r){const{lits:i,strt:o,prev:s}=Rt;return{data:e,out:t,opt:Tze[r],i:0,pos:n<<3,cvrd:0,dlen:e.length,li:0,lc:0,bs:0,ebits:0,c:0,nc:0,lits:i,strt:o,prev:s}}(t,n,r,i),{dlen:s}=o;if(0===i){let{i:m,pos:h}=o;for(;m<s;){const g=Math.min(65535,s-m);u_(n,h,m+g===s?1:0),h=Mae(t,m,g,n,h+8),m+=g}return h>>>3}for(s>2&&(o.nc=Kz(t,0),o.strt[o.nc]=0);o.i<s;)e.shouldUpdate&&(yield e.update({message:"Deflating...",current:o.i,max:s})),Eze(o,1048576);let{li:a,cvrd:l,pos:c}=o;const{i:u,lits:d,bs:f,ebits:p}=o;for((f!==u||0===t.length)&&(l<u&&(d[a]=u-l,a+=2,l=u),c=kae(1,d,a,p,t,f,u-f,n,c));7&c;)c++;return c>>>3}),Xz.apply(this,arguments)}function Pze(e,t,n,r,i,o){let s=32767&t,a=n[s],l=s-a+32768&32767;if(a===s||r!==Kz(e,t-l))return 0;let c=0,u=0;const d=Math.min(32767,t);for(;l<=d&&0!=--o&&a!==s;){if(0===c||e[t+c]===e[t+c-l]){let f=kze(e,t,l);if(f>c){if(c=f,u=l,c>=i)break;l+2<f&&(f=l+2);let p=0;for(let m=0;m<f-2;m++){const h=t-l+m+32768&32767,y=h-n[h]+32768&32767;y>p&&(p=y,a=h)}}}s=a,a=n[s],l+=s-a+32768&32767}return c<<16|u}function kze(e,t,n){if(e[t]!==e[t-n]||e[t+1]!==e[t+1-n]||e[t+2]!==e[t+2-n])return 0;const r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]===e[t-n];)t++;return t-r}function Kz(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535}function kae(e,t,n,r,i,o,s,a,l){Rt.lhst[256]++;const[c,u,d,f,p,m,h,g]=function Mze(){const e=$z(Rt.lhst,Rt.ltree,15),t=$z(Rt.dhst,Rt.dtree,15),n=[],r=Nae(Rt.ltree,n),i=[],o=Nae(Rt.dtree,i);for(let l=0;l<n.length;l+=2)Rt.ihst[n[l]]++;for(let l=0;l<i.length;l+=2)Rt.ihst[i[l]]++;const s=$z(Rt.ihst,Rt.itree,7);let a=19;for(;a>4&&0===Rt.itree[1+(Rt.ordr[a-1]<<1)];)a--;return[e,t,s,r,o,a,n,i]}(),y=32+(l+3&7?8-(l+3&7):0)+(s<<3),v=r+H3(Rt.fltree,Rt.lhst)+H3(Rt.fdtree,Rt.dhst);let x=r+H3(Rt.ltree,Rt.lhst)+H3(Rt.dtree,Rt.dhst);x+=14+3*m+H3(Rt.itree,Rt.ihst)+(2*Rt.ihst[16]+3*Rt.ihst[17]+7*Rt.ihst[18]);for(let w=0;w<286;w++)Rt.lhst[w]=0;for(let w=0;w<30;w++)Rt.dhst[w]=0;for(let w=0;w<19;w++)Rt.ihst[w]=0;const _=y<v&&y<x?0:v<x?1:2;if(_5(a,l,e),_5(a,l+1,_),l+=3,0===_){for(;7&l;)l++;l=Mae(i,o,s,a,l)}else{let w,A;if(1===_)w=Rt.fltree,A=Rt.fdtree;else if(2===_){T1(Rt.ltree,c),V3(Rt.ltree,c),T1(Rt.dtree,u),V3(Rt.dtree,u),T1(Rt.itree,d),V3(Rt.itree,d),w=Rt.ltree,A=Rt.dtree,u_(a,l,f-257),u_(a,l+=5,p-1),u_(a,l+=5,m-4),l+=4;for(let E=0;E<m;E++)u_(a,l+3*E,Rt.itree[1+(Rt.ordr[E]<<1)]);l=Rae(h,Rt.itree,a,l+=3*m),l=Rae(g,Rt.itree,a,l)}else Hi();let M=o;for(let E=0;E<n;E+=2){const D=t[E],T=D>>>23,F=M+(8388607&D);for(;M<F;)l=G3(i[M++],w,a,l);if(0!==T){const R=t[E+1],N=R>>16,j=R>>8&255,W=255&R;u_(a,l=G3(257+j,w,a,l),T-Rt.of0[j]),_5(a,l=G3(W,A,a,l+=Rt.exb[j]),N-Rt.df0[W]),l+=Rt.dxb[W],M+=T}}l=G3(256,w,a,l)}return l}function Mae(e,t,n,r,i){let o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)}function H3(e,t){let n=0;for(let r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n}function Rae(e,t,n,r){for(let i=0;i<e.length;i+=2){const o=e[i],s=e[i+1];r=G3(o,t,n,r);const a=16===o?2:17===o?3:7;o>15&&(u_(n,r,s),r+=a)}return r}function Nae(e,t){let n=e.length;for(;2!==n&&0===e[n-1];)n-=2;for(let r=0;r<n;r+=2){const i=e[r+1],o=r+3<n?e[r+3]:-1,s=r+5<n?e[r+5]:-1,a=0===r?-1:e[r-1];if(0===i&&o===i&&s===i){let l=r+5;for(;l+2<n&&e[l+2]===i;)l+=2;const c=Math.min(l+1-r>>>1,138);c<11?t.push(17,c-3):t.push(18,c-11),r+=2*c-2}else if(i===a&&o===i&&s===i){let l=r+5;for(;l+2<n&&e[l+2]===i;)l+=2;const c=Math.min(l+1-r>>>1,6);t.push(16,c-3),r+=2*c-2}else t.push(i,0)}return n>>>1}function Fae(e,t){let n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n}function G3(e,t,n,r){return _5(n,r,t[e<<1]),r+t[1+(e<<1)]}function u_(e,t,n){const r=t>>>3;e[r]|=n<<=7&t,e[r+1]|=n>>>8}function _5(e,t,n){const r=t>>>3;e[r]|=n<<=7&t,e[r+1]|=n>>>8,e[r+2]|=n>>>16}function q3(e,t){return Zz.apply(this,arguments)}function Zz(){return Zz=le(function*(e,t,n=!1){const r=Object.create(null),i=new Uint8Array(t);if(19280!==ty(i,0))throw new Error('Invalid ZIP file. A valid ZIP file must start with two magic bytes \\x50\\x4b ("PK" in ASCII).');let o=i.length-4;for(;101010256!==c_(i,o);)o--;let s=o;s+=4,s+=4;const a=ty(i,s);s+=2,s+=2,s+=4;const l=c_(i,s);s+=4,s=l;for(let c=0;c<a;c++){s+=4,s+=4,s+=4,s+=4,s+=4;const u=c_(i,s);s+=4;const d=c_(i,s);s+=4;const f=ty(i,s),p=ty(i,s+2),m=ty(i,s+4);s+=6,s+=8;const h=c_(i,s);s+=4,s+=f+p+m,yield Rze(e,i,h,r,u,d,n)}return r}),Zz.apply(this,arguments)}function Rze(e,t,n,r,i,o,s){return Qz.apply(this,arguments)}function Qz(){return Qz=le(function*(e,t,n,r,i,o,s){n+=4,n+=2;const a=ty(t,n+=2);n+=2,n+=4,n+=4;const l=ty(t,n+=8),c=ty(t,n+=2),u=function yze(e,t,n){let i,r="";for(let o=0;o<n;o++)r+="%"+gze(e[t+o].toString(16));try{i=decodeURIComponent(r)}catch{return function mze(e,t,n){let r="";for(let i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r}(e,t,n)}return i}(t,n+=2,l);if(n+=l,n+=c,s)return void(r[u]={size:o,csize:i});const d=new Uint8Array(t.buffer,n);if(0===a)r[u]=new Uint8Array(d.buffer.slice(n,n+i));else{if(8!==a)throw new Error(`unknown compression method: ${a}`);{const f=new Uint8Array(o);yield Jz(e,d,f),r[u]=f}}}),Qz.apply(this,arguments)}function Jz(e,t,n){return e7.apply(this,arguments)}function e7(){return e7=le(function*(e,t,n){return function Cze(e,t,n){return Hz.apply(this,arguments)}(e,t,n)}),e7.apply(this,arguments)}function t7(){return t7=le(function*(e,t,n){const r=t[3];let i=10;if(4&r&&(i+=ty(t,i)),8&r){let u=i;for(;0!==t[u];)++u;i=u+1}if(16&r){let u=i;for(;0!==t[u];)++u;i=u+1}1&r&&(i+=2);const o=function hze(e){return 0|e}(c_(t,t.length-8)),s=c_(t,t.length-4);void 0===n&&(n=new Uint8Array(s));const a=new Uint8Array(t.buffer,t.byteOffset+i,t.length-i-8),l=yield Jz(e,a,n);return o!==Dae(l,0,l.length)&&console.error("ungzip: checksums don't match"),l}),t7.apply(this,arguments)}function Fze(e,t,n){return r7.apply(this,arguments)}function r7(){return r7=le(function*(e,t,n){void 0===n&&(n={level:6});const r=new Uint8Array(50+Math.floor(1.1*t.length)),i=yield function Dze(e,t,n,r,i){return Xz.apply(this,arguments)}(e,t,r,0,n.level);return new Uint8Array(r.buffer,0,i)}),r7.apply(this,arguments)}function i7(){return i7=le(function*(e,t,n=!1){let r=0;const i={};for(const d in t){const f=!Lze(d)&&!n,p=t[d],m=Dae(p,0,p.length);i[d]={cpr:f,usize:p.length,crc:m,file:f?yield Fze(e,p):p}}for(const d in i)r+=i[d].file.length+30+46+2*Tae(d);r+=22;const o=new Uint8Array(r);let s=0;const a=[];for(const d in i){const f=i[d];a.push(s),s=Oae(o,s,d,f,0)}let l=0;const c=s;for(const d in i){const f=i[d];a.push(s),s=Oae(o,s,d,f,1,a[l++])}const u=s-c;return ny(o,s,101010256),s+=4,s+=4,l_(o,s,l),s+=2,l_(o,s,l),s+=2,ny(o,s,u),s+=4,ny(o,s,c),s+=4,s+=2,o.buffer}),i7.apply(this,arguments)}function Lze(e){const t=e.split(".").pop().toLowerCase();return-1!=="png,jpg,jpeg,zip".indexOf(t)}function Oae(e,t,n,r,i,o=0){const s=r.file;ny(e,t,0===i?67324752:33639248),t+=4,1===i&&(t+=2),l_(e,t,20),l_(e,t+=2,0),l_(e,t+=2,r.cpr?8:0),ny(e,t+=2,0),ny(e,t+=4,r.crc),ny(e,t+=4,s.length),ny(e,t+=4,r.usize),l_(e,t+=4,Tae(n)),l_(e,t+=2,0),t+=2,1===i&&(t+=2,t+=2,ny(e,t+=6,o),t+=4);const a=function bze(e,t,n){const r=n.length;let i=0;for(let o=0;o<r;o++){const s=n.charCodeAt(o);if(4294967168&s)if(4294965248&s)if(4294901760&s){if(4292870144&s)throw new Error("e");e[t+i]=240|s>>18,e[t+i+1]=128|s>>12&63,e[t+i+2]=128|s>>6&63,e[t+i+3]=128|63&s,i+=4}else e[t+i]=224|s>>12,e[t+i+1]=128|s>>6&63,e[t+i+2]=128|63&s,i+=3;else e[t+i]=192|s>>6,e[t+i+1]=128|63&s,i+=2;else e[t+i]=s,i++}return i}(e,t,n);return t+=a,0===i&&(e.set(s,t),t+=s.length),t}var mp=function(e){return e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zip=2]="Zip",e}(mp||{});function ry(e,t){return function l7(e,t){if(a_)return function Vze(e,t){return Ke.create("Read File",function(){var n=le(function*(r){const i="zip"===t?mp.None:jae(e.name);let o;return yield r.update({message:"Opening file...",canAbort:!1}),o="binary"===t||"zip"===t||i!==mp.None?yield e.arrayBuffer():yield e.text(),yield r.update({message:"Processing file...",canAbort:!1}),yield Uae(r,o,t,i)});return function(r){return n.apply(this,arguments)}}())}(e,t);let n;return Ke.create("Read File",function(){var r=le(function*(i){try{n=new FileReader;const o="zip"===t?mp.None:jae(e.name);"binary"===t||"zip"===t||o!==mp.None?n.readAsArrayBuffer(e):n.readAsText(e),yield i.update({message:"Opening file...",canAbort:!0});const s=yield Lae(i,"Reading...",n);return yield i.update({message:"Processing file...",canAbort:!1}),yield Uae(i,s.result,t,o)}finally{n=void 0}});return function(i){return r.apply(this,arguments)}}(),()=>{n&&n.abort()})}(e,t)}function o7(e){return"string"==typeof e?zae(e,e,"string"):zae(e.title,e.url,e.type||"string",e.body,e.headers)}function Bae(e){return e?"Failed to download data. Possible reasons: Resource is not available, or CORS is not allowed on the server.":"Failed to open file."}function Lae(e,t,n){return new Promise((r,i)=>{if(function jze(e){if(!a_&&e instanceof FileReader)return e.readyState===FileReader.DONE;if(e instanceof U3)return e.readyState===U3.DONE;throw new Error("unknown data type")}(n)){const{error:s}=n;return void(null!=s?i(s??Bae(n instanceof U3)):r(n))}let o=!1;n.onerror=s=>{if(o)return;const{error:a}=s.target;i(a??Bae(n instanceof U3))},n.onprogress=s=>{if(e.shouldUpdate&&!o)try{e.update(s.lengthComputable?{message:t,isIndeterminate:!1,current:s.loaded,max:s.total}:{message:`${t} ${(s.loaded/1024/1024).toFixed(2)} MB`,isIndeterminate:!0})}catch(a){o=!0,i(a)}},n.onload=s=>{r(n)}})}function jae(e){return/\.gz$/i.test(e)?mp.Gzip:/\.zip$/i.test(e)?mp.Zip:mp.None}const Uze=/^(__MACOSX|.DS_Store)/;function s7(){return s7=le(function*(e,t,n){switch(n){case mp.None:return t;case mp.Gzip:return function Nze(e,t,n){return t7.apply(this,arguments)}(e,t);case mp.Zip:const r=yield q3(e,t.buffer),i=Object.keys(r).filter(o=>!Uze.test(o));if(1!==i.length)throw new Error("can only decompress zip files with a single entry");return r[i[0]]}}),s7.apply(this,arguments)}function Uae(e,t,n,r){return a7.apply(this,arguments)}function a7(){return a7=le(function*(e,t,n,r){let i=t instanceof ArrayBuffer?new Uint8Array(t):t;if(null===i)throw new Error("no data given");if(r!==mp.None){if(!(i instanceof Uint8Array))throw new Error("need Uint8Array for decompression");const o=yield function zze(e,t,n){return s7.apply(this,arguments)}(e,i,r);"string"===n?(yield e.update({message:"Decoding text..."}),i=mz(o,0,o.length)):i=o}if("binary"===n&&i instanceof Uint8Array)return i;if("zip"===n&&i instanceof Uint8Array)return yield q3(e,i.buffer);if("string"===n&&"string"==typeof i)return i;if("xml"===n&&"string"==typeof i)return(new DOMParser).parseFromString(i,"application/xml");if("json"===n&&"string"==typeof i)return JSON.parse(i);throw new Error(`could not get requested response data '${n}'`)}),a7.apply(this,arguments)}let u7,c7=(()=>{class e{static get(){return this.pool.length?this.pool.pop():new U3}static emptyFunc(){}static deposit(n){this.pool.length<this.poolSize&&(n.onabort=e.emptyFunc,n.onerror=e.emptyFunc,n.onload=e.emptyFunc,n.onprogress=e.emptyFunc,this.pool.push(n))}}return e.pool=[],e.poolSize=15,e})();function zae(e,t,n,r,i){if(a_&&t.startsWith("file://"))return function Wze(e,t,n,r,i){if(!a_)throw new Error("This function should only be used when running in Node.js");if(!t.startsWith("file://"))throw new Error("This function is only for URLs with protocol file://");const o=t.substring(7),s=function qze(){if(!u7)throw new Error("When running in Node.js and reading from files, call mol-util/data-source's setFSModule function first.");return u7}().readFileSync(o);return ry(new Vz([s],"raw-data"),n)}(0,t,n);let o;return Ke.create(e||"Download",function(){var s=le(function*(a){if(o=c7.get(),o.open(r?"post":"get",t,!0),i)for(const[u,d]of i)o.setRequestHeader(u,d);o.responseType=function Gze(e){switch(e){case"json":return"json";case"xml":return"document";case"string":return"text";case"binary":case"zip":return"arraybuffer"}}(n),o.send(r),yield a.update({message:"Waiting for server...",canAbort:!0});const l=yield Lae(a,"Downloading...",o);return o=void 0,yield a.update({message:"Parsing response...",canAbort:!1}),function Hze(e,t){if(e.status>=200&&e.status<400){const{response:n}=e;if(c7.deposit(e),("binary"===t||"zip"===t)&&n instanceof ArrayBuffer)return new Uint8Array(n);if("string"===t&&"string"==typeof n)return n;if("xml"===t&&n instanceof XMLDocument)return n;if("json"===t&&"object"==typeof n)return n;throw new Error(`could not get requested response data '${t}'`)}throw c7.deposit(e),new Error(`Download failed with status code ${e.status}`)}(l,n)});return function(a){return s.apply(this,arguments)}}(),()=>{o&&(o.abort(),o=void 0)})}function d7(){return d7=le(function*(e,t,n,r){const i=n.length,o=new Array(n.length);yield e.update({message:"Downloading...",current:0,max:i});let s=[],a=[],l=0;for(let u=Math.min(i,r);l<u;l++){const d=n[l];s.push(Hae(l,d.id,t.resolve(jr.getUrlAsset(t,d.url),d.isBinary?"binary":"string").runAsChild(e))),a.push(l)}let c=0;for(;s.length>0;){const u=yield Promise.race(s),d=n[u.index],f=a.indexOf(u.index);if(c++,"error"===u.kind&&!d.canFail)throw new Error(`${d.url}: ${u.error}`);if(e.shouldUpdate&&(yield e.update({message:"Downloading...",current:c,max:i})),o[u.index]=u,s=s.filter(Vae,f),a=a.filter(Vae,f),l<i){const p=n[l],m=t.resolve(jr.getUrlAsset(t,p.url),p.isBinary?"binary":"string").runAsChild(e);s.push(Hae(l,p.id,m)),a.push(l),l++}}return o}),d7.apply(this,arguments)}function Vae(e,t){return this!==t}function Hae(e,t,n){return f7.apply(this,arguments)}function f7(){return f7=le(function*(e,t,n){try{return{kind:"ok",result:yield n,index:e,id:t}}catch(r){return{kind:"error",error:r,index:e,id:t}}}),f7.apply(this,arguments)}var jr,I;!function(e){function t(l,c){return{kind:"url",id:oo.create22(),url:l,...c}}e.Url=t,e.File=function n(l){return{kind:"file",id:oo.create22(),name:l.name,file:l}},e.isUrl=function r(l){return"url"===l?.kind},e.isFile=function i(l){return"file"===l?.kind},e.Wrapper=function o(l,c,u){return{data:l,dispose:()=>{u.release(c)}}},e.getUrl=function s(l){return"string"==typeof l?l:l.url},e.getUrlAsset=function a(l,c,u){return"string"==typeof c?l.tryFindUrl(c,u)||t(c,{body:u}):c}}(jr||(jr={}));class Yze{constructor(){this._assets=new Map}get assets(){return FU(this._assets.values())}tryFindUrl(t,n){const r=this.assets.values();for(;;){const i=r.next();if(i.done)return;const o=i.value.asset;if(jr.isUrl(o)&&o.url===t&&(o.body||"")===(n||""))return o}}set(t,n){this._assets.set(t.id,{asset:t,file:n,refCount:0})}get(t){return this._assets.get(t.id)}delete(t){return this._assets.delete(t.id)}has(t){return this._assets.has(t.id)}resolve(t,n,r=!0){var i=this;return jr.isUrl(t)?Ke.create(`Download ${t.title||t.url}`,function(){var o=le(function*(s){if(i._assets.has(t.id)){const c=i._assets.get(t.id);return c.refCount++,jr.Wrapper(yield ry(c.file,n).runInContext(s),t,i)}if(!r)return jr.Wrapper(yield o7({...t,type:n}).runInContext(s),t,i);const a=yield o7({...t,type:"binary"}).runInContext(s),l=new Vz([a],"raw-data");return i._assets.set(t.id,{asset:t,file:l,refCount:1}),jr.Wrapper(yield ry(l,n).runInContext(s),t,i)});return function(s){return o.apply(this,arguments)}}()):Ke.create(`Read ${t.name}`,function(){var o=le(function*(s){if(i._assets.has(t.id)){const a=i._assets.get(t.id);return a.refCount++,jr.Wrapper(yield ry(a.file,n).runInContext(s),t,i)}if(!(t.file instanceof Vz))throw new Error(`Cannot resolve file asset '${t.name}' (${t.id})`);return r&&i._assets.set(t.id,{asset:t,file:t.file,refCount:1}),jr.Wrapper(yield ry(t.file,n).runInContext(s),t,i)});return function(s){return o.apply(this,arguments)}}())}release(t){const n=this._assets.get(t.id);n&&(n.refCount--,n.refCount<=0&&this._assets.delete(t.id))}clear(){this._assets.clear()}dispose(){this.clear()}}!function(e){function t(he,ie){return ie&&(ie.label&&(he.label=ie.label),ie.description&&(he.description=ie.description),ie.legend&&(he.legend=ie.legend),ie.fieldLabels&&(he.fieldLabels=ie.fieldLabels),ie.isHidden&&(he.isHidden=ie.isHidden),ie.shortLabel&&(he.shortLabel=ie.shortLabel),ie.twoColumns&&(he.twoColumns=ie.twoColumns),ie.isEssential&&(he.isEssential=ie.isEssential),ie.category&&(he.category=ie.category),ie.hideIf&&(he.hideIf=ie.hideIf),ie.help&&(he.help=ie.help)),he}function i(he,ie,ue){return t({type:"select",defaultValue:Ae(he,ie),options:ie,cycle:ue?.cycle},ue)}function h(he,ie){return ie&&(typeof ie.min<"u"&&(he.min=ie.min),typeof ie.max<"u"&&(he.max=ie.max),typeof ie.step<"u"&&(he.step=ie.step)),he}function x(he,ie){const ue=t({type:"group",defaultValue:ie?.customDefault||z(he),params:he},ie);return ie?.presets&&(ue.presets=ie.presets),ie?.isExpanded&&(ue.isExpanded=ie.isExpanded),ie?.isFlat&&(ue.isFlat=ie.isFlat),ie?.pivot&&(ue.pivot=ie.pivot),ue}function E(){return z(this.element)}function D(){throw new Error("getValue not set. Fix runtime.")}function z(he){const ie={};for(const ue of Object.keys(he))he[ue].isOptional||(ie[ue]=he[ue].defaultValue);return ie}function $(he,ie,ue){return()=>he(ie,ue)}function V(he,ie,ue){if(ie)if("value-ref"===he.type){ie.getValue=ie.ref?$(he.resolveRef,ie.ref,ue):()=>{throw new Error("Unset ref in ValueRef value.")}}else if("data-ref"===he.type){ie.getValue=ie.ref?$(ue,ie.ref,ue):()=>{throw new Error("Unset ref in ValueRef value.")}}else if("group"===he.type)oe(he.params,ie,ue);else if("mapped"===he.type){const _e=ie;V(he.map(_e.name),_e.params,ue)}else if("object-list"===he.type){if(!H(he.element))return;for(const _e of ie)oe(he.element,_e,ue)}}function X(he){if("value-ref"===he.type||"data-ref"===he.type)return!0;if("group"===he.type){if(H(he.params))return!0}else if("mapped"===he.type){for(const[ie]of he.select.options)if(X(he.map(ie)))return!0}else if("object-list"===he.type)return H(he.element);return!1}function H(he){for(const ie of Object.keys(he))if(X(he[ie]))return!0;return!1}function oe(he,ie,ue){for(const _e of Object.keys(he))V(he[_e],ie?.[_e],ue)}function G(he,ie,ue){if(ie===ue)return!0;if("object"!=typeof ie||"object"!=typeof ue)return!1;for(const _e of Object.keys(he))if(!Z(he[_e],ie[_e],ue[_e]))return!1;return!0}function Z(he,ie,ue){if(ie===ue)return!0;if("group"===he.type)return G(he.params,ie,ue);if("mapped"===he.type){const _e=ie,Fe=ue;return _e.name===Fe.name&&Z(he.map(_e.name),_e.params,Fe.params)}if("multi-select"===he.type){const _e=ie,Fe=ue;if(_e.length!==Fe.length)return!1;if(_e.length<10){for(let Ze=0,ct=_e.length;Ze<ct;Ze++)if(_e[Ze]!==Fe[Ze]&&Fe.indexOf(_e[Ze])<0)return!1}else{const Ze=new Set(Fe);for(let ct=0,q=_e.length;ct<q;ct++)if(_e[ct]!==Fe[ct]&&!Ze.has(_e[ct]))return!1}return!0}if("interval"===he.type)return ie[0]===ue[0]&&ie[1]===ue[1];if("line-graph"===he.type){const _e=ie,Fe=ue;if(_e.length!==Fe.length)return!1;for(let Ze=0,ct=_e.length;Ze<ct;Ze++)if(!Ue.areEqual(_e[Ze],Fe[Ze]))return!1;return!0}if("vec3"===he.type)return C.equals(ie,ue);if("mat4"===he.type)return fe.areEqual(ie,ue,wi);if("script"===he.type)return ie.language===ue.language&&ie.expression===ue.expression;if("object-list"===he.type){const _e=ie,Fe=ue,Ze=_e.length;if(Ze!==Fe.length)return!1;for(let ct=0;ct<Ze;ct++)if(!G(he.element,_e[ct],Fe[ct]))return!1;return!0}return"object"==typeof ie&&"object"==typeof ue&&lw(ie,ue)}function ee(he,ie,ue){if(void 0===ie)return{...ue};if(void 0===ue)return{...ie};const _e=Object.create(null);for(const Fe of Object.keys(he))_e[Fe]=se(he[Fe],ie[Fe],ue[Fe]);return _e}function se(he,ie,ue){if(void 0===ie)return"object"!=typeof ue||Array.isArray(ue)?ue:{...ue};if(void 0===ue)return"object"!=typeof ie||Array.isArray(ie)?ie:{...ie};if("group"===he.type)return ee(he.params,ie,ue);if("mapped"===he.type){const _e=ie,Fe=ue;if(_e.name!==Fe.name)return{...Fe};const Ze=he.map(Fe.name);return{name:Fe.name,params:se(Ze,_e.params,Fe.params)}}return"value"===he.type?ue:"object"==typeof ie&&"object"==typeof ue?Array.isArray(ue)?ue:{...ie,...ue}:ue}function xe(he,ie){for(const ue of he.options)if(ue[0]===ie)return!0;return!1}function re(he,ie,ue){if(null==ie)return ue?he.defaultValue:void 0;if("value"===he.type)return ie;if("group"===he.type){const _e=Object.create(null);for(const Fe of Object.keys(he.params)){const Ze=he.params[Fe];void 0===ie[Fe]?ue&&(_e[Fe]=Ze.defaultValue):_e[Fe]=re(Ze,ie[Fe],ue)}return _e}if("mapped"===he.type){const _e=ie;if("string"!=typeof _e.name)return he.defaultValue;if(typeof _e.params>"u")return ue?he.defaultValue:void 0;if(!xe(he.select,_e.name))return he.defaultValue;const Fe=he.map(_e.name);return{name:_e.name,params:re(Fe,_e.params,ue)}}if("select"===he.type)return xe(he,ie)?ie:he.defaultValue;if("multi-select"===he.type){if(!Array.isArray(ie))return he.defaultValue;const _e=ie.filter(function(Fe){return xe(this,Fe)},he);return ie.length>0&&0===_e.length?he.defaultValue:_e}return"object-list"===he.type?Array.isArray(ie)?ie.map(_e=>ae(he.element,_e,ue?"all":"skip")):he.defaultValue:ie}function ae(he,ie,ue){if("object"!=typeof ie||null===ie)return ue?z(he):ie;const _e=Object.create(null);for(const Fe of Object.keys(he)){const Ze=he[Fe];void 0===ie[Fe]?"all"===ue&&(_e[Fe]=Ze.defaultValue):_e[Fe]=re(Ze,ie[Fe],"skip"!==ue)}return _e}function Ae(he,ie){for(const ue of ie)if(ue[0]===he)return he;return ie.length>0?ie[0][0]:void 0}e.Essential={isEssential:!0},e.Optional=function n(he){const ie={...he};return ie.isOptional=!0,ie},e.Value=function r(he,ie){return t({type:"value",defaultValue:he},ie)},e.Select=i,e.MultiSelect=function o(he,ie,ue){const _e=t({type:"multi-select",defaultValue:he,options:ie},ue);return ue?.emptyValue&&(_e.emptyValue=ue.emptyValue),_e},e.Boolean=function s(he,ie){return t({type:"boolean",defaultValue:he},ie)},e.Text=function a(he="",ie){return t({type:"text",defaultValue:he,multiline:ie?.multiline,placeholder:ie?.placeholder,disableInteractiveUpdates:ie?.disableInteractiveUpdates},ie)},e.Color=function l(he,ie){const ue=t({type:"color",defaultValue:he},ie);return ie?.isExpanded&&(ue.isExpanded=ie.isExpanded),ue},e.ColorList=function c(he,ie){let ue;if("string"==typeof he){const _e=cp(he);ue={kind:"qualitative"!==_e.type?"interpolate":"set",colors:_e.list}}else ue=he;return t({type:"color-list",presetKind:ie?.presetKind||"all",defaultValue:ue,offsets:!!ie?.offsets},ie)},e.Vec3=function u(he,ie,ue){return t(h({type:"vec3",defaultValue:he},ie),ue)},e.Mat4=function d(he,ie){return t({type:"mat4",defaultValue:he},ie)},e.Url=function f(he,ie){return t({type:"url",defaultValue:"string"==typeof he?jr.Url(he):jr.Url(he.url,{body:he.body})},ie)},e.File=function p(he){const ie=t({type:"file",defaultValue:null},he);return he?.accept&&(ie.accept=he.accept),ie},e.FileList=function m(he){const ie=t({type:"file-list",defaultValue:null},he);return he?.accept&&(ie.accept=he.accept),ie},e.Numeric=function g(he,ie,ue){const _e=t(h({type:"number",defaultValue:he},ie),ue);return ue?.immediateUpdate&&(_e.immediateUpdate=!0),_e},e.Interval=function y(he,ie,ue){return t(h({type:"interval",defaultValue:he},ie),ue)},e.LineGraph=function v(he,ie){const ue=t({type:"line-graph",defaultValue:he},ie);return ie?.getVolume&&(ue.getVolume=ie.getVolume),ue},e.Group=x,e.EmptyGroup=function _(he){return x({},he)},e.Mapped=function w(he,ie,ue,_e){const Fe=Ae(he,ie);return t({type:"mapped",defaultValue:{name:Fe,params:ue(Fe).defaultValue},select:i(Fe,ie,_e),map:ue},_e)},e.MappedStatic=function A(he,ie,ue){const _e=ue?.options?ue.options:Object.keys(ie).map(Ze=>[Ze,ie[Ze].label||yf(Ze)]),Fe=Ae(he,_e);return t({type:"mapped",defaultValue:{name:Fe,params:ie[Fe].defaultValue},select:i(Fe,_e,ue),map:Ze=>ie[Ze]},ue)},e.ObjectList=function M(he,ie,ue){return t({type:"object-list",element:he,getLabel:ie,ctor:E,defaultValue:ue?.defaultValue||[]},ue)},e.ValueRef=function T(he,ie,ue){var _e;return t({type:"value-ref",defaultValue:{ref:null!==(_e=ue?.defaultRef)&&void 0!==_e?_e:"",getValue:D},getOptions:he,resolveRef:ie},ue)},e.DataRef=function F(he){var ie;return t({type:"data-ref",defaultValue:{ref:null!==(ie=he?.defaultRef)&&void 0!==ie?ie:"",getValue:D}},he)},e.Converted=function R(he,ie,ue){return t({type:"converted",defaultValue:ie(ue.defaultValue),converted:ue,fromValue:he,toValue:ie},ue)},e.Conditioned=function N(he,ie,ue,_e,Fe){const Ze=Object.keys(ie).map(ct=>[ct,ct]);return t({type:"conditioned",select:i(ue(he),Ze,Fe),defaultValue:he,conditionParams:ie,conditionForValue:ue,conditionedValue:_e},Fe)},e.Script=function j(he,ie){return t({type:"script",defaultValue:he},ie)},e.For=function W(he){return 0},e.getDefaultValues=z,e.resolveRefs=oe,e.setDefaultValues=function te(he,ie){for(const ue of Object.keys(he))he[ue].isOptional||(he[ue].defaultValue=ie[ue])},e.clone=function K(he){return op(he)},e.validate=function Q(he,ie){},e.areEqual=G,e.isParamEqual=Z,e.merge=ee,e.mergeParam=se,e.normalizeParams=ae,e.objectToOptions=function ge(he,ie){const ue=[];for(const _e of Object.keys(he))if(ie){const Fe=ie(_e,he[_e]);ue.push("string"==typeof Fe?[_e,Fe]:[_e,Fe[0],Fe[1]])}else ue.push("string"==typeof he[_e]?[_e,he[_e]]:[_e,null===ie?_e:yf(_e)]);return ue},e.arrayToOptions=function Ie(he,ie){const ue=[];for(const _e of he)ue.push(ie?[_e,ie(_e)]:[_e,null===ie?_e:yf(_e)]);return ue},e.optionLabel=function me(he,ie){for(const ue of he.options)if(ue[0]===ie)return ue[1];return""}}(I||(I={}));const Kze=9,S5=-27.888,Zze=-.5,Gae=-9.9;function Qze(e,t,n,r){const i=C.distance(e,r),o=C.distance(t,r),s=C.distance(t,n),a=C.distance(e,n),u=S5/i-S5/o+(S5/s-S5/a);return u<Gae?Gae:u}var ar;!function(e){e.is=Mc.has,e.create=Mc.create}(ar||(ar={}));class C5{constructor(t,n,r){this.partner1=Math.min(t,n),this.partner2=Math.max(t,n),this.type=r}}function r7e(e,t){if(t.type!==e.type||t.partner1!==e.firstEnd+1)return!1;if(0===t.type){if(t.partner2===e.secondEnd+1)return!0}else if(t.partner2===e.secondStart-1)return!0;return!1}function i7e(e,t){return e.type===t.type&&t.firstStart-e.firstEnd<6&&e.firstStart<t.firstStart&&0===t.nextLadder&&(0===e.type?qae(e,t):qae(t,e))}function qae(e,t){return t.secondStart-e.secondEnd>0&&(t.secondStart-e.secondEnd<6&&t.firstStart-e.firstEnd<3||t.secondStart-e.secondEnd<3)}function Wae(e){return ar.is(e,8)||ar.is(e,1)||ar.is(e,16)}const d7e={oldDefinition:I.Boolean(!0,{description:"Whether to use the old DSSP convention for the annotation of turns and helices, causes them to be two residues shorter"}),oldOrdering:I.Boolean(!0,{description:"Alpha-helices are preferred over 3-10 helices"})};function f7e(e,t){return p7.apply(this,arguments)}function p7(){return p7=le(function*(e,t){const n=function u7e(e){const{index:t}=e.model.atomicHierarchy,{proteinElements:n,residueIndex:r}=e,i=n.length,o=new Uint32Array(i),s=new Int32Array(i),a=new Int32Array(i),l=new Int32Array(i),c=new Int32Array(i);for(let u=0;u<i;++u){const d=r[n[u]];o[u]=d,s[u]=t.findAtomOnResidue(d,"C"),a[u]=t.findAtomOnResidue(d,"H"),l[u]=t.findAtomOnResidue(d,"O"),c[u]=t.findAtomOnResidue(d,"N")}return{residueIndices:rt.ofSortedArray(o),cIndices:s,hIndices:a,oIndices:l,nIndices:c}}(e),{residueIndices:r}=n,i=function c7e(e,t){const{x:n,y:r,z:i}=e.model.atomicConformation,{traceElementIndex:o}=e.model.atomicHierarchy.derived.residue,s=new Uint32Array(t.length);for(let l=0,c=t.length;l<c;++l)s[l]=o[t[l]];const a={x:n,y:r,z:i,indices:rt.ofSortedArray(s)};return zh(a,Q0(a))}(e,r),o=function Jze(e,t,n){const{residueIndices:r,cIndices:i,hIndices:o,nIndices:s,oIndices:a}=t,{index:l}=e.model.atomicHierarchy,c=e.conformation,{traceElementIndex:u}=e.model.atomicHierarchy.derived.residue,d=r.length,f=[],p=[],m=[],h=C(),g=C(),y=C(),v=C(),x=C(),_=C(),w=C();for(let A=0,M=r.length;A<M;++A){const E=A,D=r[A],T=a[E],F=i[E],R=u[D];if(-1===T||-1===F||-1!==l.findAtomOnResidue(D,"OXT"))continue;c.invariantPosition(T,h),c.invariantPosition(F,g),c.invariantPosition(R,y);const{indices:N,count:j}=n.find(y[0],y[1],y[2],Kze);for(let W=0;W<j;++W){const z=N[W];if(z===E||z-1===E||z+1===E)continue;const $=s[z];if(-1===$)continue;c.invariantPosition($,v);const V=o[z];if(-1===V){if(0===z)continue;const H=z-1,oe=a[H],te=i[H];if(-1===oe||-1===te)continue;c.invariantPosition(oe,w),c.invariantPosition(te,_),C.sub(x,_,w);const K=C.distance(w,_);C.scaleAndAdd(x,v,x,1/K)}else c.invariantPosition(V,x);const X=Qze(h,g,v,x);X>Zze||(f[f.length]=E,p[p.length]=z,m[m.length]=X)}}return function e7e(e,t,n,r){const i=new Cd.DirectedEdgeBuilder(e,t,n),o=new Float32Array(i.slotCount);for(let s=0,a=i.edgeCount;s<a;s++)i.addNextEdge(),i.assignProperty(o,r[s]);return i.createGraph({energies:r})}(d,f,p,m)}(e,n,i),s=r.length,a=new Uint32Array(s),l=function l7e(e,t){const{cIndices:n,nIndices:r,residueIndices:i}=t,o=e.conformation,{index:s}=e.model.atomicHierarchy,{traceElementIndex:a}=e.model.atomicHierarchy.derived.residue,l=i.length,c=(w,A)=>-1===w?C.setNaN(A):o.position(w,A);let u=C(),d=C(),f=C(),p=C(),m=C(),h=C();const g=C(),y=C(),v=C();if(0===l)return{phi:new Float32Array(0),psi:new Float32Array(0)};const x=new Float32Array(l-1),_=new Float32Array(l-1);c(-1,u),c(-1,d),c(-1,f),c(n[0],p),c(a[i[0]],m),c(r[0],h),c(n[1],g),c(a[i[1]],y),c(r[1],v);for(let w=0;w<l-1;++w)-1===s.findAtomOnResidue(i[w],"OXT")&&(x[w]=pf(C.dihedralAngle(u,h,m,p)),_[w]=pf(C.dihedralAngle(h,m,p,v)),u=p,d=m,f=h,p=g,m=y,h=v,c(n[w+1],g),c(a[i[w+1]],y),c(r[w+1],v));return{phi:x,psi:_}}(e,n),d=t.oldDefinition?m7e:y7e,p={params:t,getResidueFlag:d,getFlagName:t.oldOrdering?g7e:b7e,unit:e,proteinInfo:n,flags:a,hbonds:o,torsionAngles:l,ladders:[],bridges:[]};(function t7e(e){const{proteinInfo:t,hbonds:n,flags:r}=e,i=[1024,2048,4096,128,256,512];for(let o=0;o<3;o++)for(let s=0,a=t.residueIndices.length-1;s<a;++s)if(-1!==n.getDirectedEdgeIndex(s,s+o+3))if(r[s]|=i[o+3]|i[o],e.params.oldDefinition)for(let l=1;l<o+3;++l)r[s+l]|=64|i[o+3];else for(let l=0;l<=o+3;++l)r[s+l]|=64|i[o+3]})(p),function n7e(e){const{proteinInfo:t,flags:n}=e,r=t.residueIndices.length,i=[1024,2048,4096,128,256,512],o=[0,0,0,8,1,16],s=e.params.oldOrdering?[4,3,5]:[3,4,5];for(let a=0;a<s.length;a++){const l=s[a];for(let c=1,u=r-l;c<u;c++){const d=ar.create(n[c]),f=ar.create(n[c-1]),p=ar.create(n[c+1]);if(e.params.oldOrdering){if(3===l&&(ar.is(d,1)||ar.is(p,1))||5===l&&(ar.is(d,1)||ar.is(d,8)||ar.is(p,1)||ar.is(p,8)))continue}else if(4===l&&(ar.is(d,8)||ar.is(p,8))||5===l&&(ar.is(d,1)||ar.is(d,8)||ar.is(p,1)||ar.is(p,8)))continue;if(ar.is(d,i[l])&&ar.is(d,i[l-3])&&ar.is(f,i[l])&&ar.is(f,i[l-3]))if(e.params.oldDefinition)for(let m=0;m<l;m++)n[c+m]|=o[l];else for(let m=-1;m<=l;m++)n[c+m]|=o[l]}}}(p),function Xze(e){const{unit:t,flags:n,proteinInfo:r}=e,i=t.conformation,{traceElementIndex:o}=t.model.atomicHierarchy.derived.residue,{residueIndices:s,nIndices:a}=r,l=s.length,c=(y,v)=>-1===y?C.setNaN(v):i.position(y,v),u=C(),d=C(),f=C(),p=C(),m=C(),h=C(),g=C();e:for(let y=2;y<l-2;y++){for(let D=0;D<4;D++){const T=y+D-2;if(c(o[T],p),c(a[T+1],m),C.squaredDistance(p,m)>6.25)continue e}const A=o[s[y]],M=o[s[y+2]];c(o[s[y-2]],u),c(A,d),c(M,f),C.sub(h,u,d),C.sub(g,d,f);const E=pf(C.angle(h,g));E&&E>70&&(n[y]|=32)}}(p),function s7e(e){const{proteinInfo:t,hbonds:n,flags:r,bridges:i}=e,{offset:o,b:s}=n;let a,l;for(let c=0,u=t.residueIndices.length;c<u;++c)for(let d=o[c],f=o[c+1];d<f;d++){const p=s[d];c>p||(a=c+1,l=p,a!==l&&-1!==n.getDirectedEdgeIndex(l,a+1)&&(r[a]|=2,r[l]|=2,i[i.length]=new C5(a,l,0)),a=c,l=p-1,a!==l&&-1!==n.getDirectedEdgeIndex(l-1,a)&&(r[a]|=2,r[l]|=2,i[i.length]=new C5(l,a,0)),a=c,l=p,a!==l&&-1!==n.getDirectedEdgeIndex(l,a)&&(r[a]|=2,r[l]|=2,i[i.length]=new C5(l,a,1)),a=c+1,l=p-1,a!==l&&-1!==n.getDirectedEdgeIndex(l-1,a+1)&&(r[a]|=2,r[l]|=2,i[i.length]=new C5(l,a,1)))}i.sort((c,u)=>c.partner1>u.partner1?1:c.partner1<u.partner1?-1:0)}(p),function o7e(e){const{bridges:t,ladders:n}=e;for(let r=0;r<t.length;r++){const i=t[r];let o=!1;for(let s=0;s<n.length;s++){const a=n[s];r7e(a,i)&&(o=!0,a.firstEnd++,0===i.type?a.secondEnd++:a.secondStart--)}o||(n[n.length]={previousLadder:0,nextLadder:0,firstStart:i.partner1,firstEnd:i.partner1,secondStart:i.partner2,secondEnd:i.partner2,type:i.type})}for(let r=0;r<n.length;r++){const i=n[r];for(let o=r;o<n.length;o++){const s=n[o];i7e(i,s)&&(i.nextLadder=o,s.previousLadder=r)}}}(p),function a7e(e){const{ladders:t,flags:n}=e;for(let r=0;r<t.length;r++){const i=t[r];for(let s=i.firstStart;s<=i.firstEnd;s++){const l=i.secondStart-(i.firstStart-s);i.firstStart!==i.firstEnd?(n[s]|=4,n[l]|=4):(!Wae(n[s])&&ar.is(n[s],4)&&(n[s]|=2),!Wae(n[l])&&ar.is(n[l],4)&&(n[l]|=2))}if(0===i.nextLadder)continue;const o=t[i.nextLadder];for(let s=i.firstStart;s<=o.firstEnd;s++)n[s]|=4;if(0===i.type)for(let s=i.secondStart;s<=o.secondEnd;s++)n[s]|=4;else for(let s=o.secondEnd;s<=i.secondStart;s++)n[s]|=4}}(p);const m=function v7e(e,t){const n=new Uint32Array(e.length);for(let r=0,i=e.length;r<i;++r){const o=ar.create(e[r]);n[r]=t(o)}return n}(a,d),h=new Uint32Array(s),g=[],y=[];for(let x=0,_=r.length;x<_;++x){const w=m[x];h[x]=w;const A=d(a[x]);(0===y.length||A!==y[y.length-1].flags)&&(y[y.length]=p7e(h7e(w),a[x],d)),g[x]=y.length-1}return Cae(h,g,y,x=>rt.indexOf(r,x))}),p7.apply(this,arguments)}function p7e(e,t,n){return"helix"===e?{kind:"helix",flags:n(t)}:"sheet"===e?{kind:"sheet",flags:n(t)}:"turn"===e||"bend"===e?{kind:"turn",flags:n(t)}:{kind:"none"}}function h7e(e){return e===pi.SecondaryStructureDssp.H||e===pi.SecondaryStructureDssp.G||e===pi.SecondaryStructureDssp.I?"helix":e===pi.SecondaryStructureDssp.B||e===pi.SecondaryStructureDssp.E?"sheet":e===pi.SecondaryStructureDssp.T?"turn":e===pi.SecondaryStructureDssp.S?"bend":"none"}function m7e(e){return ar.is(e,1)?pi.SecondaryStructureDssp.H:ar.is(e,4)?pi.SecondaryStructureDssp.E:ar.is(e,2)?pi.SecondaryStructureDssp.B:ar.is(e,8)?pi.SecondaryStructureDssp.G:ar.is(e,16)?pi.SecondaryStructureDssp.I:ar.is(e,64)?pi.SecondaryStructureDssp.T:ar.is(e,32)?pi.SecondaryStructureDssp.S:0}function g7e(e){return ar.is(e,1)?"H":ar.is(e,4)?"E":ar.is(e,2)?"B":ar.is(e,8)?"G":ar.is(e,16)?"I":ar.is(e,64)?"T":ar.is(e,32)?"S":"-"}function y7e(e){return ar.is(e,16)?pi.SecondaryStructureDssp.I:ar.is(e,1)?pi.SecondaryStructureDssp.H:ar.is(e,4)?pi.SecondaryStructureDssp.E:ar.is(e,2)?pi.SecondaryStructureDssp.B:ar.is(e,8)?pi.SecondaryStructureDssp.G:ar.is(e,64)?pi.SecondaryStructureDssp.T:ar.is(e,32)?pi.SecondaryStructureDssp.S:0}function b7e(e){return ar.is(e,16)?"I":ar.is(e,1)?"H":ar.is(e,4)?"E":ar.is(e,2)?"B":ar.is(e,8)?"G":ar.is(e,64)?"T":ar.is(e,32)?"S":"-"}var iy;function $ae(e){let t="model";if(e){t="dssp";for(let n=0,r=e.models.length;n<r;++n){const i=e.models[n];if(Sn.isFromPdbArchive(i)||Sn.hasSecondaryStructure(i)){t="model";break}}}return{type:I.MappedStatic(t,{model:I.EmptyGroup({label:"Model"}),dssp:I.Group(d7e,{label:"DSSP",isFlat:!0})},{options:[["model","Model"],["dssp","DSSP"]]})}}!function(e){function t(r){const i=r.descriptor.name,o="root"===r.type?"inheritedPropertyData":"currentPropertyData",s=l=>(i in l[o]||(l[o][i]={props:{...I.getDefaultValues(r.getParams(l))},data:f1.create(void 0)}),l[o][i]),a=(l,c,u)=>{const d=s(l);l[o][i]={props:c,data:f1.withValue(d.data,u)}};return{label:r.label,descriptor:r.descriptor,isHidden:r.isHidden,getParams:l=>{const c=I.clone(r.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:r.defaultParams,isApplicable:r.isApplicable,attach:(l=le(function*(c,u,d={},f){f&&u.customPropertyDescriptors.reference(r.descriptor,!0),"root"===r.type&&(u=u.root);const p=s(u.root).props,m=s(u),h=I.merge(r.defaultParams,p,d);if(m.data.value&&I.areEqual(r.defaultParams,m.props,h))return;const{value:g,assets:y}=yield r.obtain(c,u,h);u.customPropertyDescriptors.add(r.descriptor),u.customPropertyDescriptors.assets(r.descriptor,y),a(u,h,g)}),function(u,d){return l.apply(this,arguments)}),ref:(l,c)=>l.customPropertyDescriptors.reference(r.descriptor,c),get:l=>s(l).data,set:(l,c={},u)=>{"root"===r.type&&(l=l.root);const d=s(l),f=I.merge(r.defaultParams,d.props,c);I.areEqual(r.defaultParams,d.props,f)||(a(l,f,u),l.customPropertyDescriptors.assets(r.descriptor))},props:l=>s(l).props};var l}e.createProvider=t,e.createSimple=function n(r,i,o){const s={value:I.Value(o,{isHidden:!0})};return t({label:yf(r),descriptor:hf({name:r}),isHidden:!0,type:i,defaultParams:s,getParams:()=>({value:I.Value(o,{isHidden:!0})}),isApplicable:()=>!0,obtain:(a=le(function*(l,c,u){return{...I.getDefaultValues(s),...u}}),function(c,u,d){return a.apply(this,arguments)})});var a}}(iy||(iy={}));const Yae=$ae(),gp=iy.createProvider({label:"Secondary Structure",descriptor:hf({name:"molstar_computed_secondary_structure"}),type:"root",defaultParams:Yae,getParams:$ae,isApplicable:e=>!0,obtain:function(){var e=le(function*(t,n,r){const i={...I.getDefaultValues(Yae),...r};switch(i.type.name){case"dssp":return{value:yield x7e(n,i.type.params)};case"model":return{value:yield _7e(n)}}});return function(n,r,i){return e.apply(this,arguments)}}()});function x7e(e,t){return h7.apply(this,arguments)}function h7(){return h7=le(function*(e,t){const n=new Map;for(let r=0,i=e.unitSymmetryGroups.length;r<i;++r){const o=e.unitSymmetryGroups[r].units[0];if(ze.isAtomic(o)&&!Sn.isCoarseGrained(o.model)){const s=yield f7e(o,t);n.set(o.invariantId,s)}}return n}),h7.apply(this,arguments)}function _7e(e){return m7.apply(this,arguments)}function m7(){return m7=le(function*(e){const t=new Map;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const i=e.unitSymmetryGroups[n].units[0];if(ze.isAtomic(i)){const o=o_.Provider.get(i.model);o&&t.set(i.invariantId,o)}}return t}),m7.apply(this,arguments)}function ds(){throw new Error("Property only available for atomic models.")}function oy(e){throw e?new Error(`Property only available for coarse models (${e}).`):new Error("Property only available for coarse models.")}const W3={key:e=>e.element,x:e=>e.unit.conformation.x(e.element),y:e=>e.unit.conformation.y(e.element),z:e=>e.unit.conformation.z(e.element),id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicConformation.atomId.value(e.element):ds(),occupancy:e=>ze.isAtomic(e.unit)?e.unit.model.atomicConformation.occupancy.value(e.element):ds(),B_iso_or_equiv:e=>ze.isAtomic(e.unit)?e.unit.model.atomicConformation.B_iso_or_equiv.value(e.element):ds(),sourceIndex:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atomSourceIndex.value(e.element):e.element,type_symbol:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element):ds(),label_atom_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_atom_id.value(e.element):ds(),auth_atom_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_atom_id.value(e.element):ds(),label_alt_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.label_alt_id.value(e.element):ds(),label_comp_id:w5,auth_comp_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.auth_comp_id.value(e.element):ds(),pdbx_formal_charge:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.element):ds(),vdw_radius:e=>ze.isAtomic(e.unit)?B3(e.unit.model.atomicHierarchy.atoms.type_symbol.value(e.element)):ds()};function w5(e){return ze.isAtomic(e.unit)||ds(),e.unit.model.atomicHierarchy.atoms.label_comp_id.value(e.element)}function g7(e){return ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.label_seq_id.value(e.unit.residueIndex[e.element]):ds()}function Xae(e){ze.isAtomic(e.unit)||ds();const t=e.unit.model.sequence.byEntityKey[Bu(e)];return t&&t.sequence.microHet.get(g7(e))||[w5(e)]}const w7e={key:e=>ze.isAtomic(e.unit)?e.unit.residueIndex[e.element]:ds(),group_PDB:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.group_PDB.value(e.unit.residueIndex[e.element]):ds(),label_seq_id:g7,auth_seq_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.auth_seq_id.value(e.unit.residueIndex[e.element]):ds(),pdbx_PDB_ins_code:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.residues.pdbx_PDB_ins_code.value(e.unit.residueIndex[e.element]):ds(),isNonStandard:e=>ze.isAtomic(e.unit)?Xae(e).some(t=>"n"===e.unit.model.properties.chemicalComponentMap.get(t).mon_nstd_flag[0]):ds(),hasMicroheterogeneity:function C7e(e){ze.isAtomic(e.unit)||ds();const t=e.unit.model.sequence.byEntityKey[Bu(e)];return t&&t.sequence.microHet.has(g7(e))},microheterogeneityCompIds:Xae,secondary_structure_type:e=>{var t;ze.isAtomic(e.unit)||ds();const n=null===(t=gp.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId);return n?n.type[n.getIndex(e.unit.residueIndex[e.element])]:536870912},secondary_structure_key:e=>{var t;ze.isAtomic(e.unit)||ds();const n=null===(t=gp.get(e.structure).value)||void 0===t?void 0:t.get(e.unit.invariantId);return n?n.key[n.getIndex(e.unit.residueIndex[e.element])]:-1},chem_comp_type:e=>ze.isAtomic(e.unit)?e.unit.model.properties.chemicalComponentMap.get(w5(e)).type:ds()},A7e={key:e=>ze.isAtomic(e.unit)?e.unit.chainIndex[e.element]:ds(),label_asym_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_asym_id.value(e.unit.chainIndex[e.element]):ds(),auth_asym_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.auth_asym_id.value(e.unit.chainIndex[e.element]):ds(),label_entity_id:e=>ze.isAtomic(e.unit)?e.unit.model.atomicHierarchy.chains.label_entity_id.value(e.unit.chainIndex[e.element]):ds()},I7e={key:W3.key,entityKey:e=>ze.isCoarse(e.unit)?e.unit.coarseElements.entityKey[e.element]:oy(),x:W3.x,y:W3.y,z:W3.z,asym_id:e=>ze.isCoarse(e.unit)?e.unit.coarseElements.asym_id.value(e.element):oy(),entity_id:e=>ze.isCoarse(e.unit)?e.unit.coarseElements.entity_id.value(e.element):oy(),seq_id_begin:e=>ze.isCoarse(e.unit)?e.unit.coarseElements.seq_id_begin.value(e.element):oy(),seq_id_end:e=>ze.isCoarse(e.unit)?e.unit.coarseElements.seq_id_end.value(e.element):oy(),sphere_radius:e=>ze.isSpheres(e.unit)?e.unit.coarseConformation.radius[e.element]:oy("spheres"),sphere_rmsf:e=>ze.isSpheres(e.unit)?e.unit.coarseConformation.rmsf[e.element]:oy("spheres"),gaussian_weight:e=>ze.isGaussians(e.unit)?e.unit.coarseConformation.weight[e.element]:oy("gaussians"),gaussian_covariance_matrix:e=>ze.isGaussians(e.unit)?e.unit.coarseConformation.covariance_matrix[e.element]:oy("gaussians")};function Bu(e){switch(e.unit.kind){case 0:return e.unit.model.atomicHierarchy.index.getEntityFromChain(e.unit.chainIndex[e.element]);case 1:return e.unit.model.coarseHierarchy.spheres.entityKey[e.element];case 2:return e.unit.model.coarseHierarchy.gaussians.entityKey[e.element]}}const E7e={key:Bu,id:e=>e.unit.model.entities.data.id.value(Bu(e)),type:e=>e.unit.model.entities.data.type.value(Bu(e)),src_method:e=>e.unit.model.entities.data.src_method.value(Bu(e)),pdbx_description:e=>e.unit.model.entities.data.pdbx_description.value(Bu(e)),formula_weight:e=>e.unit.model.entities.data.formula_weight.value(Bu(e)),pdbx_number_of_molecules:e=>e.unit.model.entities.data.pdbx_number_of_molecules.value(Bu(e)),details:e=>e.unit.model.entities.data.details.value(Bu(e)),pdbx_mutation:e=>e.unit.model.entities.data.pdbx_mutation.value(Bu(e)),pdbx_fragment:e=>e.unit.model.entities.data.pdbx_fragment.value(Bu(e)),pdbx_ec:e=>e.unit.model.entities.data.pdbx_ec.value(Bu(e)),subtype:e=>e.unit.model.entities.subtype.value(Bu(e)),prd_id:e=>{var t,n;return null!==(n=null===(t=e.unit.model.entities.prd_id)||void 0===t?void 0:t.value(Bu(e)))&&void 0!==n?n:""}},T7e=[],D7e={id:e=>e.unit.id,chainGroupId:e=>e.unit.chainGroupId,multiChain:e=>ze.Traits.is(e.unit.traits,ze.Trait.MultiChain),object_primitive:e=>e.unit.objectPrimitive,operator_name:e=>e.unit.conformation.operator.name,operator_key:e=>e.unit.conformation.operator.key,model_index:e=>e.unit.model.modelNum,model_label:e=>e.unit.model.label,model_entry_id:e=>e.unit.model.entryId,hkl:e=>e.unit.conformation.operator.hkl,spgrOp:e=>e.unit.conformation.operator.spgrOp,model_num:e=>e.unit.model.modelNum,pdbx_struct_assembly_id:e=>{var t;return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.id)||ko.DefaultName},pdbx_struct_oper_list_ids:e=>{var t;return(null===(t=e.unit.conformation.operator.assembly)||void 0===t?void 0:t.operList)||T7e},struct_ncs_oper_id:e=>e.unit.conformation.operator.ncsId},Je={constant:{true:e=>!0,false:e=>!1,zero:e=>0},atom:W3,residue:w7e,chain:A7e,entity:E7e,unit:D7e,coarse:I7e};class $3{add(t){let n=this.index.get(t.label_asym_id);n||(n=new Map,this.index.set(t.label_asym_id,n));let r=n.get(t.label_seq_id);return r||(r=[],n.set(t.label_seq_id,r)),!this._find(t,r)&&(r.push(t),!0)}hasLabelAsymId(t){return this.index.has(t)}has(t){var n,r;const i=Kae(t);if(!this.index.has(i))return;const o=this.index.get(i),s=Zae(t);if(!o.has(s))return;const a=o.get(s),l=Qae(t),c=Jae(t),u=ele(t),d=null!==(n=tle(t))&&void 0!==n?n:"1_555";for(const f of a)if(f.label_comp_id===l&&f.label_alt_id===c&&f.ins_code===u&&(!this.checkOperator||(null!==(r=f.operator_name)&&void 0!==r?r:"1_555")===d))return f}static getLabel(t,n=!1){var r;return`${t.label_asym_id} ${t.label_comp_id} ${t.label_seq_id}:${t.ins_code}:${t.label_alt_id}${n?" "+(null!==(r=t.operator_name)&&void 0!==r?r:"1_555"):""}`}static getEntryFromLocation(t){var n;return{label_asym_id:Kae(t),label_comp_id:Qae(t),label_seq_id:Zae(t),label_alt_id:Jae(t),ins_code:ele(t),operator_name:null!==(n=tle(t))&&void 0!==n?n:"1_555"}}_find(t,n){var r,i;for(const o of n)if(o.label_comp_id===t.label_comp_id&&o.label_alt_id===t.label_alt_id&&o.ins_code===t.ins_code&&(!this.checkOperator||(null!==(r=o.operator_name)&&void 0!==r?r:"1_555")===(null!==(i=t.operator_name)&&void 0!==i?i:"1_555")))return!0;return!1}constructor(t){var n;this.index=new Map,this.checkOperator=!1,this.checkOperator=null!==(n=t?.checkOperator)&&void 0!==n&&n}}const Kae=Je.chain.label_asym_id,Zae=Je.residue.label_seq_id,Qae=Je.atom.label_comp_id,Jae=Je.atom.label_alt_id,ele=Je.residue.pdbx_PDB_ins_code,tle=Je.unit.operator_name;function Cw(e,t,n){const r=t.subsetBuilder(!0);for(const i of n.units){if(0!==i.kind){r.setUnit(i.id,i.elements);continue}const{residueAtomSegments:o}=i.model.atomicHierarchy,s=t.unitMap.get(i.id).elements,a=i.elements;r.beginUnit(i.id);const l=En.transientSegments(o,a);for(;l.hasNext;){const c=l.move().index;for(let u=o.offsets[c],d=o.offsets[c+1];u<d;u++)rt.has(s,u)&&r.addElement(u)}r.commitUnit(),e.throwIfTimedOut()}return r.getStructure()}function P7e(e){return function(n){const r=e(n);if(Dt.isSingleton(r))return Dt.Singletons(n.inputStructure,Cw(n,n.inputStructure,r.structure));{const i=new wz(n.inputStructure);for(const o of r.structures)i.add(Cw(n,n.inputStructure,o));return i.getSelection()}}}function y7(e,t,n,r){const i=new f5(t),o=t.lookup3d,s=r.radius;for(const a of n.units){const l=a.conformation,c=a.elements;for(let u=0,d=c.length;u<d;u++){const f=c[u];o.findIntoBuilder(l.x(f),l.y(f),l.z(f),s,i)}e.throwIfTimedOut()}return r.wholeResidues?Cw(e,t,i.getStructure()):i.getStructure()}function nle(e,t,n,r){const i=new f5(t),o=t.lookup3d,{elementRadius:s,elementRadiusClosure:a,sourceMaxRadius:l,radius:c}=r;e.pushCurrentElement(),e.element.structure=n;for(const u of n.units){e.element.unit=u;const d=u.conformation,f=u.elements;for(let p=0,m=f.length;p<m;p++){const h=f[p];e.element.element=h;const g=s(e);o.findIntoBuilderWithRadius(d.x(h),d.y(h),d.z(h),g,l,c,a,i)}e.throwIfTimedOut()}return e.popCurrentElement(),r.wholeResidues?Cw(e,t,i.getStructure()):i.getStructure()}function k7e(e,t){return n=>(e.element.structure=n.structure,e.element.unit=n.unit,e.element.element=n.element,t(e))}function M7e(e,t){let n=0;e.element.structure=e.inputStructure;for(const r of e.inputStructure.units){e.element.unit=r;const i=r.elements;for(let o=0,s=i.length;o<s;o++){e.element.element=i[o];const l=t(e);l>n&&(n=l)}}return e.throwIfTimedOut(),n}function R7e(e,t){return function(r){const i=e(r);if(t.elementRadius){const o={...t,elementRadius:t.elementRadius,elementRadiusClosure:k7e(r,t.elementRadius),sourceMaxRadius:M7e(r,t.elementRadius)};if(Dt.isSingleton(i)){const s=nle(r,r.inputStructure,i.structure,o);return Dt.Singletons(r.inputStructure,s)}{const s=new wz(r.inputStructure);for(const a of i.structures)s.add(nle(r,r.inputStructure,a,o));return s.getSelection()}}if(Dt.isSingleton(i)){const o=y7(r,r.inputStructure,i.structure,t);return Dt.Singletons(r.inputStructure,o)}{const o=new wz(r.inputStructure);for(const s of i.structures)o.add(y7(r,r.inputStructure,s,t));return o.getSelection()}}}function N7e(e,t){return function(r){const i=e(r);if(0===Dt.structureCount(i))return i;const o=Dt.UniqueBuilder(r.inputStructure),s=a=>o.add(a);return Dt.forEach(i,(a,l)=>{r.pushInputStructure(a),Dt.forEach(t(r),s),r.popInputStructure(),l%10==0&&r.throwIfTimedOut()}),o.getSelection()}}function F7e(e,t){return function(r){const i=e(r);if(0===Dt.structureCount(i))return i;const o=t(r);if(0===Dt.structureCount(o))return Dt.Empty(r.inputStructure);const s=Dt.unionStructure(o),a=Dt.UniqueBuilder(r.inputStructure);return Dt.forEach(i,(l,c)=>{const u=sae(s,l);0!==u.elementCount&&a.add(u),c%50==0&&r.throwIfTimedOut()}),a.getSelection()}}function O7e(e,t){return function(r){const i=e(r);if(0===Dt.structureCount(i))return i;const o=t(r);if(0===Dt.structureCount(o))return i;const s=Dt.unionStructure(o),a=Dt.UniqueBuilder(r.inputStructure);return Dt.forEach(i,(l,c)=>{const u=_z(l,s);0!==u.elementCount&&a.add(u),c%50==0&&r.throwIfTimedOut()}),a.getSelection()}}function B7e(e){return function(n){const r=Dt.LinearBuilder(n.inputStructure);return r.add(Dt.unionStructure(e(n))),r.getSelection()}}function L7e(e,t){return function(r){const i=e(r),o=new Map,s=[];r.pushCurrentElement(),Dt.forEach(i,(l,c)=>{r.element.structure=l;for(const u of l.units){r.element.unit=u;const d=u.elements;for(let f=0,p=d.length;f<p;f++){r.element.element=d[f];const m=t(r);let h;o.has(m)?h=o.get(m):(h=Ti.create(),o.set(m,h)),Ti.add(h,c,c)}}s[c]=r.inputStructure.subsetBuilder(!0),c%10==0&&r.throwIfTimedOut()}),r.element.structure=r.inputStructure;for(const l of r.inputStructure.units){r.element.unit=l;const c=l.elements;for(let u=0,d=c.length;u<d;u++){r.element.element=c[u];const f=t(r);if(!o.has(f))continue;const p=o.get(f).array;for(let m=0,h=p.length;m<h;m++)s[p[m]].addToUnit(l.id,c[u])}}r.popCurrentElement();const a=Dt.UniqueBuilder(r.inputStructure);for(const l of s)a.add(l.getStructure());return a.getSelection()}}function j7e({query:e,layerCount:t,wholeResidues:n,bondTest:r,fixedPoint:i}){const o=Math.max(t,0);return function(a){const l=Dt.UniqueBuilder(a.inputStructure),c=e(a);return a.pushCurrentBond(),a.atomicBond.setTestFn(r),Dt.forEach(c,(u,d)=>{let f=u;if(i)for(;;){const p=f.elementCount;if(f=rle(a,n,f),f.elementCount===p)break}else for(let p=0;p<o;p++)f=rle(a,n,f);l.add(f),d%10==0&&a.throwIfTimedOut()}),a.popCurrentBond(),l.getSelection()}}function rle(e,t,n){const r=function U7e(e,t){const n=e.inputStructure,r=n.interUnitBonds,i=new f5(n),o=e.atomicBond;for(const s of t.units){if(0!==s.kind){i.beginUnit(s.id);for(let p=0,m=s.elements.length;p<m;p++)i.addElement(s.elements[p]);i.commitUnit();continue}const a=n.unitMap.get(s.id),{offset:l,b:c,edgeProps:{flags:u,order:d,key:f}}=a.bonds;o.setStructure(n),o.a.unit=a,o.b.unit=a;for(let p=0,m=s.elements.length;p<m;p++){i.addToUnit(s.id,s.elements[p]);const h=rt.indexOf(a.elements,s.elements[p]);for(let g=l[h],y=l[h+1];g<y;g++){const v=c[g],x=a.elements[v];rt.has(s.elements,x)||i.has(s.id,x)||(o.aIndex=h,o.a.element=s.elements[p],o.bIndex=v,o.b.element=x,o.type=u[g],o.order=d[g],o.key=f[g],o.test(e,!0)&&i.addToUnit(s.id,x))}}for(const p of r.getConnectedUnits(a.id)){const m=t.unitMap.get(p.unitB),h=n.unitMap.get(p.unitB);for(const g of p.connectedIndices)if(rt.has(s.elements,a.elements[g]))for(const y of p.getEdges(g)){const v=h.elements[y.indexB];m&&rt.has(m.elements,v)||i.has(p.unitB,v)||(o.a.unit=a,o.aIndex=g,o.a.element=a.elements[g],o.b.unit=h,o.bIndex=y.indexB,o.b.element=v,o.type=y.props.flag,o.order=y.props.order,o.key=y.props.key,o.test(e,!0)&&i.addToUnit(p.unitB,v))}}}return i.getStructure()}(e,n);return t?Cw(e,e.inputStructure,r):r}function z7e({query:e,radius:t,includeWater:n}){return function(i){const o=Dt.unionStructure(e(i)),s=Cw(i,i.inputStructure,y7(i,i.inputStructure,o,{radius:t})),a=function G7e(e){const t=e.models[0],n=new Set;if(!Ui.is(t.sourceData))return n;const{_rowCount:r,asym_id:i}=t.sourceData.data.db.pdbx_molecule;for(let o=0;o<r;o++)n.add(i.value(o));return n}(i.inputStructure),l=function q7e(e){var t,n;const r=e.models[0],i=new W7e;if(!Ui.is(r.sourceData))return i;const o=r.sourceData.data.db.struct_conn,{conn_type_id:s}=o,{ptnr1_label_asym_id:a,ptnr1_label_comp_id:l,ptnr1_label_seq_id:c,ptnr1_symmetry:u,pdbx_ptnr1_label_alt_id:d,pdbx_ptnr1_PDB_ins_code:f}=o,{ptnr2_label_asym_id:p,ptnr2_label_comp_id:m,ptnr2_label_seq_id:h,ptnr2_symmetry:g,pdbx_ptnr2_label_alt_id:y,pdbx_ptnr2_PDB_ins_code:v}=o;for(let x=0;x<o._rowCount;x++){const _=s.value(x);if("covale"!==_&&"metalc"!==_)continue;const w={label_asym_id:a.value(x),label_comp_id:l.value(x),label_seq_id:c.value(x),label_alt_id:d.value(x),ins_code:f.value(x),operator_name:null!==(t=u.value(x))&&void 0!==t?t:"1_555"},A={label_asym_id:p.value(x),label_comp_id:m.value(x),label_seq_id:h.value(x),label_alt_id:y.value(x),ins_code:v.value(x),operator_name:null!==(n=g.value(x))&&void 0!==n?n:"1_555"};i.addEdge(w,A)}return i}(i.inputStructure),c=dt.create(s),u=new Map,d=new $3({checkOperator:!0});for(const m of s.units){if(0!==m.kind)continue;c.unit=m;const{elements:h}=m,g=En.transientSegments(m.model.atomicHierarchy.chainAtomSegments,h),y=En.transientSegments(m.model.atomicHierarchy.residueAtomSegments,h);for(;g.hasNext;){const v=g.move();c.element=h[v.start];const x=Je.chain.label_asym_id(c),_=Je.unit.operator_name(c);if(a.has(x)){u.has(x)?Us(u.get(x),_):u.set(x,[_]);continue}const w=Je.entity.type(c);if("water"!==w&&"polymer"!==w)for(y.setSegment(v);y.hasNext;){const A=y.move();c.element=h[A.start],l.addComponent($3.getEntryFromLocation(c),d)}}i.throwIfTimedOut()}const f=i.inputStructure.subsetBuilder(!0);for(const m of i.inputStructure.units){if(0!==m.kind)continue;c.unit=m;const{elements:h}=m,g=En.transientSegments(m.model.atomicHierarchy.chainAtomSegments,h),y=En.transientSegments(m.model.atomicHierarchy.residueAtomSegments,h);for(f.beginUnit(m.id);g.hasNext;){const v=g.move();c.element=h[v.start];const x=Je.chain.label_asym_id(c),_=Je.unit.operator_name(c);if(u.has(x)&&u.get(x).indexOf(_)>=0)f.addElementRange(h,v.start,v.end);else if(d.hasLabelAsymId(x))for(y.setSegment(v);y.hasNext;){const w=y.move();c.element=h[w.start],d.has(c)&&f.addElementRange(h,w.start,w.end)}}f.commitUnit(),i.throwIfTimedOut()}const p=R3(i.inputStructure,[f.getStructure(),o]);if(n){const m=new f5(i.inputStructure),h=i.inputStructure.lookup3d;for(const g of p.units){const y=g.conformation,v=g.elements;for(let x=0,_=v.length;x<_;x++){const w=v[x];h.findIntoBuilderIf(y.x(w),y.y(w),y.z(w),t,m,H7e),m.addToUnit(g.id,w)}i.throwIfTimedOut()}return Dt.Sequence(i.inputStructure,[m.getStructure()])}return Dt.Sequence(i.inputStructure,[p])}}const V7e=Je.entity.type;function H7e(e){return"water"===V7e(e)}class W7e{constructor(){this.vertices=new Map,this.edges=new Map}addVertex(t,n){this.vertices.has(n)||(this.vertices.set(n,t),this.edges.set(n,[]))}addEdge(t,n){const r=$3.getLabel(t),i=$3.getLabel(n);this.addVertex(t,r),this.addVertex(n,i),Us(this.edges.get(r),i),Us(this.edges.get(i),r)}addComponent(t,n){const r=$3.getLabel(t);if(!this.vertices.has(r))return void n.add(t);const i=new Set,o=new Set,s=[r];for(o.add(r),n.add(t);s.length>0;){const a=s.pop();i.add(a);const l=this.vertices.get(a);for(const c of this.edges.get(a)){if(i.has(c)||(s.push(c),o.has(c)))continue;o.add(c);const u=this.vertices.get(c);n.add(l.operator_name===u.operator_name?{...u,operator_name:t.operator_name}:u)}}}}var A5,I5,b7;function X7e(e,t){return n=>{const r=e(n),i=Dt.LinearBuilder(n.inputStructure);return n.pushCurrentElement(),Dt.forEach(r,(o,s)=>{n.currentStructure=o,t(n)&&i.add(o),s%100&&n.throwIfTimedOut()}),n.popCurrentStructure(),i.getSelection()}}function K7e(e){return t=>{const n=e(t),r=Dt.LinearBuilder(t.inputStructure);if("singletons"===n.kind){if(n.structure.elementCount>0){const i=n.structure.units[0],o=Xe.create([i.getChild(rt.ofSingleton(i.elements[0]))],{parent:t.inputStructure});r.add(o)}}else n.structures.length>0&&r.add(n.structures[0]);return r.getSelection()}}function E5(e,t,n){const{units:r}=e.currentStructure,i=e.pushCurrentElement();i.structure=e.currentStructure;for(const o of r){i.unit=o;const s=o.elements,a=t;if(a){for(let l=0,c=s.length;l<c;l++)i.element=s[l],n.add(a(e));e.throwIfTimedOut()}}return e.popCurrentElement(),n}function Q7e(e,t,n){return r=>{const i=e(r),o=function Z7e(e,t,n){const r=new Set,i=t(e);return e.pushCurrentElement(),Dt.forEach(i,(o,s)=>{e.currentStructure=o,E5(e,n,r),s%10&&e.throwIfTimedOut()}),e.popCurrentElement(),r}(r,t,n),s=Dt.LinearBuilder(r.inputStructure);return r.pushCurrentStructure(),Dt.forEach(i,(a,l)=>{r.currentStructure=a;const c=E5(r,n,new Set);Lo.isSuperset(o,c)&&s.add(a),l%10&&r.throwIfTimedOut()}),r.popCurrentStructure(),s.getSelection()}}function J7e(e,t){return n=>{const r=Dt.unionStructure(t(n)),i=Dt.LinearBuilder(n.inputStructure);return Dt.forEach(e(n),(o,s)=>{d5(r,o)&&i.add(o),s%10&&n.throwIfTimedOut()}),i.getSelection()}}function eVe(e){return t=>{const n={queryCtx:t,selection:e.query(t),target:e.target(t),maxRadius:e.maxRadius,minRadius:e.minRadius?Math.max(0,e.minRadius):0,elementRadius:e.elementRadius,invert:!!e.invert};return 0===n.minRadius&&typeof e.minRadius>"u"?function tVe({queryCtx:e,selection:t,target:n,maxRadius:r,invert:i}){const o=Dt.unionStructure(n).lookup3d,s=Dt.LinearBuilder(e.inputStructure),a=C.zero();return Dt.forEach(t,(l,c)=>{const{units:u}=l;let d=!1;for(let f=0,p=u.length;f<p;f++){const m=u[f],{elements:h,conformation:g}=m;for(let y=0,v=h.length;y<v;y++){const x=h[y];if(g.position(x,a),o.check(a[0],a[1],a[2],r+g.r(x))){d=!0;break}}if(d)break}i&&(d=!d),d&&s.add(l),c%10==0&&e.throwIfTimedOut()}),s.getSelection()}(n):0===n.minRadius?function nVe({queryCtx:e,selection:t,target:n,maxRadius:r,invert:i,elementRadius:o}){const s=Dt.unionStructure(n),a=Dt.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),Dt.forEach(t,(l,c)=>{let u=function Y7e(e,t,n,r,i){return 0===t.elementCount||0===n.elementCount||(t.elementCount<=n.elementCount?I5.check(e,t,n,r,i):I5.check(e,n,t,r,i))}(e,s,l,r,o);i&&(u=!u),u&&a.add(l),c%10==0&&e.throwIfTimedOut()}),e.popCurrentElement(),a.getSelection()}(n):function rVe({queryCtx:e,selection:t,target:n,minRadius:r,maxRadius:i,invert:o,elementRadius:s}){const a=Dt.unionStructure(n),l=Dt.LinearBuilder(e.inputStructure);return e.pushCurrentElement(),Dt.forEach(t,(c,u)=>{let d=function $7e(e,t,n,r,i,o){return 0===t.elementCount||0===n.elementCount||(t.elementCount<=n.elementCount?A5.check(e,t,n,r,i,o):A5.check(e,n,t,r,i,o))}(e,a,c,r,i,s);o&&(d=!d),d&&l.add(c),u%10==0&&e.throwIfTimedOut()}),e.popCurrentElement(),l.getSelection()}(n)}}function oVe({query:e,target:t,disjunct:n,invert:r,bondTest:i}){return o=>{const s=t(o);if(Dt.isEmpty(s))return s;const a=e(o);if(Dt.isEmpty(a))return a;const l={queryCtx:o,input:o.inputStructure,disjunct:n,target:Dt.unionStructure(s)},c=Dt.LinearBuilder(o.inputStructure);return o.pushCurrentBond(),o.atomicBond.setTestFn(i),Dt.forEach(a,(u,d)=>{(function iVe(e,t){const{queryCtx:n,input:r,target:i,disjunct:o}=e,s=n.atomicBond,a=r.interUnitBonds;s.setStructure(r);for(const l of t.units){if(!ze.isAtomic(l))continue;const c=r.unitMap.get(l.id),{offset:u,b:d,edgeProps:{flags:f,order:p,key:m}}=c.bonds,h=a.getConnectedUnits(l.id),g=h.length,y=l.elements,v=c.elements;for(let x=0,_=y.length;x<_;x++){const w=rt.indexOf(v,y[x]);s.a.unit=c,s.b.unit=c;for(let A=u[w],M=u[w+1];A<M;A++)if(s.b.element=c.elements[d[A]],(!o||!rt.has(l.elements,s.b.element))&&i.hasElement(s.b)&&(s.aIndex=w,s.a.element=y[x],s.bIndex=d[A],s.type=f[A],s.order=p[A],s.key=m[A],s.test(n,!0)))return!0;for(let A=0;A<g;A++){const M=h[A],E=r.unitMap.get(M.unitB),D=E.elements,T=M.getEdges(w);for(let F=0,R=T.length;F<R;F++){const N=T[F];if(s.b.unit=E,s.b.element=D[N.indexB],i.hasElement(s.b)&&(!o||!t.hasElement(s.b))&&(s.a.unit=c,s.aIndex=w,s.a.element=y[x],s.bIndex=N.indexB,s.type=N.props.flag,s.order=N.props.order,s.key=N.props.key,s.test(n,!0)))return!0}}}}return!1}(l,u)||r)&&c.add(u),d%5==0&&o.throwIfTimedOut()}),o.popCurrentBond(),c.getSelection()}}function sVe(e){return 0===e.length?Az:1===e.length?e[0]:t=>{const n=Dt.UniqueBuilder(t.inputStructure);for(let r=0;r<e.length;r++)Dt.forEach(e[r](t),(i,o)=>{n.add(i),r%100&&t.throwIfTimedOut()});return n.getSelection()}}function aVe(e){return 0===e.length?Az:1===e.length?e[0]:t=>{const n=[];for(let a=0;a<e.length;a++)n.push(e[a](t));let r=0,i=Dt.structureCount(n[0]);for(let a=1;a<n.length;a++){const l=Dt.structureCount(n[a]);l<i&&(r=a,i=l)}t.throwIfTimedOut();const o=XU(a=>a.hashCode,Xe.areUnitIdsAndIndicesEqual);Dt.forEach(n[r],a=>o.add(a));const s=Dt.UniqueBuilder(t.inputStructure);for(let a=0;a<n.length;a++)a!==r&&(Dt.forEach(n[a],l=>{o.has(l)&&s.add(l)}),t.throwIfTimedOut());return s.getSelection()}}function lVe(e){return e.currentStructure.elementCount}function cVe(e){return t=>{const n=e(t);return Dt.structureCount(n)}}function uVe(e){return t=>E5(t,e,new Set)}!function(e){const t=C();function n(s,a,l,c,u,d,f){const{elements:p,conformation:m}=a,h=t;s.element.unit=a;let g=!1;for(let y=0,v=p.length;y<v;y++){const x=p[y];s.element.element=x;const _=Math.max(0,C.distance(l,m.position(x,h))-c-f(s));if(_<u)return 0;_<d&&(g=!0)}return g?1:2}function r(s,a,l,c,u,d,f){const{units:p}=a;let m=!1;for(let h=0,g=p.length;h<g;h++){const y=n(s,p[h],l,c,u,d,f);if(0===y)return 0;1===y&&(m=!0)}return m?1:2}const i=C();e.check=function o(s,a,l,c,u,d){if(0===a.elementCount||0===l.elementCount)return 0;const{units:f}=a;let p=!1;s.element.structure=a;for(let m=0,h=f.length;m<h;m++){const g=f[m],{elements:y,conformation:v}=g;s.element.unit=g;for(let x=0,_=y.length;x<_;x++){const w=y[x];s.element.element=w;const A=r(s,l,v.position(w,i),d(s),c,u,d);if(0===A)return!1;1===A&&(p=!0)}}return p}}(A5||(A5={})),function(e){const t=C();function n(s,a,l,c,u,d){const{elements:f,conformation:p}=a,m=t;s.element.unit=a;for(let h=0,g=f.length;h<g;h++){const y=f[h];if(s.element.element=y,Math.max(0,C.distance(l,p.position(y,m))-c-d(s))<=u)return!0}return!1}function r(s,a,l,c,u,d){const{units:f}=a;for(let p=0,m=f.length;p<m;p++)if(n(s,f[p],l,c,u,d))return!0;return!1}const i=C();e.check=function o(s,a,l,c,u){if(0===a.elementCount||0===l.elementCount)return 0;const{units:d}=a;s.element.structure=a;for(let f=0,p=d.length;f<p;f++){const m=d[f];s.element.unit=m;const{elements:h,conformation:g}=m;for(let y=0,v=h.length;y<v;y++){const x=h[y];if(s.element.element=x,r(s,l,g.position(x,i),u(s),c,u))return!0}}return!1}}(I5||(I5={})),function(e){function a(f){return!0}function l(f){return!1}e.eq=function n(f,p){return m=>f(m)===p},e.lt=function r(f,p){return m=>f(m)<p},e.lte=function i(f,p){return m=>f(m)<=p},e.gt=function o(f,p){return m=>f(m)>p},e.gte=function s(f,p){return m=>f(m)>=p},e.inSet=function c(f,p){if(function t(f){return!!f&&!!f.has}(p))return m=>p.has(f(m));{if(0===p.length)return l;const m=new Set;for(let h=0;h<p.length;h++)m.add(p[h]);return h=>m.has(f(h))}},e.and=function u(...f){switch(f.length){case 0:return a;case 1:return f[0];case 2:{const p=f[0],m=f[1];return h=>p(h)&&m(h)}case 3:{const p=f[0],m=f[1],h=f[2];return g=>p(g)&&m(g)&&h(g)}case 4:{const p=f[0],m=f[1],h=f[2],g=f[3];return y=>p(y)&&m(y)&&h(y)&&g(y)}case 5:{const p=f[0],m=f[1],h=f[2],g=f[3],y=f[4];return v=>p(v)&&m(v)&&h(v)&&g(v)&&y(v)}case 6:{const p=f[0],m=f[1],h=f[2],g=f[3],y=f[4],v=f[5];return x=>p(x)&&m(x)&&h(x)&&g(x)&&y(x)&&v(x)}default:{const p=f.length;return m=>{for(let h=0;h<p;h++)if(!f[h])return!1;return!0}}}},e.or=function d(...f){switch(f.length){case 0:return l;case 1:return f[0];case 2:{const p=f[0],m=f[1];return h=>p(h)||m(h)}case 3:{const p=f[0],m=f[1],h=f[2];return g=>p(g)||m(g)||h(g)}case 4:{const p=f[0],m=f[1],h=f[2],g=f[3];return y=>p(y)||m(y)||h(y)||g(y)}case 5:{const p=f[0],m=f[1],h=f[2],g=f[3],y=f[4];return v=>p(v)||m(v)||h(v)||g(v)||y(v)}case 6:{const p=f[0],m=f[1],h=f[2],g=f[3],y=f[4],v=f[5];return x=>p(x)||m(x)||h(x)||g(x)||y(x)||v(x)}default:{const p=f.length;return m=>{for(let h=0;h<p;h++)if(f[h])return!0;return!1}}}}}(b7||(b7={}));const _i={generators:Ms,filters:At,modifiers:Ki,combinators:Ma,pred:b7,internal:Wr,atomset:rs};var lg;function dVe(e){return _i.generators.atoms({chainTest:_i.pred.and(_i.pred.eq(t=>Je.unit.operator_name(t.element),ko.DefaultName),_i.pred.inSet(t=>Je.chain.label_asym_id(t.element),e))})}function ile(e,t,n,r,i,o){const{spacegroup:s,ncsOperators:a}=e,l=[],{toFractional:c}=s.cell,u=C.transformMat4(C(),o,c),d=wd.getSymmetryOperatorRef(s,t,n,r,i,u);if(a&&a.length)for(let f=0,p=a.length;f<p;++f){const m=a[f],h=fe.mul(fe(),d.matrix,m.matrix),g=ko.create(`${d.name} ${m.name}`,h,{assembly:d.assembly,ncsId:m.ncsId,hkl:d.hkl,spgrOp:d.spgrOp});l.push(g)}else l.push(d);return l}function ole(e,t,n,r){const{spacegroup:i,ncsOperators:o}=e,s=o&&o.length||0,a=[];!s&&t[0]<=0&&n[0]>=0&&t[1]<=0&&n[1]>=0&&t[2]<=0&&n[2]>=0&&(a[0]=wd.getSymmetryOperator(i,0,0,0,0));for(let l=0;l<i.operators.length;l++)for(let c=t[0];c<=n[0];c++)for(let u=t[1];u<=n[1];u++)for(let d=t[2];d<=n[2];d++)!s&&0===l&&0===c&&0===u&&0===d||a.push(...ile(e,l,c,u,d,r));return a}function sle(e,t){const n=Xe.Builder({label:e.label,dynamicBonds:e.dynamicBonds}),{units:r}=e;for(const i of t)for(const o of r)n.addWithOperator(o,i);return n.getStructure()}function v7(){return(v7=le(function*(e,t){const n=t.models;if(1!==n.length)throw new Error("Can only build NCS from structures based on 1 model.");const r=Vs.Provider.get(n[0]);if(!r)return t;const i=r.ncsOperators;return i&&i.length?sle(t,i):t})).apply(this,arguments)}function x7(){return(x7=le(function*(e,t,n,r){const i=t.models;if(1!==i.length)throw new Error("Can only build symmetries from structures based on 1 model.");const o=Vs.Provider.get(i[0]);if(!o)return t;const{spacegroup:s}=o;return Qc.isZero(s.cell)?t:sle(t,ole(o,n,r,Sn.getCenter(i[0])))})).apply(this,arguments)}function _7(){return _7=le(function*(e,t,n){const r=t.models;if(1!==r.length)throw new Error("Can only build symmetries from structures based on 1 model.");const i=Vs.Provider.get(r[0]);if(!i)return t;const{spacegroup:o}=i;if(Qc.isZero(o.cell))return t;e.shouldUpdate&&(yield e.update("Initialing..."));const a=function fVe(e,t){return e._operators_333&&C.equals(t,e._operators_333.ref)||(e._operators_333={ref:C.clone(t),operators:ole(e,C.create(-3,-3,-3),C.create(3,3,3),t)}),e._operators_333.operators}(i,Sn.getCenter(r[0])),l=t.lookup3d,c=new Set;function u(m,h){return`${m.invariantId}|${h.name}`}const d=Xe.Builder({label:t.label,dynamicBonds:t.dynamicBonds}),{units:f}=t,p=C.zero();for(const m of a){for(const h of f){const g=h.lookup3d.boundary.sphere;C.transformMat4(p,g.center,m.matrix);const y=l.findUnitIndices(p[0],p[1],p[2],g.radius+n);for(let v=0,x=y.count;v<x;v++){if(!f[y.indices[v]].lookup3d.check(p[0],p[1],p[2],g.radius+n))continue;const w=u(h,m);c.has(w)||(d.addWithOperator(h,m),c.add(w))}}e.shouldUpdate&&(yield e.update("Building symmetry..."))}return d.getStructure()}),_7.apply(this,arguments)}!function(e){function s(u,d){return u.invariantId===d.invariantId&&u.model.id===d.model.id&&rt.areEqual(u.elements,d.elements)}function a(){return function pOe(e,t){return new fOe(e,t)}(ze.hashUnit,s)}e.buildAssembly=function t(u,d){return Ke.create("Build Assembly",function(){var f=le(function*(p){const m=u.models;if(1!==m.length)throw new Error("Can only build assemblies from structures based on 1 model.");const h=M3.findAssembly(m[0],d);if(!h)throw new Error(`Assembly '${d}' is not defined.`);const g=ko.create(h.id,fe.identity(),{assembly:{id:h.id,operId:0,operList:[]}}),y=Xe.Builder({coordinateSystem:g,label:u.label,dynamicBonds:u.dynamicBonds}),v=new _f(u);for(const x of h.operatorGroups){const _=x.selector(v);if(0===Dt.structureCount(_))continue;const{units:w}=Dt.unionStructure(_);for(const A of x.operators)for(const M of w)y.addWithOperator(M,A)}return y.getStructure()});return function(p){return f.apply(this,arguments)}}())},e.buildSymmetryAssembly=function n(u,d,f){return Ke.create("Build Symmetry Assembly",function(){var p=le(function*(m){const h=u.models;if(1!==h.length)throw new Error("Can only build symmetry assemblies from structures based on 1 model.");const g=C(),y=Xe.Builder({label:u.label,representativeModel:h[0],dynamicBonds:u.dynamicBonds}),v=new _f(u);for(const x of d){const w=dVe(x.asymIds)(v);if(0===Dt.structureCount(w))continue;const{units:A}=Dt.unionStructure(w);for(const{index:M,shift:[E,D,T]}of x.operators){const F=ile(f,M,E,D,T,g);for(const R of A)for(const N of F)y.addWithOperator(R,N)}}return y.getStructure()});return function(m){return p.apply(this,arguments)}}())},e.builderSymmetryMates=function r(u,d){return Ke.create("Find Symmetry Mates",f=>function mVe(e,t,n){return _7.apply(this,arguments)}(f,u,d))},e.buildSymmetryRange=function i(u,d,f){return Ke.create("Build Symmetry",p=>function hVe(e,t,n,r){return x7.apply(this,arguments)}(p,u,d,f))},e.buildNcs=function o(u){return Ke.create("Build NCS",d=>function pVe(e,t){return v7.apply(this,arguments)}(d,u))},e.areUnitsEquivalent=s,e.UnitEquivalenceBuilder=a,e.computeTransformGroups=function l(u){const d=a();for(const p of u.units)d.add(p.id,p);const f=[];for(const p of d.groups)f.push(ze.SymmetryGroup(p.map(m=>u.unitMap.get(m))));return f},e.areTransformGroupsEquivalent=function c(u,d){if(u.length!==d.length)return!1;for(let f=0,p=u.length;f<p;++f){const m=u[f].units,h=d[f].units;if(m.length!==h.length||u[f].hashCode!==d[f].hashCode)return!1;for(let g=0,y=m.length;g<y;g++)if(m[g].conformation!==h[g].conformation)return!1}return!0}}(lg||(lg={}));class gVe{addToUnit(t,n){const r=this.unitMap.get(t);r?r[r.length]=n:(this.unitMap.set(t,[n]),this.ids[this.ids.length]=t),this.elementCount++}beginUnit(t){this.parentId=t,this.currentUnit=this.currentUnit.length>0?[]:this.currentUnit}addElement(t){this.currentUnit[this.currentUnit.length]=t,this.elementCount++}addElementRange(t,n,r){for(let i=n;i<r;i++)this.currentUnit[this.currentUnit.length]=t[i],this.elementCount++}commitUnit(){0!==this.currentUnit.length&&(this.ids[this.ids.length]=this.parentId,this.unitMap.set(this.parentId,this.currentUnit),this.parentId=-1)}setUnit(t,n){this.ids[this.ids.length]=t,this.unitMap.set(t,n),this.elementCount+=n.length}_getStructure(t){if(this.isEmpty)return Xe.Empty;const n=[];ip(this.ids);const r=lg.UnitEquivalenceBuilder();for(let i=0,o=this.ids.length;i<o;i++){const s=this.ids[i],a=this.parent.unitMap.get(s);let l=this.unitMap.get(s),c=!1;t&&(this.isSorted||ip(l),l=rt.deduplicate(rt.ofSortedArray(this.currentUnit)),c=!0);const u=l.length;if(l.length===a.elements.length){n[n.length]=a,r.add(a.id,a);continue}!this.isSorted&&!c&&u>1&&ip(l);let d=a.getChild(rt.ofSortedArray(l));const f=r.add(d.id,d);d!==f&&(d=f.applyOperator(d.id,d.conformation.operator,!0)),n[n.length]=d}return Xe.create(n,{parent:this.parent})}getStructure(){return this._getStructure(!1)}getStructureDeduplicate(){return this._getStructure(!0)}setSingletonLocation(t){const n=this.ids[0];t.unit=this.parent.unitMap.get(n),t.element=this.unitMap.get(n)[0]}get isEmpty(){return 0===this.elementCount}constructor(t,n){this.parent=t,this.isSorted=n,this.ids=[],this.unitMap=sp.Mutable(),this.parentId=-1,this.currentUnit=[],this.elementCount=0}}function ale(e,t){let n=1;for(;t--;)n*=e--;return n}class vVe{move(){if(this.hasNext){let t=0,n=0,r=this.index;for(;r;r>>>=1,t++)1&r&&(this.value[n++]=this.array[t]);this.index=function bVe(e){const t=e&-e,n=e+t;return n|((n&-n)/t>>1)-1}(this.index),this.hasNext=this.index<this.maxIndex}return this.value}constructor(t,n){this.array=t,this.hasNext=!1,this.index=(1<<n)-1,this.size=function yVe(e,t){return t>e?0:ale(e,t)/ale(t,t)}(t.length,n),this.maxIndex=1<<t.length,this.value=new Array(n),this.hasNext=n>0&&n<=t.length}}function lle(e,t){const n=[],r=new vVe(e,t);for(;r.hasNext;)n.push(r.move().slice());return n}const d_=[],xVe={links:d_,terminalLinks:d_,elements:d_,partialElements:d_,getElementIndices:()=>d_,getLinkIndices:()=>d_,getTerminalLinkIndices:()=>d_},ul=Jx("C"),Y3=Jx("O"),_Ve=[fp.elementFingerprint([ul,ul,ul,Y3]),fp.elementFingerprint([ul,ul,ul,ul,Y3]),fp.elementFingerprint([ul,ul,ul,ul,ul,Y3]),fp.elementFingerprint([ul,ul,ul,ul,ul,ul,Y3])];function SVe(e,t){let n=-1,r=-1,i=-1,o=-1;const{elements:s}=e,{type_symbol:a,label_atom_id:l}=e.model.atomicHierarchy.atoms,{b:c,offset:u}=e.bonds;for(let d=0,f=t.length;d<f;++d){const p=s[t[d]];if(a.value(p)!==ul)continue;let m=0,h=0;for(let g=u[t[d]],y=u[t[d]+1];g<y;++g){const x=a.value(s[c[g]]);x===Y3?++m:x===ul&&++h}if(2===m){n=p;break}1===m&&1===h?r=p:l.value(p).startsWith("C1")?i=p:o=p}return-1!==n?n:-1!==r?r:-1!==i?i:-1!==o?o:s[t[0]]}function wVe(e,t,n,r){return C.normalize(e,C.sub(e,r,t.conformation.position(n,e))),e}function cle(e,t){const{elements:n}=e,{label_atom_id:r}=e.model.atomicHierarchy.atoms;return r.value(n[t])}function AVe(e,t){if(!t||!t.length)return;const{unit:n,all:r}=e,i=new Set,o=lle(Sd(new Array(t.length)),2);for(let s=0,a=o.length;s<a;++s){const l=o[s],c=r[t[l[0]]],u=r[t[l[1]]];rt.areIntersecting(c,u)&&fp.getAltId(n,c)===fp.getAltId(n,u)&&(i.add(t[l[0]]),i.add(t[l[1]]))}if(i.size){const s=[];for(let a=0,l=t.length;a<l;++a)i.has(t[a])||s.push(t[a]);return s}return t}function IVe(e,t){return t.properties.saccharideComponentMap.get(e)}function TVe(e,t,n){function r(d,f){return gf(d.id,f)}function i(d,f,p){const m=[],h=d.get(r(f,p));if(void 0!==h)for(const g of h)Us(m,g);return m}const o=new Map;for(let d=0,f=e.length;d<f;++d){const{unit:p,ringIndex:m}=e[d],h=p.rings.all[m];for(let g=0,y=h.length;g<y;++g){const v=r(p,p.elements[h[g]]),x=o.get(v);void 0===x?o.set(v,[d]):x.push(d)}}const a=new Map;for(let d=0,f=t.length;d<f;++d){const p=t[d],{unit:m,ringIndex:h}=e[p.carbohydrateIndexA],g=m.rings.all[h];for(let y=0,v=g.length;y<v;++y){const x=r(m,m.elements[g[y]]),_=a.get(x);void 0===_?a.set(x,[d]):_.push(d)}}const c=new Map;for(let d=0,f=n.length;d<f;++d){const{fromCarbohydrate:p,carbohydrateIndex:m,elementUnit:h,elementIndex:g}=n[d];if(p){const{unit:y,ringIndex:v}=e[m],x=y.rings.all[v];for(let _=0,w=x.length;_<w;++_){const A=r(y,y.elements[x[_]]),M=c.get(A);void 0===M?c.set(A,[d]):M.push(d)}}else{const y=r(h,h.elements[g]),v=c.get(y);void 0===v?c.set(y,[d]):v.push(d)}}return{getElementIndices:function s(d,f){return i(o,d,f)},getLinkIndices:function l(d,f){return i(a,d,f)},getTerminalLinkIndices:function u(d,f){return i(c,d,f)}}}const T5=ke(),DVe=new xf("14"),PVe=new xf("98");class Xe{subsetBuilder(t){return new gVe(this,t)}get elementCount(){return this.state.elementCount}get bondCount(){return-1===this.state.bondCount&&(this.state.bondCount=this.interUnitBonds.edgeCount+fn.getIntraUnitBondCount(this)),this.state.bondCount}get hasCustomProperties(){return!!this.state.customProps&&this.state.customProps.all.length>0}get customPropertyDescriptors(){return this.state.customProps||(this.state.customProps=new Oh),this.state.customProps}get currentPropertyData(){return this.state.propertyData||(this.state.propertyData=Object.create(null)),this.state.propertyData}get inheritedPropertyData(){return this.parent?this.parent.currentPropertyData:this.currentPropertyData}get polymerResidueCount(){return-1===this.state.polymerResidueCount&&(this.state.polymerResidueCount=function UVe(e){const{units:t}=e;let n=0;for(let r=0,i=t.length;r<i;r++)n+=t[r].polymerElements.length;return n}(this)),this.state.polymerResidueCount}get polymerGapCount(){return-1===this.state.polymerGapCount&&(this.state.polymerGapCount=function zVe(e){const{units:t}=e;let n=0;for(let r=0,i=t.length;r<i;r++)n+=t[r].gapElements.length/2;return n}(this)),this.state.polymerGapCount}get polymerUnitCount(){return-1===this.state.polymerUnitCount&&(this.state.polymerUnitCount=function VVe(e){const{units:t}=e;let n=0;for(let r=0,i=t.length;r<i;r++)t[r].polymerElements.length>0&&(n+=1);return n}(this)),this.state.polymerUnitCount}get uniqueElementCount(){return-1===this.state.uniqueElementCount&&(this.state.uniqueElementCount=function jVe(e){const{unitSymmetryGroups:t}=e;let n=0;for(let r=0,i=t.length;r<i;r++)n+=t[r].elements.length;return n}(this)),this.state.uniqueElementCount}get atomicResidueCount(){return-1===this.state.atomicResidueCount&&(this.state.atomicResidueCount=function HVe(e){const{units:t}=e;let n=0;for(let r=0,i=t.length;r<i;r++){const o=t[r];if(!ze.isAtomic(o))continue;const{elements:s,residueIndex:a}=o;let l=-1,c=-1;for(let u=0,d=s.length;u<d;++u)l=a[s[u]],l!==c&&(n+=1,c=l)}return n}(this)),this.state.atomicResidueCount}get isCoarseGrained(){return this.models.some(t=>Sn.isCoarseGrained(t))}get isEmpty(){return 0===this.units.length}get hashCode(){return-1!==this.state.hashCode?this.state.hashCode:this.computeHash()}get transformHash(){return-1!==this.state.transformHash||(this.state.transformHash=Zc(this.units.map(t=>t.id))),this.state.transformHash}computeHash(){let t=23;for(let n=0,r=this.units.length;n<r;n++){const i=this.units[n];t=31*t+i.id|0,t=31*t+rt.hashCode(i.elements)|0}return t=31*t+this.elementCount|0,t=Soe(t),-1===t&&(t=0),this.state.hashCode=t,t}elementLocations(){return new Xe.ElementLocationIterator(this)}get root(){var t;return null!==(t=this.state.parent)&&void 0!==t?t:this}get parent(){return this.state.parent}get coordinateSystem(){return this.state.coordinateSystem}get label(){return this.state.label}get boundary(){return this.state.boundary||(this.state.boundary=function MVe(e){const{units:t}=e,n=function kVe(e){return e>500?DVe:PVe}(t.length);n.reset();for(let r=0,i=t.length;r<i;r++){const o=t[r],s=o.boundary,a=o.conformation.operator;a.isIdentity?n.includeSphere(s.sphere):(ke.transform(T5,s.sphere,a.matrix),n.includeSphere(T5))}n.finishedIncludeStep();for(let r=0,i=t.length;r<i;r++){const o=t[r],s=o.boundary,a=o.conformation.operator;a.isIdentity?n.radiusSphere(s.sphere):(ke.transform(T5,s.sphere,a.matrix),n.radiusSphere(T5))}return{box:n.getBox(),sphere:n.getSphere()}}(this)),this.state.boundary}get lookup3d(){return this.state.lookup3d||(this.state.lookup3d=new Lje(this)),this.state.lookup3d}get interUnitBonds(){return this.state.interUnitBonds||(this.state.interUnitBonds=this.parent&&this.state.dynamicBonds===this.parent.state.dynamicBonds&&this.parent.state.interUnitBonds&&0===this.parent.state.interUnitBonds.edgeCount?new T3(new Map):Y8e(this,{ignoreWater:!this.dynamicBonds,ignoreIon:!this.dynamicBonds,validUnit:this.state.interBondsValidUnit,validUnitPair:this.state.interBondsValidUnitPair})),this.state.interUnitBonds}get dynamicBonds(){return this.state.dynamicBonds}get interBondsValidUnit(){return this.state.interBondsValidUnit}get interBondsValidUnitPair(){return this.state.interBondsValidUnitPair}get unitSymmetryGroups(){return this.state.unitSymmetryGroups||(this.state.unitSymmetryGroups=lg.computeTransformGroups(this)),this.state.unitSymmetryGroups}get unitSymmetryGroupsIndexMap(){return this.state.unitSymmetryGroupsIndexMap||(this.state.unitSymmetryGroupsIndexMap=ze.SymmetryGroup.getUnitSymmetryGroupsIndexMap(this.unitSymmetryGroups)),this.state.unitSymmetryGroupsIndexMap}get carbohydrates(){return this.state.carbohydrates||(this.state.carbohydrates=function EVe(e){if(0===e.models.reduce((f,p)=>f+p.properties.saccharideComponentMap.size,0))return xVe;const t=[],n=[],r=[],i=[],o=new Map;function s(f,p,m){return`${f}|${p}|${m}`}function a(f,p){o.has(f)?o.get(f).push(p):o.set(f,[p])}function l(f,p){C.sub(r[f].geometry.direction,r[p].geometry.center,r[f].geometry.center),C.normalize(r[f].geometry.direction,r[f].geometry.direction)}const c=C();function u(f,p,m){const g=r[f].geometry;C.sub(g.direction,m.conformation.position(m.elements[p],c),g.center),C.normalize(g.direction,g.direction)}for(let f=0,p=e.units.length;f<p;++f){const m=e.units[f];if(!ze.isAtomic(m))continue;const{model:h,rings:g}=m,{chainAtomSegments:y,residueAtomSegments:v,atoms:x}=h.atomicHierarchy,{label_comp_id:_}=x,w=En.transientSegments(y,m.elements),A=En.transientSegments(v,m.elements);let M;for(;w.hasNext;)for(A.setSegment(w.move());A.hasNext;){const{index:E}=A.move(),D=IVe(_.value(v.offsets[E]),h);if(!D)continue;M||(M=l5.byFingerprintAndResidue(g,_Ve));const T=AVe(g,M.get(E));if(!T||!T.length){i.push({unit:m,residueIndex:E,component:D});continue}const F=[];for(let N=0,j=T.length;N<j;++N){const W=g.all[T[N]],z=SVe(m,W),$=Uh.calculateMomentsAxes(Zse(m,W)),V=Uh.calculateNormalizedAxes($),X=C.copy(C(),V.origin),H=C.copy(C(),V.dirC),oe=wVe(C(),m,z,X);C.orthogonalize(oe,H,oe);const te=fp.getAltId(m,W),K=r.length;F.push(K),a(s(E,m.id,te),K),te&&a(s(E,m.id,""),K),r.push({geometry:{center:X,normal:H,direction:oe},component:D,ringIndex:T[N],altId:te,unit:m,residueIndex:E})}const R=lle(Sd(new Array(T.length)),2);for(let N=0,j=R.length;N<j;++N){const W=R[N];if(Cd.areVertexSetsConnected(m.bonds,g.all[T[W[0]]],g.all[T[W[1]]],3)){const V=F[W[0]],X=F[W[1]];r[V].altId===r[X].altId&&(l(V,X),l(X,V),t.push({carbohydrateIndexA:V,carbohydrateIndexB:X}),t.push({carbohydrateIndexA:X,carbohydrateIndexB:V}))}}}}function d(f,p){return o.get(s(f.getResidueIndex(p),f.id,function CVe(e,t){const{elements:n}=e,{label_alt_id:r}=e.model.atomicHierarchy.atoms;return r.value(n[t])}(f,p)))||[]}for(let f=0,p=r.length;f<p;++f){const m=r[f],{unit:h}=m;for(let g=f+1;g<p;++g){const y=r[g];h===y.unit&&m.residueIndex!==y.residueIndex&&Cd.areVertexSetsConnected(h.bonds,h.rings.all[m.ringIndex],h.rings.all[y.ringIndex],3)&&(l(f,g),l(g,f),t.push({carbohydrateIndexA:f,carbohydrateIndexB:g}),t.push({carbohydrateIndexA:g,carbohydrateIndexB:f}))}}for(let f=0,p=e.units.length;f<p;++f){const m=e.units[f];ze.isAtomic(m)&&e.interUnitBonds.getConnectedUnits(m.id).forEach(h=>{h.connectedIndices.forEach(g=>{h.getEdges(g).forEach(({props:y,indexB:v})=>{if(!Lr.isCovalent(y.flag))return;const x=e.unitMap.get(h.unitA),_=e.unitMap.get(h.unitB),w=d(x,g),A=d(_,v);if(w.length>0&&A.length>0){const M=w.length,E=A.length;for(let D=0,T=Math.max(M,E);D<T;++D){const F=w[Math.min(D,M-1)],R=A[Math.min(D,E-1)],N=cle(x,g);(N.startsWith("O1")||N.startsWith("C1"))&&l(F,R),t.push({carbohydrateIndexA:F,carbohydrateIndexB:R})}}else if(0===A.length)for(const M of w){const E=cle(x,g);(E.startsWith("O1")||E.startsWith("C1"))&&u(M,v,_),n.push({carbohydrateIndex:M,elementIndex:v,elementUnit:_,fromCarbohydrate:!0})}else if(0===w.length)for(const M of A)n.push({carbohydrateIndex:M,elementIndex:g,elementUnit:x,fromCarbohydrate:!1})})})})}return{links:t,terminalLinks:n,elements:r,partialElements:i,...TVe(r,t,n)}}(this)),this.state.carbohydrates}get models(){return this.state.models||(this.state.models=function NVe(e){const{units:t}=e,n=Ti.create();for(const r of t)Ti.add(n,r.model.id,r.model);return n.array}(this)),this.state.models}get uniqueResidueNames(){return this.state.uniqueResidueNames||(this.state.uniqueResidueNames=function FVe(e){const{microheterogeneityCompIds:t}=Je.residue,n=new Set,r=dt.create(e);for(const i of e.unitSymmetryGroups){const o=i.units[0];if(!ze.isAtomic(o))continue;const s=En.transientSegments(o.model.atomicHierarchy.residueAtomSegments,o.elements);for(r.unit=o;s.hasNext;){const a=s.move();r.element=o.elements[a.start];const l=t(r);for(const c of l)n.add(c)}}return n}(this))}get uniqueElementSymbols(){return this.state.uniqueElementSymbols||(this.state.uniqueElementSymbols=function OVe(e){const t=Je.atom.type_symbol,n=new Set,r=dt.create(e);for(const i of e.unitSymmetryGroups){const o=i.units[0];if(ze.isAtomic(o)){r.unit=o;for(let s=0,a=o.elements.length;s<a;++s)r.element=o.elements[s],n.add(t(r))}}return n}(this))}get entityIndices(){return this.state.entityIndices||(this.state.entityIndices=function BVe(e){const{units:t}=e,n=dt.create(e),r=Ti.create();for(const i of t){const o=0===i.kind?Je.entity.key:Je.coarse.entityKey;n.unit=i;const s=i.elements,a=En.transientSegments(i.model.atomicHierarchy.chainAtomSegments,s);for(;a.hasNext;){const l=a.move();n.element=s[l.start];const c=o(n);Ti.add(r,c,c)}}return ip(r.array),r.array}(this))}get uniqueAtomicResidueIndices(){return this.state.uniqueAtomicResidueIndices||(this.state.uniqueAtomicResidueIndices=function LVe(e){const t=new Map,n=[],r=e.unitSymmetryGroups;for(const o of r){const s=o.units[0];if(!ze.isAtomic(s))continue;let a;t.has(s.model.id)?a=t.get(s.model.id):(a=Ti.create(),n.push(s.model.id),t.set(s.model.id,a));const l=En.transientSegments(s.model.atomicHierarchy.residueAtomSegments,s.elements);for(;l.hasNext;){const c=l.move();Ti.add(a,c.index,c.index)}}const i=new Map;for(const o of n){const s=t.get(o).array;ip(s),i.set(o,s)}return i}(this))}get isAtomic(){for(const t of this.units)if(!ze.isAtomic(t))return!1;return!0}get hasAtomic(){for(const t of this.units)if(ze.isAtomic(t))return!0;return!1}get isCoarse(){for(const t of this.units)if(!ze.isCoarse(t))return!1;return!0}get hasCoarse(){for(const t of this.units)if(ze.isCoarse(t))return!0;return!1}get serialMapping(){return this.state.serialMapping||(this.state.serialMapping=function GVe(e){const{units:t,elementCount:n,unitIndexMap:r}=e,i=new Uint32Array(t.length),o=new Uint32Array(n),s=new Uint32Array(n);for(let a=0,l=0,c=t.length;a<c;++a){i[a]=l;const{elements:u}=t[a];for(let d=0,f=u.length;d<f;++d){const p=l+d;o[p]=a,s[p]=u[d]}l+=u.length}return{cumulativeUnitElementCount:i,unitIndices:o,elementIndices:s,getSerialIndex:(a,l)=>i[r.get(a.id)]+Ve.indexOf(a.elements,l)}}(this))}get model(){if(this.state.model)return this.state.model;if(this.state.representativeModel)return this.state.representativeModel;if(this.state.masterModel)return this.state.masterModel;const t=this.models;if(t.length>1)throw new Error("The structure is based on multiple models and has neither a master- nor a representative-model.");return this.state.model=t[0],this.state.model}get masterModel(){return this.state.masterModel}get representativeModel(){return this.state.representativeModel}hasElement(t){return!!this.unitMap.has(t.unit.id)&&rt.has(this.unitMap.get(t.unit.id).elements,t.element)}getModelIndex(t){return this.models.indexOf(t)}remapModel(t){const{dynamicBonds:n,interUnitBonds:r,parent:i}=this.state,o=[];for(const s of this.unitSymmetryGroups){const a=s.units[0].remapModel(t,n);o.push(a);for(let l=1,c=s.units.length;l<c;++l)o.push(s.units[l].remapModel(t,n,a.props))}return Xe.create(o,{parent:i?.remapModel(t),label:this.label,interUnitBonds:n?void 0:r,dynamicBonds:n,interBondsValidUnit:this.state.interBondsValidUnit,interBondsValidUnitPair:this.state.interBondsValidUnitPair,coordinateSystem:this.state.coordinateSystem,masterModel:this.state.masterModel,representativeModel:this.state.representativeModel})}asParent(){if(this._proxy)return this._proxy;if(this.parent){const t=this.parent.coordinateSystem.isIdentity?this.parent:Xe.transform(this.parent,this.parent.coordinateSystem.inverse),n=this.coordinateSystem.isIdentity?t:Xe.transform(t,this.coordinateSystem.matrix);this._proxy=new Xe(n.units,n.unitMap,n.unitIndexMap,{...n.state,dynamicBonds:this.dynamicBonds},{child:this,target:this.parent})}else this._proxy=this;return this._proxy}get child(){return this._child}get target(){var t;return null!==(t=this._target)&&void 0!==t?t:this}constructor(t,n,r,i,o){this.units=t,this.unitMap=n,this.unitIndexMap=r,this.state=i,this._child=o?.child,this._target=o?.target,this._proxy=void 0}}function RVe(e,t,n){return e[t].id-e[n].id}!function(e){function t(re){return{kind:"structure-loci",structure:re}}function l(re,ae={}){const ge=sp.Mutable(),Ie=sp.Mutable();let me=0,Ae=!0,he=re.length>0?re[0].id:0;for(let ue=0,_e=re.length;ue<_e;ue++){const Fe=re[ue];ge.set(Fe.id,Fe),me+=Fe.elements.length,Fe.id<he&&(Ae=!1),he=Fe.id}Ae||uoe(re,0,re.length,RVe,qx);for(let ue=0,_e=re.length;ue<_e;ue++)Ie.set(re[ue].id,ue);const ie={hashCode:-1,transformHash:-1,elementCount:me,bondCount:-1,uniqueElementCount:-1,atomicResidueCount:-1,polymerResidueCount:-1,polymerGapCount:-1,polymerUnitCount:-1,dynamicBonds:!1,coordinateSystem:ko.Default,label:""};return ae.parent&&(ie.parent=ae.parent.parent||ae.parent),ae.interUnitBonds&&(ie.interUnitBonds=ae.interUnitBonds),ae.interBondsValidUnit?ie.interBondsValidUnit=ae.interBondsValidUnit:ae.parent&&(ie.interBondsValidUnit=ae.parent.interBondsValidUnit),ae.interBondsValidUnitPair?ie.interBondsValidUnitPair=ae.interBondsValidUnitPair:ae.parent&&(ie.interBondsValidUnitPair=ae.parent.interBondsValidUnitPair),ae.dynamicBonds?ie.dynamicBonds=ae.dynamicBonds:ae.parent&&(ie.dynamicBonds=ae.parent.dynamicBonds),ae.coordinateSystem?ie.coordinateSystem=ae.coordinateSystem:ae.parent&&(ie.coordinateSystem=ae.parent.coordinateSystem),ae.label?ie.label=ae.label:ae.parent&&(ie.label=ae.parent.label),ae.masterModel?ie.masterModel=ae.masterModel:ae.parent&&(ie.masterModel=ae.parent.masterModel),ae.representativeModel?ie.representativeModel=ae.representativeModel:ae.parent&&(ie.representativeModel=ae.parent.representativeModel),new e(re,ge,Ie,ie)}function u(){return(u=le(function*(re,ae){if(0===re.frameCount)return e.Empty;const ge=[];let Ie,me=0;for(let Ae=0,he=re.frameCount;Ae<he;++Ae){const ie=yield Ke.resolveInContext(re.getFrameAtIndex(Ae),ae);Ie||(Ie=ie);const ue=f(ie);for(let _e=0,Fe=ue.units.length;_e<Fe;++_e){const Ze=ue.units[_e],ne=ze.create(ge.length,Ze.invariantId+me,Ze.chainGroupId+me,Ze.traits,Ze.kind,Ze.model,Ze.conformation.operator,Ze.elements);ge.push(ne)}me=ge.length}return l(ge,{representativeModel:Ie,label:Ie.label})})).apply(this,arguments)}e.Empty=l([]),e.Loci=t,e.toStructureElementLoci=function n(re){const ae=[];for(const ge of re.units)ae.push({unit:ge,indices:Pe.ofBounds(0,ge.elements.length)});return Me(re,ae)},e.toSubStructureElementLoci=function r(re,ae){return Dt.toLociWithSourceUnits(Dt.Singletons(re,ae))},e.isLoci=function i(re){return!!re&&"structure-loci"===re.kind},e.areLociEqual=function o(re,ae){return re.structure===ae.structure},e.isLociEmpty=function s(re){return re.structure.isEmpty},e.remapLoci=function a(re,ae){return ae===re.structure?re:t(ae)},e.create=l,e.ofTrajectory=function c(re,ae){return u.apply(this,arguments)};const d=!1;function f(re,ae={}){const ge=re.atomicHierarchy.chainAtomSegments,{index:Ie}=re.atomicHierarchy,{auth_asym_id:me}=re.atomicHierarchy.chains,{atomicChainOperatorMappinng:Ae}=re,he=new x({label:re.label,...ae});for(let ue=0;ue<ge.count;ue++){const _e=Ae.get(ue)||ko.Default,Fe=ge.offsets[ue];let Ze=i_.chainResidueCount(re.atomicHierarchy,ue)===ge.offsets[ue+1]-ge.offsets[ue],ct=!1;if(p(re,ue))for(;ue+1<ge.count&&p(re,ue+1)&&Ae.get(ue)===Ae.get(ue+1);)ct=!0,ue++;else for(;ue+1<ge.count&&ge.offsets[ue+1]-ge.offsets[ue]==1&&ge.offsets[ue+2]-ge.offsets[ue+1]==1&&(Ze=!0,Ie.getEntityFromChain(ue)===Ie.getEntityFromChain(ue+1))&&me.value(ue)===me.value(ue+1)&&Ae.get(ue)===Ae.get(ue+1);)ct=!0,ue++;const q=rt.ofBounds(Fe,ge.offsets[ue+1]);d?Ze&&!m(re,ue)?h(re,q,he,ct,_e):q.length>2e5||p(re,ue)?g(re,q,he,ct,_e):he.addUnit(0,re,_e,q,ct?ze.Trait.MultiChain:ze.Trait.None):he.addUnit(0,re,_e,q,ct?ze.Trait.MultiChain:ze.Trait.None)}const ie=re.coarseHierarchy;return ie.isDefined&&(ie.spheres.count>0&&y(he,re,re.coarseHierarchy.spheres,1),ie.gaussians.count>0&&y(he,re,re.coarseHierarchy.gaussians,2)),he.getStructure()}function p(re,ae){const ge=re.atomicHierarchy.index.getEntityFromChain(ae);return"water"===re.entities.data.type.value(ge)}function m(re,ae){const ge=re.atomicHierarchy.index.getEntityFromChain(ae);return"polymer"===re.entities.data.type.value(ge)}function h(re,ae,ge,Ie,me){const{x:Ae,y:he,z:ie}=re.atomicConformation,ue={x:Ae,y:he,z:ie,indices:ae},_e=zh(ue,Q0(ue),8192),{offset:Fe,count:Ze,array:ct}=_e.buckets,q=(Ie?ze.Trait.MultiChain:ze.Trait.None)|(Fe.length>1?ze.Trait.Partitioned:ze.Trait.None);ge.beginChainGroup();for(let ne=0,be=Fe.length;ne<be;ne++){const Ce=Fe[ne],Re=new Int32Array(Ze[ne]);for(let Be=0,$e=Ze[ne];Be<$e;Be++)Re[Be]=ae[ct[Ce+Be]];ge.addUnit(0,re,me,rt.ofSortedArray(Re),q)}ge.endChainGroup()}function g(re,ae,ge,Ie,me){const{residueAtomSegments:Ae}=re.atomicHierarchy,he=[],ie=[],ue=En.transientSegments(Ae,ae);for(;ue.hasNext;){const nt=ue.move();he[he.length]=ae[nt.start],ie[ie.length]=ae[nt.end]}const Fe=512*(ie[0]-he[0]),{x:Ze,y:ct,z:q}=re.atomicConformation,ne={x:Ze,y:ct,z:q,indices:rt.ofSortedArray(he)},be=zh(ne,Q0(ne),Fe),{offset:Ce,count:Re,array:Be}=be.buckets,$e=(Ie?ze.Trait.MultiChain:ze.Trait.None)|(Ce.length>1?ze.Trait.Partitioned:ze.Trait.None);ge.beginChainGroup();for(let nt=0,ht=Ce.length;nt<ht;nt++){const Ge=Ce[nt],ft=[];for(let vt=0,Pt=Re[nt];vt<Pt;vt++){const St=Be[Ge+vt];for(let Mt=he[St],Qt=ie[St];Mt<Qt;Mt++)ft[ft.length]=Mt}ge.addUnit(0,re,me,rt.ofSortedArray(new Int32Array(ft)),$e)}ge.endChainGroup()}function y(re,ae,ge,Ie){const{chainElementSegments:me}=ge;for(let Ae=0;Ae<me.count;Ae++){const he=rt.ofBounds(me.offsets[Ae],me.offsets[Ae+1]);re.addUnit(Ie,ae,ko.Default,he,ze.Trait.None)}}e.ofModel=f,e.transform=function v(re,ae){if(fe.isIdentity(ae))return re;if(!fe.isRotationAndTranslation(ae,ko.RotationTranslationEpsilon))throw new Error("Only rotation/translation combination can be applied.");const ge=[];for(const Ae of re.units){const he=Ae.conformation.operator,ie=ko.create(he.name,ae,he);ge.push(Ae.applyOperator(Ae.id,ie))}const Ie=re.coordinateSystem;return l(ge,{parent:re,coordinateSystem:ko.compose(ko.create(Ie.name,ae,Ie),Ie)})};class x{beginChainGroup(){this.chainGroupId++,this.inChainGroup=!0}endChainGroup(){this.inChainGroup=!1}addUnit(ae,ge,Ie,me,Ae,he){void 0===he&&(he=this.invariantId());const ie=this.inChainGroup?this.chainGroupId:++this.chainGroupId,ue=ze.create(this.units.length,he,ie,Ae,ae,ge,Ie,me);return this.add(ue)}add(ae){if(1===ae.elements.length){ae.conformation.position(ae.elements[0],this.p);const ge=[ae.invariantId,this.p[0],this.p[1],this.p[2]].join("|");if(this.singleElementUnits.has(ge))return this.singleElementUnits.get(ge);this.singleElementUnits.set(ge,ae)}return this.units.push(ae),ae}addWithOperator(ae,ge,Ie=!1){return this.add(ae.applyOperator(this.units.length,ge,Ie))}getStructure(){return l(this.units,this.props)}get isEmpty(){return 0===this.units.length}constructor(ae={}){this.props=ae,this.units=[],this.invariantId=Kc(),this.chainGroupId=-1,this.inChainGroup=!1,this.p=C(),this.singleElementUnits=new Map}}function M(re,ae){if(re===ae)return!0;if(re.elementCount!==ae.elementCount)return!1;const ge=re.units.length;if(ge!==ae.units.length)return!1;for(let Ie=0;Ie<ge;Ie++)if(re.units[Ie].id!==ae.units[Ie].id)return!1;return!0}function T(re,ae){return re===ae||re.hashCode===ae.hashCode&&lg.areTransformGroupsEquivalent(re.unitSymmetryGroups,ae.unitSymmetryGroups)}e.StructureBuilder=x,e.Builder=function _(re={}){return new x(re)},e.hashCode=function w(re){return re.hashCode},e.conformationHash=function A(re){return RU(re.units.map(ae=>ze.conformationId(ae)).join("|"))},e.areUnitIdsEqual=M,e.areUnitIdsAndIndicesEqual=function E(re,ae){if(re===ae)return!0;if(!M(re,ae))return!1;for(let ge=0,Ie=re.units.length;ge<Ie;ge++)if(!rt.areEqual(re.units[ge].elements,ae.units[ge].elements))return!1;return!0},e.areHierarchiesEqual=function D(re,ae){if(re.hashCode!==ae.hashCode)return!1;const ge=re.models.length;if(ge!==ae.models.length)return!1;for(let Ie=0;Ie<ge;Ie++)if(!Sn.areHierarchiesEqual(re.models[Ie],ae.models[Ie]))return!1;return!0},e.areEquivalent=T,e.areRootsEquivalent=function F(re,ae){return T(re.root,ae.root)},e.areRootsEqual=function R(re,ae){return re.root===ae.root},e.ElementLocationIterator=class N{move(){return this.advance(),this.current.element=this.elements[this.idx],this.current}advance(){if(this.idx<this.maxIdx)return this.idx++,void(this.idx===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length));this.idx=0,this.unitIndex++,this.unitIndex>=this.structure.units.length?this.hasNext=!1:(this.current.unit=this.structure.units[this.unitIndex],this.elements=this.current.unit.elements,this.maxIdx=this.elements.length-1,0===this.maxIdx&&(this.hasNext=this.unitIndex+1<this.structure.units.length))}constructor(ae){this.structure=ae,this.unitIndex=0,this.maxIdx=0,this.idx=-1,this.current=dt.create(ae),this.hasNext=ae.elementCount>0,this.hasNext&&(this.elements=ae.units[0].elements,this.maxIdx=this.elements.length-1,this.current.unit=ae.units[0])}};const j=C();function W(re,ae,ge){const{elements:Ie,conformation:me}=re,Ae=j;let he=Number.MAX_VALUE;for(let ie=0,ue=Ie.length;ie<ue;ie++){const _e=Ie[ie],Fe=C.distance(ae,me.position(_e,Ae))-ge-me.r(_e);Fe<he&&(he=Fe)}return he}function z(re,ae,ge){const{units:Ie}=re;let me=Number.MAX_VALUE;for(let Ae=0,he=Ie.length;Ae<he;Ae++){const ue=W(Ie[Ae],ae,ge);ue<me&&(me=ue)}return me}e.minDistanceToPoint=z;const $=C();function K(re){return re.unitSymmetryGroups.filter(ae=>ae.units[0].polymerElements.length>0)}let Z;var re;e.distance=function V(re,ae){if(0===re.elementCount||0===ae.elementCount)return 0;const{units:ge}=re;let Ie=Number.MAX_VALUE;for(let me=0,Ae=ge.length;me<Ae;me++){const he=ge[me],{elements:ie,conformation:ue}=he;for(let _e=0,Fe=ie.length;_e<Fe;_e++){const Ze=ie[_e],ct=z(ae,ue.position(Ze,$),ue.r(Ze));ct<Ie&&(Ie=ct)}}return Ie},e.elementDescription=function X(re){return 1===re.elementCount?"1 element":`${re.elementCount} elements`},e.validUnitPair=function H(re,ae,ge){return re.masterModel?ae.model===ge.model||ae.model===re.masterModel||ge.model===re.masterModel:ae.model===ge.model},e.eachUnitPair=function oe(re,ae,ge){const{maxRadius:Ie,validUnit:me,validUnitPair:Ae}=ge;if(!re.units.some(ue=>me(ue)))return;const he=re.lookup3d,ie=C();for(const ue of re.units){if(!me(ue))continue;const _e=ue.boundary.sphere;C.transformMat4(ie,_e.center,ue.conformation.operator.matrix);const Fe=he.findUnitIndices(ie[0],ie[1],ie[2],_e.radius+Ie);for(let Ze=0;Ze<Fe.count;Ze++){const ct=re.units[Fe.indices[Ze]];ue.id>=ct.id||!me(ct)||!Ae(ue,ct)||(ct.elements.length>=ue.elements.length?ae(ue,ct):ae(ct,ue))}}},e.eachAtomicHierarchyElement=function te(re,{chain:ae,residue:ge,atom:Ie}){const me=dt.create(re);for(const Ae of re.units){if(0!==Ae.kind)continue;me.unit=Ae;const{elements:he}=Ae,ie=En.transientSegments(Ae.model.atomicHierarchy.chainAtomSegments,he),ue=En.transientSegments(Ae.model.atomicHierarchy.residueAtomSegments,he);for(;ie.hasNext;){const _e=ie.move();if(ae&&(me.element=he[_e.start],ae(me)),ge||Ie)for(ue.setSegment(_e);ue.hasNext;){const Fe=ue.move();if(ge&&(me.element=he[Fe.start],ge(me)),Ie)for(let Ze=Fe.start,ct=Fe.end;Ze<ct;Ze++)me.element=he[Ze],Ie(me)}}}},e.DefaultSizeThresholds={smallResidueCount:10,mediumResidueCount:5e3,largeResidueCount:3e4,highSymmetryUnitCount:10,fiberResidueCount:15},(re=Z=e.Size||(e.Size={}))[re.Small=0]="Small",re[re.Medium=1]="Medium",re[re.Large=2]="Large",re[re.Huge=3]="Huge",re[re.Gigantic=4]="Gigantic",e.getSize=function ee(re,ae={},ge=1){const Ie={...e.DefaultSizeThresholds,...ae};return re.polymerResidueCount>=Ie.largeResidueCount*ge?function G(re,ae){const ge=K(re);return ge.length>=1&&ge[0].units.length>ae.highSymmetryUnitCount}(re,Ie)?Z.Huge:Z.Gigantic:function Q(re,ae){const ge=K(re);return 1===ge.length&&ge[0].units.length>2&&ge[0].units[0].polymerElements.length<ae.fiberResidueCount}(re,Ie)||re.polymerResidueCount<Ie.smallResidueCount*ge?Z.Small:re.polymerResidueCount<Ie.mediumResidueCount*ge?Z.Medium:Z.Large},e.Index=iy.createSimple("index","root"),e.MaxIndex=iy.createSimple("max_index","root");const se="__PrincipalAxes__";e.getPrincipalAxes=function xe(re){if(re.currentPropertyData[se])return re.currentPropertyData[se];const ae=Me.getPrincipalAxes(e.toStructureElementLoci(re));return re.currentPropertyData[se]=ae,ae}}(Xe||(Xe={}));const qVe=va.diff;function Me(e,t){return{kind:"element-loci",structure:e,elements:t}}var Wh,f_,yp;!function(e){function r(se){for(const xe of se.elements)if(Ve.size(xe.indices)>0)return!1;return!0}function o(se){let xe=0;for(const{indices:re}of se.elements)xe+="number"==typeof re?qVe(re):re.length;return xe}function c(se){return r(se)?se:e(se.structure,[{unit:se.elements[0].unit,indices:Ve.ofSingleton(Ve.start(se.elements[0].indices))}])}function _(se){return se.length>3&&rt.isRange(se)?Pe.ofRange(se[0],se[se.length-1]):rt.ofSortedArray(se)}function w(se,xe){const re=[],ae=new Set;for(const ge of se.elements)if(M(ge))re[re.length]=ge;else if(0===ge.unit.kind){const Ie=ge.unit.elements,me=ge.unit.model.atomicHierarchy,{label_alt_id:Ae}=ge.unit.model.atomicHierarchy.atoms,{index:he,offsets:ie}=me.residueAtomSegments,ue=[],_e=ge.indices,Fe=Ve.size(_e);let Ze=0;for(;Ze<Fe;){ae.clear();const ct=Ie[Ve.getAt(_e,Ze)],q=he[ct];for(ae.add(Ae.value(ct)),Ze++;Ze<Fe;){const be=Ie[Ve.getAt(_e,Ze)];if(he[be]!==q)break;ae.add(Ae.value(be)),Ze++}const ne=ae.has("");for(let be=ie[q],Ce=ie[q+1];be<Ce;be++){const Re=Ve.indexOf(Ie,be);if(Re>=0){const Be=Ae.value(be);(!xe||ne||!Be||ae.has(Be))&&(ue[ue.length]=Re)}}}re[re.length]={unit:ge.unit,indices:_(ue)}}else re[re.length]=ge;return e(se.structure,re)}function A(se){switch(se.kind){case 0:return se.model.atomicHierarchy.chainAtomSegments;case 1:return se.model.coarseHierarchy.spheres.chainElementSegments;case 2:return se.model.coarseHierarchy.gaussians.chainElementSegments}}function M(se){return se.unit.elements.length===Ve.size(se.indices)}function E(se,xe,re){const{index:ae}=A(se),ge=se.elements;let Ie=0;for(let Ae=0,he=ge.length;Ae<he;Ae++)xe.has(ae[ge[Ae]])&&Ie++;if(Ie===se.elements.length)return void(re[re.length]={unit:se,indices:Pe.ofBounds(0,Ie)});const me=new Int32Array(Ie);Ie=0;for(let Ae=0,he=ge.length;Ae<he;Ae++)xe.has(ae[ge[Ae]])&&(me[Ie++]=Ae);me.length>0&&(re[re.length]={unit:se,indices:_(me)})}function D(se,xe,re,ae,ge){const{index:Ie}=A(se.elements[0].unit),me=new Set;for(let Ae=xe;Ae<re;Ae++){const he=se.elements[Ae],ie=he.indices,ue=he.unit.elements;for(let _e=0,Fe=Ve.size(ie);_e<Fe;_e++)me.add(Ie[ue[Ve.getAt(ie,_e)]])}if(ae){const Ae=se.elements[0].unit;for(const he of se.structure.units)ze.areSameChainOperatorGroup(he,Ae)&&E(he,me,ge)}else for(let Ae=xe;Ae<re;Ae++)E(se.elements[Ae].unit,me,ge)}function T(se){const xe=[];for(let re=0,ae=se.elements.length;re<ae;re++){const ge=se.elements[re];if(ze.Traits.is(ge.unit.traits,ze.Trait.Partitioned)){const Ie=re;for(;re<ae&&ze.areSameChainOperatorGroup(se.elements[re].unit,ge.unit);)re++;const me=re;re--,D(se,Ie,me,!0,xe)}else M(ge)?xe[xe.length]=ge:D(se,re,re+1,!1,xe)}return e(se.structure,xe)}function F(se){return`${se.unit.model.id}|${Je.entity.id(se)}`}function j(se,xe){const re=[];for(let ae=0,ge=Ve.size(xe);ae<ge;++ae)re.push(se[Ve.getAt(xe,ae)]);return rt.ofSortedArray(re)}function W(se,xe){return rt.isRange(se)&&rt.areEqual(se,xe)?Pe.ofLength(se.length):_(rt.indicesOf(se,xe))}e.is=function t(se){return!!se&&"element-loci"===se.kind},e.areEqual=function n(se,xe){if(se.structure!==xe.structure||se.elements.length!==xe.elements.length)return!1;for(let re=0,ae=se.elements.length;re<ae;++re){const ge=se.elements[re],Ie=xe.elements[re];if(ge.unit.id!==Ie.unit.id||!Ve.areEqual(ge.indices,Ie.indices))return!1}return!0},e.isEmpty=r,e.isWholeStructure=function i(se){return o(se)===se.structure.elementCount},e.size=o,e.all=function s(se){return e(se,se.units.map(xe=>({unit:xe,indices:Ve.ofBounds(0,xe.elements.length)})))},e.none=function a(se){return e(se,[])},e.getFirstLocation=function l(se,xe){if(r(se))return;const re=se.elements[0].unit,ae=re.elements[Ve.getAt(se.elements[0].indices,0)];return xe?(xe.structure=se.structure,xe.unit=se.elements[0].unit,xe.element=ae,xe):dt.create(se.structure,re,ae)},e.firstElement=c,e.firstResidue=function u(se){return r(se)?se:w(c(se))},e.firstChain=function d(se){return r(se)?se:T(c(se))},e.toStructure=function f(se){const xe=[];for(const re of se.elements){const{unit:ae,indices:ge}=re,Ie=new Int32Array(Ve.size(ge));Ve.forEach(ge,(me,Ae)=>Ie[Ae]=ae.elements[me]),xe.push(ae.getChild(rt.ofSortedArray(Ie)))}return Xe.create(xe,{parent:se.structure.parent})},e.forEachLocation=function p(se,xe){if(e.isEmpty(se))return;const re=dt.create(se.structure);for(const ae of se.elements){const{unit:ge,indices:Ie}=ae;re.unit=ge;const{elements:me}=ae.unit;for(let Ae=0,he=Ve.size(Ie);Ae<he;Ae++)re.element=me[Ve.getAt(Ie,Ae)],xe(re)}},e.remap=function m(se,xe){if(xe===se.structure)return se;const re=[];return se.elements.forEach(ae=>{if(!xe.unitMap.has(ae.unit.id))return;const ge=xe.unitMap.get(ae.unit.id),Ie=Ve.indexedIntersect(ae.indices,ae.unit.elements,ge.elements);Ve.size(Ie)>0&&re.push({unit:ge,indices:Ie})}),e(xe,re)},e.union=function h(se,xe){if(se.elements.length>xe.elements.length)return h(xe,se);if(e.isEmpty(se))return xe;const re=new Map;for(const ge of se.elements)re.set(ge.unit.id,ge.indices);const ae=[];for(const ge of xe.elements)re.has(ge.unit.id)?(ae[ae.length]={unit:ge.unit,indices:Ve.union(re.get(ge.unit.id),ge.indices)},re.delete(ge.unit.id)):ae[ae.length]=ge;return re.forEach((ge,Ie)=>{ae[ae.length]={unit:se.structure.unitMap.get(Ie),indices:ge}}),e(se.structure,ae)},e.subtract=function g(se,xe){const re=new Map;for(const ge of xe.elements)re.set(ge.unit.id,ge.indices);const ae=[];for(const ge of se.elements)if(re.has(ge.unit.id)){const Ie=Ve.subtract(ge.indices,re.get(ge.unit.id));if(0===Ve.size(Ie))continue;ae[ae.length]={unit:ge.unit,indices:Ie}}else ae[ae.length]=ge;return e(se.structure,ae)},e.intersect=function y(se,xe){const re=new Map;for(const ge of se.elements)re.set(ge.unit.id,ge.indices);const ae=[];for(const ge of xe.elements){if(!re.has(ge.unit.id))continue;const Ie=Ve.intersect(re.get(ge.unit.id),ge.indices);0!==Ve.size(Ie)&&(ae[ae.length]={unit:ge.unit,indices:Ie})}return e(se.structure,ae)},e.areIntersecting=function v(se,xe){if(se.elements.length>xe.elements.length)return v(xe,se);if(e.isEmpty(se))return e.isEmpty(xe);const re=new Map;for(const ae of se.elements)re.set(ae.unit.id,ae.indices);for(const ae of xe.elements)if(re.has(ae.unit.id)&&Ve.areIntersecting(re.get(ae.unit.id),ae.indices))return!0;return!1},e.isSubset=function x(se,xe){if(e.isEmpty(se))return e.isEmpty(xe);const re=new Map;for(const ge of se.elements)re.set(ge.unit.id,ge.indices);let ae=!1;for(const ge of xe.elements)if(re.has(ge.unit.id)){if(!Ve.isSubset(re.get(ge.unit.id),ge.indices))return!1;ae=!0}return ae},e.extendToWholeResidues=w,e.extendToWholeChains=T,e.extendToWholeEntities=function R(se){const xe=[],re=dt.create(se.structure),ae=new Set,{units:ge}=se.structure;for(let Ie=0,me=se.elements.length;Ie<me;Ie++){const Ae=se.elements[Ie];re.unit=Ae.unit,re.element=Ae.unit.elements[0],ae.add(F(re))}for(let Ie=0,me=ge.length;Ie<me;++Ie){const Ae=ge[Ie];if(re.unit=Ae,re.element=Ae.elements[0],ae.has(F(re))){const he=Ve.ofBounds(0,Ae.elements.length);xe[xe.length]={unit:Ae,indices:he}}}return e(se.structure,xe)},e.extendToWholeModels=function N(se){const xe=[],re=new Set,{units:ae}=se.structure;for(let ge=0,Ie=se.elements.length;ge<Ie;ge++)re.add(se.elements[ge].unit.model.id);for(let ge=0,Ie=ae.length;ge<Ie;++ge){const me=ae[ge];if(re.has(me.model.id)){const Ae=Ve.ofBounds(0,me.elements.length);xe[xe.length]={unit:me,indices:Ae}}}return e(se.structure,xe)},e.extendToAllInstances=function z(se){const xe=[],re=new Map;for(let ae=0,ge=se.elements.length;ae<ge;ae++){const Ie=se.elements[ae],{model:me}=Ie.unit,Ae=j(Ie.unit.elements,Ie.indices);re.has(me)?re.set(me,rt.union(Ae,re.get(me))):re.set(me,Ae)}for(let ae=0,ge=se.structure.units.length;ae<ge;++ae){const Ie=se.structure.units[ae],me=re.get(Ie.model);if(!me)continue;const Ae=W(Ie.elements,me);Ve.size(Ae)&&(xe[xe.length]={unit:Ie,indices:Ae})}return e(se.structure,xe)},e.extendToWholeOperators=function $(se){const xe=[],re=new Set,{units:ae}=se.structure;for(let ge=0,Ie=se.elements.length;ge<Ie;ge++)re.add(se.elements[ge].unit.conformation.operator.name);for(let ge=0,Ie=ae.length;ge<Ie;++ge){const me=ae[ge];if(re.has(me.conformation.operator.name)){const Ae=Ve.ofBounds(0,me.elements.length);xe[xe.length]={unit:me,indices:Ae}}}return e(se.structure,xe)};const V=new xf("98"),X=C();e.getBoundary=function H(se,xe){V.reset();for(const re of se.elements){const{indices:ae}=re,{elements:ge,conformation:Ie}=re.unit;for(let me=0,Ae=Ve.size(ae);me<Ae;me++){const he=ge[Ve.getAt(ae,me)];Ie.position(he,X),xe&&C.transformMat4(X,X,xe),V.includePositionRadius(X,Ie.r(he))}}V.finishedIncludeStep();for(const re of se.elements){const{indices:ae}=re,{elements:ge,conformation:Ie}=re.unit;for(let me=0,Ae=Ve.size(ae);me<Ae;me++){const he=ge[Ve.getAt(ae,me)];Ie.position(he,X),xe&&C.transformMat4(X,X,xe),V.radiusPositionRadius(X,Ie.r(he))}}return{box:V.getBox(),sphere:V.getSphere()}};const oe=C();function te(se,xe,re=0){let ae=re;for(const ge of se.elements){const{indices:Ie}=ge,{elements:me,conformation:Ae}=ge.unit,he=Ve.size(Ie);for(let ie=0;ie<he;ie++){const ue=me[Ve.getAt(Ie,ie)];Ae.position(ue,oe),C.toArray(oe,xe,ae+3*ie)}ae+=3*he}return xe}function G(se,xe){return ze.isAtomic(se)?se.model.atomicHierarchy.atomSourceIndex.value(xe):xe}function ee(se,xe,re,ae,ge){ip(xe);const Ie=[],me=[];let Ae=0;const he=xe.length;for(;Ae<he;){const ie=Ae;for(Ae++;Ae<he&&xe[Ae-1]+1===xe[Ae];)Ae++;const ue=Ae;if(ue-ie>12)Ie[Ie.length]=xe[ie],Ie[Ie.length]=xe[ue-1];else for(let _e=ie;_e<ue;_e++)me[me.length]=xe[_e]}return re?{atom:{set:me,ranges:Ie},chain:{opName:[se]},entity:{modelLabel:ae,modelIndex:ge}}:{atom:{set:me,ranges:Ie},chain:{opName:[se]}}}e.toPositionsArray=te,e.getPrincipalAxes=function K(se){const xe=o(se),re=te(se,new Float32Array(3*xe));return Uh.ofPositions(re)},e.getPrincipalAxesMany=function Q(se){let xe=0;se.forEach(ge=>{xe+=o(ge)});const re=new Float32Array(3*xe);let ae=0;return se.forEach(ge=>{te(ge,re,ae),ae+=3*o(ge)}),Uh.ofPositions(re)},e.toExpression=function Z(se){if(e.isEmpty(se))return pe.struct.generator.empty();const xe=se.structure.models,re=new Map;for(const Ae of se.elements){const{indices:he}=Ae,{elements:ie}=Ae.unit,ue=Ae.unit.conformation.operator.name;let _e;re.has(ue)?_e=re.get(ue).xs:(_e=Ti.create(),re.set(ue,{modelLabel:Ae.unit.model.label,modelIndex:Ae.unit.model.modelNum,xs:_e}));for(let Fe=0,Ze=Ve.size(he);Fe<Ze;Fe++){const ct=G(Ae.unit,ie[Ve.getAt(he,Fe)]);Ti.add(_e,ct,ct)}}const ae=[],ge=re.keys();for(;;){const Ae=ge.next();if(Ae.done)break;const he=re.get(Ae.value);ae.push(ee(Ae.value,he.xs.array,xe.length>1,he.modelLabel,he.modelIndex))}const Ie=new Map;for(let Ae=0,he=ae.length;Ae<he;++Ae){const ie=ae[Ae],_e=`${Yx(Zc(ie.atom.ranges),Zc(ie.atom.set))}|${ie.entity?ie.entity.modelLabel+ie.entity.modelIndex:""}`;Ie.has(_e)?Ie.get(_e).chain.opName.push(...ie.chain.opName):Ie.set(_e,ie)}const me=[];return Ie.forEach(Ae=>{const{ranges:he,set:ie}=Ae.atom,{opName:ue}=Ae.chain,_e=pe.struct.atomProperty.core.operatorName(),Fe=pe.struct.atomProperty.core.sourceIndex(),Ze=[];ie.length>0&&(Ze[Ze.length]=pe.core.set.has([pe.core.type.set(ie),Fe]));for(let ct=0,q=he.length/2;ct<q;ct++)Ze[Ze.length]=pe.core.rel.inRange([Fe,he[2*ct],he[2*ct+1]]);if(Ae.entity){const{modelLabel:ct,modelIndex:q}=Ae.entity;me.push(pe.struct.generator.atomGroups({"atom-test":Ze.length>1?pe.core.logic.or(Ze):Ze[0],"chain-test":ue.length>1?pe.core.set.has([pe.core.type.set(ue),_e]):pe.core.rel.eq([_e,ue[0]]),"entity-test":pe.core.logic.and([pe.core.rel.eq([pe.struct.atomProperty.core.modelLabel(),ct]),pe.core.rel.eq([pe.struct.atomProperty.core.modelIndex(),q])])}))}else me.push(pe.struct.generator.atomGroups({"atom-test":Ze.length>1?pe.core.logic.or(Ze):Ze[0],"chain-test":ue.length>1?pe.core.set.has([pe.core.type.set(ue),_e]):pe.core.rel.eq([_e,ue[0]])}))}),pe.struct.modifier.union([1===me.length?me[0]:pe.struct.combinator.merge(me.map(Ae=>pe.struct.modifier.union([Ae])))])}}(Me||(Me={})),function(e){function t(){return{elementCount:0,conformationCount:0,residueCount:0,chainCount:0,unitCount:0,structureCount:0,firstElementLoc:dt.create(void 0),firstConformationLoc:dt.create(void 0),firstResidueLoc:dt.create(void 0),firstChainLoc:dt.create(void 0),firstUnitLoc:dt.create(void 0),firstStructureLoc:dt.create(void 0)}}function n(l,c,u){const d=l.get(c)||0;l.set(c,d+u)}function r(l,c,u){const{indices:d,unit:f}=u,{elements:p}=f,m=Ve.size(d),h=new Map,g=new Map;if(m>0&&dt.set(l.firstElementLoc,c,f,p[Ve.start(d)]),m===p.length)l.unitCount+=1,1===l.unitCount&&dt.set(l.firstUnitLoc,c,f,p[Ve.start(d)]);else if(1===m){if(ze.Traits.is(f.traits,ze.Trait.MultiChain))return;l.elementCount+=1,1===l.elementCount&&dt.set(l.firstElementLoc,c,f,p[Ve.start(d)])}else if(ze.isAtomic(f)){const{index:y,offsets:v}=f.model.atomicHierarchy.residueAtomSegments,{label_alt_id:x}=f.model.atomicHierarchy.atoms;let _=0;for(;_<m;){h.clear();let w=0;const A=p[Ve.getAt(d,_)],M=y[A];for(n(h,x.value(A),1),++_,++w;_<m;){const E=p[Ve.getAt(d,_)];if(y[E]!==M)break;n(h,x.value(E),1),++_,++w}if(v[M+1]-v[M]===w)l.residueCount+=1,1===l.residueCount&&dt.set(l.firstResidueLoc,c,f,v[M]);else{g.clear();for(let E=v[M],D=v[M+1];E<D;++E)n(g,x.value(E),1);g.get("")===h.get("")&&h.forEach((E,D)=>{if(g.get(D)===E){if(""!==D&&(l.conformationCount+=1,1===l.conformationCount))for(let T=v[M],F=v[M+1];T<F;++T)if(D===x.value(T)){dt.set(l.firstConformationLoc,c,f,T);break}w-=E}}),l.elementCount+=w}}}else l.elementCount+=m,1===l.elementCount&&dt.set(l.firstElementLoc,c,f,p[Ve.start(d)])}function i(l,c,u){const{indices:d,unit:f}=u,p=Ve.size(d);if(0===p)return;const{elements:m}=f;if(!ze.Traits.is(f.traits,ze.Trait.MultiChain))return void(p===m.length&&(l.chainCount+=1,1===l.chainCount&&dt.set(l.firstChainLoc,c,f,m[Ve.start(d)])));const h=ze.isAtomic(f)?f.model.atomicHierarchy.chainAtomSegments:ze.isSpheres(f)?f.model.coarseHierarchy.spheres.chainElementSegments:ze.isGaussians(f)?f.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!h)return void console.warn("StructureElement loci stats: unknown unit type");const{index:g,offsets:y}=h;let v=0;for(;v<p;){let x=0;const _=m[Ve.getAt(d,v)],w=g[_];for(++v,++x;v<p&&g[m[Ve.getAt(d,v)]]===w;)++v,++x;y[w+1]-y[w]===x?(l.chainCount+=1,1===l.chainCount&&dt.set(l.firstChainLoc,c,f,y[w])):1===p&&(l.elementCount+=1,1===l.elementCount&&dt.set(l.firstElementLoc,c,f,_))}}function o(l,c,u,d,f){let p=u[d];const m=ze.isAtomic(p.unit)?p.unit.model.atomicHierarchy.chainAtomSegments:ze.isSpheres(p.unit)?p.unit.model.coarseHierarchy.spheres.chainElementSegments:ze.isGaussians(p.unit)?p.unit.model.coarseHierarchy.gaussians.chainElementSegments:void 0;if(!m)return void console.warn("StructureElement loci stats: unknown unit type");const{index:h,offsets:g}=m,y=new Map;for(let x=d;x<f;x++){p=u[x];const{indices:_,unit:w}=p,A=Ve.size(_);if(0===A)continue;const{elements:M}=w;if(!ze.Traits.is(w.traits,ze.Trait.MultiChain)){n(y,h[M[Ve.start(_)]],M.length);continue}let E=0;for(;E<A;){let D=0;const F=h[M[Ve.getAt(_,E)]];for(++E,++D;E<A&&h[M[Ve.getAt(_,E)]]===F;)++E,++D;n(y,F,D)}}let v=-1;if(y.forEach((x,_)=>{g[_+1]-g[_]===x&&(l.chainCount+=1,1===l.chainCount&&(v=_))}),!(v<0))for(let x=d;x<f;x++){p=u[x];const{indices:_,unit:w}=p,A=Ve.size(_);if(0===A)continue;const{elements:M}=w,E=0;for(;E<A;){const D=M[Ve.getAt(_,E)];if(h[D]===v)return void dt.set(l.firstChainLoc,c,w,D)}}}e.create=t,e.ofLoci=function s(l){const c=t();if(Me.isEmpty(l))return c;let u=!1;if(Me.isWholeStructure(l)){if(c.structureCount+=1,1===c.structureCount){const{unit:d,indices:f}=l.elements[0];dt.set(c.firstStructureLoc,l.structure,d,d.elements[Ve.min(f)])}}else for(const d of l.elements)r(c,l.structure,d),ze.Traits.is(d.unit.traits,ze.Trait.Partitioned)?u=!0:i(c,l.structure,d);if(u)for(let d=0,f=l.elements.length;d<f;d++){const p=l.elements[d];if(!ze.Traits.is(p.unit.traits,ze.Trait.Partitioned))continue;const m=d;for(;d<f&&ze.areSameChainOperatorGroup(l.elements[d].unit,p.unit);)d++;const h=d;d--,h-m==1?i(c,l.structure,p):o(c,l.structure,l.elements,m,h)}return c},e.add=function a(l,c,u){return 1===c.elementCount&&0===u.elementCount?dt.copy(l.firstElementLoc,c.firstElementLoc):0===c.elementCount&&1===u.elementCount&&dt.copy(l.firstElementLoc,u.firstElementLoc),1===c.conformationCount&&0===u.conformationCount?dt.copy(l.firstConformationLoc,c.firstConformationLoc):0===c.conformationCount&&1===u.conformationCount&&dt.copy(l.firstConformationLoc,u.firstConformationLoc),1===c.residueCount&&0===u.residueCount?dt.copy(l.firstResidueLoc,c.firstResidueLoc):0===c.residueCount&&1===u.residueCount&&dt.copy(l.firstResidueLoc,u.firstResidueLoc),1===c.chainCount&&0===u.chainCount?dt.copy(l.firstChainLoc,c.firstChainLoc):0===c.chainCount&&1===u.chainCount&&dt.copy(l.firstChainLoc,u.firstChainLoc),1===c.unitCount&&0===u.unitCount?dt.copy(l.firstUnitLoc,c.firstUnitLoc):0===c.unitCount&&1===u.unitCount&&dt.copy(l.firstUnitLoc,u.firstUnitLoc),1===c.structureCount&&0===u.structureCount?dt.copy(l.firstStructureLoc,c.firstStructureLoc):0===c.structureCount&&1===u.structureCount&&dt.copy(l.firstStructureLoc,u.firstStructureLoc),l.elementCount=c.elementCount+u.elementCount,l.conformationCount=c.conformationCount+u.conformationCount,l.residueCount=c.residueCount+u.residueCount,l.chainCount=c.chainCount+u.chainCount,l.unitCount=c.unitCount+u.unitCount,l.structureCount=c.structureCount+u.structureCount,l}}(Wh||(Wh={})),function(e){function t(r){const i=r.descriptor.name,o="static"===r.type?"_staticPropertyData":"_dynamicPropertyData",s=l=>(i in l[o]||(l[o][i]={props:{...I.getDefaultValues(r.getParams(l))},data:f1.create(void 0)}),l[o][i]),a=(l,c,u)=>{const d=s(l);l[o][i]={props:c,data:f1.withValue(d.data,u)}};return{label:r.label,descriptor:r.descriptor,isHidden:r.isHidden,getParams:l=>{const c=I.clone(r.getParams(l));return I.setDefaultValues(c,s(l).props),c},defaultParams:r.defaultParams,isApplicable:r.isApplicable,attach:(l=le(function*(c,u,d={},f){f&&u.customProperties.reference(r.descriptor,!0);const p=s(u),m=I.merge(r.defaultParams,p.props,d);if(p.data.value&&I.areEqual(r.defaultParams,p.props,m))return;const{value:h,assets:g}=yield r.obtain(c,u,m);u.customProperties.add(r.descriptor),u.customProperties.assets(r.descriptor,g),a(u,m,h)}),function(u,d){return l.apply(this,arguments)}),ref:(l,c)=>l.customProperties.reference(r.descriptor,c),get:l=>{var c;return null===(c=s(l))||void 0===c?void 0:c.data},set:(l,c={},u)=>{const d=s(l),f=I.merge(r.defaultParams,d.props,c);I.areEqual(r.defaultParams,d.props,f)||(a(l,f,u),l.customProperties.assets(r.descriptor))},props:l=>s(l).props};var l}e.createProvider=t,e.createSimple=function n(r,i,o){const s={value:I.Value(o,{isHidden:!0})};return t({label:yf(r),descriptor:hf({name:r}),isHidden:!0,type:i,defaultParams:s,getParams:()=>({value:I.Value(o,{isHidden:!0})}),isApplicable:()=>!0,obtain:(a=le(function*(l,c,u){return{...I.getDefaultValues(s),...u}}),function(c,u,d){return a.apply(this,arguments)})});var a}}(f_||(f_={})),function(e){var o;function t(o){if(!Ui.is(o.sourceData))return!1;const{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:a,pdbx_sifts_xref_db_num:l,pdbx_sifts_xref_db_res:c}=o.sourceData.data.db.atom_site;return s.isDefined&&a.isDefined&&l.isDefined&&c.isDefined}function i(o){if(!Ui.is(o.sourceData))return;const{pdbx_sifts_xref_db_name:s,pdbx_sifts_xref_db_acc:a,pdbx_sifts_xref_db_num:l,pdbx_sifts_xref_db_res:c}=o.sourceData.data.db.atom_site;if(!(s.isDefined&&a.isDefined&&l.isDefined&&c.isDefined))return;const{atomSourceIndex:u}=o.atomicHierarchy,{count:d,offsets:f}=o.atomicHierarchy.residueAtomSegments,p=new Array(d),m=new Array(d),h=new Array(d),g=new Array(d);for(let y=0;y<d;y++){const v=u.value(f[y]);0===s.valueKind(v)?(p[y]=s.value(v),m[y]=a.value(v),h[y]=l.value(v),g[y]=c.value(v)):(p[y]="",m[y]="",h[y]="",g[y]="")}return{dbName:p,accession:m,num:h,residue:g}}e.Provider=f_.createProvider({label:"SIFTS Mapping",descriptor:hf({name:"sifts_sequence_mapping"}),type:"static",defaultParams:{},getParams:()=>({}),isApplicable:o=>t(o),obtain:(o=le(function*(s,a){return{value:i(a)}}),function(a,l){return o.apply(this,arguments)})}),e.isAvailable=t,e.getKey=function n(o){const s=o.unit.model,a=e.Provider.get(s).value;return a?a.accession[s.atomicHierarchy.residueAtomSegments.index[o.element]]:""},e.getLabel=function r(o){const s=o.unit.model,a=e.Provider.get(s).value;if(!a)return;const l=s.atomicHierarchy.residueAtomSegments.index[o.element],c=a.dbName[l];return c?`${c} ${a.accession[l]} ${a.num[l]} ${a.residue[l]}`:void 0}}(yp||(yp={}));function X3(e,t){if(Ui.is(e.sourceData))return e.sourceData.data.db[t]}function mle(e){if(0===e.length)return[];if(1===e.length)return e[0].entityIndices;const t=Ti.create();for(const n of e)for(const r of n.entityIndices)Ti.add(t,r,r);return ip(t.array),t.array}function vp(e,t){return{name:e,instance({structures:n}){if(t&&!t(n[0]))return us.Category.Empty;const r=n[0].model;if(!Ui.is(r.sourceData))return us.Category.Empty;const i=r.sourceData.data.db[e];return i&&i._rowCount?us.Category.ofTable(i):us.Category.Empty}}}var gle=us.Category;C7("struct_asym"),C7("entity_poly"),C7("entity_poly_seq");function C7(e){return{name:e,instance:({structures:t,cache:n})=>function p9e(e,t,n){const r=X3(e[0].model,t);if(!r)return gle.Empty;const{entity_id:i}=r,o=n.uniqueEntityIds||(n.uniqueEntityIds=function i9e(e){if(0===e.length)return new Set;const t=e[0].model.entities.data.id;return new Set(mle(e).map(n=>t.value(n)))}(e)),s=ce.indicesOf(i,a=>o.has(a));return gle.ofTable(r,s)}(t,e,n)}}var w7;!function(e){e.create=function t(n){const r=Array.isArray(n)?n:[n];return{structures:r,firstModel:r[0].model,cache:Object.create(null)}}}(w7||(w7={}));function A7(e){return e.units.every(t=>t.conformation.operator.isIdentity)}function I7(e){return A7(e)&&e.units.every(t=>!t.conformation.operator.assembly&&!t.conformation.operator.suffix)}var E7;vp("entry"),vp("exptl"),vp("cell",A7),vp("symmetry",A7),vp("pdbx_struct_assembly",I7),vp("pdbx_struct_assembly_gen",I7),vp("pdbx_struct_oper_list",I7),vp("pdbx_entity_branch"),vp("pdbx_entity_branch_link"),vp("pdbx_branch_scheme"),vp("struct_conn"),vp("atom_sites"),function(e){e.AtomSitePositionsFieldNames=new Set(["id","Cartn_x","Cartn_y","Cartn_z"])}(E7||(E7={}));const v9e={molstar_atom_site_operator_mapping:{label_asym_id:ce.Schema.Str(),auth_asym_id:ce.Schema.Str(),operator_name:ce.Schema.Str(),suffix:ce.Schema.Str(),assembly_id:ce.Schema.Str(),assembly_operator_id:ce.Schema.Int(),symmetry_operator_index:ce.Schema.Int(),symmetry_hkl:ce.Schema.Vector(3),ncs_id:ce.Schema.Int()}},ble=(e,t)=>typeof t[e].operator.assembly>"u"?1:0,T7=(e,t)=>-1===t[e].operator.spgrOp?1:0;function Aw(e,t){return t?1===t.length?gf(t.charCodeAt(0),e):2===t.length?gf(t.charCodeAt(0),gf(t.charCodeAt(1),e)):`${e} ${t}`:e}function w9e(e,t,n,r){if(e.has(t)){const i=e.get(t);i.has(n)||i.set(n,r)}else{const i=new Map;e.set(t,i),i.set(n,r)}}function A9e(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}us.fields().str("label_asym_id",(e,t)=>t[e].label_asym_id).str("auth_asym_id",(e,t)=>t[e].auth_asym_id).str("operator_name",(e,t)=>t[e].operator.name).str("suffix",(e,t)=>t[e].operator.suffix).str("assembly_id",(e,t)=>{var n;return(null===(n=t[e].operator.assembly)||void 0===n?void 0:n.id)||""},{valueKind:ble}).int("assembly_operator_id",(e,t)=>{var n;return(null===(n=t[e].operator.assembly)||void 0===n?void 0:n.operId)||0},{valueKind:ble}).int("symmetry_operator_index",(e,t)=>t[e].operator.spgrOp,{valueKind:T7}).vec("symmetry_hkl",[(e,t)=>t[e].operator.hkl[0],(e,t)=>t[e].operator.hkl[1],(e,t)=>t[e].operator.hkl[2]],{valueKind:T7}).int("ncs_id",(e,t)=>t[e].operator.ncsId,{valueKind:T7}).getFields();const K3=Lz.EmptyResidueKey();class E9e{getEntityFromChain(t){return this.map.chain_index_entity_index[t]}findEntity(t){const n=this.map.label_asym_id.get(t);return void 0!==n?n:-1}findChainLabel(t){const n=this.entityIndex(t.label_entity_id);if(n<0||!this.map.entity_index_label_asym_id.has(n))return-1;const r=this.map.entity_index_label_asym_id.get(n);return r&&r.has(t.label_asym_id)?r.get(t.label_asym_id):-1}findChainAuth(t){if(!this.map.auth_asym_id_auth_seq_id.has(t.auth_asym_id))return-1;const n=this.map.auth_asym_id_auth_seq_id.get(t.auth_asym_id);return n.has(t.auth_seq_id)?n.get(t.auth_seq_id):-1}findResidue(t,n,r,i){let o;1===arguments.length?o=t:(K3.label_entity_id=t,K3.label_asym_id=n,K3.auth_seq_id=r,K3.pdbx_PDB_ins_code=i,o=K3);const s=this.findChainLabel(o);if(s<0)return-1;const a=this.map.chain_index_auth_seq_id.get(s),l=Aw(o.auth_seq_id,o.pdbx_PDB_ins_code||"");return a.has(l)?a.get(l):-1}findResidueLabel(t){const n=this.findChainLabel(t);if(n<0)return-1;const r=this.map.chain_index_label_seq_id.get(n),i=Aw(t.label_seq_id,t.pdbx_PDB_ins_code||"");return r.has(i)?r.get(i):-1}findResidueAuth(t){const n=this.findChainAuth(t);if(n<0)return-1;const r=this.map.chain_index_auth_seq_id.get(n),i=Aw(t.auth_seq_id,t.pdbx_PDB_ins_code||"");return r.has(i)?r.get(i):-1}findResidueInsertion(t){const n=this.findChainLabel(t);if(n<0)return-1;const r=this.map.chain_index_label_seq_id.get(n),i=Aw(t.label_seq_id,t.pdbx_PDB_ins_code||"");if(r.has(i))return r.get(i);const o=rt.findPredecessorIndex(this.map.label_seq_id,t.label_seq_id),s=i_.chainStartResidueIndex(this.map.segments,n);if(o<s)return s;const a=i_.chainEndResidueIndexExcl(this.map.segments,n)-1;return o>=a?a:o}findAtom(t){const n=this.findResidue(t);return n<0?-1:typeof t.label_alt_id>"u"?D7(this.residueOffsets[n],this.residueOffsets[n+1],this.map.label_atom_id,t.label_atom_id):P7(this.residueOffsets[n],this.residueOffsets[n+1],this.map.label_atom_id,this.map.label_alt_id,t.label_atom_id,t.label_alt_id)}findAtomAuth(t){const n=this.findResidueAuth(t);return n<0?-1:typeof t.label_alt_id>"u"?D7(this.residueOffsets[n],this.residueOffsets[n+1],this.map.auth_atom_id,t.auth_atom_id):P7(this.residueOffsets[n],this.residueOffsets[n+1],this.map.auth_atom_id,this.map.label_alt_id,t.auth_atom_id,t.label_alt_id)}findAtomOnResidue(t,n,r){return typeof r>"u"?D7(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,n):P7(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,this.map.label_alt_id,n,r)}findAtomsOnResidue(t,n){return function T9e(e,t,n,r){for(let i=e;i<t;i++)if(r.has(n.value(i)))return i;return-1}(this.residueOffsets[t],this.residueOffsets[t+1],this.map.label_atom_id,n)}findElementOnResidue(t,n){return function D9e(e,t,n,r){for(let i=e;i<t;i++)if(n.value(i)===r)return i;return-1}(this.residueOffsets[t],this.residueOffsets[t+1],this.map.type_symbol,n)}constructor(t){this.map=t,this.entityIndex=t.entities.getEntityIndex,this.residueOffsets=this.map.segments.residueAtomSegments.offsets}}function D7(e,t,n,r){for(let i=e;i<t;i++)if(n.value(i)===r)return i;return-1}function P7(e,t,n,r,i,o){for(let s=e;s<t;s++)if(n.value(s)===i&&r.value(s)===o)return s;return-1}function O9e(e,t,n,r,i,o){const s=function k9e(e){if(0===e._rowCount)return{residues:[],chains:[]};const n=e._rowCount,r=[0],i=[0],{label_entity_id:o,label_asym_id:s,label_seq_id:a,auth_seq_id:l,pdbx_PDB_ins_code:c}=e;for(let u=1;u<n;u++){const d=!o.areValuesEqual(u-1,u)||!s.areValuesEqual(u-1,u);(d||!a.areValuesEqual(u-1,u)||!l.areValuesEqual(u-1,u)||!c.areValuesEqual(u-1,u))&&(r[r.length]=u),d&&(i[i.length]=u)}return{residues:r,chains:i}}(e),a=function M9e(e,t,n){const r=Kr.ofColumns(OUe,{type_symbol:ce.ofArray({array:ce.mapToArray(e.type_symbol,Jx),schema:ce.Schema.Aliased(ce.Schema.str)}),label_atom_id:e.label_atom_id,auth_atom_id:e.auth_atom_id,label_alt_id:e.label_alt_id,label_comp_id:e.label_comp_id,auth_comp_id:e.auth_comp_id,pdbx_formal_charge:e.pdbx_formal_charge}),i=Kr.view(e,BUe,n.residues),o=Kr.view(e,LUe,n.chains);if(!i.label_seq_id.isDefined){const s=new Int32Array(i.label_seq_id.rowCount),{residues:a,chains:l}=n;let c=0,u=0;for(let d=0,f=s.length;d<f;++d)a[d]>=l[c+1]&&(c+=1,u=0),s[d]=++u;i.label_seq_id=ce.ofIntArray(s)}return Kr.columnToArray(i,"label_seq_id",Int32Array),Kr.columnToArray(i,"auth_seq_id",Int32Array),{atoms:r,residues:i,chains:o,atomSourceIndex:t}}(e,t,s),l=function F9e(e,t){const n=new Map;if(!Ui.is(t))return n;const{molstar_atom_site_operator_mapping:r}=rg(v9e,t.data.frame);if(0===r._rowCount)return n;const i=new Map,o=new Map;for(let u=0;u<r._rowCount;u++){const d=0===r.assembly_operator_id.valueKind(u)?{id:r.assembly_id.value(u),operList:[],operId:r.assembly_operator_id.value(u)}:void 0,f=ko.create(r.operator_name.value(u),fe.identity(),{assembly:d,spgrOp:0===r.symmetry_operator_index.valueKind(u)?r.symmetry_operator_index.value(u):void 0,hkl:C.ofArray(r.symmetry_hkl.value(u)),ncsId:r.ncs_id.value(u)}),p=r.suffix.value(u),m=r.label_asym_id.value(u);i.set(`${m}${p}`,{name:m,operator:f});const h=r.auth_asym_id.value(u);o.set(`${h}${p}`,h)}const{label_asym_id:s,auth_asym_id:a}=e.chains,l=new Array(s.rowCount),c=new Array(s.rowCount);for(let u=0;u<s.rowCount;u++){const d=s.value(u),f=a.value(u);if(!i.has(d)){l[u]=d,c[u]=f;continue}const{name:p,operator:m}=i.get(d);n.set(u,m),l[u]=p,c[u]=o.get(f)||f}return e.chains.label_asym_id=ce.ofArray({array:l,valueKind:e.chains.label_asym_id.valueKind,schema:e.chains.label_asym_id.schema}),e.chains.auth_asym_id=ce.ofArray({array:c,valueKind:e.chains.auth_asym_id.valueKind,schema:e.chains.auth_asym_id.schema}),n}(a,i);if(o&&function N9e(e,t){return Kr.areEqual(e.chains,t.chains)&&Kr.areEqual(e.residues,t.residues)&&Kr.areEqual(e.atoms,t.atoms)}(o.atomicHierarchy,a))return{sameAsPrevious:!0,hierarchy:o.atomicHierarchy,chainOperatorMapping:l};const c={residueAtomSegments:En.ofOffsets(s.residues,Pe.ofBounds(0,e._rowCount)),chainAtomSegments:En.ofOffsets(s.chains,Pe.ofBounds(0,e._rowCount))},u=function P9e(e,t,n){const r=function I9e(e,t,n){return{entities:e,segments:n,label_seq_id:rt.ofSortedArray(t.residues.label_seq_id.toArray({array:Int32Array})),label_atom_id:t.atoms.label_atom_id,auth_atom_id:t.atoms.auth_atom_id,label_alt_id:t.atoms.label_alt_id,type_symbol:t.atoms.type_symbol,chain_index_entity_index:new Int32Array(t.chains._rowCount),entity_index_label_asym_id:new Map,chain_index_label_seq_id:new Map,auth_asym_id_auth_seq_id:new Map,chain_index_auth_seq_id:new Map,label_asym_id:new Map}}(t,e,n),{label_seq_id:i,auth_seq_id:o,pdbx_PDB_ins_code:s}=e.residues,{label_entity_id:a,label_asym_id:l,auth_asym_id:c}=e.chains,u=Pe.ofBounds(0,e.atoms._rowCount),d=En.transientSegments(n.chainAtomSegments,u);for(;d.hasNext;){const f=d.move(),p=f.index,m=t.getEntityIndex(a.value(p));m<0&&A9e(a.value(p)),r.chain_index_entity_index[p]=m;const h=c.value(p);let g=r.auth_asym_id_auth_seq_id.get(h);g||(g=new Map,r.auth_asym_id_auth_seq_id.set(h,g));const y=l.value(p);r.label_asym_id.has(y)||r.label_asym_id.set(y,m),w9e(r.entity_index_label_asym_id,m,y,p);const v=new Map,x=new Map;r.chain_index_label_seq_id.set(p,v),r.chain_index_auth_seq_id.set(p,x);const _=En.transientSegments(n.residueAtomSegments,u,f);for(;_.hasNext;){const A=_.move().index,M=o.value(A),E=s.value(A);v.set(Aw(i.value(A),E),A),x.set(Aw(M,E),A),g.set(M,p)}}return new E9e(r)}(a,n,c),d=function C9e(e,t,n,r){const{label_comp_id:i,type_symbol:o,_rowCount:s}=e.atoms,{_rowCount:a}=e.residues,{offsets:l}=t.residueAtomSegments,c=new Uint8Array(s);for(let y=0;y<s;++y)c[y]=L3(o.value(y));const u=new Int32Array(a),d=new Int32Array(a),f=new Int32Array(a),p=new Uint8Array(a),m=new Uint8Array(a),h=new Map,g=new Map;for(let y=0;y<a;++y){const v=i.value(l[y]),x=r;let _,w;if(h.has(v))_=h.get(v),w=g.get(v);else{let T;x.has(v)?T=x.get(v).type:(g3||console.info("chemComp not found",v),T=Cse(v)),_=x1(T,v),w=I6e(T,_),h.set(v,_),g.set(v,w)}p[y]=_,m[y]=w;const A=w1(w,"trace");let M=n.findAtomsOnResidue(y,A);if(-1===M){const T=w1(w,"coarseBackbone");M=n.findAtomsOnResidue(y,T),-1===M&&QR(_)&&(M=n.findElementOnResidue(y,Jx("C")))}u[y]=M;const E=w1(w,"directionFrom");d[y]=n.findAtomsOnResidue(y,E);const D=w1(w,"directionTo");f[y]=n.findAtomsOnResidue(y,D)}return{atom:{atomicNumber:c},residue:{traceElementIndex:u,directionFromElementIndex:d,directionToElementIndex:f,moleculeType:p,polymerType:m}}}(a,c,u,r);return{sameAsPrevious:!1,hierarchy:{...a,...c,index:u,derived:d},chainOperatorMapping:l}}function vle(e,t,n,r,i,o){const{sameAsPrevious:s,hierarchy:a,chainOperatorMapping:l}=O9e(e,t,n,r,i,o),c=function R9e(e){return{id:oo.create22(),atomId:e.id,occupancy:e.occupancy.isDefined?e.occupancy:ce.ofConst(1,e._rowCount,ce.Schema.float),B_iso_or_equiv:e.B_iso_or_equiv,xyzDefined:e.Cartn_x.isDefined&&e.Cartn_y.isDefined&&e.Cartn_z.isDefined,x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array})}}(e);return{sameAsPrevious:s,hierarchy:a,conformation:c,chainOperatorMapping:l}}const xle={chainKey:[],entityKey:[],findSequenceKey:()=>-1,findChainKey:()=>-1,getEntityFromChain:()=>-1,count:0,entity_id:ce.Undefined(0,ce.Schema.str),asym_id:ce.Undefined(0,ce.Schema.str),seq_id_begin:ce.Undefined(0,ce.Schema.int),seq_id_end:ce.Undefined(0,ce.Schema.int),chainElementSegments:En.create([]),polymerRanges:Di.ofSortedRanges([]),gapRanges:Di.ofSortedRanges([])};var _le=function(e){return e.Empty={isDefined:!1,spheres:xle,gaussians:xle},e}(_le||{});function B9e(e,t,n){if(e.has(t))return e.get(t);const r=n.index++;return e.set(t,r),r}function L9e(e,t){if(e.has(t))return e.get(t);const n=new Map;return e.set(t,n),n}function U9e(e){throw new Error(`Missing entity entry for entity id '${e}'.`)}function Sle(e,t){const{entity_id:n,asym_id:r,seq_id_begin:i,seq_id_end:o,count:s,chainElementSegments:a}=e,l=new Map,c=new Map,u={index:0},d=new Int32Array(s),f=new Int32Array(s),p=new Int32Array(a.count);for(let y=0;y<s;y++)f[y]=t.getEntityIndex(n.value(y)),f[y]<0&&U9e(n.value(y));for(let y=0;y<a.count;y++){const v=a.offsets[y],x=a.offsets[y+1],_=f[v];p[y]=_;const A=B9e(L9e(c,_),r.value(v),u);for(let T=v;T<x;T++)d[T]=A;const M=[],E=[];for(let T=v;T<x;T++){const F=i.value(T),R=o.value(T);M.push(T),E.push(F,R)}const D={elementIndices:M,seqRanges:Di.ofSortedRanges(E)};l.set(A,D)}const{findChainKey:m,findSequenceKey:h}=function j9e(e,t,n){const r=e.getEntityIndex;return{findChainKey:(s,a)=>{const l=r(s);if(l<0)return-1;const c=t.get(l);return c.has(a)?c.get(a):-1},findSequenceKey:(s,a,l)=>{const c=r(s);if(c<0)return-1;const u=t.get(c);if(void 0===u)return-1;const d=u.get(a);if(void 0===d)return-1;const f=n.get(d),{elementIndices:p,seqRanges:m}=f,h=Di.firstIntersectionIndex(m,Ve.ofSingleton(l));return-1!==h?p[h]:-1}}}(t,c,l);return{chainKey:d,entityKey:f,findSequenceKey:h,findChainKey:m,getEntityFromChain:y=>p[y]}}function Cle(e,t){const n=[],r=[],i=En.transientSegments(e.chainElementSegments,Pe.ofBounds(0,e.count)),{seq_id_begin:o,seq_id_end:s}=e;for(;i.hasNext;){const{start:a,end:l}=i.move();let c=-1,u=-1;for(let d=a;d<l;++d){const f=s.value(d);d===a?(c=d,u=s.value(d)):o.value(d)-u>1&&(n.push(c,d-1),r.push(d-1,d),c=d),d===l-1&&n.push(c,d),u=f}}return{polymerRanges:Di.ofSortedRanges(n),gapRanges:Di.ofSortedRanges(r)}}const wle={hierarchy:_le.Empty,conformation:void 0};function G9e(e,t,n){const r=[0];for(let i=1,o=e.rowCount;i<o;i++)!e.areValuesEqual(i-1,i)&&(r[r.length]=i);return{chainElementSegments:En.ofOffsets(r,Pe.ofBounds(0,e.rowCount))}}function Ale(e){const{entity_id:t,seq_id_begin:n,seq_id_end:r,asym_id:i}=e;return{count:t.rowCount,entity_id:t,asym_id:i,seq_id_begin:n,seq_id_end:r,...G9e(i)}}const q9e={HIS:"H",ARG:"R",LYS:"K",ILE:"I",PHE:"F",LEU:"L",TRP:"W",ALA:"A",MET:"M",PRO:"P",CYS:"C",ASN:"N",VAL:"V",GLY:"G",SER:"S",GLN:"Q",TYR:"Y",ASP:"D",GLU:"E",THR:"T",SEC:"U",PYL:"O",HSD:"H",HSE:"H",HSP:"H",LSN:"K",ASPP:"D",GLUP:"E",HID:"H",HIE:"H",HIP:"H",LYN:"K",ASH:"D",GLH:"E"},W9e={DA:"A",DC:"C",DG:"G",DT:"T",DU:"U"},$9e={A:"A",C:"C",G:"G",T:"T",U:"U"};function Ile(e){return q9e[e]||"X"}function Ele(e){return $9e[e]||"X"}function Tle(e){return W9e[e]||"X"}var Z3,k7;function Dle(e,t,n,r){if(!e.entity_poly_seq||!e.entity_poly_seq._rowCount)return k7.fromHierarchy(t,n,r);const{entity_id:i,num:o,mon_id:s}=e.entity_poly_seq,a={},l=[],c=i.rowCount;let u=0;for(;u<c;){const d=u;for(;u<c-1&&i.areValuesEqual(u,u+1);)u++;u++;const f=i.value(d),p=ce.window(s,d,u),m=ce.window(o,d,u),h=t.getEntityIndex(f);a[h]={entityId:f,sequence:Z3.ofResidueNames(p,m)},l.push(a[h])}return{byEntityKey:a,sequences:l}}function Ple(e,t,n,r){return M7.apply(this,arguments)}function M7(){return M7=le(function*(e,t,n,r){const i=OU(n,r-1),{label_entity_id:o,label_asym_id:s,label_seq_id:a}=t,l=MU(i,o.value);e.shouldUpdate&&(yield e.update());for(let c=0,u=l.length-1;c<u;c++){const d=MU(i,s.value,{start:l[c],end:l[c+1]});for(let f=0,p=d.length-1;f<p;f++){const m=d[f];0===a.valueKind(m)&&(MU(i,a.value,{sort:!0,start:m,end:d[f+1]}),e.shouldUpdate&&(yield e.update()))}e.shouldUpdate&&(yield e.update())}return function XFe(e){for(let t=0,n=e.length;t<n;t++)if(e[t]!==t)return!1;return!0}(i)&&i.length===t._rowCount?{atom_site:t,sourceIndex:ce.ofIntArray(i)}:{atom_site:Kr.view(t,t._schema,i),sourceIndex:ce.ofIntArray(i)}}),M7.apply(this,arguments)}function kle(e,t,n,r,i){const{polymerType:o,traceElementIndex:s,directionFromElementIndex:a,directionToElementIndex:l}=i.residue,c=o[e],u=o[t];if(0===c||0===u||-1===s[e]||-1===s[t])return!1;let d=r.findAtomsOnResidue(e,w1(c,"backboneStart")),f=r.findAtomsOnResidue(t,w1(u,"backboneEnd"));(-1===d||-1===f)&&(d=r.findAtomsOnResidue(e,w1(c,"coarseBackbone")),f=r.findAtomsOnResidue(t,w1(u,"coarseBackbone")));const{x:p,y:m,z:h}=n,g=C.create(p[d],m[d],h[d]),y=C.create(p[f],m[f],h[f]),v=-1===a[e]||-1===l[e]||-1===a[t]||-1===l[t];return C.distance(g,y)<(v?10:3)}function Mle(e,t,n,r){const i=[],o=[],s=new Map,a=En.transientSegments(e.chainAtomSegments,Pe.ofBounds(0,e.atoms._rowCount)),l=En.transientSegments(e.residueAtomSegments,Pe.ofBounds(0,e.atoms._rowCount)),{index:c,derived:u}=e,{label_seq_id:d}=e.residues,{label_entity_id:f}=e.chains,{moleculeType:p,traceElementIndex:m}=u.residue;let h,g,y,v;for(;a.hasNext;){const x=a.move();l.setSegment(x),h=-1,g=-1,y=-1,v=-1;const _=t.getEntityIndex(f.value(x.index)),w=r.byEntityKey[_],A=w?w.sequence.seqId.value(w.sequence.seqId.rowCount-1):-1,M=e.residueAtomSegments.index[x.start],E=e.residueAtomSegments.index[x.end-1],D=d.value(M),T=d.value(E);for(1===D&&T===A&&n.xyzDefined&&kle(M,E,n,c,u)&&(s.set(M,E),s.set(E,M));l.hasNext;){const F=l.move(),R=F.index,N=d.value(R);QR(p[R])&&-1!==m[R]?-1!==v?N!==h+1?(i.push(v,y-1),o.push(g,F.end-1),v=F.start):l.hasNext?n.xyzDefined&&!kle(e.residueAtomSegments.index[F.start],e.residueAtomSegments.index[y-1],n,e.index,u)&&(i.push(v,y-1),o.push(g,F.end-1),v=F.start):i.push(v,F.end-1):v=F.start:-1!==v&&(i.push(v,y-1),v=-1),g=F.start,y=F.end,h=N}}return{polymerRanges:Di.ofSortedRanges(i),gapRanges:Di.ofSortedRanges(o),cyclicPolymerMap:s}}function sy(e){let t,n;return(...r)=>{if(!t||t.length!==r.length)return t=r,n=e.apply(void 0,r),n;for(let i=0,o=r.length;i<o;i++)if(r[i]!==t[i])return t=r,n=e.apply(void 0,r),n;return n}}function k5(e){const t=new Map;return n=>{if(t.has(n))return t.get(n);const r=e(n);return t.set(n,r),r}}function Y9e(e){const t=new Map,n=(i,o,s)=>`${i}|${o}|${s}`,r=e.pdbx_unobs_or_zero_occ_residues;for(let i=0,o=r._rowCount;i<o;++i){const s=n(r.PDB_model_num.value(i),r.label_asym_id.value(i),r.label_seq_id.value(i));t.set(s,{polymer_flag:r.polymer_flag.value(i),occupancy_flag:r.occupancy_flag.value(i)})}return{has:(i,o,s)=>t.has(n(i,o,s)),get:(i,o,s)=>t.get(n(i,o,s)),size:t.size}}function X9e(e){const t=new Map;if(e.chem_comp._rowCount>0){const{id:n}=e.chem_comp;for(let r=0,i=n.rowCount;r<i;++r)t.set(n.value(r),Kr.getRow(e.chem_comp,r))}else Rle(e).forEach(r=>{t.set(r,function E6e(e){return{formula:"",formula_weight:0,id:e,name:e,mon_nstd_flag:yw.has(e)?"y":"n",pdbx_synonyms:[],type:Cse(e)}}(r))});return t}function K9e(e){const t=new Map;if(e.pdbx_chem_comp_identifier._rowCount>0){const{comp_id:n,type:r,identifier:i}=e.pdbx_chem_comp_identifier;for(let o=0,s=n.rowCount;o<s;++o)if("SNFG CARBOHYDRATE SYMBOL"===r.value(o)||"SNFG CARB SYMBOL"===r.value(o)){const a=i.value(o),l=o6e.get(a);l?t.set(n.value(o),l):console.warn(`Unknown SNFG name '${a}'`)}}if(e.chem_comp._rowCount>0){const{id:n,type:r}=e.chem_comp;for(let i=0,o=n.rowCount;i<o;++i){const s=n.value(i);if(t.has(s))continue;const a=r.value(i);$0.has(s)?t.set(s,$0.get(s)):9===x1(a,s)&&t.set(s,JU)}}else{const n=Rle(e);$0.forEach((r,i)=>{!t.has(i)&&n.has(i)&&t.set(i,r)})}return t}!function(e){let t;var c;(c=t=e.Kind||(e.Kind={})).Protein="protein",c.RNA="RNA",c.DNA="DNA",c.Generic="generic",e.getSequenceString=function n(c){const u=c.code.toArray();return(u instanceof Array?u:Array.from(u)).join("")},e.ofResidueNames=function o(c,u){if(0===u.rowCount)throw new Error("cannot be empty");const d=function r(c){for(let u=0,d=Math.min(c.rowCount,10);u<d;u++){const f=c.value(u)||"";if("X"!==Ile(f))return t.Protein;if("X"!==Ele(f))return t.RNA;if("X"!==Tle(f))return t.DNA}return t.Generic}(c);return new s(d,c,u)};class s{index(u){return this.indexMap.get(u)}constructor(u,d,f){this.kind=u,this.microHet=new Map;const p=function i(c,u){let d;switch(c){case t.Protein:d=Ile;break;case t.DNA:d=Tle;break;case t.RNA:d=Ele;break;case t.Generic:d=()=>"X";break;default:Hi()}return u&&u.size>0?f=>{const p=d(f);return"X"===p&&u.has(f)?d(u.get(f)):p}:d}(u),m=[],h=[],g=[],y=new Map;let v=0;const x=new Map;for(let w=0,A=f.rowCount;w<A;++w){const M=f.value(w);if(x.has(M))y.has(M)?y.get(M).push(d.value(w)):y.set(M,[h[x.get(M)],d.value(w)]);else{x.set(M,v);const E=d.value(w);h[v]=E,g[v]=M,m[v]=p(E),v+=1}}const _=[];for(let w=0,A=v;w<A;++w){const M=y.get(g[w]);if(M){const E=M.map(D=>{const T=p(D);return"X"===T?D:T});_[w]=`(${E.join("|")})`}else _[w]="X"===m[w]?h[w]:m[w]}this.length=v,this.code=ce.ofStringArray(m),this.compId=ce.ofStringArray(h),this.seqId=ce.ofIntArray(g),this.label=ce.ofStringArray(_),this.microHet=y,this.indexMap=x}}e.ofSequenceRanges=function a(c,u){return new l(t.Generic,c,u)};class l{index(u){return u-this.minSeqId}constructor(u,d,f){this.kind=u,this.seqIdStart=d,this.seqIdEnd=f,this.microHet=new Map;let p=0,m=Number.MAX_SAFE_INTEGER;for(let g=0,y=this.seqIdStart.rowCount;g<y;g++){const v=this.seqIdStart.value(g),x=this.seqIdEnd.value(g);v<m&&(m=v),p<x&&(p=x)}const h=p-m+1;this.code=ce.ofConst("X",h,ce.Schema.str),this.label=ce.ofConst("",h,ce.Schema.str),this.seqId=ce.ofLambda({value:g=>g+m+1,rowCount:h,schema:ce.Schema.int}),this.compId=ce.ofConst("",h,ce.Schema.str),this.length=h,this.minSeqId=m}}}(Z3||(Z3={})),function(e){const t={byEntityKey:{},sequences:[]};function n(...a){const l=[],c={};for(let u=0,d=a.length;u<d;++u)l.push(...a[u].sequences),Object.assign(c,a[u].byEntityKey);return{sequences:l,byEntityKey:c}}function i(a,l){const{label_comp_id:c}=l.atoms,{label_seq_id:u}=l.residues,{chainAtomSegments:d,residueAtomSegments:f}=l,{count:p,offsets:m}=d,h={},g=[];if(1===p&&0===m[0]&&0===m[1])return{byEntityKey:h,sequences:g};for(let y=0,v=l.chains._rowCount;y<v;y++){const x=l.index.getEntityFromChain(y);if(void 0!==h[x]||"polymer"!==a.data.type.value(x))continue;const _=y;for(y++;y<v&&x===l.index.getEntityFromChain(y)&&"polymer"!==a.data.type.value(x);)y++;y--;const w=f.index[m[_]],A=f.index[m[y+1]-1]+1,M=ce.window(u,w,A),E=[];for(let T=w;T<A;++T)E.push(c.value(f.offsets[T]));const D=ce.ofStringArray(E);h[x]={entityId:a.data.id.value(x),sequence:Z3.ofResidueNames(D,M)},g.push(h[x])}return{byEntityKey:h,sequences:g}}function o(a,l){return n(s(a,l.spheres),s(a,l.gaussians))}function s(a,l){const{chainElementSegments:c,seq_id_begin:u,seq_id_end:d}=l,{count:f,offsets:p}=c,m={},h=[];if(1===f&&0===p[0]&&0===p[1])return{byEntityKey:m,sequences:h};for(let g=0,y=f;g<y;g++){const v=l.getEntityFromChain(g);if(void 0!==m[v])continue;const x=g;for(g++;g<y&&v===l.getEntityFromChain(g);)g++;g--;const _=p[x],w=p[g+1]-1,A=ce.window(u,_,w),M=ce.window(d,_,w);m[v]={entityId:a.data.id.value(v),sequence:Z3.ofSequenceRanges(A,M)},h.push(m[v])}return{byEntityKey:m,sequences:h}}e.fromHierarchy=function r(a,l,c){return n(i(a,l),c.isDefined?o(a,c):t)},e.fromAtomicHierarchy=i,e.fromCoarseHierarchy=o,e.fromCoarseElements=s}(k7||(k7={}));const Rle=k5(e=>{const t=new Set,{label_comp_id:n,auth_comp_id:r}=e.atom_site,i=n.isDefined?n:r;for(let o=0,s=i.rowCount;o<s;++o)t.add(i.value(o));return t});function Nle(e,t){const n=new Map,{auth_asym_id:r,label_asym_id:i,label_entity_id:o}=e.chains;for(let s=0,a=e.chains._rowCount;s<a;s++){const l=i.value(s);n.set(l,{id:l,auth_id:r.value(s),entity_id:o.value(s)})}if(t?.struct_asym._rowCount){const{id:s,entity_id:a}=t.struct_asym;for(let l=0,c=s.rowCount;l<c;++l){const u=s.value(l);n.has(u)||n.set(u,{id:u,auth_id:"",entity_id:a.value(l)})}}return n}const Z9e=ce.Schema.Aliased(ce.Schema.Str());function Fle(e){let t;if(e.entity.id.isDefined)t=e.entity;else{const a=new Set,l=[],c=[],{label_entity_id:u,label_comp_id:d}=e.atom_site;for(let m=0,h=e.atom_site._rowCount;m<h;m++){const g=u.value(m);a.has(g)||(l.push(g),c.push(T6e(d.value(m))),a.add(g))}const{entity_id:f}=e.ihm_sphere_obj_site;for(let m=0,h=e.ihm_sphere_obj_site._rowCount;m<h;m++){const g=f.value(m);a.has(g)||(l.push(g),c.push("polymer"),a.add(g))}const{entity_id:p}=e.ihm_gaussian_obj_site;for(let m=0,h=e.ihm_gaussian_obj_site._rowCount;m<h;m++){const g=p.value(m);a.has(g)||(l.push(g),c.push("polymer"),a.add(g))}t=Kr.ofPartialColumns(ic.entity,{id:ce.ofArray({array:l,schema:ic.entity.id}),type:ce.ofArray({array:c,schema:ic.entity.type})},l.length)}const n=ce.createIndexer(t.id),r=new Array(t._rowCount);r.fill("other");const i=new Set;let o=!1;if(e.entity_poly&&e.entity_poly.type.isDefined){const{entity_id:a,type:l,_rowCount:c}=e.entity_poly;for(let u=0;u<c;++u){const d=a.value(u);r[n(d)]=l.value(u),i.add(d)}}else o=!0;if(e.pdbx_entity_branch&&e.pdbx_entity_branch.entity_id.isDefined){const{entity_id:a,type:l,_rowCount:c}=e.pdbx_entity_branch;for(let u=0;u<c;++u){const d=a.value(u);r[n(d)]=l.value(u),i.add(d)}}else o=!0;if(i.size<r.length&&(o=!0),o){const a=new Map;if(e.chem_comp){const{id:l,type:c}=e.chem_comp;for(let u=0,d=e.chem_comp._rowCount;u<d;u++)a.set(l.value(u),c.value(u))}if(e.atom_site){const{label_entity_id:l,label_comp_id:c}=e.atom_site;for(let u=0,d=e.atom_site._rowCount;u<d;u++){const f=l.value(u);if(!i.has(f)){const p=c.value(u),m=a.get(p)||"other";r[n(f)]=D6e(p,m),i.add(f)}}}}return{data:t,subtype:ce.ofArray({array:r,schema:Z9e}),getEntityIndex:n}}function Ole(e,t,n){var r;if(!e.pdbx_molecule||!e.pdbx_molecule.prd_id.isDefined)return t;const i=new Array(t.data._rowCount);i.fill("");const{asym_id:o,prd_id:s,_rowCount:a}=e.pdbx_molecule;for(let c=0;c<a;++c){const u=o.value(c),d=null===(r=n.get(u))||void 0===r?void 0:r.entity_id;void 0!==d&&(i[t.getEntityIndex(d)]=s.value(c))}const l=ce.ofArray({array:i,schema:ce.Schema.str});return{...t,prd_id:l}}class ay{getFrameAtIndex(t){return this.frames[t]}constructor(t){this.frames=t,this.frameCount=t.length,this.representative=t[0],this.duration=t.length}}function cg(e,t,n){return R7.apply(this,arguments)}function R7(){return R7=le(function*(e,t,n){const r=function Q9e(e,t){return{missingResidues:Y9e(e),chemicalComponentMap:X9e(e),saccharideComponentMap:K9e(e)}}(e),i=e.ihm_model_list._rowCount>0?yield function nHe(e,t,n,r){return O7.apply(this,arguments)}(n,e,r,t):yield function tHe(e,t,n,r){return N7.apply(this,arguments)}(n,e,r,t);for(let o=0;o<i.length;o++)Sn.TrajectoryInfo.set(i[o],{index:o,size:i.length});return new ay(i)}),R7.apply(this,arguments)}function J9e(e,t,n,r,i,o,s){const a=vle(t,n,r,i.chemicalComponentMap,o,s),l=t.pdbx_PDB_model_num.value(0);if(s&&a.sameAsPrevious)return{...s,id:oo.create22(),modelNum:l,atomicConformation:a.conformation,_dynamicPropertyData:Object.create(null)};const c=wle,u=Dle(e,r,a.hierarchy,c.hierarchy),d=Mle(a.hierarchy,r,a.conformation,u),f=Nle(a.hierarchy),p=0===e.entry.id.valueKind(0)?e.entry.id.value(0):o.name,m=[];return p&&m.push(p),0===e.struct.title.valueKind(0)&&m.push(e.struct.title.value(0)),{id:oo.create22(),entryId:p,label:m.join(" | "),entry:p,sourceData:o,modelNum:l,parent:void 0,entities:Ole(e,r,f),sequence:u,atomicHierarchy:a.hierarchy,atomicConformation:a.conformation,atomicRanges:d,atomicChainOperatorMappinng:a.chainOperatorMapping,coarseHierarchy:c.hierarchy,coarseConformation:c.conformation,properties:{...i,structAsymMap:f},customProperties:new Oh,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function eHe(e,t,n,r){const i=vle(t.atom_site,t.atom_site_sourceIndex,t.entities,n.chemicalComponentMap,r),o=function z9e(e,t){const{ihm_sphere_obj_site:n,ihm_gaussian_obj_site:r}=e;if(0===n._rowCount&&0===r._rowCount)return wle;const i=Ale(n),o=function V9e(e){return{x:e.Cartn_x.toArray({array:Float32Array}),y:e.Cartn_y.toArray({array:Float32Array}),z:e.Cartn_z.toArray({array:Float32Array}),radius:e.object_radius.toArray({array:Float32Array}),rmsf:e.rmsf.toArray({array:Float32Array})}}(n),s=Sle(i,e.entities),a=Cle(i),l=Ale(r),c=function H9e(e){const t=ic.ihm_gaussian_obj_site.covariance_matrix.space,n=[],{covariance_matrix:r}=e;for(let i=0,o=r.rowCount;i<o;i++)n[i]=mr.toMat3(In(),t,r.value(i));return{x:e.mean_Cartn_x.toArray({array:Float32Array}),y:e.mean_Cartn_y.toArray({array:Float32Array}),z:e.mean_Cartn_z.toArray({array:Float32Array}),weight:e.weight.toArray({array:Float32Array}),covariance_matrix:n}}(r),u=Sle(l,e.entities),d=Cle(l);return{hierarchy:{isDefined:!0,spheres:{...i,...s,...a},gaussians:{...l,...u,...d}},conformation:{id:oo.create22(),spheres:o,gaussians:c}}}(t),s=Dle(e,t.entities,i.hierarchy,o.hierarchy),a=Mle(i.hierarchy,t.entities,i.conformation,s),l=0===e.entry.id.valueKind(0)?e.entry.id.value(0):r.name,c=[];l&&c.push(l),0===e.struct.title.valueKind(0)&&c.push(e.struct.title.value(0)),t.model_name&&c.push(t.model_name),t.model_group_name&&c.push(t.model_group_name);const u=Nle(i.hierarchy,e);return{id:oo.create22(),entryId:l,label:c.join(" | "),entry:l,sourceData:r,modelNum:t.model_id,parent:void 0,entities:Ole(e,t.entities,u),sequence:s,atomicHierarchy:i.hierarchy,atomicConformation:i.conformation,atomicRanges:a,atomicChainOperatorMappinng:i.chainOperatorMapping,coarseHierarchy:o.hierarchy,coarseConformation:o.conformation,properties:{...n,structAsymMap:u},customProperties:new Oh,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)}}function Ble(e,t){const n=e.rowCount;if(!e.isDefined)return n;let r=t+1;for(;r<n&&e.areValuesEqual(t,r);)r++;return r}function N7(){return N7=le(function*(e,t,n,r){const i=[];if(t.atom_site){const o=t.atom_site.id.rowCount,s=Fle(t);let a=0;for(;a<o;){const l=Ble(t.atom_site.pdbx_PDB_model_num,a),{atom_site:c,sourceIndex:u}=yield Ple(e,t.atom_site,a,l),d=J9e(t,c,u,s,n,r,i.length>0?i[i.length-1]:void 0);i.push(d),a=l}}return i}),N7.apply(this,arguments)}function F7(e,t){const n=new Map,r=e._rowCount;let i=0;for(;i<r;){const o=Ble(t,i),s=t.value(i);n.set(s,{table:Kr.window(e,e._schema,i,o),start:i,end:o}),i=o}return n}function O7(){return O7=le(function*(e,t,n,r){const i=Fle(t),s=F7(t.atom_site,t.atom_site.ihm_model_id.isDefined?t.atom_site.ihm_model_id:t.atom_site.pdbx_PDB_model_num),a=F7(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site.model_id),l=F7(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site.model_id),c=[];if(t.ihm_model_list){const{model_id:u,model_name:d}=t.ihm_model_list;for(let f=0;f<t.ihm_model_list._rowCount;f++){const p=u.value(f);let m,h;if(s.has(p)){const v=s.get(p),{atom_site:x,sourceIndex:_}=yield Ple(e,t.atom_site,v.start,v.end);m=x,h=_}else m=Kr.window(t.atom_site,t.atom_site._schema,0,0),h=ce.ofIntArray([]);const y=eHe(t,{model_id:p,model_name:d.value(f),model_group_name:QUe(p,t),entities:i,atom_site:m,atom_site_sourceIndex:h,ihm_sphere_obj_site:a.has(p)?a.get(p).table:Kr.window(t.ihm_sphere_obj_site,t.ihm_sphere_obj_site._schema,0,0),ihm_gaussian_obj_site:l.has(p)?l.get(p).table:Kr.window(t.ihm_gaussian_obj_site,t.ihm_gaussian_obj_site._schema,0,0)},n,r);c.push(y)}}return c}),O7.apply(this,arguments)}var Sn,Lle,$h,R5;function B7(e){const t=new Map;for(let n=0,r=e.length;n<r;n++)t.set(n,e[n]);return t}!function(e){function t(z,$){const V=[],{frames:X}=$,H=z.atomicHierarchy.atomSourceIndex,te=ce.isIdentity(H)?void 0:H.toArray({array:Int32Array}),K=h(z),Q=z.atomicHierarchy.atoms._rowCount;for(let G=0,Z=X.length;G<Z;++G){const ee=X[G];if(ee.elementCount!==Q)throw new Error(`Frame element count mismatch, got ${ee.elementCount} but expected ${Q}.`);const se={...z,id:oo.create22(),modelNum:G,atomicConformation:Wx.getAtomicConformation(ee,{atomId:z.atomicConformation.atomId,occupancy:z.atomicConformation.occupancy,B_iso_or_equiv:z.atomicConformation.B_iso_or_equiv},te),customProperties:new Oh,_staticPropertyData:Object.create(null),_dynamicPropertyData:Object.create(null)};if(ee.cell){const xe=Vs.fromCell(ee.cell.size,ee.cell.anglesInRadians);Vs.Provider.set(se,xe)}e.TrajectoryInfo.set(se,{index:G,size:X.length}),e.CoarseGrained.set(se,K),V.push(se)}return{trajectory:V,srcIndexArray:te}}e.trajectoryFromModelAndCoordinates=function n(z,$){return new ay(t(z,$).trajectory)},e.trajectoryFromTopologyAndCoordinates=function r(z,$){return Ke.create("Create Trajectory",function(){var V=le(function*(X){const H=yield cg(z.basic,z.sourceData,X);if(0===H.frameCount)throw new Error("found no model");const oe=H.representative,{trajectory:te}=t(oe,$),Q=nc.fromData({pairs:z.bonds,count:oe.atomicHierarchy.atoms._rowCount}),G=h(oe);let Z=0;for(const ee of te)nc.Provider.set(ee,Q),e.TrajectoryInfo.set(ee,{index:Z++,size:te.length}),e.CoarseGrained.set(ee,G);return new ay(te)});return function(X){return V.apply(this,arguments)}}())};const i="__Center__";e.getCenter=function o(z){if(z._dynamicPropertyData[i])return z._dynamicPropertyData[i];const $=function ZFe(e,t){const n=[],r=[],i=[];e.x.length&&(n.push(...mf(e.x)),r.push(...mf(e.y)),i.push(...mf(e.z))),t&&(t.spheres.x.length&&(n.push(...mf(t.spheres.x)),r.push(...mf(t.spheres.y)),i.push(...mf(t.spheres.z))),t.gaussians.x.length&&(n.push(...mf(t.gaussians.x)),r.push(...mf(t.gaussians.y)),i.push(...mf(t.gaussians.z))));const[o,s]=mf(n),[a,l]=mf(r),[c,u]=mf(i);return C.create(o+(s-o)/2,a+(l-a)/2,c+(u-c)/2)}(z.atomicConformation,z.coarseConformation);return z._dynamicPropertyData[i]=$,$};const a="__InvertedAtomSrcIndex__";e.getInvertedAtomSourceIndex=function l(z){if(z._staticPropertyData[a])return z._staticPropertyData[a];const $=function s(z){const $=new Int32Array(z.rowCount);let V=!1;for(let X=0,H=z.rowCount;X<H;X++){const oe=z.value(X);oe!==X&&(V=!1),$[oe]=X}return{isIdentity:V,invertedIndex:$}}(z.atomicHierarchy.atomSourceIndex);return z._staticPropertyData[a]=$,$};const c="__TrajectoryInfo__";e.TrajectoryInfo={get:z=>z._dynamicPropertyData[c]||{index:0,size:1},set:(z,$)=>z._dynamicPropertyData[c]=$};const u="__AsymIdCount__";e.AsymIdCount={get(z){if(z._dynamicPropertyData[u])return z._dynamicPropertyData[u];const $=function QFe(e){const t=new Set,n=new Set;return e.properties.structAsymMap.forEach(({auth_id:r},i)=>{t.add(r),n.add(i)}),{auth:t.size,label:n.size}}(z);return z._dynamicPropertyData[u]=$,$}},e.AsymIdOffset=f_.createSimple("asym_id_offset","static"),e.Index=f_.createSimple("index","static"),e.MaxIndex=f_.createSimple("max_index","static"),e.getRoot=function d(z){return z.parent||z},e.areHierarchiesEqual=function f(z,$){return z.atomicHierarchy===$.atomicHierarchy&&z.coarseHierarchy===$.coarseHierarchy};const p="__CoordinatesHistory__";e.CoordinatesHistory={get:z=>z._staticPropertyData[p],set:(z,$)=>z._staticPropertyData[p]=$};const m="__CoarseGrained__";function h(z){let $=e.CoarseGrained.get(z);if(void 0===$){let V=0;const{polymerType:X}=z.atomicHierarchy.derived.residue;for(let Q=0;Q<X.length;++Q)0!==X[Q]&&(V+=1);let H=!1,oe=!1;const{label_atom_id:te,_rowCount:K}=z.atomicHierarchy.atoms;for(let Q=0;Q<K;++Q){const G=te.value(Q);if(!H&&"BB"===G&&(H=!0),!oe&&"SC1"===G&&(oe=!0),H&&oe)break}$=H&&oe||!(!V||!K)&&K/V<3,e.CoarseGrained.set(z,$)}return $}function _(z){return!!Ui.is(z.sourceData)&&(null!==z.entryId.match(/^[1-9][a-z0-9]{3,3}$/i)||null!==z.entryId.match(/^pdb_[0-9]{4,4}[1-9][a-z0-9]{3,3}$/i))}e.CoarseGrained={get:z=>z._staticPropertyData[m],set:(z,$)=>z._staticPropertyData[m]=$},e.isCoarseGrained=h,e.hasCarbohydrate=function g(z){return z.properties.saccharideComponentMap.size>0},e.hasProtein=function y(z){const{subtype:$}=z.entities;for(let V=0,X=$.rowCount;V<X;++V)if($.value(V).startsWith("polypeptide"))return!0;return!1},e.hasNucleic=function v(z){const{subtype:$}=z.entities;for(let V=0,X=$.rowCount;V<X;++V){const H=$.value(V);if(H.endsWith("ribonucleotide hybrid")||H.endsWith("ribonucleotide"))return!0}return!1},e.isFromPdbArchive=function x(z){if(!Ui.is(z.sourceData))return!1;const{db:$}=z.sourceData.data;for(let V=0,X=$.database_2.database_id.rowCount;V<X;++V)if("pdb"===$.database_2.database_id.value(V))return!0;return!1},e.hasPdbId=_,e.hasSecondaryStructure=function w(z){if(Ui.is(z.sourceData)){const{db:$}=z.sourceData.data;return $.struct_conf.id.isDefined||$.struct_sheet_range.id.isDefined}return o_.Provider.isApplicable(z)};const A=C.create(1.5707963,1.5707963,1.5707963),M=C.create(1,1,1);function D(z){if(!Ui.is(z.sourceData))return!1;const{db:$}=z.sourceData.data;for(let V=0;V<$.exptl.method.rowCount;V++)if($.exptl.method.value(V).toUpperCase().indexOf("DIFFRACTION")>=0)return!0;return!1}function T(z){if(!Ui.is(z.sourceData))return!1;const{db:$}=z.sourceData.data;for(let V=0;V<$.exptl.method.rowCount;V++)if($.exptl.method.value(V).toUpperCase().indexOf("MICROSCOPY")>=0)return!0;return!1}function R(z){if(!Ui.is(z.sourceData)||!D(z))return!1;const{db:$}=z.sourceData.data,{status_code_sf:V}=$.pdbx_database_status;return V.isDefined&&"REL"===V.value(0)}function N(z){if(!Ui.is(z.sourceData))return!1;const{db:$}=z.sourceData.data,{db_name:V,content_type:X}=$.pdbx_database_related;for(let H=0,oe=$.pdbx_database_related._rowCount;H<oe;++H)if("EMDB"===V.value(H).toUpperCase()&&"associated EM volume"===X.value(H))return!0;return!1}function j(z){return!!Ui.is(z.sourceData)&&(R(z)||N(z))}e.hasCrystalSymmetry=function E(z){var $;const V=null===($=Vs.Provider.get(z))||void 0===$?void 0:$.spacegroup;return!(!V||1===V.num&&C.equals(V.cell.anglesInRadians,A)&&C.equals(V.cell.size,M))},e.isFromXray=D,e.isFromEm=T,e.isFromNmr=function F(z){if(!Ui.is(z.sourceData))return!1;const{db:$}=z.sourceData.data;for(let V=0;V<$.exptl.method.rowCount;V++)if($.exptl.method.value(V).toUpperCase().indexOf("NMR")>=0)return!0;return!1},e.hasXrayMap=R,e.hasEmMap=N,e.hasDensityMap=j,e.probablyHasDensityMap=function W(z){if(!Ui.is(z.sourceData))return!1;const{db:$}=z.sourceData.data;return j(z)||_(z)&&(!$.exptl.method.isDefined||D(z)&&(!$.pdbx_database_status.status_code_sf.isDefined||2===$.pdbx_database_status.status_code_sf.valueKind(0))||T(z)&&!$.pdbx_database_related.db_name.isDefined)}}(Sn||(Sn={})),function(e){e.getCifDataSource=function t(d,f,p){if(!f)return{rowCount:0};if(p&&p[f.id])return p[f.id];const m=f.getElements(d),h={data:m,rowCount:m.elements.length};return p&&(p[f.id]=h),h},e.fromAtomMap=function n(d){return new jle(d)},e.fromAtomArray=function r(d){return new jle(B7(d))};const i=d=>d.atomicHierarchy.residueAtomSegments;e.fromResidueMap=function o(d){return new M5("residue",d,i,0)},e.fromResidueArray=function s(d){return new M5("residue",B7(d),i,0)};const a=d=>d.atomicHierarchy.chainAtomSegments;e.fromChainMap=function l(d){return new M5("chain",d,a,0)},e.fromChainArray=function c(d){return new M5("chain",B7(d),a,0)},e.fromEntityMap=function u(d){return new rHe(d)}}(Lle||(Lle={}));class M5{has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){const n=t.models;if(1!==n.length)throw new Error("Only works on structures with a single model.");const r=new Set,i=t.unitSymmetryGroups,o=[],s=this.segmentGetter(n[0]);for(const a of i){const l=a.units[0];if(l.kind!==this.kind)continue;const c=En.transientSegments(s,l.elements);for(;c.hasNext;){const u=c.move();!this.has(u.index)||r.has(u.index)||(r.add(u.index),o[o.length]=dt.create(t,l,l.elements[u.start]))}}return o.sort((a,l)=>a.element-l.element),o}getElements(t){const n=this.segmentGetter(t.model).index,r=this.getStructureElements(t);return{elements:r,property:i=>this.get(n[r[i].element])}}constructor(t,n,r,i){this.level=t,this.map=n,this.segmentGetter=r,this.id=oo.create22(),this.kind=i}}class jle{has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){if(1!==t.models.length)throw new Error("Only works on structures with a single model.");const r=new Set,i=t.unitSymmetryGroups,o=[];for(const s of i){const a=s.units[0];if(a.kind!==this.kind)continue;const l=a.elements;for(let c=0,u=l.length;c<u;c++){const d=l[c];!this.has(d)||r.has(d)||(r.add(l[c]),o[o.length]=dt.create(t,a,d))}}return o.sort((s,a)=>s.element-a.element),o}getElements(t){const n=this.getStructureElements(t);return{elements:n,property:r=>this.get(n[r].element)}}constructor(t){this.map=t,this.id=oo.create22(),this.level="atom",this.kind=0}}class rHe{has(t){return this.map.has(t)}get(t){return this.map.get(t)}getStructureElements(t){const n=t.models;if(1!==n.length)throw new Error("Only works on structures with a single model.");const r=n[0].atomicHierarchy.index,i=new Set,o=t.unitSymmetryGroups,s=[],a=n[0].atomicHierarchy.chainAtomSegments;for(const l of o){const c=l.units[0];if(c.kind!==this.kind)continue;const u=En.transientSegments(a,c.elements);for(;u.hasNext;){const d=u.move(),f=r.getEntityFromChain(d.index);!this.has(f)||i.has(f)||(i.add(f),s[s.length]=dt.create(t,c,c.elements[d.start]))}}return s.sort((l,c)=>l.element-c.element),s}getElements(t){const n=this.getStructureElements(t),r=t.model.atomicHierarchy.chainAtomSegments.index,i=t.model.atomicHierarchy.index;return{elements:n,property:o=>this.get(i.getEntityFromChain(r[n[o].element]))}}constructor(t){this.map=t,this.id=oo.create22(),this.level="entity",this.kind=0}}!function(e){function t(a){const l=new DataView(a.buffer);return Object.assign(a.subarray(0),{readInt8:c=>l.getInt8(c),readUInt8:c=>l.getUint8(c),writeInt8:(c,u)=>l.setInt8(u,c),writeUInt8:(c,u)=>l.setUint8(u,c),readInt16LE:c=>l.getInt16(c,!0),readInt32LE:c=>l.getInt32(c,!0),readUInt16LE:c=>l.getUint16(c,!0),readUInt32LE:c=>l.getUint32(c,!0),readFloatLE:c=>l.getFloat32(c,!0),readDoubleLE:c=>l.getFloat64(c,!0),writeInt16LE:(c,u)=>l.setInt16(u,c,!0),writeInt32LE:(c,u)=>l.setInt32(u,c,!0),writeUInt16LE:(c,u)=>l.setUint16(u,c,!0),writeUInt32LE:(c,u)=>l.setUint32(u,c,!0),writeFloatLE:(c,u)=>l.setFloat32(u,c,!0),writeDoubleLE:(c,u)=>l.setFloat64(u,c,!0),readInt16BE:c=>l.getInt16(c,!1),readInt32BE:c=>l.getInt32(c,!1),readUInt16BE:c=>l.getUint16(c,!1),readUInt32BE:c=>l.getUint32(c,!1),readFloatBE:c=>l.getFloat32(c,!1),readDoubleBE:c=>l.getFloat64(c,!1),writeInt16BE:(c,u)=>l.setInt16(u,c,!1),writeInt32BE:(c,u)=>l.setInt32(u,c,!1),writeUInt16BE:(c,u)=>l.setUint16(u,c,!1),writeUInt32BE:(c,u)=>l.setUint32(u,c,!1),writeFloatBE:(c,u)=>l.setFloat32(u,c,!1),writeDoubleBE:(c,u)=>l.setFloat64(u,c,!1),copy:(c,u,d,f)=>(u=Ll(u,0),d=Ll(d,0),f=Ll(f,a.length),c.set(a.subarray(d,f),u),f-d)})}function i(a,l,c,u,d){for(let f=0,p=c;f<p;f+=u)for(let m=0;m<u;m++)l[d+f+u-m-1]=a[d+f+m]}e.fromUint8Array=t,e.fromArrayBuffer=function n(a){return t(new Uint8Array(a))},e.fromBuffer=function r(a){return a},e.IsNativeEndianLittle=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],e.flipByteOrder=i,e.flipByteOrderInPlace2=function o(a,l=0,c){const u=new Int16Array(a,l,c);for(let d=0,f=u.length;d<f;++d){const p=u[d];u[d]=(255&p)<<8|p>>8&255}},e.ensureLittleEndian=function s(a,l,c,u,d){e.IsNativeEndianLittle||!c||u<=1||i(a,l,c,u,d)}}($h||($h={})),function(e){e.fromBuffer=function t(n,r){return{name:r,readBuffer:(i,o,s,a)=>{let l,c;if("number"==typeof o){s=Ll(s,o);const u=i,d=Math.min(n.length,u+s);l=d-u,c=$h.fromUint8Array(new Uint8Array(n.buffer,u,d-u))}else{s=Ll(s,o.length);const u=i,d=Math.min(n.length,u+s);o.set(n.subarray(u,d),a),l=d-u,c=o}return s!==l&&console.warn(`byteCount ${s} and bytesRead ${l} differ`),Promise.resolve({bytesRead:l,buffer:c})},writeBuffer:(i,o,s)=>(s=Ll(s,o.length),console.error(".writeBuffer not implemented for FileHandle.fromBuffer"),Promise.resolve(0)),writeBufferSync:(i,o,s)=>(s=Ll(s,o.length),console.error(".writeSync not implemented for FileHandle.fromBuffer"),0),close:rp}}}(R5||(R5={}));var dl=function(e){return e.Float32="float32",e.Int8="int8",e.Int16="int16",e.Uint16="uint16",e}(dl||{});function Ule(e){return e===dl.Float32?4:e===dl.Int16||e===dl.Uint16?2:1}function iHe(e,t,n=0,r){return e===dl.Float32?new Float32Array(t,n,r):e===dl.Int16?new Int16Array(t,n,r):e===dl.Uint16?new Uint16Array(t,n,r):new Int8Array(t,n,r)}function L7(){return L7=le(function*(e,t,n,r,i,o){return yield t.readBuffer(n,e.readBuffer,r,i),e.elementByteSize>1&&(void 0!==o&&o!==$h.IsNativeEndianLittle||!$h.IsNativeEndianLittle)&&$h.flipByteOrder(e.readBuffer,e.valuesBuffer,r,e.elementByteSize,i),e.values}),L7.apply(this,arguments)}function j7(){return j7=le(function*(e){const{buffer:n}=yield e.readBuffer(0,1024),r=String.fromCharCode(n.readUInt8(208),n.readUInt8(209),n.readUInt8(210),n.readUInt8(211));if("MAP "!==r)throw new Error('ccp4 format error, missing "MAP " string');const i=[n.readUInt8(212),n.readUInt8(213)];let o=!1;68===i[0]&&65===i[1]?o=!0:17===i[0]&&17===i[1]?o=!1:n.readInt32LE(12)<=16&&(o=!0);const s=o?c=>n.readInt32LE(4*c):c=>n.readInt32BE(4*c),a=o?c=>n.readFloatLE(4*c):c=>n.readFloatBE(4*c);return{header:{NC:s(0),NR:s(1),NS:s(2),MODE:s(3),NCSTART:s(4),NRSTART:s(5),NSSTART:s(6),NX:s(7),NY:s(8),NZ:s(9),xLength:a(10),yLength:a(11),zLength:a(12),alpha:a(13),beta:a(14),gamma:a(15),MAPC:s(16),MAPR:s(17),MAPS:s(18),AMIN:a(19),AMAX:a(20),AMEAN:a(21),ISPG:s(22),NSYMBT:s(23),LSKFLG:s(24),SKWMAT:[],SKWTRN:[],userFlag1:s(39),userFlag2:s(40),originX:a(49),originY:a(50),originZ:a(51),MAP:r,MACHST:i,ARMS:a(54)},littleEndian:o}}),j7.apply(this,arguments)}function U7(){return U7=le(function*(e,t,n,r,i,o){if(Vle(e)){const s=3*i;yield n.readBuffer(r,t.readBuffer,i,s);const a=new Int8Array(t.valuesBuffer.buffer,s),l=(e.AMAX-e.AMIN)/255,c=.5*(e.AMIN+e.AMAX+l);for(let u=0,d=i;u<d;++u)t.values[u]=l*a[u]+c}else yield function sHe(e,t,n,r,i,o){return L7.apply(this,arguments)}(t,n,r,i,0,o)}),U7.apply(this,arguments)}function zle(e){switch(e){case 0:return dl.Int8;case 1:return dl.Int16;case 2:return dl.Float32;case 3:throw new Error("mode 3 unsupported, complex 16-bit integers");case 4:throw new Error("mode 4 unsupported, complex 32-bit reals");case 6:case 16:throw new Error("mode 16 unsupported, unsigned char * 3 (for rgb data, non-standard)")}throw new Error(`unknown mode '${e}'`)}function Vle(e){return-128===e.userFlag1&&127===e.userFlag2}function Hle(e){return Vle(e)?dl.Float32:zle(e.MODE)}function z7(){return z7=le(function*(e,t,n){yield n.update({message:"Parsing CCP4/MRC/MAP file..."});const{header:r,littleEndian:i}=yield function aHe(e){return j7.apply(this,arguments)}(e),o=function cHe(e){return 1024+e.NSYMBT}(r),s=zle(r.MODE),a=Hle(r),l=r.NC*r.NR*r.NS,u=l*Ule(s),d=function oHe(e,t){const n=Ule(t),r=new ArrayBuffer(n*e),i=$h.fromArrayBuffer(r),o=$h.IsNativeEndianLittle?r:new ArrayBuffer(n*e);return{type:t,elementByteSize:n,readBuffer:i,valuesBuffer:new Uint8Array(o),values:iHe(t,o)}}(l,a);return function lHe(e,t,n,r,i,o){U7.apply(this,arguments)}(r,d,e,o,u,i),{header:r,values:d.values,name:e.name}}),z7.apply(this,arguments)}const V7=512;function pHe(e){return{xStart:parseInt(e.substr(10,5)),yStart:parseInt(e.substr(15,5)),zStart:parseInt(e.substr(20,5)),xExtent:parseInt(e.substr(32,5)),yExtent:parseInt(e.substr(38,5)),zExtent:parseInt(e.substr(42,5)),xRate:parseInt(e.substr(52,5)),yRate:parseInt(e.substr(58,5)),zRate:parseInt(e.substr(62,5)),xlen:parseFloat(e.substr(73,10)),ylen:parseFloat(e.substr(83,10)),zlen:parseFloat(e.substr(93,10)),alpha:parseFloat(e.substr(103,10)),beta:parseFloat(e.substr(113,10)),gamma:parseFloat(e.substr(123,10)),divisor:parseFloat(e.substr(138,12)),summand:parseInt(e.substr(155,8)),sigma:parseFloat(e.substr(170,12))}}function hHe(e,t){const n=t?i=>e.readInt16LE(2*i):i=>e.readInt16BE(2*i),r=1/n(17);return{xStart:n(0),yStart:n(1),zStart:n(2),xExtent:n(3),yExtent:n(4),zExtent:n(5),xRate:n(6),yRate:n(7),zRate:n(8),xlen:n(9)*r,ylen:n(10)*r,zlen:n(11)*r,alpha:n(12)*r,beta:n(13)*r,gamma:n(14)*r,divisor:n(15)/100,summand:n(16),sigma:void 0}}function Gle(e){const{xExtent:t,yExtent:n,zExtent:r}=e;return{xBlocks:Math.ceil(t/8),yBlocks:Math.ceil(n/8),zBlocks:Math.ceil(r/8)}}function H7(){return H7=le(function*(e){const{buffer:t}=yield e.readBuffer(0,V7),n=String.fromCharCode.apply(null,t),r=n.startsWith(":-)"),i=r||100===t.readInt16LE(36);return{header:r?pHe(n):hHe(t,i),littleEndian:i}}),H7.apply(this,arguments)}function G7(){return G7=le(function*(e,t,n,r){r||$h.flipByteOrderInPlace2(t.buffer);const{divisor:i,summand:o,xExtent:s,yExtent:a,zExtent:l}=e,{xBlocks:c,yBlocks:u,zBlocks:d}=Gle(e);let f=0;for(let p=0;p<d;++p)for(let m=0;m<u;++m)for(let h=0;h<c;++h)for(let g=0;g<8;++g){const y=8*p+g;for(let v=0;v<8;++v){const x=8*m+v;for(let _=0;_<8;++_){const w=8*h+_;if(!(w<s&&x<a&&y<l)){f+=8-_;break}n[(w*a+x)*l+y]=(t[f]-o)/i,++f}}}}),G7.apply(this,arguments)}function q7(){return q7=le(function*(e,t,n){yield n.update({message:"Parsing DSN6/BRIX file..."});const{header:r,littleEndian:i}=yield function mHe(e){return H7.apply(this,arguments)}(e),{buffer:o}=yield e.readBuffer(V7,t-V7),{valueCount:s}=function yHe(e){const{xExtent:t,yExtent:n,zExtent:r}=e,{xBlocks:i,yBlocks:o,zBlocks:s}=Gle(e),l=8*i*o*8*s*8;return{count:l,byteCount:1*l,valueCount:t*n*r}}(r),a=new Float32Array(s);return yield function gHe(e,t,n,r){return G7.apply(this,arguments)}(r,o,a,i),{header:r,values:a,name:e.name}}),q7.apply(this,arguments)}const SHe=new Set(Object.keys({char:1,uchar:1,short:2,ushort:2,int:4,uint:4,float:4,double:8,int8:1,uint8:1,int16:2,uint16:2,int32:4,uint32:4,float32:4,float64:8}));function W7(e){if(!SHe.has(e))throw new Error(`unknown ply type '${e}'`);return e}function qle(e){switch(e){case"char":case"uchar":case"int8":case"uint8":case"short":case"ushort":case"int16":case"uint16":case"int":case"uint":case"int32":case"uint32":return ce.Schema.int;case"float":case"double":case"float32":case"float64":return ce.Schema.float}}function THe(e,t){const{elements:n,tokenizer:r}=e,{count:i,properties:o}=t,s=o.length,a=[],l=[],c=[],u=new Map;for(let d=0,f=s;d<f;++d){const p=ot.create(r.data,2*i);c.push(p)}for(let d=0,f=i;d<f;++d)for(let p=0,m=s;p<m;++p)kt.skipWhitespace(r),kt.markStart(r),kt.eatValue(r),ot.addUnchecked(c[p],r.tokenStart,r.tokenEnd);for(let d=0,f=s;d<f;++d){const{type:p,name:m}=o[d],h=HU(c[d],qle(p));a.push(m),l.push(p),u.set(m,h)}n.push({kind:"table",rowCount:i,propertyNames:a,propertyTypes:l,getProperty:d=>u.get(d)})}function DHe(e,t){const{elements:n,tokenizer:r}=e,{count:i,property:o}=t,s=ot.create(r.data,2*i*3),a=new Uint32Array(i+1);let l=0;for(let d=0,f=i;d<f;++d){for(kt.skipWhitespace(r),kt.markStart(r);10!==kt.skipWhitespace(r);)++l,kt.markStart(r),kt.eatValue(r),ot.addToken(s,r);a[d+1]=l}const c={entries:[],count:0},u=HU(s,qle(o.dataType));n.push({kind:"list",rowCount:i,name:o.name,type:o.dataType,value:d=>{const f=a[d]+1,p=u.value(f-1);for(let m=f,h=f+p;m<h;++m)c.entries[m-f]=u.value(m);return c.count=p,c}})}function $7(){return $7=le(function*(e,t){const n=function wHe(e,t){return{data:e,tokenizer:kt(e),runtimeCtx:t,comments:[],elementSpecs:[],elements:[]}}(e,t);t.update({message:"Parsing...",current:0,max:e.length}),function IHe(e){const{tokenizer:t,comments:n,elementSpecs:r}=e;!function AHe(e){const t=e.data.indexOf("end_header",e.position);if(-1===t)throw new Error("no 'end_header' record found");e.tokenStart=e.position,e.tokenEnd=t,e.position=t,kt.eatLine(e)}(t);const i=kt.getTokenString(t).split(/\r?\n/);if("ply"!==i[0])throw new Error("data not starting with 'ply'");if("format ascii 1.0"!==i[1])throw new Error("format not 'ascii 1.0'");let o,s,a;function l(){if(void 0!==o&&void 0!==s&&void 0!==a){let c=!1;for(let u=0,d=a.length;u<d;++u)if("list"===a[u].kind){c=!0;break}r.push(c?{kind:"list",name:o,count:s,property:a[0]}:{kind:"table",name:o,count:s,properties:a})}}for(let c=2,u=i.length;c<u;++c){const d=i[c],f=d.split(" ");if(d.startsWith("comment"))n.push(d.substr(8));else if(d.startsWith("element"))l(),a=[],o=f[1],s=parseInt(f[2]);else if(d.startsWith("property")){if(void 0===a)throw new Error("properties outside of element");a.push("list"===f[1]?{kind:"list",countType:W7(f[2]),dataType:W7(f[3]),name:f[4]}:{kind:"column",type:W7(f[1]),name:f[2]})}else d.startsWith("end_header")?l():console.warn("unknown header line")}}(n),function EHe(e){const{elementSpecs:t}=e;for(let n=0,r=t.length;n<r;++n){const i=t[n];"table"===i.kind?THe(e,i):"list"===i.kind&&DHe(e,i)}}(n);const{elements:r,elementSpecs:i,comments:o}=n,a=function CHe(e,t,n){const r=new Map;for(let i=0,o=t.length;i<o;++i)r.set(t[i],e[i]);return{comments:n,elementNames:t,getElement:i=>r.get(i)}}(r,i.map(l=>l.name),o);return qi.success(a)}),$7.apply(this,arguments)}const{readLine:N5,skipWhitespace:Wle,eatValue:$le,eatLine:MHe,markStart:Y7}=kt,F5=/\s+/,RHe=/(^\*|REMARK)*/;function FHe(e,t){return X7.apply(this,arguments)}function X7(){return X7=le(function*(e,t){const{tokenizer:n}=e,r=ot.create(n.data,2*t),i=ot.create(n.data,2*t),o=ot.create(n.data,2*t),s=ot.create(n.data,2*t),a=ot.create(n.data,2*t),l=ot.create(n.data,2*t),c=ot.create(n.data,2*t),u=ot.create(n.data,2*t),{position:d}=n,f=N5(n).trim();n.position=d;const p=7===f.split(F5).length,m=p?6:8,{length:h}=n;let g=0;return yield G0(e.runtimeCtx,1e5,void 0,y=>{const v=Math.min(t-g,y);for(let x=0;x<v;++x){for(let _=0;_<m;++_)if(Wle(n),Y7(n),$le(n),p)switch(_){case 0:ot.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:ot.addUnchecked(o,n.tokenStart,n.tokenEnd);break;case 2:ot.addUnchecked(a,n.tokenStart,n.tokenEnd);break;case 3:ot.addUnchecked(l,n.tokenStart,n.tokenEnd);break;case 4:ot.addUnchecked(c,n.tokenStart,n.tokenEnd);break;case 5:ot.addUnchecked(u,n.tokenStart,n.tokenEnd)}else switch(_){case 0:ot.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:ot.addUnchecked(i,n.tokenStart,n.tokenEnd);break;case 2:ot.addUnchecked(o,n.tokenStart,n.tokenEnd);break;case 3:ot.addUnchecked(s,n.tokenStart,n.tokenEnd);break;case 4:ot.addUnchecked(a,n.tokenStart,n.tokenEnd);break;case 5:ot.addUnchecked(l,n.tokenStart,n.tokenEnd);break;case 6:ot.addUnchecked(c,n.tokenStart,n.tokenEnd);break;case 7:ot.addUnchecked(u,n.tokenStart,n.tokenEnd)}MHe(n),Y7(n)}return g+=v,v},y=>y.update({message:"Parsing...",current:n.position,max:h})),{count:t,atomId:Pn(r)(ce.Schema.int),segmentName:p?Pn(o)(ce.Schema.str):Pn(i)(ce.Schema.str),residueId:Pn(o)(ce.Schema.int),residueName:p?Pn(o)(ce.Schema.str):Pn(s)(ce.Schema.str),atomName:Pn(a)(ce.Schema.str),atomType:Pn(l)(ce.Schema.str),charge:Pn(c)(ce.Schema.float),mass:Pn(u)(ce.Schema.float)}}),X7.apply(this,arguments)}function OHe(e,t){return K7.apply(this,arguments)}function K7(){return K7=le(function*(e,t){const{tokenizer:n}=e,r=ot.create(n.data,2*t),i=ot.create(n.data,2*t),{length:o}=n;let s=0;return yield G0(e.runtimeCtx,10,void 0,a=>{const l=Math.min(t-s,a);for(let c=0;c<l;++c)for(let u=0;u<2;++u)switch(Wle(n),Y7(n),$le(n),u){case 0:ot.addUnchecked(r,n.tokenStart,n.tokenEnd);break;case 1:ot.addUnchecked(i,n.tokenStart,n.tokenEnd)}return s+=l,l},a=>a.update({message:"Parsing...",current:n.position,max:o})),{count:t,atomIdA:Pn(r)(ce.Schema.int),atomIdB:Pn(i)(ce.Schema.int)}}),K7.apply(this,arguments)}function BHe(e,t){const n=[];for(let r=0;r<t;++r){const i=N5(e.tokenizer);n.push(i.replace(RHe,"").trim())}return n}function Z7(){return Z7=le(function*(e,t){const n=kt(e),r=function NHe(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t);let i,o,s;const a=N5(r.tokenizer).trim();for(;n.tokenEnd<n.length;){const c=N5(r.tokenizer).trim();if(c.includes("!NTITLE"))i=BHe(r,parseInt(c.split(F5)[0]));else if(c.includes("!NATOM")){const u=parseInt(c.split(F5)[0]);o=yield FHe(r,u)}else{if(c.includes("!NBOND")){const u=parseInt(c.split(F5)[0]);s=yield OHe(r,u);break}c.includes("!NTHETA")||c.includes("!NPHI")||c.includes("!NIMPHI")||c.includes("!NDON")||c.includes("!NACC")||c.includes("!NNB")||c.includes("!NGRP NST2")||c.includes("!MOLNT")||c.includes("!NUMLP NUMLPH")||c.includes("!NCRTERM")}}return void 0===i&&(i=[]),void 0===o?qi.error("no atoms data"):void 0===s?qi.error("no bonds data"):qi.success({id:a,title:i,atoms:o,bonds:s})}),Z7.apply(this,arguments)}var vo,Q3,_a;!function(e){function n(i){var o;return(o=class{static is(a){return!!a&&i===a.type}constructor(a,l){this.data=a,this.id=oo.create22(),this.type=i,this.label=l&&l.label||i.name,this.description=l&&l.description}}).type=i,o}e.factory=function t(){return i=>n(i)},e.create=n,e.hasTag=function r(i,o){if(!i.tags)return!1;for(const s of i.tags)if(s===o)return!0;return!1},e.Null={id:oo.create22(),type:{name:"Null",typeClass:"Null"},data:void 0,label:"Null"}}(vo||(vo={})),function(e){e.is=function t(r){return!!(r&&r.transform&&r.parent&&r.status)},e.resolve=function n(r,i){const o="string"==typeof i?i:e.is(i)?i.transform.ref:i.ref;return r.cells.get(o)}}(Q3||(Q3={}));class Yle{get cell(){var t;return null===(t=this.state)||void 0===t?void 0:t.cells.get(this.ref)}get obj(){var t,n;return null===(n=null===(t=this.state)||void 0===t?void 0:t.cells.get(this.ref))||void 0===n?void 0:n.obj}get data(){var t;return null===(t=this.obj)||void 0===t?void 0:t.data}update(t,n){if(!this.state)throw new Error("To use update() from StateObjectSelector, 'state' must be defined.");return n||(n=this.state.build()),(n||this.state.build()).to(this).update(t),n}checkValid(){if(!this.state)throw new Error("Unassigned State.");const t=this.cell;if(!t)throw new Error("Not created at all. Did you await/then the corresponding state update?");if("ok"===t.status)return!0;throw"error"===t.status?new Error(t.errorText):t.obj===vo.Null?new Error("The object is Null."):new Error("Unresolved. Did you await/then the corresponding state update?")}get isOk(){const t=this.cell;return t&&"ok"===t.status&&t.obj!==vo.Null}constructor(t,n){this.ref=t,this.state=n}}!function(e){function n(i,o){if(o)return Q3.is(o)?o:"string"==typeof o?i.cells.get(o):o.cell}e.resolveRef=function t(i){var o;if(i)return"string"==typeof i?i:Q3.is(i)?i.transform.ref:null===(o=i.cell)||void 0===o?void 0:o.transform.ref},e.resolve=n,e.resolveAndCheck=function r(i,o){const s=n(i,o);if(s&&s.obj&&"ok"===s.status)return s}}(_a||(_a={}));var J3="delete",Es=5,xp=1<<Es,Lu=xp-1,zi={};function _p(e){e&&(e.value=!0)}function J7(){}function Iw(e){return void 0===e.size&&(e.size=e.__iterate(Xle)),e.size}function M1(e,t){if("number"!=typeof t){var n=t>>>0;if(""+n!==t||4294967295===n)return NaN;t=n}return t<0?Iw(e)+t:t}function Xle(){return!0}function eD(e,t,n){return(0===e&&!Zle(e)||void 0!==n&&e<=-n)&&(void 0===t||void 0!==n&&t>=n)}function Ew(e,t){return Kle(e,t,0)}function tD(e,t){return Kle(e,t,t)}function Kle(e,t,n){return void 0===e?n:Zle(e)?t===1/0?t:0|Math.max(0,t+e):void 0===t||t===e?e:0|Math.min(t,e)}function Zle(e){return e<0||0===e&&1/e==-1/0}var Qle="@@__IMMUTABLE_ITERABLE__@@";function ju(e){return!(!e||!e[Qle])}var Jle="@@__IMMUTABLE_KEYED__@@";function fs(e){return!(!e||!e[Jle])}var ece="@@__IMMUTABLE_INDEXED__@@";function Jc(e){return!(!e||!e[ece])}function nD(e){return fs(e)||Jc(e)}var aa=function(t){return ju(t)?t:zu(t)},Sp=function(e){function t(n){return fs(n)?n:R1(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(aa),p_=function(e){function t(n){return Jc(n)?n:Ip(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(aa),Tw=function(e){function t(n){return ju(n)&&!nD(n)?n:kw(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(aa);aa.Keyed=Sp,aa.Indexed=p_,aa.Set=Tw;var tce="@@__IMMUTABLE_SEQ__@@";function O5(e){return!(!e||!e[tce])}var nce="@@__IMMUTABLE_RECORD__@@";function h_(e){return!(!e||!e[nce])}function Cp(e){return ju(e)||h_(e)}var Dw="@@__IMMUTABLE_ORDERED__@@";function wp(e){return!(!e||!e[Dw])}var rD=0,Yh=1,Ap=2,eV="function"==typeof Symbol&&Symbol.iterator,rce="@@iterator",B5=eV||rce,ao=function(t){this.next=t};function Ts(e,t,n,r){var i=0===e?t:1===e?n:[t,n];return r?r.value=i:r={value:i,done:!1},r}function Uu(){return{value:void 0,done:!0}}function tV(e){return!!Array.isArray(e)||!!L5(e)}function ice(e){return e&&"function"==typeof e.next}function nV(e){var t=L5(e);return t&&t.call(e)}function L5(e){var t=e&&(eV&&e[eV]||e[rce]);if("function"==typeof t)return t}ao.prototype.toString=function(){return"[Iterator]"},ao.KEYS=rD,ao.VALUES=Yh,ao.ENTRIES=Ap,ao.prototype.inspect=ao.prototype.toSource=function(){return this.toString()},ao.prototype[B5]=function(){return this};var Pw=Object.prototype.hasOwnProperty;function rV(e){return!(!Array.isArray(e)&&"string"!=typeof e)||e&&"object"==typeof e&&Number.isInteger(e.length)&&e.length>=0&&(0===e.length?1===Object.keys(e).length:e.hasOwnProperty(e.length-1))}var zu=function(e){function t(n){return null==n?oV():Cp(n)?n.toSeq():function HHe(e){var t=aV(e);if(t)return function UHe(e){var t=L5(e);return t&&t===e.entries}(e)?t.fromEntrySeq():function zHe(e){var t=L5(e);return t&&t===e.keys}(e)?t.toSetSeq():t;if("object"==typeof e)return new iV(e);throw new TypeError("Expected Array or collection object of values, or keyed object: "+e)}(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq {","}")},t.prototype.cacheResult=function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},t.prototype.__iterate=function(r,i){var o=this._cache;if(o){for(var s=o.length,a=0;a!==s;){var l=o[i?s-++a:a++];if(!1===r(l[1],l[0],this))break}return a}return this.__iterateUncached(r,i)},t.prototype.__iterator=function(r,i){var o=this._cache;if(o){var s=o.length,a=0;return new ao(function(){if(a===s)return{value:void 0,done:!0};var l=o[i?s-++a:a++];return Ts(r,l[0],l[1])})}return this.__iteratorUncached(r,i)},t}(aa),R1=function(e){function t(n){return null==n?oV().toKeyedSeq():ju(n)?fs(n)?n.toSeq():n.fromEntrySeq():h_(n)?n.toSeq():sV(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toKeyedSeq=function(){return this},t}(zu),Ip=function(e){function t(n){return null==n?oV():ju(n)?fs(n)?n.entrySeq():n.toIndexedSeq():h_(n)?n.toSeq().entrySeq():sce(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return t(arguments)},t.prototype.toIndexedSeq=function(){return this},t.prototype.toString=function(){return this.__toString("Seq [","]")},t}(zu),kw=function(e){function t(n){return(ju(n)&&!nD(n)?n:Ip(n)).toSetSeq()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return t(arguments)},t.prototype.toSetSeq=function(){return this},t}(zu);zu.isSeq=O5,zu.Keyed=R1,zu.Set=kw,zu.Indexed=Ip,zu.prototype[tce]=!0;var m_=function(e){function t(n){this._array=n,this.size=n.length}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r,i){return this.has(r)?this._array[M1(this,r)]:i},t.prototype.__iterate=function(r,i){for(var o=this._array,s=o.length,a=0;a!==s;){var l=i?s-++a:a++;if(!1===r(o[l],l,this))break}return a},t.prototype.__iterator=function(r,i){var o=this._array,s=o.length,a=0;return new ao(function(){if(a===s)return{value:void 0,done:!0};var l=i?s-++a:a++;return Ts(r,l,o[l])})},t}(Ip),iV=function(e){function t(n){var r=Object.keys(n).concat(Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n):[]);this._object=n,this._keys=r,this.size=r.length}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r,i){return void 0===i||this.has(r)?this._object[r]:i},t.prototype.has=function(r){return Pw.call(this._object,r)},t.prototype.__iterate=function(r,i){for(var o=this._object,s=this._keys,a=s.length,l=0;l!==a;){var c=s[i?a-++l:l++];if(!1===r(o[c],c,this))break}return l},t.prototype.__iterator=function(r,i){var o=this._object,s=this._keys,a=s.length,l=0;return new ao(function(){if(l===a)return{value:void 0,done:!0};var c=s[i?a-++l:l++];return Ts(r,c,o[c])})},t}(R1);iV.prototype[Dw]=!0;var oce,VHe=function(e){function t(n){this._collection=n,this.size=n.length||n.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.__iterateUncached=function(r,i){if(i)return this.cacheResult().__iterate(r,i);var s=nV(this._collection),a=0;if(ice(s))for(var l;!(l=s.next()).done&&!1!==r(l.value,a++,this););return a},t.prototype.__iteratorUncached=function(r,i){if(i)return this.cacheResult().__iterator(r,i);var s=nV(this._collection);if(!ice(s))return new ao(Uu);var a=0;return new ao(function(){var l=s.next();return l.done?l:Ts(r,a++,l.value)})},t}(Ip);function oV(){return oce||(oce=new m_([]))}function sV(e){var t=aV(e);if(t)return t.fromEntrySeq();if("object"==typeof e)return new iV(e);throw new TypeError("Expected Array or collection object of [k, v] entries, or keyed object: "+e)}function sce(e){var t=aV(e);if(t)return t;throw new TypeError("Expected Array or collection object of values: "+e)}function aV(e){return rV(e)?new m_(e):tV(e)?new VHe(e):void 0}var ace="@@__IMMUTABLE_MAP__@@";function j5(e){return!(!e||!e[ace])}function lV(e){return j5(e)&&wp(e)}function cV(e){return!(!e||"function"!=typeof e.equals||"function"!=typeof e.hashCode)}function oc(e,t){if(e===t||e!=e&&t!=t)return!0;if(!e||!t)return!1;if("function"==typeof e.valueOf&&"function"==typeof t.valueOf){if((e=e.valueOf())===(t=t.valueOf())||e!=e&&t!=t)return!0;if(!e||!t)return!1}return!!(cV(e)&&cV(t)&&e.equals(t))}var iD="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(t,n){var r=65535&(t|=0),i=65535&(n|=0);return r*i+((t>>>16)*i+r*(n>>>16)<<16>>>0)|0};function U5(e){return e>>>1&1073741824|3221225471&e}var GHe=Object.prototype.valueOf;function Id(e){if(null==e)return lce(e);if("function"==typeof e.hashCode)return U5(e.hashCode(e));var t=function KHe(e){return e.valueOf!==GHe&&"function"==typeof e.valueOf?e.valueOf(e):e}(e);if(null==t)return lce(t);switch(typeof t){case"boolean":return t?1108378657:1108378656;case"number":return function qHe(e){if(e!=e||e===1/0)return 0;var t=0|e;for(t!==e&&(t^=4294967295*e);e>4294967295;)t^=e/=4294967295;return U5(t)}(t);case"string":return t.length>ZHe?function WHe(e){var t=mV[e];return void 0===t&&(t=uV(e),hV===QHe&&(hV=0,mV={}),hV++,mV[e]=t),t}(t):uV(t);case"object":case"function":return function YHe(e){var t;if(dV&&void 0!==(t=fV.get(e))||void 0!==(t=e[g_])||!uce&&(void 0!==(t=e.propertyIsEnumerable&&e.propertyIsEnumerable[g_])||(t=function XHe(e){if(e&&e.nodeType>0)switch(e.nodeType){case 1:return e.uniqueID;case 9:return e.documentElement&&e.documentElement.uniqueID}}(e),void 0!==t)))return t;if(t=dce(),dV)fV.set(e,t);else{if(void 0!==cce&&!1===cce(e))throw new Error("Non-extensible objects are not allowed as keys.");if(uce)Object.defineProperty(e,g_,{enumerable:!1,configurable:!1,writable:!1,value:t});else if(void 0!==e.propertyIsEnumerable&&e.propertyIsEnumerable===e.constructor.prototype.propertyIsEnumerable)e.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},e.propertyIsEnumerable[g_]=t;else{if(void 0===e.nodeType)throw new Error("Unable to set a non-enumerable property on object.");e[g_]=t}}return t}(t);case"symbol":return function $He(e){var t=fce[e];return void 0!==t||(t=dce(),fce[e]=t),t}(t);default:if("function"==typeof t.toString)return uV(t.toString());throw new Error("Value type "+typeof t+" cannot be hashed.")}}function lce(e){return null===e?1108378658:1108378659}function uV(e){for(var t=0,n=0;n<e.length;n++)t=31*t+e.charCodeAt(n)|0;return U5(t)}var cce=Object.isExtensible,uce=function(){try{return Object.defineProperty({},"@",{}),!0}catch{return!1}}();function dce(){var e=++pV;return 1073741824&pV&&(pV=0),e}var fV,dV="function"==typeof WeakMap;dV&&(fV=new WeakMap);var fce=Object.create(null),pV=0,g_="__immutablehash__";"function"==typeof Symbol&&(g_=Symbol(g_));var ZHe=16,QHe=255,hV=0,mV={},z5=function(e){function t(n,r){this._iter=n,this._useKeys=r,this.size=n.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r,i){return this._iter.get(r,i)},t.prototype.has=function(r){return this._iter.has(r)},t.prototype.valueSeq=function(){return this._iter.valueSeq()},t.prototype.reverse=function(){var r=this,i=gV(this,!0);return this._useKeys||(i.valueSeq=function(){return r._iter.toSeq().reverse()}),i},t.prototype.map=function(r,i){var o=this,s=yce(this,r,i);return this._useKeys||(s.valueSeq=function(){return o._iter.toSeq().map(r,i)}),s},t.prototype.__iterate=function(r,i){var o=this;return this._iter.__iterate(function(s,a){return r(s,a,o)},i)},t.prototype.__iterator=function(r,i){return this._iter.__iterator(r,i)},t}(R1);z5.prototype[Dw]=!0;var pce=function(e){function t(n){this._iter=n,this.size=n.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.includes=function(r){return this._iter.includes(r)},t.prototype.__iterate=function(r,i){var o=this,s=0;return i&&Iw(this),this._iter.__iterate(function(a){return r(a,i?o.size-++s:s++,o)},i)},t.prototype.__iterator=function(r,i){var o=this,s=this._iter.__iterator(Yh,i),a=0;return i&&Iw(this),new ao(function(){var l=s.next();return l.done?l:Ts(r,i?o.size-++a:a++,l.value,l)})},t}(Ip),hce=function(e){function t(n){this._iter=n,this.size=n.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.has=function(r){return this._iter.includes(r)},t.prototype.__iterate=function(r,i){var o=this;return this._iter.__iterate(function(s){return r(s,s,o)},i)},t.prototype.__iterator=function(r,i){var o=this._iter.__iterator(Yh,i);return new ao(function(){var s=o.next();return s.done?s:Ts(r,s.value,s.value,s)})},t}(kw),mce=function(e){function t(n){this._iter=n,this.size=n.size}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.entrySeq=function(){return this._iter.toSeq()},t.prototype.__iterate=function(r,i){var o=this;return this._iter.__iterate(function(s){if(s){Sce(s);var a=ju(s);return r(a?s.get(1):s[1],a?s.get(0):s[0],o)}},i)},t.prototype.__iterator=function(r,i){var o=this._iter.__iterator(Yh,i);return new ao(function(){for(;;){var s=o.next();if(s.done)return s;var a=s.value;if(a){Sce(a);var l=ju(a);return Ts(r,l?a.get(0):a[0],l?a.get(1):a[1],s)}}})},t}(R1);function gce(e){var t=ug(e);return t._iter=e,t.size=e.size,t.flip=function(){return e},t.reverse=function(){var n=e.reverse.apply(this);return n.flip=function(){return e.reverse()},n},t.has=function(n){return e.includes(n)},t.includes=function(n){return e.has(n)},t.cacheResult=vV,t.__iterateUncached=function(n,r){var i=this;return e.__iterate(function(o,s){return!1!==n(s,o,i)},r)},t.__iteratorUncached=function(n,r){if(n===Ap){var i=e.__iterator(n,r);return new ao(function(){var o=i.next();if(!o.done){var s=o.value[0];o.value[0]=o.value[1],o.value[1]=s}return o})}return e.__iterator(n===Yh?rD:Yh,r)},t}function yce(e,t,n){var r=ug(e);return r.size=e.size,r.has=function(i){return e.has(i)},r.get=function(i,o){var s=e.get(i,zi);return s===zi?o:t.call(n,s,i,e)},r.__iterateUncached=function(i,o){var s=this;return e.__iterate(function(a,l,c){return!1!==i(t.call(n,a,l,c),l,s)},o)},r.__iteratorUncached=function(i,o){var s=e.__iterator(Ap,o);return new ao(function(){var a=s.next();if(a.done)return a;var l=a.value,c=l[0];return Ts(i,c,t.call(n,l[1],c,e),a)})},r}function gV(e,t){var n=this,r=ug(e);return r._iter=e,r.size=e.size,r.reverse=function(){return e},e.flip&&(r.flip=function(){var i=gce(e);return i.reverse=function(){return e.flip()},i}),r.get=function(i,o){return e.get(t?i:-1-i,o)},r.has=function(i){return e.has(t?i:-1-i)},r.includes=function(i){return e.includes(i)},r.cacheResult=vV,r.__iterate=function(i,o){var s=this,a=0;return o&&Iw(e),e.__iterate(function(l,c){return i(l,t?c:o?s.size-++a:a++,s)},!o)},r.__iterator=function(i,o){var s=0;o&&Iw(e);var a=e.__iterator(Ap,!o);return new ao(function(){var l=a.next();if(l.done)return l;var c=l.value;return Ts(i,t?c[0]:o?n.size-++s:s++,c[1],l)})},r}function bce(e,t,n,r){var i=ug(e);return r&&(i.has=function(o){var s=e.get(o,zi);return s!==zi&&!!t.call(n,s,o,e)},i.get=function(o,s){var a=e.get(o,zi);return a!==zi&&t.call(n,a,o,e)?a:s}),i.__iterateUncached=function(o,s){var a=this,l=0;return e.__iterate(function(c,u,d){if(t.call(n,c,u,d))return l++,o(c,r?u:l-1,a)},s),l},i.__iteratorUncached=function(o,s){var a=e.__iterator(Ap,s),l=0;return new ao(function(){for(;;){var c=a.next();if(c.done)return c;var u=c.value,d=u[0],f=u[1];if(t.call(n,f,d,e))return Ts(o,r?d:l++,f,c)}})},i}function yV(e,t,n,r){var i=e.size;if(eD(t,n,i))return e;var o=Ew(t,i),s=tD(n,i);if(o!=o||s!=s)return yV(e.toSeq().cacheResult(),t,n,r);var l,a=s-o;a==a&&(l=a<0?0:a);var c=ug(e);return c.size=0===l?l:e.size&&l||void 0,!r&&O5(e)&&l>=0&&(c.get=function(u,d){return(u=M1(this,u))>=0&&u<l?e.get(u+o,d):d}),c.__iterateUncached=function(u,d){var f=this;if(0===l)return 0;if(d)return this.cacheResult().__iterate(u,d);var p=0,m=!0,h=0;return e.__iterate(function(g,y){if(!m||!(m=p++<o))return h++,!1!==u(g,r?y:h-1,f)&&h!==l}),h},c.__iteratorUncached=function(u,d){if(0!==l&&d)return this.cacheResult().__iterator(u,d);if(0===l)return new ao(Uu);var f=e.__iterator(u,d),p=0,m=0;return new ao(function(){for(;p++<o;)f.next();if(++m>l)return{value:void 0,done:!0};var h=f.next();return r||u===Yh||h.done?h:Ts(u,m-1,u===rD?void 0:h.value[1],h)})},c}function vce(e,t,n,r){var i=ug(e);return i.__iterateUncached=function(o,s){var a=this;if(s)return this.cacheResult().__iterate(o,s);var l=!0,c=0;return e.__iterate(function(u,d,f){if(!l||!(l=t.call(n,u,d,f)))return c++,o(u,r?d:c-1,a)}),c},i.__iteratorUncached=function(o,s){var a=this;if(s)return this.cacheResult().__iterator(o,s);var l=e.__iterator(Ap,s),c=!0,u=0;return new ao(function(){var d,f,p;do{if((d=l.next()).done)return r||o===Yh?d:Ts(o,u++,o===rD?void 0:d.value[1],d);var m=d.value;f=m[0],p=m[1],c&&(c=t.call(n,p,f,a))}while(c);return o===Ap?d:Ts(o,f,p,d)})},i}function xce(e,t,n){var r=ug(e);return r.__iterateUncached=function(i,o){if(o)return this.cacheResult().__iterate(i,o);var s=0,a=!1;return function l(c,u){c.__iterate(function(d,f){return(!t||u<t)&&ju(d)?l(d,u+1):(s++,!1===i(d,n?f:s-1,r)&&(a=!0)),!a},o)}(e,0),s},r.__iteratorUncached=function(i,o){if(o)return this.cacheResult().__iterator(i,o);var s=e.__iterator(i,o),a=[],l=0;return new ao(function(){for(;s;){var c=s.next();if(!1===c.done){var u=c.value;if(i===Ap&&(u=u[1]),t&&!(a.length<t)||!ju(u))return n?c:Ts(i,l++,u,c);a.push(s),s=u.__iterator(i,o)}else s=a.pop()}return{value:void 0,done:!0}})},r}function Mw(e,t,n){t||(t=Cce);var r=fs(e),i=0,o=e.toSeq().map(function(s,a){return[a,s,i++,n?n(s,a,e):s]}).valueSeq().toArray();return o.sort(function(s,a){return t(s[3],a[3])||s[2]-a[2]}).forEach(r?function(s,a){o[a].length=2}:function(s,a){o[a]=s[1]}),r?R1(o):Jc(e)?Ip(o):kw(o)}function V5(e,t,n){if(t||(t=Cce),n){var r=e.toSeq().map(function(i,o){return[i,n(i,o,e)]}).reduce(function(i,o){return _ce(t,i[1],o[1])?o:i});return r&&r[0]}return e.reduce(function(i,o){return _ce(t,i,o)?o:i})}function _ce(e,t,n){var r=e(n,t);return 0===r&&n!==t&&(null==n||n!=n)||r>0}function H5(e,t,n,r){var i=ug(e),o=new m_(n).map(function(s){return s.size});return i.size=r?o.max():o.min(),i.__iterate=function(s,a){for(var c,l=this.__iterator(Yh,a),u=0;!(c=l.next()).done&&!1!==s(c.value,u++,this););return u},i.__iteratorUncached=function(s,a){var l=n.map(function(d){return d=aa(d),nV(a?d.reverse():d)}),c=0,u=!1;return new ao(function(){var d;return u||(d=l.map(function(f){return f.next()}),u=r?d.every(function(f){return f.done}):d.some(function(f){return f.done})),u?{value:void 0,done:!0}:Ts(s,c++,t.apply(null,d.map(function(f){return f.value})))})},i}function Qo(e,t){return e===t?e:O5(e)?t:e.constructor(t)}function Sce(e){if(e!==Object(e))throw new TypeError("Expected [K, V] tuple: "+e)}function bV(e){return fs(e)?Sp:Jc(e)?p_:Tw}function ug(e){return Object.create((fs(e)?R1:Jc(e)?Ip:kw).prototype)}function vV(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):zu.prototype.cacheResult.call(this)}function Cce(e,t){return void 0===e&&void 0===t?0:void 0===e?1:void 0===t?-1:e>t?1:e<t?-1:0}function dg(e,t){t=t||0;for(var n=Math.max(0,e.length-t),r=new Array(n),i=0;i<n;i++)r[i]=e[i+t];return r}function xV(e,t){if(!e)throw new Error(t)}function wf(e){xV(e!==1/0,"Cannot perform this action with an infinite size.")}function wce(e){if(rV(e)&&"string"!=typeof e)return e;if(wp(e))return e.toArray();throw new TypeError("Invalid keyPath: expected Ordered Collection or Array: "+e)}pce.prototype.cacheResult=z5.prototype.cacheResult=hce.prototype.cacheResult=mce.prototype.cacheResult=vV;var sGe=Object.prototype.toString;function N1(e){return"object"==typeof e&&(Cp(e)||Array.isArray(e)||function _V(e){if(!e||"object"!=typeof e||"[object Object]"!==sGe.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var n=t,r=Object.getPrototypeOf(t);null!==r;)n=r,r=Object.getPrototypeOf(n);return n===t}(e))}function oD(e){try{return"string"==typeof e?JSON.stringify(e):String(e)}catch{return JSON.stringify(e)}}function SV(e,t,n){return Cp(e)?e.get(t,n):function Ace(e,t){return Cp(e)?e.has(t):N1(e)&&Pw.call(e,t)}(e,t)?"function"==typeof e.get?e.get(t):e[t]:n}function G5(e){if(Array.isArray(e))return dg(e);var t={};for(var n in e)Pw.call(e,n)&&(t[n]=e[n]);return t}function y_(e,t,n,r){r||(r=n,n=void 0);var i=Tce(Cp(e),e,wce(t),0,n,r);return i===zi?n:i}function Tce(e,t,n,r,i,o){var s=t===zi;if(r===n.length){var a=s?i:t,l=o(a);return l===a?t:l}if(!s&&!N1(t))throw new TypeError("Cannot update within non-data-structure value in path ["+n.slice(0,r).map(oD)+"]: "+t);var c=n[r],u=s?zi:SV(t,c,zi),d=Tce(u===zi?e:Cp(u),u,n,r+1,i,o);return d===u?t:d===zi?function Ice(e,t){if(!N1(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Cp(e)){if(!e.remove)throw new TypeError("Cannot update immutable value without .remove() method: "+e);return e.remove(t)}if(!Pw.call(e,t))return e;var n=G5(e);return Array.isArray(n)?n.splice(t,1):delete n[t],n}(t,c):function Ece(e,t,n){if(!N1(e))throw new TypeError("Cannot update non-data-structure value: "+e);if(Cp(e)){if(!e.set)throw new TypeError("Cannot update immutable value without .set() method: "+e);return e.set(t,n)}if(Pw.call(e,t)&&n===e[t])return e;var r=G5(e);return r[t]=n,r}(s?e?Xh():{}:t,c,d)}function CV(e,t){return function Dce(e,t,n){return y_(e,t,zi,function(){return n})}(this,e,t)}function wV(e){return function Pce(e,t){return y_(e,t,function(){return zi})}(this,e)}function AV(e,t,n,r){return y_(e,[t],n,r)}function IV(e,t,n){return 1===arguments.length?e(this):AV(this,e,t,n)}function EV(e,t,n){return y_(this,e,t,n)}function kce(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return Rce(this,e)}function Mce(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if("function"!=typeof e)throw new TypeError("Invalid merger function: "+e);return Rce(this,t,e)}function Rce(e,t,n){for(var r=[],i=0;i<t.length;i++){var o=Sp(t[i]);0!==o.size&&r.push(o)}return 0===r.length?e:0!==e.toSeq().size||e.__ownerID||1!==r.length?e.withMutations(function(s){for(var a=n?function(c,u){AV(s,u,zi,function(d){return d===zi?c:n(d,c,u)})}:function(c,u){s.set(u,c)},l=0;l<r.length;l++)r[l].forEach(a)}):e.constructor(r[0])}function sD(e,t,n){return aD(e,t,function dGe(e){return function t(n,r,i){return N1(n)&&N1(r)&&function fGe(e,t){var n=zu(e),r=zu(t);return Jc(n)===Jc(r)&&fs(n)===fs(r)}(n,r)?aD(n,[r],t):e?e(n,r,i):r}}(n))}function aD(e,t,n){if(!N1(e))throw new TypeError("Cannot merge into non-data-structure value: "+e);if(Cp(e))return"function"==typeof n&&e.mergeWith?e.mergeWith.apply(e,[n].concat(t)):e.merge?e.merge.apply(e,t):e.concat.apply(e,t);for(var r=Array.isArray(e),i=e,o=r?p_:Sp,s=r?function(l){i===e&&(i=G5(i)),i.push(l)}:function(l,c){var u=Pw.call(i,c),d=u&&n?n(i[c],l,c):l;(!u||d!==i[c])&&(i===e&&(i=G5(i)),i[c]=d)},a=0;a<t.length;a++)o(t[a]).forEach(s);return i}function Nce(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return sD(this,e)}function Fce(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return sD(this,t,e)}function TV(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return y_(this,e,Xh(),function(r){return aD(r,t)})}function DV(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return y_(this,e,Xh(),function(r){return sD(r,t)})}function lD(e){var t=this.asMutable();return e(t),t.wasAltered()?t.__ensureOwner(this.__ownerID):this}function cD(){return this.__ownerID?this:this.__ensureOwner(new J7)}function uD(){return this.__ensureOwner()}function PV(){return this.__altered}var Af=function(e){function t(n){return null==n?Xh():j5(n)&&!wp(n)?n:Xh().withMutations(function(r){var i=e(n);wf(i.size),i.forEach(function(o,s){return r.set(s,o)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return Xh().withMutations(function(o){for(var s=0;s<r.length;s+=2){if(s+1>=r.length)throw new Error("Missing value for key: "+r[s]);o.set(r[s],r[s+1])}})},t.prototype.toString=function(){return this.__toString("Map {","}")},t.prototype.get=function(r,i){return this._root?this._root.get(0,void 0,r,i):i},t.prototype.set=function(r,i){return Lce(this,r,i)},t.prototype.remove=function(r){return Lce(this,r,zi)},t.prototype.deleteAll=function(r){var i=aa(r);return 0===i.size?this:this.withMutations(function(o){i.forEach(function(s){return o.remove(s)})})},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):Xh()},t.prototype.sort=function(r){return Nc(Mw(this,r))},t.prototype.sortBy=function(r,i){return Nc(Mw(this,i,r))},t.prototype.map=function(r,i){var o=this;return this.withMutations(function(s){s.forEach(function(a,l){s.set(l,r.call(i,a,l,o))})})},t.prototype.__iterator=function(r,i){return new pGe(this,r,i)},t.prototype.__iterate=function(r,i){var o=this,s=0;return this._root&&this._root.iterate(function(a){return s++,r(a[1],a[0],o)},i),s},t.prototype.__ensureOwner=function(r){return r===this.__ownerID?this:r?MV(this.size,this._root,r,this.__hash):0===this.size?Xh():(this.__ownerID=r,this.__altered=!1,this)},t}(Sp);Af.isMap=j5;var Ds=Af.prototype;Ds[ace]=!0,Ds[J3]=Ds.remove,Ds.removeAll=Ds.deleteAll,Ds.setIn=CV,Ds.removeIn=Ds.deleteIn=wV,Ds.update=IV,Ds.updateIn=EV,Ds.merge=Ds.concat=kce,Ds.mergeWith=Mce,Ds.mergeDeep=Nce,Ds.mergeDeepWith=Fce,Ds.mergeIn=TV,Ds.mergeDeepIn=DV,Ds.withMutations=lD,Ds.wasAltered=PV,Ds.asImmutable=uD,Ds["@@transducer/init"]=Ds.asMutable=cD,Ds["@@transducer/step"]=function(e,t){return e.set(t[0],t[1])},Ds["@@transducer/result"]=function(e){return e.asImmutable()};var dD=function(t,n){this.ownerID=t,this.entries=n};dD.prototype.get=function(t,n,r,i){for(var o=this.entries,s=0,a=o.length;s<a;s++)if(oc(r,o[s][0]))return o[s][1];return i},dD.prototype.update=function(t,n,r,i,o,s,a){for(var l=o===zi,c=this.entries,u=0,d=c.length;u<d&&!oc(i,c[u][0]);u++);var f=u<d;if(f?c[u][1]===o:l)return this;if(_p(a),(l||!f)&&_p(s),!l||1!==c.length){if(!f&&!l&&c.length>=vGe)return function hGe(e,t,n,r){e||(e=new J7);for(var i=new ly(e,Id(n),[n,r]),o=0;o<t.length;o++){var s=t[o];i=i.update(e,0,void 0,s[0],s[1])}return i}(t,c,i,o);var p=t&&t===this.ownerID,m=p?c:dg(c);return f?l?u===d-1?m.pop():m[u]=m.pop():m[u]=[i,o]:m.push([i,o]),p?(this.entries=m,this):new dD(t,m)}};var Rw=function(t,n,r){this.ownerID=t,this.bitmap=n,this.nodes=r};Rw.prototype.get=function(t,n,r,i){void 0===n&&(n=Id(r));var o=1<<((0===t?n:n>>>t)&Lu),s=this.bitmap;return s&o?this.nodes[Uce(s&o-1)].get(t+Es,n,r,i):i},Rw.prototype.update=function(t,n,r,i,o,s,a){void 0===r&&(r=Id(i));var l=(0===n?r:r>>>n)&Lu,c=1<<l,u=this.bitmap,d=!!(u&c);if(!d&&o===zi)return this;var f=Uce(u&c-1),p=this.nodes,m=d?p[f]:void 0,h=RV(m,t,n+Es,r,i,o,s,a);if(h===m)return this;if(!d&&h&&p.length>=xGe)return function gGe(e,t,n,r,i){for(var o=0,s=new Array(xp),a=0;0!==n;a++,n>>>=1)s[a]=1&n?t[o++]:void 0;return s[r]=i,new fD(e,o+1,s)}(t,p,u,l,h);if(d&&!h&&2===p.length&&jce(p[1^f]))return p[1^f];if(d&&h&&1===p.length&&jce(h))return h;var g=t&&t===this.ownerID,y=d?h?u:u^c:u|c,v=d?h?zce(p,f,h,g):function bGe(e,t,n){var r=e.length-1;if(n&&t===r)return e.pop(),e;for(var i=new Array(r),o=0,s=0;s<r;s++)s===t&&(o=1),i[s]=e[s+o];return i}(p,f,g):function yGe(e,t,n,r){var i=e.length+1;if(r&&t+1===i)return e[t]=n,e;for(var o=new Array(i),s=0,a=0;a<i;a++)a===t?(o[a]=n,s=-1):o[a]=e[a+s];return o}(p,f,h,g);return g?(this.bitmap=y,this.nodes=v,this):new Rw(t,y,v)};var fD=function(t,n,r){this.ownerID=t,this.count=n,this.nodes=r};fD.prototype.get=function(t,n,r,i){void 0===n&&(n=Id(r));var s=this.nodes[(0===t?n:n>>>t)&Lu];return s?s.get(t+Es,n,r,i):i},fD.prototype.update=function(t,n,r,i,o,s,a){void 0===r&&(r=Id(i));var l=(0===n?r:r>>>n)&Lu,u=this.nodes,d=u[l];if(o===zi&&!d)return this;var f=RV(d,t,n+Es,r,i,o,s,a);if(f===d)return this;var p=this.count;if(d){if(!f&&--p<_Ge)return function mGe(e,t,n,r){for(var i=0,o=0,s=new Array(n),a=0,l=1,c=t.length;a<c;a++,l<<=1){var u=t[a];void 0!==u&&a!==r&&(i|=l,s[o++]=u)}return new Rw(e,i,s)}(t,u,p,l)}else p++;var m=t&&t===this.ownerID,h=zce(u,l,f,m);return m?(this.count=p,this.nodes=h,this):new fD(t,p,h)};var Nw=function(t,n,r){this.ownerID=t,this.keyHash=n,this.entries=r};Nw.prototype.get=function(t,n,r,i){for(var o=this.entries,s=0,a=o.length;s<a;s++)if(oc(r,o[s][0]))return o[s][1];return i},Nw.prototype.update=function(t,n,r,i,o,s,a){void 0===r&&(r=Id(i));var l=o===zi;if(r!==this.keyHash)return l?this:(_p(a),_p(s),NV(this,t,n,r,[i,o]));for(var c=this.entries,u=0,d=c.length;u<d&&!oc(i,c[u][0]);u++);var f=u<d;if(f?c[u][1]===o:l)return this;if(_p(a),(l||!f)&&_p(s),l&&2===d)return new ly(t,this.keyHash,c[1^u]);var p=t&&t===this.ownerID,m=p?c:dg(c);return f?l?u===d-1?m.pop():m[u]=m.pop():m[u]=[i,o]:m.push([i,o]),p?(this.entries=m,this):new Nw(t,this.keyHash,m)};var ly=function(t,n,r){this.ownerID=t,this.keyHash=n,this.entry=r};ly.prototype.get=function(t,n,r,i){return oc(r,this.entry[0])?this.entry[1]:i},ly.prototype.update=function(t,n,r,i,o,s,a){var l=o===zi,c=oc(i,this.entry[0]);return(c?o===this.entry[1]:l)?this:(_p(a),l?void _p(s):c?t&&t===this.ownerID?(this.entry[1]=o,this):new ly(t,this.keyHash,[i,o]):(_p(s),NV(this,t,n,Id(i),[i,o])))},dD.prototype.iterate=Nw.prototype.iterate=function(e,t){for(var n=this.entries,r=0,i=n.length-1;r<=i;r++)if(!1===e(n[t?i-r:r]))return!1},Rw.prototype.iterate=fD.prototype.iterate=function(e,t){for(var n=this.nodes,r=0,i=n.length-1;r<=i;r++){var o=n[t?i-r:r];if(o&&!1===o.iterate(e,t))return!1}},ly.prototype.iterate=function(e,t){return e(this.entry)};var Bce,pGe=function(e){function t(n,r,i){this._type=r,this._reverse=i,this._stack=n._root&&Oce(n._root)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.next=function(){for(var r=this._type,i=this._stack;i;){var o=i.node,s=i.index++,a=void 0;if(o.entry){if(0===s)return kV(r,o.entry)}else if(o.entries){if(s<=(a=o.entries.length-1))return kV(r,o.entries[this._reverse?a-s:s])}else if(s<=(a=o.nodes.length-1)){var l=o.nodes[this._reverse?a-s:s];if(l){if(l.entry)return kV(r,l.entry);i=this._stack=Oce(l,i)}continue}i=this._stack=this._stack.__prev}return{value:void 0,done:!0}},t}(ao);function kV(e,t){return Ts(e,t[0],t[1])}function Oce(e,t){return{node:e,index:0,__prev:t}}function MV(e,t,n,r){var i=Object.create(Ds);return i.size=e,i._root=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Xh(){return Bce||(Bce=MV(0))}function Lce(e,t,n){var r,i;if(e._root){var o={value:!1},s={value:!1};if(r=RV(e._root,e.__ownerID,0,void 0,t,n,o,s),!s.value)return e;i=e.size+(o.value?n===zi?-1:1:0)}else{if(n===zi)return e;i=1,r=new dD(e.__ownerID,[[t,n]])}return e.__ownerID?(e.size=i,e._root=r,e.__hash=void 0,e.__altered=!0,e):r?MV(i,r):Xh()}function RV(e,t,n,r,i,o,s,a){return e?e.update(t,n,r,i,o,s,a):o===zi?e:(_p(a),_p(s),new ly(t,r,[i,o]))}function jce(e){return e.constructor===ly||e.constructor===Nw}function NV(e,t,n,r,i){if(e.keyHash===r)return new Nw(t,r,[e.entry,i]);var a,o=(0===n?e.keyHash:e.keyHash>>>n)&Lu,s=(0===n?r:r>>>n)&Lu,l=o===s?[NV(e,t,n+Es,r,i)]:(a=new ly(t,r,i),o<s?[e,a]:[a,e]);return new Rw(t,1<<o|1<<s,l)}function Uce(e){return e=(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459))+(e>>4)&252645135,127&(e+=e>>8)+(e>>16)}function zce(e,t,n,r){var i=r?e:dg(e);return i[t]=n,i}var vGe=xp/4,xGe=xp/2,_Ge=xp/4,Vce="@@__IMMUTABLE_LIST__@@";function FV(e){return!(!e||!e[Vce])}var cy=function(e){function t(n){var r=q5();if(null==n)return r;if(FV(n))return n;var i=e(n),o=i.size;return 0===o?r:(wf(o),o>0&&o<xp?hD(0,o,Es,null,new F1(i.toArray())):r.withMutations(function(s){s.setSize(o),i.forEach(function(a,l){return s.set(l,a)})}))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("List [","]")},t.prototype.get=function(r,i){if((r=M1(this,r))>=0&&r<this.size){var o=qce(this,r+=this._origin);return o&&o.array[r&Lu]}return i},t.prototype.set=function(r,i){return function SGe(e,t,n){if((t=M1(e,t))!=t)return e;if(t>=e.size||t<0)return e.withMutations(function(s){t<0?O1(s,t).set(0,n):O1(s,0,t+1).set(t,n)});var r=e._tail,i=e._root,o={value:!1};return(t+=e._origin)>=mD(e._capacity)?r=OV(r,e.__ownerID,0,t,n,o):i=OV(i,e.__ownerID,e._level,t,n,o),o.value?e.__ownerID?(e._root=i,e._tail=r,e.__hash=void 0,e.__altered=!0,e):hD(e._origin,e._capacity,e._level,i,r):e}(this,r,i)},t.prototype.remove=function(r){return this.has(r)?0===r?this.shift():r===this.size-1?this.pop():this.splice(r,1):this},t.prototype.insert=function(r,i){return this.splice(r,0,i)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=Es,this._root=this._tail=this.__hash=void 0,this.__altered=!0,this):q5()},t.prototype.push=function(){var r=arguments,i=this.size;return this.withMutations(function(o){O1(o,0,i+r.length);for(var s=0;s<r.length;s++)o.set(i+s,r[s])})},t.prototype.pop=function(){return O1(this,0,-1)},t.prototype.unshift=function(){var r=arguments;return this.withMutations(function(i){O1(i,-r.length);for(var o=0;o<r.length;o++)i.set(o,r[o])})},t.prototype.shift=function(){return O1(this,1)},t.prototype.concat=function(){for(var r=arguments,i=[],o=0;o<arguments.length;o++){var s=r[o],a=e("string"!=typeof s&&tV(s)?s:[s]);0!==a.size&&i.push(a)}return 0===i.length?this:0!==this.size||this.__ownerID||1!==i.length?this.withMutations(function(l){i.forEach(function(c){return c.forEach(function(u){return l.push(u)})})}):this.constructor(i[0])},t.prototype.setSize=function(r){return O1(this,0,r)},t.prototype.map=function(r,i){var o=this;return this.withMutations(function(s){for(var a=0;a<o.size;a++)s.set(a,r.call(i,s.get(a),a,o))})},t.prototype.slice=function(r,i){var o=this.size;return eD(r,i,o)?this:O1(this,Ew(r,o),tD(i,o))},t.prototype.__iterator=function(r,i){var o=i?this.size:0,s=Hce(this,i);return new ao(function(){var a=s();return a===pD?{value:void 0,done:!0}:Ts(r,i?--o:o++,a)})},t.prototype.__iterate=function(r,i){for(var a,o=i?this.size:0,s=Hce(this,i);(a=s())!==pD&&!1!==r(a,i?--o:o++,this););return o},t.prototype.__ensureOwner=function(r){return r===this.__ownerID?this:r?hD(this._origin,this._capacity,this._level,this._root,this._tail,r,this.__hash):0===this.size?q5():(this.__ownerID=r,this.__altered=!1,this)},t}(p_);cy.isList=FV;var fl=cy.prototype;fl[Vce]=!0,fl[J3]=fl.remove,fl.merge=fl.concat,fl.setIn=CV,fl.deleteIn=fl.removeIn=wV,fl.update=IV,fl.updateIn=EV,fl.mergeIn=TV,fl.mergeDeepIn=DV,fl.withMutations=lD,fl.wasAltered=PV,fl.asImmutable=uD,fl["@@transducer/init"]=fl.asMutable=cD,fl["@@transducer/step"]=function(e,t){return e.push(t)},fl["@@transducer/result"]=function(e){return e.asImmutable()};var F1=function(t,n){this.array=t,this.ownerID=n};F1.prototype.removeBefore=function(t,n,r){if(r===n?1<<n:0===this.array.length)return this;var i=r>>>n&Lu;if(i>=this.array.length)return new F1([],t);var s,o=0===i;if(n>0){var a=this.array[i];if((s=a&&a.removeBefore(t,n-Es,r))===a&&o)return this}if(o&&!s)return this;var l=Fw(this,t);if(!o)for(var c=0;c<i;c++)l.array[c]=void 0;return s&&(l.array[i]=s),l},F1.prototype.removeAfter=function(t,n,r){if(r===(n?1<<n:0)||0===this.array.length)return this;var o,i=r-1>>>n&Lu;if(i>=this.array.length)return this;if(n>0){var s=this.array[i];if((o=s&&s.removeAfter(t,n-Es,r))===s&&i===this.array.length-1)return this}var a=Fw(this,t);return a.array.splice(i+1),o&&(a.array[i]=o),a};var Gce,pD={};function Hce(e,t){var n=e._origin,r=e._capacity,i=mD(r),o=e._tail;return function s(c,u,d){return 0===u?function a(c,u){var d=u===i?o&&o.array:c&&c.array,f=u>n?0:n-u,p=r-u;return p>xp&&(p=xp),function(){if(f===p)return pD;var m=t?--p:f++;return d&&d[m]}}(c,d):function l(c,u,d){var f,p=c&&c.array,m=d>n?0:n-d>>u,h=1+(r-d>>u);return h>xp&&(h=xp),function(){for(;;){if(f){var g=f();if(g!==pD)return g;f=null}if(m===h)return pD;var y=t?--h:m++;f=s(p&&p[y],u-Es,d+(y<<u))}}}(c,u,d)}(e._root,e._level,0)}function hD(e,t,n,r,i,o,s){var a=Object.create(fl);return a.size=t-e,a._origin=e,a._capacity=t,a._level=n,a._root=r,a._tail=i,a.__ownerID=o,a.__hash=s,a.__altered=!1,a}function q5(){return Gce||(Gce=hD(0,0,Es))}function OV(e,t,n,r,i,o){var l,s=r>>>n&Lu,a=e&&s<e.array.length;if(!a&&void 0===i)return e;if(n>0){var c=e&&e.array[s],u=OV(c,t,n-Es,r,i,o);return u===c?e:((l=Fw(e,t)).array[s]=u,l)}return a&&e.array[s]===i?e:(o&&_p(o),l=Fw(e,t),void 0===i&&s===l.array.length-1?l.array.pop():l.array[s]=i,l)}function Fw(e,t){return t&&e&&t===e.ownerID?e:new F1(e?e.array.slice():[],t)}function qce(e,t){if(t>=mD(e._capacity))return e._tail;if(t<1<<e._level+Es){for(var n=e._root,r=e._level;n&&r>0;)n=n.array[t>>>r&Lu],r-=Es;return n}}function O1(e,t,n){void 0!==t&&(t|=0),void 0!==n&&(n|=0);var r=e.__ownerID||new J7,i=e._origin,o=e._capacity,s=i+t,a=void 0===n?o:n<0?o+n:i+n;if(s===i&&a===o)return e;if(s>=a)return e.clear();for(var l=e._level,c=e._root,u=0;s+u<0;)c=new F1(c&&c.array.length?[void 0,c]:[],r),u+=1<<(l+=Es);u&&(s+=u,i+=u,a+=u,o+=u);for(var d=mD(o),f=mD(a);f>=1<<l+Es;)c=new F1(c&&c.array.length?[c]:[],r),l+=Es;var p=e._tail,m=f<d?qce(e,a-1):f>d?new F1([],r):p;if(p&&f>d&&s<o&&p.array.length){for(var h=c=Fw(c,r),g=l;g>Es;g-=Es){var y=d>>>g&Lu;h=h.array[y]=Fw(h.array[y],r)}h.array[d>>>Es&Lu]=p}if(a<o&&(m=m&&m.removeAfter(r,0,a)),s>=f)s-=f,a-=f,l=Es,c=null,m=m&&m.removeBefore(r,0,s);else if(s>i||f<d){for(u=0;c;){var v=s>>>l&Lu;if(v!==f>>>l&Lu)break;v&&(u+=(1<<l)*v),l-=Es,c=c.array[v]}c&&s>i&&(c=c.removeBefore(r,l,s-u)),c&&f<d&&(c=c.removeAfter(r,l,f-u)),u&&(s-=u,a-=u)}return e.__ownerID?(e.size=a-s,e._origin=s,e._capacity=a,e._level=l,e._root=c,e._tail=m,e.__hash=void 0,e.__altered=!0,e):hD(s,a,l,c,m)}function mD(e){return e<xp?0:e-1>>>Es<<Es}var Wce,Nc=function(e){function t(n){return null==n?gD():lV(n)?n:gD().withMutations(function(r){var i=Sp(n);wf(i.size),i.forEach(function(o,s){return r.set(s,o)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("OrderedMap {","}")},t.prototype.get=function(r,i){var o=this._map.get(r);return void 0!==o?this._list.get(o)[1]:i},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this.__altered=!0,this):gD()},t.prototype.set=function(r,i){return $ce(this,r,i)},t.prototype.remove=function(r){return $ce(this,r,zi)},t.prototype.__iterate=function(r,i){var o=this;return this._list.__iterate(function(s){return s&&r(s[1],s[0],o)},i)},t.prototype.__iterator=function(r,i){return this._list.fromEntrySeq().__iterator(r,i)},t.prototype.__ensureOwner=function(r){if(r===this.__ownerID)return this;var i=this._map.__ensureOwner(r),o=this._list.__ensureOwner(r);return r?BV(i,o,r,this.__hash):0===this.size?gD():(this.__ownerID=r,this.__altered=!1,this._map=i,this._list=o,this)},t}(Af);function BV(e,t,n,r){var i=Object.create(Nc.prototype);return i.size=e?e.size:0,i._map=e,i._list=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function gD(){return Wce||(Wce=BV(Xh(),q5()))}function $ce(e,t,n){var a,l,r=e._map,i=e._list,o=r.get(t),s=void 0!==o;if(n===zi){if(!s)return e;i.size>=xp&&i.size>=2*r.size?(a=(l=i.filter(function(c,u){return void 0!==c&&o!==u})).toKeyedSeq().map(function(c){return c[0]}).flip().toMap(),e.__ownerID&&(a.__ownerID=l.__ownerID=e.__ownerID)):(a=r.remove(t),l=o===i.size-1?i.pop():i.set(o,void 0))}else if(s){if(n===i.get(o)[1])return e;a=r,l=i.set(o,[t,n])}else a=r.set(t,i.size),l=i.set(i.size,[t,n]);return e.__ownerID?(e.size=a.size,e._map=a,e._list=l,e.__hash=void 0,e.__altered=!0,e):BV(a,l)}Nc.isOrderedMap=lV,Nc.prototype[Dw]=!0,Nc.prototype[J3]=Nc.prototype.remove;var Yce="@@__IMMUTABLE_STACK__@@";function W5(e){return!(!e||!e[Yce])}var $5=function(e){function t(n){return null==n?Y5():W5(n)?n:Y5().pushAll(n)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.prototype.toString=function(){return this.__toString("Stack [","]")},t.prototype.get=function(r,i){var o=this._head;for(r=M1(this,r);o&&r--;)o=o.next;return o?o.value:i},t.prototype.peek=function(){return this._head&&this._head.value},t.prototype.push=function(){var r=arguments;if(0===arguments.length)return this;for(var i=this.size+arguments.length,o=this._head,s=arguments.length-1;s>=0;s--)o={value:r[s],next:o};return this.__ownerID?(this.size=i,this._head=o,this.__hash=void 0,this.__altered=!0,this):yD(i,o)},t.prototype.pushAll=function(r){if(0===(r=e(r)).size)return this;if(0===this.size&&W5(r))return r;wf(r.size);var i=this.size,o=this._head;return r.__iterate(function(s){i++,o={value:s,next:o}},!0),this.__ownerID?(this.size=i,this._head=o,this.__hash=void 0,this.__altered=!0,this):yD(i,o)},t.prototype.pop=function(){return this.slice(1)},t.prototype.clear=function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):Y5()},t.prototype.slice=function(r,i){if(eD(r,i,this.size))return this;var o=Ew(r,this.size);if(tD(i,this.size)!==this.size)return e.prototype.slice.call(this,r,i);for(var a=this.size-o,l=this._head;o--;)l=l.next;return this.__ownerID?(this.size=a,this._head=l,this.__hash=void 0,this.__altered=!0,this):yD(a,l)},t.prototype.__ensureOwner=function(r){return r===this.__ownerID?this:r?yD(this.size,this._head,r,this.__hash):0===this.size?Y5():(this.__ownerID=r,this.__altered=!1,this)},t.prototype.__iterate=function(r,i){var o=this;if(i)return new m_(this.toArray()).__iterate(function(l,c){return r(l,c,o)},i);for(var s=0,a=this._head;a&&!1!==r(a.value,s++,this);)a=a.next;return s},t.prototype.__iterator=function(r,i){if(i)return new m_(this.toArray()).__iterator(r,i);var o=0,s=this._head;return new ao(function(){if(s){var a=s.value;return s=s.next,Ts(r,o++,a)}return{value:void 0,done:!0}})},t}(p_);$5.isStack=W5;var Xce,Vu=$5.prototype;function yD(e,t,n,r){var i=Object.create(Vu);return i.size=e,i._head=t,i.__ownerID=n,i.__hash=r,i.__altered=!1,i}function Y5(){return Xce||(Xce=yD(0))}Vu[Yce]=!0,Vu.shift=Vu.pop,Vu.unshift=Vu.push,Vu.unshiftAll=Vu.pushAll,Vu.withMutations=lD,Vu.wasAltered=PV,Vu.asImmutable=uD,Vu["@@transducer/init"]=Vu.asMutable=cD,Vu["@@transducer/step"]=function(e,t){return e.unshift(t)},Vu["@@transducer/result"]=function(e){return e.asImmutable()};var Kce="@@__IMMUTABLE_SET__@@";function X5(e){return!(!e||!e[Kce])}function LV(e){return X5(e)&&wp(e)}function jV(e,t){if(e===t)return!0;if(!ju(t)||void 0!==e.size&&void 0!==t.size&&e.size!==t.size||void 0!==e.__hash&&void 0!==t.__hash&&e.__hash!==t.__hash||fs(e)!==fs(t)||Jc(e)!==Jc(t)||wp(e)!==wp(t))return!1;if(0===e.size&&0===t.size)return!0;var n=!nD(e);if(wp(e)){var r=e.entries();return t.every(function(l,c){var u=r.next().value;return u&&oc(u[1],l)&&(n||oc(u[0],c))})&&r.next().done}var i=!1;if(void 0===e.size)if(void 0===t.size)"function"==typeof e.cacheResult&&e.cacheResult();else{i=!0;var o=e;e=t,t=o}var s=!0,a=t.__iterate(function(l,c){if(n?!e.has(l):i?!oc(l,e.get(c,zi)):!oc(e.get(c,zi),l))return s=!1,!1});return s&&e.size===a}function b_(e,t){var n=function(r){e.prototype[r]=t[r]};return Object.keys(t).forEach(n),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(t).forEach(n),e}function K5(e){if(!e||"object"!=typeof e)return e;if(!ju(e)){if(!N1(e))return e;e=zu(e)}if(fs(e)){var t={};return e.__iterate(function(r,i){t[i]=K5(r)}),t}var n=[];return e.__iterate(function(r){n.push(K5(r))}),n}var bD=function(e){function t(n){return null==n?vD():X5(n)&&!wp(n)?n:vD().withMutations(function(r){var i=e(n);wf(i.size),i.forEach(function(o){return r.add(o)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(r){return this(Sp(r).keySeq())},t.intersect=function(r){return(r=aa(r).toArray()).length?Fc.intersect.apply(t(r.pop()),r):vD()},t.union=function(r){return(r=aa(r).toArray()).length?Fc.union.apply(t(r.pop()),r):vD()},t.prototype.toString=function(){return this.__toString("Set {","}")},t.prototype.has=function(r){return this._map.has(r)},t.prototype.add=function(r){return Z5(this,this._map.set(r,r))},t.prototype.remove=function(r){return Z5(this,this._map.remove(r))},t.prototype.clear=function(){return Z5(this,this._map.clear())},t.prototype.map=function(r,i){var o=this,s=!1,a=Z5(this,this._map.mapEntries(function(l){var c=l[1],u=r.call(i,c,c,o);return u!==c&&(s=!0),[u,u]},i));return s?a:this},t.prototype.union=function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];return 0===(r=r.filter(function(o){return 0!==o.size})).length?this:0!==this.size||this.__ownerID||1!==r.length?this.withMutations(function(o){for(var s=0;s<r.length;s++)"string"==typeof r[s]?o.add(r[s]):e(r[s]).forEach(function(a){return o.add(a)})}):this.constructor(r[0])},t.prototype.intersect=function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];if(0===r.length)return this;r=r.map(function(s){return e(s)});var o=[];return this.forEach(function(s){r.every(function(a){return a.includes(s)})||o.push(s)}),this.withMutations(function(s){o.forEach(function(a){s.remove(a)})})},t.prototype.subtract=function(){for(var r=[],i=arguments.length;i--;)r[i]=arguments[i];if(0===r.length)return this;r=r.map(function(s){return e(s)});var o=[];return this.forEach(function(s){r.some(function(a){return a.includes(s)})&&o.push(s)}),this.withMutations(function(s){o.forEach(function(a){s.remove(a)})})},t.prototype.sort=function(r){return Ep(Mw(this,r))},t.prototype.sortBy=function(r,i){return Ep(Mw(this,i,r))},t.prototype.wasAltered=function(){return this._map.wasAltered()},t.prototype.__iterate=function(r,i){var o=this;return this._map.__iterate(function(s){return r(s,s,o)},i)},t.prototype.__iterator=function(r,i){return this._map.__iterator(r,i)},t.prototype.__ensureOwner=function(r){if(r===this.__ownerID)return this;var i=this._map.__ensureOwner(r);return r?this.__make(i,r):0===this.size?this.__empty():(this.__ownerID=r,this._map=i,this)},t}(Tw);bD.isSet=X5;var Qce,Fc=bD.prototype;function Z5(e,t){return e.__ownerID?(e.size=t.size,e._map=t,e):t===e._map?e:0===t.size?e.__empty():e.__make(t)}function Zce(e,t){var n=Object.create(Fc);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function vD(){return Qce||(Qce=Zce(Xh()))}Fc[Kce]=!0,Fc[J3]=Fc.remove,Fc.merge=Fc.concat=Fc.union,Fc.withMutations=lD,Fc.asImmutable=uD,Fc["@@transducer/init"]=Fc.asMutable=cD,Fc["@@transducer/step"]=function(e,t){return e.add(t)},Fc["@@transducer/result"]=function(e){return e.asImmutable()},Fc.__empty=vD,Fc.__make=Zce;var UV,Jce=function(e){function t(n,r,i){if(!(this instanceof t))return new t(n,r,i);if(xV(0!==i,"Cannot step a Range by 0"),n=n||0,void 0===r&&(r=1/0),i=void 0===i?1:Math.abs(i),r<n&&(i=-i),this._start=n,this._end=r,this._step=i,this.size=Math.max(0,Math.ceil((r-n)/i-1)+1),0===this.size){if(UV)return UV;UV=this}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(1!==this._step?" by "+this._step:"")+" ]"},t.prototype.get=function(r,i){return this.has(r)?this._start+M1(this,r)*this._step:i},t.prototype.includes=function(r){var i=(r-this._start)/this._step;return i>=0&&i<this.size&&i===Math.floor(i)},t.prototype.slice=function(r,i){return eD(r,i,this.size)?this:(r=Ew(r,this.size),(i=tD(i,this.size))<=r?new t(0,0):new t(this.get(r,this._end),this.get(i,this._end),this._step))},t.prototype.indexOf=function(r){var i=r-this._start;if(i%this._step==0){var o=i/this._step;if(o>=0&&o<this.size)return o}return-1},t.prototype.lastIndexOf=function(r){return this.indexOf(r)},t.prototype.__iterate=function(r,i){for(var o=this.size,s=this._step,a=i?this._start+(o-1)*s:this._start,l=0;l!==o&&!1!==r(a,i?o-++l:l++,this);)a+=i?-s:s;return l},t.prototype.__iterator=function(r,i){var o=this.size,s=this._step,a=i?this._start+(o-1)*s:this._start,l=0;return new ao(function(){if(l===o)return{value:void 0,done:!0};var c=a;return a+=i?-s:s,Ts(r,i?o-++l:l++,c)})},t.prototype.equals=function(r){return r instanceof t?this._start===r._start&&this._end===r._end&&this._step===r._step:jV(this,r)},t}(Ip);function zV(e,t,n){for(var r=wce(t),i=0;i!==r.length;)if((e=SV(e,r[i++],zi))===zi)return n;return e}function eue(e,t){return zV(this,e,t)}function nue(){wf(this.size);var e={};return this.__iterate(function(t,n){e[n]=t}),e}aa.isIterable=ju,aa.isKeyed=fs,aa.isIndexed=Jc,aa.isAssociative=nD,aa.isOrdered=wp,aa.Iterator=ao,b_(aa,{toArray:function(){wf(this.size);var t=new Array(this.size||0),n=fs(this),r=0;return this.__iterate(function(i,o){t[r++]=n?[o,i]:i}),t},toIndexedSeq:function(){return new pce(this)},toJS:function(){return K5(this)},toKeyedSeq:function(){return new z5(this,!0)},toMap:function(){return Af(this.toKeyedSeq())},toObject:nue,toOrderedMap:function(){return Nc(this.toKeyedSeq())},toOrderedSet:function(){return Ep(fs(this)?this.valueSeq():this)},toSet:function(){return bD(fs(this)?this.valueSeq():this)},toSetSeq:function(){return new hce(this)},toSeq:function(){return Jc(this)?this.toIndexedSeq():fs(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return $5(fs(this)?this.valueSeq():this)},toList:function(){return cy(fs(this)?this.valueSeq():this)},toString:function(){return"[Collection]"},__toString:function(t,n){return 0===this.size?t+n:t+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+n},concat:function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return Qo(this,function rGe(e,t){var n=fs(e),r=[e].concat(t).map(function(s){return ju(s)?n&&(s=Sp(s)):s=n?sV(s):sce(Array.isArray(s)?s:[s]),s}).filter(function(s){return 0!==s.size});if(0===r.length)return e;if(1===r.length){var i=r[0];if(i===e||n&&fs(i)||Jc(e)&&Jc(i))return i}var o=new m_(r);return n?o=o.toKeyedSeq():Jc(e)||(o=o.toSetSeq()),(o=o.flatten(!0)).size=r.reduce(function(s,a){if(void 0!==s){var l=a.size;if(void 0!==l)return s+l}},0),o}(this,t))},includes:function(t){return this.some(function(n){return oc(n,t)})},entries:function(){return this.__iterator(Ap)},every:function(t,n){wf(this.size);var r=!0;return this.__iterate(function(i,o,s){if(!t.call(n,i,o,s))return r=!1,!1}),r},filter:function(t,n){return Qo(this,bce(this,t,n,!0))},partition:function(t,n){return function tGe(e,t,n){var r=fs(e),i=[[],[]];e.__iterate(function(s,a){i[t.call(n,s,a,e)?1:0].push(r?[a,s]:s)});var o=bV(e);return i.map(function(s){return Qo(e,o(s))})}(this,t,n)},find:function(t,n,r){var i=this.findEntry(t,n);return i?i[1]:r},forEach:function(t,n){return wf(this.size),this.__iterate(n?t.bind(n):t)},join:function(t){wf(this.size),t=void 0!==t?""+t:",";var n="",r=!0;return this.__iterate(function(i){r?r=!1:n+=t,n+=null!=i?i.toString():""}),n},keys:function(){return this.__iterator(rD)},map:function(t,n){return Qo(this,yce(this,t,n))},reduce:function(t,n,r){return rue(this,t,n,r,arguments.length<2,!1)},reduceRight:function(t,n,r){return rue(this,t,n,r,arguments.length<2,!0)},reverse:function(){return Qo(this,gV(this,!0))},slice:function(t,n){return Qo(this,yV(this,t,n,!0))},some:function(t,n){wf(this.size);var r=!1;return this.__iterate(function(i,o,s){if(t.call(n,i,o,s))return r=!0,!1}),r},sort:function(t){return Qo(this,Mw(this,t))},values:function(){return this.__iterator(Yh)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return void 0!==this.size?0===this.size:!this.some(function(){return!0})},count:function(t,n){return Iw(t?this.toSeq().filter(t,n):this)},countBy:function(t,n){return function JHe(e,t,n){var r=Af().asMutable();return e.__iterate(function(i,o){r.update(t.call(n,i,o,e),0,function(s){return s+1})}),r.asImmutable()}(this,t,n)},equals:function(t){return jV(this,t)},entrySeq:function(){var t=this;if(t._cache)return new m_(t._cache);var n=t.toSeq().map(AGe).toIndexedSeq();return n.fromEntrySeq=function(){return t.toSeq()},n},filterNot:function(t,n){return this.filter(VV(t),n)},findEntry:function(t,n,r){var i=r;return this.__iterate(function(o,s,a){if(t.call(n,o,s,a))return i=[s,o],!1}),i},findKey:function(t,n){var r=this.findEntry(t,n);return r&&r[0]},findLast:function(t,n,r){return this.toKeyedSeq().reverse().find(t,n,r)},findLastEntry:function(t,n,r){return this.toKeyedSeq().reverse().findEntry(t,n,r)},findLastKey:function(t,n){return this.toKeyedSeq().reverse().findKey(t,n)},first:function(t){return this.find(Xle,null,t)},flatMap:function(t,n){return Qo(this,function iGe(e,t,n){var r=bV(e);return e.toSeq().map(function(i,o){return r(t.call(n,i,o,e))}).flatten(!0)}(this,t,n))},flatten:function(t){return Qo(this,xce(this,t,!0))},fromEntrySeq:function(){return new mce(this)},get:function(t,n){return this.find(function(r,i){return oc(i,t)},void 0,n)},getIn:eue,groupBy:function(t,n){return function eGe(e,t,n){var r=fs(e),i=(wp(e)?Nc():Af()).asMutable();e.__iterate(function(s,a){i.update(t.call(n,s,a,e),function(l){return(l=l||[]).push(r?[a,s]:s),l})});var o=bV(e);return i.map(function(s){return Qo(e,o(s))}).asImmutable()}(this,t,n)},has:function(t){return this.get(t,zi)!==zi},hasIn:function CGe(e){return function tue(e,t){return zV(e,t,zi)!==zi}(this,e)},isSubset:function(t){return t="function"==typeof t.includes?t:aa(t),this.every(function(n){return t.includes(n)})},isSuperset:function(t){return(t="function"==typeof t.isSubset?t:aa(t)).isSubset(this)},keyOf:function(t){return this.findKey(function(n){return oc(n,t)})},keySeq:function(){return this.toSeq().map(wGe).toIndexedSeq()},last:function(t){return this.toSeq().reverse().first(t)},lastKeyOf:function(t){return this.toKeyedSeq().reverse().keyOf(t)},max:function(t){return V5(this,t)},maxBy:function(t,n){return V5(this,n,t)},min:function(t){return V5(this,t?iue(t):sue)},minBy:function(t,n){return V5(this,n?iue(n):sue,t)},rest:function(){return this.slice(1)},skip:function(t){return 0===t?this:this.slice(Math.max(0,t))},skipLast:function(t){return 0===t?this:this.slice(0,-Math.max(0,t))},skipWhile:function(t,n){return Qo(this,vce(this,t,n,!0))},skipUntil:function(t,n){return this.skipWhile(VV(t),n)},sortBy:function(t,n){return Qo(this,Mw(this,n,t))},take:function(t){return this.slice(0,Math.max(0,t))},takeLast:function(t){return this.slice(-Math.max(0,t))},takeWhile:function(t,n){return Qo(this,function nGe(e,t,n){var r=ug(e);return r.__iterateUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterate(i,o);var a=0;return e.__iterate(function(l,c,u){return t.call(n,l,c,u)&&++a&&i(l,c,s)}),a},r.__iteratorUncached=function(i,o){var s=this;if(o)return this.cacheResult().__iterator(i,o);var a=e.__iterator(Ap,o),l=!0;return new ao(function(){if(!l)return{value:void 0,done:!0};var c=a.next();if(c.done)return c;var u=c.value,d=u[0],f=u[1];return t.call(n,f,d,s)?i===Ap?c:Ts(i,d,f,c):(l=!1,{value:void 0,done:!0})})},r}(this,t,n))},takeUntil:function(t,n){return this.takeWhile(VV(t),n)},update:function(t){return t(this)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=function IGe(e){if(e.size===1/0)return 0;var t=wp(e),n=fs(e),r=t?1:0;return function EGe(e,t){return t=iD(t,3432918353),t=iD(t<<15|t>>>-15,461845907),t=iD(t<<13|t>>>-13,5),t=iD((t=t+3864292196^e)^t>>>16,2246822507),t=U5((t=iD(t^t>>>13,3266489909))^t>>>16)}(e.__iterate(n?t?function(o,s){r=31*r+aue(Id(o),Id(s))|0}:function(o,s){r=r+aue(Id(o),Id(s))|0}:t?function(o){r=31*r+Id(o)|0}:function(o){r=r+Id(o)|0}),r)}(this))}});var eu=aa.prototype;eu[Qle]=!0,eu[B5]=eu.values,eu.toJSON=eu.toArray,eu.__toStringMapper=oD,eu.inspect=eu.toSource=function(){return this.toString()},eu.chain=eu.flatMap,eu.contains=eu.includes,b_(Sp,{flip:function(){return Qo(this,gce(this))},mapEntries:function(t,n){var r=this,i=0;return Qo(this,this.toSeq().map(function(o,s){return t.call(n,[s,o],i++,r)}).fromEntrySeq())},mapKeys:function(t,n){var r=this;return Qo(this,this.toSeq().flip().map(function(i,o){return t.call(n,i,o,r)}).flip())}});var xD=Sp.prototype;xD[Jle]=!0,xD[B5]=eu.entries,xD.toJSON=nue,xD.__toStringMapper=function(e,t){return oD(t)+": "+oD(e)},b_(p_,{toKeyedSeq:function(){return new z5(this,!1)},filter:function(t,n){return Qo(this,bce(this,t,n,!1))},findIndex:function(t,n){var r=this.findEntry(t,n);return r?r[0]:-1},indexOf:function(t){var n=this.keyOf(t);return void 0===n?-1:n},lastIndexOf:function(t){var n=this.lastKeyOf(t);return void 0===n?-1:n},reverse:function(){return Qo(this,gV(this,!1))},slice:function(t,n){return Qo(this,yV(this,t,n,!1))},splice:function(t,n){var r=arguments.length;if(n=Math.max(n||0,0),0===r||2===r&&!n)return this;t=Ew(t,t<0?this.count():this.size);var i=this.slice(0,t);return Qo(this,1===r?i:i.concat(dg(arguments,2),this.slice(t+n)))},findLastIndex:function(t,n){var r=this.findLastEntry(t,n);return r?r[0]:-1},first:function(t){return this.get(0,t)},flatten:function(t){return Qo(this,xce(this,t,!1))},get:function(t,n){return(t=M1(this,t))<0||this.size===1/0||void 0!==this.size&&t>this.size?n:this.find(function(r,i){return i===t},void 0,n)},has:function(t){return(t=M1(this,t))>=0&&(void 0!==this.size?this.size===1/0||t<this.size:-1!==this.indexOf(t))},interpose:function(t){return Qo(this,function oGe(e,t){var n=ug(e);return n.size=e.size&&2*e.size-1,n.__iterateUncached=function(r,i){var o=this,s=0;return e.__iterate(function(a){return(!s||!1!==r(t,s++,o))&&!1!==r(a,s++,o)},i),s},n.__iteratorUncached=function(r,i){var a,o=e.__iterator(Yh,i),s=0;return new ao(function(){return(!a||s%2)&&(a=o.next()).done?a:s%2?Ts(r,s++,t):Ts(r,s++,a.value,a)})},n}(this,t))},interleave:function(){var t=[this].concat(dg(arguments)),n=H5(this.toSeq(),Ip.of,t),r=n.flatten(!0);return n.size&&(r.size=n.size*t.length),Qo(this,r)},keySeq:function(){return Jce(0,this.size)},last:function(t){return this.get(-1,t)},skipWhile:function(t,n){return Qo(this,vce(this,t,n,!1))},zip:function(){return Qo(this,H5(this,oue,[this].concat(dg(arguments))))},zipAll:function(){return Qo(this,H5(this,oue,[this].concat(dg(arguments)),!0))},zipWith:function(t){var n=dg(arguments);return n[0]=this,Qo(this,H5(this,t,n))}});var Ow=p_.prototype;Ow[ece]=!0,Ow[Dw]=!0,b_(Tw,{get:function(t,n){return this.has(t)?t:n},includes:function(t){return this.has(t)},keySeq:function(){return this.valueSeq()}});var Bw=Tw.prototype;function rue(e,t,n,r,i,o){return wf(e.size),e.__iterate(function(s,a,l){i?(i=!1,n=s):n=t.call(r,n,s,a,l)},o),n}function wGe(e,t){return t}function AGe(e,t){return[t,e]}function VV(e){return function(){return!e.apply(this,arguments)}}function iue(e){return function(){return-e.apply(this,arguments)}}function oue(){return dg(arguments)}function sue(e,t){return e<t?1:e>t?-1:0}function aue(e,t){return e^t+2654435769+(e<<6)+(e>>2)}Bw.has=eu.includes,Bw.contains=Bw.includes,Bw.keys=Bw.values,b_(R1,xD),b_(Ip,Ow),b_(kw,Bw);var Ep=function(e){function t(n){return null==n?HV():LV(n)?n:HV().withMutations(function(r){var i=Tw(n);wf(i.size),i.forEach(function(o){return r.add(o)})})}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.of=function(){return this(arguments)},t.fromKeys=function(r){return this(Sp(r).keySeq())},t.prototype.toString=function(){return this.__toString("OrderedSet {","}")},t}(bD);Ep.isOrderedSet=LV;var cue,v_=Ep.prototype;function lue(e,t){var n=Object.create(v_);return n.size=e?e.size:0,n._map=e,n.__ownerID=t,n}function HV(){return cue||(cue=lue(gD()))}v_[Dw]=!0,v_.zip=Ow.zip,v_.zipWith=Ow.zipWith,v_.zipAll=Ow.zipAll,v_.__empty=HV,v_.__make=lue;var jl=function(t,n){var r;!function DGe(e){if(h_(e))throw new Error("Can not call `Record` with an immutable Record as default values. Use a plain javascript object instead.");if(Cp(e))throw new Error("Can not call `Record` with an immutable Collection as default values. Use a plain javascript object instead.");if(null===e||"object"!=typeof e)throw new Error("Can not call `Record` with a non-object as default values. Use a plain javascript object instead.")}(t);var i=function(a){var l=this;if(a instanceof i)return a;if(!(this instanceof i))return new i(a);if(!r){r=!0;var c=Object.keys(t),u=o._indices={};o._name=n,o._keys=c,o._defaultValues=t;for(var d=0;d<c.length;d++){var f=c[d];u[f]=d,o[f]?"object"==typeof console&&console.warn&&console.warn("Cannot define "+qV(this)+' with property "'+f+'" since that property name is part of the Record API.'):PGe(o,f)}}return this.__ownerID=void 0,this._values=cy().withMutations(function(p){p.setSize(l._keys.length),Sp(a).forEach(function(m,h){p.set(l._indices[h],m===l._defaultValues[h]?void 0:m)})}),this},o=i.prototype=Object.create(ps);return o.constructor=i,n&&(i.displayName=n),i};jl.prototype.toString=function(){for(var r,t=qV(this)+" { ",n=this._keys,i=0,o=n.length;i!==o;i++)t+=(i?", ":"")+(r=n[i])+": "+oD(this.get(r));return t+" }"},jl.prototype.equals=function(t){return this===t||h_(t)&&Lw(this).equals(Lw(t))},jl.prototype.hashCode=function(){return Lw(this).hashCode()},jl.prototype.has=function(t){return this._indices.hasOwnProperty(t)},jl.prototype.get=function(t,n){if(!this.has(t))return n;var i=this._values.get(this._indices[t]);return void 0===i?this._defaultValues[t]:i},jl.prototype.set=function(t,n){if(this.has(t)){var r=this._values.set(this._indices[t],n===this._defaultValues[t]?void 0:n);if(r!==this._values&&!this.__ownerID)return GV(this,r)}return this},jl.prototype.remove=function(t){return this.set(t)},jl.prototype.clear=function(){var t=this._values.clear().setSize(this._keys.length);return this.__ownerID?this:GV(this,t)},jl.prototype.wasAltered=function(){return this._values.wasAltered()},jl.prototype.toSeq=function(){return Lw(this)},jl.prototype.toJS=function(){return K5(this)},jl.prototype.entries=function(){return this.__iterator(Ap)},jl.prototype.__iterator=function(t,n){return Lw(this).__iterator(t,n)},jl.prototype.__iterate=function(t,n){return Lw(this).__iterate(t,n)},jl.prototype.__ensureOwner=function(t){if(t===this.__ownerID)return this;var n=this._values.__ensureOwner(t);return t?GV(this,n,t):(this.__ownerID=t,this._values=n,this)},jl.isRecord=h_,jl.getDescriptiveName=qV;var Hu,yt,vr,la,Qn,uy,ps=jl.prototype;function GV(e,t,n){var r=Object.create(Object.getPrototypeOf(e));return r._values=t,r.__ownerID=n,r}function qV(e){return e.constructor.displayName||e.constructor.name||"Record"}function Lw(e){return sV(e._keys.map(function(t){return[t,e.get(t)]}))}function PGe(e,t){try{Object.defineProperty(e,t,{get:function(){return this.get(t)},set:function(n){xV(this.__ownerID,"Cannot set on an immutable record."),this.set(t,n)}})}catch{}}ps[nce]=!0,ps[J3]=ps.remove,ps.deleteIn=ps.removeIn=wV,ps.getIn=eue,ps.hasIn=eu.hasIn,ps.merge=kce,ps.mergeWith=Mce,ps.mergeIn=TV,ps.mergeDeep=Nce,ps.mergeDeepWith=Fce,ps.mergeDeepIn=DV,ps.setIn=CV,ps.update=IV,ps.updateIn=EV,ps.withMutations=lD,ps.asMutable=cD,ps.asImmutable=uD,ps[B5]=ps.entries,ps.toJSON=ps.toObject=eu.toObject,ps.inspect=ps.toSource=function(){return this.toString()},function(e){function t(i){const o={create:s=>({action:o,params:s}),id:oo.create22(),definition:i,createDefaultParams:(s,a)=>i.params?I.getDefaultValues(i.params(s,a)):{}};return o}let r;e.create=t,e.fromTransformer=function n(i){const o=i.definition;return t({from:o.from,display:o.display,params:o.params,isApplicable:i.definition.isApplicable?(s,a,l)=>i.definition.isApplicable(s,l):void 0,run({cell:s,state:a,params:l}){const c=a.build().to(s.transform.ref).apply(i,l);return a.updateTree(c)}})},(r=e.Builder||(e.Builder={})).build=s=>function o(s){return a=>t({from:s.from instanceof Array?s.from:s.from?[s.from]:[],display:"string"==typeof s.display?{name:s.display}:s.display?s.display:{name:"Unnamed State Action"},params:"object"==typeof s.params?()=>s.params:s.params?s.params:void 0,isApplicable:s.isApplicable,..."function"==typeof a?{run:a}:a})}(s),e.build=r.build}(Hu||(Hu={})),function(e){let r;var h;e.getParamDefinition=function t(h,g,y){return h.definition.params?h.definition.params(g,y):{}},e.is=function n(h){return!!h&&"function"==typeof h.toAction&&"function"==typeof h.apply},(h=r=e.UpdateResult||(e.UpdateResult={}))[h.Unchanged=0]="Unchanged",h[h.Updated=1]="Updated",h[h.Recreate=2]="Recreate",h[h.Null=3]="Null";const i=new Map,o=new Map;function u(h,g){const{name:y}=g,v=`${h}.${y}`;if(i.has(v))throw new Error(`A transform with id '${y}' is already registered. Please pick a unique identifier for your transforms and/or register them only once. This is to ensure that transforms can be serialized and replayed.`);const x={apply:(_,w,A)=>vr.create(_,x,w,A),toAction:()=>Hu.fromTransformer(x),namespace:h,id:v,definition:g,createDefaultParams:(_,w)=>g.params?I.getDefaultValues(g.params(_,w)):{}};return i.set(v,x),function s(h){for(const g of h.definition.from)o.has(g.type)?o.get(g.type).push(h):o.set(g.type,[h])}(x),x}let p;e.getAll=function a(){return Array.from(i.values())},e.get=function l(h){const g=i.get(h);if(!g)throw new Error(`A transformer with signature '${h}' is not registered.`);return g},e.fromType=function c(h){return o.get(h)||[]},e.create=u,e.factory=function d(h){return g=>u(h,g)},e.builderFactory=function f(h){return p.build(h)},function(h){h.build=function y(v){return x=>function g(v,x){return _=>u(v,{name:x.name,from:x.from instanceof Array?x.from:[x.from],to:x.to instanceof Array?x.to:[x.to],display:"string"==typeof x.display?{name:x.display}:x.display?x.display:{name:y1(x.name.replace(/[-]/g," "))},params:"object"==typeof x.params?()=>x.params:x.params?x.params:void 0,isDecorator:x.isDecorator,..._})}(v,x)}}(p=e.Builder||(e.Builder={})),e.build=function m(h){return p.build(h)},e.ROOT=u("build-in",{name:"root",from:[],to:[],display:{name:"Root",description:"For internal use."},apply(){throw new Error("should never be applied")},update:()=>r.Unchanged})}(yt||(yt={})),function(e){function o(g,y,v,x){const _=x&&x.ref?x.ref:oo.create22();let w;return x&&x.tags&&(w="string"==typeof x.tags?[x.tags]:x.tags,0===w.length?w=void 0:w.sort()),{parent:g,transformer:y,state:x?.state||{},tags:w,ref:_,dependsOn:x&&x.dependsOn,params:v,version:oo.create22()}}function d(g,y){return!!g.tags&&g.tags.indexOf(y)>=0}function p(g){return g}e.RootRef="-=root=-",e.areStatesEqual=function t(g,y){return!!g.isHidden!=!!y.isHidden||!!g.isCollapsed!=!!y.isCollapsed||!!g.isGhost!=!!y.isGhost||!!g.isLocked!=!!y.isLocked},e.isStateChange=function n(g,y){return!!y&&(typeof y.isCollapsed<"u"&&g.isCollapsed!==y.isCollapsed||typeof y.isHidden<"u"&&g.isHidden!==y.isHidden||typeof y.isGhost<"u"&&g.isGhost!==y.isGhost||typeof y.isLocked<"u"&&g.isLocked!==y.isLocked)},e.assignState=function r(g,y){if(!y)return!1;let v=!1;for(const x of Object.keys(y)){const _=y[x];!!_!=!!g[x]&&(v=!0,g[x]=_)}return v},e.syncState=function i(g,y){if(!y)return!1;let v=!1;for(const x of Object.keys(y)){const _=y[x];!!_!=!!g[x]&&(v=!0,void 0!==_?g[x]=_:delete g[x])}for(const x of Object.keys(g)){const _=y[x];!!_!=!!g[x]&&(v=!0,void 0!==_?g[x]=_:delete g[x])}return v},e.create=o,e.withParams=function s(g,y){return{...g,params:y,version:oo.create22()}},e.withState=function a(g,y){return y?{...g,state:{...g.state,...y}}:g},e.withTags=function l(g,y){let v;return y&&(v="string"==typeof y?[y]:y,0===v.length?v=void 0:v.sort()),{...g,tags:v,version:oo.create22()}},e.withParent=function c(g,y){return{...g,parent:y,version:oo.create22()}},e.createRoot=function u(g){return o(e.RootRef,yt.ROOT,{},{ref:e.RootRef,state:g})},e.hasTag=d,e.hasTags=function f(g,y){if(!g.tags)return"string"!=typeof y&&0===y.length;if("string"==typeof y)return d(g,y);for(const v of y)if(g.tags.indexOf(v)<0)return!1;return!0},e.toJSON=function m(g){const y=g.transformer.definition.customSerialization?g.transformer.definition.customSerialization.toJSON:p;let v;for(const x of Object.keys(g.state))g.state[x]&&(v||(v={}),v[x]=!0);return{parent:g.parent,transformer:g.transformer.id,params:g.params?y(g.params):void 0,state:v,tags:g.tags,ref:g.ref,dependsOn:g.dependsOn,version:g.version}},e.fromJSON=function h(g){const y=yt.get(g.transformer);return{parent:g.parent,transformer:y,params:g.params?(y.definition.customSerialization?y.definition.customSerialization.fromJSON:p)(g.params):void 0,state:g.state||{},tags:g.tags,ref:g.ref,dependsOn:g.dependsOn,version:g.version}}}(vr||(vr={}));class FGe{get childMutations(){return this._childMutations||(this._childMutations=new Map),this._childMutations}get dependencyMutations(){return this._dependencyMutations||(this._dependencyMutations=new Map),this._dependencyMutations}changeNodes(){this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable())}changeChildren(){this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable())}changeDependencies(){this.changedDependencies||(this.changedDependencies=!0,this.dependencies=this.dependencies.asMutable())}get root(){return this.transforms.get(vr.RootRef)}asTransient(){return this.asImmutable().asTransient()}addChild(t,n){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).add(n);else{const r=this.children.get(t).asMutable();r.add(n),this.children.set(t,r),this.childMutations.set(t,r)}}removeChild(t,n){if(this.changeChildren(),this.childMutations.has(t))this.childMutations.get(t).remove(n);else{const r=this.children.get(t).asMutable();r.remove(n),this.children.set(t,r),this.childMutations.set(t,r)}}clearRoot(){const t=vr.RootRef;if(0===this.children.get(t).size)return;this.changeChildren();const n=Ep();this.children.set(t,n),this.childMutations.set(t,n)}mutateDependency(t,n,r){let i=this.dependencyMutations.get(t);if(!i){const o=this.dependencies.get(t);if(!o&&"remove"===r)return;this.changeDependencies(),i=o?o.asMutable():Ep().asMutable(),this.dependencyMutations.set(t,i),this.dependencies.set(t,i)}"add"===r?i.add(n):i.remove(n)}changeParent(t,n){Q5(this.transforms,t);const r=this.transforms.get(t);this.removeChild(r.parent,t),this.addChild(n,t),this.changeNodes(),this.transforms.set(t,vr.withParent(r,n))}add(t){const n=t.ref;this.transforms.has(t.ref)&&this.transforms.get(t.ref).parent!==t.parent&&function LGe(e){throw new Error(`Transform '${e}' is already present in the tree.`)}(t.ref);const r=this.children.get(t.parent);if(r||function jGe(e){throw new Error(`Parent '${e}' must be present in the tree.`)}(t.parent),r.has(t.ref)||this.addChild(t.parent,t.ref),this.children.has(t.ref)||(this.changedChildren||(this.changedChildren=!0,this.children=this.children.asMutable()),this.children.set(t.ref,Ep())),this.changeNodes(),this.transforms.set(n,t),t.dependsOn)for(const i of t.dependsOn)this.mutateDependency(i,n,"add");return this}setParams(t,n){Q5(this.transforms,t);const r=this.transforms.get(t);return!FR(r.params,n)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(r.ref,vr.withParams(r,n)),!0)}setTags(t,n){Q5(this.transforms,t);const r=this.transforms.get(t),i=vr.withParams(r,n);return!IU(r.tags,i.tags)&&(this.changedNodes||(this.changedNodes=!0,this.transforms=this.transforms.asMutable()),this.transforms.set(r.ref,i),!0)}assignState(t,n){Q5(this.transforms,t);const r=this.transforms.get(t);if(this._stateUpdates&&this._stateUpdates.has(t))return vr.assignState(r.state,n),r;{this._stateUpdates||(this._stateUpdates=new Set),this._stateUpdates.add(r.ref),this.changeNodes();const i=vr.withState(r,n);return this.transforms.set(t,i),i}}remove(t){const n=this.transforms.get(t);if(!n)return[];const r=la.subtreePostOrder(this,n);if(t===vr.RootRef){if(r.pop(),0===r.length)return r;this.clearRoot()}else{if(0===r.length)return r;this.removeChild(n.parent,n.ref)}this.changeNodes(),this.changeChildren();for(const o of r)this.transforms.delete(o.ref),this.children.delete(o.ref),this._childMutations&&this._childMutations.delete(o.ref);const i=[];for(const o of r){if(o.dependsOn)for(const s of o.dependsOn)this.transforms.has(s)&&this.mutateDependency(s,o.ref,"remove");if(this.dependencies.has(o.ref)){const s=this.dependencies.get(o.ref).toArray();this.changeDependencies(),this.dependencies.delete(o.ref),this._dependencyMutations&&this._dependencyMutations.delete(o.ref);for(const a of s)if(this.transforms.has(a))for(const l of this.remove(a))i[i.length]=l}}for(const o of i)r[r.length]=o;return r}asImmutable(){return this.changedNodes||this.changedChildren||this._childMutations?(this._childMutations&&this._childMutations.forEach(OGe,this.children),this._dependencyMutations&&this._dependencyMutations.forEach(BGe,this.dependencies),la.create(this.changedNodes?this.transforms.asImmutable():this.transforms,this.changedChildren?this.children.asImmutable():this.children,this.changedDependencies?this.dependencies.asImmutable():this.dependencies)):this.tree}constructor(t){this.tree=t,this.transforms=this.tree.transforms,this.children=this.tree.children,this.dependencies=this.tree.dependencies,this.changedNodes=!1,this.changedChildren=!1,this.changedDependencies=!1,this._childMutations=void 0,this._dependencyMutations=void 0,this._stateUpdates=void 0}}function OGe(e,t){this.set(t,e.asImmutable())}function BGe(e,t){0===e.size?this.delete(t):this.set(t,e.asImmutable())}function Q5(e,t){if(!e.has(t))throw new Error(`Node '${t}' is not present in the tree.`)}!function(e){class t{get root(){return this.transforms.get(vr.RootRef)}asTransient(){return new FGe(this)}constructor(_,w,A){this.transforms=_,this.children=w,this.dependencies=A}}function r(x,_,w){return new t(x,_,w)}function i(x){o(this,this.tree.transforms.get(x))}function o(x,_){const w=x.tree.children.get(_.ref);w&&w.size&&w.forEach(i,x),x.f(_,x.tree,x.state)}function s(x,_,w,A){const M={tree:x,state:w,f:A};return o(M,_),M.state}function a(x){l(this,this.tree.transforms.get(x))}function l(x,_){const w=x.f(_,x.tree,x.state);if("boolean"==typeof w&&!w)return;const A=x.tree.children.get(_.ref);A&&A.size&&A.forEach(a,x)}function c(x,_,w,A){const M={tree:x,state:w,f:A};return l(M,_),M.state}function u(x,_,w){w.push(x)}function f(x,_,w){w.push(vr.toJSON(x))}function g(x,_,w){if(_===w)return!0;const M=x.children.get(_).values();for(;;){const E=M.next();if(E.done)return!1;if(g(x,E.value,w))return!0}}e.createEmpty=function n(x){const _=x||vr.createRoot();return r(Af([[_.ref,_]]),Af([[_.ref,Ep()]]),Af())},e.create=r,e.doPostOrder=s,e.doPreOrder=c,e.subtreePostOrder=function d(x,_){return s(x,_,[],u)},e.toJSON=function p(x){const _=[];return c(x,x.root,_,f),{transforms:_}},e.fromJSON=function m(x){const _=Af().asMutable(),w=Af().asMutable(),A=Af().asMutable();for(const E of x.transforms){const D=vr.fromJSON(E);_.set(D.ref,D),w.has(D.ref)||w.set(D.ref,Ep().asMutable()),D.ref!==D.parent&&w.get(D.parent).add(D.ref)}const M=new Set;for(const E of x.transforms){const D=E.ref;if(w.set(D,w.get(D).asImmutable()),E.dependsOn)for(const T of E.dependsOn)M.add(T),A.has(T)?A.get(T).add(D):A.set(T,Ep([D]).asMutable())}return M.forEach(E=>{A.set(E,A.get(E).asImmutable())}),r(_.asImmutable(),w.asImmutable(),A.asImmutable())},e.dump=function h(x){console.log({tr:x.transforms.keySeq().toArray(),tr1:x.transforms.valueSeq().toArray().map(_=>_.ref),ch:x.children.keySeq().toArray()})},e.subtreeHasRef=function y(x,_,w){return!(!x.transforms.has(_)||!x.transforms.has(w))&&g(x,_,w)},e.getDecoratorRoot=function v(x,_){const w=x.children.get(_);if(1!==w.size)return _;const A=x.transforms.get(w.first());return A.transformer.definition.isDecorator?v(x,A.ref):_}}(la||(la={})),function(e){function t(G,Z){return n(G)(Z)}function n(G){const Z=G||c.root;let ee;return ee=function i(G){return void 0!==G.compile}(Z)?Z.compile():function r(G){return void 0!==G.transform&&void 0!==G.status}(Z)?c.byValue(Z).compile():function o(G){return"function"==typeof G}(Z)?Z:c.byRef(Z).compile(),ee}e.select=t,e.compile=n;const s={select(G){return t(this,G||this.state)}};function a(G,Z){s[G]=function(...ee){return Z.call(void 0,this,...ee)}}function l(G){return Object.create(s,{compile:{writable:!1,configurable:!1,value:G}})}let c;function u(G,Z){const ee=n(G);return l(()=>se=>{const xe=[];for(const re of ee(se))for(const ae of Z(re,se))xe.push(ae);return xe})}function d(G,Z){const ee=n(G);return l(()=>se=>{const xe=[];for(const re of ee(se)){const ae=Z(re,se);ae&&xe.push(ae)}return xe})}function f(G){const Z=n(G);return l(()=>ee=>{const se=new Set,xe=[];for(const re of Z(ee))re&&(se.has(re.transform.ref)||(se.add(re.transform.ref),xe.push(re)));return xe})}function p(G){const Z=n(G);return l(()=>ee=>{const se=Z(ee);return se.length?[se[0]]:[]})}function m(G,Z){return u(G,ee=>Z(ee)?[ee]:[])}function h(G,Z){return m(G,ee=>ee.status===Z)}function g(G,Z){return m(G,ee=>!!ee.transform.tags&&ee.transform.tags.indexOf(Z)>=0)}function y(G){return u(G,(Z,ee)=>{const se=[];return la.doPreOrder(ee.tree,ee.tree.transforms.get(Z.transform.ref),se,(xe,re,ae)=>{ae.push(xe.ref)}),se.map(xe=>ee.cells.get(xe))})}function v(G){return u(G,(Z,ee)=>{const se=[];return ee.tree.children.get(Z.transform.ref).forEach(xe=>se.push(ee.cells.get(xe))),se})}function x(G,Z){return m(G,ee=>!!ee.obj&&ee.obj.type===Z.type)}function _(G,Z){return f(d(G,(ee,se)=>R(se.tree,se.cells,ee.transform.ref,Z)))}function w(G,Z){return f(d(G,(ee,se)=>W(se.tree,se.cells,ee.transform.ref,Z)))}function A(G,Z){return f(d(G,(ee,se)=>j(se.tree,se.cells,ee.transform.ref,Z)))}function M(G,Z){return m(G,ee=>ee.transform.transformer===Z)}function E(G,Z){return f(d(G,(ee,se)=>N(se.tree,se.cells,ee.transform.ref,Z)))}function D(G,Z){return f(d(G,(ee,se)=>z(se.tree,se.cells,ee.transform.ref,Z)))}function T(G){return f(d(G,(Z,ee)=>ee.cells.get(ee.tree.transforms.get(Z.transform.ref).parent)))}function F(G,Z,ee,se,xe){let ae,re=G.transforms.get(ee);for(;;){re=G.transforms.get(re.parent);const ge=Z.get(re.ref);if(ge.obj&&se(ge)&&(ae=ge,xe)||re.ref===vr.RootRef)return ae}}function R(G,Z,ee,se){return F(G,Z,ee,se,!0)}function N(G,Z,ee,se){return F(G,Z,ee,se,!1)}function j(G,Z,ee,se){return R(G,Z,ee,Array.isArray(se)?xe=>se.indexOf(xe.transform.transformer)>=0:xe=>xe.transform.transformer===se)}function W(G,Z,ee,se){return R(G,Z,ee,$(se))}function z(G,Z,ee,se){return N(G,Z,ee,$(se))}function $(G){return Array.isArray(G)?Z=>{for(const ee of G)if(ee.type===Z.obj.type)return!0}:Z=>Z.obj.type===G.type}function X(G,Z,ee){if(G.tags)for(const se of G.tags)if(ee.tags.has(se)){ee.refs[se]=G.ref;break}return!0}function oe(G,Z,ee){return!(G.tags&&G.tags.indexOf(ee.tag)>=0&&(ee.ref=G.ref,1))}function K(G,Z,ee){if(G.tags){const se=ee.tags.size;let xe=0;for(const re of G.tags)if(ee.tags.has(re)&&(xe++,xe===se)){ee.refs.push(G);break}}else 0===ee.tags.size&&ee.refs.push(G)}(function(G){function ge(he,ie,ue){const _e=ue.cells.get(he.ref);return!_e||!_e.obj||_e.obj.type!==ue.type||(ue.roots.push(_e),!1)}function Ie(he,ie,ue){const _e=ue.cells.get(he.ref);return _e&&_e.obj&&_e.obj.type===ue.type&&ue.ret.push(_e),!0}function me(he,ie,ue){const _e=ue.cells.get(he.ref);return _e&&_e.obj&&_e.transform.transformer===ue.t&&ue.ret.push(_e),!0}function Ae(he,ie,ue){const _e=ue.cells.get(he.ref);return _e&&"error"===_e.status&&_e.transform.transformer===ue.t&&ue.ret.push(_e),!0}G.root=l(()=>he=>[he.cells.get(he.tree.root.ref)]),G.byRef=function Z(...he){return l(()=>ie=>{const ue=[];for(const _e of he){const Fe=ie.cells.get(_e);Fe&&ue.push(Fe)}return ue})},G.byValue=function ee(...he){return l(()=>ie=>he)},G.rootsOfType=function se(he,ie=vr.RootRef){return l(()=>ue=>{const _e={roots:[],cells:ue.cells,type:he.type};return la.doPreOrder(ue.tree,ue.tree.transforms.get(ie),_e,ge),_e.roots})},G.ofType=function xe(he,ie=vr.RootRef){return l(()=>ue=>{const _e={ret:[],cells:ue.cells,type:he.type};return la.doPreOrder(ue.tree,ue.tree.transforms.get(ie),_e,Ie),_e.ret})},G.ofTransformer=function re(he,ie=vr.RootRef){return l(()=>ue=>{const _e={ret:[],cells:ue.cells,t:he};return la.doPreOrder(ue.tree,ue.tree.transforms.get(ie),_e,me),_e.ret})},G.ofTransformerWithError=function ae(he,ie=vr.RootRef){return l(()=>ue=>{const _e={ret:[],cells:ue.cells,t:he};return la.doPreOrder(ue.tree,ue.tree.transforms.get(ie),_e,Ae),_e.ret})}})(c=e.Generators||(e.Generators={})),a("flatMap",u),e.flatMap=u,a("mapObject",d),e.mapObject=d,a("unique",f),e.unique=f,a("first",p),e.first=p,a("filter",m),e.filter=m,a("withStatus",h),e.withStatus=h,a("withTag",g),e.withTag=g,a("subtree",y),e.subtree=y,a("children",v),e.children=v,a("ofType",x),e.ofType=x,a("ancestor",_),e.ancestor=_,a("ancestorOfType",w),e.ancestorOfType=w,a("ancestorWithTransformer",A),e.ancestorWithTransformer=A,a("withTransformer",M),e.withTransformer=M,a("root",E),e.root=E,a("rootOfType",D),e.rootOfType=D,a("parent",T),e.parent=T,e.findAncestor=R,e.findRoot=N,e.findAncestorWithTransformer=j,e.findAncestorOfType=W,e.findRootOfType=z,e.findUniqueTagsInSubtree=function V(G,Z,ee){return la.doPreOrder(G,G.transforms.get(Z),{refs:{},tags:ee},X).refs},e.findTagInSubtree=function H(G,Z,ee){return la.doPreOrder(G,G.transforms.get(Z),{ref:void 0,tag:ee},oe).ref},e.findWithAllTags=function te(G,Z,ee){return la.doPreOrder(G,G.transforms.get(Z),{refs:[],tags:ee},K).refs},e.tryFindDecorator=function Q(G,Z,ee){if(G.transforms.get(Z).transformer===ee)return G.cells.get(Z);const xe=G.tree.children.get(Z);if(1!==xe.size)return;const re=xe.first();return G.transforms.get(re).transformer.definition.isDecorator?Q(G,re,ee):void 0}}(Qn||(Qn={})),function(e){e.create=function t(){const n=new UGe,r=()=>n.create();return r.dispose=()=>n.dispose(),r.behavior=i=>n.behavior(i),r}}(uy||(uy={}));class UGe{constructor(){this._eventList=[],this._disposed=!1}create(){const t=new si;return this._eventList.push(t),t}behavior(t){const n=new Ao(t);return this._eventList.push(n),n}dispose(){if(!this._disposed){for(const t of this._eventList)t.complete();this._disposed=!0}}}var $V=Symbol.for("immer-nothing"),_D=Symbol.for("immer-draftable"),Ji=Symbol.for("immer-state");function sc(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var x_=Object.getPrototypeOf;function B1(e){return!!e&&!!e[Ji]}function fg(e){return!!e&&(due(e)||Array.isArray(e)||!!e[_D]||!!e.constructor?.[_D]||CD(e)||wD(e))}var zGe=Object.prototype.constructor.toString();function due(e){if(!e||"object"!=typeof e)return!1;const t=x_(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===zGe}function jw(e,t){0===__(e)?Reflect.ownKeys(e).forEach(n=>{t(n,e[n],e)}):e.forEach((n,r)=>t(r,n,e))}function __(e){const t=e[Ji];return t?t.type_:Array.isArray(e)?1:CD(e)?2:wD(e)?3:0}function SD(e,t){return 2===__(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function fue(e,t,n){const r=__(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function CD(e){return e instanceof Map}function wD(e){return e instanceof Set}function ac(e){return e.copy_||e.base_}function XV(e,t){if(CD(e))return new Map(e);if(wD(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);if(!t&&due(e))return x_(e)?{...e}:Object.assign(Object.create(null),e);const n=Object.getOwnPropertyDescriptors(e);delete n[Ji];let r=Reflect.ownKeys(n);for(let i=0;i<r.length;i++){const o=r[i],s=n[o];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(n[o]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[o]})}return Object.create(x_(e),n)}function KV(e,t=!1){return J5(e)||B1(e)||!fg(e)||(__(e)>1&&(e.set=e.add=e.clear=e.delete=HGe),Object.freeze(e),t&&Object.entries(e).forEach(([n,r])=>KV(r,!0))),e}function HGe(){sc(2)}function J5(e){return Object.isFrozen(e)}var AD,ZV={};function S_(e){const t=ZV[e];return t||sc(0),t}function eN(){return AD}function hue(e,t){t&&(S_("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function QV(e){JV(e),e.drafts_.forEach(qGe),e.drafts_=null}function JV(e){e===AD&&(AD=e.parent_)}function mue(e){return AD=function GGe(e,t){return{drafts_:[],parent_:e,immer_:t,canAutoFreeze_:!0,unfinalizedDrafts_:0}}(AD,e)}function qGe(e){const t=e[Ji];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function gue(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[Ji].modified_&&(QV(t),sc(4)),fg(e)&&(e=tN(t,e),t.parent_||nN(t,e)),t.patches_&&S_("Patches").generateReplacementPatches_(n[Ji].base_,e,t.patches_,t.inversePatches_)):e=tN(t,n,[]),QV(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==$V?e:void 0}function tN(e,t,n){if(J5(t))return t;const r=t[Ji];if(!r)return jw(t,(i,o)=>yue(e,r,t,i,o,n)),t;if(r.scope_!==e)return t;if(!r.modified_)return nN(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const i=r.copy_;let o=i,s=!1;3===r.type_&&(o=new Set(i),i.clear(),s=!0),jw(o,(a,l)=>yue(e,r,i,a,l,n,s)),nN(e,i,!1),n&&e.patches_&&S_("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function yue(e,t,n,r,i,o,s){if(B1(i)){const l=tN(e,i,o&&t&&3!==t.type_&&!SD(t.assigned_,r)?o.concat(r):void 0);if(fue(n,r,l),!B1(l))return;e.canAutoFreeze_=!1}else s&&n.add(i);if(fg(i)&&!J5(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;tN(e,i),(!t||!t.scope_.parent_)&&"symbol"!=typeof r&&Object.prototype.propertyIsEnumerable.call(n,r)&&nN(e,i)}}function nN(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&KV(t,n)}var e9={get(e,t){if(t===Ji)return e;const n=ac(e);if(!SD(n,t))return function $Ge(e,t,n){const r=bue(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!fg(r)?r:r===t9(e.base_,t)?(n9(e),e.copy_[t]=ED(r,e)):r},has:(e,t)=>t in ac(e),ownKeys:e=>Reflect.ownKeys(ac(e)),set(e,t,n){const r=bue(ac(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const i=t9(ac(e),t),o=i?.[Ji];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(function VGe(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}(n,i)&&(void 0!==n||SD(e.base_,t)))return!0;n9(e),dy(e)}return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==t9(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,n9(e),dy(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=ac(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r&&{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}},defineProperty(){sc(11)},getPrototypeOf:e=>x_(e.base_),setPrototypeOf(){sc(12)}},ID={};function t9(e,t){const n=e[Ji];return(n?ac(n):e)[t]}function bue(e,t){if(!(t in e))return;let n=x_(e);for(;n;){const r=Object.getOwnPropertyDescriptor(n,t);if(r)return r;n=x_(n)}}function dy(e){e.modified_||(e.modified_=!0,e.parent_&&dy(e.parent_))}function n9(e){e.copy_||(e.copy_=XV(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function ED(e,t){const n=CD(e)?S_("MapSet").proxyMap_(e,t):wD(e)?S_("MapSet").proxySet_(e,t):function WGe(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:eN(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,o=e9;n&&(i=[r],o=ID);const{revoke:s,proxy:a}=Proxy.revocable(i,o);return r.draft_=a,r.revoke_=s,a}(e,t);return(t?t.scope_:eN()).drafts_.push(n),n}function vue(e){if(!fg(e)||J5(e))return e;const t=e[Ji];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=XV(e,t.scope_.immer_.useStrictShallowCopy_)}else n=XV(e,!0);return jw(n,(r,i)=>{fue(n,r,vue(i))}),t&&(t.finalized_=!1),n}jw(e9,(e,t)=>{ID[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),ID.deleteProperty=function(e,t){return ID.set.call(this,e,t,void 0)},ID.set=function(e,t,n){return e9.set.call(this,e[0],t,n,e[0])};var C_,pg,TD,If=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(t,n,r)=>{if("function"==typeof t&&"function"!=typeof n){const o=n;n=t;const s=this;return function(l=o,...c){return s.produce(l,u=>n.call(this,u,...c))}}let i;if("function"!=typeof n&&sc(6),void 0!==r&&"function"!=typeof r&&sc(7),fg(t)){const o=mue(this),s=ED(t,void 0);let a=!0;try{i=n(s),a=!1}finally{a?QV(o):JV(o)}return hue(o,r),gue(i,o)}if(!t||"object"!=typeof t){if(i=n(t),void 0===i&&(i=t),i===$V&&(i=void 0),this.autoFreeze_&&KV(i,!0),r){const o=[],s=[];S_("Patches").generateReplacementPatches_(t,i,o,s),r(o,s)}return i}sc(1)},this.produceWithPatches=(t,n)=>{if("function"==typeof t)return(s,...a)=>this.produceWithPatches(s,l=>t(l,...a));let r,i;return[this.produce(t,n,(s,a)=>{r=s,i=a}),r,i]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){fg(e)||sc(8),B1(e)&&(e=function XGe(e){return B1(e)||sc(10),vue(e)}(e));const t=mue(this),n=ED(e,void 0);return n[Ji].isManual_=!0,JV(t),n}finishDraft(e,t){const n=e&&e[Ji];(!n||!n.isManual_)&&sc(9);const{scope_:r}=n;return hue(r,t),gue(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const i=t[n];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}n>-1&&(t=t.slice(n+1));const r=S_("Patches").applyPatches_;return B1(e)?r(e,t):this.produce(e,i=>r(i,t))}},fy=If.produce,KGe=(If.produceWithPatches.bind(If),If.setAutoFreeze.bind(If));function xue(...e){let t;const n=[];for(const r of e)if(r)if(t||(t=new Set),"string"==typeof r){if(t.has(r))continue;t.add(r),n.push(r)}else for(const i of r)t.has(i)||(t.add(i),n.push(i));return n}If.setUseStrictShallowCopy.bind(If),If.applyPatches.bind(If),If.createDraft.bind(If),If.finishDraft.bind(If),function(e){function t(s){if(!s.state||s.state.tree===s.editInfo.sourceTree)return s.tree.asImmutable();const a=s.state.tree.asTransient();for(const l of s.actions)switch(l.kind){case"add":a.add(l.transform);break;case"update":a.setParams(l.ref,l.params);break;case"delete":a.remove(l.ref);break;case"insert":{const c=a.children.get(l.ref).toArray();a.add(l.transform);for(const u of c)a.changeParent(u,l.transform.ref);break}}return s.editInfo.sourceTree=s.tree,a.asImmutable()}e.is=function n(s){return!!s&&"function"==typeof s.getTree},e.isTo=function r(s){return!!s&&"function"==typeof s.getTree&&"string"==typeof s.ref},e.Root=class i{get editInfo(){return this.state.editInfo}get currentTree(){return this.state.tree}to(a){const l="string"==typeof a?a:Q3.is(a)?a.transform.ref:a.ref;return new o(this.state,l,this)}toRoot(){return new o(this.state,this.state.tree.root.ref,this)}delete(a){const l=_a.resolveRef(a);return l&&this.state.tree.transforms.has(l)?(this.editInfo.count++,this.state.tree.remove(l),this.state.actions.push({kind:"delete",ref:l}),this):this}getTree(){return t(this.state)}commit(a){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,a))}constructor(a,l){this.state={state:l,tree:a.asTransient(),actions:[],editInfo:{applied:!1,sourceTree:a,count:0,lastUpdate:void 0}}}};class o{get editInfo(){return this.state.editInfo}get selector(){return new Yle(this.ref,this.state.state)}getApplyRoot(){return la.getDecoratorRoot(this.state.tree,this.ref)}apply(a,l,c){if(a.definition.isDecorator)return this.insert(a,l,c);const u=this.getApplyRoot(),d=a.apply(u,l,c);return this.state.tree.add(d),this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"add",transform:d}),new o(this.state,d.ref,this.root)}applyOrUpdate(a,l,c,u){if(this.state.tree.transforms.has(a)){const d=this.to(a);return c&&d.update(c),d}return this.apply(l,c,{...u,ref:a})}applyOrUpdateTagged(a,l,c,u){if(l.definition.isDecorator)throw new Error("Can't use applyOrUpdateTagged on decorator transformers.");const d=this.getApplyRoot(),f=this.state.tree.children.get(d).values();for(;;){const m=f.next();if(m.done)break;const h=this.state.tree.transforms.get(m.value);if(h&&vr.hasTags(h,a)){const g=this.to(m.value);return g.updateTagged(c,xue(h.tags,a,u&&u.tags)),g}}const p=l.apply(d,c,{...u,tags:xue(a,u&&u.tags)});return this.state.tree.add(p),this.editInfo.count++,this.editInfo.lastUpdate=p.ref,this.state.actions.push({kind:"add",transform:p}),new o(this.state,p.ref,this.root)}group(a,l,c){return this.apply(a,l,c)}insert(a,l,c){const u=this.state.tree.children.get(this.ref).toArray(),d=a.apply(this.ref,l,c);this.state.tree.add(d);for(const f of u)this.state.tree.changeParent(f,d.ref);return this.editInfo.count++,this.editInfo.lastUpdate=d.ref,this.state.actions.push({kind:"insert",ref:this.ref,transform:d}),new o(this.state,d.ref,this.root)}updateTagged(a,l){(this.state.tree.setParams(this.ref,a)||this.state.tree.setTags(this.ref,l))&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:a}))}update(a,l){let c;if(l){const u=this.state.tree.transforms.get(this.ref);c=fy(u.params,l)}else c="function"==typeof a?fy(this.state.tree.transforms.get(this.ref).params,a):a;return this.state.tree.setParams(this.ref,c)&&(this.editInfo.count++,this.editInfo.lastUpdate=this.ref,this.state.actions.push({kind:"update",ref:this.ref,params:c})),this.root}to(a){return this.root.to(a)}toRoot(){return this.root.toRoot()}delete(a){return this.root.delete(a)}getTree(){return t(this.state)}commit(a){if(!this.state.state)throw new Error("Cannot commit template tree");return this.state.state.runTask(this.state.state.updateTree(this,a))}constructor(a,l,c){if(this.state=a,this.root=c,this.ref=l,!this.state.tree.transforms.has(l))throw new Error(`Could not find node '${l}'.`)}}e.To=o}(C_||(C_={}));class ZGe{constructor(){this.ev=uy.create(),this.actions=new Map,this.fromTypeIndex=new Map,this.events={added:this.ev(),removed:this.ev()}}add(t){const n=yt.is(t)?t.toAction():t;if(this.actions.has(n.id))return this;this.actions.set(n.id,n);for(const r of n.definition.from)this.fromTypeIndex.has(r.type)?this.fromTypeIndex.get(r.type).push(n):this.fromTypeIndex.set(r.type,[n]);return this.events.added.next(void 0),this}remove(t){const n=yt.is(t)?t.toAction().id:oo.is(t)?t:t.id,r=this.actions.get(n);if(!r)return this;this.actions.delete(n);for(const i of r.definition.from){const o=this.fromTypeIndex.get(i.type);o&&($x(o,r),0===o.length&&this.fromTypeIndex.delete(i.type))}return this.events.removed.next(void 0),this}fromCell(t,n){const r=t.obj;if(!r)return[];const i=this.fromTypeIndex.get(r.type);if(!i)return[];let o=!1;for(const a of i)if(a.definition.isApplicable){o=!0;break}if(!o)return i;const s=[];for(const a of i)a.definition.isApplicable?a.definition.isApplicable(r,t.transform,n)&&s.push(a):s.push(a);return s}dispose(){this.ev.dispose()}}!function(e){e.message=function t(o){return{type:"message",timestamp:new Date,message:o}},e.error=function n(o){return{type:"error",timestamp:new Date,message:o}},e.warning=function r(o){return{type:"warning",timestamp:new Date,message:o}},e.info=function i(o){return{type:"info",timestamp:new Date,message:o}}}(pg||(pg={})),function(e){e.Impl=class t{get current(){return this._current}set current(o){this._current=o}getAncestorOfType(o){if(!this._current)return;let s=this._current;for(;;){if(s=this.cells.get(s.transform.parent),!s.obj)return;if(s.obj.type===o.type)return s.obj;if(s.transform.ref===vr.RootRef)return}}getRootOfType(o){if(!this._current)return;let a,s=this._current;for(;;){if(!s.obj)return;if(s.obj.type===o.type&&(a=s),s.transform.ref===vr.RootRef)return a?a.obj:void 0;s=this.cells.get(s.transform.parent)}}constructor(o){this.cells=o,this._current=void 0}},e.getDecoratorChain=function n(i,o){const s=i.cells;let a=s.get(o);const l=[a];for(;a?.transform.transformer.definition.isDecorator;)a=s.get(a.transform.parent),l.push(a);return l},e.getRootOfType=function r(i,o,s){let a,l=i.cells.get(s);if(l)for(;;){if(!l.obj)return;if(l.obj.type===o.type&&(a=l),l.transform.ref===vr.RootRef)return a?a.obj:void 0;l=i.cells.get(l.transform.parent)}}}(TD||(TD={}));class QGe{constructor(){this.queue=[],this.signal=new si}get length(){return this.queue.length}enqueue(t){return this.queue.push(t),1===this.queue.length||this.waitFor(t)}handled(t){p3(this.queue,t),this.queue.length>0&&this.signal.next({v:this.queue[0],stillPresent:!0})}remove(t){const n=p3(this.queue,t);return n&&this.signal.next({v:t,stillPresent:!1}),n}waitFor(t){return new Promise(n=>{const r=this.signal.subscribe(({v:i,stillPresent:o})=>{i===t&&(r.unsubscribe(),n(o))})})}}class L1{get tree(){return this._tree}get transforms(){return this._tree.transforms}get current(){return this.behaviors.currentObject.value.ref}get root(){return this.cells.get(this._tree.root.ref)}build(){return new C_.Root(this.tree,this)}addHistory(t,n){0!==this.historyCapacity&&(this.history.unshift([t,n||"Update"]),this.history.length>this.historyCapacity&&this.history.pop(),this.events.historyUpdated.next({state:this}))}clearHistory(){0!==this.history.length&&(this.history=[],this.events.historyUpdated.next({state:this}))}get latestUndoLabel(){return this.history.length>0?this.history[0][1]:void 0}get canUndo(){return this.history.length>0}undo(){var t=this;return Ke.create("Undo",function(){var n=le(function*(r){const i=t.history.shift();if(i){t.events.historyUpdated.next({state:t}),t.undoingHistory=!0;try{yield t.updateTree(i[0],{canUndo:!1}).runInContext(r)}finally{t.undoingHistory=!1}}});return function(r){return n.apply(this,arguments)}}())}getSnapshot(){return{tree:la.toJSON(this._tree)}}setSnapshot(t){const n=la.fromJSON(t.tree);return this.updateTree(n)}setCurrent(t){this.behaviors.currentObject.next({state:this,ref:t})}updateCellState(t,n){const r=this.cells.get(t);if(!r)return;const i="function"==typeof n?n(r.state):n;vr.assignState(r.state,i)&&(r.transform=this._tree.assignState(r.transform.ref,i),this.events.cell.stateUpdated.next({state:this,ref:t,cell:r}))}dispose(){this.ev.dispose(),this.actions.dispose()}select(t){return Qn.select(t,this)}selectQ(t){return Qn.select("string"==typeof t?t:t(Qn.Generators),this)}applyAction(t,n,r=vr.RootRef){return Ke.create("Apply Action",i=>{const o=this.cells.get(r);if(!o)throw new Error(`'${r}' does not exist.`);if("ok"!==o.status)throw new Error(`Action cannot be applied to a cell with status '${o.status}'`);return l9(t.definition.run({ref:r,cell:o,a:o.obj,params:n,state:this},this.globalContext),i)})}transaction(t,n){var r=this;return Ke.create("State Transaction",function(){var i=le(function*(o){const s=r.inTransaction,a=r._tree.asImmutable();let l=!1;try{s||r.behaviors.isUpdating.next(!0),r.inTransaction=!0,r.inTransactionError=!1,yield t(o),r.inTransactionError&&(l=!0,yield r.updateTree(a).runInContext(o))}catch(c){if(l||(l=!0,yield r.updateTree(a).runInContext(o),r.events.log.next(pg.error("Error during state transaction, reverting"))),s)throw r.inTransactionError=!0,c;if(n?.rethrowErrors)throw c;console.error(c)}finally{s||(r.inTransaction=!1,r.events.changed.next({state:r,inTransaction:!1}),r.behaviors.isUpdating.next(!1),l||(n?.canUndo?r.addHistory(a,"string"==typeof n.canUndo?n.canUndo:void 0):r.clearHistory()))}});return function(o){return i.apply(this,arguments)}}())}get inUpdate(){return this._inUpdate}updateTree(t,n){var r=this;const i={tree:t,options:n};return Ke.create("Update Tree",function(){var o=le(function*(s){if(!(yield r.updateQueue.enqueue(i)))return;r._inUpdate=!0;const l=n?.canUndo?r._tree.asImmutable():void 0;let c=!1;r.inTransaction||r.behaviors.isUpdating.next(!0);try{if(C_.is(t)){if(t.editInfo.applied)throw new Error("This builder has already been applied. Create a new builder for further state updates");t.editInfo.applied=!0}r.reverted=!1;const u=n&&(n.revertIfAborted||n.revertOnError)?yield r._revertibleTreeUpdate(s,i,n):yield r._updateTree(s,i);return c=r.reverted,u.ctx.hadError&&(r.inTransactionError=!0),u.cell?new Yle(u.cell.transform.ref,r):void 0}finally{r._inUpdate=!1,r.updateQueue.handled(i),r.inTransaction||(r.behaviors.isUpdating.next(!1),n?.canUndo?c||r.addHistory(l,"string"==typeof n.canUndo?n.canUndo:void 0):r.undoingHistory||r.clearHistory())}});return function(s){return o.apply(this,arguments)}}(),()=>{this.updateQueue.remove(i)})}_revertibleTreeUpdate(t,n,r){var i=this;return le(function*(){const o=i.tree,s=yield i._updateTree(t,n);return(s.ctx.hadError||s.ctx.wasAborted)&&r.revertOnError||s.ctx.wasAborted&&r.revertIfAborted?(i.reverted=!0,yield i._updateTree(t,{tree:o,options:n.options})):s})()}_updateTree(t,n){var r=this;return le(function*(){let i=!1;const o=r.updateTreeAndCreateCtx(n.tree,t,n.options);try{return i=yield function eqe(e){return r9.apply(this,arguments)}(o),C_.isTo(n.tree)?{ctx:o,cell:r.select(n.tree.ref)[0]}:{ctx:o}}finally{r.spine.current=void 0,i&&r.events.changed.next({state:r,inTransaction:r.inTransaction})}})()}updateTreeAndCreateCtx(t,n,r){const i=(C_.is(t)?t.getTree():t).asTransient(),o=this._tree;this._tree=i;const s=this.cells,a={parent:this,editInfo:C_.is(t)?t.editInfo:void 0,errorFree:this.errorFree,taskCtx:n,oldTree:o,tree:i,cells:this.cells,spine:this.spine,results:[],options:{...JGe,...r},changed:!1,hadError:!1,wasAborted:!1,newCurrent:void 0,getCellData:l=>{var c;return null===(c=s.get(l).obj)||void 0===c?void 0:c.data}};return this.errorFree=!0,a}constructor(t,n){this.errorFree=!0,this.ev=uy.create(),this.globalContext=void 0,this.events={cell:{stateUpdated:this.ev(),created:this.ev(),removed:this.ev()},object:{updated:this.ev(),created:this.ev(),removed:this.ev()},log:this.ev(),changed:this.ev(),historyUpdated:this.ev()},this.behaviors={currentObject:this.ev.behavior({state:this,ref:vr.RootRef}),isUpdating:this.ev.behavior(!1)},this.actions=new ZGe,this.cells=new Map,this.spine=new TD.Impl(this.cells),this.tryGetCellData=o=>{var s,a;const l=null===(a=null===(s=this.cells.get(o))||void 0===s?void 0:s.obj)||void 0===a?void 0:a.data;if(void 0===l)throw new Error(`Cell '${o}' data undefined.`);return l},this.historyCapacity=5,this.history=[],this.undoingHistory=!1,this.inTransaction=!1,this.inTransactionError=!1,this._inUpdate=!1,this.reverted=!1,this.updateQueue=new QGe,this._tree=la.createEmpty(vr.createRoot(n&&n.rootState)).asTransient();const i=this._tree.root;this.runTask=n.runTask,void 0!==n?.historyCapacity&&(this.historyCapacity=n.historyCapacity),this.cells.set(i.ref,{parent:this,transform:i,sourceRef:void 0,obj:t,status:"ok",state:{...i.state},errorText:void 0,params:{definition:{},values:{}},paramsNormalizedVersion:i.version,dependencies:{dependentBy:[],dependsOn:[]},cache:{}}),this.globalContext=n&&n.globalContext}}!function(e){let n;e.create=function t(r,i){return new e(r,i)},(n=e.ObjectEvent||(e.ObjectEvent={})).isCell=function i(o,s){return!!s&&o.ref===s.transform.ref&&o.state===s.parent}}(L1||(L1={}));const JGe={doNotLogTiming:!1,doNotUpdateCurrent:!0,revertIfAborted:!1,revertOnError:!1,canUndo:!1};function r9(){return r9=le(function*(e){let n,i,r=[];if(e.editInfo&&1===e.editInfo.count&&e.editInfo.lastUpdate&&e.editInfo.sourceTree===e.oldTree)n=[],i=[e.editInfo.lastUpdate];else{n=function iqe(e){const t={newTree:e.tree,cells:e.cells,deletes:[]};return la.doPostOrder(e.oldTree,e.oldTree.root,t,rqe),t.deletes}(e);const a=e.parent.current;let l=!1;for(const c of n)if(c===a){l=!0;break}if(l){const c=_ue(e.oldTree,a,n,e.cells);e.parent.setCurrent(c)}for(let c=n.length-1;c>=0;c--){const u=e.cells.get(n[c]);u&&iN(u.transform,u.obj,u?.transform.params,u.cache,e.parent.globalContext)}for(const c of n){const u=e.cells.get(c);u&&(u.parent=void 0,cqe(u));const d=u&&u.obj;e.cells.delete(c),r.push(d)}i=function tqe(e,t){const n={roots:[],cells:e};return la.doPreOrder(t,t.root,n,nqe),n.roots}(e.cells,e.tree)}const o=function fqe(e,t){const n={ctx:e,visited:new Set,added:[]};for(const i of t)la.doPreOrder(e.tree,e.tree.transforms.get(i),n,uqe);for(const i of n.added)dqe(i,e);let r;return n.visited.forEach(i=>{const o=e.cells.get(i);for(const s of o.dependencies.dependentBy)n.visited.has(s.transform.ref)||(r||(r=Ti.create()),Ti.add(r,s.transform.ref,s))}),{added:n.added,dependent:r?r.array:void 0}}(e,i);for(const a of o.added)e.parent.events.cell.created.next({state:e.parent,ref:a.transform.ref,cell:a});for(let a=0;a<n.length;a++){const l=n[a],c=e.oldTree.transforms.get(l).parent;e.parent.events.object.removed.next({state:e.parent,ref:l,obj:r[a]}),e.parent.events.cell.removed.next({state:e.parent,ref:l,parent:c})}if(r.length&&(r=[]),o.dependent)for(const a of o.dependent)i.push(a.transform.ref);!function lqe(e,t){for(const n of t)la.doPreOrder(e.tree,e.tree.transforms.get(n),e,aqe)}(e,i);for(const a of i)yield Cue(e,a);e.editInfo||function sqe(e){la.doPreOrder(e.tree,e.tree.root,e,oqe)}(e);let s=e.newCurrent;for(const a of e.results)"created"===a.action?(e.parent.events.object.created.next({state:e.parent,ref:a.ref,obj:a.obj}),e.newCurrent||!e.tree.transforms.get(a.ref).state.isGhost&&a.obj!==vo.Null&&(s=a.ref)):"updated"===a.action?e.parent.events.object.updated.next({state:e.parent,ref:a.ref,action:"in-place",obj:a.obj,oldData:a.oldData}):"replaced"===a.action&&e.parent.events.object.updated.next({state:e.parent,ref:a.ref,action:"recreate",obj:a.obj,oldObj:a.oldObj});if(s)e.options.doNotUpdateCurrent||e.parent.setCurrent(s);else{const a=e.parent.current,l=e.cells.get(a);l&&(l.obj===vo.Null||"error"===l.status&&l.errorText===pqe)&&(s=_ue(e.oldTree,a,[],e.cells),e.parent.setCurrent(s))}return n.length>0||i.length>0||e.changed}),r9.apply(this,arguments)}function nqe(e,t,n){const r=n.cells.get(e.ref);return r&&r.transform.version===e.version?!("error"===r.status||r&&r.obj===vo.Null):(n.roots.push(e.ref),!1)}function rqe(e,t,n){!n.newTree.transforms.has(e.ref)&&n.cells.has(e.ref)&&n.deletes.push(e.ref)}function oqe(e,t,n){const r=n.cells.get(e.ref);!r||!vr.syncState(r.state,e.state)||n.parent.events.cell.stateUpdated.next({state:n.parent,ref:e.ref,cell:r})}function rN(e,t,n,r){const i=e.cells.get(t),o=i.status!==n;i.status=n,i.errorText=r,o&&e.parent.events.cell.stateUpdated.next({state:e.parent,ref:t,cell:i})}function aqe(e,t,n){n.cells.get(e.ref).transform=e,rN(n,e.ref,"pending")}function cqe(e){for(const t of e.dependencies.dependsOn)$x(t.dependencies.dependentBy,e)}function uqe(e,t,{ctx:n,added:r,visited:i}){if(i.add(e.ref),n.cells.has(e.ref))return;const o={parent:n.parent,transform:e,sourceRef:void 0,status:"pending",state:{...e.state},errorText:void 0,params:void 0,paramsNormalizedVersion:"",dependencies:{dependentBy:[],dependsOn:[]},cache:void 0};n.cells.set(e.ref,o),r.push(o)}function dqe(e,t){if(e.transform.dependsOn)for(const n of e.transform.dependsOn){if(!t.tree.transforms.get(n))throw new Error("Cannot depend on a non-existent transform.");const i=t.cells.get(n);Us(e.dependencies.dependsOn,i),Us(i.dependencies.dependentBy,e)}}function _ue(e,t,n,r){return Sue(e,t,new Set(n),r)}function Sue(e,t,n,r){if(t===vr.RootRef)return t;const i=e.transforms.get(t),o=e.children.get(i.parent).values();let s,a=!1;for(;;){const l=o.next();if(l.done)break;if(n.has(l.value))continue;const c=r.get(l.value);if(!c||"error"===c.status||c.obj===vo.Null)continue;const u=e.transforms.get(l.value);if(!u.state.isGhost){if(l.value===t){a=!0,n.has(t)||(s=t);continue}if(a)return u.ref;s=u.ref}}return s||Sue(e,i.parent,n,r)}function i9(e,t,n,r){r||(e.hadError=!0,e.parent.errorFree=!1);const i=e.cells.get(t);if(n){e.wasAborted=e.wasAborted||Ke.isAbort(n);const s=""+n;rN(e,t,"error",s),r||e.parent.events.log.next({type:"error",timestamp:new Date,message:s})}else i.params=void 0;if(i.obj){const s=i.obj;i.obj=void 0,i.cache=void 0,e.parent.events.object.removed.next({state:e.parent,ref:t,obj:s})}const o=e.tree.children.get(t).values();for(;;){const s=o.next();if(s.done)return;i9(e,s.value,void 0,r)}}const pqe="Parent is null";function Cue(e,t){return o9.apply(this,arguments)}function o9(){return o9=le(function*(e,t){rN(e,t,"processing");let n=!1;try{const i=Bo(),o=yield function mqe(e,t){return s9.apply(this,arguments)}(e,t),s=Bo()-i;"none"!==o.action&&(e.changed=!0),rN(e,t,"ok"),e.results.push(o),"created"===o.action?(n=o.obj===vo.Null,!n&&!e.options.doNotLogTiming&&e.parent.events.log.next(pg.info(`Created ${o.obj.label} in ${AR(s)}.`))):("updated"===o.action||"replaced"===o.action)&&(n=o.obj===vo.Null,!n&&!e.options.doNotLogTiming&&e.parent.events.log.next(pg.info(`Updated ${o.obj.label} in ${AR(s)}.`)))}catch(i){return e.changed=!0,e.hadError||(e.newCurrent=t),i9(e,t,i,!1),void console.error(i)}const r=e.tree.children.get(t).values();for(;;){const i=r.next();if(i.done)return;n?i9(e,i.value,void 0,!0):yield Cue(e,i.value)}}),o9.apply(this,arguments)}function s9(){return s9=le(function*(e,t){var n;const{oldTree:r,tree:i}=e,o=e.cells.get(t),s=o.transform;if(o.transform.ref===vr.RootRef)return{action:"none"};const a=e.cells.get(o.transform.parent);if(a?.obj===vo.Null)return o.sourceRef=a.transform.ref,r.transforms.has(t)&&o.params?(iN(s,o.obj,o.params.values,o.cache,e.parent.globalContext),o.params=void 0,o.obj=vo.Null,{ref:t,action:"updated",obj:o.obj}):(o.params=void 0,{ref:t,action:"created",obj:vo.Null});const c=0===s.transformer.definition.from.length?a:Qn.findAncestorOfType(i,e.cells,t,s.transformer.definition.from);if(!c)throw new Error(`No suitable parent found for '${t}'`);e.spine.current=o;const u=c.obj;o.sourceRef=c.transform.ref;const d=function hqe(e,t,n,r){const i=t.transformer.definition.params,o=i?i(n,e.parent.globalContext):{};if(r.paramsNormalizedVersion!==t.version)t.params=I.normalizeParams(o,t.params,"all"),r.paramsNormalizedVersion=t.version;else{const s=I.getDefaultValues(o);t.params=t.params?function qFe(e,t){for(const n of Object.keys(t))NR.call(t,n)&&typeof e[n]>"u"&&(e[n]=t[n]);return e}(t.params,s):s}return I.resolveRefs(o,t.params,e.getCellData),{definition:o,values:t.params}}(e,s,u,o);if(!r.transforms.has(t)||!o.params){o.params=d;const f=yield Aue(e,o,s.transformer,u,d.values);return a9(f,s),o.obj=f,{ref:t,action:"created",obj:f}}{const f=o.params.values,p=o.cache,m=null===(n=o.obj)||void 0===n?void 0:n.data,h=d.values;switch(o.params=d,o.obj&&o.obj!==vo.Null?yield function gqe(e,t,n,r,i,o,s){return c9.apply(this,arguments)}(e,o,s.transformer,u,o.obj,f,h):yt.UpdateResult.Recreate){case yt.UpdateResult.Recreate:{const y=o.obj;iN(s,y,f,p,e.parent.globalContext);const v=yield Aue(e,o,s.transformer,u,h);return a9(v,s),o.obj=v,{ref:t,action:"replaced",oldObj:y,obj:v}}case yt.UpdateResult.Updated:return a9(o.obj,s),{ref:t,action:"updated",oldData:m,obj:o.obj};case yt.UpdateResult.Null:return iN(s,o.obj,f,p,e.parent.globalContext),o.obj=vo.Null,{ref:t,action:"updated",obj:o.obj};default:return{action:"none"}}}}),s9.apply(this,arguments)}function iN(e,t,n,r,i){var o,s;null===(s=(o=e.transformer.definition).dispose)||void 0===s||s.call(o,{b:t!==vo.Null?t:void 0,params:n,cache:r},i)}function a9(e,t){!e||e===vo.Null||(e.tags=t.tags)}function l9(e,t){return"function"==typeof e.runInContext?e.runInContext(t):e}function wue(e){if(0===e.dependencies.dependsOn.length)return;const t=Object.create(null);for(const n of e.dependencies.dependsOn){if(!n.obj)throw new Error("Unresolved dependency.");t[n.transform.ref]=n.obj}return t}function Aue(e,t,n,r,i){return t.cache||(t.cache=Object.create(null)),l9(n.definition.apply({a:r,params:i,cache:t.cache,spine:e.spine,dependencies:wue(t)},e.parent.globalContext),e.taskCtx)}function c9(){return c9=le(function*(e,t,n,r,i,o,s){return n.definition.update?(t.cache||(t.cache=Object.create(null)),l9(n.definition.update({a:r,oldParams:o,b:i,newParams:s,cache:t.cache,spine:e.spine,dependencies:wue(t)},e.parent.globalContext),e.taskCtx)):yt.UpdateResult.Recreate}),c9.apply(this,arguments)}var Se,nn;!function(e){function r(f){return e.Create({...f,typeClass:"Representation3D"})}e.Create=vo.factory(),e.isRepresentation3D=function t(f){return!!f&&"Representation3D"===f.type.typeClass},e.isBehavior=function n(f){return!!f&&"Behavior"===f.type.typeClass},e.CreateRepresentation3D=r,e.CreateBehavior=function i(f){return e.Create({...f,typeClass:"Behavior"})};class o extends(e.Create({name:"Root",typeClass:"Root"})){}e.Root=o;class s extends(e.Create({name:"Group",typeClass:"Group"})){}let a,l,c,u,d;e.Group=s,function(f){class p extends(e.Create({name:"String Data",typeClass:"Data"})){}f.String=p;class m extends(e.Create({name:"Binary Data",typeClass:"Data"})){}f.Binary=m;class h extends(e.Create({name:"Data Blob",typeClass:"Data"})){}f.Blob=h}(a=e.Data||(e.Data={})),function(f){class p extends(e.Create({name:"JSON Data",typeClass:"Data"})){}f.Json=p;class m extends(e.Create({name:"CIF File",typeClass:"Data"})){}f.Cif=m;class h extends(e.Create({name:"Cube File",typeClass:"Data"})){}f.Cube=h;class g extends(e.Create({name:"PSF File",typeClass:"Data"})){}f.Psf=g;class y extends(e.Create({name:"PRMTOP File",typeClass:"Data"})){}f.Prmtop=y;class v extends(e.Create({name:"TOP File",typeClass:"Data"})){}f.Top=v;class x extends(e.Create({name:"PLY File",typeClass:"Data"})){}f.Ply=x;class _ extends(e.Create({name:"CCP4/MRC/MAP File",typeClass:"Data"})){}f.Ccp4=_;class w extends(e.Create({name:"DSN6/BRIX File",typeClass:"Data"})){}f.Dsn6=w;class A extends(e.Create({name:"DX File",typeClass:"Data"})){}f.Dx=A;class M extends(e.Create({name:"Format Blob",typeClass:"Data"})){}f.Blob=M}(l=e.Format||(e.Format={})),function(f){class p extends(e.Create({name:"Coordinates",typeClass:"Object"})){}f.Coordinates=p;class m extends(e.Create({name:"Topology",typeClass:"Object"})){}f.Topology=m;class h extends(e.Create({name:"Model",typeClass:"Object"})){}f.Model=h;class g extends(e.Create({name:"Trajectory",typeClass:"Object"})){}f.Trajectory=g;class y extends(e.Create({name:"Structure",typeClass:"Object"})){}f.Structure=y,function(v){class x extends(r({name:"Structure 3D"})){}v.Representation3D=x;class _ extends(e.Create({name:"Structure 3D State",typeClass:"Object"})){}v.Representation3DState=_;class w extends(e.Create({name:"Selections",typeClass:"Object"})){}v.Selections=w}(y=f.Structure||(f.Structure={}))}(c=e.Molecule||(e.Molecule={})),function(f){class p extends(e.Create({name:"Volume",typeClass:"Object"})){}f.Data=p;class m extends(e.Create({name:"Lazy Volume",typeClass:"Object"})){}f.Lazy=m;class h extends(r({name:"Volume 3D"})){}f.Representation3D=h}(u=e.Volume||(e.Volume={})),function(f){class p extends(e.Create({name:"Shape Provider",typeClass:"Object"})){}f.Provider=p;class m extends(r({name:"Shape 3D"})){}f.Representation3D=m}(d=e.Shape||(e.Shape={}))}(Se||(Se={})),function(e){e.CreateBuiltIn=yt.factory("ms-plugin"),e.BuiltIn=yt.builderFactory("ms-plugin")}(nn||(nn={}));const Iue=.529177210859;function xqe(e,t){return Ke.create("Parse Cube",function(){var n=le(function*(r){yield r.update("Reading header...");const i=kt(e),{header:o,atoms:s}=function yqe(e){const t=kt.readLines(e,6),n=(v,x)=>{const _=+t[v].trim().split(/\s+/g)[x];return Number.isNaN(_)?0:_},r=v=>{const x=n(v+2,0),_=Iue;return[Math.abs(x),C.create(n(v+2,1)*_,n(v+2,2)*_,n(v+2,3)*_),x]},i=t[0].trim(),o=t[1].trim(),[s,a,l]=r(0),[c,u]=r(1),[d,f]=r(2),[p,m]=r(3),h=function bqe(e,t,n){const r=new Int32Array(t),i=new Float64Array(t),o=new Float32Array(t),s=new Float32Array(t),a=new Float32Array(t);for(let l=0;l<t;l++){const c=kt.readLine(e).trim().split(/\s+/g);r[l]=+c[0],i[l]=+c[1],o[l]=+c[2]*n,s[l]=+c[3]*n,a[l]=+c[4]*n}return{count:t,number:ce.ofArray({array:r,schema:ce.Schema.int}),nuclearCharge:ce.ofArray({array:i,schema:ce.Schema.float}),x:ce.ofArray({array:o,schema:ce.Schema.float}),y:ce.ofArray({array:s,schema:ce.Schema.float}),z:ce.ofArray({array:a,schema:ce.Schema.float})}}(e,s,Iue),g=[];if(l>=0){let v=n(2,4);0===v&&(v=1);for(let x=0;x<v;x++)g.push(x)}else{const v=kt.readLine(e).trim().split(/\s+/g);for(let x=0,_=+v[0];x<_;x++)g.push(+v[x+1])}return{header:{orbitals:l<0,comment1:i,comment2:o,atomCount:s,origin:a,dim:C.create(c,d,p),basisX:u,basisY:f,basisZ:m,dataSetIds:g},atoms:h}}(i),a=yield function vqe(e,t,n){const r=n.dim[0]*n.dim[1]*n.dim[2]*n.dataSetIds.length,i=1e6,o=new Float64Array(r);let s=0;return G0(e,i,o,(a,l)=>{const c=Math.min(r,s+a);for(let u=s;u<c;u++)kt.skipWhitespace(t),t.tokenStart=t.position,kt.eatValue(t),l[u]=V0(t.data,t.tokenStart,t.tokenEnd);return s=c,c===r?0:i},(a,l,c)=>a.update({current:Math.min(c,r),max:r}))}(r,i,o);return qi.success({header:o,atoms:s,values:a,name:t})});return function(r){return n.apply(this,arguments)}}())}function Eue(e){const t={h:C()};let n=0,r=0;const i=/\s+/g;for(;;){const o=kt.readLine(e);let s;if(o.startsWith("object 1"))s=o.split(i),t.dim=C.create(parseInt(s[5]),parseInt(s[6]),parseInt(s[7]));else if(o.startsWith("origin"))s=o.split(i),t.min=C.create(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));else if(o.startsWith("delta"))s=o.split(i),0===r?t.h[0]=parseFloat(s[1]):1===r?t.h[1]=parseFloat(s[2]):2===r&&(t.h[2]=parseFloat(s[3])),r+=1;else if(o.startsWith("object 3")){n+=o.length+1;break}n+=o.length+1}return{header:t,headerByteCount:n}}function u9(){return u9=le(function*(e,t,n){yield e.update("Reading header...");const r=kt(t),{header:i}=Eue(r);yield e.update("Reading values...");const o=yield function _qe(e,t,n){const r=n.dim[0]*n.dim[1]*n.dim[2],i=1e6,o=new Float64Array(r);let s=0;return G0(e,i,o,(a,l)=>{const c=Math.min(r,s+a);for(let u=s;u<c;u++)kt.skipWhitespace(t),t.tokenStart=t.position,kt.eatValue(t),l[u]=V0(t.data,t.tokenStart,t.tokenEnd);return s=c,c===r?0:i},(a,l,c)=>a.update({current:Math.min(c,r),max:r}))}(e,r,i);return qi.success({header:i,values:o,name:n})}),u9.apply(this,arguments)}function d9(){return d9=le(function*(e,t,n){yield e.update("Reading header...");const i=kt(mz(t,0,1e3)),{header:o,headerByteCount:s}=Eue(i);yield e.update("Reading values...");const a=o.dim[0]*o.dim[1]*o.dim[2],l=new DataView(t.buffer,t.byteOffset+s),c=new Float64Array(a);for(let u=0;u<a;u++)c[u]=l.getFloat64(8*u,!0);return qi.success({header:o,values:c,name:n})}),d9.apply(this,arguments)}const qn={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflower:6591981,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,laserlemon:16777044,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrod:16448210,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,maroon2:8323072,maroon3:11546720,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,purple2:8323199,purple3:10494192,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Tue=(function(){const e=new Map;Object.keys(qn).forEach(t=>{e.set(qn[t],t)})}(),Object.keys({NATOM:"",NTYPES:"",NBONH:"",MBONA:"",NTHETH:"",MTHETA:"",NPHIH:"",MPHIA:"",NHPARM:"",NPARM:"",NNB:"",NRES:"",NBONA:"",NTHETA:"",NPHIA:"",NUMBND:"",NUMANG:"",NPTRA:"",NATYP:"",NPHB:"",IFPERT:"",NBPER:"",NGPER:"",NDPER:"",MBPER:"",MGPER:"",MDPER:"",IFBOX:"",NMXRS:"",IFCAP:"",NUMEXTRA:"",NCOPY:""})),{readLine:oN,markLine:Due,trim:Aqe}=kt;function Eqe(e){const{tokenizer:t}=e,n=[];for(;t.tokenEnd<t.length&&"%"!==t.data[t.position];){const r=oN(t).trim();r&&n.push(r)}return n}function Tqe(e){const{tokenizer:t}=e,n=Object.create(null);Tue.forEach(i=>{n[i]=0});let r=0;for(;t.tokenEnd<t.length&&"%"!==t.data[t.position];){const i=oN(t),o=Math.min(r+10,32);for(let s=0;r<o;++s,++r)n[Tue[r]]=parseInt(i.substring(8*s,8*s+8).trim())}return n}function j1(e,t,n,r){const{tokenizer:i}=e,o=ot.create(i.data,2*t);let s=0;for(;i.tokenEnd<i.length&&"%"!==i.data[i.position];){i.tokenStart=i.position;const a=Math.min(s+n,t);for(let l=0;s<a;++l,++s){const c=i.position;Aqe(i,i.position,i.position+r),ot.addUnchecked(o,i.tokenStart,i.tokenEnd),i.position=c+r}Due(i)}return o}function f9(){return f9=le(function*(e,t){const n=kt(e),r=function Iqe(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t),i=Object.create(null);let o=0;for(;n.tokenEnd<n.length;){n.position-o>1e5&&t.shouldUpdate&&(o=n.position,yield t.update({current:n.position,max:n.length}));const s=oN(r.tokenizer).trim();if(s.startsWith("%VERSION"))i.version=s.substring(8).trim();else if(s.startsWith("%FLAG")){const a=s.substring(5).trim();if(!oN(r.tokenizer).trim().startsWith("%FORMAT"))throw new Error("expected %FORMAT");if("TITLE"===a)i.title=Eqe(r);else if("POINTERS"===a)i.pointers=Tqe(r);else if("ATOM_NAME"===a){const c=j1(r,i.pointers.NATOM,20,4);i.atomName=Pn(c)(ce.Schema.str)}else if("CHARGE"===a){const c=j1(r,i.pointers.NATOM,5,16);i.charge=Pn(c)(ce.Schema.float)}else if("MASS"===a){const c=j1(r,i.pointers.NATOM,5,16);i.mass=Pn(c)(ce.Schema.float)}else if("RESIDUE_LABEL"===a){const c=j1(r,i.pointers.NRES,20,4);i.residueLabel=Pn(c)(ce.Schema.str)}else if("RESIDUE_POINTER"===a){const c=j1(r,i.pointers.NRES,10,8);i.residuePointer=Pn(c)(ce.Schema.int)}else if("BONDS_INC_HYDROGEN"===a){const c=j1(r,3*i.pointers.NBONH,10,8);i.bondsIncHydrogen=Pn(c)(ce.Schema.int)}else if("BONDS_WITHOUT_HYDROGEN"===a){const c=j1(r,3*i.pointers.NBONA,10,8);i.bondsWithoutHydrogen=Pn(c)(ce.Schema.int)}else if("RADII"===a){const c=j1(r,i.pointers.NATOM,5,16);i.radii=Pn(c)(ce.Schema.float)}else for(;n.tokenEnd<n.length&&"%"!==n.data[n.position];)Due(n)}}return qi.success(i)}),f9.apply(this,arguments)}const kqe={nr:ce.Schema.Int(),type:ce.Schema.Str(),resnr:ce.Schema.Int(),residu:ce.Schema.Str(),atom:ce.Schema.Str(),cgnr:ce.Schema.Int(),charge:ce.Schema.Float(),mass:ce.Schema.Float()},Mqe={ai:ce.Schema.Int(),aj:ce.Schema.Int()},Rqe={compound:ce.Schema.Str(),molCount:ce.Schema.Int()},{readLine:p9,markLine:U1,skipWhitespace:z1,markStart:sN,eatValue:h9,eatLine:Nqe}=kt,Oqe=/\[ (.+) \]/,Bqe=/\s+/;function Lqe(e){const{tokenizer:t}=e;let n;for(;t.tokenEnd<t.length;){z1(t);const r=t.data[t.position];if("["===r)break;if(";"!==r&&"*"!==r){if(void 0!==n)throw new Error("more than one molName");n=p9(t).split(Bqe)[0]}else U1(t)}if(void 0===n)throw new Error("missing molName");return n}function jqe(e){const{tokenizer:t}=e,n=ot.create(t.data,64),r=ot.create(t.data,64),i=ot.create(t.data,64),o=ot.create(t.data,64),s=ot.create(t.data,64),a=ot.create(t.data,64),l=ot.create(t.data,64),c=ot.create(t.data,64);for(;t.tokenEnd<t.length;){z1(t);const u=t.data[t.position];if("["===u)break;if(";"!==u&&"*"!==u){for(let d=0;d<8;++d)switch(z1(t),sN(t),h9(t),d){case 0:ot.add(n,t.tokenStart,t.tokenEnd);break;case 1:ot.add(r,t.tokenStart,t.tokenEnd);break;case 2:ot.add(i,t.tokenStart,t.tokenEnd);break;case 3:ot.add(o,t.tokenStart,t.tokenEnd);break;case 4:ot.add(s,t.tokenStart,t.tokenEnd);break;case 5:ot.add(a,t.tokenStart,t.tokenEnd);break;case 6:ot.add(l,t.tokenStart,t.tokenEnd);break;case 7:ot.add(c,t.tokenStart,t.tokenEnd)}U1(t)}else U1(t)}return Kr.ofColumns(kqe,{nr:Pn(n)(ce.Schema.int),type:Pn(r)(ce.Schema.str),resnr:Pn(i)(ce.Schema.int),residu:Pn(o)(ce.Schema.str),atom:Pn(s)(ce.Schema.str),cgnr:Pn(a)(ce.Schema.int),charge:Pn(l)(ce.Schema.float),mass:Pn(c)(ce.Schema.float)})}function Uqe(e){const{tokenizer:t}=e,n=ot.create(t.data,64),r=ot.create(t.data,64);for(;t.tokenEnd<t.length;){z1(t);const i=t.data[t.position];if("["===i)break;if(";"!==i&&"*"!==i){for(let o=0;o<2;++o)switch(z1(t),sN(t),h9(t),o){case 0:ot.add(n,t.tokenStart,t.tokenEnd);break;case 1:ot.add(r,t.tokenStart,t.tokenEnd)}U1(t)}else U1(t)}return Kr.ofColumns(Mqe,{ai:Pn(n)(ce.Schema.int),aj:Pn(r)(ce.Schema.int)})}function zqe(e){const{tokenizer:t}=e;let n;for(;t.tokenEnd<t.length;){z1(t);const r=t.data[t.position];if("["===r)break;if(";"!==r&&"*"!==r){if(void 0!==n)throw new Error("more than one system");n=p9(t).trim()}else U1(t)}if(void 0===n)throw new Error("missing system");return n}function Vqe(e){const{tokenizer:t}=e,n=ot.create(t.data,64),r=ot.create(t.data,64);for(;t.tokenEnd<t.length&&(z1(t),!(t.position>=t.length));){const i=t.data[t.position];if("["===i)break;if(";"!==i&&"*"!==i){for(let o=0;o<2;++o)switch(z1(t),sN(t),h9(t),o){case 0:ot.add(n,t.tokenStart,t.tokenEnd);break;case 1:ot.add(r,t.tokenStart,t.tokenEnd)}Nqe(t),sN(t)}else U1(t)}return Kr.ofColumns(Rqe,{compound:Pn(n)(ce.Schema.str),molCount:Pn(r)(ce.Schema.int)})}function m9(){return m9=le(function*(e,t){const n=kt(e),r=function Fqe(e,t){return{tokenizer:e,runtimeCtx:t}}(n,t),i=Object.create(null);let o=0;i.compounds={};let s={},a="";function l(){a&&s.atoms&&(i.compounds[a]=s,s={},a="")}for(;n.tokenEnd<n.length;){n.position-o>1e5&&t.shouldUpdate&&(o=n.position,yield t.update({current:n.position,max:n.length}));const c=p9(r.tokenizer).trim();if(c&&"*"!==c[0]&&";"!==c[0]){if(c.startsWith("#include"))throw new Error("#include statements not allowed");if(c.startsWith("[")){const u=c.match(Oqe);if(null===u)throw new Error("expected field name");const d=u[1];if("moleculetype"===d)l(),a=Lqe(r);else if("atoms"===d)s.atoms=jqe(r);else if("bonds"===d)s.bonds=Uqe(r);else if("system"===d)i.system=zqe(r);else if("molecules"===d)l(),i.molecules=Vqe(r);else for(;n.tokenEnd<n.length&&"["!==n.data[n.position];)U1(n)}}}return qi.success(i)}),m9.apply(this,arguments)}const Pue=nn.BuiltIn({name:"download",display:{name:"Download",description:"Download string or binary data from the specified URL"},from:[Se.Root],to:[Se.Data.String,Se.Data.Binary],params:{url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"}))}})({apply:({params:e,cache:t},n)=>Ke.create("Download",function(){var r=le(function*(i){const o=jr.getUrlAsset(n.managers.asset,e.url),s=yield n.managers.asset.resolve(o,e.isBinary?"binary":"string").runInContext(i);return t.asset=s,e.isBinary?new Se.Data.Binary(s.data,{label:e.label?e.label:o.url}):new Se.Data.String(s.data,{label:e.label?e.label:o.url})});return function(i){return r.apply(this,arguments)}}()),dispose({cache:e}){var t;null===(t=e?.asset)||void 0===t||t.dispose()},update:({oldParams:e,newParams:t,b:n})=>e.url!==t.url||e.isBinary!==t.isBinary?yt.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||("string"==typeof t.url?t.url:t.url.url),yt.UpdateResult.Updated):yt.UpdateResult.Unchanged}),kue=nn.BuiltIn({name:"download-blob",display:{name:"Download Blob",description:"Download multiple string or binary data from the specified URLs."},from:Se.Root,to:Se.Data.Blob,params:{sources:I.ObjectList({id:I.Text("",{label:"Unique ID"}),url:I.Url("https://www.ebi.ac.uk/pdbe/static/entry/1cbs_updated.cif",{description:"Resource URL. Must be the same domain or support CORS."}),isBinary:I.Optional(I.Boolean(!1,{description:"If true, download data as binary (string otherwise)"})),canFail:I.Optional(I.Boolean(!1,{description:"Indicate whether the download can fail and not be included in the blob as a result."}))},e=>`${e.id}: ${e.url}`),maxConcurrency:I.Optional(I.Numeric(4,{min:1,max:12,step:1},{description:"The maximum number of concurrent downloads."}))}})({apply:({params:e,cache:t},n)=>Ke.create("Download Blob",function(){var r=le(function*(i){const o=[],s=yield function $ze(e,t,n,r){return d7.apply(this,arguments)}(i,n.managers.asset,e.sources,e.maxConcurrency||4),a=[];for(let l=0;l<s.length;l++){const c=s[l],u=e.sources[l];"error"===c.kind?n.log.warn(`Download ${c.id} (${u.url}) failed: ${c.error}`):(a.push(c.result),o.push(u.isBinary?{id:c.id,kind:"binary",data:c.result.data}:{id:c.id,kind:"string",data:c.result.data}))}return t.assets=a,new Se.Data.Blob(o,{label:"Data Blob",description:`${o.length} ${1===o.length?"entry":"entries"}`})});return function(i){return r.apply(this,arguments)}}()),dispose({cache:e},t){const n=e?.assets;if(n)for(const r of n)r.dispose()}}),Mue=nn.BuiltIn({name:"raw-data",display:{name:"Raw Data",description:"Raw data supplied by value."},from:[Se.Root],to:[Se.Data.String,Se.Data.Binary],params:{data:I.Value("",{isHidden:!0}),label:I.Optional(I.Text(""))}})({apply:({params:e})=>Ke.create("Raw Data",le(function*(){return"string"==typeof e.data?new Se.Data.String(e.data,{label:e.label?e.label:"String"}):Array.isArray(e.data)||e.data instanceof ArrayBuffer?new Se.Data.Binary(new Uint8Array(e.data),{label:e.label?e.label:"Binary"}):e.data instanceof Uint8Array?new Se.Data.Binary(e.data,{label:e.label?e.label:"Binary"}):void Hi()})),update:({oldParams:e,newParams:t,b:n})=>e.data!==t.data?yt.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||n.label,yt.UpdateResult.Updated):yt.UpdateResult.Unchanged,customSerialization:{toJSON(e){if("string"==typeof e.data||Array.isArray(e.data))return e;if(e.data instanceof ArrayBuffer){const t=new Uint8Array(e.data),n=new Array(t.length);for(let r=0,i=t.length;r<i;r++)n[r]=t[r];return{data:n,label:e.label}}if(e.data instanceof Uint8Array){const t=new Array(e.data.length);for(let n=0,r=e.data.length;n<r;n++)t[n]=e.data[n];return{data:t,label:e.label}}},fromJSON:e=>e}}),Rue=nn.BuiltIn({name:"read-file",display:{name:"Read File",description:"Read string or binary data from the specified file"},from:Se.Root,to:[Se.Data.String,Se.Data.Binary],params:{file:I.File(),label:I.Optional(I.Text("")),isBinary:I.Optional(I.Boolean(!1,{description:"If true, open file as as binary (string otherwise)"}))}})({apply:({params:e,cache:t},n)=>Ke.create("Open File",function(){var r=le(function*(i){if(null===e.file)return n.log.error("No file(s) selected"),vo.Null;const o=yield n.managers.asset.resolve(e.file,e.isBinary?"binary":"string").runInContext(i);return t.asset=o,e.isBinary?new Se.Data.Binary(o.data,{label:e.label?e.label:e.file.name}):new Se.Data.String(o.data,{label:e.label?e.label:e.file.name})});return function(i){return r.apply(this,arguments)}}()),dispose({cache:e}){var t;null===(t=e?.asset)||void 0===t||t.dispose()},update({oldParams:e,newParams:t,b:n}){var r;return e.label!==t.label?(n.label=t.label||(null===(r=e.file)||void 0===r?void 0:r.name)||"",yt.UpdateResult.Updated):yt.UpdateResult.Unchanged},isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user loaded files."})}),qqe=nn.BuiltIn({name:"parse-blob",display:{name:"Parse Blob",description:"Parse multiple data enties"},from:Se.Data.Blob,to:Se.Format.Blob,params:{formats:I.ObjectList({id:I.Text("",{label:"Unique ID"}),format:I.Select("cif",[["cif","cif"]])},e=>`${e.id}: ${e.format}`)}})({apply:({a:e,params:t},n)=>Ke.create("Parse Blob",function(){var r=le(function*(i){const o=new Map;for(const a of t.formats)o.set(a.id,a.format);const s=[];for(const a of e.data){if(!o.has(a.id))continue;const l=yield("string"===a.kind?Hh.parse(a.data):Hh.parseBinary(a.data)).runInContext(i);if(l.isError)throw new Error(`${a.id}: ${l.message}`);s.push({id:a.id,kind:"cif",data:l.result})}return new Se.Format.Blob(s,{label:"Format Blob",description:`${s.length} ${1===s.length?"entry":"entries"}`})});return function(i){return r.apply(this,arguments)}}())}),Wqe=nn.BuiltIn({name:"parse-cif",display:{name:"Parse CIF",description:"Parse CIF from String or Binary data"},from:[Se.Data.String,Se.Data.Binary],to:Se.Format.Cif})({apply:({a:e})=>Ke.create("Parse CIF",function(){var t=le(function*(n){const r=yield("string"==typeof e.data?Hh.parse(e.data):Hh.parseBinary(e.data)).runInContext(n);if(r.isError)throw new Error(r.message);return 0===r.result.blocks.length?vo.Null:new Se.Format.Cif(r.result)});return function(n){return t.apply(this,arguments)}}())}),$qe=nn.BuiltIn({name:"parse-cube",display:{name:"Parse Cube",description:"Parse Cube from String data"},from:Se.Data.String,to:Se.Format.Cube})({apply:({a:e})=>Ke.create("Parse Cube",function(){var t=le(function*(n){const r=yield xqe(e.data,e.label).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Cube(r.result)});return function(n){return t.apply(this,arguments)}}())}),Yqe=nn.BuiltIn({name:"parse-psf",display:{name:"Parse PSF",description:"Parse PSF from String data"},from:[Se.Data.String],to:Se.Format.Psf})({apply:({a:e})=>Ke.create("Parse PSF",function(){var t=le(function*(n){const r=yield function jHe(e){return Ke.create("Parse PSF",function(){var t=le(function*(n){return yield function LHe(e,t){return Z7.apply(this,arguments)}(e,n)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Psf(r.result)});return function(n){return t.apply(this,arguments)}}())}),Xqe=nn.BuiltIn({name:"parse-prmtop",display:{name:"Parse PRMTOP",description:"Parse PRMTOP from String data"},from:[Se.Data.String],to:Se.Format.Prmtop})({apply:({a:e})=>Ke.create("Parse PRMTOP",function(){var t=le(function*(n){const r=yield function Pqe(e){return Ke.create("Parse PRMTOP",function(){var t=le(function*(n){return yield function Dqe(e,t){return f9.apply(this,arguments)}(e,n)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Prmtop(r.result)});return function(n){return t.apply(this,arguments)}}())}),Kqe=nn.BuiltIn({name:"parse-top",display:{name:"Parse TOP",description:"Parse TOP from String data"},from:[Se.Data.String],to:Se.Format.Top})({apply:({a:e})=>Ke.create("Parse TOP",function(){var t=le(function*(n){const r=yield function Gqe(e){return Ke.create("Parse TOP",function(){var t=le(function*(n){return yield function Hqe(e,t){return m9.apply(this,arguments)}(e,n)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Top(r.result)});return function(n){return t.apply(this,arguments)}}())}),Zqe=nn.BuiltIn({name:"parse-ply",display:{name:"Parse PLY",description:"Parse PLY from String data"},from:[Se.Data.String],to:Se.Format.Ply})({apply:({a:e})=>Ke.create("Parse PLY",function(){var t=le(function*(n){const r=yield function kHe(e){return Ke.create("Parse PLY",function(){var t=le(function*(n){return yield function PHe(e,t){return $7.apply(this,arguments)}(e,n)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Ply(r.result,{label:r.result.comments[0]||"PLY Data"})});return function(n){return t.apply(this,arguments)}}())}),Qqe=nn.BuiltIn({name:"parse-ccp4",display:{name:"Parse CCP4/MRC/MAP",description:"Parse CCP4/MRC/MAP from Binary data"},from:[Se.Data.Binary],to:Se.Format.Ccp4})({apply:({a:e})=>Ke.create("Parse CCP4/MRC/MAP",function(){var t=le(function*(n){const r=yield function fHe(e,t){return function dHe(e,t){return Ke.create("Parse CCP4/MRC/MAP",function(){var n=le(function*(r){try{return qi.success(yield function uHe(e,t,n){return z7.apply(this,arguments)}(e,t,r))}catch(i){return qi.error(i)}});return function(r){return n.apply(this,arguments)}}())}(R5.fromBuffer($h.fromUint8Array(e),t),e.length)}(e.data,e.label).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Ccp4(r.result)});return function(n){return t.apply(this,arguments)}}())}),Jqe=nn.BuiltIn({name:"parse-dsn6",display:{name:"Parse DSN6/BRIX",description:"Parse CCP4/BRIX from Binary data"},from:[Se.Data.Binary],to:Se.Format.Dsn6})({apply:({a:e})=>Ke.create("Parse DSN6/BRIX",function(){var t=le(function*(n){const r=yield function xHe(e,t){return function vHe(e,t){return Ke.create("Parse DSN6/BRIX",function(){var n=le(function*(r){try{return qi.success(yield function bHe(e,t,n){return q7.apply(this,arguments)}(e,t,r))}catch(i){return qi.error(i)}});return function(r){return n.apply(this,arguments)}}())}(R5.fromBuffer($h.fromUint8Array(e),t),e.length)}(e.data,e.label).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Dsn6(r.result)});return function(n){return t.apply(this,arguments)}}())}),eWe=nn.BuiltIn({name:"parse-dx",display:{name:"Parse DX",description:"Parse DX from Binary/String data"},from:[Se.Data.Binary,Se.Data.String],to:Se.Format.Dx})({apply:({a:e})=>Ke.create("Parse DX",function(){var t=le(function*(n){const r=yield function wqe(e,t){return Ke.create("Parse DX",n=>"string"==typeof e?function Sqe(e,t,n){return u9.apply(this,arguments)}(n,e,t):function Cqe(e,t,n){return d9.apply(this,arguments)}(n,e,t))}(e.data,e.label).runInContext(n);if(r.isError)throw new Error(r.message);return new Se.Format.Dx(r.result)});return function(n){return t.apply(this,arguments)}}())}),tWe=nn.BuiltIn({name:"import-string",display:{name:"Import String",description:"Import given data as a string"},from:Se.Root,to:Se.Data.String,params:{data:I.Value(""),label:I.Optional(I.Text(""))}})({apply:({params:{data:e,label:t}})=>new Se.Data.String(e,{label:t||""}),update:({oldParams:e,newParams:t,b:n})=>e.data!==t.data?yt.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||"",yt.UpdateResult.Updated):yt.UpdateResult.Unchanged,isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported strings."})}),nWe=nn.BuiltIn({name:"import-json",display:{name:"Import JSON",description:"Import given data as a JSON"},from:Se.Root,to:Se.Format.Json,params:{data:I.Value({}),label:I.Optional(I.Text(""))}})({apply:({params:{data:e,label:t}})=>new Se.Format.Json(e,{label:t||""}),update:({oldParams:e,newParams:t,b:n})=>e.data!==t.data?yt.UpdateResult.Recreate:e.label!==t.label?(n.label=t.label||"",yt.UpdateResult.Updated):yt.UpdateResult.Unchanged,isSerializable:()=>({isSerializable:!1,reason:"Cannot serialize user imported JSON."})}),rWe=nn.BuiltIn({name:"parse-json",display:{name:"Parse JSON",description:"Parse JSON from String data"},from:[Se.Data.String],to:Se.Format.Json})({apply:({a:e})=>Ke.create("Parse JSON",function(){var t=le(function*(n){const r=yield new Response(e.data).json();return new Se.Format.Json(r)});return function(n){return t.apply(this,arguments)}}())}),iWe=nn.BuiltIn({name:"lazy-volume",display:{name:"Lazy Volume",description:"A placeholder for lazy loaded volume representation"},from:Se.Root,to:Se.Volume.Lazy,params:{url:I.Url(""),isBinary:I.Boolean(!1),format:I.Text("ccp4"),entryId:I.Value("",{isHidden:!0}),isovalues:I.ObjectList({type:I.Text("relative"),value:I.Numeric(0),color:I.Color(qn.black),alpha:I.Numeric(1,{min:0,max:1,step:.01}),volumeIndex:I.Numeric(0)},e=>`${e.type} ${e.value}`)}})({apply:({params:t})=>Ke.create("Lazy Volume",function(){var n=le(function*(r){const i=Array.isArray(t.entryId)?t.entryId.join(", "):t.entryId;return new Se.Volume.Lazy(t,{label:`${i||t.url}`,description:"Lazy Volume"})});return function(r){return n.apply(this,arguments)}}())}),oWe=nn.BuiltIn({name:"create-group",display:{name:"Group"},from:[],to:Se.Group,params:{label:I.Text("Group"),description:I.Optional(I.Text(""))}})({apply:({params:e})=>new Se.Group({},e),update:({oldParams:e,newParams:t,b:n})=>lw(e,t)?yt.UpdateResult.Unchanged:(n.label=t.label,n.description=t.description,yt.UpdateResult.Updated)});function dWe(e,t){return{tokenizer:e,header:{title:"",timeInPs:0,hasVelocities:!1,precision:{position:0,velocity:0},box:[0,0,0]},numberOfAtoms:0,runtimeCtx:t}}function fWe(e){const{tokenizer:t,header:n}=e;let r=kt.readLine(t);0===r.trim().length&&(r=kt.readLine(t));const i=r.lastIndexOf("t=");i>=0?(n.timeInPs=parseFloat(r.substring(i+2)),n.title=r.substring(0,i).trim(),n.title&&","===n.title[n.title.length-1]&&(n.title=n.title.substring(0,n.title.length-1))):n.title=r}function pWe(e){const{tokenizer:t}=e;kt.markLine(t);const n=kt.getTokenString(t);e.numberOfAtoms=parseInt(n)}function hWe(e){return g9.apply(this,arguments)}function g9(){return g9=le(function*(e){const{tokenizer:t,numberOfAtoms:n}=e,r=yield kt.readLinesAsync(t,n,e.runtimeCtx,1e5),o=t.data.substring(r.indices[0],r.indices[1]).substring(20).match(/\.\d+/g),s=6===o.length;e.header.hasVelocities=s,e.header.precision.position=o[0].length-1,e.header.precision.velocity=s?o[3].length-1:0;const l=e.header.precision.position+5,c=20+3*l,u=e.header.precision.velocity+4,d=function lWe(e){return function(t,n,r){return function cWe(e,t,n,r){const{data:i,indices:o,count:s}=e,{valueType:a}=r,l="str"===a?c=>{const u=o[2*c]+t,d=o[2*c+1];if(u>=d)return"";let f=u+n;return f>d&&(f=d),function tUe(e,t,n){let r=t,i=n-1,o=e.charCodeAt(r);for(;(9===o||32===o)&&r<=i;)o=e.charCodeAt(++r);for(o=e.charCodeAt(i);(9===o||32===o)&&i>=r;)o=e.charCodeAt(--i);return e.substring(r,i+1)}(i,u,f)}:"int"===a?c=>{const u=o[2*c]+t;return u>o[2*c+1]?0:Gx(i,u,u+n)}:c=>{const u=o[2*c]+t;return u>o[2*c+1]?0:function wFe(e,t,n){for(;t<n&&32===e.charCodeAt(t);)t++;return V0(e,t,n)}(i,u,u+n)};return{schema:r,__array:void 0,isDefined:!0,rowCount:s,value:l,valueKind:c=>0,toArray:c=>tc(s,l,c),areValuesEqual:(c,u)=>l(c)===l(u)}}(e,t,n,r)}}(r),f=ce.Undefined(e.numberOfAtoms,ce.Schema.float);return{count:e.numberOfAtoms,residueNumber:d(0,5,ce.Schema.int),residueName:d(5,5,ce.Schema.str),atomName:d(10,5,ce.Schema.str),atomNumber:d(15,5,ce.Schema.int),x:d(20,l,ce.Schema.float),y:d(20+l,l,ce.Schema.float),z:d(20+2*l,l,ce.Schema.float),vx:s?d(c,u,ce.Schema.float):f,vy:s?d(c+u,u,ce.Schema.float):f,vz:s?d(c+2*u,u,ce.Schema.float):f}}),g9.apply(this,arguments)}function mWe(e){const{tokenizer:t}=e,n=kt.readLine(t).trim().split(/\s+/g);e.header.box=[+n[0],+n[1],+n[2]]}function y9(){return y9=le(function*(e,t){const n=kt(e);yield t.update({message:"Parsing...",current:0,max:e.length});const r=[];for(;n.position<e.length;){const o=dWe(n,t);fWe(o),pWe(o);const s=yield hWe(o);mWe(o),r.push({header:o.header,atoms:s})}return qi.success({structures:r})}),y9.apply(this,arguments)}const Ed=C();function w_(e,t,n,r){for(let i=0,o=3*r;i<o;i+=3)C.fromArray(Ed,t,n+i),C.transformMat4(Ed,Ed,e),C.toArray(Ed,t,n+i)}const aN=C(),Uw=C(),lN=C(),qs=C(),cN=C();function Fue(e,t,n,r,i){for(let o=0,s=3*i;o<s;o+=3){const a=3*t[o],l=3*t[o+1],c=3*t[o+2];C.fromArray(aN,e,a),C.fromArray(Uw,e,l),C.fromArray(lN,e,c),C.sub(qs,lN,Uw),C.sub(cN,aN,Uw),C.cross(qs,qs,cN),n[a]+=qs[0],n[a+1]+=qs[1],n[a+2]+=qs[2],n[l]+=qs[0],n[l+1]+=qs[1],n[l+2]+=qs[2],n[c]+=qs[0],n[c+1]+=qs[1],n[c+2]+=qs[2]}return function Nue(e,t){for(let n=0,r=3*t;n<r;n+=3){const i=e[n],o=e[n+1],s=e[n+2],a=1/Math.sqrt(i*i+o*o+s*s);e[n]=i*a,e[n+1]=o*a,e[n+2]=s*a}return e}(n,r)}function zw(e,t,n=1){const r=Bh(e),i=new Int32Array(r+2),o=new Int32Array(t),s=new Int32Array(t);for(let c=0,u=t*n;c<u;c+=n)++s[e[c]];let a=0;for(let c=0;c<t;c++)i[c]=a,a+=s[c];i[t]=a;const l=new Int32Array(a);for(let c=0,u=t*n;c<u;c+=n){const d=e[c];l[i[d]+o[d]]=c,++o[d]}return{indices:l,offsets:i}}const b9=C.fromArray,uN=C.transformMat4Offset;function Sa(e,t,n,r){const{length:i,width:o,height:s}=function _We(e,t){e=Math.max(e,2);const n=Math.sqrt(e);let r=Math.ceil(n);r+=(t-r%t)%t;const i=r>0?Math.ceil(e/r):0;return{width:r,height:i,length:r*i*t}}(e,t);return{array:r=r&&r.length>=i?r:new n(i),width:o,height:s}}const Tp=C(),wWe=new xf("14"),AWe=new xf("98");function Lue(e){return e>1e5?wWe:AWe}function py(e,t,n){const r=3*n,i=Lue(t);i.reset();for(let s=0,a=3*t;s<a;s+=r)b9(Tp,e,s),i.includePosition(Tp);i.finishedIncludeStep();for(let s=0,a=3*t;s<a;s+=r)b9(Tp,e,s),i.radiusPosition(Tp);const o=i.getSphere();if(t<=14){const s=[];for(let a=0,l=3*t;a<l;a+=r)s.push(b9(C(),e,a));ke.setExtrema(o,s)}return o}const v9=fe();function pl(e,t,n,r){if(1===n){fe.fromArray(v9,t,r);const l=ke.clone(e);return fe.isIdentity(v9)?l:ke.transform(l,l,v9)}const i=Lue(n);i.reset();const{center:o,radius:s,extrema:a}=e;if(a&&n<=14){for(let l=0,c=n;l<c;++l)for(const u of a)uN(Tp,u,t,0,0,16*l+r),i.includePosition(Tp);i.finishedIncludeStep();for(let l=0,c=n;l<c;++l)for(const u of a)uN(Tp,u,t,0,0,16*l+r),i.radiusPosition(Tp)}else{for(let l=0,c=n;l<c;++l)uN(Tp,o,t,0,0,16*l+r),i.includePositionRadius(Tp,s);i.finishedIncludeStep();for(let l=0,c=n;l<c;++l)uN(Tp,o,t,0,0,16*l+r),i.radiusPositionRadius(Tp,s)}return i.getSphere()}const Oc=new Uint8Array(772);function jue(e,t){if(0===t)return 0;const n=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),r=t-4>>2,i=4*r;let o=0;if(r<0)for(let s=0;s<t;++s)o+=e[s]&&1;else{for(let s=0;s<r;++s){const a=n[s];o+=Oc[65535&a]+Oc[a>>16]}for(let s=i;s<t;++s)o+=e[s]&&1}return o/t}function hs(e,t,n){const r=Sa(Math.max(1,e),1,Uint8Array,n&&n.tMarker.ref.value.array),i=jue(r.array,e),o=0===i?0:-1;return n?(O.updateIfChanged(n.uMarker,0),O.update(n.tMarker,r),O.update(n.uMarkerTexDim,Ue.create(r.width,r.height)),O.updateIfChanged(n.markerAverage,i),O.updateIfChanged(n.markerStatus,o),O.updateIfChanged(n.dMarkerType,t),n):{uMarker:O.create(0),tMarker:O.create(r),uMarkerTexDim:O.create(Ue.create(r.width,r.height)),markerAverage:O.create(i),markerStatus:O.create(o),dMarkerType:O.create(t)}}Oc[1]=1,Oc[2]=1,Oc[3]=1,Oc[256]=1,Oc[512]=1,Oc[768]=1,Oc[257]=2,Oc[513]=2,Oc[769]=2,Oc[258]=2,Oc[514]=2,Oc[770]=2,Oc[259]=2,Oc[515]=2,Oc[771]=2,new Uint8Array(1);const Gu={kind:"null-location"};function zue(e,t,n){return{kind:"data-location",tag:e,data:t,element:n}}function Vi(e,t,n,r,i=!1,o=(()=>!1),s){if(e%n!=0)throw new Error("incompatible groupCount and stride");const a={location:Gu,location2:Gu,index:0,groupIndex:0,instanceIndex:0,isSecondary:!1};let l=a.groupIndex<e,c=!1,u=0,d=0,f=!1;const p=!!s;return{get hasNext(){return l},get isNextNewInstance(){return c},groupCount:e,instanceCount:t,count:e*t,stride:n,nonInstanceable:i,hasLocation2:p,move:()=>(l&&(a.groupIndex=u,a.instanceIndex=d,a.index=d*e+u,a.location=r(u,f?-1:d),p&&(a.location2=s(u,f?-1:d)),a.isSecondary=o(u,f?-1:d),u+=n,u===e?(++d,c=!0,d<t&&(u=0)):c=!1,l=u<e),a),reset(){a.location=Gu,a.location2=Gu,a.index=0,a.groupIndex=0,a.instanceIndex=0,a.isSecondary=!1,l=a.groupIndex<e,c=!1,u=0,d=0,f=!1},skipInstance(){l&&a.instanceIndex===d&&(++d,u=0,l=d<t)},voidInstances(){f=!0}}}function V1(e){return{kind:"position-location",position:e?C.clone(e):C()}}const Vue=Kc();function dN(e){const t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE){const n=function EWe(e,t){switch(t){case e.FRAMEBUFFER_COMPLETE:return"complete";case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"incomplete attachment";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"incomplete missing attachment";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"incomplete dimensions";case e.FRAMEBUFFER_UNSUPPORTED:return"unsupported"}if(Cn(e))switch(t){case e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"incomplete multisample";case e.RENDERBUFFER_SAMPLES:return"renderbuffer samples"}return"unknown error"}(e,t);throw new Error(`Framebuffer status: ${n}`)}}function Hue(e){const t=e.createFramebuffer();if(null===t)throw new Error("Could not create WebGL framebuffer");return t}function Gue(e){const t=function QYe(e){if(Cn(e))return{drawArraysInstanced:e.drawArraysInstanced.bind(e),drawElementsInstanced:e.drawElementsInstanced.bind(e),vertexAttribDivisor:e.vertexAttribDivisor.bind(e),VERTEX_ATTRIB_ARRAY_DIVISOR:e.VERTEX_ATTRIB_ARRAY_DIVISOR};{const t=e.getExtension("ANGLE_instanced_arrays");return null===t?null:{drawArraysInstanced:t.drawArraysInstancedANGLE.bind(t),drawElementsInstanced:t.drawElementsInstancedANGLE.bind(t),vertexAttribDivisor:t.vertexAttribDivisorANGLE.bind(t),VERTEX_ATTRIB_ARRAY_DIVISOR:t.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE}}}(e);if(null===t)throw new Error('Could not find support for "instanced_arrays"');const n=function eXe(e){return Cn(e)?{}:e.getExtension("OES_element_index_uint")}(e);if(null===n)throw new Error('Could not find support for "element_index_uint"');const r=function JYe(e){if(Cn(e))return{FRAGMENT_SHADER_DERIVATIVE_HINT:e.FRAGMENT_SHADER_DERIVATIVE_HINT};{const t=e.getExtension("OES_standard_derivatives");return null===t?null:{FRAGMENT_SHADER_DERIVATIVE_HINT:t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES}}}(e);if(null===r)throw new Error('Could not find support for "standard_derivatives"');const i=function nXe(e){return Cn(e)?{}:e.getExtension("OES_texture_float")}(e);$n&&null===i&&console.log('Could not find support for "texture_float"');const o=function rXe(e){return e.getExtension("OES_texture_float_linear")}(e);$n&&null===o&&console.log('Could not find support for "texture_float_linear"');const s=function iXe(e){if(Cn(e))return{HALF_FLOAT:e.HALF_FLOAT};{const t=e.getExtension("OES_texture_half_float");return null===t?null:{HALF_FLOAT:t.HALF_FLOAT_OES}}}(e);$n&&null===s&&console.log('Could not find support for "texture_half_float"');const a=function oXe(e){return e.getExtension("OES_texture_half_float_linear")}(e);$n&&null===a&&console.log('Could not find support for "texture_half_float_linear"');const l=function pXe(e){if(Cn(e))return{UNSIGNED_INT_24_8:e.UNSIGNED_INT_24_8};{const t=e.getExtension("WEBGL_depth_texture");return null===t?null:{UNSIGNED_INT_24_8:t.UNSIGNED_INT_24_8_WEBGL}}}(e);$n&&null===l&&console.log('Could not find support for "depth_texture"');const c=function sXe(e){if(Cn(e))return{MIN:e.MIN,MAX:e.MAX};{const t=e.getExtension("EXT_blend_minmax");return null===t?null:{MIN:t.MIN_EXT,MAX:t.MAX_EXT}}}(e);$n&&null===c&&console.log('Could not find support for "blend_minmax"');const u=function tXe(e){if(Cn(e))return{VERTEX_ARRAY_BINDING:e.VERTEX_ARRAY_BINDING,bindVertexArray:e.bindVertexArray.bind(e),createVertexArray:e.createVertexArray.bind(e),deleteVertexArray:e.deleteVertexArray.bind(e),isVertexArray:e.isVertexArray.bind(e)};{const t=e.getExtension("OES_vertex_array_object");return null===t?null:{VERTEX_ARRAY_BINDING:t.VERTEX_ARRAY_BINDING_OES,bindVertexArray:t.bindVertexArrayOES.bind(t),createVertexArray:t.createVertexArrayOES.bind(t),deleteVertexArray:t.deleteVertexArrayOES.bind(t),isVertexArray:t.isVertexArrayOES.bind(t)}}}(e);$n&&null===u&&console.log('Could not find support for "vertex_array_object"');const d=function aXe(e){return Cn(e)?{}:e.getExtension("EXT_frag_depth")}(e);$n&&null===d&&console.log('Could not find support for "frag_depth"');const f=function lXe(e){if(Cn(e))return null===e.getExtension("EXT_color_buffer_float")?null:(e.getExtension("EXT_float_blend"),{RGBA32F:e.RGBA32F});{const t=e.getExtension("WEBGL_color_buffer_float");return null===t?(e.getExtension("OES_texture_float"),pde(e,e.FLOAT)?{RGBA32F:34836}:null):(e.getExtension("EXT_float_blend"),{RGBA32F:t.RGBA32F_EXT})}}(e);$n&&null===f&&console.log('Could not find support for "color_buffer_float"');const p=function cXe(e){if(Cn(e))return null===e.getExtension("EXT_color_buffer_half_float")?null:(e.getExtension("EXT_float_blend"),{RGBA16F:e.RGBA16F});{const t=e.getExtension("EXT_color_buffer_half_float");return null===t?(e.getExtension("OES_texture_half_float"),pde(e,36193)?{RGBA16F:34842}:null):(e.getExtension("EXT_float_blend"),{RGBA16F:t.RGBA16F_EXT})}}(e);$n&&null===p&&console.log('Could not find support for "color_buffer_half_float"');const m=function uXe(e){if(Cn(e))return{drawBuffers:e.drawBuffers.bind(e),COLOR_ATTACHMENT0:e.COLOR_ATTACHMENT0,COLOR_ATTACHMENT1:e.COLOR_ATTACHMENT1,COLOR_ATTACHMENT2:e.COLOR_ATTACHMENT2,COLOR_ATTACHMENT3:e.COLOR_ATTACHMENT3,COLOR_ATTACHMENT4:e.COLOR_ATTACHMENT4,COLOR_ATTACHMENT5:e.COLOR_ATTACHMENT5,COLOR_ATTACHMENT6:e.COLOR_ATTACHMENT6,COLOR_ATTACHMENT7:e.COLOR_ATTACHMENT7,DRAW_BUFFER0:e.DRAW_BUFFER0,DRAW_BUFFER1:e.DRAW_BUFFER1,DRAW_BUFFER2:e.DRAW_BUFFER2,DRAW_BUFFER3:e.DRAW_BUFFER3,DRAW_BUFFER4:e.DRAW_BUFFER4,DRAW_BUFFER5:e.DRAW_BUFFER5,DRAW_BUFFER6:e.DRAW_BUFFER6,DRAW_BUFFER7:e.DRAW_BUFFER7,MAX_COLOR_ATTACHMENTS:e.MAX_COLOR_ATTACHMENTS,MAX_DRAW_BUFFERS:e.MAX_DRAW_BUFFERS};{const t=e.getExtension("WEBGL_draw_buffers");return null===t?null:{drawBuffers:t.drawBuffersWEBGL.bind(t),COLOR_ATTACHMENT0:t.COLOR_ATTACHMENT0_WEBGL,COLOR_ATTACHMENT1:t.COLOR_ATTACHMENT1_WEBGL,COLOR_ATTACHMENT2:t.COLOR_ATTACHMENT2_WEBGL,COLOR_ATTACHMENT3:t.COLOR_ATTACHMENT3_WEBGL,COLOR_ATTACHMENT4:t.COLOR_ATTACHMENT4_WEBGL,COLOR_ATTACHMENT5:t.COLOR_ATTACHMENT5_WEBGL,COLOR_ATTACHMENT6:t.COLOR_ATTACHMENT6_WEBGL,COLOR_ATTACHMENT7:t.COLOR_ATTACHMENT7_WEBGL,DRAW_BUFFER0:t.DRAW_BUFFER0_WEBGL,DRAW_BUFFER1:t.DRAW_BUFFER1_WEBGL,DRAW_BUFFER2:t.DRAW_BUFFER2_WEBGL,DRAW_BUFFER3:t.DRAW_BUFFER3_WEBGL,DRAW_BUFFER4:t.DRAW_BUFFER4_WEBGL,DRAW_BUFFER5:t.DRAW_BUFFER5_WEBGL,DRAW_BUFFER6:t.DRAW_BUFFER6_WEBGL,DRAW_BUFFER7:t.DRAW_BUFFER7_WEBGL,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS_WEBGL,MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS_WEBGL}}}(e);$n&&null===m&&console.log('Could not find support for "draw_buffers"');const h=function dXe(e){const t=e.getExtension("OES_draw_buffers_indexed");return null===t?null:{enablei:t.enableiOES.bind(t),disablei:t.disableiOES.bind(t),blendEquationi:t.blendEquationiOES.bind(t),blendEquationSeparatei:t.blendEquationSeparateiOES.bind(t),blendFunci:t.blendFunciOES.bind(t),blendFuncSeparatei:t.blendFuncSeparateiOES.bind(t),colorMaski:t.colorMaskiOES.bind(t)}}(e);$n&&null===h&&console.log('Could not find support for "draw_buffers_indexed"');const g=function fXe(e){return Cn(e)?{}:e.getExtension("EXT_shader_texture_lod")}(e);$n&&null===g&&console.log('Could not find support for "shader_texture_lod"');const y=function hXe(e){if(Cn(e))return{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING,SRGB8_ALPHA8:e.SRGB8_ALPHA8,SRGB8:e.SRGB8,SRGB:e.SRGB};{const t=e.getExtension("EXT_sRGB");return null===t?null:{FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT,SRGB8_ALPHA8:t.SRGB8_ALPHA8_EXT,SRGB8:t.SRGB_ALPHA_EXT,SRGB:t.SRGB_EXT}}}(e);$n&&null===y&&console.log('Could not find support for "sRGB"');const v=function mXe(e){if(Cn(e)){const t=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query");return null===t?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:e.CURRENT_QUERY,QUERY_RESULT:e.QUERY_RESULT,QUERY_RESULT_AVAILABLE:e.QUERY_RESULT_AVAILABLE,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:e.createQuery.bind(e),deleteQuery:e.deleteQuery.bind(e),isQuery:e.isQuery.bind(e),beginQuery:e.beginQuery.bind(e),endQuery:e.endQuery.bind(e),queryCounter:t.queryCounterEXT.bind(t),getQuery:e.getQuery.bind(e),getQueryParameter:e.getQueryParameter.bind(e)}}{const t=e.getExtension("EXT_disjoint_timer_query");return null===t?null:{QUERY_COUNTER_BITS:t.QUERY_COUNTER_BITS_EXT,CURRENT_QUERY:t.CURRENT_QUERY_EXT,QUERY_RESULT:t.QUERY_RESULT_EXT,QUERY_RESULT_AVAILABLE:t.QUERY_RESULT_AVAILABLE_EXT,TIME_ELAPSED:t.TIME_ELAPSED_EXT,TIMESTAMP:t.TIMESTAMP_EXT,GPU_DISJOINT:t.GPU_DISJOINT_EXT,createQuery:t.createQueryEXT.bind(t),deleteQuery:t.deleteQueryEXT.bind(t),isQuery:t.isQueryEXT.bind(t),beginQuery:t.beginQueryEXT.bind(t),endQuery:t.endQueryEXT.bind(t),queryCounter:t.queryCounterEXT.bind(t),getQuery:t.getQueryEXT.bind(t),getQueryParameter:t.getQueryObjectEXT.bind(t)}}}(e);$n&&null===v&&console.log('Could not find support for "disjoint_timer_query"');const x=function gXe(e){const t=e.getExtension("WEBGL_multi_draw");return t?{multiDrawArrays:t.multiDrawArraysWEBGL.bind(t),multiDrawElements:t.multiDrawElementsWEBGL.bind(t),multiDrawArraysInstanced:t.multiDrawArraysInstancedWEBGL.bind(t),multiDrawElementsInstanced:t.multiDrawElementsInstancedWEBGL.bind(t)}:null}(e);$n&&null===x&&console.log('Could not find support for "multi_draw"');const _=function yXe(e){const t=e.getExtension("WEBGL_draw_instanced_base_vertex_base_instance");return t?{drawArraysInstancedBaseInstance:t.drawArraysInstancedBaseInstanceWEBGL.bind(t),drawElementsInstancedBaseVertexBaseInstance:t.drawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}(e);$n&&null===_&&console.log('Could not find support for "draw_instanced_base_vertex_base_instance"');const w=function bXe(e){const t=e.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance");return t?{multiDrawArraysInstancedBaseInstance:t.multiDrawArraysInstancedBaseInstanceWEBGL.bind(t),multiDrawElementsInstancedBaseVertexBaseInstance:t.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL.bind(t)}:null}(e);$n&&null===w&&console.log('Could not find support for "multi_draw_instanced_base_vertex_base_instance"');const A=function vXe(e){const t=e.getExtension("KHR_parallel_shader_compile");return null===t?null:{COMPLETION_STATUS:t.COMPLETION_STATUS_KHR}}(e);$n&&null===A&&console.log('Could not find support for "parallel_shader_compile"');const M=function xXe(e){return Cn(e)?{}:e.getExtension("OES_fbo_render_mipmap")}(e);$n&&null===M&&console.log('Could not find support for "fbo_render_mipmap"');const E=function _Xe(e){if(Cn(e)){const t=e.getExtension("WEBGL_provoking_vertex");if(t)return{FIRST_VERTEX_CONVENTION:t.FIRST_VERTEX_CONVENTION_WEBGL,LAST_VERTEX_CONVENTION:t.LAST_VERTEX_CONVENTION_WEBGL,PROVOKING_VERTEX:t.PROVOKING_VERTEX_WEBGL,provokingVertex:t.provokingVertexWEBGL.bind(t)}}return null}(e);$n&&null===E&&console.log('Could not find support for "provoking_vertex"');const D=function SXe(e){if(Cn(e)){const t=e.getExtension("WEBGL_clip_cull_distance");if(t)return{MAX_CLIP_DISTANCES:t.MAX_CLIP_DISTANCES_WEBGL,MAX_CULL_DISTANCES:t.MAX_CULL_DISTANCES_WEBGL,MAX_COMBINED_CLIP_AND_CULL_DISTANCES:t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL,CLIP_DISTANCE0:t.CLIP_DISTANCE0_WEBGL,CLIP_DISTANCE1:t.CLIP_DISTANCE1_WEBGL,CLIP_DISTANCE2:t.CLIP_DISTANCE2_WEBGL,CLIP_DISTANCE3:t.CLIP_DISTANCE3_WEBGL,CLIP_DISTANCE4:t.CLIP_DISTANCE4_WEBGL,CLIP_DISTANCE5:t.CLIP_DISTANCE5_WEBGL,CLIP_DISTANCE6:t.CLIP_DISTANCE6_WEBGL,CLIP_DISTANCE7:t.CLIP_DISTANCE7_WEBGL}}return null}(e);$n&&null===D&&console.log('Could not find support for "clip_cull_distance"');const T=function CXe(e){return Cn(e)&&e.getExtension("EXT_conservative_depth")?{}:null}(e);$n&&null===T&&console.log('Could not find support for "conservative_depth"');const F=function wXe(e){if(Cn(e)){const t=e.getExtension("WEBGL_stencil_texturing");if(t)return{DEPTH_STENCIL_TEXTURE_MODE:t.DEPTH_STENCIL_TEXTURE_MODE_WEBGL,STENCIL_INDEX:t.STENCIL_INDEX_WEBGL}}return null}(e);$n&&null===F&&console.log('Could not find support for "stencil_texturing"');const R=function AXe(e){const t=e.getExtension("EXT_clip_control");return t?{LOWER_LEFT:t.LOWER_LEFT_EXT,UPPER_LEFT:t.UPPER_LEFT_EXT,NEGATIVE_ONE_TO_ONE:t.NEGATIVE_ONE_TO_ONE_EXT,ZERO_TO_ONE:t.ZERO_TO_ONE_EXT,CLIP_ORIGIN:t.CLIP_ORIGIN_EXT,CLIP_DEPTH_MODE:t.CLIP_DEPTH_MODE_EXT,clipControl:t.clipControlEXT.bind(t)}:null}(e);$n&&null===R&&console.log('Could not find support for "clip_control"');const N=function IXe(e){if(!Cn(e))return!1;if(typeof navigator<"u"){const t=window.navigator.userAgent.match(/Firefox\/([0-9]+)\./);return!t||parseInt(t[1])>=85}return!1}(e);return{instancedArrays:t,standardDerivatives:r,elementIndexUint:n,textureFloat:i,textureFloatLinear:o,textureHalfFloat:s,textureHalfFloatLinear:a,depthTexture:l,blendMinMax:c,vertexArrayObject:u,fragDepth:d,colorBufferFloat:f,colorBufferHalfFloat:p,drawBuffers:m,drawBuffersIndexed:h,shaderTextureLod:g,sRGB:y,disjointTimerQuery:v,multiDraw:x,drawInstancedBaseVertexBaseInstance:_,multiDrawInstancedBaseVertexBaseInstance:w,parallelShaderCompile:A,fboRenderMipmap:M,provokingVertex:E,clipCullDistance:D,conservativeDepth:T,stencilTexturing:F,clipControl:R,noNonInstancedActiveAttribs:N}}var A_;!function(e){e.create=function t(i,o,s){return{array:i,width:o,height:s}},e.flipY=function n(i){const{array:o,width:s,height:a}=i,c=s*(o.length/(s*a));for(let u=0,d=a/2;u<d;++u)for(let f=0,p=c;f<p;++f){const m=u*c+f,h=(a-u-1)*c+f,g=o[m];o[m]=o[h],o[h]=g}return i},e.divideByAlpha=function r(i){const{array:o}=i,s=o instanceof Uint8Array?255:1;for(let a=0,l=o.length;a<l;a+=4){const c=o[a+3]/s;o[a]/=c,o[a+1]/=c,o[a+2]/=c}return i}}(A_||(A_={}));const que=Kc(),I$e={apply_fog:"\nfloat preFogAlpha = gl_FragColor.a;\nif (uFog) {\n    float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n    float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n    float fogAlpha = (1.0 - fogFactor) * gl_FragColor.a;\n    if (!uTransparentBackground) {\n        if (gl_FragColor.a < 1.0) {\n            // transparent objects are blended with background color\n            gl_FragColor.a = fogAlpha;\n        } else {\n            // mix opaque objects with background color\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uFogColor, fogFactor);\n        }\n    } else {\n        #if defined(dRenderVariant_colorDpoit)\n            if (gl_FragColor.a < 1.0) {\n                // transparent objects are blended with background color\n                gl_FragColor.a = fogAlpha;\n            } else {\n                // opaque objects need to be pre-multiplied alpha\n                gl_FragColor.rgb *= fogAlpha;\n                gl_FragColor.a = fogAlpha;\n            }\n        #else\n            // pre-multiplied alpha expected for transparent background\n            gl_FragColor.rgb *= fogAlpha;\n            gl_FragColor.a = fogAlpha;\n        #endif\n    }\n}\n",apply_interior_color:"\nif (interior) {\n    if (uInteriorColorFlag) {\n        gl_FragColor.rgb = uInteriorColor;\n    } else {\n        gl_FragColor.rgb *= 1.0 - uInteriorDarkening;\n    }\n\n    #ifdef dTransparentBackfaces_opaque\n        gl_FragColor.a = 1.0;\n    #endif\n}\n",apply_light_color:"\n#ifdef dIgnoreLight\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            material.rgb += fbm(vModelPosition * uBumpFrequency) * uBumpAmplitude * bumpiness;\n            material.rgb -= 0.5 * uBumpAmplitude * bumpiness;\n        }\n    #endif\n\n    gl_FragColor = material;\n#else\n    #ifdef bumpEnabled\n        if (uBumpFrequency > 0.0 && uBumpAmplitude > 0.0 && bumpiness > 0.0) {\n            normal = perturbNormal(-vViewPosition, normal, fbm(vModelPosition * uBumpFrequency), (uBumpAmplitude * bumpiness) / uBumpFrequency);\n        }\n    #endif\n\n    vec4 color = material;\n\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n    PhysicalMaterial physicalMaterial;\n    physicalMaterial.diffuseColor = color.rgb * (1.0 - metalness);\n    #ifdef enabledFragDepth\n        physicalMaterial.roughness = min(max(roughness, 0.0525), 1.0);\n    #else\n        vec3 dxy = max(abs(dFdx(normal)), abs(dFdy(normal)));\n        float geometryRoughness = max(max(dxy.x, dxy.y), dxy.z);\n        physicalMaterial.roughness = min(max(roughness, 0.0525) + geometryRoughness, 1.0);\n    #endif\n    physicalMaterial.specularColor = mix(vec3(0.04), color.rgb, metalness);\n    physicalMaterial.specularF90 = 1.0;\n\n    GeometricContext geometry;\n    geometry.position = -vViewPosition;\n    geometry.normal = normal;\n    geometry.viewDir = normalize(vViewPosition);\n\n    IncidentLight directLight;\n    #pragma unroll_loop_start\n    for (int i = 0; i < dLightCount; ++i) {\n        directLight.direction = uLightDirection[i];\n        directLight.color = uLightColor[i] * PI; // * PI for punctual light\n        RE_Direct_Physical(directLight, geometry, physicalMaterial, reflectedLight);\n    }\n    #pragma unroll_loop_end\n\n    vec3 irradiance = uAmbientColor * PI; // * PI for punctual light\n    RE_IndirectDiffuse_Physical(irradiance, geometry, physicalMaterial, reflectedLight);\n\n    // indirect specular only metals\n    vec3 radiance = uAmbientColor * metalness;\n    vec3 iblIrradiance = uAmbientColor * metalness;\n    vec3 clearcoatRadiance = vec3(0.0);\n    RE_IndirectSpecular_Physical(radiance, iblIrradiance, clearcoatRadiance, geometry, physicalMaterial, reflectedLight);\n\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n    outgoingLight = clamp(outgoingLight, 0.01, 0.99); // prevents black artifacts on specular highlight with transparent background\n\n    gl_FragColor = vec4(outgoingLight, color.a);\n#endif\n\n#if defined(dXrayShaded_on)\n    gl_FragColor.a *= 1.0 - pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#elif defined(dXrayShaded_inverted)\n    gl_FragColor.a *= pow(abs(dot(normal, vec3(0.0, 0.0, 1.0))), uXrayEdgeFalloff);\n#endif\n\ngl_FragColor.rgb *= uExposure;\n",apply_marker_color:"\n\n#if defined(dColorMarker)\n    if (marker > 0.0) {\n        if ((uMarkerPriority == 1 && marker != 2.0) || (uMarkerPriority != 1 && marker == 1.0)) {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uHighlightColor, uHighlightStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uHighlightStrength * 0.002); // for direct-volume rendering\n        } else {\n            gl_FragColor.rgb = mix(gl_FragColor.rgb, uSelectColor, uSelectStrength);\n            gl_FragColor.a = max(gl_FragColor.a, uSelectStrength * 0.002); // for direct-volume rendering\n        }\n    } else if (uMarkerAverage > 0.0) {\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, uDimColor, uDimStrength);\n        gl_FragColor.a = max(gl_FragColor.a, uDimStrength * 0.002); // for direct-volume rendering\n    }\n#endif\n",assign_clipping_varying:"\n#if dClipObjectCount != 0 && defined(dClipping)\n    #if defined(dClippingType_instance)\n        vClipping = readFromTexture(tClipping, aInstance, uClippingTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vClipping = readFromTexture(tClipping, aInstance * float(uGroupCount) + group, uClippingTexDim).a;\n    #endif\n#endif\n",assign_color_varying:"\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_attribute)\n        vColor.rgb = aColor;\n    #elif defined(dColorType_instance)\n        vColor.rgb = readFromTexture(tColor, aInstance, uColorTexDim).rgb;\n    #elif defined(dColorType_group)\n        #if defined(dDualColor)\n            vec4 color2;\n            if (aColorMode == 2.0) {\n                vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n            } else {\n                vColor.rgb = readFromTexture(tColor, group * 2.0, uColorTexDim).rgb;\n                color2.rgb = readFromTexture(tColor, group * 2.0 + 1.0, uColorTexDim).rgb;\n            }\n        #else\n            vColor.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #endif\n    #elif defined(dColorType_groupInstance)\n        #if defined(dDualColor)\n            vec4 color2;\n            if (aColorMode == 2.0) {\n                vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n            } else {\n                vColor.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0, uColorTexDim).rgb;\n                color2.rgb = readFromTexture(tColor, (aInstance * float(uGroupCount) + group) * 2.0 + 1.0, uColorTexDim).rgb;\n            }\n        #else\n            vColor.rgb = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #endif\n    #elif defined(dColorType_vertex)\n        vColor.rgb = readFromTexture(tColor, VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_vertexInstance)\n        vColor.rgb = readFromTexture(tColor, int(aInstance) * uVertexCount + VertexID, uColorTexDim).rgb;\n    #elif defined(dColorType_volume)\n        vec3 cgridPos = (uColorGridTransform.w * (position - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #elif defined(dColorType_volumeInstance)\n        vec3 cgridPos = (uColorGridTransform.w * (vModelPosition - uColorGridTransform.xyz)) / uColorGridDim;\n        vColor.rgb = texture3dFrom2dLinear(tColorGrid, cgridPos, uColorGridDim, uColorTexDim).rgb;\n    #endif\n\n    #ifdef dUsePalette\n        vPaletteV = ((vColor.r * 256.0 * 256.0 * 255.0 + vColor.g * 256.0 * 255.0 + vColor.b * 255.0) - 1.0) / 16777215.0;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance, uOverpaintTexDim);\n        #elif defined(dOverpaintType_groupInstance)\n            vOverpaint = readFromTexture(tOverpaint, aInstance * float(uGroupCount) + group, uOverpaintTexDim);\n        #elif defined(dOverpaintType_vertexInstance)\n            vOverpaint = readFromTexture(tOverpaint, int(aInstance) * uVertexCount + VertexID, uOverpaintTexDim);\n        #elif defined(dOverpaintType_volumeInstance)\n            vec3 ogridPos = (uOverpaintGridTransform.w * (vModelPosition - uOverpaintGridTransform.xyz)) / uOverpaintGridDim;\n            vOverpaint = texture3dFrom2dLinear(tOverpaintGrid, ogridPos, uOverpaintGridDim, uOverpaintTexDim);\n        #endif\n\n        // pre-mix to avoid darkening due to empty overpaint\n        #ifdef dColorType_uniform\n            vOverpaint.rgb = mix(uColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #else\n            vOverpaint.rgb = mix(vColor.rgb, vOverpaint.rgb, vOverpaint.a);\n        #endif\n        vOverpaint *= uOverpaintStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance)\n            vSubstance = readFromTexture(tSubstance, aInstance, uSubstanceTexDim);\n        #elif defined(dSubstanceType_groupInstance)\n            vSubstance = readFromTexture(tSubstance, aInstance * float(uGroupCount) + group, uSubstanceTexDim);\n        #elif defined(dSubstanceType_vertexInstance)\n            vSubstance = readFromTexture(tSubstance, int(aInstance) * uVertexCount + VertexID, uSubstanceTexDim);\n        #elif defined(dSubstanceType_volumeInstance)\n            vec3 sgridPos = (uSubstanceGridTransform.w * (vModelPosition - uSubstanceGridTransform.xyz)) / uSubstanceGridDim;\n            vSubstance = texture3dFrom2dLinear(tSubstanceGrid, sgridPos, uSubstanceGridDim, uSubstanceTexDim);\n        #endif\n\n        // pre-mix to avoid artifacts due to empty substance\n        vSubstance.rgb = mix(vec3(uMetalness, uRoughness, uBumpiness), vSubstance.rgb, vSubstance.a);\n        vSubstance *= uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #ifdef requiredDrawBuffers\n        vObject = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        vInstance = vec4(packIntToRGB(aInstance), 1.0);\n        vGroup = vec4(packIntToRGB(group), 1.0);\n    #else\n        if (uPickType == 1) {\n            vColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n        } else if (uPickType == 2) {\n            vColor = vec4(packIntToRGB(aInstance), 1.0);\n        } else {\n            vColor = vec4(packIntToRGB(group), 1.0);\n        }\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance)\n        vTransparency = readFromTexture(tTransparency, aInstance, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_groupInstance)\n        vTransparency = readFromTexture(tTransparency, aInstance * float(uGroupCount) + group, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_vertexInstance)\n        vTransparency = readFromTexture(tTransparency, int(aInstance) * uVertexCount + VertexID, uTransparencyTexDim).a;\n    #elif defined(dTransparencyType_volumeInstance)\n        vec3 tgridPos = (uTransparencyGridTransform.w * (vModelPosition - uTransparencyGridTransform.xyz)) / uTransparencyGridDim;\n        vTransparency = texture3dFrom2dLinear(tTransparencyGrid, tgridPos, uTransparencyGridDim, uTransparencyTexDim).a;\n    #endif\n    vTransparency *= uTransparencyStrength;\n#endif\n",assign_group:"\n#ifdef dGeometryType_textureMesh\n    float group = unpackRGBToInt(readFromTexture(tGroup, VertexID, uGeoTexDim).rgb);\n#else\n    float group = aGroup;\n#endif\n",assign_marker_varying:"\n#if defined(dNeedsMarker)\n    #if defined(dMarkerType_instance)\n        vMarker = readFromTexture(tMarker, aInstance, uMarkerTexDim).a;\n    #elif defined(dMarkerType_groupInstance)\n        vMarker = readFromTexture(tMarker, aInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n    #endif\n#endif\n",assign_material_color:"\n#if defined(dNeedsMarker)\n    float marker = uMarker;\n    if (uMarker == -1.0) {\n        marker = floor(vMarker * 255.0 + 0.5); // rounding required to work on some cards on win\n    }\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dUsePalette)\n        vec4 material = vec4(texture2D(tPalette, vec2(vPaletteV, 0.5)).rgb, uAlpha);\n    #elif defined(dColorType_uniform)\n        vec4 material = vec4(uColor, uAlpha);\n    #elif defined(dColorType_varying)\n        vec4 material = vec4(vColor.rgb, uAlpha);\n    #endif\n\n    // mix material with overpaint\n    #if defined(dOverpaint)\n        material.rgb = mix(material.rgb, vOverpaint.rgb, vOverpaint.a);\n    #endif\n\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n    float bumpiness = uBumpiness;\n    #ifdef dSubstance\n        metalness = mix(metalness, vSubstance.r, vSubstance.a);\n        roughness = mix(roughness, vSubstance.g, vSubstance.a);\n        bumpiness = mix(bumpiness, vSubstance.b, vSubstance.a);\n    #endif\n#elif defined(dRenderVariant_depth)\n    if (fragmentDepth > getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n        discard;\n    }\n\n    #ifndef dXrayShaded\n        #if defined(dTransparency)\n            float dta = 1.0 - vTransparency;\n            if (vTransparency < 0.2) dta = 1.0; // hard cutoff looks better\n\n            if (uRenderMask == MaskTransparent && uAlpha * dta == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha * dta < 1.0) {\n                discard;\n            }\n        #else\n            if (uRenderMask == MaskTransparent && uAlpha == 1.0) {\n                discard;\n            } else if (uRenderMask == MaskOpaque && uAlpha < 1.0) {\n                discard;\n            }\n        #endif\n    #else\n        if (uRenderMask == MaskOpaque) {\n            discard;\n        }\n    #endif\n\n    vec4 material = packDepthToRGBA(fragmentDepth);\n#elif defined(dRenderVariant_marking)\n    vec4 material;\n    if(uMarkingType == 1) {\n        if (marker > 0.0)\n            discard;\n        #ifdef enabledFragDepth\n            material = packDepthToRGBA(gl_FragDepthEXT);\n        #else\n            material = packDepthToRGBA(gl_FragCoord.z);\n        #endif\n    } else {\n        if (marker == 0.0)\n            discard;\n        float depthTest = 1.0;\n        if (uMarkingDepthTest) {\n            depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n        }\n        bool isHighlight = intMod(marker, 2.0) > 0.1;\n        float viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\n        float fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\n        if (fogFactor == 1.0)\n            discard;\n        material = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0 - fogFactor);\n    }\n#endif\n\n// apply per-group transparency\n#if defined(dTransparency) && (defined(dRenderVariant_pick) || defined(dRenderVariant_color))\n    float ta = 1.0 - vTransparency;\n    if (vTransparency < 0.09) ta = 1.0; // hard cutoff looks better\n\n    #if defined(dRenderVariant_pick)\n        if (ta < uPickingAlphaThreshold)\n            discard; // ignore so the element below can be picked\n    #elif defined(dRenderVariant_color)\n        material.a *= ta;\n\n        #if defined(dRenderVariant_colorBlended)\n            #if defined(dTransparentBackfaces_off)\n                if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0) ||\n                    (interior && material.a < 1.0)\n                ) {\n                    discard;\n                }\n            #elif defined(dTransparentBackfaces_on)\n                if ((uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0)\n                ) {\n                    discard;\n                }\n            #elif defined(dTransparentBackfaces_opaque)\n                if (interior) {\n                    material.a = 1.0;\n                } else if (\n                    (uRenderMask == MaskOpaque && material.a < 1.0) ||\n                    (uRenderMask == MaskTransparent && material.a == 1.0)\n                ) {\n                    discard;\n                }\n            #endif\n        #endif\n    #endif\n#endif\n",assign_position:"\nmat4 model = uModel * aTransform;\nmat4 modelView = uView * model;\n#ifdef dGeometryType_textureMesh\n    vec3 position = readFromTexture(tPosition, VertexID, uGeoTexDim).xyz;\n#else\n    vec3 position = aPosition;\n#endif\nvec4 position4 = vec4(position, 1.0);\n// for accessing tColorGrid in vert shader and for clipping in frag shader\nvModelPosition = (model * position4).xyz;\nvec4 mvPosition = modelView * position4;\nvViewPosition = mvPosition.xyz;\ngl_Position = uProjection * mvPosition;\n",assign_size:"\n#if defined(dSizeType_uniform)\n    float size = uSize;\n#elif defined(dSizeType_attribute)\n    float size = aSize;\n#elif defined(dSizeType_instance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance, uSizeTexDim).rgb);\n#elif defined(dSizeType_group)\n    float size = unpackRGBToInt(readFromTexture(tSize, group, uSizeTexDim).rgb);\n#elif defined(dSizeType_groupInstance)\n    float size = unpackRGBToInt(readFromTexture(tSize, aInstance * float(uGroupCount) + group, uSizeTexDim).rgb);\n#endif\n\n#if defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    size /= 100.0; // NOTE factor also set in TypeScript\n#endif\n\nsize *= uSizeFactor;\n",check_picking_alpha:"\nfloat viewZ = depthToViewZ(uIsOrtho, fragmentDepth, uNear, uFar);\nfloat fogFactor = smoothstep(uFogNear, uFogFar, abs(viewZ));\nfloat alpha = (1.0 - fogFactor) * uAlpha;\n// if not opaque enough ignore so the element below can be picked\nif (uAlpha < uPickingAlphaThreshold || alpha < 0.1) {\n    #ifdef dTransparentBackfaces_opaque\n        if (!interior) discard;\n    #else\n        discard;\n    #endif\n}\n",clip_instance:"\n#if defined(dClipVariant_instance) && dClipObjectCount != 0\n    vec4 mCenter = uModel * aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0);\n    if (clipTest(vec4(mCenter.xyz, uInvariantBoundingSphere.w)))\n        // move out of [ -w, +w ] to 'discard' in vert shader\n        gl_Position.z = 2.0 * gl_Position.w;\n#endif\n",clip_pixel:"\n#if defined(dClipVariant_pixel) && dClipObjectCount != 0\n    if (clipTest(vec4(vModelPosition, 0.0)))\n        discard;\n#endif\n",color_frag_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n#ifdef bumpEnabled\n    uniform float uBumpFrequency;\n    uniform float uBumpAmplitude;\n#endif\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_varying)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        uniform sampler2D tPalette;\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        varying vec4 vOverpaint;\n    #endif\n\n    #ifdef dSubstance\n        varying vec4 vSubstance;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat in vec4 vObject;\n            flat in vec4 vInstance;\n            flat in vec4 vGroup;\n        #else\n            flat in vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    varying float vTransparency;\n#endif\n",color_vert_params:"\nuniform float uMetalness;\nuniform float uRoughness;\nuniform float uBumpiness;\n\n#if defined(dRenderVariant_color)\n    #if defined(dColorType_uniform)\n        uniform vec3 uColor;\n    #elif defined(dColorType_attribute)\n        varying vec4 vColor;\n        attribute vec3 aColor;\n    #elif defined(dColorType_texture)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform sampler2D tColor;\n    #elif defined(dColorType_grid)\n        varying vec4 vColor;\n        uniform vec2 uColorTexDim;\n        uniform vec3 uColorGridDim;\n        uniform vec4 uColorGridTransform;\n        uniform sampler2D tColorGrid;\n    #elif defined(dColorType_direct)\n        varying vec4 vColor;\n    #endif\n\n    #ifdef dUsePalette\n        varying float vPaletteV;\n    #endif\n\n    #ifdef dOverpaint\n        #if defined(dOverpaintType_instance) || defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform sampler2D tOverpaint;\n        #elif defined(dOverpaintType_volumeInstance)\n            varying vec4 vOverpaint;\n            uniform vec2 uOverpaintTexDim;\n            uniform vec3 uOverpaintGridDim;\n            uniform vec4 uOverpaintGridTransform;\n            uniform sampler2D tOverpaintGrid;\n        #endif\n        uniform float uOverpaintStrength;\n    #endif\n\n    #ifdef dSubstance\n        #if defined(dSubstanceType_instance) || defined(dSubstanceType_groupInstance) || defined(dSubstanceType_vertexInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform sampler2D tSubstance;\n        #elif defined(dSubstanceType_volumeInstance)\n            varying vec4 vSubstance;\n            uniform vec2 uSubstanceTexDim;\n            uniform vec3 uSubstanceGridDim;\n            uniform vec4 uSubstanceGridTransform;\n            uniform sampler2D tSubstanceGrid;\n        #endif\n        uniform float uSubstanceStrength;\n    #endif\n#elif defined(dRenderVariant_pick)\n    #if __VERSION__ == 100 || !defined(dVaryingGroup)\n        #ifdef requiredDrawBuffers\n            varying vec4 vObject;\n            varying vec4 vInstance;\n            varying vec4 vGroup;\n        #else\n            varying vec4 vColor;\n        #endif\n    #else\n        #ifdef requiredDrawBuffers\n            flat out vec4 vObject;\n            flat out vec4 vInstance;\n            flat out vec4 vGroup;\n        #else\n            flat out vec4 vColor;\n        #endif\n    #endif\n#endif\n\n#ifdef dTransparency\n    #if defined(dTransparencyType_instance) || defined(dTransparencyType_groupInstance) || defined(dTransparencyType_vertexInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform sampler2D tTransparency;\n    #elif defined(dTransparencyType_volumeInstance)\n        varying float vTransparency;\n        uniform vec2 uTransparencyTexDim;\n        uniform vec3 uTransparencyGridDim;\n        uniform vec4 uTransparencyGridTransform;\n        uniform sampler2D tTransparencyGrid;\n    #endif\n    uniform float uTransparencyStrength;\n#endif\n",common_clip:"\n#if dClipObjectCount != 0\n    vec3 quaternionTransform(const in vec4 q, const in vec3 v) {\n        vec3 t = 2.0 * cross(q.xyz, v);\n        return v + q.w * t + cross(q.xyz, t);\n    }\n\n    vec4 computePlane(const in vec3 normal, const in vec3 inPoint) {\n        return vec4(normalize(normal), -dot(normal, inPoint));\n    }\n\n    float planeSD(const in vec4 plane, const in vec3 center) {\n        return -dot(plane.xyz, center - plane.xyz * -plane.w);\n    }\n\n    float sphereSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        return (\n            length(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position) / size) - 1.0\n        ) * min(min(size.x, size.y), size.z);\n    }\n\n    float cubeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 d = abs(quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position)) - size;\n        return min(max(d.x, max(d.y, d.z)), 0.0) + length(max(d, 0.0));\n    }\n\n    float cylinderSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        vec2 d = abs(vec2(length(t.xz), t.y)) - size.xy;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n    }\n\n    float infiniteConeSD(const in vec3 position, const in vec4 rotation, const in vec3 size, const in vec3 center) {\n        vec3 t = quaternionTransform(vec4(-rotation.x, -rotation.y, -rotation.z, rotation.w), center - position);\n\n        float q = length(t.xy);\n        return dot(size.xy, vec2(q, t.z));\n    }\n\n    float getSignedDistance(const in vec3 center, const in int type, const in vec3 position, const in vec4 rotation, const in vec3 scale) {\n        if (type == 1) {\n            vec3 normal = quaternionTransform(rotation, vec3(0.0, 1.0, 0.0));\n            vec4 plane = computePlane(normal, position);\n            return planeSD(plane, center);\n        } else if (type == 2) {\n            return sphereSD(position, rotation, scale * 0.5, center);\n        } else if (type == 3) {\n            return cubeSD(position, rotation, scale * 0.5, center);\n        } else if (type == 4) {\n            return cylinderSD(position, rotation, scale * 0.5, center);\n        } else if (type == 5) {\n            return infiniteConeSD(position, rotation, scale * 0.5, center);\n        } else {\n            return 0.1;\n        }\n    }\n\n    #if __VERSION__ == 100\n        // 8-bit\n        int bitwiseAnd(in int a, in int b) {\n            int d = 128;\n            int result = 0;\n            for (int i = 0; i < 8; ++i) {\n                if (d <= 0) break;\n                if (a >= d && b >= d) result += d;\n                if (a >= d) a -= d;\n                if (b >= d) b -= d;\n                d /= 2;\n            }\n            return result;\n        }\n\n        bool hasBit(const in int mask, const in int bit) {\n            return bitwiseAnd(mask, bit) == 0;\n        }\n    #else\n        bool hasBit(const in int mask, const in int bit) {\n            return (mask & bit) == 0;\n        }\n    #endif\n\n    bool clipTest(const in vec4 sphere) {\n        // flag is a bit-flag for clip-objects to ignore (note, object ids start at 1 not 0)\n        #if defined(dClipping)\n            int flag = int(floor(vClipping * 255.0 + 0.5));\n        #else\n            int flag = 0;\n        #endif\n\n        #pragma unroll_loop_start\n        for (int i = 0; i < dClipObjectCount; ++i) {\n            if (flag == 0 || hasBit(flag, UNROLLED_LOOP_INDEX + 1)) {\n                // TODO take sphere radius into account?\n                bool test = getSignedDistance(sphere.xyz, uClipObjectType[i], uClipObjectPosition[i], uClipObjectRotation[i], uClipObjectScale[i]) <= 0.0;\n                if ((!uClipObjectInvert[i] && test) || (uClipObjectInvert[i] && !test)) {\n                    return true;\n                }\n            }\n        }\n        #pragma unroll_loop_end\n        return false;\n    }\n#endif\n",common_frag_params:'\nuniform int uObjectId;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\nuniform int uPickType;\nuniform int uMarkingType;\n\nuniform vec4 uCameraPlane;\nuniform vec4 uLod;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat in float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat in float vMarker;\n    #endif\n#endif\n\n#if defined(dRenderVariant_colorDpoit)\n    #define MAX_DPOIT_DEPTH 99999.0 // NOTE constant also set in TypeScript\n    uniform sampler2D tDpoitDepth;\n    uniform sampler2D tDpoitFrontColor;\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\nuniform vec2 uViewOffset;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform float uPickingAlphaThreshold;\nuniform bool uTransparentBackground;\n\nuniform bool uDoubleSided;\nuniform float uInteriorDarkening;\nuniform bool uInteriorColorFlag;\nuniform vec3 uInteriorColor;\nbool interior;\n\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform mat4 uProjection;\n\nuniform int uRenderMask;\nuniform bool uMarkingDepthTest;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nfloat getDepthPacked(const in vec2 coords) {\n    return unpackRGBAToDepth(texture2D(tDepth, coords));\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\n// "Bump Mapping Unparametrized Surfaces on the GPU" Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\nvec3 perturbNormal(in vec3 position, in vec3 normal, in float height, in float scale) {\n    vec3 sigmaS = dFdx(position);\n    vec3 sigmaT = dFdy(position);\n\n    vec3 r1 = cross(sigmaT, normal);\n    vec3 r2 = cross(normal, sigmaS);\n    float det = dot(sigmaS, r1);\n\n    float bs = dFdx(height);\n    float bt = dFdy(height);\n\n    vec3 surfGrad = sign(det) * (bs * r1 + bt * r2);\n    return normalize(abs(det) * normal - scale * surfGrad);\n}\n\nfloat hash(in float h) {\n    return fract(sin(h) * 43758.5453123);\n}\n\nfloat noise(in vec3 x) {\n    vec3 p = floor(x);\n    vec3 f = fract(x);\n    f = f * f * (3.0 - 2.0 * f);\n\n    float n = p.x + p.y * 157.0 + 113.0 * p.z;\n    return mix(\n        mix(mix(hash(n + 0.0), hash(n + 1.0), f.x),\n            mix(hash(n + 157.0), hash(n + 158.0), f.x), f.y),\n        mix(mix(hash(n + 113.0), hash(n + 114.0), f.x),\n            mix(hash(n + 270.0), hash(n + 271.0), f.x), f.y), f.z);\n}\n\nfloat fbm(in vec3 p) {\n    float f = 0.0;\n    f += 0.5 * noise(p);\n    p *= 2.01;\n    f += 0.25 * noise(p);\n    p *= 2.02;\n    f += 0.125 * noise(p);\n\n    return f;\n}\n',common_vert_params:"\nuniform mat4 uProjection, uModel, uView;\nuniform vec3 uCameraPosition;\nuniform vec4 uCameraPlane;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\nuniform vec4 uInvariantBoundingSphere;\nuniform vec4 uLod;\n\nuniform bool uDoubleSided;\nuniform int uPickType;\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n\n    #if defined(dClipping)\n        uniform vec2 uClippingTexDim;\n        uniform sampler2D tClipping;\n        #if __VERSION__ == 100 || defined(dClippingType_instance) || !defined(dVaryingGroup)\n            varying float vClipping;\n        #else\n            flat out float vClipping;\n        #endif\n    #endif\n#endif\n\n#if defined(dNeedsMarker)\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n    #if __VERSION__ == 100 || defined(dMarkerType_instance) || !defined(dVaryingGroup)\n        varying float vMarker;\n    #else\n        flat out float vMarker;\n    #endif\n#endif\n\nvarying vec3 vModelPosition;\nvarying vec3 vViewPosition;\n\n#if defined(noNonInstancedActiveAttribs)\n    // int() is needed for some Safari versions\n    // see https://bugs.webkit.org/show_bug.cgi?id=244152\n    #define VertexID int(gl_VertexID)\n#else\n    attribute float aVertex;\n    #define VertexID int(aVertex)\n#endif\n\n#if defined(enabledMultiDraw)\n    #define DrawID gl_DrawID\n#else\n    #define DrawID uDrawId\n#endif\n",common:"\n// TODO find a better place for these convenience defines\n\n#if defined(dRenderVariant_colorBlended) || defined(dRenderVariant_colorWboit) || defined(dRenderVariant_colorDpoit)\n    #define dRenderVariant_color\n#endif\n\n#if defined(dColorType_instance) || defined(dColorType_group) || defined(dColorType_groupInstance) || defined(dColorType_vertex) || defined(dColorType_vertexInstance)\n    #define dColorType_texture\n#endif\n\n#if defined(dColorType_volume) || defined(dColorType_volumeInstance)\n    #define dColorType_grid\n#endif\n\n#if defined(dColorType_attribute) || defined(dColorType_texture) || defined(dColorType_grid)\n    #define dColorType_varying\n#endif\n\n#if (defined(dRenderVariant_color) && defined(dColorMarker)) || defined(dRenderVariant_marking)\n    #define dNeedsMarker\n#endif\n\n#if defined(dXrayShaded_on) || defined(dXrayShaded_inverted)\n    #define dXrayShaded\n#endif\n\n#define MaskAll 0\n#define MaskOpaque 1\n#define MaskTransparent 2\n\n//\n\n#define PI 3.14159265\n#define RECIPROCAL_PI 0.31830988618\n#define EPSILON 1e-6\n\n#define saturate(a) clamp(a, 0.0, 1.0)\n\n#if __VERSION__ == 100\n    #define round(x) floor((x) + 0.5)\n#endif\n\nfloat intDiv(const in float a, const in float b) { return float(int(a) / int(b)); }\nvec2 ivec2Div(const in vec2 a, const in vec2 b) { return vec2(ivec2(a) / ivec2(b)); }\nfloat intMod(const in float a, const in float b) { return a - b * float(int(a) / int(b)); }\nint imod(const in int a, const in int b) { return a - b * (a / b); }\n\nfloat pow2(const in float x) { return x * x; }\n\nvec3 packIntToRGB(in float value) {\n    value = clamp(round(value), 0.0, 16777216.0 - 1.0) + 1.0;\n    vec3 c = vec3(0.0);\n    c.b = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.g = mod(value, 256.0);\n    value = floor(value / 256.0);\n    c.r = mod(value, 256.0);\n    return c / 255.0;\n}\nfloat unpackRGBToInt(const in vec3 rgb) {\n    return (floor(rgb.r * 255.0 + 0.5) * 256.0 * 256.0 + floor(rgb.g * 255.0 + 0.5) * 256.0 + floor(rgb.b * 255.0 + 0.5)) - 1.0;\n}\n\nvec2 packUnitIntervalToRG(const in float v) {\n    vec2 enc;\n    enc.xy = vec2(fract(v * 256.0), v);\n    enc.y -= enc.x * (1.0 / 256.0);\n    enc.xy *=  256.0 / 255.0;\n\n    return enc;\n}\n\nfloat unpackRGToUnitInterval(const in vec2 enc) {\n    return dot(enc, vec2(255.0 / (256.0 * 256.0), 255.0 / 256.0));\n}\n\nvec3 screenSpaceToViewSpace(const in vec3 ssPos, const in mat4 invProjection) {\n    vec4 p = vec4(ssPos * 2.0 - 1.0, 1.0);\n    p = invProjection * p;\n    return p.xyz / p.w;\n}\n\nconst float PackUpscale = 256.0 / 255.0; // fraction -> 0..1 (including 1)\nconst float UnpackDownscale = 255.0 / 256.0; // 0..1 -> fraction (excluding 1)\nconst vec3 PackFactors = vec3(256.0 * 256.0 * 256.0, 256.0 * 256.0,  256.0);\nconst vec4 UnpackFactors = UnpackDownscale / vec4(PackFactors, 1.0);\nconst float ShiftRight8 = 1.0 / 256.0;\n\nvec4 packDepthToRGBA(const in float v) {\n    vec4 r = vec4(fract(v * PackFactors), v);\n    r.yzw -= r.xyz * ShiftRight8; // tidy overflow\n    return r * PackUpscale;\n}\nfloat unpackRGBAToDepth(const in vec4 v) {\n    return dot(v, UnpackFactors);\n}\n\nvec4 sRGBToLinear(const in vec4 c) {\n    return vec4(mix(pow(c.rgb * 0.9478672986 + vec3(0.0521327014), vec3(2.4)), c.rgb * 0.0773993808, vec3(lessThanEqual(c.rgb, vec3(0.04045)))), c.a);\n}\nvec4 linearTosRGB(const in vec4 c) {\n    return vec4(mix(pow(c.rgb, vec3(0.41666)) * 1.055 - vec3(0.055), c.rgb * 12.92, vec3(lessThanEqual(c.rgb, vec3(0.0031308)))), c.a);\n}\n\nfloat linearizeDepth(const in float depth, const in float near, const in float far) {\n    return (2.0 * near) / (far + near - depth * (far - near));\n}\n\nfloat perspectiveDepthToViewZ(const in float invClipZ, const in float near, const in float far) {\n    return (near * far) / ((far - near) * invClipZ - far);\n}\n\nfloat orthographicDepthToViewZ(const in float linearClipZ, const in float near, const in float far) {\n    return linearClipZ * (near - far) - near;\n}\n\nfloat depthToViewZ(const in float isOrtho, const in float linearClipZ, const in float near, const in float far) {\n    return isOrtho == 1.0 ? orthographicDepthToViewZ(linearClipZ, near, far) : perspectiveDepthToViewZ(linearClipZ, near, far);\n}\n\n#if __VERSION__ == 100\n    // transpose\n\n    float transpose(const in float m) {\n        return m;\n    }\n\n    mat2 transpose2(const in mat2 m) {\n        return mat2(\n            m[0][0], m[1][0],\n            m[0][1], m[1][1]\n        );\n    }\n\n    mat3 transpose3(const in mat3 m) {\n        return mat3(\n            m[0][0], m[1][0], m[2][0],\n            m[0][1], m[1][1], m[2][1],\n            m[0][2], m[1][2], m[2][2]\n        );\n    }\n\n    mat4 transpose4(const in mat4 m) {\n        return mat4(\n            m[0][0], m[1][0], m[2][0], m[3][0],\n            m[0][1], m[1][1], m[2][1], m[3][1],\n            m[0][2], m[1][2], m[2][2], m[3][2],\n            m[0][3], m[1][3], m[2][3], m[3][3]\n        );\n    }\n\n    // inverse\n\n    float inverse(const in float m) {\n        return 1.0 / m;\n    }\n\n    mat2 inverse2(const in mat2 m) {\n        return mat2(m[1][1],-m[0][1],\n                -m[1][0], m[0][0]) / (m[0][0]*m[1][1] - m[0][1]*m[1][0]);\n    }\n\n    mat3 inverse3(const in mat3 m) {\n        float a00 = m[0][0], a01 = m[0][1], a02 = m[0][2];\n        float a10 = m[1][0], a11 = m[1][1], a12 = m[1][2];\n        float a20 = m[2][0], a21 = m[2][1], a22 = m[2][2];\n\n        float b01 = a22 * a11 - a12 * a21;\n        float b11 = -a22 * a10 + a12 * a20;\n        float b21 = a21 * a10 - a11 * a20;\n\n        float det = a00 * b01 + a01 * b11 + a02 * b21;\n\n        return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),\n                    b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),\n                    b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;\n    }\n\n    mat4 inverse4(const in mat4 m) {\n        float\n            a00 = m[0][0], a01 = m[0][1], a02 = m[0][2], a03 = m[0][3],\n            a10 = m[1][0], a11 = m[1][1], a12 = m[1][2], a13 = m[1][3],\n            a20 = m[2][0], a21 = m[2][1], a22 = m[2][2], a23 = m[2][3],\n            a30 = m[3][0], a31 = m[3][1], a32 = m[3][2], a33 = m[3][3],\n\n            b00 = a00 * a11 - a01 * a10,\n            b01 = a00 * a12 - a02 * a10,\n            b02 = a00 * a13 - a03 * a10,\n            b03 = a01 * a12 - a02 * a11,\n            b04 = a01 * a13 - a03 * a11,\n            b05 = a02 * a13 - a03 * a12,\n            b06 = a20 * a31 - a21 * a30,\n            b07 = a20 * a32 - a22 * a30,\n            b08 = a20 * a33 - a23 * a30,\n            b09 = a21 * a32 - a22 * a31,\n            b10 = a21 * a33 - a23 * a31,\n            b11 = a22 * a33 - a23 * a32,\n\n            det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n        return mat4(\n            a11 * b11 - a12 * b10 + a13 * b09,\n            a02 * b10 - a01 * b11 - a03 * b09,\n            a31 * b05 - a32 * b04 + a33 * b03,\n            a22 * b04 - a21 * b05 - a23 * b03,\n            a12 * b08 - a10 * b11 - a13 * b07,\n            a00 * b11 - a02 * b08 + a03 * b07,\n            a32 * b02 - a30 * b05 - a33 * b01,\n            a20 * b05 - a22 * b02 + a23 * b01,\n            a10 * b10 - a11 * b08 + a13 * b06,\n            a01 * b08 - a00 * b10 - a03 * b06,\n            a30 * b04 - a31 * b02 + a33 * b00,\n            a21 * b02 - a20 * b04 - a23 * b00,\n            a11 * b07 - a10 * b09 - a12 * b06,\n            a00 * b09 - a01 * b07 + a02 * b06,\n            a31 * b01 - a30 * b03 - a32 * b00,\n            a20 * b03 - a21 * b01 + a22 * b00) / det;\n    }\n\n    #define isNaN(x) ((x) != (x))\n    #define isInf(x) ((x) == (x) + 1.0)\n#else\n    #define transpose2(m) transpose(m)\n    #define transpose3(m) transpose(m)\n    #define transpose4(m) transpose(m)\n\n    #define inverse2(m) inverse(m)\n    #define inverse3(m) inverse(m)\n    #define inverse4(m) inverse(m)\n\n    #define isNaN isnan\n    #define isInf isinf\n#endif\n",fade_lod:"\nif (uLod.w == 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n    float d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;\n    float ta = min(\n        smoothstep(uLod.x, uLod.x + uLod.z, d),\n        1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)\n    );\n\n    #if defined(dRenderVariant_color)\n        float at = 0.0;\n\n        // shift by view-offset during multi-sample rendering to allow for blending\n        vec2 coord = gl_FragCoord.xy + uViewOffset * 0.25;\n\n        const mat4 thresholdMatrix = mat4(\n            1.0 / 17.0,  9.0 / 17.0,  3.0 / 17.0, 11.0 / 17.0,\n            13.0 / 17.0,  5.0 / 17.0, 15.0 / 17.0,  7.0 / 17.0,\n            4.0 / 17.0, 12.0 / 17.0,  2.0 / 17.0, 10.0 / 17.0,\n            16.0 / 17.0,  8.0 / 17.0, 14.0 / 17.0,  6.0 / 17.0\n        );\n        int ci = int(intMod(coord.x, 4.0));\n        int ri = int(intMod(coord.y, 4.0));\n        #if __VERSION__ == 100\n            vec4 i = vec4(float(ci * 4 + ri));\n            vec4 v = thresholdMatrix[0] * vec4(equal(i, vec4(0.0, 1.0, 2.0, 3.0))) +\n                thresholdMatrix[1] * vec4(equal(i, vec4(4.0, 5.0, 6.0, 7.0))) +\n                thresholdMatrix[2] * vec4(equal(i, vec4(8.0, 9.0, 10.0, 11.0))) +\n                thresholdMatrix[3] * vec4(equal(i, vec4(12.0, 13.0, 14.0, 15.0)));\n            at = v.x + v.y + v.z + v.w;\n        #else\n            at = thresholdMatrix[ci][ri];\n        #endif\n\n        if (ta < 0.99 && (ta < 0.01 || ta < at)) {\n            discard;\n        }\n    #else\n        if (ta < uPickingAlphaThreshold) {\n            discard;\n        }\n    #endif\n}\n",float_to_rgba:"\n    // floatToRgba adapted from https://github.com/equinor/glsl-float-to-rgba\n    // MIT License, Copyright (c) 2020 Equinor\n\n    float shiftRight (float v, float amt) {\n    v = floor(v) + 0.5;\n    return floor(v / exp2(amt));\n    }\n    float shiftLeft (float v, float amt) {\n        return floor(v * exp2(amt) + 0.5);\n    }\n    float maskLast (float v, float bits) {\n        return mod(v, shiftLeft(1.0, bits));\n    }\n    float extractBits (float num, float from, float to) {\n        from = floor(from + 0.5); to = floor(to + 0.5);\n        return maskLast(shiftRight(num, from), to - from);\n    }\n\n    vec4 floatToRgba(float texelFloat, bool littleEndian) {\n        if (texelFloat == 0.0) return vec4(0.0, 0.0, 0.0, 0.0);\n        float sign = texelFloat > 0.0 ? 0.0 : 1.0;\n        texelFloat = abs(texelFloat);\n        float exponent = floor(log2(texelFloat));\n        float biased_exponent = exponent + 127.0;\n        float fraction = ((texelFloat / exp2(exponent)) - 1.0) * 8388608.0;\n        float t = biased_exponent / 2.0;\n        float last_bit_of_biased_exponent = fract(t) * 2.0;\n        float remaining_bits_of_biased_exponent = floor(t);\n        float byte4 = extractBits(fraction, 0.0, 8.0) / 255.0;\n        float byte3 = extractBits(fraction, 8.0, 16.0) / 255.0;\n        float byte2 = (last_bit_of_biased_exponent * 128.0 + extractBits(fraction, 16.0, 23.0)) / 255.0;\n        float byte1 = (sign * 128.0 + remaining_bits_of_biased_exponent) / 255.0;\n        return (\n            littleEndian\n                ? vec4(byte4, byte3, byte2, byte1)\n                : vec4(byte1, byte2, byte3, byte4)\n        );\n    }\n",light_frag_params:"\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\nuniform vec3 uAmbientColor;\n\nstruct PhysicalMaterial {\n    vec3 diffuseColor;\n    float roughness;\n    vec3 specularColor;\n    float specularF90;\n};\n\nstruct IncidentLight {\n    vec3 color;\n    vec3 direction;\n};\n\nstruct ReflectedLight {\n    vec3 directDiffuse;\n    vec3 directSpecular;\n    vec3 indirectDiffuse;\n    vec3 indirectSpecular;\n};\n\nstruct GeometricContext {\n    vec3 position;\n    vec3 normal;\n    vec3 viewDir;\n};\n\nvec3 BRDF_Lambert(const in vec3 diffuseColor) {\n    return RECIPROCAL_PI * diffuseColor;\n}\n\nvec3 F_Schlick(const in vec3 f0, const in float f90, const in float dotVH) {\n    // Original approximation by Christophe Schlick '94\n    // float fresnel = pow( 1.0 - dotVH, 5.0 );\n    // Optimized variant (presented by Epic at SIGGRAPH '13)\n    // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\n    float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);\n    return f0 * (1.0 - fresnel) + (f90 * fresnel);\n}\n\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\nfloat V_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {\n    float a2 = pow2(alpha);\n    float gv = dotNL * sqrt(a2 + (1.0 - a2) * pow2(dotNV));\n    float gl = dotNV * sqrt(a2 + (1.0 - a2) * pow2(dotNL));\n    return 0.5 / max(gv + gl, EPSILON);\n}\n\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\nfloat D_GGX(const in float alpha, const in float dotNH) {\n    float a2 = pow2(alpha);\n    float denom = pow2(dotNH) * (a2 - 1.0) + 1.0; // avoid alpha = 0 with dotNH = 1\n    return RECIPROCAL_PI * a2 / pow2(denom);\n}\n\n// GGX Distribution, Schlick Fresnel, GGX_SmithCorrelated Visibility\nvec3 BRDF_GGX(const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness) {\n    float alpha = pow2(roughness); // UE4's roughness\n    vec3 halfDir = normalize( lightDir + viewDir);\n    float dotNL = saturate(dot(normal, lightDir));\n    float dotNV = saturate(dot(normal, viewDir));\n    float dotNH = saturate(dot(normal, halfDir));\n    float dotVH = saturate(dot(viewDir, halfDir));\n    vec3 F = F_Schlick(f0, f90, dotVH);\n    float V = V_GGX_SmithCorrelated(alpha, dotNL, dotNV);\n    float D = D_GGX(alpha, dotNH);\n    return F * (V * D);\n}\n\n// Analytical approximation of the DFG LUT, one half of the\n// split-sum approximation used in indirect specular lighting.\n// via 'environmentBRDF' from \"Physically Based Shading on Mobile\"\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\nvec2 DFGApprox(const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n    float dotNV = saturate(dot(normal, viewDir));\n    const vec4 c0 = vec4(-1, -0.0275, -0.572, 0.022);\n    const vec4 c1 = vec4(1, 0.0425, 1.04, -0.04);\n    vec4 r = roughness * c0 + c1;\n    float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;\n    vec2 fab = vec2(-1.04, 1.04) * a004 + r.zw;\n    return fab;\n}\n\n// Fdez-Ag\xfcera's \"Multiple-Scattering Microfacet Model for Real-Time Image Based Lighting\"\n// Approximates multiscattering in order to preserve energy.\n// http://www.jcgt.org/published/0008/01/03/\nvoid computeMultiscattering(const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter) {\n    vec2 fab = DFGApprox(normal, viewDir, roughness);\n    vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n    float Ess = fab.x + fab.y;\n    float Ems = 1.0 - Ess;\n    vec3 Favg = specularColor + (1.0 - specularColor) * 0.047619; // 1/21\n    vec3 Fms = FssEss * Favg / (1.0 - Ems * Favg);\n    singleScatter += FssEss;\n    multiScatter += Fms * Ems;\n}\n\nvoid RE_Direct_Physical(const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    float dotNL = saturate(dot(geometry.normal, directLight.direction));\n    vec3 irradiance = dotNL * directLight.color;\n    reflectedLight.directSpecular += irradiance * BRDF_GGX(directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness);\n    reflectedLight.directDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectDiffuse_Physical(const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert(material.diffuseColor);\n}\n\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n    // Both indirect specular and indirect diffuse light accumulate here\n    vec3 singleScattering = vec3(0.0);\n    vec3 multiScattering = vec3(0.0);\n    vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n    computeMultiscattering(geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering);\n    vec3 diffuse = material.diffuseColor * (1.0 - ( singleScattering + multiScattering));\n    reflectedLight.indirectSpecular += radiance * singleScattering;\n    reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n    reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n",matrix_scale:"\nfloat matrixScale(in mat4 m){\n    vec4 r = m[0];\n    return sqrt(r[0] * r[0] + r[1] * r[1] + r[2] * r[2]);\n}\n",normal_frag_params:"\nvarying vec3 vNormal;\n",read_from_texture:"\nvec4 readFromTexture(const in sampler2D tex, const in float i, const in vec2 dim) {\n    float x = intMod(i, dim.x);\n    float y = floor(intDiv(i, dim.x));\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n\nvec4 readFromTexture(const in sampler2D tex, const in int i, const in vec2 dim) {\n    int x = imod(i, int(dim.x));\n    int y = i / int(dim.x);\n    vec2 uv = (vec2(x, y) + 0.5) / dim;\n    return texture2D(tex, uv);\n}\n",rgba_to_float:'\n    // rgbaToFloat adapted from https://github.com/ihmeuw/glsl-rgba-to-float\n    // BSD 3-Clause License\n    //\n    // Copyright (c) 2019, Institute for Health Metrics and Evaluation All rights reserved.\n    // Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:\n    //  - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.\n    //  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.\n    //  - Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.\n    //\n    // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,\n    // INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n    // IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,\n    // OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n    // OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n    // OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED\n    // OF THE POSSIBILITY OF SUCH DAMAGE.\n\n    ivec4 floatsToBytes(vec4 inputFloats, bool littleEndian) {\n        ivec4 bytes = ivec4(inputFloats * 255.0);\n        return (\n            littleEndian\n                ? bytes.abgr\n                : bytes\n        );\n    }\n\n    // Break the four bytes down into an array of 32 bits.\n    void bytesToBits(const in ivec4 bytes, out bool bits[32]) {\n        for (int channelIndex = 0; channelIndex < 4; ++channelIndex) {\n            float acc = float(bytes[channelIndex]);\n            for (int indexInByte = 7; indexInByte >= 0; --indexInByte) {\n                float powerOfTwo = exp2(float(indexInByte));\n                bool bit = acc >= powerOfTwo;\n                bits[channelIndex * 8 + (7 - indexInByte)] = bit;\n                acc = mod(acc, powerOfTwo);\n            }\n        }\n    }\n\n    // Compute the exponent of the 32-bit float.\n    float getExponent(bool bits[32]) {\n        const int startIndex = 1;\n        const int bitStringLength = 8;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        float acc = 0.0;\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Compute the mantissa of the 32-bit float.\n    float getMantissa(bool bits[32], bool subnormal) {\n        const int startIndex = 9;\n        const int bitStringLength = 23;\n        const int endBeforeIndex = startIndex + bitStringLength;\n        // Leading/implicit/hidden bit convention:\n        // If the number is not subnormal (with exponent 0), we add a leading 1 digit.\n        float acc = float(!subnormal) * exp2(float(bitStringLength));\n        int pow2 = bitStringLength - 1;\n        for (int bitIndex = startIndex; bitIndex < endBeforeIndex; ++bitIndex) {\n            acc += float(bits[bitIndex]) * exp2(float(pow2--));\n        }\n        return acc;\n    }\n\n    // Parse the float from its 32 bits.\n    float bitsToFloat(bool bits[32]) {\n        float signBit = float(bits[0]) * -2.0 + 1.0;\n        float exponent = getExponent(bits);\n        bool subnormal = abs(exponent - 0.0) < 0.01;\n        float mantissa = getMantissa(bits, subnormal);\n        float exponentBias = 127.0;\n        return signBit * mantissa * exp2(exponent - exponentBias - 23.0);\n    }\n\n    float rgbaToFloat(vec4 texelRGBA, bool littleEndian) {\n        ivec4 rgbaBytes = floatsToBytes(texelRGBA, littleEndian);\n        bool bits[32];\n        bytesToBits(rgbaBytes, bits);\n        return bitsToFloat(bits);\n    }\n',size_vert_params:"\n#if defined(dSizeType_uniform)\n    uniform float uSize;\n#elif defined(dSizeType_attribute)\n    attribute float aSize;\n#elif defined(dSizeType_instance) || defined(dSizeType_group) || defined(dSizeType_groupInstance)\n    uniform vec2 uSizeTexDim;\n    uniform sampler2D tSize;\n#endif\n\nuniform float uSizeFactor;\n",texture3d_from_1d_trilinear:"\nvec4 texture3dFrom1dTrilinear(const in sampler2D tex, const in vec3 pos, const in vec3 gridDim, const in vec2 texDim, const in float offset) {\n    float gdYZ = gridDim.z * gridDim.y;\n    float gdZ = gridDim.z;\n    vec3 p0 = floor(pos * gridDim);\n    vec3 p1 = ceil(pos * gridDim);\n    vec3 pd = (pos * gridDim - p0) / (p1 - p0);\n    vec4 s000 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s100 = readFromTexture(tex, offset + p0.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s001 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s101 = readFromTexture(tex, offset + p1.z + p0.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s010 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s110 = readFromTexture(tex, offset + p0.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s011 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p0.x * gdYZ, texDim);\n    vec4 s111 = readFromTexture(tex, offset + p1.z + p1.y * gdZ + p1.x * gdYZ, texDim);\n    vec4 s00 = mix(s000, s100, pd.x);\n    vec4 s01 = mix(s001, s101, pd.x);\n    vec4 s10 = mix(s010, s110, pd.x);\n    vec4 s11 = mix(s011, s111, pd.x);\n    vec4 s0 = mix(s00, s10, pd.y);\n    vec4 s1 = mix(s01, s11, pd.y);\n    return mix(s0, s1, pd.z);\n}\n",texture3d_from_2d_linear:"\nvec4 texture3dFrom2dLinear(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice0 = floor(pos.z * gridDim.z);\n    float column0 = intMod(zSlice0 * gridDim.x, texDim.x) / gridDim.x;\n    float row0 = floor(intDiv(zSlice0 * gridDim.x, texDim.x));\n    vec2 coord0 = (vec2(column0 * gridDim.x, row0 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color0 = texture2D(tex, coord0);\n\n    float zSlice1 = zSlice0 + 1.0;\n    float column1 = intMod(zSlice1 * gridDim.x, texDim.x) / gridDim.x;\n    float row1 = floor(intDiv(zSlice1 * gridDim.x, texDim.x));\n    vec2 coord1 = (vec2(column1 * gridDim.x, row1 * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    vec4 color1 = texture2D(tex, coord1);\n\n    float delta0 = abs((pos.z * gridDim.z) - zSlice0);\n    return mix(color0, color1, delta0);\n}\n",texture3d_from_2d_nearest:"\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intMod(zSlice * gridDim.x, texDim.x) / gridDim.x;\n    float row = floor(intDiv(zSlice * gridDim.x, texDim.x));\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / texDim;\n    return texture2D(tex, coord);\n}\n",wboit_write:"\n#if defined(dRenderVariant_colorWboit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(gl_FragCoord.xy / uDrawingBufferSize)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n            float alpha = gl_FragColor.a;\n            float wboitWeight = alpha * clamp(pow(1.0 - fragmentDepth, 2.0), 0.01, 1.0);\n            gl_FragColor = vec4(gl_FragColor.rgb * alpha * wboitWeight, alpha);\n            // extra alpha is to handle pre-multiplied alpha\n            #ifndef dGeometryType_directVolume\n                gl_FragData[1] = vec4((uTransparentBackground ? alpha : 1.0) * alpha * wboitWeight);\n            #else\n                gl_FragData[1] = vec4(alpha * alpha * wboitWeight);\n            #endif\n        } else {\n            discard;\n        }\n    }\n#endif\n",dpoit_write:"\n#if defined(dRenderVariant_colorDpoit)\n    if (uRenderMask == MaskOpaque) {\n        if (preFogAlpha < 1.0) {\n            discard;\n        }\n    } else if (uRenderMask == MaskTransparent) {\n        vec2 coords = gl_FragCoord.xy / uDrawingBufferSize;\n        if (preFogAlpha != 1.0 && fragmentDepth < getDepth(coords)) {\n            #ifdef dTransparentBackfaces_off\n                if (interior) discard;\n            #endif\n\n            // adapted from https://github.com/tsherif/webgl2examples\n            // The MIT License, Copyright 2017 Tarek Sherif, Shuai Shao\n\n            vec2 lastDepth = texture2D(tDpoitDepth, coords).rg;\n            vec4 lastFrontColor = texture2D(tDpoitFrontColor, coords);\n\n            vec4 fragColor = gl_FragColor;\n\n            // depth value always increases\n            // so we can use MAX blend equation\n            gl_FragData[2].rg = vec2(-MAX_DPOIT_DEPTH);\n\n            // front color always increases\n            // so we can use MAX blend equation\n            gl_FragColor = lastFrontColor;\n\n            // back color is separately blend afterwards each pass\n            gl_FragData[1] = vec4(0.0);\n\n            float nearestDepth = -lastDepth.x;\n            float furthestDepth = lastDepth.y;\n            float alphaMultiplier = 1.0 - lastFrontColor.a;\n\n            if (fragmentDepth < nearestDepth || fragmentDepth > furthestDepth) {\n                // Skip this depth since it's been peeled.\n                return;\n            }\n\n            if (fragmentDepth > nearestDepth && fragmentDepth < furthestDepth) {\n                // This needs to be peeled.\n                // The ones remaining after MAX blended for\n                // all need-to-peel will be peeled next pass.\n                gl_FragData[2].rg = vec2(-fragmentDepth, fragmentDepth);\n                return;\n            }\n\n            // write to back and front color buffer\n            if (fragmentDepth == nearestDepth) {\n                gl_FragColor.rgb += fragColor.rgb * fragColor.a * alphaMultiplier;\n                gl_FragColor.a = 1.0 - alphaMultiplier * (1.0 - fragColor.a);\n            } else {\n                gl_FragData[1] += fragColor;\n            }\n\n        } else {\n            discard;\n        }\n    }\n#endif\n"},E$e=/^(?!\/\/)\s*#include\s+(\S+)/gm,T$e=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*\+\+i\s*\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g,D$e=/[ \t]*\/\/.*\n/g,P$e=/[ \t]*\/\*[\s\S]*?\*\//g,k$e=/\n{2,}/g;function Wue(e){return e.replace(E$e,(t,n)=>{const r=I$e[n];if(!r)throw new Error(`empty chunk, '${n}'`);return r}).trim().replace(D$e,"\n").replace(P$e,"\n").replace(k$e,"\n")}function R$e(e,t,n,r){let i="";for(let o=parseInt(t);o<parseInt(n);++o)i+=r.replace(/\[\s*i\s*\]/g,`[${o}]`).replace(/UNROLLED_LOOP_INDEX/g,`${o}`);return i}function $ue(e,t){return function M$e(e){return e.replace(T$e,R$e)}(function N$e(e,t){return t.dLightCount&&(e=e.replace(/dLightCount/g,`${t.dLightCount.ref.value}`)),t.dClipObjectCount&&(e=e.replace(/dClipObjectCount/g,`${t.dClipObjectCount.ref.value}`)),e}(e,t))}function Wi(e,t,n,r={},i={},o){return{id:que(),name:e,vert:Wue(t),frag:Wue(n),extensions:r,outTypes:i,ignoreDefine:o}}function DD(e,t,n){var r;return t.startsWith("color")?"dLightCount"===e&&!(null===(r=n.dIgnoreLight)||void 0===r||!r.ref.value):["dColorType","dUsePalette","dLightCount","dXrayShaded","dOverpaintType","dOverpaint","dSubstanceType","dSubstance","dColorMarker"].includes(e)}function fN(e,t,n){return"dLightCount"===e||DD(e,t,n)}const F$e=Wi("points","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nvoid main(){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_size\n\n    #ifdef dPointSizeAttenuation\n        gl_PointSize = size * uPixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 5.0;\n    #else\n        gl_PointSize = size * uPixelRatio;\n    #endif\n    gl_PointSize = max(1.0, gl_PointSize);\n\n    gl_Position = uProjection * mvPosition;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nconst vec2 center = vec2(0.5);\nconst float radius = 0.5;\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dPointStyle_circle)\n        float dist = distance(gl_PointCoord, center);\n        if (dist > radius) discard;\n    #elif defined(dPointStyle_fuzzy)\n        float dist = distance(gl_PointCoord, center);\n        float fuzzyAlpha = 1.0 - smoothstep(0.0, radius, dist);\n        if (fuzzyAlpha < 0.0001) discard;\n    #endif\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #if defined(dPointStyle_fuzzy)\n            gl_FragColor.a *= fuzzyAlpha;\n        #endif\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},fN),O$e=Wi("spheres","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\nuniform mat4 uInvProjection;\nuniform float uIsOrtho;\n\nuniform vec2 uTexDim;\nuniform sampler2D tPositionGroup;\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#include matrix_scale\n\n/**\n * Bounding rectangle of a clipped, perspective-projected 3D Sphere.\n * Michael Mara, Morgan McGuire. 2013\n *\n * Specialization by Arseny Kapoulkine, MIT License Copyright (c) 2018\n * https://github.com/zeux/niagara\n */\nvoid sphereProjection(const in vec3 p, const in float r, const in vec2 mapping) {\n    vec3 pr = p * r;\n    float pzr2 = p.z * p.z - r * r;\n\n    float vx = sqrt(p.x * p.x + pzr2);\n    float minx = ((vx * p.x - pr.z) / (vx * p.z + pr.x)) * uProjection[0][0];\n    float maxx = ((vx * p.x + pr.z) / (vx * p.z - pr.x)) * uProjection[0][0];\n\n    float vy = sqrt(p.y * p.y + pzr2);\n    float miny = ((vy * p.y - pr.z) / (vy * p.z + pr.y)) * uProjection[1][1];\n    float maxy = ((vy * p.y + pr.z) / (vy * p.z - pr.y)) * uProjection[1][1];\n\n    gl_Position.xy = vec2(maxx + minx, maxy + miny) * -0.5;\n    gl_Position.xy -= mapping * vec2(maxx - minx, maxy - miny) * 0.5;\n    gl_Position.xy *= gl_Position.w;\n}\n\nvoid main(void){\n    vec2 mapping = vec2(1.0, 1.0); // vertices 2 and 5\n    #if __VERSION__ == 100\n        int m = imod(VertexID, 6);\n    #else\n        int m = VertexID % 6;\n    #endif\n    if (m == 0) {\n        mapping = vec2(-1.0, 1.0);\n    } else if (m == 1 || m == 3) {\n        mapping = vec2(-1.0, -1.0);\n    } else if (m == 4) {\n        mapping = vec2(1.0, -1.0);\n    }\n\n    vec4 positionGroup = readFromTexture(tPositionGroup, VertexID / 6, uTexDim);\n    vec3 position = positionGroup.rgb;\n    float group = positionGroup.a;\n\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vRadius = size * matrixScale(uModelView);\n\n    vec4 position4 = vec4(position, 1.0);\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    float d;\n    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n        d = dot(uCameraPlane.xyz, vModelPosition) + uCameraPlane.w;\n        float f = min(\n            smoothstep(uLod.x, uLod.x + uLod.z, d),\n            1.0 - smoothstep(uLod.y - uLod.z, uLod.y, d)\n        ) * uLod.w;\n        vRadius *= f;\n    }\n\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    #ifdef dApproximate\n        vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n        mvCorner.xy += mapping * vRadius;\n        gl_Position = uProjection * mvCorner;\n    #else\n        if (uIsOrtho == 1.0) {\n            vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n            mvCorner.xy += mapping * vRadius;\n            gl_Position = uProjection * mvCorner;\n        } else {\n            gl_Position = uProjection * vec4(mvPosition.xyz, 1.0);\n            sphereProjection(mvPosition.xyz, vRadius, mapping);\n        }\n    #endif\n\n    vec4 vPoint4 = uInvProjection * gl_Position;\n    vPoint = vPoint4.xyz / vPoint4.w;\n    vPointViewPosition = -mvPosition.xyz / mvPosition.w;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * vRadius; // avoid clipping\n        gl_Position.z = (uProjection * vec4(mvPosition.xyz, 1.0)).z;\n    }\n\n    if (uLod.w != 0.0 && (uLod.x != 0.0 || uLod.y != 0.0)) {\n        if (d < uLod.x || d > uLod.y) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    }\n\n    #if defined(dClipPrimitive) && !defined(dClipVariant_instance) && dClipObjectCount != 0\n        if (clipTest(vec4(vModelPosition.xyz, 0.0))) {\n            // move out of [ -w, +w ] to 'discard' in vert shader\n            gl_Position.z = 2.0 * gl_Position.w;\n        }\n    #else\n        #include clip_instance\n    #endif\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\nuniform mat4 uInvView;\nuniform float uAlphaThickness;\n\nvarying float vRadius;\nvarying vec3 vPoint;\nvarying vec3 vPointViewPosition;\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\nbool SphereImpostor(out vec3 modelPos, out vec3 cameraPos, out vec3 cameraNormal, out bool interior, out float fragmentDepth){\n    vec3 cameraSpherePos = -vPointViewPosition;\n\n    vec3 rayOrigin = mix(vec3(0.0, 0.0, 0.0), vPoint, uIsOrtho);\n    vec3 rayDirection = mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n    vec3 cameraSphereDir = mix(cameraSpherePos, rayOrigin - cameraSpherePos, uIsOrtho);\n\n    float B = dot(rayDirection, cameraSphereDir);\n    float det = B * B + vRadius * vRadius - dot(cameraSphereDir, cameraSphereDir);\n\n    if (det < 0.0) return false;\n\n    float sqrtDet = sqrt(det);\n    float posT = mix(B + sqrtDet, B - sqrtDet, uIsOrtho);\n    float negT = mix(B - sqrtDet, B + sqrtDet, uIsOrtho);\n\n    cameraPos = rayDirection * negT + rayOrigin;\n    modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n    fragmentDepth = calcDepth(cameraPos);\n\n    bool objectClipped = false;\n\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        if (clipTest(vec4(modelPos, 0.0))) {\n            objectClipped = true;\n            fragmentDepth = -1.0;\n        }\n    #endif\n\n    if (fragmentDepth > 0.0) {\n        cameraNormal = normalize(cameraPos - cameraSpherePos);\n        interior = false;\n        return true;\n    } else if (uDoubleSided || solidInterior) {\n        cameraPos = rayDirection * posT + rayOrigin;\n        modelPos = (uInvView * vec4(cameraPos, 1.0)).xyz;\n        fragmentDepth = calcDepth(cameraPos);\n        cameraNormal = -normalize(cameraPos - cameraSpherePos);\n        interior = true;\n        if (fragmentDepth > 0.0) {\n            #ifdef dSolidInterior\n                if (!objectClipped) {\n                    fragmentDepth = 0.0 + (0.0000001 / vRadius);\n                    cameraNormal = -mix(normalize(vPoint), vec3(0.0, 0.0, 1.0), uIsOrtho);\n                }\n            #endif\n            return true;\n        }\n    }\n\n    return false;\n}\n\nvoid main(void){\n    vec3 cameraNormal;\n    float fragmentDepth;\n\n    #ifdef dApproximate\n        vec3 pointDir = -vPointViewPosition - vPoint;\n        if (dot(pointDir, pointDir) > vRadius * vRadius) discard;\n        vec3 vViewPosition = -vPointViewPosition;\n        fragmentDepth = gl_FragCoord.z;\n        #if !defined(dIgnoreLight) || defined(dXrayShaded)\n            pointDir.z -= cos(length(pointDir) / vRadius);\n            cameraNormal = -normalize(pointDir / vRadius);\n        #endif\n        interior = false;\n    #else\n        vec3 modelPos;\n        vec3 cameraPos;\n        bool hit = SphereImpostor(modelPos, cameraPos, cameraNormal, interior, fragmentDepth);\n        if (!hit) discard;\n\n        if (fragmentDepth < 0.0) discard;\n        if (fragmentDepth > 1.0) discard;\n\n        gl_FragDepthEXT = fragmentDepth;\n\n        vec3 vModelPosition = modelPos;\n        vec3 vViewPosition = cameraPos;\n    #endif\n\n    #include fade_lod\n    #if !defined(dClipPrimitive) && defined(dClipVariant_pixel) && dClipObjectCount != 0\n        #include clip_pixel\n    #endif\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        vec3 normal = -cameraNormal;\n        #include apply_light_color\n\n        if (uRenderMask == MaskTransparent && uAlphaThickness > 0.0) {\n            gl_FragColor.a *= min(1.0, vRadius / uAlphaThickness);\n        }\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},DD),B$e=Wi("cylinders","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec3 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\nattribute float aScale;\nattribute float aCap;\nattribute float aColorMode;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform float uIsOrtho;\nuniform vec3 uCameraDir;\n\nvoid main() {\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelTransform = uModel * aTransform;\n\n    vTransform = aTransform;\n    vStart = (modelTransform * vec4(aStart, 1.0)).xyz;\n    vEnd = (modelTransform * vec4(aEnd, 1.0)).xyz;\n    vSize = size * aScale;\n    vCap = aCap;\n\n    vModelPosition = (vStart + vEnd) * 0.5;\n    vec3 camDir = -mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 dir = vEnd - vStart;\n    float f = aMapping.x > 0.0 ? 1.0 : 0.0;\n    // ensure cylinder 'dir' is pointing towards the camera\n    if(dot(camDir, dir) < 0.0) {\n        dir = -dir;\n        f = 1.0 - f;\n    }\n\n    vec3 left = cross(camDir, dir);\n    vec3 up = cross(left, dir);\n    left = vSize * normalize(left);\n    up = vSize * normalize(up);\n\n    // move vertex in object-space from center to corner\n    vModelPosition += aMapping.x * dir + aMapping.y * left + aMapping.z * up;\n\n    vec4 mvPosition = uView * vec4(vModelPosition, 1.0);\n    vViewPosition = mvPosition.xyz;\n    gl_Position = uProjection * mvPosition;\n\n    if (gl_Position.z < -gl_Position.w) {\n        mvPosition.z -= 2.0 * (length(vEnd - vStart) + vSize); // avoid clipping\n        gl_Position.z = (uProjection * mvPosition).z;\n    }\n\n    #if defined(dDualColor) && defined(dRenderVariant_color) && (defined(dColorType_group) || defined(dColorType_groupInstance))\n        // dual-color mixing\n        // - for aColorMode between 0 and 1 use aColorMode to interpolate\n        // - for aColorMode == 2 do nothing, i.e., use vColor\n        // - for aColorMode == 3 use position on cylinder axis to interpolate\n        if (aColorMode <= 1.0){\n            vColor.rgb = mix(vColor.rgb, color2.rgb, aColorMode);\n        } else if (aColorMode == 3.0) {\n            vColor.rgb = mix(vColor.rgb, color2.rgb, mix(-0.25, 1.25, f / 1.5));\n        }\n    #endif\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\nuniform mat4 uView;\n\nvarying mat4 vTransform;\nvarying vec3 vStart;\nvarying vec3 vEnd;\nvarying float vSize;\nvarying float vCap;\n\nuniform vec3 uCameraDir;\nuniform vec3 uCameraPosition;\nuniform mat4 uInvView;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include common_clip\n\n#ifdef dSolidInterior\n    const bool solidInterior = true;\n#else\n    const bool solidInterior = false;\n#endif\n\n// adapted from https://www.shadertoy.com/view/4lcSRn\n// The MIT License, Copyright 2016 Inigo Quilez\nbool CylinderImpostor(\n    in vec3 rayOrigin, in vec3 rayDir,\n    in vec3 start, in vec3 end, in float radius,\n    out vec3 cameraNormal, out bool interior,\n    out vec3 modelPosition, out vec3 viewPosition, out float fragmentDepth\n){\n    vec3 ba = end - start;\n    vec3 oc = rayOrigin - start;\n\n    float baba = dot(ba, ba);\n    float bard = dot(ba, rayDir);\n    float baoc = dot(ba, oc);\n\n    float k2 = baba - bard * bard;\n    float k1 = baba * dot(oc, rayDir) - baoc * bard;\n    float k0 = baba * dot(oc, oc) - baoc * baoc - radius * radius * baba;\n\n    float h = k1 * k1 - k2 * k0;\n    if (h < 0.0) return false;\n\n    bool topCap = (vCap > 0.9 && vCap < 1.1) || vCap >= 2.9;\n    bool bottomCap = (vCap > 1.9 && vCap < 2.1) || vCap >= 2.9;\n\n    #ifdef dSolidInterior\n        bool topInterior = !topCap;\n        bool bottomInterior = !bottomCap;\n        topCap = true;\n        bottomCap = true;\n    #else\n        bool topInterior = false;\n        bool bottomInterior = false;\n    #endif\n\n    bool clipped = false;\n    bool objectClipped = false;\n\n    // body outside\n    h = sqrt(h);\n    float t = (-k1 - h) / k2;\n    float y = baoc + t * bard;\n    if (y > 0.0 && y < baba) {\n        interior = false;\n        cameraNormal = (oc + t * rayDir - ba * y / baba) / radius;\n        modelPosition = rayOrigin + t * rayDir;\n        viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n        fragmentDepth = calcDepth(viewPosition);\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            if (clipTest(vec4(modelPosition, 0.0))) {\n                objectClipped = true;\n                fragmentDepth = -1.0;\n                #ifdef dSolidInterior\n                    topCap = !topInterior;\n                    bottomCap = !bottomInterior;\n                #endif\n            }\n        #endif\n        if (fragmentDepth > 0.0) return true;\n        clipped = true;\n    }\n\n    if (!clipped) {\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = topInterior;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < h) {\n                interior = bottomInterior;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n                    if (clipTest(vec4(modelPosition, 0.0))) {\n                        objectClipped = true;\n                        fragmentDepth = -1.0;\n                        #ifdef dSolidInterior\n                            topCap = !topInterior;\n                            bottomCap = !bottomInterior;\n                        #endif\n                    }\n                #endif\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (interior) cameraNormal = -rayDir;\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    if (uDoubleSided || solidInterior) {\n        // body inside\n        h = -h;\n        t = (-k1 - h) / k2;\n        y = baoc + t * bard;\n        if (y > 0.0 && y < baba) {\n            interior = true;\n            cameraNormal = -(oc + t * rayDir - ba * y / baba) / radius;\n            modelPosition = rayOrigin + t * rayDir;\n            viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n            fragmentDepth = calcDepth(viewPosition);\n            if (fragmentDepth > 0.0) {\n                #ifdef dSolidInterior\n                    if (!objectClipped) {\n                        fragmentDepth = 0.0 + (0.0000002 / vSize);\n                        cameraNormal = -rayDir;\n                    }\n                #endif\n                return true;\n            }\n        }\n\n        if (topCap && y < 0.0) {\n            // top cap\n            t = -baoc / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        } else if (bottomCap && y >= 0.0) {\n            // bottom cap\n            t = (baba - baoc) / bard;\n            if (abs(k1 + k2 * t) < -h) {\n                interior = true;\n                cameraNormal = -ba / baba;\n                modelPosition = rayOrigin + t * rayDir;\n                viewPosition = (uView * vec4(modelPosition, 1.0)).xyz;\n                fragmentDepth = calcDepth(viewPosition);\n                if (fragmentDepth > 0.0) {\n                    #ifdef dSolidInterior\n                        if (!objectClipped) {\n                            fragmentDepth = 0.0 + (0.0000002 / vSize);\n                            cameraNormal = -rayDir;\n                        }\n                    #endif\n                    return true;\n                }\n            }\n        }\n    }\n\n    return false;\n}\n\nvoid main() {\n    vec3 rayOrigin = vModelPosition;\n    vec3 rayDir = mix(normalize(vModelPosition - uCameraPosition), uCameraDir, uIsOrtho);\n\n    vec3 cameraNormal;\n    vec3 modelPosition;\n    vec3 viewPosition;\n    float fragmentDepth;\n    bool hit = CylinderImpostor(rayOrigin, rayDir, vStart, vEnd, vSize, cameraNormal, interior, modelPosition, viewPosition, fragmentDepth);\n    if (!hit) discard;\n\n    if (fragmentDepth < 0.0) discard;\n    if (fragmentDepth > 1.0) discard;\n\n    gl_FragDepthEXT = fragmentDepth;\n\n    vec3 vViewPosition = viewPosition;\n    vec3 vModelPosition = modelPosition;\n\n    #include fade_lod\n    #include clip_pixel\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        mat3 normalMatrix = transpose3(inverse3(mat3(uView)));\n        vec3 normal = normalize(normalMatrix * -normalize(cameraNormal));\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{fragDepth:"required",drawBuffers:"optional"},{},DD),L$e=Wi("text","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform mat4 uModelView;\n\nattribute vec3 aPosition;\nattribute vec2 aMapping;\nattribute float aDepth;\nattribute vec2 aTexCoord;\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nuniform float uOffsetX;\nuniform float uOffsetY;\nuniform float uOffsetZ;\n\nuniform float uIsOrtho;\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nvarying vec2 vTexCoord;\n\n#include matrix_scale\n\nvoid main(void){\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    vTexCoord = aTexCoord;\n\n    float scale = matrixScale(uModelView);\n\n    float offsetX = uOffsetX * scale;\n    float offsetY = uOffsetY * scale;\n    float offsetZ = (uOffsetZ + aDepth * 0.95) * scale;\n\n    vec4 position4 = vec4(aPosition, 1.0);\n    vec4 mvPosition = uModelView * aTransform * position4;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // TODO\n    // #ifdef FIXED_SIZE\n    //     if (ortho) {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -uCameraPosition.z) * 0.1;\n    //     } else {\n    //         scale /= pixelRatio * ((uViewport.w / 2.0) / -mvPosition.z) * 0.1;\n    //     }\n    // #endif\n\n    vec4 mvCorner = vec4(mvPosition.xyz, 1.0);\n\n    if (vTexCoord.x == 10.0) { // indicates background plane\n        // move a bit to the back, taking distance to camera into account to avoid z-fighting\n        offsetZ -= 0.001 * distance(uCameraPosition, (uProjection * mvCorner).xyz);\n    }\n\n    mvCorner.xy += aMapping * size * scale;\n    mvCorner.x += offsetX;\n    mvCorner.y += offsetY;\n\n    if (uIsOrtho == 1.0) {\n        mvCorner.z += offsetZ;\n    } else {\n        mvCorner.xyz += normalize(-mvCorner.xyz) * offsetZ;\n    }\n\n    gl_Position = uProjection * mvCorner;\n\n    vViewPosition = -mvCorner.xyz;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nuniform sampler2D tFont;\n\nuniform vec3 uBorderColor;\nuniform float uBorderWidth;\nuniform vec3 uBackgroundColor;\nuniform float uBackgroundOpacity;\n\nvarying vec2 vTexCoord;\n\nconst float smoothness = 32.0;\nconst float gamma = 2.2;\n\nvoid main2(){\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    if (vTexCoord.x > 1.0) {\n        #if defined(dRenderVariant_color)\n            material = vec4(uBackgroundColor, uBackgroundOpacity * material.a);\n        #endif\n    } else {\n        // retrieve signed distance\n        float sdf = texture2D(tFont, vTexCoord).a + uBorderWidth;\n\n        // perform adaptive anti-aliasing of the edges\n        float w = clamp(smoothness * (abs(dFdx(vTexCoord.x)) + abs(dFdy(vTexCoord.y))), 0.0, 0.5);\n        float a = smoothstep(0.5 - w, 0.5 + w, sdf);\n\n        // gamma correction for linear attenuation\n        a = pow(a, 1.0 / gamma);\n\n        if (a < 0.5) discard;\n\n        #if defined(dRenderVariant_color)\n            material.a *= a;\n\n            // add border\n            float t = 0.5 + uBorderWidth;\n            if (uBorderWidth > 0.0 && sdf < t) {\n                material.xyz = mix(uBorderColor, material.xyz, smoothstep(t - w, t, sdf));\n            }\n        #endif\n    }\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},fN),j$e=Wi("lines","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include size_vert_params\n#include common_clip\n\nuniform float uPixelRatio;\nuniform vec4 uViewport;\n\nattribute mat4 aTransform;\nattribute float aInstance;\nattribute float aGroup;\n\nattribute vec2 aMapping;\nattribute vec3 aStart;\nattribute vec3 aEnd;\n\nvoid trimSegment(const in vec4 start, inout vec4 end) {\n    // trim end segment so it terminates between the camera plane and the near plane\n    // conservative estimate of the near plane\n    float a = uProjection[2][2];  // 3rd entry in 3rd column\n    float b = uProjection[3][2];  // 3rd entry in 4th column\n    float nearEstimate = -0.5 * b / a;\n    float alpha = (nearEstimate - start.z) / (end.z - start.z);\n    end.xyz = mix(start.xyz, end.xyz, alpha);\n}\n\nvoid main(){\n    float aspect = uViewport.z / uViewport.w;\n\n    #include assign_group\n    #include assign_color_varying\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_size\n\n    mat4 modelView = uView * uModel * aTransform;\n\n    // camera space\n    vec4 start = modelView * vec4(aStart, 1.0);\n    vec4 end = modelView * vec4(aEnd, 1.0);\n\n    // assign position\n    vec4 position4 = vec4((aMapping.y < 0.5) ? aStart : aEnd, 1.0);\n    vec4 mvPosition = modelView * position4;\n    vViewPosition = mvPosition.xyz;\n\n    vModelPosition = (uModel * aTransform * position4).xyz; // for clipping in frag shader\n\n    // special case for perspective projection, and segments that terminate either in, or behind, the camera plane\n    // clearly the gpu firmware has a way of addressing this issue when projecting into ndc space\n    // but we need to perform ndc-space calculations in the shader, so we must address this issue directly\n    // perhaps there is a more elegant solution -- WestLangley\n    bool perspective = (uProjection[2][3] == -1.0); // 4th entry in the 3rd column\n    if (perspective) {\n        if (start.z < 0.0 && end.z >= 0.0) {\n            trimSegment(start, end);\n        } else if (end.z < 0.0 && start.z >= 0.0) {\n            trimSegment(end, start);\n        }\n    }\n\n    // clip space\n    vec4 clipStart = uProjection * start;\n    vec4 clipEnd = uProjection * end;\n\n    // ndc space\n    vec2 ndcStart = clipStart.xy / clipStart.w;\n    vec2 ndcEnd = clipEnd.xy / clipEnd.w;\n\n    // direction\n    vec2 dir = ndcEnd - ndcStart;\n\n    // account for clip-space aspect ratio\n    dir.x *= aspect;\n    dir = normalize(dir);\n\n    // perpendicular to dir\n    vec2 offset = vec2(dir.y, - dir.x);\n\n    // undo aspect ratio adjustment\n    dir.x /= aspect;\n    offset.x /= aspect;\n\n    // sign flip\n    if (aMapping.x < 0.0) offset *= -1.0;\n\n    // calculate linewidth\n    float linewidth;\n    #ifdef dLineSizeAttenuation\n        linewidth = size * uPixelRatio * ((uViewport.w / 2.0) / -start.z) * 5.0;\n    #else\n        linewidth = size * uPixelRatio;\n    #endif\n    linewidth = max(1.0, linewidth);\n\n    // adjust for linewidth\n    offset *= linewidth;\n\n    // adjust for clip-space to screen-space conversion\n    offset /= uViewport.w;\n\n    // select end\n    vec4 clip = (aMapping.y < 0.5) ? clipStart : clipEnd;\n\n    // back to clip space\n    offset *= clip.w;\n    clip.xy += offset;\n    gl_Position = clip;\n\n    #include clip_instance\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include common_clip\n\nvoid main(){\n    #include fade_lod\n    #include clip_pixel\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        gl_FragColor = material;\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},fN),Yue=Wi("mesh","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n#include read_from_texture\n#include common_vert_params\n#include color_vert_params\n#include common_clip\n#include texture3d_from_2d_linear\n\n#ifdef dGeometryType_textureMesh\n    uniform vec2 uGeoTexDim;\n    uniform sampler2D tPosition;\n    uniform sampler2D tGroup;\n    uniform sampler2D tNormal;\n#else\n    attribute vec3 aPosition;\n    attribute float aGroup;\n    attribute vec3 aNormal;\n#endif\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec3 vNormal;\n\nvoid main(){\n    #include assign_group\n    #include assign_marker_varying\n    #include assign_clipping_varying\n    #include assign_position\n    #include assign_color_varying\n    #include clip_instance\n\n    #ifdef dGeometryType_textureMesh\n        vec3 normal = readFromTexture(tNormal, VertexID, uGeoTexDim).xyz;\n    #else\n        vec3 normal = aNormal;\n    #endif\n    mat3 normalMatrix = transpose3(inverse3(mat3(modelView)));\n    vec3 transformedNormal = normalize(normalMatrix * normalize(normal));\n    #if defined(dFlipSided)\n        if (!uDoubleSided) { // TODO checking uDoubleSided should not be required, ASR\n            transformedNormal = -transformedNormal;\n        }\n    #endif\n    vNormal = transformedNormal;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#define bumpEnabled\n\n#include common\n#include common_frag_params\n#include color_frag_params\n#include light_frag_params\n#include normal_frag_params\n#include common_clip\n\nvoid main() {\n    #include fade_lod\n    #include clip_pixel\n\n    // Workaround for buggy gl_FrontFacing (e.g. on some integrated Intel GPUs)\n    vec3 fdx = dFdx(vViewPosition);\n    vec3 fdy = dFdy(vViewPosition);\n    vec3 faceNormal = normalize(cross(fdx,fdy));\n    bool frontFacing = dot(vNormal, faceNormal) > 0.0;\n\n    #if defined(dFlipSided)\n        interior = frontFacing;\n    #else\n        interior = !frontFacing;\n    #endif\n\n    float fragmentDepth = gl_FragCoord.z;\n    #include assign_material_color\n\n    #if defined(dRenderVariant_pick)\n        #include check_picking_alpha\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vObject;\n            gl_FragData[1] = vInstance;\n            gl_FragData[2] = vGroup;\n            gl_FragData[3] = packDepthToRGBA(fragmentDepth);\n        #else\n            gl_FragColor = vColor;\n        #endif\n    #elif defined(dRenderVariant_depth)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_marking)\n        gl_FragColor = material;\n    #elif defined(dRenderVariant_color)\n        #if defined(dFlatShaded)\n            vec3 normal = -faceNormal;\n        #else\n            vec3 normal = -normalize(vNormal);\n            if (uDoubleSided) normal *= float(frontFacing) * 2.0 - 1.0;\n        #endif\n        #include apply_light_color\n\n        #include apply_interior_color\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},DD),U$e=Wi("direct-volume","\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform mat4 uModelView;\nuniform mat4 uProjection;\nuniform vec4 uInvariantBoundingSphere;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform vec3 uBboxMax;\nuniform vec3 uGridDim;\nuniform mat4 uTransform;\n\nuniform mat4 uUnitToCartn;\n\nvoid main() {\n    vec4 unitCoord = vec4(aPosition + vec3(0.5), 1.0);\n    vec4 mvPosition = uModelView * aTransform * uUnitToCartn * unitCoord;\n\n    vOrigPos = (aTransform * uUnitToCartn * unitCoord).xyz;\n    vInstance = aInstance;\n    vBoundingSphere = vec4(\n        (aTransform * vec4(uInvariantBoundingSphere.xyz, 1.0)).xyz,\n        uInvariantBoundingSphere.w\n    );\n    vTransform = aTransform;\n\n    gl_Position = uProjection * mvPosition;\n\n    // move z position to near clip plane (but not too close to get precision issues)\n    gl_Position.z = gl_Position.w - 0.01;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include light_frag_params\n\n#if dClipObjectCount != 0\n    uniform int uClipObjectType[dClipObjectCount];\n    uniform bool uClipObjectInvert[dClipObjectCount];\n    uniform vec3 uClipObjectPosition[dClipObjectCount];\n    uniform vec4 uClipObjectRotation[dClipObjectCount];\n    uniform vec3 uClipObjectScale[dClipObjectCount];\n#endif\n#include common_clip\n\n#include read_from_texture\n#include texture3d_from_1d_trilinear\n#include texture3d_from_2d_nearest\n#include texture3d_from_2d_linear\n\nuniform mat4 uProjection, uTransform, uModelView, uModel, uView;\nuniform vec3 uCameraDir;\n\nuniform sampler2D tDepth;\nuniform vec2 uDrawingBufferSize;\n\nvarying vec3 vOrigPos;\nvarying float vInstance;\nvarying vec4 vBoundingSphere;\nvarying mat4 vTransform;\n\nuniform mat4 uInvView;\nuniform vec3 uGridDim;\nuniform vec3 uBboxSize;\nuniform sampler2D tTransferTex;\nuniform float uTransferScale;\nuniform float uStepScale;\nuniform float uJumpLength;\n\nuniform int uObjectId;\nuniform int uVertexCount;\nuniform int uInstanceCount;\nuniform int uGroupCount;\n\n#if defined(dColorMarker)\n    uniform vec3 uHighlightColor;\n    uniform vec3 uSelectColor;\n    uniform vec3 uDimColor;\n    uniform float uHighlightStrength;\n    uniform float uSelectStrength;\n    uniform float uDimStrength;\n    uniform int uMarkerPriority;\n    uniform float uMarkerAverage;\n\n    uniform float uMarker;\n    uniform vec2 uMarkerTexDim;\n    uniform sampler2D tMarker;\n#endif\n\nuniform float uMetalness;\nuniform float uRoughness;\n\nuniform bool uFog;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\n\nuniform float uAlpha;\nuniform bool uTransparentBackground;\nuniform float uXrayEdgeFalloff;\nuniform float uExposure;\n\nuniform int uRenderMask;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uIsOrtho;\n\nuniform vec3 uCellDim;\nuniform vec3 uCameraPosition;\nuniform mat4 uCartnToUnit;\n\n#if __VERSION__ != 100\n    // for webgl1 this is given as a 'define'\n    uniform int uMaxSteps;\n#endif\n\n#if defined(dGridTexType_2d)\n    precision highp sampler2D;\n    uniform sampler2D tGridTex;\n    uniform vec3 uGridTexDim;\n#elif defined(dGridTexType_3d)\n    precision highp sampler3D;\n    uniform sampler3D tGridTex;\n#endif\n\n#if defined(dColorType_uniform)\n    uniform vec3 uColor;\n#elif defined(dColorType_texture)\n    uniform vec2 uColorTexDim;\n    uniform sampler2D tColor;\n#endif\n\n#ifdef dOverpaint\n    #if defined(dOverpaintType_groupInstance) || defined(dOverpaintType_vertexInstance)\n        uniform vec2 uOverpaintTexDim;\n        uniform sampler2D tOverpaint;\n    #endif\n#endif\n\n#ifdef dUsePalette\n    uniform sampler2D tPalette;\n#endif\n\n#if defined(dGridTexType_2d)\n    vec4 textureVal(vec3 pos) {\n        return texture3dFrom2dLinear(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texture3dFrom2dNearest(tGridTex, pos + (vec3(0.5, 0.5, 0.0) / uGridDim), uGridDim, uGridTexDim.xy);\n    }\n#elif defined(dGridTexType_3d)\n    vec4 textureVal(vec3 pos) {\n        return texture(tGridTex, pos + (vec3(0.5) / uGridDim));\n    }\n    vec4 textureGroup(vec3 pos) {\n        return texelFetch(tGridTex, ivec3(pos * uGridDim), 0);\n    }\n#endif\n\nfloat calcDepth(const in vec3 pos) {\n    vec2 clipZW = pos.z * uProjection[2].zw + uProjection[3].zw;\n    return 0.5 + 0.5 * clipZW.x / clipZW.y;\n}\n\nfloat transferFunction(float value) {\n    return texture2D(tTransferTex, vec2(value, 0.0)).a;\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nconst float gradOffset = 0.5;\n\nvec3 v3m4(vec3 p, mat4 m) {\n    return (m * vec4(p, 1.0)).xyz;\n}\n\nfloat preFogAlphaBlended = 0.0;\n\nvec4 raymarch(vec3 startLoc, vec3 step, vec3 rayDir) {\n    mat3 normalMatrix = transpose3(inverse3(mat3(uModelView * vTransform)));\n    mat4 cartnToUnit = uCartnToUnit * inverse4(vTransform);\n    #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n        mat4 modelTransform = uModel * vTransform * uTransform;\n    #endif\n    mat4 modelViewTransform = uModelView * vTransform * uTransform;\n\n    vec3 scaleVol = vec3(1.0) / uGridDim;\n    vec3 pos = startLoc;\n    vec4 cell;\n    float prevValue = -1.0;\n    float value = 0.0;\n    vec4 src = vec4(0.0);\n    vec4 dst = vec4(0.0);\n    float fragmentDepth;\n\n    vec3 posMin = vec3(0.0);\n    vec3 posMax = vec3(1.0) - vec3(1.0) / uGridDim;\n\n    vec3 unitPos;\n\n    vec3 nextPos;\n    float nextValue;\n\n    vec4 material;\n    vec4 overpaint;\n    float metalness = uMetalness;\n    float roughness = uRoughness;\n\n    vec3 gradient = vec3(1.0);\n    vec3 dx = vec3(gradOffset * scaleVol.x, 0.0, 0.0);\n    vec3 dy = vec3(0.0, gradOffset * scaleVol.y, 0.0);\n    vec3 dz = vec3(0.0, 0.0, gradOffset * scaleVol.z);\n\n    float maxDist = min(vBoundingSphere.w * 2.0, uFar - uNear);\n    float maxDistSq = maxDist * maxDist;\n\n    for (int i = 0; i < uMaxSteps; ++i) {\n        // break when beyond bounding-sphere or far-plane\n        vec3 distVec = startLoc - pos;\n        if (dot(distVec, distVec) > maxDistSq) break;\n\n        unitPos = v3m4(pos, cartnToUnit);\n\n        // continue when outside of grid\n        if (unitPos.x > posMax.x || unitPos.y > posMax.y || unitPos.z > posMax.z ||\n            unitPos.x < posMin.x || unitPos.y < posMin.y || unitPos.z < posMin.z\n        ) {\n            prevValue = value;\n            pos += step;\n            continue;\n        }\n\n        cell = textureVal(unitPos);\n        value = cell.a; // current voxel value\n\n        if (uJumpLength > 0.0 && value < 0.01) {\n            nextPos = pos + rayDir * uJumpLength;\n            nextValue = textureVal(v3m4(nextPos, cartnToUnit)).a;\n            if (nextValue < 0.01) {\n                prevValue = nextValue;\n                pos = nextPos;\n                continue;\n            }\n        }\n\n        vec4 mvPosition = modelViewTransform * vec4(unitPos * uGridDim, 1.0);\n        if (calcDepth(mvPosition.xyz) > getDepth(gl_FragCoord.xy / uDrawingBufferSize))\n            break;\n\n        #if defined(dClipVariant_pixel) && dClipObjectCount != 0\n            vec3 vModelPosition = v3m4(unitPos * uGridDim, modelTransform);\n            if (clipTest(vec4(vModelPosition, 0.0))) {\n                prevValue = value;\n                pos += step;\n                continue;\n            }\n        #endif\n\n        vec3 vViewPosition = mvPosition.xyz;\n        material.a = transferFunction(value);\n\n        #ifdef dPackedGroup\n            float group = unpackRGBToInt(textureGroup(floor(unitPos * uGridDim + 0.5) / uGridDim).rgb);\n        #else\n            vec3 g = floor(unitPos * uGridDim + 0.5);\n            // note that we swap x and z because the texture is flipped around y\n            #if defined(dAxisOrder_012)\n                float group = g.z + g.y * uGridDim.z + g.x * uGridDim.z * uGridDim.y; // 210\n            #elif defined(dAxisOrder_021)\n                float group = g.y + g.z * uGridDim.y + g.x * uGridDim.y * uGridDim.z; // 120\n            #elif defined(dAxisOrder_102)\n                float group = g.z + g.x * uGridDim.z + g.y * uGridDim.z * uGridDim.x; // 201\n            #elif defined(dAxisOrder_120)\n                float group = g.x + g.z * uGridDim.x + g.y * uGridDim.x * uGridDim.z; // 021\n            #elif defined(dAxisOrder_201)\n                float group = g.y + g.x * uGridDim.y + g.z * uGridDim.y * uGridDim.x; // 102\n            #elif defined(dAxisOrder_210)\n                float group = g.x + g.y * uGridDim.x + g.z * uGridDim.x * uGridDim.y; // 012\n            #endif\n        #endif\n\n        #if defined(dColorType_direct) && defined(dUsePalette)\n            material.rgb = texture2D(tPalette, vec2(value, 0.0)).rgb;\n        #elif defined(dColorType_uniform)\n            material.rgb = uColor;\n        #elif defined(dColorType_instance)\n            material.rgb = readFromTexture(tColor, vInstance, uColorTexDim).rgb;\n        #elif defined(dColorType_group)\n            material.rgb = readFromTexture(tColor, group, uColorTexDim).rgb;\n        #elif defined(dColorType_groupInstance)\n            material.rgb = readFromTexture(tColor, vInstance * float(uGroupCount) + group, uColorTexDim).rgb;\n        #elif defined(dColorType_vertex)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, 0.0).rgb;\n        #elif defined(dColorType_vertexInstance)\n            material.rgb = texture3dFrom1dTrilinear(tColor, unitPos, uGridDim, uColorTexDim, vInstance * float(uVertexCount)).rgb;\n        #endif\n\n        #ifdef dOverpaint\n            #if defined(dOverpaintType_groupInstance)\n                overpaint = readFromTexture(tOverpaint, vInstance * float(uGroupCount) + group, uOverpaintTexDim);\n            #elif defined(dOverpaintType_vertexInstance)\n                overpaint = texture3dFrom1dTrilinear(tOverpaint, unitPos, uGridDim, uOverpaintTexDim, vInstance * float(uVertexCount));\n            #endif\n\n            material.rgb = mix(material.rgb, overpaint.rgb, overpaint.a);\n        #endif\n\n        #ifdef dIgnoreLight\n            gl_FragColor.rgb = material.rgb;\n        #else\n            if (material.a >= 0.01) {\n                #ifdef dPackedGroup\n                    // compute gradient by central differences\n                    gradient.x = textureVal(unitPos - dx).a - textureVal(unitPos + dx).a;\n                    gradient.y = textureVal(unitPos - dy).a - textureVal(unitPos + dy).a;\n                    gradient.z = textureVal(unitPos - dz).a - textureVal(unitPos + dz).a;\n                #else\n                    gradient = cell.xyz * 2.0 - 1.0;\n                #endif\n                vec3 normal = -normalize(normalMatrix * normalize(gradient));\n                #include apply_light_color\n            } else {\n                gl_FragColor.rgb = material.rgb;\n            }\n        #endif\n\n        gl_FragColor.a = material.a * uAlpha * uTransferScale;\n\n        #if defined(dColorMarker)\n            float marker = uMarker;\n            if (uMarker == -1.0) {\n                marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n                marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n            }\n        #endif\n        #include apply_marker_color\n\n        preFogAlphaBlended = (1.0 - preFogAlphaBlended) * gl_FragColor.a + preFogAlphaBlended;\n        fragmentDepth = calcDepth(mvPosition.xyz);\n        #include apply_fog\n\n        src = gl_FragColor;\n\n        if (!uTransparentBackground) {\n            // done in 'apply_fog' otherwise\n            src.rgb *= src.a;\n        }\n        dst = (1.0 - dst.a) * src + dst; // standard blending\n\n        // break if the color is opaque enough\n        if (dst.a > 0.95)\n            break;\n\n        pos += step;\n    }\n\n    return dst;\n}\n\n// TODO: support float texture for higher precision values???\n// TODO: support clipping exclusion texture support\n\nvoid main() {\n    if (gl_FrontFacing)\n        discard;\n\n    vec3 rayDir = mix(normalize(vOrigPos - uCameraPosition), uCameraDir, uIsOrtho);\n    vec3 step = rayDir * uStepScale;\n\n    float boundingSphereNear = distance(vBoundingSphere.xyz, uCameraPosition) - vBoundingSphere.w;\n    float d = max(uNear, boundingSphereNear) - mix(0.0, distance(vOrigPos, uCameraPosition), uIsOrtho);\n    vec3 start = mix(uCameraPosition, vOrigPos, uIsOrtho) + (d * rayDir);\n    gl_FragColor = raymarch(start, step, rayDir);\n\n    float fragmentDepth = calcDepth((uModelView * vec4(start, 1.0)).xyz);\n    float preFogAlpha = clamp(preFogAlphaBlended, 0.0, 1.0);\n    #include wboit_write\n}\n",{fragDepth:"optional",drawBuffers:"optional"},{},DD),z$e=Wi("image","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include common_vert_params\n\nattribute vec3 aPosition;\nattribute vec2 aUv;\nattribute mat4 aTransform;\nattribute float aInstance;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\nvoid main() {\n    #include assign_position\n\n    vUv = aUv;\n    vInstance = aInstance;\n}\n","\nprecision highp float;\nprecision highp int;\n\n#include common\n#include read_from_texture\n#include common_frag_params\n#include common_clip\n\nuniform vec2 uImageTexDim;\nuniform sampler2D tImageTex;\nuniform sampler2D tGroupTex;\n\nuniform vec2 uMarkerTexDim;\nuniform sampler2D tMarker;\n\nvarying vec2 vUv;\nvarying float vInstance;\n\n#if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell) || defined(dInterpolation_bspline)\n    #define dInterpolation_cubic\n#endif\n\n#if defined(dInterpolation_cubic)\n    #if defined(dInterpolation_catmulrom) || defined(dInterpolation_mitchell)\n        #if defined(dInterpolation_catmulrom)\n            const float B = 0.0;\n            const float C = 0.5;\n        #elif defined(dInterpolation_mitchell)\n            const float B = 0.333;\n            const float C = 0.333;\n        #endif\n\n        float cubicFilter(float x){\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f < 1.0) {\n                return ((12.0 - 9.0 * B - 6.0 * C) * (f * f * f) +\n                    (-18.0 + 12.0 * B + 6.0 * C) * (f * f) +\n                    (6.0 - 2.0 * B)) / 6.0;\n            }else if (f >= 1.0 && f < 2.0){\n                return ((-B - 6.0 * C) * ( f * f * f)\n                    + (6.0 * B + 30.0 * C) * (f * f) +\n                    (-(12.0 * B) - 48.0 * C) * f +\n                    8.0 * B + 24.0 * C) / 6.0;\n            }else{\n                return 0.0;\n            }\n        }\n    #elif defined(dInterpolation_bspline)\n        float cubicFilter(float x) {\n            float f = x;\n            if (f < 0.0) {\n                f = -f;\n            }\n            if (f >= 0.0 && f <= 1.0){\n                return (2.0 / 3.0) + (0.5) * (f * f * f) - (f * f);\n            } else if (f > 1.0 && f <= 2.0) {\n                return 1.0 / 6.0 * pow((2.0 - f), 3.0);\n            }\n            return 1.0;\n        }\n    #endif\n\n    vec4 biCubic(sampler2D tex, vec2 texCoord) {\n        vec2 texelSize = 1.0 / uImageTexDim;\n        texCoord -= texelSize / 2.0;\n        vec4 nSum = vec4(0.0);\n        float nDenom = 0.0;\n        vec2 cell = fract(texCoord * uImageTexDim);\n        for (float m = -1.0; m <= 2.0; ++m) {\n            for (float n = -1.0; n <= 2.0; ++n) {\n                vec4 vecData = texture2D(tex, texCoord + texelSize * vec2(m, n));\n                float c = cubicFilter(m - cell.x) * cubicFilter(-n + cell.y);\n                nSum += vecData * c;\n                nDenom += c;\n            }\n        }\n        return nSum / nDenom;\n    }\n#endif\n\nvoid main() {\n    #include fade_lod\n    #include clip_pixel\n\n    #if defined(dInterpolation_cubic)\n        vec4 imageData = biCubic(tImageTex, vUv);\n    #else\n        vec4 imageData = texture2D(tImageTex, vUv);\n    #endif\n    imageData.a = clamp(imageData.a, 0.0, 1.0);\n    if (imageData.a > 0.9) imageData.a = 1.0;\n\n    float fragmentDepth = gl_FragCoord.z;\n\n    #if defined(dRenderVariant_pick)\n        if (imageData.a < 0.3)\n            discard;\n        #ifdef requiredDrawBuffers\n            gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            gl_FragData[1] = vec4(packIntToRGB(vInstance), 1.0);\n            gl_FragData[2] = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            gl_FragData[3] = packDepthToRGBA(gl_FragCoord.z);\n        #else\n            gl_FragColor = vColor;\n            if (uPickType == 1) {\n                gl_FragColor = vec4(packIntToRGB(float(uObjectId)), 1.0);\n            } else if (uPickType == 2) {\n                gl_FragColor = vec4(packIntToRGB(vInstance), 1.0);\n            } else {\n                gl_FragColor = vec4(texture2D(tGroupTex, vUv).rgb, 1.0);\n            }\n        #endif\n    #elif defined(dRenderVariant_depth)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n    #elif defined(dRenderVariant_marking)\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n        if (uMarkingType == 1) {\n            if (marker > 0.0 || imageData.a < 0.05)\n                discard;\n            gl_FragColor = packDepthToRGBA(gl_FragCoord.z);\n        } else {\n            if (marker == 0.0 || imageData.a < 0.05)\n                discard;\n            float depthTest = 1.0;\n            if (uMarkingDepthTest) {\n                depthTest = (fragmentDepth >= getDepthPacked(gl_FragCoord.xy / uDrawingBufferSize)) ? 1.0 : 0.0;\n            }\n            bool isHighlight = intMod(marker, 2.0) > 0.1;\n            gl_FragColor = vec4(0.0, depthTest, isHighlight ? 1.0 : 0.0, 1.0);\n        }\n    #elif defined(dRenderVariant_color)\n        if (imageData.a < 0.05)\n            discard;\n        gl_FragColor = imageData;\n        gl_FragColor.a *= uAlpha;\n\n        float marker = uMarker;\n        if (uMarker == -1.0) {\n            float group = unpackRGBToInt(texture2D(tGroupTex, vUv).rgb);\n            marker = readFromTexture(tMarker, vInstance * float(uGroupCount) + group, uMarkerTexDim).a;\n            marker = floor(marker * 255.0 + 0.5); // rounding required to work on some cards on win\n        }\n\n        #include apply_marker_color\n        #include apply_fog\n        #include wboit_write\n        #include dpoit_write\n    #endif\n}\n",{drawBuffers:"optional"},{},fN);function Xue(e,t){var n;if(void 0===e)return"";const r=(null===(n=e.dRenderVariant)||void 0===n?void 0:n.ref.value)||"",i=[];for(const o in e){if(t?.(o,r,e))continue;const a=e[o].ref.value;void 0!==a&&("string"==typeof a?i.push(`#define ${o}_${a}`):"number"==typeof a?i.push(`#define ${o} ${a}`):"boolean"==typeof a?a&&i.push(`#define ${o}`):Hi())}return i.join("\n")+"\n"}const G$e="\n#define attribute in\n#define varying out\n#define texture2D texture\n",q$e="\n#define varying in\n#define texture2D texture\n#define textureCube texture\n#define texture2DLodEXT textureLod\n#define textureCubeLodEXT textureLod\n\n#define gl_FragColor out_FragData0\n#define gl_FragDepthEXT gl_FragDepth\n\n#define depthTextureSupport\n";function K$e(e,t){switch(t){case"b":case"b[]":return e.BOOL;case"f":case"f[]":return e.FLOAT;case"i":case"i[]":return e.INT;case"v2":case"v2[]":return e.FLOAT_VEC2;case"v3":case"v3[]":return e.FLOAT_VEC3;case"v4":case"v4[]":return e.FLOAT_VEC4;case"iv2":case"iv2[]":return e.INT_VEC2;case"iv3":case"iv3[]":return e.INT_VEC3;case"iv4":case"iv4[]":return e.INT_VEC4;case"m3":case"m3[]":return e.FLOAT_MAT3;case"m4":case"m4[]":return e.FLOAT_MAT4;default:console.error(`unknown uniform kind '${t}'`)}}function Q$e(e,t,n){e.uniform1f(t,n)}function J$e(e,t,n){e.uniform1fv(t,n)}function eYe(e,t,n){e.uniform1i(t,n)}function tYe(e,t,n){e.uniform1iv(t,n)}function nYe(e,t,n){e.uniform2fv(t,n)}function rYe(e,t,n){e.uniform3fv(t,n)}function iYe(e,t,n){e.uniform4fv(t,n)}function oYe(e,t,n){e.uniform2iv(t,n)}function sYe(e,t,n){e.uniform3iv(t,n)}function aYe(e,t,n){e.uniform4iv(t,n)}function lYe(e,t,n){e.uniformMatrix3fv(t,!1,n)}function cYe(e,t,n){e.uniformMatrix4fv(t,!1,n)}function Kue(e){switch(e){case"f":return Q$e;case"f[]":return J$e;case"i":case"t":case"b":return eYe;case"i[]":case"t[]":case"b[]":return tYe;case"v2":case"v2[]":return nYe;case"v3":case"v3[]":return rYe;case"v4":case"v4[]":return iYe;case"iv2":case"iv2[]":return oYe;case"iv3":case"iv3[]":return sYe;case"iv4":case"iv4[]":return aYe;case"m3":case"m3[]":return lYe;case"m4":case"m4[]":return cYe}}const fYe=Kc();function x9(e){const t=e.createBuffer();if(null===t)throw new Error("Could not create WebGL buffer");return t}function Zue(e,t,n,r){let i=x9(e);const o=function pYe(e,t){switch(t){case"static":return e.STATIC_DRAW;case"dynamic":return e.DYNAMIC_DRAW;case"stream":return e.STREAM_DRAW}}(e,n),s=function mYe(e,t){switch(t){case"attribute":return e.ARRAY_BUFFER;case"elements":return e.ELEMENT_ARRAY_BUFFER;case"uniform":if(Cn(e))return e.UNIFORM_BUFFER;throw new Error("WebGL2 is required for uniform buffers")}}(e,r),a=function hYe(e,t){return t instanceof Uint8Array?e.UNSIGNED_BYTE:t instanceof Int8Array?e.BYTE:t instanceof Uint16Array?e.UNSIGNED_SHORT:t instanceof Int16Array?e.SHORT:t instanceof Uint32Array?e.UNSIGNED_INT:t instanceof Int32Array?e.INT:t instanceof Float32Array?e.FLOAT:void Hi()}(e,t),l=t.BYTES_PER_ELEMENT,c=t.length;function u(f){e.bindBuffer(s,i),e.bufferData(s,f,o)}u(t);let d=!1;return{id:fYe(),_usageHint:o,_bufferType:s,_dataType:a,_bpe:l,length:c,getBuffer:()=>i,updateData:u,updateSubData:(f,p,m)=>{e.bindBuffer(s,i),m-p===f.length?e.bufferSubData(s,0,f):e.bufferSubData(s,p*l,f.subarray(p,p+m))},reset:()=>{i=x9(e),u(t)},destroy:()=>{d||(e.deleteBuffer(i),d=!0)}}}function gYe(e,t,n){if("float32"===t)switch(n){case 1:return e.FLOAT;case 2:return e.FLOAT_VEC2;case 3:return e.FLOAT_VEC3;case 4:return e.FLOAT_VEC4;case 16:return e.FLOAT_MAT4}Hi()}const xYe=Kc();function _9(e){const t=e.createProgram();if(null===t)throw new Error("Could not create WebGL program");return t}function AYe(e,t,n,r,i){const{defineValues:o,shaderCode:s,schema:a}=i;let l=_9(e);const c=xYe(),u=function X$e(e,t,n,r){const i=Xue(n,r.ignoreDefine),o=Xue(n,r.ignoreDefine),s=Cn(e)?function W$e(e,t){const n=["#version 300 es"];if(t.drawBuffers&&e.drawBuffers&&n.push("#define requiredDrawBuffers"),t.multiDraw)if(e.multiDraw)n.push("#extension GL_ANGLE_multi_draw : require"),n.push("#define enabledMultiDraw");else if("required"===t.multiDraw)throw new Error("required 'GL_ANGLE_multi_draw' extension not available");if(t.clipCullDistance)if(e.clipCullDistance)n.push("#extension GL_ANGLE_clip_cull_distance : enable"),n.push("#define enabledClipCullDistance");else if("required"===t.clipCullDistance)throw new Error("required 'GL_ANGLE_clip_cull_distance' extension not available");if(t.conservativeDepth)if(e.conservativeDepth)n.push("#extension GL_EXT_conservative_depth : enable"),n.push("#define enabledConservativeDepth");else if("required"===t.conservativeDepth)throw new Error("required 'GL_EXT_conservative_depth' extension not available");return e.noNonInstancedActiveAttribs&&n.push("#define noNonInstancedActiveAttribs"),n.push(G$e),n.join("\n")+"\n"}(t,r.extensions):function V$e(e,t){const n=[];if(t.drawBuffers)if(e.drawBuffers)n.push("#define requiredDrawBuffers");else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");if(t.multiDraw)if(e.multiDraw)n.push("#extension GL_ANGLE_multi_draw : require"),n.push("#define enabledMultiDraw");else if("required"===t.multiDraw)throw new Error("required 'GL_ANGLE_multi_draw' extension not available");return n.join("\n")+"\n"}(t,r.extensions),a=Cn(e)?function $$e(e,t,n,r){const i=["#version 300 es",`layout(location = 0) out highp ${r[0]||"vec4"} out_FragData0;`];if(n.fragDepth&&t.fragDepth&&i.push("#define enabledFragDepth"),n.drawBuffers&&t.drawBuffers){i.push("#define requiredDrawBuffers");for(let s=1,a=e.getParameter(e.MAX_DRAW_BUFFERS);s<a;++s)i.push(`layout(location = ${s}) out highp ${r[s]||"vec4"} out_FragData${s};`)}return n.shaderTextureLod&&t.shaderTextureLod&&i.push("#define enabledShaderTextureLod"),i.push(q$e),i.join("\n")+"\n"}(e,t,r.extensions,r.outTypes):function H$e(e,t){const n=["#extension GL_OES_standard_derivatives : enable"];if(t.fragDepth)if(e.fragDepth)n.push("#extension GL_EXT_frag_depth : enable"),n.push("#define enabledFragDepth");else if("required"===t.fragDepth)throw new Error("required 'GL_EXT_frag_depth' extension not available");if(t.drawBuffers)if(e.drawBuffers)n.push("#extension GL_EXT_draw_buffers : require"),n.push("#define requiredDrawBuffers"),n.push("#define gl_FragColor gl_FragData[0]");else if("required"===t.drawBuffers)throw new Error("required 'GL_EXT_draw_buffers' extension not available");if(t.shaderTextureLod)if(e.shaderTextureLod)n.push("#extension GL_EXT_shader_texture_lod : enable"),n.push("#define enabledShaderTextureLod");else if("required"===t.shaderTextureLod)throw new Error("required 'GL_EXT_shader_texture_lod' extension not available");return e.depthTexture&&n.push("#define depthTextureSupport"),n.join("\n")+"\n"}(t,r.extensions),l=Cn(e)?function Y$e(e){return e.replace(/gl_FragData\[([0-9]+)\]/g,"out_FragData$1")}(r.frag):r.frag;return{id:que(),name:r.name,vert:`${s}${i}${$ue(r.vert,n)}`,frag:`${a}${o}${$ue(l,n)}`,extensions:r.extensions,outTypes:r.outTypes}}(e,n,o,s),d=r("vert",u.vert),f=r("frag",u.frag);let p,m;function h(){d.attach(l),f.attach(l),e.linkProgram(l),$n&&function wYe(e,t){if(!e.getProgramParameter(t,e.LINK_STATUS))throw new Error(`Could not compile WebGL program. \n\n${e.getProgramInfoLog(t)}`)}(e,l),p=function _Ye(e,t,n){const r={};return Object.keys(n).forEach(i=>{const o=n[i];if("attribute"===o.type){const s=e.getAttribLocation(t,i);r[i]=s}else if("uniform"===o.type){let s=e.getUniformLocation(t,i);null===s&&function Z$e(e){return e.endsWith("[]")}(o.kind)&&(s=e.getUniformLocation(t,i+"[0]")),r[i]=s}else if("texture"===o.type){const s=e.getUniformLocation(t,i);r[i]=s}}),r}(e,l,a),m=function uYe(e){const t={};return Object.keys(e).forEach(n=>{const r=e[n];"uniform"===r.type?t[n]=Kue(r.kind):"texture"===r.type&&(t[n]=Kue("t"))}),t}(a),$n&&(function SYe(e,t,n){const r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;++i){const o=e.getActiveAttrib(t,i);if(o){const{name:s,type:a}=o;if(s.startsWith("__activeAttribute")||"gl_InstanceID"===s||"gl_VertexID"===s||"gl_DrawID"===s)continue;const l=n[s];if(void 0===l)throw new Error(`missing 'uniform' or 'texture' with name '${s}' in schema`);if("attribute"!==l.type)throw new Error(`'${s}' must be of type 'attribute' but is '${l.type}'`);const c=gYe(e,l.kind,l.itemSize);if(c!==a)throw new Error(`unexpected attribute type '${c}' for ${s}, expected '${a}'`)}}}(e,l,a),function CYe(e,t,n){const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i);if(o){const{name:s,type:a}=o;if(s.startsWith("__activeUniform")||"gl_InstanceID"===s||"gl_VertexID"===s||"gl_DrawID"===s)continue;const c=n[s.replace(/[[0-9]+\]$/,"")];if(void 0===c)throw new Error(`missing 'uniform' or 'texture' with name '${s}' in schema`);if("uniform"===c.type){if(K$e(e,c.kind)!==a)throw new Error(`unexpected uniform type for ${s}`)}else{if("texture"!==c.type)throw new Error(`'${s}' must be of type 'uniform' or 'texture' but is '${c.type}'`);if("image-float32"===c.kind||"image-uint8"===c.kind){if(a!==e.SAMPLER_2D)throw new Error(`unexpected sampler type for '${s}'`)}else if("volume-float32"===c.kind||"volume-uint8"===c.kind){if(!Cn(e))throw new Error("WebGL2 is required to use SAMPLER_3D");if(a!==e.SAMPLER_3D)throw new Error(`unexpected sampler type for '${s}'`)}}}}}(e,l,a))}h();let g=!1;return{id:c,use:()=>{t.currentProgramId=c,e.useProgram(l)},setUniforms:y=>{for(let v=0,x=y.length;v<x;++v){const[_,w]=y[v];if(w){const A=p[_];null!==A&&m[_](e,A,w.ref.value)}}},uniform:(y,v)=>{const x=p[y];null!==x&&m[y](e,x,v)},bindAttributes:y=>{t.clearVertexAttribsState();for(let v=0,x=y.length;v<x;++v){const[_,w]=y[v],A=p[_];-1!==A&&w.bind(A)}t.disableUnusedVertexAttribs()},offsetAttributes:(y,v)=>{for(let x=0,_=y.length;x<_;++x){const[w,A]=y[x],M=p[w];-1!==M&&A.changeOffset(M,v)}},bindTextures:(y,v)=>{for(let x=0,_=y.length;x<_;++x){const[w,A]=y[x],M=p[w];null!=M&&(A.bind(x+v),m[w](e,M,x+v))}},reset:()=>{l=_9(e),h()},destroy:()=>{g||(d.destroy(),f.destroy(),e.deleteProgram(l),g=!0)}}}const IYe=Kc();function pN(e,t){const{type:n,source:r}=t,i=e.createShader("vert"===n?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(null===i)throw new Error(`Error creating ${n} shader`);if(e.shaderSource(i,r),e.compileShader(i),$n&&!1===e.getShaderParameter(i,e.COMPILE_STATUS))throw console.warn(`'${n}' shader info log '${e.getShaderInfoLog(i)}'\n${function EYe(e){const t=e.split("\n");for(let n=0;n<t.length;++n)t[n]=n+1+": "+t[n];return t.join("\n")}(r)}`),new Error(`Error compiling ${n} shader`);return i}function Que(e,t,n){const r=new Map;return{get:i=>{const o=e(i);let s=r.get(o);return s||(s=function DYe(e,t=0){return{value:e,usageCount:t}}(t(i)),r.set(o,s)),s.usageCount+=1,function PYe(e){return{free:()=>{e.usageCount-=1},value:e.value}}(s)},clear:()=>{r.forEach((i,o)=>{i.usageCount<=0&&(i.usageCount<0&&console.warn("Reference usageCount below zero."),n(i.value),r.delete(o))})},get count(){return r.size},dispose:()=>{r.forEach(i=>n(i.value)),r.clear()}}}const kYe=Kc();function Jue(e){const t=e.createRenderbuffer();if(null===t)throw new Error("Could not create WebGL renderbuffer");return t}const FYe=Kc();function ede(e){const{vertexArrayObject:t}=e;if(!t)throw new Error("VertexArrayObject not supported");const n=t.createVertexArray();if(!n)throw new Error("Could not create WebGL vertex array");return n}function tde(e){const{vertexArrayObject:t}=e;if(null===t)throw new Error("VertexArrayObject not supported");return t}function nde(e){return{...e.value,destroy:()=>{e.free()}}}function LYe(e,t,n,r){const i={attribute:new Set,elements:new Set,framebuffer:new Set,program:new Set,renderbuffer:new Set,shader:new Set,texture:new Set,cubeTexture:new Set,vertexArray:new Set};function o(c,u){return i[c].add(u),n.resourceCounts[c]+=1,{...u,destroy:()=>{u.destroy(),i[c].delete(u),n.resourceCounts[c]-=1}}}const s=Que(c=>JSON.stringify(c),c=>o("shader",function TYe(e,t){let n=pN(e,t);return{id:IYe(),attach:r=>{e.attachShader(r,n)},reset:()=>{n=pN(e,t)},destroy:()=>{e.deleteShader(n)}}}(e,c)),c=>{c.destroy()});function a(c,u){return nde(s.get({type:c,source:u}))}const l=Que(c=>{var u;const d=[c.shaderCode.id],f=(null===(u=c.defineValues.dRenderVariant)||void 0===u?void 0:u.ref.value)||"";return Object.keys(c.defineValues).forEach(p=>{var m,h;null!==(h=(m=c.shaderCode).ignoreDefine)&&void 0!==h&&h.call(m,p,f,c.defineValues)||d.push(RU(p),function BYe(e){return"boolean"==typeof e?e?1:0:"number"==typeof e?1e4*e:RU(e)}(c.defineValues[p].ref.value))}),Zc(d).toString()},c=>o("program",AYe(e,t,r,a,c)),c=>{c.destroy()});return{attribute:(c,u,d,f)=>o("attribute",function yYe(e,t,n,r,i,o,s="static"){const{instancedArrays:a}=n,l=Zue(e,r,s,"attribute"),{_bufferType:c,_dataType:u,_bpe:d}=l;return{...l,divisor:o,bind:f=>{if(e.bindBuffer(c,l.getBuffer()),16===i)for(let p=0;p<4;++p)t.enableVertexAttrib(f+p),e.vertexAttribPointer(f+p,4,u,!1,16*d,4*p*d),a.vertexAttribDivisor(f+p,o);else t.enableVertexAttrib(f),e.vertexAttribPointer(f,i,u,!1,0,0),a.vertexAttribDivisor(f,o)},changeOffset:(f,p)=>{const m=p*d*i;if(e.bindBuffer(c,l.getBuffer()),16===i)for(let h=0;h<4;++h)e.vertexAttribPointer(f+h,4,u,!1,16*d,4*h*d+m);else e.vertexAttribPointer(f,i,u,!1,0,m)}}}(e,t,r,c,u,d,f)),elements:(c,u)=>o("elements",function vYe(e,t,n="static"){const r=Zue(e,t,n,"elements");return{...r,bind:()=>{e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.getBuffer())}}}(e,c,u)),framebuffer:()=>o("framebuffer",function TWe(e){let t=Hue(e),n=!1;return{id:Vue(),bind:()=>e.bindFramebuffer(e.FRAMEBUFFER,t),reset:()=>{t=Hue(e)},destroy:()=>{n||(e.deleteFramebuffer(t),n=!0)}}}(e)),program:(c,u,d)=>nde(l.get({defineValues:c,shaderCode:u,schema:d})),renderbuffer:(c,u,d,f)=>o("renderbuffer",function NYe(e,t,n,r,i){let o=Jue(e);const s=()=>e.bindRenderbuffer(e.RENDERBUFFER,o),a=function MYe(e,t){switch(t){case"depth16":return e.DEPTH_COMPONENT16;case"stencil8":return e.STENCIL_INDEX8;case"rgba4":return e.RGBA4;case"depth-stencil":return e.DEPTH_STENCIL;case"depth24":if(Cn(e))return e.DEPTH_COMPONENT24;throw new Error("WebGL2 needed for `depth24` renderbuffer format");case"depth32f":if(Cn(e))return e.DEPTH_COMPONENT32F;throw new Error("WebGL2 needed for `depth32f` renderbuffer format");case"depth24-stencil8":if(Cn(e))return e.DEPTH24_STENCIL8;throw new Error("WebGL2 needed for `depth24-stencil8` renderbuffer format");case"depth32f-stencil8":if(Cn(e))return e.DEPTH32F_STENCIL8;throw new Error("WebGL2 needed for `depth32f-stencil8` renderbuffer format")}}(e,t),l=function RYe(e,t){switch(t){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"depth-stencil":return e.DEPTH_STENCIL_ATTACHMENT;case"color0":return e.COLOR_ATTACHMENT0}}(e,n);function c(){s(),e.renderbufferStorage(e.RENDERBUFFER,a,r,i)}c();let u=!1;return{id:kYe(),bind:s,attachFramebuffer:d=>{d.bind(),s(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,o),$n&&dN(e)},detachFramebuffer:d=>{d.bind(),s(),e.framebufferRenderbuffer(e.FRAMEBUFFER,l,e.RENDERBUFFER,null),$n&&dN(e)},setSize:(d,f)=>{r=d,i=f,c()},reset:()=>{o=Jue(e),c()},destroy:()=>{u||(e.deleteRenderbuffer(o),u=!0)}}}(e,c,u,d,f)),shader:a,texture:(c,u,d,f)=>o("texture",function OXe(e,t,n,r,i,o){const s=C9();let a=vde(e);if(n.endsWith("float32")&&"float"!==i||n.endsWith("float16")&&"fp16"!==i||n.endsWith("uint8")&&"ubyte"!==i||n.endsWith("int32")&&"int"!==i||n.endsWith("depth")&&"ushort"!==i&&"float"!==i)throw new Error(`texture kind '${n}' and type '${i}' are incompatible`);if(!t.depthTexture&&"depth"===r)throw new Error("extension 'WEBGL_depth_texture' needed for 'depth' texture format");const l=function PXe(e,t){switch(t){case"image-uint8":case"image-float32":case"image-float16":case"image-depth":return e.TEXTURE_2D}if(Cn(e))switch(t){case"image-int32":return e.TEXTURE_2D;case"volume-uint8":case"volume-float32":case"volume-float16":return e.TEXTURE_3D}throw new Error(`unknown texture kind '${t}'`)}(e,n),c=gde(e,o),u=hde(e,r,i),d=function kXe(e,t,n){if(Cn(e))switch(t){case"alpha":switch(n){case"ubyte":return e.ALPHA;case"float":return e.R32F;case"fp16":return e.R16F;case"int":return e.R32I}case"rg":switch(n){case"ubyte":return e.RG;case"float":return e.RG32F;case"fp16":return e.RG16F;case"int":return e.RG32I}case"rgb":switch(n){case"ubyte":return e.RGB;case"float":return e.RGB32F;case"fp16":return e.RGB16F;case"int":return e.RGB32I}case"rgba":switch(n){case"ubyte":return e.RGBA;case"float":return e.RGBA32F;case"fp16":return e.RGBA16F;case"int":return e.RGBA32I}case"depth":switch(n){case"ushort":return e.DEPTH_COMPONENT16;case"float":return e.DEPTH_COMPONENT32F}}return hde(e,t,n)}(e,r,i),f=function NXe(e,t,n){switch(n){case"ubyte":return e.UNSIGNED_BYTE;case"ushort":return e.UNSIGNED_SHORT;case"float":return e.FLOAT;case"fp16":if(t.textureHalfFloat)return t.textureHalfFloat.HALF_FLOAT;throw new Error('extension "texture_half_float" unavailable');case"int":if(Cn(e))return e.INT;throw new Error('texture type "int" requires webgl2')}}(e,t,i);function p(){e.bindTexture(l,a),e.texParameteri(l,e.TEXTURE_MAG_FILTER,c),e.texParameteri(l,e.TEXTURE_MIN_FILTER,c),e.texParameteri(l,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(l,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(l,null)}p();let y,m=0,h=0,g=0,v=!1,x=!1;function _(E,D,T){if(0===E||0===D||Cn(e)&&l===e.TEXTURE_3D&&0===T)throw new Error("empty textures are not allowed");if(m!==E||h!==D||g!==(T||0))if(m=E,h=D,g=T||0,e.bindTexture(l,a),l===e.TEXTURE_2D)e.texImage2D(l,0,d,m,h,0,u,f,null);else{if(!Cn(e)||l!==e.TEXTURE_3D||void 0===g)throw new Error("unknown texture target");e.texImage3D(l,0,d,m,h,g,0,u,f,null)}}function w(E,D=!1){if(0===E.width||0===E.height||!yde(E)&&Cn(e)&&bde(0,l,e)&&0===E.depth)throw new Error("empty textures are not allowed");if(e.bindTexture(l,a),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),yde(E))m=E.width,h=E.height,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,d,u,f,E);else if(function FXe(e,t,n){return t===n.TEXTURE_2D}(0,l,e)){const T=E.filter?gde(e,E.filter):c;e.texParameteri(l,e.TEXTURE_MAG_FILTER,T),e.texParameteri(l,e.TEXTURE_MIN_FILTER,T),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!!E.flipY),D?e.texSubImage2D(l,0,0,0,E.width,E.height,u,f,E.array):(m=E.width,h=E.height,e.texImage2D(l,0,d,m,h,0,u,f,E.array))}else{if(!Cn(e)||!bde(0,l,e))throw new Error("unknown texture target");e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),D?e.texSubImage3D(l,0,0,0,0,E.width,E.height,E.depth,u,f,E.array):(m=E.width,h=E.height,g=E.depth,e.texImage3D(l,0,d,m,h,g,0,u,f,E.array))}e.bindTexture(l,null),y=E}function A(){if(l!==e.TEXTURE_2D)throw new Error("mipmap only supported for 2d textures");if(!(Cn(e)||d3(m)&&d3(h)))throw new Error("mipmap unsupported for non-power-of-two textures and webgl1");e.bindTexture(l,a),e.texParameteri(l,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(l),e.bindTexture(l,null),v=!0}return _(1,1,Cn(e)&&l===e.TEXTURE_3D?1:0),{id:s,target:l,format:u,internalFormat:d,type:f,filter:c,getWidth:()=>m,getHeight:()=>h,getDepth:()=>g,getByteCount:()=>mde(r,i,m,h,g),define:_,load:w,mipmap:A,bind:E=>{e.activeTexture(e.TEXTURE0+E),e.bindTexture(l,a)},unbind:E=>{e.activeTexture(e.TEXTURE0+E),e.bindTexture(l,null)},attachFramebuffer:function M(E,D,T){if(E.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,mN(e,t,D),e.TEXTURE_2D,a,0);else{if(!Cn(e)||l!==e.TEXTURE_3D)throw new Error("unknown/unsupported texture target");if(void 0===T)throw new Error("need `layer` to attach 3D texture");e.framebufferTextureLayer(e.FRAMEBUFFER,mN(e,t,D),a,0,T)}},detachFramebuffer:(E,D)=>{if(E.bind(),l===e.TEXTURE_2D)e.framebufferTexture2D(e.FRAMEBUFFER,mN(e,t,D),e.TEXTURE_2D,null,0);else{if(!Cn(e)||l!==e.TEXTURE_3D)throw new Error("unknown texture target");e.framebufferTextureLayer(e.FRAMEBUFFER,mN(e,t,D),null,0,0)}},reset:()=>{a=vde(e),p();const[E,D,T]=[m,h,g];m=0,h=0,g=0,_(E,D,T),y&&w(y),v&&A()},destroy:()=>{x||(e.deleteTexture(a),x=!0)}}}(e,r,c,u,d,f)),cubeTexture:(c,u,d)=>o("cubeTexture",function LXe(e,t,n,r){const i=e.TEXTURE_CUBE_MAP,o=e.LINEAR,s=e.RGBA,a=e.RGBA,l=e.UNSIGNED_BYTE;let c=0;const u=e.createTexture();e.bindTexture(i,u);let d=0;Nu(t,(p,m)=>{if(!p)return;const g=function BXe(e,t){switch(t){case"nx":return e.TEXTURE_CUBE_MAP_NEGATIVE_X;case"ny":return e.TEXTURE_CUBE_MAP_NEGATIVE_Y;case"nz":return e.TEXTURE_CUBE_MAP_NEGATIVE_Z;case"px":return e.TEXTURE_CUBE_MAP_POSITIVE_X;case"py":return e.TEXTURE_CUBE_MAP_POSITIVE_Y;case"pz":return e.TEXTURE_CUBE_MAP_POSITIVE_Z}}(e,m),y=new Image;p instanceof File?y.src=URL.createObjectURL(p):PR(p)?p.then(v=>{y.src=URL.createObjectURL(v)}):y.src=p,y.addEventListener("load",()=>{0===c&&(c=y.width),e.texImage2D(g,0,s,c,c,0,a,l,null),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.NONE),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(i,u),e.texImage2D(g,0,s,a,l,y),d+=1,6===d&&(f||(n?(e.texParameteri(i,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR),e.generateMipmap(i)):e.texParameteri(i,e.TEXTURE_MIN_FILTER,o),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o)),r?.(f))}),y.addEventListener("error",()=>{r?.(!0)})});let f=!1;return{id:C9(),target:i,format:a,internalFormat:s,type:l,filter:o,getWidth:()=>c,getHeight:()=>c,getDepth:()=>0,getByteCount:()=>6*mde("rgba","ubyte",c,c,0)*(n?2:1),define:()=>{},load:()=>{},mipmap:()=>{},bind:p=>{e.activeTexture(e.TEXTURE0+p),e.bindTexture(i,u)},unbind:p=>{e.activeTexture(e.TEXTURE0+p),e.bindTexture(i,null)},attachFramebuffer:()=>{},detachFramebuffer:()=>{},reset:()=>{},destroy:()=>{f||(e.deleteTexture(u),f=!0)}}}(e,c,u,d)),vertexArray:(c,u,d)=>o("vertexArray",function OYe(e,t,n,r,i){const o=FYe();let s=ede(t),a=tde(t);function l(){a.bindVertexArray(s),i&&i.bind(),n.bindAttributes(r),a.bindVertexArray(null)}l();let c=!1;return{id:o,bind:()=>{a.bindVertexArray(s)},update:l,reset:()=>{s=ede(t),a=tde(t),l()},destroy:()=>{c||(i&&(a.bindVertexArray(s),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),a.deleteVertexArray(s),c=!0)}}}(e,r,c,u,d)),getByteCounts:()=>{let c=0;i.texture.forEach(f=>{c+=f.getByteCount()}),i.cubeTexture.forEach(f=>{c+=f.getByteCount()});let u=0;i.attribute.forEach(f=>{u+=4*f.length});let d=0;return i.elements.forEach(f=>{d+=4*f.length}),{texture:c,attribute:u,elements:d}},reset:()=>{i.attribute.forEach(c=>c.reset()),i.elements.forEach(c=>c.reset()),i.framebuffer.forEach(c=>c.reset()),i.renderbuffer.forEach(c=>c.reset()),i.shader.forEach(c=>c.reset()),i.program.forEach(c=>c.reset()),i.vertexArray.forEach(c=>c.reset()),i.texture.forEach(c=>c.reset())},destroy:()=>{i.attribute.forEach(c=>c.destroy()),i.elements.forEach(c=>c.destroy()),i.framebuffer.forEach(c=>c.destroy()),i.renderbuffer.forEach(c=>c.destroy()),i.shader.forEach(c=>c.destroy()),i.program.forEach(c=>c.destroy()),i.vertexArray.forEach(c=>c.destroy()),i.texture.forEach(c=>c.destroy()),s.clear(),l.clear()}}}const rde=Kc();class ide{add(t,n){let r=this.avgs.get(t)||n;return r=function zYe(e,t,n){return(e-=e/n)+t/n}(r,n,this.count),this.avgs.set(t,r),r}get(t){return this.avgs.get(t)}stats(){return Object.fromEntries(this.avgs.entries())}constructor(t){this.count=t,this.avgs=new Map}}function ode(e){e.map(t=>{const n=function qYe(e){const t=`${(e.gpuElapsed/1e3/1e3).toFixed(2)}`,n=`${(e.gpuAvg/1e3/1e3).toFixed(2)}`,r=`${e.cpuElapsed.toFixed(2)}`,i=`${e.cpuAvg.toFixed(2)}`;return`${e.label} ${t} ms (avg. ${n} ms) | CPU: ${r} ms (avg. ${i} ms)`}(t);t.children.length||t.calls?(console.groupCollapsed(n),t.calls&&console.log(t.calls),ode(t.children),console.groupEnd()):console.log(n)})}function sde(e,t){switch(t){case e.NO_ERROR:return"no error";case e.INVALID_ENUM:return"invalid enum";case e.INVALID_VALUE:return"invalid value";case e.INVALID_OPERATION:return"invalid operation";case e.INVALID_FRAMEBUFFER_OPERATION:return"invalid framebuffer operation";case e.OUT_OF_MEMORY:return"out of memory";case e.CONTEXT_LOST_WEBGL:return"context lost"}return"unknown error"}function ade(e){const t=e.getError();if(t!==e.NO_ERROR)throw new Error(`WebGL error: '${sde(e,t)}'`)}function hN(e){e.bindFramebuffer(e.FRAMEBUFFER,null)}const lde=new Uint8Array(4);function cde(e,t,n){e.getSyncParameter(t,e.SYNC_STATUS)===e.SIGNALED?(e.deleteSync(t),n()):m3.setImmediate(cde,e,t,n)}function ude(e,t){const n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);n?m3.setImmediate(cde,e,n,t):(console.warn("Could not create a WebGLSync object"),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,lde),t())}let dde=!1;function fde(e){e.bindFramebuffer(e.FRAMEBUFFER,null),e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,lde)}function S9(e,t,n,r,i,o){if($n&&dN(e),o instanceof Uint8Array)e.readPixels(t,n,r,i,e.RGBA,e.UNSIGNED_BYTE,o);else if(o instanceof Float32Array)e.readPixels(t,n,r,i,e.RGBA,e.FLOAT,o);else{if(!(o instanceof Int32Array&&Cn(e)))throw new Error("unsupported readPixels buffer type");e.readPixels(t,n,r,i,e.RGBA_INTEGER,e.INT,o)}$n&&ade(e)}function Cn(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext}const EXe="\nattribute vec4 aPosition;\n\nvoid main() {\n    gl_Position = aPosition;\n}",TXe="\nprecision mediump float;\nuniform vec4 uColor;\nuniform sampler2D uTexture;\n\nvoid main() {\n    gl_FragColor = texture2D(uTexture, vec2(0.5, 0.5)) * uColor;\n}",DXe=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]);function pde(e,t){const n=pN(e,{type:"vert",source:EXe}),r=pN(e,{type:"frag",source:TXe});if(!n||!r)return!1;const i=_9(e);e.attachShader(i,n),e.attachShader(i,r),e.linkProgram(i),e.useProgram(i);const o=e.getAttribLocation(i,"aPosition"),s=e.getUniformLocation(i,"uColor");if(!s)return $n&&console.log("error getting 'uColor' uniform location"),!1;const a=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,DXe,e.STATIC_DRAW),e.enableVertexAttribArray(o),e.vertexAttribPointer(o,2,e.FLOAT,!1,0,0);const l=e.createTexture(),c=new Uint8Array([255,255,255,255]);e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,c);const u=e.createTexture();e.bindTexture(e.TEXTURE_2D,u),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,t,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const d=e.createFramebuffer();if(e.bindFramebuffer(e.FRAMEBUFFER,d),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,u,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE)return $n&&console.log(`error creating framebuffer for '${t}'`),!1;e.bindTexture(e.TEXTURE_2D,l),e.uniform4fv(s,[0,10,20,1]),e.drawArrays(e.TRIANGLES,0,6),e.bindTexture(e.TEXTURE_2D,u),e.bindFramebuffer(e.FRAMEBUFFER,null),e.clearColor(1,0,0,1),e.clear(e.COLOR_BUFFER_BIT),e.uniform4fv(s,[0,.1,.05,1]),e.drawArrays(e.TRIANGLES,0,6);const p=new Uint8Array(4);if(e.readPixels(0,0,1,1,e.RGBA,e.UNSIGNED_BYTE,p),0!==p[0]||p[1]<248||p[2]<248||p[3]<254)return $n&&console.log(`not able to actually render to '${t}' texture`),!1;if(t===e.FLOAT){e.bindFramebuffer(e.FRAMEBUFFER,d);const m=new Float32Array(4);e.readPixels(0,0,1,1,e.RGBA,e.FLOAT,m);const h=e.getError();if(h)return $n&&console.log(`error reading float pixels: '${sde(e,h)}'`),!1}return!0}const C9=Kc();function hde(e,t,n){switch(t){case"alpha":return Cn(e)&&"float"===n?e.RED:Cn(e)&&"int"===n?e.RED_INTEGER:e.ALPHA;case"rgb":return Cn(e)&&"int"===n?e.RGB_INTEGER:e.RGB;case"rg":if(Cn(e)&&"float"===n)return e.RG;if(Cn(e)&&"int"===n)return e.RG_INTEGER;throw new Error('texture format "rg" requires webgl2 and type "float" or int"');case"rgba":return Cn(e)&&"int"===n?e.RGBA_INTEGER:e.RGBA;case"depth":return e.DEPTH_COMPONENT}}function mde(e,t,n,r,i){return function MXe(e){switch(e){case"alpha":return 1;case"rg":return 2;case"rgb":return 3;case"rgba":case"depth":return 4}}(e)*function RXe(e){switch(e){case"ubyte":return 1;case"ushort":case"fp16":return 2;case"float":case"int":return 4}}(t)*n*r*(i||1)}function gde(e,t){switch(t){case"nearest":return e.NEAREST;case"linear":return e.LINEAR}}function mN(e,t,n){switch(n){case"depth":return e.DEPTH_ATTACHMENT;case"stencil":return e.STENCIL_ATTACHMENT;case"color0":case 0:return e.COLOR_ATTACHMENT0}if(t.drawBuffers)switch(n){case"color1":case 1:return t.drawBuffers.COLOR_ATTACHMENT1;case"color2":case 2:return t.drawBuffers.COLOR_ATTACHMENT2;case"color3":case 3:return t.drawBuffers.COLOR_ATTACHMENT3;case"color4":case 4:return t.drawBuffers.COLOR_ATTACHMENT4;case"color5":case 5:return t.drawBuffers.COLOR_ATTACHMENT5;case"color6":case 6:return t.drawBuffers.COLOR_ATTACHMENT6;case"color7":case 7:return t.drawBuffers.COLOR_ATTACHMENT7}throw new Error("unknown texture attachment")}function yde(e){return typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement}function bde(e,t,n){return t===n.TEXTURE_3D}function vde(e){const t=e.createTexture();if(null===t)throw new Error("Could not create WebGL texture");return t}function xde(e,t,n){const{resources:r}=e,i=[];return Object.keys(t).forEach(o=>{const s=t[o];if("texture"===s.type){const a=n[o];if(a)if("texture"===s.kind)i[i.length]=[o,a.ref.value];else{const l=r.texture(s.kind,s.format,s.dataType,s.filter);l.load(a.ref.value),i[i.length]=[o,l]}}}),i}function _de(e,t,n){const r=new Image;r.onload=function(){n.load(r),O.update(t,n)},r.src=e}const Sde=-1;function lc(e){var t;const n=null!==(t=e?.TEXTURE_2D)&&void 0!==t?t:3553;return{id:C9(),target:n,format:Sde,internalFormat:0,type:0,filter:0,getWidth:()=>0,getHeight:()=>0,getDepth:()=>0,getByteCount:()=>0,define:()=>{},load:()=>{},mipmap:()=>{},bind:r=>{e&&(e.activeTexture(e.TEXTURE0+r),e.bindTexture(n,null))},unbind:r=>{e&&(e.activeTexture(e.TEXTURE0+r),e.bindTexture(n,null))},attachFramebuffer:()=>{throw new Error("cannot attach null-texture to a framebuffer")},detachFramebuffer:()=>{throw new Error("cannot detach null-texture from a framebuffer")},reset:()=>{},destroy:()=>{}}}function Ef(e,t,n,r){const i=function UXe(e,t,n,r){switch(n.granularity){case"uniform":return function HXe(e,t,n){return function VXe(e,t){return t?(O.update(t.uColor,st.toVec3Normalized(t.uColor.ref.value,e)),O.updateIfChanged(t.dColorType,"uniform"),t):{uColor:O.create(st.toVec3Normalized(C(),e)),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(lc()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ue.create(1,1)),uColorGridDim:O.create(C.create(1,1,1)),uColorGridTransform:O.create(Bn.create(0,0,0,1)),dColorType:O.create("uniform"),dUsePalette:O.create(!1)}}(t(Gu,!1),n)}(0,n.color,r);case"instance":return e.nonInstanceable?Cde(e,n.color,r):function GXe(e,t,n){const{instanceCount:r}=e,i=Sa(Math.max(1,r),3,Uint8Array,n&&n.tColor.ref.value.array);for(e.reset();e.hasNext;){const{location:o,isSecondary:s,instanceIndex:a}=e.move();st.toArray(t(o,s),i.array,3*a),e.skipInstance()}return kD(i,"instance",n)}(e,n.color,r);case"group":return Cde(e,n.color,r);case"groupInstance":return function qXe(e,t,n){const{groupCount:r,instanceCount:i,hasLocation2:o}=e,a=Sa(Math.max(1,i*r*(o?2:1)),3,Uint8Array,n&&n.tColor.ref.value.array);e.reset();const l=o?6:3;for(;e.hasNext;){const{location:c,location2:u,isSecondary:d,index:f}=e.move();st.toArray(t(c,d),a.array,f*l),o&&st.toArray(t(u,d),a.array,f*l+3)}return kD(a,"groupInstance",n)}(e,n.color,r);case"vertex":return function WXe(e,t,n){const{groupCount:r,stride:i}=e,o=Sa(Math.max(1,r),3,Uint8Array,n&&n.tColor.ref.value.array);for(e.reset(),e.voidInstances();e.hasNext&&!e.isNextNewInstance;){const{location:s,isSecondary:a,groupIndex:l}=e.move(),c=t(s,a);for(let u=0;u<i;++u)st.toArray(c,o.array,3*(l+u))}return kD(o,"vertex",n)}(t,n.color,r);case"vertexInstance":return function $Xe(e,t,n){const{groupCount:r,instanceCount:i,stride:o}=e,a=Sa(Math.max(1,i*r),3,Uint8Array,n&&n.tColor.ref.value.array);for(e.reset();e.hasNext;){const{location:l,isSecondary:c,index:u}=e.move(),d=t(l,c);for(let f=0;f<o;++f)st.toArray(d,a.array,3*(u+f))}return kD(a,"vertexInstance",n)}(t,n.color,r);case"volume":return wde(n.grid,"volume",r);case"volumeInstance":return wde(n.grid,"volumeInstance",r);case"direct":return function YXe(e){return e?(O.updateIfChanged(e.dColorType,"direct"),e):{uColor:O.create(C()),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(lc()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ue.create(1,1)),uColorGridDim:O.create(C.create(1,1,1)),uColorGridTransform:O.create(Bn.create(0,0,0,1)),dColorType:O.create("direct"),dUsePalette:O.create(!1)}}(r)}}(e,t,n,r);return n.palette?(O.updateIfChanged(i.dUsePalette,!0),function zXe(e,t){let n=!0;const r=t.ref.value;if(e.colors.length!==r.width||r.filter!==e.filter)n=!1;else{const s=r.array;let a=0;for(const l of e.colors){const[c,u,d]=st.toRgb(l);if(s[a++]!==c||s[a++]!==u||s[a++]!==d){n=!1;break}}}if(n)return;const i=new Uint8Array(3*e.colors.length);let o=0;for(const s of e.colors){const[a,l,c]=st.toRgb(s);i[o++]=a,i[o++]=l,i[o++]=c}O.update(t,{array:i,height:1,width:e.colors.length,filter:e.filter})}(n.palette,i.tPalette)):O.updateIfChanged(i.dUsePalette,!1),i}function kD(e,t,n){return n?(O.update(n.tColor,e),O.update(n.uColorTexDim,Ue.create(e.width,e.height)),O.updateIfChanged(n.dColorType,t),n):{uColor:O.create(C()),tColor:O.create(e),tColorGrid:O.create(lc()),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ue.create(e.width,e.height)),uColorGridDim:O.create(C.create(1,1,1)),uColorGridTransform:O.create(Bn.create(0,0,0,1)),dColorType:O.create(t),dUsePalette:O.create(!1)}}function Cde(e,t,n){const{groupCount:r,hasLocation2:i}=e,o=Sa(Math.max(1,r*(i?2:1)),3,Uint8Array,n&&n.tColor.ref.value.array);e.reset();const s=i?6:3;for(;e.hasNext&&!e.isNextNewInstance;){const{location:a,location2:l,isSecondary:c,groupIndex:u}=e.move();st.toArray(t(a,c),o.array,u*s),i&&st.toArray(t(l,c),o.array,u*s+3)}return kD(o,"group",n)}function wde(e,t,n){const{colors:r,dimension:i,transform:o}=e,s=r.getWidth(),a=r.getHeight();return n?(O.update(n.tColorGrid,r),O.update(n.uColorTexDim,Ue.create(s,a)),O.update(n.uColorGridDim,C.clone(i)),O.update(n.uColorGridTransform,Bn.clone(o)),O.updateIfChanged(n.dColorType,t),n):{uColor:O.create(C()),tColor:O.create({array:new Uint8Array(3),width:1,height:1}),tColorGrid:O.create(r),tPalette:O.create({array:new Uint8Array(3),width:1,height:1}),uColorTexDim:O.create(Ue.create(s,a)),uColorGridDim:O.create(C.clone(i)),uColorGridTransform:O.create(Bn.clone(o)),dColorType:O.create(t),dUsePalette:O.create(!1)}}const w9=C.transformMat4Offset,XXe=C.fromArray,gN=Gt.add;const Ade=In(),eKe=fe();function A9(e,t,n,r,i,o){const s=function tKe(e,t){for(let n=0;n<t;n++)if(In.fromMat4(Ade,fe.fromArray(eKe,e,16*n)),In.determinant(Ade)<0)return!0;return!1}(e,t);if(o){O.update(o.matrix,o.matrix.ref.value);const a=o.transform.ref.value.length>=16*t?o.transform.ref.value:new Float32Array(16*t);a.set(e),O.update(o.transform,a),O.updateIfChanged(o.uInstanceCount,t),O.updateIfChanged(o.instanceCount,t);const l=o.aTransform.ref.value.length>=16*t?o.aTransform.ref.value:new Float32Array(16*t);O.update(o.aTransform,l);const c=o.extraTransform.ref.value.length>=16*t?o.extraTransform.ref.value:new Float32Array(16*t);O.update(o.extraTransform,yN(c,t));const u=o.aInstance.ref.value.length>=t?o.aInstance.ref.value:new Float32Array(t);O.update(o.aInstance,Sd(u,t)),O.update(o.hasReflection,s)}else o={aTransform:O.create(new Float32Array(16*t)),matrix:O.create(fe.identity()),transform:O.create(new Float32Array(e)),extraTransform:O.create(yN(new Float32Array(16*t),t)),uInstanceCount:O.create(t),instanceCount:O.create(t),aInstance:O.create(Sd(new Float32Array(t))),hasReflection:O.create(s),instanceGrid:O.create({cellSize:0,cellCount:0,cellOffsets:new Uint32Array,cellSpheres:new Float32Array,cellTransform:new Float32Array,cellInstance:new Float32Array,batchSize:0,batchCount:0,batchOffsets:new Uint32Array,batchSpheres:new Float32Array,batchCell:new Uint32Array})};return Ide(o,n,r,i),o}const I9=new Float32Array(16);function E9(e){return A9(new Float32Array(I9),1,void 0,0,0,e)}function yN(e,t){for(let n=0;n<t;n++)e.set(I9,16*n);return e}function Ide(e,t,n,r){const i=e.aTransform.ref.value,o=e.aInstance.ref.value,s=e.instanceCount.ref.value,a=e.matrix.ref.value,l=e.transform.ref.value,c=e.extraTransform.ref.value;for(let u=0;u<s;u++){const d=16*u;fe.mulOffset(i,c,l,d,d,d),fe.mulOffset(i,a,i,d,0,d),o[u]=u}if(t&&s>0){const u=function ZXe(e,t,n){const r=function QXe(e,t){const{instanceCount:n,instance:r,transform:i,invariantBoundingSphere:o}=e,s=new Float32Array(n),a=new Float32Array(n),l=new Float32Array(n),c=Ve.ofBounds(0,n),u=Gt.setEmpty(Gt()),{center:d,radius:f}=o,p=C.create(f,f,f),m=C();for(let N=0;N<n;++N)w9(m,d,i,0,0,16*N),s[N]=m[0],a[N]=m[1],l[N]=m[2],gN(u,m);Gt.expand(u,u,p);const y=zh({x:s,y:a,z:l,indices:c},{box:u,sphere:ke.fromBox3D(ke(),u)},C.create(t,t,t)),{array:v,offset:x,count:_}=y.buckets,w=x.length,A=new Uint32Array(w+1),M=new Float32Array(4*w),E=new Float32Array(16*n),D=new Float32Array(n),T=Gt(),F=ke();let R=0;for(let N=0;N<w;++N){const j=x[N],W=_[N];A[N]=j;const z=R;for(let $=j,V=j+W;$<V;++$){const X=v[$];D[R]=r[X];for(let H=0;H<16;++H)E[16*R+H]=i[16*X+H];R+=1}if(1===W)w9(M,d,E,4*N,0,16*z),M[4*N+3]=f;else{Gt.setEmpty(T);const $=16*z;for(let V=0;V<W;++V)w9(m,d,E,0,0,16*V+$),gN(T,m);Gt.expand(T,T,p),ke.fromBox3D(F,T),ke.toArray(F,M,4*N)}}return A[w]=x[w-1]+_[w-1],{cellSize:t,cellCount:w,cellOffsets:A,cellSpheres:M,cellTransform:E,cellInstance:D}}(e,t),i=function JXe(e,t){const{cellCount:n,cellSpheres:r}=e,i=new Float32Array(n),o=new Float32Array(n),s=new Float32Array(n),a=Ve.ofBounds(0,n),l=Gt.setEmpty(Gt()),c=C();let u=0;for(let D=0;D<n;++D){const T=4*D;XXe(c,r,T),i[D]=c[0],o[D]=c[1],s[D]=c[2],gN(l,c),u=Math.max(u,r[T+3])}const d=C.create(u,u,u);Gt.expand(l,l,d);const m=zh({x:i,y:o,z:s,indices:a},{box:l,sphere:ke.fromBox3D(ke(),l)},C.create(t,t,t)),{array:h,offset:g,count:y}=m.buckets,v=g.length,x=new Uint32Array(v+1),_=new Float32Array(4*v),w=new Uint32Array(n),A=Gt(),M=ke();let E=0;for(let D=0;D<v;++D){const T=g[D],F=y[D];x[D]=T;for(let R=T,N=T+F;R<N;++R)w[E]=h[R],E+=1;if(1===F){const R=h[T];_[4*D]=r[4*R],_[4*D+1]=r[4*R+1],_[4*D+2]=r[4*R+2],_[4*D+3]=r[4*R+3]}else{Gt.setEmpty(A),u=0;for(let R=T,N=T+F;R<N;++R){const j=h[R];c[0]=r[4*j],c[1]=r[4*j+1],c[2]=r[4*j+2],gN(A,c),u=Math.max(u,r[4*j+3])}C.set(d,u,u,u),Gt.expand(A,A,d),ke.fromBox3D(M,A),ke.toArray(M,_,4*D)}}return x[v]=g[v-1]+y[v-1],{batchSize:t,batchCount:v,batchOffsets:x,batchSpheres:_,batchCell:w}}(r,n),o=new Uint32Array(r.cellOffsets.length),s=new Float32Array(r.cellSpheres.length),a=new Float32Array(r.cellInstance.length);let l=0;for(let u=0,d=i.batchCell.length;u<d;++u){const f=i.batchCell[u],p=r.cellOffsets[f],h=r.cellOffsets[f+1]-p;o[u+1]=o[u]+h;for(let g=0;g<4;++g)s[4*u+g]=r.cellSpheres[4*f+g];for(let g=0;g<h;++g){const v=r.cellInstance[p+g];for(let x=0;x<16;++x)r.cellTransform[16*l+x]=e.transform[16*v+x];a[l]=v,l+=1}}return{cellSize:r.cellSize,cellCount:r.cellCount,cellOffsets:o,cellSpheres:s,cellTransform:r.cellTransform,cellInstance:a,batchSize:i.batchSize,batchCount:i.batchCount,batchOffsets:i.batchOffsets,batchSpheres:i.batchSpheres,batchCell:Sd(i.batchCell)}}({instanceCount:s,instance:o,transform:i,invariantBoundingSphere:t},n,r);O.update(e.instanceGrid,u),O.update(e.aInstance,u.cellInstance),O.update(e.aTransform,u.cellTransform)}else O.update(e.aInstance,o),O.update(e.aTransform,i)}fe.toArray(fe.identity(),I9,0);const xo={Atom:"Atom Property",Chain:"Chain Property",Residue:"Residue Property",Symmetry:"Symmetry",Validation:"Validation",Misc:"Miscellaneous"},Ede=st(13421772),nKe="Gives everything the same, uniform color.",Vw={value:I.Color(Ede),saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})};function I_(e,t){let n=Ll(t.value,Ede);return n=st.saturate(n,t.saturation),n=st.lighten(n,t.lightness),{factory:I_,granularity:"uniform",color:()=>n,props:t,description:nKe,legend:v1([["uniform",n]])}}const iKe={name:"uniform",label:"Uniform",category:xo.Misc,factory:I_,getParams:function rKe(e){return Vw},defaultValues:I.getDefaultValues(Vw),isApplicable:e=>!0},Tde={value:I.Numeric(1,{min:0,max:20,step:.1})};function T9(e,t){const n=t.value;return{factory:T9,granularity:"uniform",size:()=>n,props:t,description:"Gives everything the same, uniform size."}}const aKe={name:"uniform",label:"Uniform",category:"",factory:T9,getParams:function sKe(e){return Tde},defaultValues:I.getDefaultValues(Tde),isApplicable:e=>!0};function tu(e){return{...tu.Zero,...e}}function H1(){}!function(e){e.Zero={metalness:0,roughness:0,bumpiness:0},e.toArray=function t(i,o,s){return o[s]=255*i.metalness,o[s+1]=255*i.roughness,o[s+2]=255*i.bumpiness,o},e.toString=function n({metalness:i,roughness:o,bumpiness:s}){return`M ${i.toFixed(2)} | R ${o.toFixed(2)} | B ${s.toFixed(2)}`},e.getParam=function r(i){return I.Group({metalness:I.Numeric(0,{min:0,max:1,step:.01}),roughness:I.Numeric(1,{min:0,max:1,step:.01}),bumpiness:I.Numeric(0,{min:0,max:1,step:.01})},{...i,presets:[[{metalness:0,roughness:1,bumpiness:0},"Matte"],[{metalness:0,roughness:.2,bumpiness:0},"Plastic"],[{metalness:0,roughness:.6,bumpiness:0},"Glossy"],[{metalness:1,roughness:.6,bumpiness:0},"Metallic"]]})}}(tu||(tu={})),function(e){e.Type={none:0,plane:1,sphere:2,cube:3,cylinder:4,infiniteCone:5},e.Params={variant:I.Select("pixel",I.arrayToOptions(["instance","pixel"])),objects:I.ObjectList({type:I.Select("plane",I.objectToOptions(e.Type,l=>yf(l))),invert:I.Boolean(!1),position:I.Vec3(C()),rotation:I.Group({axis:I.Vec3(C.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:1},{description:"Angle in Degrees"})},{isExpanded:!0}),scale:I.Vec3(C.create(1,1,1))},l=>yf(l.type))};const n=Ai(),r=Ai(),i=C(),o=C();e.getClip=function s(l,c){const u=l.objects.length,{type:d,invert:f,position:p,rotation:m,scale:h}=c?.objects||function t(l){return{count:0,type:new Array(l).fill(1),invert:new Array(l).fill(!1),position:new Array(3*l).fill(0),rotation:new Array(4*l).fill(0),scale:new Array(3*l).fill(1)}}(u);for(let g=0;g<u;++g){const y=l.objects[g];d[g]=e.Type[y.type],f[g]=y.invert,C.toArray(y.position,p,3*g),Ai.toArray(Ai.setAxisAngle(n,y.rotation.axis,Xr(y.rotation.angle)),m,4*g),C.toArray(y.scale,h,3*g)}return{variant:l.variant,objects:{count:u,type:d,invert:f,position:p,rotation:m,scale:h}}},e.areEqual=function a(l,c){if(l.variant!==c.variant||l.objects.count!==c.objects.count)return!1;const u=l.objects,d=c.objects;for(let f=0,p=u.count;f<p;++f)if(u.invert[f]!==d.invert[f]||u.type[f]!==d.type[f]||(C.fromArray(i,u.position,3*f),C.fromArray(o,d.position,3*f),!C.equals(i,o))||(C.fromArray(i,u.scale,3*f),C.fromArray(o,d.scale,3*f),!C.equals(i,o))||(Ai.fromArray(n,u.rotation,4*f),Ai.fromArray(r,d.rotation,4*f),!Ai.equals(n,r)))return!1;return!0}}(H1||(H1={}));const lKe=Object.keys({custom:{},auto:{},highest:{},higher:{},high:{},medium:{},low:{},lower:{},lowest:{}}),D9=I.arrayToOptions(lKe),Dde={smoothColors:I.MappedStatic("auto",{auto:I.Group({}),on:I.Group({resolutionFactor:I.Numeric(2,{min:.5,max:6,step:.1}),sampleStride:I.Numeric(3,{min:1,max:12,step:1})}),off:I.Group({})})};function hy(e){return!!e.smoothColors}function Dp(e,t,n){if(("on"===e.name||"auto"===e.name&&t)&&n&&n<3){let r=3;return"on"===e.name?(n*=e.params.resolutionFactor,r=e.params.sampleStride):(n*=2-roe(0,1.1,n),(n=Math.max(.5,n))>1.2&&(r=2)),{resolution:n,stride:r}}}var xt;function cKe(e,t,n,r){for(let i=t;i<n;++i)st.toArray(r,e,4*i),e[4*i+3]=255;return!0}function Pde(e,t,n){return e.fill(0,4*t,4*n),!0}!function(e){e.MaterialCategory={category:"Material"},e.ShadingCategory={category:"Shading"},e.CullingLodCategory={category:"Culling & LOD"},e.CustomQualityParamInfo={category:"Custom Quality",hideIf:s=>typeof s.quality<"u"&&"custom"!==s.quality},e.Params={alpha:I.Numeric(1,{min:0,max:1,step:.01},{label:"Opacity",isEssential:!0,description:"How opaque/transparent the representation is rendered."}),quality:I.Select("auto",D9,{isEssential:!0,description:"Visual/rendering quality of the representation."}),material:tu.getParam(),clip:I.Group(H1.Params),instanceGranularity:I.Boolean(!1,{description:"Use instance granularity for marker, transparency, clipping, overpaint, substance data to save memory."}),lod:I.Vec3(C(),void 0,{...e.CullingLodCategory,description:"Level of detail.",fieldLabels:{x:"Min Distance",y:"Max Distance",z:"Overlap (Shader)"}}),cellSize:I.Numeric(200,{min:0,max:5e3,step:100},{...e.CullingLodCategory,description:"Instance grid cell size."}),batchSize:I.Numeric(2e3,{min:0,max:5e4,step:500},{...e.CullingLodCategory,description:"Instance grid batch size."})},e.createSimple=function t(s=qn.grey,a=1,l){return l||(l=E9()),{transform:l,locationIterator:Vi(1,l.instanceCount.ref.value,1,()=>Gu,!1,()=>!1),theme:{color:I_(0,{value:s,lightness:0,saturation:0}),size:T9(0,{value:a})}}},e.createValues=function n(s,a){const l=H1.getClip(s.clip);return{alpha:O.create(s.alpha),uAlpha:O.create(s.alpha),uVertexCount:O.create(a.vertexCount),uGroupCount:O.create(a.groupCount),drawCount:O.create(a.drawCount),uMetalness:O.create(s.material.metalness),uRoughness:O.create(s.material.roughness),uBumpiness:O.create(s.material.bumpiness),dLightCount:O.create(1),dColorMarker:O.create(!0),dClipObjectCount:O.create(l.objects.count),dClipVariant:O.create(l.variant),uClipObjectType:O.create(l.objects.type),uClipObjectInvert:O.create(l.objects.invert),uClipObjectPosition:O.create(l.objects.position),uClipObjectRotation:O.create(l.objects.rotation),uClipObjectScale:O.create(l.objects.scale),instanceGranularity:O.create(s.instanceGranularity),uLod:O.create(Bn.create(s.lod[0],s.lod[1],s.lod[2],0))}},e.updateValues=function r(s,a){O.updateIfChanged(s.alpha,a.alpha),O.updateIfChanged(s.uMetalness,a.material.metalness),O.updateIfChanged(s.uRoughness,a.material.roughness),O.updateIfChanged(s.uBumpiness,a.material.bumpiness);const l=H1.getClip(a.clip);O.updateIfChanged(s.dClipObjectCount,l.objects.count),O.updateIfChanged(s.dClipVariant,l.variant),O.update(s.uClipObjectType,l.objects.type),O.update(s.uClipObjectInvert,l.objects.invert),O.update(s.uClipObjectPosition,l.objects.position),O.update(s.uClipObjectRotation,l.objects.rotation),O.update(s.uClipObjectScale,l.objects.scale),O.updateIfChanged(s.instanceGranularity,a.instanceGranularity),O.update(s.uLod,Bn.set(s.uLod.ref.value,a.lod[0],a.lod[1],a.lod[2],0))},e.createRenderableState=function i(s={}){const a=void 0===s.alpha||1===s.alpha;return{disposed:!1,visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,opaque:a,writeDepth:a}},e.updateRenderableState=function o(s,a){s.opaque=a.alpha*s.alphaFactor>=1,s.writeDepth=s.opaque}}(xt||(xt={}));const kde={array:new Uint8Array(4),width:1,height:1};function my(e){return e?(O.update(e.tOverpaint,kde),O.update(e.uOverpaintTexDim,Ue.create(1,1)),e):{tOverpaint:O.create(kde),uOverpaintTexDim:O.create(Ue.create(1,1)),dOverpaint:O.create(!1),tOverpaintGrid:O.create(lc()),uOverpaintGridDim:O.create(C.create(1,1,1)),uOverpaintGridTransform:O.create(Bn.create(0,0,0,1)),dOverpaintType:O.create("groupInstance"),uOverpaintStrength:O.create(1)}}function dKe(e,t,n,r){for(let i=t;i<n;++i)e[i]=255*r;return!0}function Mde(e,t){if(0===t||e.length<t)return 0;let n=0;for(let r=0;r<t;++r)n+=e[r];return n/(255*t)}const Rde={array:new Uint8Array(1),width:1,height:1};function gy(e){return e?(O.update(e.tTransparency,Rde),O.update(e.uTransparencyTexDim,Ue.create(1,1)),e):{tTransparency:O.create(Rde),uTransparencyTexDim:O.create(Ue.create(1,1)),dTransparency:O.create(!1),transparencyAverage:O.create(0),tTransparencyGrid:O.create(lc()),uTransparencyGridDim:O.create(C.create(1,1,1)),uTransparencyGridTransform:O.create(Bn.create(0,0,0,1)),dTransparencyType:O.create("groupInstance"),uTransparencyStrength:O.create(1)}}function hKe(e,t,n,r){return e.fill(r,t,n),!0}const Nde={array:new Uint8Array(1),width:1,height:1};function yy(e){return e?(O.update(e.tClipping,Nde),O.update(e.uClippingTexDim,Ue.create(1,1)),O.updateIfChanged(e.dClipping,!1),e):{tClipping:O.create(Nde),uClippingTexDim:O.create(Ue.create(1,1)),dClipping:O.create(!1),dClippingType:O.create("groupInstance")}}function yKe(e,t,n,r){for(let i=t;i<n;++i)tu.toArray(r,e,4*i),e[4*i+3]=255;return!0}function Fde(e,t,n){return e.fill(0,4*t,4*n),!0}const Ode={array:new Uint8Array(4),width:1,height:1};function by(e){return e?(O.update(e.tSubstance,Ode),O.update(e.uSubstanceTexDim,Ue.create(1,1)),e):{tSubstance:O.create(Ode),uSubstanceTexDim:O.create(Ue.create(1,1)),dSubstance:O.create(!1),tSubstanceGrid:O.create(lc()),uSubstanceGridDim:O.create(C.create(1,1,1)),uSubstanceGridTransform:O.create(Bn.create(0,0,0,1)),dSubstanceType:O.create("groupInstance"),uSubstanceStrength:O.create(1)}}var on;!function(e){function t(F,R,N,j,W,z,$){return $?function o(F,R,N,j,W,z,$){return $.vertexCount=W,$.triangleCount=z,O.update($.vertexBuffer,F),O.update($.indexBuffer,R),O.update($.normalBuffer,N),O.update($.groupBuffer,j),$}(F,R,N,j,W,z,$):function i(F,R,N,j,W,z){const $=ke();let V,X=-1,H=-1;const oe={kind:"mesh",vertexCount:W,triangleCount:z,vertexBuffer:O.create(F),indexBuffer:O.create(R),normalBuffer:O.create(N),groupBuffer:O.create(j),varyingGroup:O.create(!1),get boundingSphere(){const te=r(oe);if(te!==X){const K=py(oe.vertexBuffer.ref.value,oe.vertexCount,1);ke.copy($,K),X=te}return $},get groupMapping(){return oe.groupBuffer.ref.version!==H&&(V=zw(oe.groupBuffer.ref.value,oe.vertexCount),H=oe.groupBuffer.ref.version),V},setBoundingSphere(te){ke.copy($,te),X=r(oe)},meta:{}};return oe}(F,R,N,j,W,z)}function n(F){return t(F?F.vertexBuffer.ref.value:new Float32Array(0),F?F.indexBuffer.ref.value:new Uint32Array(0),F?F.normalBuffer.ref.value:new Float32Array(0),F?F.groupBuffer.ref.value:new Float32Array(0),0,0,F)}function r(F){return Zc([F.vertexCount,F.triangleCount,F.vertexBuffer.ref.version,F.indexBuffer.ref.version,F.normalBuffer.ref.version,F.groupBuffer.ref.version])}e.create=t,e.createEmpty=n,e.computeNormals=function s(F){const{vertexCount:R,triangleCount:N}=F,j=F.vertexBuffer.ref.value,W=F.indexBuffer.ref.value,z=F.normalBuffer.ref.value.length>=3*R?F.normalBuffer.ref.value:new Float32Array(3*R);z===F.normalBuffer.ref.value&&z.fill(0,0,3*R),Fue(j,W,z,R,N),O.update(F.normalBuffer,z)},e.checkForDuplicateVertices=function a(F,R=3){const N=F.vertexBuffer.ref.value,j=new Map,W=(V,X)=>`${V[0].toFixed(X)}|${V[1].toFixed(X)}|${V[2].toFixed(X)}`;let z=0;const $=C();for(let V=0,X=F.vertexCount;V<X;++V){C.fromArray($,N,3*V);const H=W($,R),oe=j.get(H);void 0!==oe?(z+=1,j.set(H,oe+1)):j.set(H,1)}return z};const l=In();function f(F){const{vertexCount:R,triangleCount:N}=F,j=F.indexBuffer.ref.value,W=[];for(let z=0;z<R;++z)W[z]=[];for(let z=0;z<N;++z){const $=j[3*z],V=j[3*z+1],X=j[3*z+2];Us(W[$],V),Us(W[$],X),Us(W[V],$),Us(W[V],X),Us(W[X],$),Us(W[X],V)}return W}function p(F){const{triangleCount:R}=F,N=F.indexBuffer.ref.value,j=new Map,W=(z,$)=>{const V=v3(z,$),X=j.get(V)||0;j.set(V,X+1)};for(let z=0;z<R;++z){const $=N[3*z],V=N[3*z+1],X=N[3*z+2];W($,V),W($,X),W(V,X)}return j}function m(F){const R=new Set,N=[0,0];return F.forEach((j,W)=>{1===j&&(Coe(N,W),R.add(N[0]),R.add(N[1]))}),R}function h(F,R,N){const j=new Map,W=(z,$)=>{j.has(z)?Us(j.get(z),$):j.set(z,[$])};return R.forEach(z=>{const $=F[z];for(const V of $)R.has(V)&&1===N.get(v3(z,V))&&W(z,V)}),j}function y(F,R,N,j){var W;const{vertexBuffer:z,indexBuffer:$,normalBuffer:V,triangleCount:X}=F,H=z.ref.value,oe=$.ref.value,te=V.ref.value,K=tt.create(Uint32Array,3,1024,X);let Q=0;for(let _e=0;_e<X;++_e)tt.add3(K,oe[3*_e],oe[3*_e+1],oe[3*_e+2]),Q+=1;const G=C(),Z=C(),ee=C(),se=C(),xe=C(),re=C(),ae=C(),ge=C(),Ie=C(),me=C(),Ae=Xr(120),he=new Set,ie=Array.from(N.keys()).filter(_e=>N.get(_e).length<2).map(_e=>{const Fe=N.get(_e);return C.fromArray(G,H,3*_e),C.fromArray(Z,H,3*Fe[0]),C.fromArray(ee,H,3*Fe[1]),C.sub(xe,Z,G),C.sub(re,ee,G),[_e,C.angle(xe,re)]});ie.sort(([,_e],[,Fe])=>_e-Fe);for(const[_e,Fe]of ie){if(he.has(_e)||Fe>Ae)continue;const Ze=N.get(_e);if(R[Ze[0]].includes(Ze[1])&&(null===(W=N.get(Ze[0]))||void 0===W||!W.includes(Ze[1]))||(C.fromArray(G,H,3*_e),C.fromArray(Z,H,3*Ze[0]),C.fromArray(ee,H,3*Ze[1]),C.sub(xe,Z,G),C.sub(re,ee,G),C.add(ge,xe,re),C.squaredDistance(G,Z)>=j))continue;let ct=!1;for(const q of R[_e])if(!Ze.includes(q)&&(C.fromArray(se,H,3*q),C.sub(ae,se,G),C.dot(ge,ae)<0)){ct=!0;break}ct&&(C.fromArray(Ie,te,3*_e),C.triangleNormal(me,G,Z,ee),C.dot(me,Ie)>0?tt.add3(K,_e,Ze[0],Ze[1]):tt.add3(K,Ze[1],Ze[0],_e),he.add(_e),he.add(Ze[0]),he.add(Ze[1]),Q+=1)}const ue=tt.compact(K);return F.triangleCount=Q,O.update($,ue),F}function _(F,R){const N=F.vertexCount,j=R.instanceCount.ref.value,W=V1(),z=W.position,$=F.vertexBuffer.ref.value,V=R.aTransform.ref.value;return Vi(N,j,1,(H,oe)=>(oe<0?C.fromArray(z,$,3*H):C.transformMat4Offset(z,$,V,0,3*H,16*oe),W))}function w(F,R,N,j,W){const{instanceCount:z,groupCount:$}=N,X=Ef(N,_(F,R),j.color),H=W.instanceGranularity?hs(z,"instance"):hs(z*$,"groupInstance"),oe=my(),te=gy(),K=by(),Q=yy(),G={drawCount:3*F.triangleCount,vertexCount:F.vertexCount,groupCount:$,instanceCount:z},Z=ke.clone(F.boundingSphere),ee=pl(Z,R.aTransform.ref.value,z,0);return{dGeometryType:O.create("mesh"),aPosition:F.vertexBuffer,aNormal:F.normalBuffer,aGroup:F.groupBuffer,elements:F.indexBuffer,dVaryingGroup:F.varyingGroup,boundingSphere:O.create(ee),invariantBoundingSphere:O.create(Z),uInvariantBoundingSphere:O.create(Bn.ofSphere(Z)),...X,...H,...oe,...te,...K,...Q,...R,...xt.createValues(W,G),uDoubleSided:O.create(W.doubleSided),dFlatShaded:O.create(W.flatShaded),dFlipSided:O.create(W.flipSided),dIgnoreLight:O.create(W.ignoreLight),dXrayShaded:O.create("inverted"===W.xrayShaded?"inverted":!0===W.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(W.transparentBackfaces),uBumpFrequency:O.create(W.bumpFrequency),uBumpAmplitude:O.create(W.bumpAmplitude),meta:O.create(F.meta)}}function T(F,R){xt.updateRenderableState(F,R),F.opaque=F.opaque&&!R.xrayShaded,F.writeDepth=F.opaque}e.transform=function c(F,R){const N=F.vertexBuffer.ref.value;w_(R,N,0,F.vertexCount),fe.isTranslationAndUniformScaling(R)||function vWe(e,t,n,r){for(let i=0,o=3*r;i<o;i+=3)C.fromArray(Ed,t,n+i),C.transformMat3(Ed,Ed,e),C.toArray(Ed,t,n+i)}(In.directionTransform(l,R),F.normalBuffer.ref.value,0,F.vertexCount),O.update(F.vertexBuffer,N)},e.getOriginalData=function u(F){const{originalData:R}="kind"in F?F.meta:F.meta.ref.value;return R},e.uniformTriangleGroup=function d(F,R=!0){const{indexBuffer:N,vertexBuffer:j,groupBuffer:W,normalBuffer:z,triangleCount:$,vertexCount:V}=F,X=N.ref.value,H=j.ref.value,oe=W.ref.value,te=z.ref.value,K=tt.create(Uint32Array,3,1024,$),Q=tt.create(Float32Array,3,1024,H);Q.currentIndex=3*V,Q.elementCount=V;const G=tt.create(Float32Array,3,1024,te);G.currentIndex=3*V,G.elementCount=V;const Z=tt.create(Float32Array,1,1024,oe);Z.currentIndex=V,Z.elementCount=V;const ee=C(),se=C(),xe=C(),re=C(),ae=C(),ge=C();function Ie(q){C.fromArray(ee,H,3*q),C.fromArray(re,te,3*q),tt.add3(Q,ee[0],ee[1],ee[2]),tt.add3(G,re[0],re[1],re[2])}function me(q,ne){C.fromArray(ee,H,3*q),C.fromArray(se,H,3*ne),C.scale(ee,C.add(ee,ee,se),.5),C.fromArray(re,te,3*q),C.fromArray(ae,te,3*ne),C.scale(re,C.add(re,re,ae),.5),tt.add3(Q,ee[0],ee[1],ee[2]),tt.add3(G,re[0],re[1],re[2])}function Ae(q,ne,be){C.fromArray(ee,H,3*q),C.fromArray(se,H,3*ne),C.fromArray(xe,H,3*be),C.scale(ee,C.add(ee,C.add(ee,ee,se),xe),1/3),C.fromArray(re,te,3*q),C.fromArray(ae,te,3*ne),C.fromArray(ge,te,3*be),C.scale(re,C.add(re,C.add(re,re,ae),ge),1/3),tt.add3(Q,ee[0],ee[1],ee[2]),tt.add3(G,re[0],re[1],re[2])}function he(q,ne,be,Ce,Re){++ue,Ie(q),me(q,ne),me(q,be),tt.add3(K,ie,ie+1,ie+2);for(let Be=0;Be<3;++Be)tt.add(Z,Ce);ie+=3,ue+=2,Ie(ne),Ie(be),me(q,ne),me(q,be),tt.add3(K,ie,ie+1,ie+3),tt.add3(K,ie,ie+3,ie+2);for(let Be=0;Be<4;++Be)tt.add(Z,Re);ie+=4}let ie=V,ue=0;if(R)for(let q=0,ne=$;q<ne;++q){const be=X[3*q],Ce=X[3*q+1],Re=X[3*q+2],Be=oe[be],$e=oe[Ce],nt=oe[Re];if(Be===$e&&Be===nt)++ue,tt.add3(K,be,Ce,Re);else if(Be===$e)he(Re,be,Ce,nt,Be);else if(Be===nt)he(Ce,Re,be,$e,nt);else if($e===nt)he(be,Ce,Re,Be,$e);else{ue+=2,Ie(be),me(be,Ce),me(be,Re),Ae(be,Ce,Re),tt.add3(K,ie,ie+1,ie+3),tt.add3(K,ie,ie+3,ie+2);for(let ht=0;ht<4;++ht)tt.add(Z,Be);ie+=4,ue+=2,Ie(Ce),me(Ce,Re),me(Ce,be),Ae(be,Ce,Re),tt.add3(K,ie,ie+1,ie+3),tt.add3(K,ie,ie+3,ie+2);for(let ht=0;ht<4;++ht)tt.add(Z,$e);ie+=4,ue+=2,Ie(Re),me(Re,Ce),me(Re,be),Ae(be,Ce,Re),tt.add3(K,ie+3,ie+1,ie),tt.add3(K,ie+2,ie+3,ie);for(let ht=0;ht<4;++ht)tt.add(Z,nt);ie+=4}}else for(let q=0,ne=$;q<ne;++q){const be=X[3*q],Ce=X[3*q+1],Re=X[3*q+2],Be=oe[be],$e=oe[Ce],nt=oe[Re];if(Be!==$e||Be!==nt){++ue,Ie(be),Ie(Ce),Ie(Re),tt.add3(K,ie,ie+1,ie+2);const ht=$e===nt?$e:Be;for(let Ge=0;Ge<3;++Ge)tt.add(Z,ht);ie+=3}else++ue,tt.add3(K,be,Ce,Re)}const _e=tt.compact(K),Fe=tt.compact(Q),Ze=tt.compact(G),ct=tt.compact(Z);return F.vertexCount=ie,F.triangleCount=ue,O.update(j,Fe),O.update(W,ct),O.update(N,_e),O.update(z,Ze),F.meta.originalData={indexBuffer:X,vertexCount:V,triangleCount:$},F},e.smoothEdges=function x(F,R){!function g(F,R){const{indexBuffer:N,triangleCount:j}=F,W=N.ref.value,z=tt.create(Uint32Array,3,1024,j);let $=0;for(let X=0;X<j;++X){const H=W[3*X],oe=W[3*X+1],te=W[3*X+2];2===R[H].length||2===R[oe].length||2===R[te].length||(tt.add3(z,H,oe,te),$+=1)}const V=tt.compact(z);F.triangleCount=$,O.update(N,V)}(F,f(F));for(let $=0;$<10;++$){const V=F.triangleCount,X=p(F),H=f(F);if(y(F,H,h(H,m(X),X),R.maxNewEdgeLength*R.maxNewEdgeLength),F.triangleCount===V)break}const N=p(F);return function v(F,R,N){const{iterations:j,lambda:W}=N,z=C(),$=C(),V=C(),X=C(),H=-W;let oe=new Float32Array(F.vertexBuffer.ref.value.length);const te=K=>{const Q=F.vertexBuffer.ref.value;oe.set(Q),R.forEach((Z,ee)=>{if(2!==Z.length)return;C.fromArray(z,Q,3*ee),C.fromArray($,Q,3*Z[0]),C.fromArray(V,Q,3*Z[1]);const se=1/C.distance(z,$),xe=1/C.distance(z,V);C.scale($,$,se),C.scale(V,V,xe),C.add(X,$,V),C.scale(X,X,1/(se+xe)),C.sub(X,X,z),C.scale(X,X,K),C.add(X,z,X),C.toArray(X,oe,3*ee)});const G=F.vertexBuffer.ref.value;O.update(F.vertexBuffer,oe),oe=G};for(let K=0;K<j;++K)te(W),te(H)}(F,h(f(F),m(N),N),{iterations:R.iterations,lambda:.5}),F},e.Params={...xt.Params,doubleSided:I.Boolean(!1,xt.CustomQualityParamInfo),flipSided:I.Boolean(!1,xt.ShadingCategory),flatShaded:I.Boolean(!1,xt.ShadingCategory),ignoreLight:I.Boolean(!1,xt.ShadingCategory),xrayShaded:I.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],xt.ShadingCategory),transparentBackfaces:I.Select("off",I.arrayToOptions(["off","on","opaque"]),xt.ShadingCategory),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory),bumpAmplitude:I.Numeric(1,{min:0,max:5,step:.1},xt.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:n,createValues:w,createValuesSimple:function A(F,R,N,j,W){const z=xt.createSimple(N,j,W),$={...I.getDefaultValues(e.Params),...R};return w(F,z.transform,z.locationIterator,z.theme,$)},updateValues:function M(F,R){xt.updateValues(F,R),O.updateIfChanged(F.uDoubleSided,R.doubleSided),O.updateIfChanged(F.dFlatShaded,R.flatShaded),O.updateIfChanged(F.dFlipSided,R.flipSided),O.updateIfChanged(F.dIgnoreLight,R.ignoreLight),O.updateIfChanged(F.dXrayShaded,"inverted"===R.xrayShaded?"inverted":!0===R.xrayShaded?"on":"off"),O.updateIfChanged(F.dTransparentBackfaces,R.transparentBackfaces),O.updateIfChanged(F.uBumpFrequency,R.bumpFrequency),O.updateIfChanged(F.uBumpAmplitude,R.bumpAmplitude)},updateBoundingSphere:function E(F,R){const N=ke.clone(R.boundingSphere),j=pl(N,F.aTransform.ref.value,F.instanceCount.ref.value,0);ke.equals(j,F.boundingSphere.ref.value)||O.update(F.boundingSphere,j),ke.equals(N,F.invariantBoundingSphere.ref.value)||(O.update(F.invariantBoundingSphere,N),O.update(F.uInvariantBoundingSphere,Bn.fromSphere(F.uInvariantBoundingSphere.ref.value,N)))},createRenderableState:function D(F){const R=xt.createRenderableState(F);return T(R,F),R},updateRenderableState:T,createPositionIterator:_}}(on||(on={}));const vKe={radius:1,detail:0};const Bde=C(),Lde=C(),jde=C();function bN(e,t){const n=t.length,r=Hw(n/3);for(let i=0;i<n;i+=3)C.fromArray(Bde,e,3*t[i]),C.fromArray(Lde,e,3*t[i+1]),C.fromArray(jde,e,3*t[i+2]),r.add(Bde,Lde,jde);return r.getPrimitive()}const vN=C();function Hw(e,t){void 0===t&&(t=3*e);const n=new Float32Array(3*t),r=new Float32Array(3*t),i=new Uint32Array(3*e);let o=0,s=0;return{add:(a,l,c)=>{C.toArray(a,n,o),C.toArray(l,n,o+3),C.toArray(c,n,o+6),C.triangleNormal(vN,a,l,c);for(let u=0;u<3;++u)C.toArray(vN,r,o+3*u),i[s+u]=o/3+u;o+=9,s+=3},addQuad:(a,l,c,u)=>{C.toArray(a,n,o),C.toArray(l,n,o+3),C.toArray(c,n,o+6),C.toArray(u,n,o+9),C.triangleNormal(vN,a,l,c);for(let f=0;f<4;++f)C.toArray(vN,r,o+3*f);const d=o/3;i[s]=d,i[s+1]=d+1,i[s+2]=d+2,i[s+3]=d+2,i[s+4]=d+3,i[s+5]=d,o+=12,s+=6},getPrimitive:()=>({vertices:n,normals:r,indices:i})}}const Gw=C(),SKe=In();function P9(e,t){const{vertices:n,normals:r}=e,i=In.directionTransform(SKe,t);for(let o=0,s=n.length;o<s;o+=3)C.transformMat4(Gw,C.fromArray(Gw,n,o),t),C.toArray(Gw,n,o),C.transformMat3(Gw,C.fromArray(Gw,r,o),i),C.toArray(Gw,r,o);return e}function MD(e,t){return{vertices:e,edges:t}}function Ude(e){return{vertices:new Float32Array(e.vertices),edges:new Uint32Array(e.edges)}}const k9=C.zero();function zde(e,t){const{vertices:n}=e;for(let r=0,i=n.length;r<i;r+=3)C.transformMat4(k9,C.fromArray(k9,n,r),t),C.toArray(k9,n,r);return e}const Pp=(1+Math.sqrt(5))/2,Vde=[-1,Pp,0,1,Pp,0,-1,-Pp,0,1,-Pp,0,0,-1,Pp,0,1,Pp,0,-1,-Pp,0,1,-Pp,Pp,0,-1,Pp,0,1,-Pp,0,-1,-Pp,0,1],CKe=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];let M9;MD(Vde,[0,11,5,11,0,5,1,5,0,1,1,7,0,7,7,10,0,10,10,11,5,9,4,11,2,10,6,7,1,8,3,9,4,9,3,4,2,4,2,3,2,6,3,6,6,8,3,8,8,9,4,5,2,11,6,10,7,8,1,9]);const{vertices:EKe,indices:TKe}=function AKe(){return M9||(M9=bN(Vde,CKe)),M9}();function qw(e){return 10*Math.pow(Math.pow(2,e),2)+2}const Hde=new Map,PKe=fe.identity();function Gde(e){let t=Hde.get(e);return void 0===t&&(t=function DKe(e){return function xKe(e,t,n){const{radius:r,detail:i}={...vKe,...n},o=function _Ke(){const e=[],t=[],n=new Map;function r(i){const o=`${i[0].toFixed(5)}|${i[1].toFixed(5)}|${i[2].toFixed(5)}`;let s=n.get(o);return void 0===s&&(s=e.length/3,n.set(o,s),e.push(...i)),s}return{vertices:e,indices:t,add:(i,o,s)=>{t.push(r(i),r(o),r(s))}}}(),{vertices:s,indices:a}=o;(function c(d){const f=C(),p=C(),m=C();for(let h=0;h<t.length;h+=3)C.fromArray(f,e,3*t[h+0]),C.fromArray(p,e,3*t[h+1]),C.fromArray(m,e,3*t[h+2]),u(f,p,m,d)})(i),function xWe(e,t){for(let n=0,r=e.length;n<r;n+=3)C.fromArray(Ed,e,n),C.normalize(Ed,Ed),C.scale(Ed,Ed,t),C.toArray(Ed,e,n)}(s,r);const l=new Float32Array(s.length);return Fue(s,a,l,s.length/3,a.length/3),{vertices:new Float32Array(s),normals:new Float32Array(l),indices:new Uint32Array(a)};function u(d,f,p,m){const h=Math.pow(2,m),g=[];for(let y=0;y<=h;++y){g[y]=[];const v=C();C.lerp(v,d,p,y/h);const x=C();C.lerp(x,f,p,y/h);const _=h-y;for(let w=0;w<=_;++w)if(0===w&&y===h)g[y][w]=v;else{const A=C();C.lerp(A,v,x,w/_),g[y][w]=A}}for(let y=0;y<h;++y)for(let v=0;v<2*(h-y)-1;++v){const x=Math.floor(v/2);v%2==0?o.add(g[y][x+1],g[y+1][x],g[y][x]):o.add(g[y][x+1],g[y+1][x+1],g[y+1][x])}}}(EKe,TKe,{detail:e,radius:1})}(e),Hde.set(e,t)),t}function Jr(e,t,n,r){Ct.addPrimitive(e,function kKe(e,t,n){return fe.scaleUniformly(e,fe.fromTranslation(e,t),n)}(PKe,t,n),Gde(r))}const mg={radiusTop:1,radiusBottom:1,height:1,radialSegments:8,heightSegments:1,topCap:!1,bottomCap:!1,thetaStart:0,thetaLength:2*Math.PI};function gg(e,t,n=-1){const r=new Float32Array(3*e),i=-1===n?e<=4?Math.sqrt(2)/2:.6:n,o=t?1:0;for(let s=0,a=e;s<a;++s){const l=(2*s+o)/e*Math.PI;r[3*s]=Math.cos(l)*i,r[3*s+1]=Math.sin(l)*i,r[3*s+2]=0}return r}const qde=C(),Wde=C(),Td=C(),Dd=C(),yg=C(),Ww=C(),RKe={height:1,topCap:!0,bottomCap:!0};function $w(e,t){const n=e.length/3;if(n<3)throw new Error("need at least 3 points to build a prism");const{height:r,topCap:i,bottomCap:o}={...RKe,...t};let s=2*n,a=4*n;const l=(i?1:0)+(o?1:0);3===n?(s+=l,a+=3*l):4===n?(s+=2*l,a+=4*l):(s+=l*n,a+=l*n*3);const c=Hw(s,a),u=.5*r;C.set(qde,0,0,-u),C.set(Wde,0,0,u);for(let d=0;d<n;++d){const f=(d+1)%n;C.set(Td,e[3*d],e[3*d+1],-u),C.set(Dd,e[3*f],e[3*f+1],-u),C.set(yg,e[3*f],e[3*f+1],u),C.set(Ww,e[3*d],e[3*d+1],u),c.addQuad(Td,Dd,yg,Ww)}if(3===n)i&&(C.set(Td,e[0],e[1],-u),C.set(Dd,e[3],e[4],-u),C.set(yg,e[6],e[7],-u),c.add(yg,Dd,Td)),o&&(C.set(Td,e[0],e[1],u),C.set(Dd,e[3],e[4],u),C.set(yg,e[6],e[7],u),c.add(Td,Dd,yg));else if(4===n)i&&(C.set(Td,e[0],e[1],-u),C.set(Dd,e[3],e[4],-u),C.set(yg,e[6],e[7],-u),C.set(Ww,e[9],e[10],-u),c.addQuad(Ww,yg,Dd,Td)),o&&(C.set(Td,e[0],e[1],u),C.set(Dd,e[3],e[4],u),C.set(yg,e[6],e[7],u),C.set(Ww,e[9],e[10],u),c.addQuad(Td,Dd,yg,Ww));else for(let d=0;d<n;++d){const f=(d+1)%n;i&&(C.set(Td,e[3*d],e[3*d+1],-u),C.set(Dd,e[3*f],e[3*f+1],-u),c.add(qde,Dd,Td)),o&&(C.set(Td,e[3*d],e[3*d+1],u),C.set(Dd,e[3*f],e[3*f+1],u),c.add(Td,Dd,Wde))}return c.getPrimitive()}let R9,N9,F9,O9,B9;const $de=new Map,Yde=C.create(0,1,0),kp=C(),xN=C(),Xde=C(),bg=fe(),Kde=fe(),Zde=C(),vg=C(),V9=C();function RD(e,t,n,r,i){return C.setMagnitude(xN,n,r/2),C.add(Xde,t,xN),i?C.matchDirection(V9,Yde,xN):C.copy(V9,Yde),C.set(Zde,1,r,1),C.makeRotation(Kde,V9,xN),fe.scale(e,Kde,Zde),fe.setTranslation(e,Xde)}const xg=new Int32Array(9);function ND(e){const t=function jKe(e){var t,n,r,i,o,s,a,l,c;return xg[0]=Math.round(1e3*(null!==(t=e.radiusTop)&&void 0!==t?t:mg.radiusTop)),xg[1]=Math.round(1e3*(null!==(n=e.radiusBottom)&&void 0!==n?n:mg.radiusBottom)),xg[2]=Math.round(1e3*(null!==(r=e.height)&&void 0!==r?r:mg.height)),xg[3]=null!==(i=e.radialSegments)&&void 0!==i?i:mg.radialSegments,xg[4]=null!==(o=e.heightSegments)&&void 0!==o?o:mg.heightSegments,xg[5]=(null!==(s=e.topCap)&&void 0!==s?s:mg.topCap)?1:0,xg[6]=(null!==(a=e.bottomCap)&&void 0!==a?a:mg.bottomCap)?1:0,xg[7]=Math.round(1e3*(null!==(l=e.thetaStart)&&void 0!==l?l:mg.thetaStart)),xg[8]=Math.round(1e3*(null!==(c=e.thetaLength)&&void 0!==c?c:mg.thetaLength)),Zc(xg)}(e);let n=$de.get(t);return void 0===n&&(n=e.radialSegments&&e.radialSegments<=4?P9($w(gg(Math.max(3,e.radialSegments),!0,e.radiusTop),e),fe.rotX90):function MKe(e){const{radiusTop:t,radiusBottom:n,height:r,radialSegments:i,heightSegments:o,topCap:s,bottomCap:a,thetaStart:l,thetaLength:c}={...mg,...e},u=[],d=[],f=[];let p=0;const m=[],h=r/2;return function g(){const v=C.zero(),x=(n-t)/r;for(let _=0;_<=o;++_){const w=[],A=_/o,M=A*(n-t)+t;for(let E=0;E<=i;++E){const T=E/i*c+l,F=Math.sin(T),R=Math.cos(T);d.push(M*F,-A*r+h,M*R),C.normalize(v,C.set(v,F,x,R)),f.push(...v),w.push(p++)}m.push(w)}for(let _=0;_<i;++_)for(let w=0;w<o;++w){const M=m[w+1][_],E=m[w+1][_+1],D=m[w][_+1];u.push(m[w][_],M,D),u.push(M,E,D)}}(),s&&t>0&&y(!0),a&&n>0&&y(!1),{vertices:new Float32Array(d),normals:new Float32Array(f),indices:new Uint32Array(u)};function y(v){const x=!0===v?t:n,_=!0===v?1:-1,w=p;for(let M=1;M<=i;++M)d.push(0,h*_,0),f.push(0,_,0),++p;const A=p;for(let M=0;M<=i;++M){const D=M/i*c+l,T=Math.cos(D),F=Math.sin(D);d.push(x*F,h*_,x*T),f.push(0,_,0),++p}for(let M=0;M<i;++M){const E=w+M,D=A+M;!0===v?u.push(D,D+1,E):u.push(D+1,D,E)}}}(e),$de.set(t,n)),n}function Ur(e,t,n,r,i){const o=C.distance(t,n)*r;C.sub(kp,n,t),RD(bg,t,kp,o,!0),Ct.addPrimitive(e,bg,ND(i))}function UKe(e,t,n,r,i,o){const s=C.distance(t,n)*r,a=ND(o);C.sub(kp,n,t),C.add(vg,t,i),RD(bg,vg,kp,s,!0),Ct.addPrimitive(e,bg,a),C.sub(vg,t,i),RD(bg,vg,kp,s,!0),Ct.addPrimitive(e,bg,a)}function Yw(e,t,n,r,i,o,s){const a=C.distance(t,n)*r,l=i%2!=0,c=Math.floor((i+1)/2);let u=a/(i+.5),d=ND(s);C.setMagnitude(kp,C.sub(kp,n,t),u),C.copy(vg,t);for(let f=0;f<c;++f)C.add(vg,vg,kp),l&&f===c-1&&(!o&&s.topCap&&(s.topCap=!1,d=ND(s)),u/=2),RD(bg,vg,kp,u,!1),Ct.addPrimitive(e,bg,d),C.add(vg,vg,kp)}const Ws=C(),Qde=In(),Kh=C(),Mp=C(),vy=C(),_N=C(),nu=C.fromArray,zKe=C.triangleNormal,Jde=C.copy,SN=C.transformMat4,efe=C.transformMat3,tfe=In.directionTransform,ru=tt.add3,CN=tt.add;var Ct;function FD(e,t,n){return e=al(Math.round(e),0,16777215)+1,t[n+2]=e%256,e=Math.floor(e/256),t[n+1]=e%256,e=Math.floor(e/256),t[n]=e%256,t}function H9(e,t,n){return 256*Math.floor(e)*256+256*Math.floor(t)+Math.floor(n)-1}!function(e){function n(f,p,m,h){const{vertices:g,normals:y,indices:v,groups:x,currentGroup:_}=f,w=g.elementCount;ru(g,p[0],p[1],p[2]),ru(g,m[0],m[1],m[2]),ru(g,h[0],h[1],h[2]),zKe(Ws,p,m,h);for(let A=0;A<3;++A)ru(y,Ws[0],Ws[1],Ws[2]),CN(x,_);ru(v,w,w+1,w+2)}function r(f,p,m,h,g){const{vertices:y,normals:v,indices:x,groups:_,currentGroup:w}=f,A=y.elementCount;ru(y,p[0],p[1],p[2]),ru(y,m[0],m[1],m[2]),ru(y,h[0],h[1],h[2]);for(let M=0;M<3;++M)ru(v,g[0],g[1],g[2]),CN(_,w);ru(x,A,A+1,A+2)}function a(f,p,m){const{vertices:h,normals:g,indices:y}=m,{vertices:v,normals:x,indices:_,groups:w,currentGroup:A}=f,M=v.elementCount,E=tfe(Qde,p);for(let D=0,T=h.length;D<T;D+=3)SN(Ws,nu(Ws,h,D),p),ru(v,Ws[0],Ws[1],Ws[2]),efe(Ws,nu(Ws,g,D),E),ru(x,Ws[0],Ws[1],Ws[2]),CN(w,A);for(let D=0,T=y.length;D<T;D+=3)ru(_,y[D]+M,y[D+1]+M,y[D+2]+M)}e.createState=function t(f=2048,p=1024,m){return{currentGroup:-1,vertices:tt.create(Float32Array,3,p,m?m.vertexBuffer.ref.value:f),normals:tt.create(Float32Array,3,p,m?m.normalBuffer.ref.value:f),indices:tt.create(Uint32Array,3,3*p,m?m.indexBuffer.ref.value:3*f),groups:tt.create(Float32Array,1,p,m?m.groupBuffer.ref.value:f),mesh:m}},e.addTriangle=n,e.addTriangleWithNormal=r,e.addTriangleStrip=function i(f,p,m){nu(vy,p,3*m[0]),nu(_N,p,3*m[1]);for(let h=2,g=m.length;h<g;h+=2)Jde(Kh,vy),Jde(Mp,_N),nu(vy,p,3*m[h]),nu(_N,p,3*m[h+1]),n(f,Kh,Mp,vy),n(f,Mp,_N,vy)},e.addTriangleFan=function o(f,p,m){nu(Kh,p,3*m[0]);for(let h=2,g=m.length;h<g;++h)nu(Mp,p,3*m[h-1]),nu(vy,p,3*m[h]),n(f,Kh,vy,Mp)},e.addTriangleFanWithNormal=function s(f,p,m,h){nu(Kh,p,3*m[0]);for(let g=2,y=m.length;g<y;++g)nu(Mp,p,3*m[g-1]),nu(vy,p,3*m[g]),r(f,Kh,vy,Mp,h)},e.addPrimitive=a,e.addPrimitiveFlipped=function l(f,p,m){const{vertices:h,normals:g,indices:y}=m,{vertices:v,normals:x,indices:_,groups:w,currentGroup:A}=f,M=v.elementCount,E=tfe(Qde,p);for(let D=0,T=h.length;D<T;D+=3)SN(Ws,nu(Ws,h,D),p),ru(v,Ws[0],Ws[1],Ws[2]),efe(Ws,nu(Ws,g,D),E),ru(x,-Ws[0],-Ws[1],-Ws[2]),CN(w,A);for(let D=0,T=y.length;D<T;D+=3)ru(_,y[D+2]+M,y[D+1]+M,y[D]+M)},e.addCage=function c(f,p,m,h,g,y){const{vertices:v,edges:x}=m,_={radiusTop:h,radiusBottom:h,radialSegments:y};for(let w=0,A=x.length;w<A;w+=2)nu(Kh,v,3*x[w]),nu(Mp,v,3*x[w+1]),SN(Kh,Kh,p),SN(Mp,Mp,p),Jr(f,Kh,h,g),Jr(f,Mp,h,g),Ur(f,Kh,Mp,1,_)},e.addMesh=function u(f,p,m){a(f,p,{vertices:m.vertexBuffer.ref.value.subarray(0,3*m.vertexCount),normals:m.normalBuffer.ref.value.subarray(0,3*m.vertexCount),indices:m.indexBuffer.ref.value.subarray(0,3*m.triangleCount)})},e.getMesh=function d(f){const{vertices:p,normals:m,indices:h,groups:g,mesh:y}=f,v=tt.compact(p,!0),x=tt.compact(h,!0),_=tt.compact(m,!0),w=tt.compact(g,!0);return on.create(v,x,_,w,f.vertices.elementCount,f.indices.elementCount,y)}}(Ct||(Ct={}));const wN=255/256,G9=C.create(16777216,65536,256),VKe=Bn.create(wN/G9[0],wN/G9[1],wN/G9[2],wN/1),nfe=Bn();function xy(e,t,n){switch($a.getGranularity(e,t.granularity)){case"uniform":return function $Ke(e,t,n){return function WKe(e,t){return t?(O.update(t.uSize,e),O.updateIfChanged(t.dSizeType,"uniform"),t):{uSize:O.create(e),tSize:O.create(GKe),uSizeTexDim:O.create(Ue.create(1,1)),dSizeType:O.create("uniform")}}(t(Gu),n)}(0,t.size,n);case"group":return function XKe(e,t,n){const{groupCount:r}=e,i=Sa(Math.max(1,r),3,Uint8Array,n&&n.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){const o=e.move();FD(t(o.location)*AN,i.array,3*o.groupIndex)}return q9(i,"group",n)}(e,t.size,n);case"groupInstance":return function KKe(e,t,n){const{groupCount:r,instanceCount:i}=e,s=Sa(Math.max(1,i*r),3,Uint8Array,n&&n.tSize.ref.value.array);for(e.reset();e.hasNext;){const a=e.move();FD(t(a.location)*AN,s.array,3*a.index)}return q9(s,"groupInstance",n)}(e,t.size,n);case"instance":return function YKe(e,t,n){const{instanceCount:r}=e,i=Sa(Math.max(1,r),3,Uint8Array,n&&n.tSize.ref.value.array);for(e.reset();e.hasNext&&!e.isNextNewInstance;){const o=e.move();FD(t(o.location)*AN,i.array,3*o.instanceIndex),e.skipInstance()}return q9(i,"instance",n)}(e,t.size,n)}}const AN=100;function OD(e){switch(e.dSizeType.ref.value){case"uniform":return e.uSize.ref.value;case"instance":case"group":case"groupInstance":let n=0;const r=e.tSize.ref.value.array;for(let i=0,o=r.length;i<o;i+=3){const s=H9(r[i],r[i+1],r[i+2]);n<s&&(n=s)}return n/AN}}const GKe={array:new Uint8Array(3),width:1,height:1};function q9(e,t,n){return n?(O.update(n.tSize,e),O.update(n.uSizeTexDim,Ue.create(e.width,e.height)),O.updateIfChanged(n.dSizeType,t),n):{uSize:O.create(0),tSize:O.create(e),uSizeTexDim:O.create(Ue.create(e.width,e.height)),dSizeType:O.create(t)}}var G1;function rfe(e,t,n,r,i,o,s){for(let a=0;a<t;a++){for(let l=0;l<n;l++)r[l]=e[l*t+a];ife(r,i,o,s,n);for(let l=0;l<n;l++)e[l*t+a]=i[l]}for(let a=0;a<n;a++){for(let l=0;l<t;l++)r[l]=e[a*t+l];ife(r,i,o,s,t);for(let l=0;l<t;l++)e[a*t+l]=Math.sqrt(i[l])}}function ife(e,t,n,r,i){n[0]=0,r[0]=Number.MIN_SAFE_INTEGER,r[1]=Number.MAX_SAFE_INTEGER;for(let o=1,s=0;o<i;o++){let a=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);for(;a<=r[s];)s--,a=(e[o]+o*o-(e[n[s]]+n[s]*n[s]))/(2*o-2*n[s]);s++,n[s]=o,r[s]=a,r[s+1]=Number.MAX_SAFE_INTEGER}for(let o=0,s=0;o<i;o++){for(;r[s+1]<o;)s++;t[o]=(o-n[s])*(o-n[s])+e[n[s]]}}!function(e){function t(m,h,g,y){return y?function o(m,h,g,y){return y.pointCount=g,O.update(y.centerBuffer,m),O.update(y.groupBuffer,h),y}(m,h,g,y):function i(m,h,g){const y=ke();let v,x=-1,_=-1;const w={kind:"points",pointCount:g,centerBuffer:O.create(m),groupBuffer:O.create(h),get boundingSphere(){const A=r(w);if(A!==x){const M=py(w.centerBuffer.ref.value,w.pointCount,1);ke.copy(y,M),x=A}return y},get groupMapping(){return w.groupBuffer.ref.version!==_&&(v=zw(w.groupBuffer.ref.value,w.pointCount),_=w.groupBuffer.ref.version),v},setBoundingSphere(A){ke.copy(y,A),x=r(w)}};return w}(m,h,g)}function n(m){return t(m?m.centerBuffer.ref.value:new Float32Array(0),m?m.groupBuffer.ref.value:new Float32Array(0),0,m)}function r(m){return Zc([m.pointCount,m.centerBuffer.ref.version,m.groupBuffer.ref.version])}function a(m,h){const g=m.pointCount,y=h.instanceCount.ref.value,v=V1(),x=v.position,_=m.centerBuffer.ref.value,w=h.aTransform.ref.value;return Vi(g,y,1,(M,E)=>(E<0?C.fromArray(x,_,3*M):C.transformMat4Offset(x,_,w,0,3*M,16*E),v))}function l(m,h,g,y,v){const{instanceCount:x,groupCount:_}=g,A=Ef(g,a(m,h),y.color),M=xy(g,y.size),E=v.instanceGranularity?hs(x,"instance"):hs(x*_,"groupInstance"),D=my(),T=gy(),F=by(),R=yy(),N={drawCount:m.pointCount,vertexCount:m.pointCount,groupCount:_,instanceCount:x},j=ke.clone(m.boundingSphere),W=pl(j,h.aTransform.ref.value,x,0);return{dGeometryType:O.create("points"),aPosition:m.centerBuffer,aGroup:m.groupBuffer,boundingSphere:O.create(W),invariantBoundingSphere:O.create(j),uInvariantBoundingSphere:O.create(Bn.ofSphere(j)),...A,...M,...E,...D,...T,...F,...R,...h,...xt.createValues(v,N),uSizeFactor:O.create(v.sizeFactor),dPointSizeAttenuation:O.create(v.pointSizeAttenuation),dPointStyle:O.create(v.pointStyle)}}function p(m,h){xt.updateRenderableState(m,h),m.opaque=m.opaque&&"fuzzy"!==h.pointStyle,m.writeDepth=m.opaque}e.create=t,e.createEmpty=n,e.transform=function s(m,h){const g=m.centerBuffer.ref.value;w_(h,g,0,m.pointCount),O.update(m.centerBuffer,g)},e.StyleTypes={square:"Square",circle:"Circle",fuzzy:"Fuzzy"},e.StyleTypeNames=Object.keys(e.StyleTypes),e.Params={...xt.Params,sizeFactor:I.Numeric(3,{min:0,max:10,step:.1}),pointSizeAttenuation:I.Boolean(!1),pointStyle:I.Select("square",I.objectToOptions(e.StyleTypes))},e.Utils={Params:e.Params,createEmpty:n,createValues:l,createValuesSimple:function c(m,h,g,y,v){const x=xt.createSimple(g,y,v),_={...I.getDefaultValues(e.Params),...h};return l(m,x.transform,x.locationIterator,x.theme,_)},updateValues:function u(m,h){xt.updateValues(m,h),O.updateIfChanged(m.uSizeFactor,h.sizeFactor),O.updateIfChanged(m.dPointSizeAttenuation,h.pointSizeAttenuation),O.updateIfChanged(m.dPointStyle,h.pointStyle)},updateBoundingSphere:function d(m,h){const g=ke.clone(h.boundingSphere),y=pl(g,m.aTransform.ref.value,m.instanceCount.ref.value,0);ke.equals(y,m.boundingSphere.ref.value)||O.update(m.boundingSphere,y),ke.equals(g,m.invariantBoundingSphere.ref.value)||(O.update(m.invariantBoundingSphere,g),O.update(m.uInvariantBoundingSphere,Bn.fromSphere(m.uInvariantBoundingSphere.ref.value,g)))},createRenderableState:function f(m){const h=xt.createRenderableState(m);return p(h,m),h},updateRenderableState:p,createPositionIterator:a}}(G1||(G1={}));const W9={},ofe={fontFamily:I.Select("sans-serif",[["sans-serif","Sans Serif"],["monospace","Monospace"],["serif","Serif"],["cursive","Cursive"]]),fontQuality:I.Select(3,[[0,"lower"],[1,"low"],[2,"medium"],[3,"high"],[4,"higher"]]),fontStyle:I.Select("normal",[["normal","Normal"],["italic","Italic"],["oblique","Oblique"]]),fontVariant:I.Select("normal",[["normal","Normal"],["small-caps","Small Caps"]]),fontWeight:I.Select("normal",[["normal","Normal"],["bold","Bold"]])};class QKe{constructor(t={}){this.mapped={},this.scratchW=0,this.scratchH=0,this.currentX=0,this.currentY=0,this.cutoff=.5;const n={...I.getDefaultValues(ofe),...t};this.props=n;const r=32*(n.fontQuality+1);this.buffer=r/8,this.radius=r/3,this.lineHeight=Math.round(r+2*this.buffer+this.radius),this.maxWidth=Math.round(.75*this.lineHeight),this.texture=Sa(350*this.lineHeight*this.maxWidth,1,Uint8Array),this.scratchContext=function eZe(e,t,n){if(a_)return function JKe(){throw new Error("When running in Node.js and wanting to use Canvas API, call mol-util/data-source's setCanvasModule function first and pass imported `canvas` module to it.")}().createCanvas(e,t).getContext("2d",n);{const r=document.createElement("canvas");return r.width=e,r.height=t,r.getContext("2d",n)}}(this.maxWidth,this.lineHeight,{willReadFrequently:!0}),this.scratchContext.font=`${n.fontStyle} ${n.fontVariant} ${n.fontWeight} ${r}px ${n.fontFamily}`,this.scratchContext.fillStyle="black",this.scratchContext.textBaseline="middle",this.scratchData=new Uint8Array(this.lineHeight*this.maxWidth),this.gridOuter=new Float64Array(this.lineHeight*this.maxWidth),this.gridInner=new Float64Array(this.lineHeight*this.maxWidth),this.f=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.d=new Float64Array(Math.max(this.lineHeight,this.maxWidth)),this.z=new Float64Array(Math.max(this.lineHeight,this.maxWidth)+1),this.v=new Int16Array(Math.max(this.lineHeight,this.maxWidth)),this.middle=Math.ceil(this.lineHeight/2),this.placeholder=this.get("\ufffd")}get(t){if(void 0===this.mapped[t]){this.draw(t);const{array:n,width:r,height:i}=this.texture,o=this.scratchData;if(this.currentX+this.scratchW>r&&(this.currentX=0,this.currentY+=this.scratchH),this.currentY+this.scratchH>i)return console.warn("canvas to small"),this.placeholder;this.mapped[t]={x:this.currentX,y:this.currentY,w:this.scratchW,h:this.scratchH,nw:this.scratchW/this.lineHeight,nh:this.scratchH/this.lineHeight};for(let s=0;s<this.scratchH;++s)for(let a=0;a<this.scratchW;++a)n[r*(this.currentY+s)+this.currentX+a]=o[s*this.scratchW+a];this.currentX+=this.scratchW}return this.mapped[t]}draw(t){const n=this.lineHeight,r=this.scratchContext,i=this.scratchData,o=r.measureText(t),s=Math.min(this.maxWidth,Math.ceil(o.width+2*this.buffer)),a=s*n;r.clearRect(0,0,s,n),r.fillText(t,this.buffer,this.middle);const l=r.getImageData(0,0,s,n);for(let c=0;c<a;c++){const u=l.data[4*c+3]/255;this.gridOuter[c]=1===u?0:0===u?Number.MAX_SAFE_INTEGER:Math.pow(Math.max(0,.5-u),2),this.gridInner[c]=1===u?Number.MAX_SAFE_INTEGER:0===u?0:Math.pow(Math.max(0,u-.5),2)}rfe(this.gridOuter,s,n,this.f,this.d,this.v,this.z),rfe(this.gridInner,s,n,this.f,this.d,this.v,this.z);for(let c=0;c<a;c++)i[c]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[c]-this.gridInner[c])/this.radius+this.cutoff))));this.scratchW=s,this.scratchH=n}}var Tf;function sfe(e,t,n,r){let i=0,o=0;for(let s=0,a=4*n;s<a;++s){const l=2*s,c=Math.abs(e[l]);c>i&&(i=c);const u=Math.abs(e[l+1]);u>i&&(i=u);const d=Math.abs(t[s]);d>o&&(o=d)}return Math.max(o,r+r*i)}!function(e){function t(p,m,h,g,y,v,x,_,w){return w?function o(p,m,h,g,y,v,x,_,w){return w.charCount=_,O.update(w.fontTexture,p),O.update(w.centerBuffer,m),O.update(w.mappingBuffer,h),O.update(w.depthBuffer,g),O.update(w.indexBuffer,y),O.update(w.groupBuffer,v),O.update(w.tcoordBuffer,x),w}(p,m,h,g,y,v,x,_,w):function i(p,m,h,g,y,v,x,_){const w=ke();let A,M=-1,E=-1;const D={kind:"text",charCount:_,fontTexture:O.create(p),centerBuffer:O.create(m),mappingBuffer:O.create(h),depthBuffer:O.create(g),indexBuffer:O.create(y),groupBuffer:O.create(v),tcoordBuffer:O.create(x),get boundingSphere(){const T=r(D);if(T!==M){const F=py(D.centerBuffer.ref.value,4*D.charCount,4);ke.copy(w,F),M=T}return w},get groupMapping(){return D.groupBuffer.ref.version!==E&&(A=zw(D.groupBuffer.ref.value,D.charCount,4),E=D.groupBuffer.ref.version),A},setBoundingSphere(T){ke.copy(w,T),M=r(D)}};return D}(p,m,h,g,y,v,x,_)}function n(p){return t(p?p.fontTexture.ref.value:Sa(0,1,Uint8Array),p?p.centerBuffer.ref.value:new Float32Array(0),p?p.mappingBuffer.ref.value:new Float32Array(0),p?p.depthBuffer.ref.value:new Float32Array(0),p?p.indexBuffer.ref.value:new Uint32Array(0),p?p.groupBuffer.ref.value:new Float32Array(0),p?p.tcoordBuffer.ref.value:new Float32Array(0),0,p)}function r(p){return Zc([p.charCount,p.fontTexture.ref.version,p.centerBuffer.ref.version,p.mappingBuffer.ref.version,p.depthBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.tcoordBuffer.ref.version])}function s(p,m){const h=4*p.charCount,g=m.instanceCount.ref.value,y=V1(),v=y.position,x=p.centerBuffer.ref.value,_=m.aTransform.ref.value;return Vi(h,g,4,(A,M)=>(M<0?C.fromArray(v,x,3*A):C.transformMat4Offset(v,x,_,0,3*A,16*M),y))}function a(p,m,h,g,y){const{instanceCount:v,groupCount:x}=h,w=Ef(h,s(p,m),g.color),A=xy(h,g.size),M=y.instanceGranularity?hs(v,"instance"):hs(v*x,"groupInstance"),E=my(),D=gy(),T=by(),F=yy(),R={drawCount:2*p.charCount*3,vertexCount:4*p.charCount,groupCount:x,instanceCount:v},N=sfe(p.mappingBuffer.ref.value,p.depthBuffer.ref.value,p.charCount,OD(A)),j=ke.expand(ke(),p.boundingSphere,N),W=pl(j,m.aTransform.ref.value,v,0);return{dGeometryType:O.create("text"),aPosition:p.centerBuffer,aMapping:p.mappingBuffer,aDepth:p.depthBuffer,aGroup:p.groupBuffer,elements:p.indexBuffer,boundingSphere:O.create(W),invariantBoundingSphere:O.create(j),uInvariantBoundingSphere:O.create(Bn.ofSphere(j)),...w,...A,...M,...E,...D,...T,...F,...m,aTexCoord:p.tcoordBuffer,tFont:p.fontTexture,padding:O.create(N),...xt.createValues(y,R),uSizeFactor:O.create(y.sizeFactor),uBorderWidth:O.create(al(y.borderWidth,0,.5)),uBorderColor:O.create(st.toArrayNormalized(y.borderColor,C.zero(),0)),uOffsetX:O.create(y.offsetX),uOffsetY:O.create(y.offsetY),uOffsetZ:O.create(y.offsetZ),uBackgroundColor:O.create(st.toArrayNormalized(y.backgroundColor,C.zero(),0)),uBackgroundOpacity:O.create(y.backgroundOpacity)}}function f(p,m){xt.updateRenderableState(p,m),p.pickable=!1,p.opaque=!1,p.writeDepth=!0}e.create=t,e.createEmpty=n,e.Params={...xt.Params,...ofe,sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),borderWidth:I.Numeric(0,{min:0,max:.5,step:.01}),borderColor:I.Color(qn.grey),offsetX:I.Numeric(0,{min:0,max:10,step:.1}),offsetY:I.Numeric(0,{min:0,max:10,step:.1}),offsetZ:I.Numeric(0,{min:0,max:10,step:.1}),background:I.Boolean(!1),backgroundMargin:I.Numeric(.2,{min:0,max:1,step:.01}),backgroundColor:I.Color(qn.grey),backgroundOpacity:I.Numeric(1,{min:0,max:1,step:.01}),tether:I.Boolean(!1),tetherLength:I.Numeric(1,{min:0,max:5,step:.1}),tetherBaseWidth:I.Numeric(.3,{min:0,max:1,step:.01}),attachment:I.Select("middle-center",[["bottom-left","bottom-left"],["bottom-center","bottom-center"],["bottom-right","bottom-right"],["middle-left","middle-left"],["middle-center","middle-center"],["middle-right","middle-right"],["top-left","top-left"],["top-center","top-center"],["top-right","top-right"]])},e.Utils={Params:e.Params,createEmpty:n,createValues:a,createValuesSimple:function l(p,m,h,g,y){const v=xt.createSimple(h,g,y),x={...I.getDefaultValues(e.Params),...m};return a(p,v.transform,v.locationIterator,v.theme,x)},updateValues:function c(p,m){xt.updateValues(p,m),O.updateIfChanged(p.uSizeFactor,m.sizeFactor),O.updateIfChanged(p.uBorderWidth,m.borderWidth),st.fromNormalizedArray(p.uBorderColor.ref.value,0)!==m.borderColor&&(st.toArrayNormalized(m.borderColor,p.uBorderColor.ref.value,0),O.update(p.uBorderColor,p.uBorderColor.ref.value)),O.updateIfChanged(p.uOffsetX,m.offsetX),O.updateIfChanged(p.uOffsetY,m.offsetY),O.updateIfChanged(p.uOffsetZ,m.offsetZ),st.fromNormalizedArray(p.uBackgroundColor.ref.value,0)!==m.backgroundColor&&(st.toArrayNormalized(m.backgroundColor,p.uBackgroundColor.ref.value,0),O.update(p.uBackgroundColor,p.uBackgroundColor.ref.value)),O.updateIfChanged(p.uBackgroundOpacity,m.backgroundOpacity)},updateBoundingSphere:function u(p,m){const h=sfe(p.aMapping.ref.value,p.aDepth.ref.value,m.charCount,OD(p)),g=ke.expand(ke(),m.boundingSphere,h),y=pl(g,p.aTransform.ref.value,p.instanceCount.ref.value,0);ke.equals(y,p.boundingSphere.ref.value)||O.update(p.boundingSphere,y),ke.equals(g,p.invariantBoundingSphere.ref.value)||(O.update(p.invariantBoundingSphere,g),O.update(p.uInvariantBoundingSphere,Bn.fromSphere(p.uInvariantBoundingSphere.ref.value,g))),O.update(p.padding,h)},createRenderableState:function d(p){const m=xt.createRenderableState(p);return f(m,p),m},updateRenderableState:f,createPositionIterator:s}}(Tf||(Tf={}));const qu=C(),Zh=C(),BD=C(),afe=tt.add,IN=tt.add3;var Pd,Mo;!function(e){e.create=function t(n=2048,r=1024,i){const o=tt.create(Float32Array,1,r,i?i.groupBuffer.ref.value:n),s=tt.create(Float32Array,3,r,i?i.startBuffer.ref.value:n),a=tt.create(Float32Array,3,r,i?i.endBuffer.ref.value:n),l=(d,f,p,m,h,g,y)=>{for(let v=0;v<4;++v)IN(s,d,f,p),IN(a,m,h,g),afe(o,y)},u=(d,f,p,m)=>{const h=C.distance(d,f),g=p%2!=0,y=Math.floor((p+1)/2),v=h/(p+.5);C.setMagnitude(BD,C.sub(BD,f,d),v),C.copy(qu,d);for(let x=0;x<y;++x)C.add(qu,qu,BD),g&&x===y-1?C.copy(Zh,f):C.add(Zh,qu,BD),l(qu[0],qu[1],qu[2],Zh[0],Zh[1],Zh[2],m),C.add(qu,qu,BD)};return{add:l,addVec:(d,f,p)=>{for(let m=0;m<4;++m)IN(s,d[0],d[1],d[2]),IN(a,f[0],f[1],f[2]),afe(o,p)},addFixedCountDashes:u,addFixedLengthDashes:(d,f,p,m)=>{const h=C.distance(d,f);u(d,f,h/p,m)},addCage:(d,f,p)=>{const{vertices:m,edges:h}=f;for(let g=0,y=h.length;g<y;g+=2)C.fromArray(qu,m,3*h[g]),C.fromArray(Zh,m,3*h[g+1]),C.transformMat4(qu,qu,d),C.transformMat4(Zh,Zh,d),l(qu[0],qu[1],qu[2],Zh[0],Zh[1],Zh[2],p)},getLines:()=>{const d=o.elementCount/4,f=tt.compact(o,!0),p=tt.compact(s,!0),m=tt.compact(a,!0),h=i&&d<=i.lineCount?i.mappingBuffer.ref.value:new Float32Array(8*d),g=i&&d<=i.lineCount?i.indexBuffer.ref.value:new Uint32Array(6*d);return(!i||d>i.lineCount)&&function tZe(e,t,n){for(let r=0;r<e;++r){const i=8*r;t[i]=-1,t[i+1]=-1,t[i+2]=1,t[i+3]=-1,t[i+4]=-1,t[i+5]=1,t[i+6]=1,t[i+7]=1}for(let r=0;r<e;++r){const i=4*r,o=6*r;n[o]=i,n[o+1]=i+1,n[o+2]=i+2,n[o+3]=i+1,n[o+4]=i+3,n[o+5]=i+2}}(d,h,g),Mo.create(h,g,f,p,m,d,i)}}}}(Pd||(Pd={})),function(e){function t(p,m,h,g,y,v,x){return x?function s(p,m,h,g,y,v,x){return v>x.lineCount&&(O.update(x.mappingBuffer,p),O.update(x.indexBuffer,m)),x.lineCount=v,O.update(x.groupBuffer,h),O.update(x.startBuffer,g),O.update(x.endBuffer,y),x}(p,m,h,g,y,v,x):function o(p,m,h,g,y,v){const x=ke();let _,w=-1,A=-1;const M={kind:"lines",lineCount:v,mappingBuffer:O.create(p),indexBuffer:O.create(m),groupBuffer:O.create(h),startBuffer:O.create(g),endBuffer:O.create(y),get boundingSphere(){const E=i(M);if(E!==w){const D=py(M.startBuffer.ref.value,4*M.lineCount,4),T=py(M.endBuffer.ref.value,4*M.lineCount,4);ke.expandBySphere(x,D,T),w=E}return x},get groupMapping(){return M.groupBuffer.ref.version!==A&&(_=zw(M.groupBuffer.ref.value,M.lineCount,4),A=M.groupBuffer.ref.version),_},setBoundingSphere(E){ke.copy(x,E),w=i(M)}};return M}(p,m,h,g,y,v)}function n(p){return t(p?p.mappingBuffer.ref.value:new Float32Array(0),p?p.indexBuffer.ref.value:new Uint32Array(0),p?p.groupBuffer.ref.value:new Float32Array(0),p?p.startBuffer.ref.value:new Float32Array(0),p?p.endBuffer.ref.value:new Float32Array(0),0,p)}function i(p){return Zc([p.lineCount,p.mappingBuffer.ref.version,p.indexBuffer.ref.version,p.groupBuffer.ref.version,p.startBuffer.ref.version,p.endBuffer.ref.version])}function l(p,m){const h=4*p.lineCount,g=m.instanceCount.ref.value,y=V1(),v=y.position,x=p.startBuffer.ref.value,_=p.endBuffer.ref.value,w=m.aTransform.ref.value;return Vi(h,g,2,(M,E)=>{const D=M%4==0?x:_;return E<0?C.fromArray(v,D,3*M):C.transformMat4Offset(v,D,w,0,3*M,16*E),y})}function c(p,m,h,g,y){const{instanceCount:v,groupCount:x}=h,w=Ef(h,l(p,m),g.color),A=xy(h,g.size),M=y.instanceGranularity?hs(v,"instance"):hs(v*x,"groupInstance"),E=my(),D=gy(),T=by(),F=yy(),R={drawCount:2*p.lineCount*3,vertexCount:4*p.lineCount,groupCount:x,instanceCount:v},N=ke.clone(p.boundingSphere),j=pl(N,m.aTransform.ref.value,v,0);return{dGeometryType:O.create("lines"),aMapping:p.mappingBuffer,aGroup:p.groupBuffer,aStart:p.startBuffer,aEnd:p.endBuffer,elements:p.indexBuffer,boundingSphere:O.create(j),invariantBoundingSphere:O.create(N),uInvariantBoundingSphere:O.create(Bn.ofSphere(N)),...w,...A,...M,...E,...D,...T,...F,...m,...xt.createValues(y,R),uSizeFactor:O.create(y.sizeFactor),dLineSizeAttenuation:O.create(y.lineSizeAttenuation),uDoubleSided:O.create(!0),dFlipSided:O.create(!1)}}e.create=t,e.createEmpty=n,e.fromMesh=function r(p,m){const h=p.vertexBuffer.ref.value,g=p.indexBuffer.ref.value,y=p.groupBuffer.ref.value,v=Pd.create(3*p.triangleCount,p.triangleCount/10,m);for(let x=0,_=3*p.triangleCount;x<_;x+=3){const w=g[x],A=g[x+1],M=g[x+2],E=h[3*w],D=h[3*w+1],T=h[3*w+2],F=h[3*A],R=h[3*A+1],N=h[3*A+2],j=h[3*M],W=h[3*M+1],z=h[3*M+2];v.add(E,D,T,F,R,N,y[w]),v.add(E,D,T,j,W,z,y[w]),v.add(F,R,N,j,W,z,y[A])}return v.getLines()},e.transform=function a(p,m){const h=p.startBuffer.ref.value;w_(m,h,0,4*p.lineCount),O.update(p.startBuffer,h);const g=p.endBuffer.ref.value;w_(m,g,0,4*p.lineCount),O.update(p.endBuffer,g)},e.Params={...xt.Params,sizeFactor:I.Numeric(2,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1)},e.Utils={Params:e.Params,createEmpty:n,createValues:c,createValuesSimple:function u(p,m,h,g,y){const v=xt.createSimple(h,g,y),x={...I.getDefaultValues(e.Params),...m};return c(p,v.transform,v.locationIterator,v.theme,x)},updateValues:function d(p,m){xt.updateValues(p,m),O.updateIfChanged(p.uSizeFactor,m.sizeFactor),O.updateIfChanged(p.dLineSizeAttenuation,m.lineSizeAttenuation)},updateBoundingSphere:function f(p,m){const h=ke.clone(m.boundingSphere),g=pl(h,p.aTransform.ref.value,p.instanceCount.ref.value,0);ke.equals(g,p.boundingSphere.ref.value)||O.update(p.boundingSphere,g),ke.equals(h,p.invariantBoundingSphere.ref.value)||(O.update(p.invariantBoundingSphere,h),O.update(p.uInvariantBoundingSphere,Bn.fromSphere(p.uInvariantBoundingSphere.ref.value,h)))},createRenderableState:xt.createRenderableState,updateRenderableState:xt.updateRenderableState,createPositionIterator:l}}(Mo||(Mo={}));const _y=C(),Sy=C(),Cy=C(),Xw=C(),$s=gg(4,!0);function lfe(e){const r=Hw(12,e?36:24);for(let i=0;i<4;++i){const o=(i+1)%4;C.set(_y,$s[3*i],$s[3*i+1],-.5),C.set(Sy,$s[3*o],$s[3*o+1],-.5),C.set(Cy,$s[3*o],$s[3*o+1],.5),C.set(Xw,$s[3*i],$s[3*i+1],.5),e?r.add(_y,Sy,Cy):r.addQuad(_y,Sy,Cy,Xw)}return C.set(_y,$s[0],$s[1],-.5),C.set(Sy,$s[3],$s[4],-.5),C.set(Cy,$s[6],$s[7],-.5),C.set(Xw,$s[9],$s[10],-.5),e?r.add(Cy,Sy,_y):r.addQuad(Xw,Cy,Sy,_y),C.set(_y,$s[0],$s[1],.5),C.set(Sy,$s[3],$s[4],.5),C.set(Cy,$s[6],$s[7],.5),C.set(Xw,$s[9],$s[10],.5),e?r.add(_y,Sy,Cy):r.addQuad(_y,Sy,Cy,Xw),r.getPrimitive()}let Y9,K9,Z9;function X9(){return Y9||(Y9=lfe(!1)),Y9}function cfe(){return Z9||(Z9=MD([.5,.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5],[0,4,1,5,2,6,3,7,0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4])),Z9}function ufe(e){return e.map(t=>({x:t[0],alpha:t[1]}))}function dfe(e,t){const n=[{x:0,alpha:0},{x:0,alpha:0},...e,{x:1,alpha:0},{x:1,alpha:0}],i=t?t.ref.value.array:new Uint8Array(256);let s,a,l,c,u,d,o=0;const f=e.length+1;for(let m=0;m<f;++m){s=n[m+1].x,a=n[m+2].x,l=n[m].alpha,c=n[m+1].alpha,u=n[m+2].alpha,d=n[m+3].alpha;const h=Math.round(256*(a-s));for(let g=0;g<h;++g)i[o]=Math.max(0,255*TR(l,c,u,d,g/h,.5)),++o}const p={array:i,width:256,height:1};return t?(O.update(t,p),t):O.create(p)}function ffe(e,t,n,r){let i=(r-n)/t;0===i&&(i=1);const o=new Int32Array(t);for(let s=0,a=e.length;s<a;s++){let l=Math.floor((e[s]-n)/i);l>=t?l=t-1:l<0&&(l=0),o[l]++}return{min:n,max:r,binWidth:i,counts:o}}var Ca,EN,TN,mt;function pfe(e,t){return Ke.create("Create Volume",function(){var n=le(function*(r){const{volume_data_3d_info:i,volume_data_3d:o}=e,s=Qc.create(i.spacegroup_number.value(0),C.ofArray(i.spacegroup_cell_size.value(0)),C.scale(C.zero(),C.ofArray(i.spacegroup_cell_angles.value(0)),Math.PI/180)),a=i.axis_order.value(0),l=mr.convertToCanonicalAxisIndicesFastToSlow(a),c=l(i.sample_count.value(0)),u=mr.Space(c,mr.invertAxisOrder(a),Float32Array),d=mr.create(u,mr.Data1(o.values.toArray({array:Float32Array}))),f=C.ofArray(l(i.origin.value(0))),p=C.ofArray(l(i.dimensions.value(0)));return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:s,fractionalBox:Gt.create(f,C.add(C.zero(),f,p))},cells:d,stats:{min:i.min_sampled.value(0),max:i.max_sampled.value(0),mean:i.mean_sampled.value(0),sigma:i.sigma_sampled.value(0)}},sourceData:TN.create(e),customProperties:new Oh,_propertyData:Object.create(null)}});return function(r){return n.apply(this,arguments)}}())}!function(e){e.One={transform:{kind:"matrix",matrix:fe.identity()},cells:mr.create(mr.Space([1,1,1],[0,1,2]),mr.Data1([0])),stats:{min:0,max:0,mean:0,sigma:0}};const t=fe.zero(),n=fe.zero();e.getGridToCartesianTransform=function r(l){if("matrix"===l.transform.kind)return fe.copy(fe(),l.transform.matrix);if("spacegroup"===l.transform.kind){const{cells:{space:c}}=l,u=fe.fromScaling(t,C.div(C.zero(),Gt.size(C.zero(),l.transform.fractionalBox),C.ofArray(c.dimensions))),d=fe.fromTranslation(n,l.transform.fractionalBox.min);return fe.mul3(fe.zero(),l.transform.cell.fromFractional,d,u)}return fe.identity()},e.areEquivalent=function i(l,c){return l===c},e.isEmpty=function o(l){return 0===l.cells.data.length},e.getBoundingSphere=function s(l,c){c||(c=ke());const u=l.cells.space.dimensions,d=e.getGridToCartesianTransform(l);return ke.fromDimensionsAndTransform(c,u,d)},e.getHistogram=function a(l,c){let u=l._historams;return u||(u=l._historams={}),u[c]||(u[c]=function rZe(e,t,n){if(n)return ffe(e,t,n.min,n.max);{const[r,i]=mf(e);return ffe(e,t,r,i)}}(l.cells.data,c,{min:l.stats.min,max:l.stats.max})),u[c]}}(Ca||(Ca={})),function(e){e.is=function t(r){return"cube"===r?.kind},e.create=function n(r){return{kind:"cube",name:r.name,data:r}}}(EN||(EN={})),function(e){e.is=function t(r){return"dscif"===r?.kind},e.create=function n(r){return{kind:"dscif",name:r._name,data:r}}}(TN||(TN={})),function(e){let n;e.is=function t(y){var v,x,_,w;return(null===(w=null===(_=null===(x=null===(v=y?.grid)||void 0===v?void 0:v.cells)||void 0===x?void 0:x.space)||void 0===_?void 0:_.dimensions)||void 0===w?void 0:w.length)&&y?.sourceData&&y?.customProperties&&y?._propertyData},function(y){function M(T,F){return"absolute"===T.kind?T:{kind:"absolute",absoluteValue:y.calcAbsolute(F,T.relativeValue)}}y.areSame=function v(T,F,R){return Do(M(T,R).absoluteValue,M(F,R).absoluteValue,R.sigma/100)},y.absolute=function x(T){return{kind:"absolute",absoluteValue:T}},y.relative=function _(T){return{kind:"relative",relativeValue:T}},y.calcAbsolute=function w(T,F){return F*T.sigma+T.mean},y.calcRelative=function A(T,F){return 0===T.sigma?0:(F-T.mean)/T.sigma},y.toAbsolute=M,y.toRelative=function E(T,F){return"relative"===T.kind?T:{kind:"relative",relativeValue:y.calcRelative(F,T.absoluteValue)}},y.toString=function D(T){return"relative"===T.kind?`${T.relativeValue.toFixed(2)} \u03c3`:`${T.absoluteValue.toPrecision(4)}`}}(n=e.IsoValue||(e.IsoValue={})),e.adjustedIsoValue=function r(y,v,x){if("relative"===x)return n.relative(v);const _=n.absolute(v);if(TN.is(y.sourceData)){const w={min:y.sourceData.data.volume_data_3d_info.min_source.value(0),max:y.sourceData.data.volume_data_3d_info.max_source.value(0),mean:y.sourceData.data.volume_data_3d_info.mean_source.value(0),sigma:y.sourceData.data.volume_data_3d_info.sigma_source.value(0)};return e.IsoValue.toRelative(_,w)}return _};const i={min:-1,max:1,mean:0,sigma:.1};function o(y,v){const x=v||i,{min:_,max:w,mean:A,sigma:M}=x,E=(_-A)/M,D=(w-A)/M;let T=y;return"absolute"===y.kind?y.absoluteValue<_?T=e.IsoValue.absolute(_):y.absoluteValue>w&&(T=e.IsoValue.absolute(w)):y.relativeValue<E?T=e.IsoValue.relative(E):y.relativeValue>D&&(T=e.IsoValue.relative(D)),I.Conditioned(T,{absolute:I.Converted(F=>e.IsoValue.toAbsolute(F,Ca.One.stats).absoluteValue,F=>e.IsoValue.absolute(F),I.Numeric(A,{min:_,max:w,step:az(M/100,2)},{immediateUpdate:!0})),relative:I.Converted(F=>e.IsoValue.toRelative(F,Ca.One.stats).relativeValue,F=>e.IsoValue.relative(F),I.Numeric(Math.min(1,D),{min:E,max:D,step:az(Math.round((w-_)/M)/100,2)},{immediateUpdate:!0}))},F=>"absolute"===F.kind?"absolute":"relative",(F,R)=>"absolute"===R?e.IsoValue.toAbsolute(F,x):e.IsoValue.toRelative(F,x),{isEssential:!0})}let m,h,g;e.createIsoValueParam=o,e.IsoValueParam=o(e.IsoValue.relative(2)),e.One={label:"",grid:Ca.One,sourceData:{kind:"",name:"",data:{}},customProperties:new Oh,_propertyData:Object.create(null)},e.areEquivalent=function s(y,v){return Ca.areEquivalent(y.grid,v.grid)},e.isEmpty=function a(y){return Ca.isEmpty(y.grid)},e.isOrbitals=function l(y){return!!EN.is(y.sourceData)&&y.sourceData.data.header.orbitals},e.Loci=function c(y){return{kind:"volume-loci",volume:y}},e.isLoci=function u(y){return!!y&&"volume-loci"===y.kind},e.areLociEqual=function d(y,v){return y.volume===v.volume},e.isLociEmpty=function f(y){return Ca.isEmpty(y.volume.grid)},e.getBoundingSphere=function p(y,v){return Ca.getBoundingSphere(y.grid,v)},function(y){y.Loci=function v(E,D){return{kind:"isosurface-loci",volume:E,isoValue:D}},y.isLoci=function x(E){return!!E&&"isosurface-loci"===E.kind},y.areLociEqual=function _(E,D){return E.volume===D.volume&&e.IsoValue.areSame(E.isoValue,D.isoValue,E.volume.grid.stats)},y.isLociEmpty=function w(E){return 0===E.volume.grid.cells.data.length};const A=Gt();y.getBoundingSphere=function M(E,D,T){const F=e.IsoValue.toAbsolute(D,E.grid.stats).absoluteValue,R=F<0,N=[0,0,0],j=E.grid.cells.space.getCoords,W=E.grid.cells.data,[z,$,V]=E.grid.cells.space.dimensions;let X=z-1,H=$-1,oe=V-1,te=0,K=0,Q=0;for(let Z=0,ee=W.length;Z<ee;++Z)(R&&W[Z]<=F||!R&&W[Z]>=F)&&(j(Z,N),N[0]<X&&(X=N[0]),N[1]<H&&(H=N[1]),N[2]<oe&&(oe=N[2]),N[0]>te&&(te=N[0]),N[1]>K&&(K=N[1]),N[2]>Q&&(Q=N[2]));C.set(A.min,X-1,H-1,oe-1),C.set(A.max,te+1,K+1,Q+1);const G=Ca.getGridToCartesianTransform(E.grid);return Gt.transform(A,A,G),ke.fromBox3D(T||ke(),A)}}(m=e.Isosurface||(e.Isosurface={})),function(y){y.Loci=function v(D,T){return{kind:"cell-loci",volume:D,indices:T}},y.isLoci=function x(D){return!!D&&"cell-loci"===D.kind},y.areLociEqual=function _(D,T){return D.volume===T.volume&&Ve.areEqual(D.indices,T.indices)},y.isLociEmpty=function w(D){return 0===Ve.size(D.indices)};const A=new xf("98"),M=C();y.getBoundingSphere=function E(D,T,F){A.reset();const R=Ca.getGridToCartesianTransform(D.grid),{getCoords:N}=D.grid.cells.space;for(let W=0,z=Ve.size(T);W<z;W++)N(Ve.getAt(T,W),M),C.transformMat4(M,M,R),A.includePosition(M);A.finishedIncludeStep();for(let W=0,z=Ve.size(T);W<z;W++)N(Ve.getAt(T,W),M),C.transformMat4(M,M,R),A.radiusPosition(M);const j=A.getSphere(F);return ke.expand(j,j,10*fe.getMaxScaleOnAxis(R))}}(h=e.Cell||(e.Cell={})),function(y){y.Loci=function v(T,F){return{kind:"segment-loci",volume:T,segments:rt.ofUnsortedArray(F)}},y.isLoci=function x(T){return!!T&&"segment-loci"===T.kind},y.areLociEqual=function _(T,F){return T.volume===F.volume&&rt.areEqual(T.segments,F.segments)},y.isLociEmpty=function w(T){return 0===T.volume.grid.cells.data.length||0===T.segments.length};const A=Gt();y.getBoundingSphere=function M(T,F,R){const N=e.Segmentation.get(T);if(N){Gt.setEmpty(A);for(let W=0,z=F.length;W<z;++W){const $=N.bounds[F[W]];Gt.add(A,$.min),Gt.add(A,$.max)}const j=Ca.getGridToCartesianTransform(T.grid);return Gt.transform(A,A,j),ke.fromBox3D(R||ke(),A)}return e.getBoundingSphere(T,R)},y.Location=function E(T,F){return{kind:"segment-location",volume:T,segment:F}},y.isLocation=function D(T){return!!T&&"segment-location"===T.kind}}(g=e.Segment||(e.Segment={})),e.PickingGranularity={set(y,v){y._propertyData.__picking_granularity__=v},get(y){var v;return null!==(v=y._propertyData.__picking_granularity__)&&void 0!==v?v:"voxel"}},e.Segmentation={set(y,v){y._propertyData.__segmentation__=v},get:y=>y._propertyData.__segmentation__}}(mt||(mt={}));const Q9=X9();var Df,Rp,iu;function Pi(e,t,n){return{type:"attribute",kind:e,itemSize:t,divisor:n}}function Ne(e,t){return{type:"uniform",kind:e,variant:t}}function xn(e,t,n,r,i){return{type:"texture",kind:e,format:t,dataType:n,filter:r,variant:i}}function Kw(e){return{type:"elements",kind:e}}function cn(e,t){return{type:"define",kind:e,options:t}}function _o(e){return{type:"value",kind:e}}!function(e){function t(g,y,v,x,_,w,A,M,E,D){return D?function i(g,y,v,x,_,w,A,M,E,D){const T=w.getWidth(),F=w.getHeight(),R=w.getDepth();return O.update(D.gridDimension,y),O.update(D.gridTexture,w),O.update(D.gridTextureDim,C.set(D.gridTextureDim.ref.value,T,F,R)),O.update(D.gridStats,Bn.set(D.gridStats.ref.value,A.min,A.max,A.mean,A.sigma)),O.update(D.bboxMin,g.min),O.update(D.bboxMax,g.max),O.update(D.bboxSize,C.sub(D.bboxSize.ref.value,g.max,g.min)),O.update(D.transform,v),O.update(D.cellDim,_),O.update(D.unitToCartn,x),O.update(D.cartnToUnit,fe.invert(fe(),x)),O.updateIfChanged(D.packedGroup,M),O.updateIfChanged(D.axisOrder,C.fromArray(D.axisOrder.ref.value,E,0)),D}(g,y,v,x,_,w,A,M,E,D):function r(g,y,v,x,_,w,A,M,E){const D=ke();let T=-1;const F=w.getWidth(),R=w.getHeight(),N=w.getDepth(),j={kind:"direct-volume",gridDimension:O.create(y),gridTexture:O.create(w),gridTextureDim:O.create(C.create(F,R,N)),gridStats:O.create(Bn.create(A.min,A.max,A.mean,A.sigma)),bboxMin:O.create(g.min),bboxMax:O.create(g.max),bboxSize:O.create(C.sub(C(),g.max,g.min)),transform:O.create(v),cellDim:O.create(_),unitToCartn:O.create(x),cartnToUnit:O.create(fe.invert(fe(),x)),get boundingSphere(){const W=n(j);if(W!==T){const z=function oZe(e,t){return ke.fromDimensionsAndTransform(ke(),e,t)}(j.gridDimension.ref.value,j.transform.ref.value);ke.copy(D,z),T=W}return D},packedGroup:O.create(M),axisOrder:O.create(E),setBoundingSphere(W){ke.copy(D,W),T=n(j)}};return j}(g,y,v,x,_,w,A,M,E)}function n(g){return Zc([g.bboxSize.ref.version,g.gridDimension.ref.version,g.gridTexture.ref.version,g.transform.ref.version,g.gridStats.ref.version])}function o(g){return t(Gt(),C(),fe.identity(),fe.identity(),C(),lc(),Ca.One.stats,!1,C.create(0,1,2),g)}function a(g,y){return Math.ceil(C.magnitude(g)*y)}function l(g,y){return Math.min(...g)*(1/y)}function c(g){return 1/g}function u(g,y,v,x,_){const{gridTexture:w,gridTextureDim:A,gridStats:M}=g,{bboxSize:E,bboxMin:D,bboxMax:T,gridDimension:F,transform:R}=g,{instanceCount:N,groupCount:j}=v,z=Ef(v,e.Utils.createPositionIterator(g,y),x.color),$=_.instanceGranularity?hs(N,"instance"):hs(N*j,"groupInstance"),V=my(),X=gy(),H=by(),oe=yy(),[te,K,Q]=F.ref.value,G={drawCount:Q9.indices.length,vertexCount:te*K*Q,groupCount:j,instanceCount:N},Z=ke.clone(g.boundingSphere),ee=pl(Z,y.aTransform.ref.value,N,0),xe=dfe(ufe(_.controlPoints));return{dGeometryType:O.create("directVolume"),...z,...$,...V,...X,...H,...oe,...y,...xt.createValues(_,G),aPosition:O.create(Q9.vertices),elements:O.create(Q9.indices),boundingSphere:O.create(ee),invariantBoundingSphere:O.create(Z),uInvariantBoundingSphere:O.create(Bn.ofSphere(Z)),uBboxMin:D,uBboxMax:T,uBboxSize:E,uMaxSteps:O.create(a(F.ref.value,_.stepsPerCell)),uStepScale:O.create(l(g.cellDim.ref.value,_.stepsPerCell)),uJumpLength:O.create(_.jumpLength),uTransform:R,uGridDim:F,tTransferTex:xe,uTransferScale:O.create(c(_.stepsPerCell)),dGridTexType:O.create(w.ref.value.getDepth()>0?"3d":"2d"),uGridTexDim:A,tGridTex:w,uGridStats:M,uCellDim:g.cellDim,uCartnToUnit:g.cartnToUnit,uUnitToCartn:g.unitToCartn,dPackedGroup:g.packedGroup,dAxisOrder:O.create(g.axisOrder.ref.value.join("")),dIgnoreLight:O.create(_.ignoreLight),dXrayShaded:O.create("inverted"===_.xrayShaded?"inverted":!0===_.xrayShaded?"on":"off")}}e.create=t,e.createEmpty=o,e.Params={...xt.Params,ignoreLight:I.Boolean(!1,xt.ShadingCategory),xrayShaded:I.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],xt.ShadingCategory),controlPoints:I.LineGraph([Ue.create(.19,0),Ue.create(.2,.05),Ue.create(.25,.05),Ue.create(.26,0),Ue.create(.79,0),Ue.create(.8,.05),Ue.create(.85,.05),Ue.create(.86,0)],{isEssential:!0}),stepsPerCell:I.Numeric(3,{min:1,max:10,step:1}),jumpLength:I.Numeric(0,{min:0,max:20,step:.1})},e.Utils={Params:e.Params,createEmpty:o,createValues:u,createValuesSimple:function d(g,y,v,x,_){const w=xt.createSimple(v,x,_),A={...I.getDefaultValues(e.Params),...y};return u(g,w.transform,w.locationIterator,w.theme,A)},updateValues:function f(g,y){xt.updateValues(g,y),O.updateIfChanged(g.dIgnoreLight,y.ignoreLight),O.updateIfChanged(g.dXrayShaded,"inverted"===y.xrayShaded?"inverted":!0===y.xrayShaded?"on":"off"),dfe(ufe(y.controlPoints),g.tTransferTex),O.updateIfChanged(g.uMaxSteps,a(g.uGridDim.ref.value,y.stepsPerCell)),O.updateIfChanged(g.uStepScale,l(g.uCellDim.ref.value,y.stepsPerCell)),O.updateIfChanged(g.uTransferScale,c(y.stepsPerCell)),O.updateIfChanged(g.uJumpLength,y.jumpLength)},updateBoundingSphere:function p(g,y){const v=ke.clone(y.boundingSphere),x=pl(v,g.aTransform.ref.value,g.instanceCount.ref.value,0);ke.equals(x,g.boundingSphere.ref.value)||O.update(g.boundingSphere,x),ke.equals(v,g.invariantBoundingSphere.ref.value)||(O.update(g.invariantBoundingSphere,v),O.update(g.uInvariantBoundingSphere,Bn.fromSphere(g.uInvariantBoundingSphere.ref.value,v)))},createRenderableState:function m(g){const y=xt.createRenderableState(g);return y.opaque=!1,y.writeDepth=!1,y},updateRenderableState:function h(g,y){xt.updateRenderableState(g,y),g.opaque=!1,g.writeDepth=!1},createPositionIterator:function s(g,y){const v=g.transform.ref.value,[x,_,w]=g.gridDimension.ref.value,A=x*_*w,M=y.instanceCount.ref.value,E=V1(),D=E.position,T=y.aTransform.ref.value;return Vi(A,M,1,(R,N)=>{const j=Math.floor(R/w);return D[0]=Math.floor(j/_),D[1]=j%_,D[2]=R%w,C.transformMat4(D,D,v),N>=0&&C.transformMat4Offset(D,D,T,0,0,16*N),E})}}}(Df||(Df={})),function(e){function t(x,_,w,A){return A?function o(x,_,w,A){return A.sphereCount=w,O.update(A.centerBuffer,x),O.update(A.groupBuffer,_),A.shaderData.update(),A}(x,_,w,A):function i(x,_,w){const A=ke();let M,E=-1,D=-1;const T=O.create(Sa(1,4,Float32Array)),F=O.create(Ue.create(0,0)),R=O.create([]),N=O.create(0),j={kind:"spheres",sphereCount:w,centerBuffer:O.create(x),groupBuffer:O.create(_),get boundingSphere(){const W=r(j);if(W!==E){const z=py(j.centerBuffer.ref.value,4*j.sphereCount,4);ke.copy(A,z),E=W}return A},get groupMapping(){return j.groupBuffer.ref.version!==D&&(M=zw(j.groupBuffer.ref.value,j.sphereCount,4),D=j.groupBuffer.ref.version),M},setBoundingSphere(W){ke.copy(A,W),E=r(j)},shaderData:{positionGroup:T,texDim:F,lodLevels:R,sizeFactor:N,update(W){var z,$;const V=null!==(z=W?.lodLevels)&&void 0!==z?z:c(R.ref.value),X=null!==($=W?.sizeFactor)&&void 0!==$?$:N.ref.value,H=d(V,X),oe=Sa(j.sphereCount,4,Float32Array,T.ref.value.array),te=s(oe,j.centerBuffer.ref.value,j.groupBuffer.ref.value,j.sphereCount,H),K=te?l(V,X,te,j.sphereCount):[];O.update(T,oe),O.update(F,Ue.set(F.ref.value,oe.width,oe.height)),O.update(R,K),O.update(N,X)}}};return j}(x,_,w)}function n(x){return t(x?x.centerBuffer.ref.value:new Float32Array(0),x?x.groupBuffer.ref.value:new Float32Array(0),0,x)}function r(x){return Zc([x.sphereCount,x.centerBuffer.ref.version,x.groupBuffer.ref.version])}function s(x,_,w,A,M){const{array:E}=x;if(0===M.length){for(let F=0;F<A;++F)E[4*F+0]=_[3*F+0],E[4*F+1]=_[3*F+1],E[4*F+2]=_[3*F+2],E[4*F+3]=w[F];return}const D=[0];let T=0;for(let F=0,R=M.length;F<R;++F){const N=M[F];for(let j=0;j<A;++j){let W=!1;for(let z=0;z<F;++z)if(j%M[z]==0){W=!0;break}!W&&j%N==0&&(E[4*T+0]=_[3*j+0],E[4*T+1]=_[3*j+1],E[4*T+2]=_[3*j+2],E[4*T+3]=w[j],T+=1)}D.push(6*T)}return D}function l(x,_,w,A){return x.map((M,E)=>{const D=u(M,_);return[M.minDistance,M.maxDistance,M.overlap,w[w.length-1-E],Math.pow(Math.min(A,D),1/M.scaleBias),M.stride,M.scaleBias]})}function c(x){return x.map(_=>({minDistance:_[0],maxDistance:_[1],overlap:_[2],stride:_[5],scaleBias:_[6]}))}function u(x,_){return Math.max(1,Math.round(x.stride/Math.pow(_,x.scaleBias)))}function d(x,_){return x.map(w=>u(w,_)).reverse()}function f(x,_){const w=x.sphereCount,A=_.instanceCount.ref.value,M=V1(),E=M.position,D=x.centerBuffer.ref.value,T=_.aTransform.ref.value;return Vi(w,A,1,(R,N)=>(N<0?C.fromArray(E,D,3*R):C.transformMat4Offset(E,D,T,0,3*R,16*N),M))}function p(x,_,w,A,M){const{instanceCount:E,groupCount:D}=w,F=Ef(w,f(x,_),A.color),R=xy(w,A.size),N=M.instanceGranularity?hs(E,"instance"):hs(E*D,"groupInstance"),j=my(),W=gy(),z=by(),$=yy(),V={drawCount:2*x.sphereCount*3,vertexCount:6*x.sphereCount,groupCount:D,instanceCount:E},X=x.boundingSphere.radius?OD(R)*M.sizeFactor:0,H=ke.expand(ke(),x.boundingSphere,X),oe=pl(H,_.aTransform.ref.value,E,0);return x.shaderData.update({lodLevels:M.lodLevels,sizeFactor:M.sizeFactor}),{dGeometryType:O.create("spheres"),uTexDim:x.shaderData.texDim,tPositionGroup:x.shaderData.positionGroup,boundingSphere:O.create(oe),invariantBoundingSphere:O.create(H),uInvariantBoundingSphere:O.create(Bn.ofSphere(H)),...F,...R,...N,...j,...W,...z,...$,..._,padding:O.create(X),...xt.createValues(M,V),uSizeFactor:x.shaderData.sizeFactor,uDoubleSided:O.create(M.doubleSided),dIgnoreLight:O.create(M.ignoreLight),dXrayShaded:O.create("inverted"===M.xrayShaded?"inverted":!0===M.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(M.transparentBackfaces),dSolidInterior:O.create(M.solidInterior),dClipPrimitive:O.create(M.clipPrimitive),dApproximate:O.create(M.approximate),uAlphaThickness:O.create(M.alphaThickness),uBumpFrequency:O.create(M.bumpFrequency),uBumpAmplitude:O.create(M.bumpAmplitude),lodLevels:x.shaderData.lodLevels,centerBuffer:x.centerBuffer,groupBuffer:x.groupBuffer}}function v(x,_){xt.updateRenderableState(x,_),x.opaque=x.opaque&&!_.xrayShaded,x.writeDepth=x.opaque}e.create=t,e.createEmpty=n,e.Params={...xt.Params,sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),doubleSided:I.Boolean(!1,xt.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,xt.ShadingCategory),xrayShaded:I.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],xt.ShadingCategory),transparentBackfaces:I.Select("off",I.arrayToOptions(["off","on","opaque"]),xt.ShadingCategory),solidInterior:I.Boolean(!0,xt.ShadingCategory),clipPrimitive:I.Boolean(!1,{...xt.ShadingCategory,description:"Clip whole sphere instead of cutting it."}),approximate:I.Boolean(!1,{...xt.ShadingCategory,description:"Faster rendering, but has artifacts."}),alphaThickness:I.Numeric(0,{min:0,max:20,step:1},{...xt.ShadingCategory,description:"If not zero, adjusts alpha for radius."}),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory),bumpAmplitude:I.Numeric(1,{min:0,max:5,step:.1},xt.ShadingCategory),lodLevels:I.ObjectList({minDistance:I.Numeric(0),maxDistance:I.Numeric(0),overlap:I.Numeric(0),stride:I.Numeric(0),scaleBias:I.Numeric(3,{min:.1,max:10,step:.1})},x=>`${x.stride}`,{...xt.CullingLodCategory,defaultValue:[]})},e.Utils={Params:e.Params,createEmpty:n,createValues:p,createValuesSimple:function m(x,_,w,A,M){const E=xt.createSimple(w,A,M),D={...I.getDefaultValues(e.Params),..._};return p(x,E.transform,E.locationIterator,E.theme,D)},updateValues:function h(x,_){xt.updateValues(x,_),O.updateIfChanged(x.uSizeFactor,_.sizeFactor),O.updateIfChanged(x.uDoubleSided,_.doubleSided),O.updateIfChanged(x.dIgnoreLight,_.ignoreLight),O.updateIfChanged(x.dXrayShaded,"inverted"===_.xrayShaded?"inverted":!0===_.xrayShaded?"on":"off"),O.updateIfChanged(x.dTransparentBackfaces,_.transparentBackfaces),O.updateIfChanged(x.dSolidInterior,_.solidInterior),O.updateIfChanged(x.dClipPrimitive,_.clipPrimitive),O.updateIfChanged(x.dApproximate,_.approximate),O.updateIfChanged(x.uAlphaThickness,_.alphaThickness),O.updateIfChanged(x.uBumpFrequency,_.bumpFrequency),O.updateIfChanged(x.uBumpAmplitude,_.bumpAmplitude);const w=c(x.lodLevels.ref.value);if(!function a(x,_){if(x.length!==_.length)return!1;for(let w=0,A=x.length;w<A;++w)if(x[w].maxDistance!==_[w].maxDistance||x[w].minDistance!==_[w].minDistance||x[w].overlap!==_[w].overlap||x[w].stride!==_[w].stride||x[w].scaleBias!==_[w].scaleBias)return!1;return!0}(_.lodLevels,w)){const A=x.uVertexCount.ref.value/6,M=d(_.lodLevels,_.sizeFactor),E=s(x.tPositionGroup.ref.value,x.centerBuffer.ref.value,x.groupBuffer.ref.value,A,M),D=E?l(_.lodLevels,_.sizeFactor,E,A):[];O.update(x.tPositionGroup,x.tPositionGroup.ref.value),O.update(x.lodLevels,D)}},updateBoundingSphere:function g(x,_){const w=_.boundingSphere.radius?OD(x)*x.uSizeFactor.ref.value:0,A=ke.expand(ke(),_.boundingSphere,w),M=pl(A,x.aTransform.ref.value,x.instanceCount.ref.value,0);ke.equals(M,x.boundingSphere.ref.value)||O.update(x.boundingSphere,M),ke.equals(A,x.invariantBoundingSphere.ref.value)||(O.update(x.invariantBoundingSphere,A),O.update(x.uInvariantBoundingSphere,Bn.fromSphere(x.uInvariantBoundingSphere.ref.value,A))),O.update(x.padding,w)},createRenderableState:function y(x){const _=xt.createRenderableState(x);return v(_,x),_},updateRenderableState:v,createPositionIterator:f}}(Rp||(Rp={})),function(e){class t{constructor(){this.index=0,this.textures=[]}get(){return this.textures[this.index]}set(p,m,h){this.textures[this.index]=Object.assign(this.textures[this.index]||{},{vertex:p,group:m,normal:h}),this.index=(this.index+1)%2}destroy(){for(const p of this.textures)p.vertex.destroy(),p.group.destroy(),p.normal.destroy()}}function n(f,p,m,h,g,y,v){const x=m.getWidth(),_=m.getHeight();return v?(v.vertexCount=f,v.groupCount=p,O.update(v.geoTextureDim,Ue.set(v.geoTextureDim.ref.value,x,_)),O.update(v.vertexTexture,m),O.update(v.groupTexture,h),O.update(v.normalTexture,g),v.doubleBuffer.set(m,h,g),ke.copy(v.boundingSphere,y),v):{kind:"texture-mesh",vertexCount:f,groupCount:p,geoTextureDim:O.create(Ue.create(x,_)),vertexTexture:O.create(m),groupTexture:O.create(h),normalTexture:O.create(g),varyingGroup:O.create(!1),doubleBuffer:new t,boundingSphere:ke.clone(y),meta:{}}}function r(f){return n(0,0,f?f.vertexTexture.ref.value:lc(),f?f.groupTexture.ref.value:lc(),f?f.normalTexture.ref.value:lc(),f?f.boundingSphere:ke(),f)}e.DoubleBuffer=t,e.create=n,e.createEmpty=r,e.Params={...xt.Params,doubleSided:I.Boolean(!1,xt.CustomQualityParamInfo),flipSided:I.Boolean(!1,xt.ShadingCategory),flatShaded:I.Boolean(!1,xt.ShadingCategory),ignoreLight:I.Boolean(!1,xt.ShadingCategory),xrayShaded:I.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],xt.ShadingCategory),transparentBackfaces:I.Select("off",I.arrayToOptions(["off","on","opaque"]),xt.ShadingCategory),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory),bumpAmplitude:I.Numeric(1,{min:0,max:5,step:.1},xt.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:r,createValues:s,createValuesSimple:function a(f,p,m,h,g){const y=xt.createSimple(m,h,g),v={...I.getDefaultValues(e.Params),...p};return s(f,y.transform,y.locationIterator,y.theme,v)},updateValues:function l(f,p){xt.updateValues(f,p),O.updateIfChanged(f.uDoubleSided,p.doubleSided),O.updateIfChanged(f.dFlatShaded,p.flatShaded),O.updateIfChanged(f.dFlipSided,p.flipSided),O.updateIfChanged(f.dIgnoreLight,p.ignoreLight),O.updateIfChanged(f.dXrayShaded,"inverted"===p.xrayShaded?"inverted":!0===p.xrayShaded?"on":"off"),O.updateIfChanged(f.dTransparentBackfaces,p.transparentBackfaces),O.updateIfChanged(f.uBumpFrequency,p.bumpFrequency),O.updateIfChanged(f.uBumpAmplitude,p.bumpAmplitude)},updateBoundingSphere:function c(f,p){const m=ke.clone(p.boundingSphere),h=pl(m,f.aTransform.ref.value,f.instanceCount.ref.value,0);ke.equals(h,f.boundingSphere.ref.value)||O.update(f.boundingSphere,h),ke.equals(m,f.invariantBoundingSphere.ref.value)||(O.update(f.invariantBoundingSphere,m),O.update(f.uInvariantBoundingSphere,Bn.fromSphere(f.uInvariantBoundingSphere.ref.value,m)))},createRenderableState:function u(f){const p=xt.createRenderableState(f);return d(p,f),p},updateRenderableState:d,createPositionIterator:function o(f,p){const m=f.meta.webgl;if(!m)return Vi(1,1,1,()=>Gu);m.namedFramebuffers[i]||(m.namedFramebuffers[i]=m.resources.framebuffer());const h=m.namedFramebuffers[i],[g,y]=f.geoTextureDim.ref.value,v=new Float32Array(g*y*4);h.bind(),f.vertexTexture.ref.value.attachFramebuffer(h,0),m.readPixels(0,0,g,y,v);const x=f.vertexCount,_=p.instanceCount.ref.value,w=V1(),A=w.position,M=v,E=p.aTransform.ref.value;return Vi(x,_,1,(T,F)=>(F<0?C.fromArray(A,M,4*T):C.transformMat4Offset(A,M,E,0,4*T,16*F),w))}};const i="texture-mesh";function s(f,p,m,h,g){const{instanceCount:y,groupCount:v}=m,_=Ef(m,e.Utils.createPositionIterator(f,p),h.color),w=g.instanceGranularity?hs(y,"instance"):hs(y*v,"groupInstance"),A=my(),M=gy(),E=by(),D=yy(),T={drawCount:f.vertexCount,vertexCount:f.vertexCount,groupCount:v,instanceCount:y},F=ke.clone(f.boundingSphere),R=pl(F,p.aTransform.ref.value,y,0);return{dGeometryType:O.create("textureMesh"),uGeoTexDim:f.geoTextureDim,tPosition:f.vertexTexture,tGroup:f.groupTexture,tNormal:f.normalTexture,dVaryingGroup:f.varyingGroup,boundingSphere:O.create(R),invariantBoundingSphere:O.create(F),uInvariantBoundingSphere:O.create(Bn.ofSphere(F)),..._,...w,...A,...M,...E,...D,...p,...xt.createValues(g,T),uDoubleSided:O.create(g.doubleSided),dFlatShaded:O.create(g.flatShaded),dFlipSided:O.create(g.flipSided),dIgnoreLight:O.create(g.ignoreLight),dXrayShaded:O.create("inverted"===g.xrayShaded?"inverted":!0===g.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(g.transparentBackfaces),uBumpFrequency:O.create(g.bumpFrequency),uBumpAmplitude:O.create(g.bumpAmplitude),meta:O.create(f.meta)}}function d(f,p){xt.updateRenderableState(f,p),f.opaque=f.opaque&&!p.xrayShaded,f.writeDepth=f.opaque}}(iu||(iu={}));const wy={uDrawId:Ne("i"),uModel:Ne("m4"),uView:Ne("m4"),uInvView:Ne("m4"),uModelView:Ne("m4"),uInvModelView:Ne("m4"),uProjection:Ne("m4"),uInvProjection:Ne("m4"),uModelViewProjection:Ne("m4"),uInvModelViewProjection:Ne("m4"),uIsOrtho:Ne("f"),uPixelRatio:Ne("f"),uViewport:Ne("v4"),uViewOffset:Ne("v2"),uDrawingBufferSize:Ne("v2"),uCameraPosition:Ne("v3"),uCameraDir:Ne("v3"),uCameraPlane:Ne("v4"),uNear:Ne("f"),uFar:Ne("f"),uFog:Ne("b"),uFogNear:Ne("f"),uFogFar:Ne("f"),uFogColor:Ne("v3"),uTransparentBackground:Ne("b"),uLightDirection:Ne("v3[]"),uLightColor:Ne("v3[]"),uAmbientColor:Ne("v3"),uPickingAlphaThreshold:Ne("f"),uInteriorDarkening:Ne("f"),uInteriorColorFlag:Ne("b"),uInteriorColor:Ne("v3"),uHighlightColor:Ne("v3"),uSelectColor:Ne("v3"),uDimColor:Ne("v3"),uHighlightStrength:Ne("f"),uSelectStrength:Ne("f"),uDimStrength:Ne("f"),uMarkerPriority:Ne("i"),uMarkerAverage:Ne("f"),uXrayEdgeFalloff:Ne("f"),uExposure:Ne("f"),uRenderMask:Ne("i"),uMarkingDepthTest:Ne("b"),uMarkingType:Ne("i"),uPickType:Ne("i")},Ay={tDepth:xn("texture","depth","ushort","nearest"),tDpoitDepth:xn("texture","rg","float","nearest"),tDpoitFrontColor:xn("texture","rgba","float","nearest"),tDpoitBackColor:xn("texture","rgba","float","nearest")},Iy={uObjectId:Ne("i")},lZe={uColor:Ne("v3","material"),uColorTexDim:Ne("v2"),uColorGridDim:Ne("v3"),uColorGridTransform:Ne("v4"),tColor:xn("image-uint8","rgb","ubyte","nearest"),tPalette:xn("image-uint8","rgb","ubyte","nearest"),tColorGrid:xn("texture","rgb","ubyte","linear"),dColorType:cn("string",["uniform","attribute","instance","group","groupInstance","vertex","vertexInstance","volume","volumeInstance","direct"]),dUsePalette:cn("boolean")},LD={uSize:Ne("f","material"),uSizeTexDim:Ne("v2"),tSize:xn("image-uint8","rgb","ubyte","nearest"),dSizeType:cn("string",["uniform","attribute","instance","group","groupInstance"]),uSizeFactor:Ne("f","material")},cZe={uMarker:Ne("f"),uMarkerTexDim:Ne("v2"),tMarker:xn("image-uint8","alpha","ubyte","nearest"),markerAverage:_o("number"),markerStatus:_o("number"),dMarkerType:cn("string",["instance","groupInstance"])},uZe={uOverpaintTexDim:Ne("v2"),tOverpaint:xn("image-uint8","rgba","ubyte","nearest"),dOverpaint:cn("boolean"),uOverpaintGridDim:Ne("v3"),uOverpaintGridTransform:Ne("v4"),tOverpaintGrid:xn("texture","rgba","ubyte","linear"),dOverpaintType:cn("string",["instance","groupInstance","volumeInstance"]),uOverpaintStrength:Ne("f","material")},dZe={uTransparencyTexDim:Ne("v2"),tTransparency:xn("image-uint8","alpha","ubyte","nearest"),dTransparency:cn("boolean"),transparencyAverage:_o("number"),uTransparencyGridDim:Ne("v3"),uTransparencyGridTransform:Ne("v4"),tTransparencyGrid:xn("texture","alpha","ubyte","linear"),dTransparencyType:cn("string",["instance","groupInstance","volumeInstance"]),uTransparencyStrength:Ne("f","material")},fZe={uSubstanceTexDim:Ne("v2"),tSubstance:xn("image-uint8","rgba","ubyte","nearest"),dSubstance:cn("boolean"),uSubstanceGridDim:Ne("v3"),uSubstanceGridTransform:Ne("v4"),tSubstanceGrid:xn("texture","rgba","ubyte","linear"),dSubstanceType:cn("string",["instance","groupInstance","volumeInstance"]),uSubstanceStrength:Ne("f","material")},pZe={uClippingTexDim:Ne("v2"),tClipping:xn("image-uint8","alpha","ubyte","nearest"),dClipping:cn("boolean"),dClippingType:cn("string",["instance","groupInstance"])},Ey={dGeometryType:cn("string",["cylinders","directVolume","image","lines","mesh","points","spheres","text","textureMesh"]),...lZe,...cZe,...uZe,...dZe,...fZe,...pZe,dLightCount:cn("number"),dColorMarker:cn("boolean"),dClipObjectCount:cn("number"),dClipVariant:cn("string",["instance","pixel"]),uClipObjectType:Ne("i[]","material"),uClipObjectInvert:Ne("b[]","material"),uClipObjectPosition:Ne("v3[]","material"),uClipObjectRotation:Ne("v4[]","material"),uClipObjectScale:Ne("v3[]","material"),aInstance:Pi("float32",1,1),aTransform:Pi("float32",16,1),uAlpha:Ne("f","material"),uMetalness:Ne("f","material"),uRoughness:Ne("f","material"),uBumpiness:Ne("f","material"),uVertexCount:Ne("i"),uInstanceCount:Ne("i"),uGroupCount:Ne("i"),uInvariantBoundingSphere:Ne("v4"),uLod:Ne("v4"),drawCount:_o("number"),instanceCount:_o("number"),alpha:_o("number"),matrix:_o("m4"),transform:_o("float32"),extraTransform:_o("float32"),hasReflection:_o("boolean"),instanceGranularity:_o("boolean"),boundingSphere:_o("sphere"),invariantBoundingSphere:_o("sphere"),instanceGrid:_o("instanceGrid")},hl="\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nvoid main(void) {\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n",mZe=Kc(),yZe=Object.keys({color:"",pick:"",depth:"",marking:""}),bZe=Object.keys({compute:""});function J9(e,t,n,r,i){return n={...n,dRenderVariant:O.create(t)},void 0===i.dRenderVariant&&Object.defineProperty(i,"dRenderVariant",{value:cn("string")}),e.resources.program(n,r,i)}function eH(e,t){if("color"===e)switch(t){case"blended":return"colorBlended";case"wboit":return"colorWboit";case"dpoit":return"colorDpoit"}return e}function Ty(e,t,n,r,i,o,s){return hfe(e,t,n,r,i,o,yZe,s)}function ms(e,t,n,r,i,o=-1){return hfe(e,t,n,r,i,o,bZe,void 0)}function hfe(e,t,n,r,i,o,s,a){const l=mZe(),{stats:c,state:u,resources:d}=e,{instancedArrays:f,vertexArrayObject:p,multiDrawInstancedBaseVertexBaseInstance:m,drawInstancedBaseVertexBaseInstance:h}=e.extensions;i.uVertexCount&&!e.extensions.noNonInstancedActiveAttribs&&(i.aVertex=O.create(Sd(new Float32Array(i.uVertexCount.ref.value))),r.aVertex=Pi("float32",1,0));const{attributeValues:g,defineValues:y,textureValues:v,materialTextureValues:x,uniformValues:_,materialUniformValues:w,bufferedUniformValues:A}=function sZe(e,t){const n={},r={},i={},o={},s={},a={},l={};return Object.keys(e).forEach(c=>{const u=e[c];"attribute"===u.type&&(n[c]=t[c]),"define"===u.type&&(r[c]=t[c]),"texture"===u.type&&void 0!==t[c]&&("material"===u.variant?o[c]=t[c]:i[c]=t[c]),"uniform"===u.type&&void 0!==t[c]&&("material"===u.variant?a[c]=t[c]:"buffered"===u.variant?l[c]=t[c]:s[c]=t[c])}),{attributeValues:n,defineValues:r,textureValues:i,materialTextureValues:o,uniformValues:s,materialUniformValues:a,bufferedUniformValues:l}}(r,i),M=Object.entries(_),E=Object.entries(w),D=Object.entries(A),T=Object.entries(function dYe(e){const t={};return Object.keys(e).forEach(n=>{t[n]=O.create(op(e[n].ref.value))}),t}(A)),F=Object.entries(y),R=function aZe(e){const t={};return Object.keys(e).forEach(n=>{t[n]=e[n].ref.version}),t}(i),N=function gZe(e,t){const{gl:n}=e;switch(t){case"points":return n.POINTS;case"lines":return n.LINES;case"line-strip":return n.LINE_STRIP;case"line-loop":return n.LINE_LOOP;case"triangles":return n.TRIANGLES;case"triangle-strip":return n.TRIANGLE_STRIP;case"triangle-fan":return n.TRIANGLE_FAN}}(e,t),j={};for(const ee of s)j[ee]=J9(e,eH(ee,a),y,n,r);const W=xde(e,r,v),z=xde(e,r,x),$=function bYe(e,t,n){const r=[];return Object.keys(t).forEach(i=>{const o=t[i];"attribute"===o.type&&(r[r.length]=[i,e.resources.attribute(n[i].ref.value,o.itemSize,o.divisor)])}),r}(e,r,g),V=[];for(let ee=0,se=$.length;ee<se;++ee){const xe=$[ee];1===xe[1].divisor&&V.push(xe)}let X;const H=i.elements;H&&H.ref.value&&(X=d.elements(H.ref.value));const oe={};for(const ee of s)oe[ee]=p?d.vertexArray(j[ee],$,X):null;let te=i.drawCount.ref.value,K=i.instanceCount.ref.value;c.drawCount+=te,c.instanceCount+=K,c.instancedDrawCount+=K*te;const Q={attributes:!1,defines:!1,elements:!1,textures:!1};let G=!1,Z=-1;return{id:l,materialId:o,getProgram:ee=>j[ee],setTransparency:ee=>{if(ee!==a){a=ee;for(const se of s)j[se].destroy(),j[se]=J9(e,eH(se,a),y,n,r)}},render:(ee,se,xe)=>{if(0===te||0===K)return;const re=j[ee];if(re.id===Z&&u.currentRenderItemId===l)re.setUniforms(M),re.bindTextures(W,se);else{const ae=oe[ee];(re.id!==u.currentProgramId||re.id!==Z||-1===o||o!==u.currentMaterialId)&&(re.id!==u.currentProgramId&&re.use(),re.setUniforms(E),re.bindTextures(z,se+W.length),u.currentMaterialId=o,Z=re.id),re.setUniforms(M),re.setUniforms(T),re.bindTextures(W,se),ae?(ae.bind(),X&&X.bind()):(X&&X.bind(),re.bindAttributes($)),u.currentRenderItemId=l}if($n)try{dN(e.gl)}catch(ae){throw new Error(`Framebuffer error rendering item id ${l}: '${ae}'`)}if(xe){for(const ae of xe)if(0!==ae.count){if(re.setUniforms(ae.uniforms),m)X?m.multiDrawElementsInstancedBaseVertexBaseInstance(N,ae.counts,0,X._dataType,ae.offsets,0,ae.instanceCounts,0,ae.baseVertices,0,ae.baseInstances,0,ae.count):m.multiDrawArraysInstancedBaseInstance(N,ae.firsts,0,ae.counts,0,ae.instanceCounts,0,ae.baseInstances,0,ae.count);else if(h)if(X)for(let ge=0;ge<ae.count;++ge)ae.counts[ge]>0&&(re.uniform("uDrawId",ge),h.drawElementsInstancedBaseVertexBaseInstance(N,ae.counts[ge],X._dataType,ae.offsets[ge],ae.instanceCounts[ge],ae.baseVertices[ge],ae.baseInstances[ge]));else for(let ge=0;ge<ae.count;++ge)ae.counts[ge]>0&&(re.uniform("uDrawId",ge),h.drawArraysInstancedBaseInstance(N,ae.firsts[ge],ae.counts[ge],ae.instanceCounts[ge],ae.baseInstances[ge]));else if(X)for(let ge=0;ge<ae.count;++ge)ae.counts[ge]>0&&(re.uniform("uDrawId",ge),re.offsetAttributes(V,ae.baseInstances[ge]),f.drawElementsInstanced(N,ae.counts[ge],X._dataType,ae.offsets[ge],ae.instanceCounts[ge]));else for(let ge=0;ge<ae.count;++ge)ae.counts[ge]>0&&(re.uniform("uDrawId",ge),re.offsetAttributes(V,ae.baseInstances[ge]),f.drawArraysInstanced(N,0,ae.counts[ge],ae.instanceCounts[ge]));if(It){m?c.calls.multiDrawInstancedBase+=1:h?c.calls.drawInstancedBase+=ae.count:c.calls.drawInstanced+=ae.count;for(let ge=0;ge<ae.count;++ge)c.calls.counts+=ae.instanceCounts[ge]}}}else X?f.drawElementsInstanced(N,te,X._dataType,0,K):f.drawArraysInstanced(N,0,te,K),It&&(c.calls.drawInstanced+=1,c.calls.counts+=K);if($n)try{ade(e.gl)}catch(ae){throw new Error(`Draw error rendering item id ${l}: '${ae}'`)}},update:()=>{if(function xZe(e){e.attributes=!1,e.defines=!1,e.elements=!1,e.textures=!1}(Q),i.aVertex){const ee=i.uVertexCount.ref.value;i.aVertex.ref.value.length<ee&&O.update(i.aVertex,Sd(new Float32Array(ee)))}for(let ee=0,se=F.length;ee<se;++ee){const[xe,re]=F[ee];re.ref.version!==R[xe]&&(Q.defines=!0,R[xe]=re.ref.version)}if(Q.defines)for(const ee of s)j[ee].destroy(),j[ee]=J9(e,eH(ee,a),y,n,r);i.drawCount.ref.version!==R.drawCount&&(c.drawCount+=i.drawCount.ref.value-te,c.instancedDrawCount+=K*i.drawCount.ref.value-K*te,te=i.drawCount.ref.value,R.drawCount=i.drawCount.ref.version),i.instanceCount.ref.version!==R.instanceCount&&(c.instanceCount+=i.instanceCount.ref.value-K,c.instancedDrawCount+=i.instanceCount.ref.value*te-K*te,K=i.instanceCount.ref.value,R.instanceCount=i.instanceCount.ref.version);for(let ee=0,se=$.length;ee<se;++ee){const[xe,re]=$[ee],ae=g[xe];if(ae.ref.version!==R[xe]){if(re.length>=ae.ref.value.length)re.updateSubData(ae.ref.value,0,re.length);else{re.destroy();const{itemSize:ge,divisor:Ie}=r[xe];$[ee][1]=d.attribute(ae.ref.value,ge,Ie),Q.attributes=!0}R[xe]=ae.ref.version}}if(X&&i.elements.ref.version!==R.elements&&(X.length>=i.elements.ref.value.length?X.updateSubData(i.elements.ref.value,0,X.length):(X.destroy(),X=d.elements(i.elements.ref.value),Q.elements=!0),R.elements=i.elements.ref.version),Q.attributes||Q.defines||Q.elements)for(const ee of s){const se=oe[ee];se&&se.destroy(),oe[ee]=p?d.vertexArray(j[ee],$,X):null}for(let ee=0,se=W.length;ee<se;++ee){const[xe,re]=W[ee],ae=v[xe];ae.ref.version!==R[xe]&&("texture"!==r[xe].kind?(re.load(ae.ref.value),Q.textures=!0):W[ee][1]=ae.ref.value,R[xe]=ae.ref.version)}for(let ee=0,se=z.length;ee<se;++ee){const[xe,re]=z[ee],ae=x[xe];ae.ref.version!==R[xe]&&("texture"!==r[xe].kind?(re.load(ae.ref.value),Q.textures=!0):z[ee][1]=ae.ref.value,R[xe]=ae.ref.version)}for(let ee=0,se=D.length;ee<se;++ee){const[xe,re]=D[ee];re.ref.version!==R[xe]&&(O.update(T[ee][1],op(re.ref.value)),R[xe]=re.ref.version)}},destroy:()=>{if(!G){for(const ee of s){j[ee].destroy();const se=oe[ee];se&&se.destroy()}W.forEach(([ee,se])=>{"texture"!==r[ee].kind&&se.destroy()}),z.forEach(([ee,se])=>{"texture"!==r[ee].kind&&se.destroy()}),$.forEach(([ee,se])=>se.destroy()),X&&X.destroy(),c.drawCount-=te,c.instanceCount-=K,c.instancedDrawCount-=K*te,G=!0}}}}function gs(){return gs.create(C.create(1,0,0),0)}function E_(){return E_.create(gs(),gs(),gs(),gs(),gs(),gs())}!function(e){function n(h,g){return C.copy(h.normal,g.normal),h.constant=g.constant,h}function l(h,g,y){return C.copy(h.normal,g),h.constant=-C.dot(h.normal,y),h}e.create=function t(h,g){return{normal:h,constant:g}},e.copy=n,e.clone=function r(h){return n(e(),h)},e.normalize=function i(h,g){const y=1/C.magnitude(g.normal);return C.scale(h.normal,g.normal,y),h.constant=g.constant*y,h},e.negate=function o(h,g){return C.negate(h.normal,g.normal),h.constant=-g.constant,h},e.toArray=function s(h,g,y){return C.toArray(h.normal,g,y),g[y+3]=h.constant,g},e.fromArray=function a(h,g,y){return C.fromArray(h.normal,g,y),h.constant=g[y+3],h},e.fromNormalAndCoplanarPoint=l,e.fromCoplanarPoints=function c(h,g,y,v){return l(h,C.triangleNormal(C(),g,y,v),g),h};const u=C();function f(h,g){return C.dot(h.normal,g)+h.constant}e.setUnnormalized=function d(h,g,y,v,x){C.set(u,g,y,v);const _=1/C.magnitude(u);return C.scale(h.normal,u,_),h.constant=x*_,h},e.distanceToPoint=f,e.distanceToSpher3D=function p(h,g){return f(h,g.center)-g.radius},e.projectPoint=function m(h,g,y){return C.scaleAndAdd(h,h,g.normal,-f(g,y))}}(gs||(gs={})),function(e){function n(c,u){for(let d=0;d<6;++d)gs.copy(c[d],u[d]);return c}e.create=function t(c,u,d,f,p,m){return[c,u,d,f,p,m]},e.copy=n,e.clone=function r(c){return n(e(),c)},e.fromProjectionMatrix=function i(c,u){const d=u[0],f=u[1],p=u[2],m=u[3],h=u[4],g=u[5],y=u[6],v=u[7],x=u[8],_=u[9],w=u[10],A=u[11],M=u[12],E=u[13],D=u[14],T=u[15];return gs.setUnnormalized(c[0],m-d,v-h,A-x,T-M),gs.setUnnormalized(c[1],m+d,v+h,A+x,T+M),gs.setUnnormalized(c[2],m+f,v+g,A+_,T+E),gs.setUnnormalized(c[3],m-f,v-g,A-_,T-E),gs.setUnnormalized(c[4],m-p,v-y,A-w,T-D),gs.setUnnormalized(c[5],m+p,v+y,A+w,T+D),c},e.intersectsSphere3D=function o(c,u){const d=u.center,f=-u.radius;for(let p=0;p<6;++p)if(gs.distanceToPoint(c[p],d)<f)return!1;return!0};const s=C();e.intersectsBox3D=function a(c,u){for(let d=0;d<6;++d){const f=c[d];if(s[0]=f.normal[0]>0?u.max[0]:u.min[0],s[1]=f.normal[1]>0?u.max[1]:u.min[1],s[2]=f.normal[2]>0?u.max[2]:u.min[2],gs.distanceToPoint(f,s)<0)return!1}return!0},e.containsPoint=function l(c,u){for(let d=0;d<6;++d)if(gs.distanceToPoint(c[d],u)<0)return!1;return!0}}(E_||(E_={}));const DN=gs.distanceToPoint,PN=E_.intersectsSphere3D,kN=ke.fromArray,mfe=Kc();function tH(e,t){return t&&t.instanceCounts.length>=e?t:{firsts:new Int32Array(e),counts:new Int32Array(e),offsets:new Int32Array(e),instanceCounts:new Int32Array(e),baseVertices:new Int32Array(e),baseInstances:new Uint32Array(e),count:0,uniforms:[]}}function Dy(e,t,n){const r=mfe();let i=tH(0);const o=[];let s=!1,a=-1;const l=ke(),c=()=>{var u;const d=null===(u=t.lodLevels)||void 0===u?void 0:u.ref.value;if(d&&d.length>0){const{cellCount:f}=t.instanceGrid.ref.value;o.length=d.length;for(let p=0,m=d.length;p<m;++p)o[p]=tH(f,o[p]),o[p].count=0;if(t.lodLevels.ref.version!==a){for(let p=0,m=d.length;p<m;++p)1!==o[p].uniforms.length&&(o[p].uniforms.length=1,o[p].uniforms[0]=["uLod",O.create(Bn())]),O.update(o[p].uniforms[0][1],Bn.set(o[p].uniforms[0][1].ref.value,d[p][0],d[p][1],d[p][2],d[p][4]));a=t.lodLevels.ref.version}}};return c(),{id:r,materialId:e.materialId,values:t,state:n,cull:(u,d,f,p)=>{var m,h;if(s=!1,0===t.drawCount.ref.value||0===t.instanceCount.ref.value||!t.instanceGrid.ref.value)return;const{cellOffsets:g,cellSpheres:y,cellCount:v,batchOffsets:x,batchSpheres:_,batchCount:w,batchCell:A,batchSize:M}=t.instanceGrid.ref.value,[E,D]=t.uLod.ref.value,T=0!==E||0!==D,F=2*M,R=null===(m=t.lodLevels)||void 0===m?void 0:m.ref.value;if(R&&R.length>0){if((null===(h=t.lodLevels)||void 0===h?void 0:h.ref.version)!==a)c();else for(let N=0,j=R.length;N<j;++N)o[N].count=0;for(let N=0;N<w;++N){const j=x[N],W=x[N+1];if(W-j==0)continue;kN(l,_,4*N);const $=DN(u,l.center);if(T&&($+l.radius<E||$-l.radius>D))It&&(p.culled.lod+=g[A[W-1]+1]-g[A[j]]);else if(PN(d,l))if(null!==f&&f(l))It&&(p.culled.occlusion+=g[A[W-1]+1]-g[A[j]]);else for(let V=j;V<W;++V){const X=A[V],H=g[X],te=g[X+1]-H;if(0===te)continue;kN(l,y,4*X);const K=DN(u,l.center);if(T&&(K+l.radius<E||K-l.radius>D))It&&(p.culled.lod+=te);else if(PN(d,l))if(null!==f&&K-l.radius<F&&f(l))It&&(p.culled.occlusion+=te);else for(let Q=0,G=R.length;Q<G;++Q){if(K+l.radius<R[Q][0]||K-l.radius>R[Q][1])continue;const Z=o[Q],ee=Z.count;ee>0&&Z.baseInstances[ee-1]+Z.instanceCounts[ee-1]===H&&Z.counts[ee-1]===R[Q][3]?Z.instanceCounts[ee-1]+=te:(Z.counts[ee]=R[Q][3],Z.instanceCounts[ee]=te,Z.baseInstances[ee]=H,Z.count+=1)}else It&&(p.culled.frustum+=te)}else It&&(p.culled.frustum+=g[A[W-1]+1]-g[A[j]])}}else{i=tH(v,i);const{baseInstances:N,instanceCounts:j,counts:W}=i;let z=0;for(let $=0;$<w;++$){const V=x[$],X=x[$+1];if(X-V!=0){if(kN(l,_,4*$),T){const oe=DN(u,l.center);if(oe+l.radius<E||oe-l.radius>D){It&&(p.culled.lod+=g[A[X-1]+1]-g[A[V]]);continue}}if(!PN(d,l)){It&&(p.culled.frustum+=g[A[X-1]+1]-g[A[V]]);continue}if(null!==f&&f(l)){It&&(p.culled.occlusion+=g[A[X-1]+1]-g[A[V]]);continue}for(let oe=V;oe<X;++oe){const te=A[oe],K=g[te],G=g[te+1]-K;if(0===G)continue;kN(l,y,4*te);const Z=DN(u,l.center);T&&(Z+l.radius<E||Z-l.radius>D)?It&&(p.culled.lod+=G):PN(d,l)?null!==f&&Z-l.radius<F&&f(l)?It&&(p.culled.occlusion+=G):z>0&&N[z-1]+j[z-1]===K?j[z-1]+=G:(W[z]=t.drawCount.ref.value,j[z]=G,N[z]=K,z+=1):It&&(p.culled.frustum+=G)}}}i.count=z,o.length=1,o[0]=i,o[0].uniforms.length=0}s=!0},uncull:()=>{s=!1},render:(u,d)=>{t.uAlpha&&t.alpha&&O.updateIfChanged(t.uAlpha,al(t.alpha.ref.value*n.alphaFactor,0,1)),e.render(u,d,s?o:void 0)},getProgram:u=>e.getProgram(u),setTransparency:u=>e.setTransparency(u),update:()=>{e.update(),c()},dispose:()=>e.destroy()}}function ys(e,t){return{id:mfe(),values:t,render:()=>e.render("compute",0),update:()=>e.update(),dispose:()=>e.destroy()}}const nH=new Float32Array([1,1,-1,1,-1,-1,-1,-1,1,-1,1,1]),ca={drawCount:_o("number"),instanceCount:_o("number"),aPosition:Pi("float32",2,0),uQuadScale:Ne("v2")},ua={drawCount:O.create(6),instanceCount:O.create(1),aPosition:O.create(nH),uQuadScale:O.create(Ue.create(1,1))},_Ze={...ca,tColor:xn("texture","rgba","ubyte","nearest"),uTexSize:Ne("v2")},SZe=Wi("copy",hl,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords);\n}\n");function Zw(e,t){const n={...ua,tColor:O.create(t),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight()))},r={..._Ze};return ys(ms(e,"triangles",SZe,r,n),n)}const gfe=new Uint32Array([0,1,2,1,3,2]),wZe=new Float32Array([0,1,0,0,1,1,1,0]),yfe={nearest:"Nearest",catmulrom:"Catmulrom (Cubic)",mitchell:"Mitchell (Cubic)",bspline:"B-Spline (Cubic)"},AZe=Object.keys(yfe);var Py,Wu,$a;!function(e){function t(f,p,m,h){return h?function i(f,p,m,h){const g=f.width,y=f.height;return O.update(h.imageTexture,f),O.update(h.imageTextureDim,Ue.set(h.imageTextureDim.ref.value,g,y)),O.update(h.cornerBuffer,p),O.update(h.groupTexture,m),h}(f,p,m,h):function r(f,p,m){const h=ke();let g=-1;const y=f.width,v=f.height,x={kind:"image",imageTexture:O.create(f),imageTextureDim:O.create(Ue.create(y,v)),cornerBuffer:O.create(p),groupTexture:O.create(m),get boundingSphere(){const _=function n(f){return Zc([f.cornerBuffer.ref.version])}(x);if(_!==g){const w=function IZe(e){const t=C(),n=[];for(let o=0,s=e.length;o<s;o+=3){const a=C.fromArray(C(),e,o);n.push(a),C.add(t,t,a)}C.scale(t,t,1/(e.length/3));let r=0;for(const o of n){const s=C.distance(t,o);s>r&&(r=s)}const i=ke.create(t,r);return ke.setExtrema(i,n),i}(x.cornerBuffer.ref.value);ke.copy(h,w),g=_}return h}};return x}(f,p,m)}function o(f){return t(Sa(0,4,Uint8Array),f?f.cornerBuffer.ref.value:new Float32Array(24),Sa(0,4,Uint8Array),f)}function s(f,p,m,h,g){const{instanceCount:y,groupCount:v}=m,_=Ef(m,e.Utils.createPositionIterator(f,p),h.color),w=g.instanceGranularity?hs(y,"instance"):hs(y*v,"groupInstance"),A=my(),M=gy(),E=by(),D=yy(),T={drawCount:gfe.length,vertexCount:nH.length/3,groupCount:v,instanceCount:y},F=ke.clone(f.boundingSphere),R=pl(F,p.aTransform.ref.value,y,0);return{dGeometryType:O.create("image"),..._,...w,...A,...M,...E,...D,...p,...xt.createValues(g,T),aPosition:f.cornerBuffer,aUv:O.create(wZe),elements:O.create(gfe),aGroup:O.create(Sd(new Float32Array(4))),boundingSphere:O.create(R),invariantBoundingSphere:O.create(F),uInvariantBoundingSphere:O.create(Bn.ofSphere(F)),dInterpolation:O.create(g.interpolation),uImageTexDim:f.imageTextureDim,tImageTex:f.imageTexture,tGroupTex:f.groupTexture}}e.create=t,e.createEmpty=o,e.Params={...xt.Params,interpolation:I.Select("bspline",I.objectToOptions(yfe))},e.Utils={Params:e.Params,createEmpty:o,createValues:s,createValuesSimple:function a(f,p,m,h,g){const y=xt.createSimple(m,h,g),v={...I.getDefaultValues(e.Params),...p};return s(f,y.transform,y.locationIterator,y.theme,v)},updateValues:function l(f,p){xt.updateValues(f,p),O.updateIfChanged(f.dInterpolation,p.interpolation)},updateBoundingSphere:function c(f,p){const m=ke.clone(p.boundingSphere),h=pl(m,f.aTransform.ref.value,f.instanceCount.ref.value,0);ke.equals(h,f.boundingSphere.ref.value)||O.update(f.boundingSphere,h),ke.equals(m,f.invariantBoundingSphere.ref.value)||(O.update(f.invariantBoundingSphere,m),O.update(f.uInvariantBoundingSphere,Bn.fromSphere(f.uInvariantBoundingSphere.ref.value,m)))},createRenderableState:function u(f){const p=xt.createRenderableState(f);return p.opaque=!1,p},updateRenderableState:function d(f,p){xt.updateRenderableState(f,p),f.opaque=!1},createPositionIterator:()=>Vi(1,1,1,()=>Gu)}}(Py||(Py={})),function(e){function t(m,h,g,y,v,x,_,w,A,M){return M?function o(m,h,g,y,v,x,_,w,A,M){return A>M.cylinderCount&&(O.update(M.mappingBuffer,m),O.update(M.indexBuffer,h)),M.cylinderCount=A,O.update(M.groupBuffer,g),O.update(M.startBuffer,y),O.update(M.endBuffer,v),O.update(M.scaleBuffer,x),O.update(M.capBuffer,_),O.update(M.colorModeBuffer,w),M}(m,h,g,y,v,x,_,w,A,M):function i(m,h,g,y,v,x,_,w,A){const M=ke();let E,D=-1,T=-1;const F={kind:"cylinders",cylinderCount:A,mappingBuffer:O.create(m),indexBuffer:O.create(h),groupBuffer:O.create(g),startBuffer:O.create(y),endBuffer:O.create(v),scaleBuffer:O.create(x),capBuffer:O.create(_),colorModeBuffer:O.create(w),get boundingSphere(){const R=r(F);if(R!==D){const N=py(F.startBuffer.ref.value,6*F.cylinderCount,6),j=py(F.endBuffer.ref.value,6*F.cylinderCount,6);ke.expandBySphere(M,N,j),D=R}return M},get groupMapping(){return F.groupBuffer.ref.version!==T&&(E=zw(F.groupBuffer.ref.value,F.cylinderCount,6),T=F.groupBuffer.ref.version),E},setBoundingSphere(R){ke.copy(M,R),D=r(F)}};return F}(m,h,g,y,v,x,_,w,A)}function n(m){return t(m?m.mappingBuffer.ref.value:new Float32Array(0),m?m.indexBuffer.ref.value:new Uint32Array(0),m?m.groupBuffer.ref.value:new Float32Array(0),m?m.startBuffer.ref.value:new Float32Array(0),m?m.endBuffer.ref.value:new Float32Array(0),m?m.scaleBuffer.ref.value:new Float32Array(0),m?m.capBuffer.ref.value:new Float32Array(0),m?m.colorModeBuffer.ref.value:new Float32Array(0),0,m)}function r(m){return Zc([m.cylinderCount,m.mappingBuffer.ref.version,m.indexBuffer.ref.version,m.groupBuffer.ref.version,m.startBuffer.ref.version,m.endBuffer.ref.version,m.scaleBuffer.ref.version,m.capBuffer.ref.version,m.colorModeBuffer.ref.version])}function a(m,h){const g=6*m.cylinderCount,y=h.instanceCount.ref.value,v=V1(),x=v.position,_=m.startBuffer.ref.value,w=m.endBuffer.ref.value,A=h.aTransform.ref.value;return Vi(g,y,2,(E,D)=>{const T=E%6==0?_:w;return D<0?C.fromArray(x,T,3*E):C.transformMat4Offset(x,T,A,0,3*E,16*D),v})}function l(m,h,g,y,v){const{instanceCount:x,groupCount:_}=g,A=Ef(g,a(m,h),y.color),M=xy(g,y.size),E=v.instanceGranularity?hs(x,"instance"):hs(x*_,"groupInstance"),D=my(),T=gy(),F=by(),R=yy(),N={drawCount:4*m.cylinderCount*3,vertexCount:6*m.cylinderCount,groupCount:_,instanceCount:x},j=OD(M)*v.sizeFactor,W=ke.clone(m.boundingSphere),z=pl(W,h.aTransform.ref.value,x,0);return{dGeometryType:O.create("cylinders"),aMapping:m.mappingBuffer,aGroup:m.groupBuffer,aStart:m.startBuffer,aEnd:m.endBuffer,aScale:m.scaleBuffer,aCap:m.capBuffer,aColorMode:m.colorModeBuffer,elements:m.indexBuffer,boundingSphere:O.create(z),invariantBoundingSphere:O.create(W),uInvariantBoundingSphere:O.create(Bn.ofSphere(W)),...A,...M,...E,...D,...T,...F,...R,...h,padding:O.create(j),...xt.createValues(v,N),uSizeFactor:O.create(v.sizeFactor*v.sizeAspectRatio),uDoubleSided:O.create(v.doubleSided),dIgnoreLight:O.create(v.ignoreLight),dXrayShaded:O.create("inverted"===v.xrayShaded?"inverted":!0===v.xrayShaded?"on":"off"),dTransparentBackfaces:O.create(v.transparentBackfaces),dSolidInterior:O.create(v.solidInterior),uBumpFrequency:O.create(v.bumpFrequency),uBumpAmplitude:O.create(v.bumpAmplitude),dDualColor:O.create("interpolate"===v.colorMode)}}function p(m,h){xt.updateRenderableState(m,h),m.opaque=m.opaque&&!h.xrayShaded,m.writeDepth=m.opaque}e.create=t,e.createEmpty=n,e.transform=function s(m,h){const g=m.startBuffer.ref.value;w_(h,g,0,6*m.cylinderCount),O.update(m.startBuffer,g);const y=m.endBuffer.ref.value;w_(h,y,0,6*m.cylinderCount),O.update(m.endBuffer,y)},e.Params={...xt.Params,sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),sizeAspectRatio:I.Numeric(1,{min:0,max:3,step:.01}),doubleSided:I.Boolean(!1,xt.CustomQualityParamInfo),ignoreLight:I.Boolean(!1,xt.ShadingCategory),xrayShaded:I.Select(!1,[[!1,"Off"],[!0,"On"],["inverted","Inverted"]],xt.ShadingCategory),transparentBackfaces:I.Select("off",I.arrayToOptions(["off","on","opaque"]),xt.ShadingCategory),solidInterior:I.Boolean(!0,xt.ShadingCategory),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory),bumpAmplitude:I.Numeric(1,{min:0,max:5,step:.1},xt.ShadingCategory),colorMode:I.Select("default",I.arrayToOptions(["default","interpolate"]),xt.ShadingCategory)},e.Utils={Params:e.Params,createEmpty:n,createValues:l,createValuesSimple:function c(m,h,g,y,v){const x=xt.createSimple(g,y,v),_={...I.getDefaultValues(e.Params),...h};return l(m,x.transform,x.locationIterator,x.theme,_)},updateValues:function u(m,h){xt.updateValues(m,h),O.updateIfChanged(m.uSizeFactor,h.sizeFactor*h.sizeAspectRatio),O.updateIfChanged(m.uDoubleSided,h.doubleSided),O.updateIfChanged(m.dIgnoreLight,h.ignoreLight),O.updateIfChanged(m.dXrayShaded,"inverted"===h.xrayShaded?"inverted":!0===h.xrayShaded?"on":"off"),O.updateIfChanged(m.dTransparentBackfaces,h.transparentBackfaces),O.updateIfChanged(m.dSolidInterior,h.solidInterior),O.updateIfChanged(m.uBumpFrequency,h.bumpFrequency),O.updateIfChanged(m.uBumpAmplitude,h.bumpAmplitude),O.updateIfChanged(m.dDualColor,"interpolate"===h.colorMode)},updateBoundingSphere:function d(m,h){const g=ke.clone(h.boundingSphere),y=pl(g,m.aTransform.ref.value,m.instanceCount.ref.value,0);ke.equals(y,m.boundingSphere.ref.value)||O.update(m.boundingSphere,y),ke.equals(g,m.invariantBoundingSphere.ref.value)||(O.update(m.invariantBoundingSphere,g),O.update(m.uInvariantBoundingSphere,Bn.fromSphere(m.uInvariantBoundingSphere.ref.value,g)))},createRenderableState:function f(m){const h=xt.createRenderableState(m);return p(h,m),h},updateRenderableState:p,createPositionIterator:a}}(Wu||(Wu={})),function(e){function t(s){switch(s.kind){case"mesh":return 3*s.triangleCount;case"points":return s.pointCount;case"spheres":return 2*s.sphereCount*3;case"cylinders":return 4*s.cylinderCount*3;case"text":return 2*s.charCount*3;case"lines":return 2*s.lineCount*3;case"direct-volume":return 36;case"image":return 6;case"texture-mesh":return s.vertexCount}}e.getDrawCount=t,e.getVertexCount=function n(s){switch(s.kind){case"mesh":case"texture-mesh":return s.vertexCount;case"points":return s.pointCount;case"spheres":return 6*s.sphereCount;case"cylinders":return 6*s.cylinderCount;case"text":return 4*s.charCount;case"lines":return 4*s.lineCount;case"direct-volume":const[a,l,c]=s.gridDimension.ref.value;return a*l*c;case"image":return 4}},e.getGroupCount=function r(s){switch(s.kind){case"mesh":case"points":case"spheres":case"cylinders":case"text":case"lines":return 0===t(s)?0:Bh(s.groupBuffer.ref.value)+1;case"direct-volume":return 1;case"image":return Bh(s.groupTexture.ref.value.array)+1;case"texture-mesh":return s.groupCount}},e.getUtils=function i(s){switch(s.kind){case"mesh":return on.Utils;case"points":return G1.Utils;case"spheres":return Rp.Utils;case"cylinders":return Wu.Utils;case"text":return Tf.Utils;case"lines":return Mo.Utils;case"direct-volume":return Df.Utils;case"image":return Py.Utils;case"texture-mesh":return iu.Utils}},e.getGranularity=function o(s,a){return"instance"===a&&s.nonInstanceable?"group":a}}($a||($a={}));const bfe={};function oH(e,t){return{factory:oH,granularity:"groupInstance",size:n=>Bc.isLocation(n)?n.shape.getSize(n.group,n.instance):1,props:t,description:"Assigns sizes as defined by the shape object."}}const PZe={name:"shape-group",label:"Shape Group",category:"",factory:oH,getParams:function DZe(e){return bfe},defaultValues:I.getDefaultValues(bfe),isApplicable:e=>!!e.shape},kZe=st(13421772),vfe={};function sH(e,t){return{factory:sH,granularity:"groupInstance",color:n=>Bc.isLocation(n)?n.shape.getColor(n.group,n.instance):kZe,props:t,description:"Assigns colors as defined by the shape object."}}const NZe={name:"shape-group",label:"Shape Group",category:xo.Misc,factory:sH,getParams:function RZe(e){return vfe},defaultValues:I.getDefaultValues(vfe),isApplicable:e=>!!e.shape},FZe={...Ey,aPosition:Pi("float32",3,0),elements:Kw("uint32"),uBboxMin:Ne("v3"),uBboxMax:Ne("v3"),uBboxSize:Ne("v3"),uMaxSteps:Ne("i"),uStepScale:Ne("f"),uJumpLength:Ne("f"),uTransform:Ne("m4"),uGridDim:Ne("v3"),tTransferTex:xn("image-uint8","alpha","ubyte","linear"),uTransferScale:Ne("f","material"),dGridTexType:cn("string",["2d","3d"]),uGridTexDim:Ne("v3"),tGridTex:xn("texture","rgba","ubyte","linear"),uGridStats:Ne("v4"),uCellDim:Ne("v3"),uCartnToUnit:Ne("m4"),uUnitToCartn:Ne("m4"),dPackedGroup:cn("boolean"),dAxisOrder:cn("string",["012","021","102","120","201","210"]),dIgnoreLight:cn("boolean"),dXrayShaded:cn("string",["off","on","inverted"])},BZe={...Ey,aGroup:Pi("float32",1,0),aPosition:Pi("float32",3,0),aNormal:Pi("float32",3,0),elements:Kw("uint32"),dVaryingGroup:cn("boolean"),dFlatShaded:cn("boolean"),uDoubleSided:Ne("b","material"),dFlipSided:cn("boolean"),dIgnoreLight:cn("boolean"),dXrayShaded:cn("string",["off","on","inverted"]),dTransparentBackfaces:cn("string",["off","on","opaque"]),uBumpFrequency:Ne("f","material"),uBumpAmplitude:Ne("f","material"),meta:_o("unknown")},jZe={...Ey,...LD,aGroup:Pi("float32",1,0),aPosition:Pi("float32",3,0),dPointSizeAttenuation:cn("boolean"),dPointStyle:cn("string",["square","circle","fuzzy"])},zZe={...Ey,...LD,aGroup:Pi("float32",1,0),aMapping:Pi("float32",2,0),aStart:Pi("float32",3,0),aEnd:Pi("float32",3,0),elements:Kw("uint32"),dLineSizeAttenuation:cn("boolean"),uDoubleSided:Ne("b","material"),dFlipSided:cn("boolean")},HZe={...Ey,...LD,uTexDim:Ne("v2"),tPositionGroup:xn("image-float32","rgba","float","nearest"),padding:_o("number"),uDoubleSided:Ne("b","material"),dIgnoreLight:cn("boolean"),dXrayShaded:cn("string",["off","on","inverted"]),dTransparentBackfaces:cn("string",["off","on","opaque"]),dSolidInterior:cn("boolean"),dClipPrimitive:cn("boolean"),dApproximate:cn("boolean"),uAlphaThickness:Ne("f"),uBumpFrequency:Ne("f","material"),uBumpAmplitude:Ne("f","material"),lodLevels:_o("unknown"),centerBuffer:_o("float32"),groupBuffer:_o("float32")},qZe={...Ey,...LD,aGroup:Pi("float32",1,0),aPosition:Pi("float32",3,0),aMapping:Pi("float32",2,0),aDepth:Pi("float32",1,0),elements:Kw("uint32"),aTexCoord:Pi("float32",2,0),tFont:xn("image-uint8","alpha","ubyte","linear"),padding:_o("number"),uBorderWidth:Ne("f","material"),uBorderColor:Ne("v3","material"),uOffsetX:Ne("f","material"),uOffsetY:Ne("f","material"),uOffsetZ:Ne("f","material"),uBackgroundColor:Ne("v3","material"),uBackgroundOpacity:Ne("f","material")},$Ze={...Ey,uGeoTexDim:Ne("v2","buffered"),tPosition:xn("texture","rgb","float","nearest"),tGroup:xn("texture","alpha","float","nearest"),tNormal:xn("texture","rgb","float","nearest"),dVaryingGroup:cn("boolean"),dFlatShaded:cn("boolean"),uDoubleSided:Ne("b","material"),dFlipSided:cn("boolean"),dIgnoreLight:cn("boolean"),dXrayShaded:cn("string",["off","on","inverted"]),dTransparentBackfaces:cn("string",["off","on","opaque"]),uBumpFrequency:Ne("f","material"),uBumpAmplitude:Ne("f","material"),meta:_o("unknown")},XZe={...Ey,aGroup:Pi("float32",1,0),aPosition:Pi("float32",3,0),aUv:Pi("float32",2,0),elements:Kw("uint32"),uImageTexDim:Ne("v2"),tImageTex:xn("image-uint8","rgba","ubyte","nearest"),tGroupTex:xn("image-uint8","rgba","ubyte","nearest"),dInterpolation:cn("string",AZe)},ZZe={...Ey,...LD,aGroup:Pi("float32",1,0),aStart:Pi("float32",3,0),aEnd:Pi("float32",3,0),aMapping:Pi("float32",3,0),aScale:Pi("float32",1,0),aCap:Pi("float32",1,0),aColorMode:Pi("float32",1,0),elements:Kw("uint32"),padding:_o("number"),uDoubleSided:Ne("b","material"),dIgnoreLight:cn("boolean"),dXrayShaded:cn("string",["off","on","inverted"]),dTransparentBackfaces:cn("string",["off","on","opaque"]),dSolidInterior:cn("boolean"),uBumpFrequency:Ne("f","material"),uBumpAmplitude:Ne("f","material"),dDualColor:cn("boolean")},JZe=Kc(0,2147483647),ky=Kc(0,2147483647);function Jw(e,t,n,r){return{id:JZe(),type:e,values:t,state:n,materialId:r}}var zr,Bc;function xfe(e){const t=e&&e.getElement("vertex"),n=e&&e.getElement("material"),r={group:"",vRed:"",vGreen:"",vBlue:"",mRed:"",mGreen:"",mBlue:""},i=[["",""]],o=[["",""]];if(t){for(let l=0,c=t.propertyNames.length;l<c;++l){const u=t.propertyNames[l],d=t.propertyTypes[l];("uchar"===d||"uint8"===d||"ushort"===d||"uint16"===d||"uint"===d||"uint32"===d||"int"===d)&&i.push([u,u]),("uchar"===d||"uint8"===d)&&o.push([u,u])}t.propertyNames.includes("atomid")?r.group="atomid":t.propertyNames.includes("material_index")&&(r.group="material_index"),t.propertyNames.includes("red")&&(r.vRed="red"),t.propertyNames.includes("green")&&(r.vGreen="green"),t.propertyNames.includes("blue")&&(r.vBlue="blue")}const s=[["",""]];if(n){for(let l=0,c=n.propertyNames.length;l<c;++l){const u=n.propertyNames[l],d=n.propertyTypes[l];("uchar"===d||"uint8"===d)&&s.push([u,u])}n.propertyNames.includes("red")&&(r.mRed="red"),n.propertyNames.includes("green")&&(r.mGreen="green"),n.propertyNames.includes("blue")&&(r.mBlue="blue")}return{...on.Params,coloring:I.MappedStatic(r.vRed&&r.vGreen&&r.vBlue?"vertex":r.mRed&&r.mGreen&&r.mBlue?"material":"uniform",{vertex:I.Group({red:I.Select(r.vRed,o,{label:"Red Property"}),green:I.Select(r.vGreen,o,{label:"Green Property"}),blue:I.Select(r.vBlue,o,{label:"Blue Property"})},{isFlat:!0}),material:I.Group({red:I.Select(r.mRed,s,{label:"Red Property"}),green:I.Select(r.mGreen,s,{label:"Green Property"}),blue:I.Select(r.mBlue,s,{label:"Blue Property"})},{isFlat:!0}),uniform:I.Group({color:I.Color(qn.grey),saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1})},{isFlat:!0})}),grouping:I.MappedStatic(r.group?"vertex":"none",{vertex:I.Group({group:I.Select(r.group,i,{label:"Group Property"})},{isFlat:!0}),none:I.Group({})})}}!function(e){function n(u){return{color:sH(0,{}),size:oH(0,{})}}function r(u){const d=u.transforms.length,f=Bc.Location(u);return Vi(u.groupCount,d,1,(m,h)=>(f.group=m,f.instance=h,f))}function i(u,d,f,p,m){const h=m&&m.aTransform.ref.value.length>=16*u.length?m.aTransform.ref.value:new Float32Array(16*u.length);for(let g=0,y=u.length;g<y;++g)fe.toArray(u[g],h,16*g);return A9(h,u.length,d,f,p,m)}e.create=function t(u,d,f,p,m,h,g){return{id:oo.create22(),name:u,sourceData:d,geometry:f,transforms:g||[fe.identity()],get groupCount(){return $a.getGroupCount(f)},getColor:p,getSize:m,getLabel:h}},e.getTheme=n,e.groupIterator=r,e.createTransform=i,e.createRenderObject=function o(u,d){const f=n(),p=$a.getUtils(u.geometry),m=ky(),h=r(u),g=i(u.transforms,u.geometry.boundingSphere,d.cellSize,d.batchSize),y=p.createValues(u.geometry,g,h,f,d),v=p.createRenderableState(d);return Jw(u.geometry.kind,y,v,m)},e.Loci=function s(u){return{kind:"shape-loci",shape:u}},e.isLoci=function a(u){return!!u&&"shape-loci"===u.kind},e.areLociEqual=function l(u,d){return u.shape===d.shape},e.isLociEmpty=function c(u){return 0===u.shape.groupCount}}(zr||(zr={})),function(e){function a(p){let m=0;for(const h of p.groups)m+=Ve.size(h.ids);return m}e.Location=function t(p,m=0,h=0){return{kind:"group-location",shape:p,group:m,instance:h}},e.isLocation=function n(p){return!!p&&"group-location"===p.kind},e.Loci=function r(p,m){return{kind:"group-loci",shape:p,groups:m}},e.isLoci=function i(p){return!!p&&"group-loci"===p.kind},e.areLociEqual=function o(p,m){if(p.shape!==m.shape||p.groups.length!==m.groups.length)return!1;for(let h=0,g=p.groups.length;h<g;++h){const{ids:y,instance:v}=p.groups[h],{ids:x,instance:_}=m.groups[h];if(v!==_||!Ve.areEqual(y,x))return!1}return!0},e.isLociEmpty=function s(p){return 0===a(p)},e.size=a;const l=new X0,c=C.zero();function u(p,m,h,g){const{indices:y,offsets:v}=m;for(const{ids:x,instance:_}of p)Ve.forEach(x,w=>{for(let A=v[w],M=v[w+1];A<M;++A)C.fromArray(c,h,3*y[A]),C.transformMat4(c,c,g[_]),l.includeStep(c)})}function d(p,m,h,g){const{indices:y,offsets:v}=m;for(const{ids:x,instance:_}of p)Ve.forEach(x,w=>{for(let A=v[w],M=v[w+1];A<M;++A)C.fromArray(c,h,3*y[A]),C.transformMat4(c,c,g[_]),l.radiusStep(c)})}e.getBoundingSphere=function f(p,m){m||(m=ke()),l.reset();let h=0;const{geometry:g,transforms:y}=p.shape;if("mesh"===g.kind||"points"===g.kind){const v="mesh"===g.kind?g.vertexBuffer.ref.value:g.centerBuffer.ref.value;u(p.groups,g.groupMapping,v,y),l.finishedIncludeStep(),d(p.groups,g.groupMapping,v,y)}else if("lines"===g.kind){const v=g.startBuffer.ref.value,x=g.endBuffer.ref.value;u(p.groups,g.groupMapping,v,y),u(p.groups,g.groupMapping,x,y),l.finishedIncludeStep(),d(p.groups,g.groupMapping,v,y),d(p.groups,g.groupMapping,x,y)}else{if("spheres"!==g.kind&&"text"!==g.kind)return ke.copy(m,g.boundingSphere);{const v=g.centerBuffer.ref.value;u(p.groups,g.groupMapping,v,y),l.finishedIncludeStep(),d(p.groups,g.groupMapping,v,y);for(const{ids:x,instance:_}of p.groups)Ve.forEach(x,w=>{const A=p.shape.getSize(w,_);h<A&&(h=A)})}}return C.copy(m.center,l.center),m.radius=Math.sqrt(l.radiusSq),ke.expand(m,m,h),m}}(Bc||(Bc={}));const _fe=xfe();function tQe(e,t,n,r,i){const{vertices:o,normals:s,groups:a}=n,l=r.getProperty("x"),c=r.getProperty("y"),u=r.getProperty("z");if(!l||!c||!u)throw new Error("missing coordinate properties");const d=r.getProperty("nx"),f=r.getProperty("ny"),p=r.getProperty("nz"),m=!!d&&!!f&&!!p;for(let h=e;h<t;++h)tt.add3(o,l.value(h),c.value(h),u.value(h)),m&&tt.add3(s,d.value(h),f.value(h),p.value(h)),tt.add(a,i[h])}function nQe(e,t,n,r){const{indices:i}=n;for(let o=e;o<t;++o){const{entries:s,count:a}=r.value(o);3===a?tt.add3(i,s[0],s[1],s[2]):4===a&&(tt.add3(i,s[2],s[1],s[0]),tt.add3(i,s[2],s[0],s[3]))}}function aH(){return aH=le(function*(e,t,n,r,i){const o=Ct.createState(t.rowCount,t.rowCount/4,i),s=t.getProperty("x"),a=t.getProperty("y"),l=t.getProperty("z");if(!s||!a||!l)throw new Error("missing coordinate properties");const c=t.getProperty("nx"),u=t.getProperty("ny"),d=t.getProperty("nz"),f=!!c&&!!u&&!!d,p=1e5;for(let h=0,g=t.rowCount;h<g;h+=p)tQe(h,Math.min(h+p,g),o,t,r),e.shouldUpdate&&(yield e.update({message:"adding ply mesh vertices",current:h,max:g}));for(let h=0,g=n.rowCount;h<g;h+=p)nQe(h,Math.min(h+p,g),o,n),e.shouldUpdate&&(yield e.update({message:"adding ply mesh faces",current:h,max:g}));const m=Ct.getMesh(o);return f||on.computeNormals(m),O.updateIfChanged(m.varyingGroup,!0),m}),aH.apply(this,arguments)}const My=ce.Schema.int;function Sfe(e,t,n){const{coloring:r}=n,{rowCount:i}=e;let o,s,a;if("vertex"===r.name)o=e.getProperty(r.params.red)||ce.ofConst(127,i,My),s=e.getProperty(r.params.green)||ce.ofConst(127,i,My),a=e.getProperty(r.params.blue)||ce.ofConst(127,i,My);else if("material"===r.name)o=t&&t.getProperty(r.params.red)||ce.ofConst(127,i,My),s=t&&t.getProperty(r.params.green)||ce.ofConst(127,i,My),a=t&&t.getProperty(r.params.blue)||ce.ofConst(127,i,My);else{let l=r.params.color;l=st.saturate(l,r.params.saturation),l=st.lighten(l,r.params.lightness);const[c,u,d]=st.toRgb(l);o=ce.ofConst(c,i,My),s=ce.ofConst(u,i,My),a=ce.ofConst(d,i,My)}return{kind:r.name,red:o,green:s,blue:a}}function Cfe(e,t,n,r){const{kind:i,red:o,green:s,blue:a}=n,{ids:l,map:c,label:u}=r,{source:d,transforms:f}=e;return zr.create("ply-mesh",d,t,p=>{const m="material"===i?p:c[p];return st.fromRgb(o.value(m),s.value(m),a.value(m))},()=>1,p=>`${u} ${l[p]}`,f)}function oQe(){let e,t,n,r,i,o;return function(){var a=le(function*(l,c,u,d){const f=c.source.getElement("vertex");if(!f)throw new Error("missing vertex element");const p=c.source.getElement("face");if(!p)throw new Error("missing face element");const m=c.source.getElement("material");let h=!1,g=!1;return(!e||e!=e)&&(h=!0),(!t||!I.isParamEqual(_fe.grouping,t.grouping,u.grouping))&&(h=!0),(!t||!I.isParamEqual(_fe.coloring,t.coloring,u.coloring))&&(g=!0),h?(i=Sfe(f,m,u),o=function iQe(e,t){const{grouping:n}=t,{rowCount:r}=e,i="vertex"===n.name?e.getProperty(n.params.group):void 0,o="vertex"===n.name?yf(n.params.group):"Vertex",s=i?i.toArray({array:Uint32Array}):Sd(new Uint32Array(r)),a=i?Bh(s):r-1,l=new Uint32Array(a+1);for(let c=0,u=s.length;c<u;++c)l[s[c]]=c;return{ids:s,map:l,label:o}}(f,u),r=yield function rQe(e,t,n,r,i){return aH.apply(this,arguments)}(l,f,p,o.ids,d&&d.geometry),n=Cfe(c,r,i,o)):g&&(i=Sfe(f,m,u),n=Cfe(c,r,i,o)),e=c,t=op(u),n});return function(c,u,d,f){return a.apply(this,arguments)}}()}function Ry(){return Ry.empty()}function MN(e,t,n,r){let i=n,o=r-1,s=t.charCodeAt(i);for(;(32===s||s>=48&&s<=57)&&i<=o;)s=t.charCodeAt(++i);for(s=t.charCodeAt(o);(32===s||s>=48&&s<=57)&&o>=i;)s=t.charCodeAt(--o);if(++o,i===o||i+1===o)return ot.add(e,i,o);if(s=t.charCodeAt(i),i+2===o){const a=t.charCodeAt(i+1);if(!((78!==s&&110!==s||65!==a&&97!==a)&&(67!==s&&99!==s||76!==a&&108!==a)&&(70!==s&&102!==s||69!==a&&101!==a)&&(83!==s&&115!==s||73!==a&&105!==a)&&(66!==s&&98!==s||82!==a&&114!==a)&&(65!==s&&97!==s||83!==a&&115!==a)))return ot.add(e,i,i+2)}if(67===s||99===s||72===s||104===s||78===s||110===s||79===s||111===s||80===s||112===s||83===s||115===s)return ot.add(e,i,i+1);ot.add(e,i,i)}!function(e){function t(i,o){return{size:i,anglesInRadians:o}}function n(){return t(C(),C())}e.create=t,e.empty=n,e.fromBasis=function r(i,o,s){const a=C.magnitude(i),l=C.magnitude(o),c=C.magnitude(s),u=Math.acos(C.dot(o,s)/(l*c)),d=Math.acos(C.dot(i,s)/(a*c)),f=Math.acos(C.dot(i,o)/(a*l));return a<=0||l<=0||c<=0||u>=Math.PI||d>=Math.PI||f>=Math.PI?n():t(C.create(a,l,c),C.create(u,d,f))}}(Ry||(Ry={}));const cQe=new Set(["NA","CL","FE","SI","BR","AS","LI"]),uQe=new Set(["C","H","N","O","P","S","F","B"]),dQe=/^[\s\d]+|[\s\d]+$/g;function eA(e,t){const n=(e=e.replace(dQe,"").toUpperCase()).length;if(0===n||1===n||cQe.has(e))return e;if(3===n&&t===e){if("SOD"===e)return"NA";if("POT"===e)return"K";if("CES"===e)return"CS";if("CAL"===e)return"CA";if("CLA"===e)return"CL"}return uQe.has(e[0])?e[0]:""}const lH="ABCDEFGHIJKLMNOPQRSTUVWXYZ",jD=k5(function fQe(e){let n=e,r=0,i=lH[n%26];for(;n>=26;)n=Math.floor(n/26),i+=lH[n%26],r+=1;return r>=5&&console.warn("getChainId overflow"),i});function pQe(e,t){const n=e.atomName,r=e.residueName,i=new Array(e.count),o=new Array(e.count),s=new Uint32Array(e.count),a=new Uint32Array(e.count),l=new Array(e.count),c=new Gh,u=new qh(e.residueNumber,e.atomName);let d="",f=0,p="",m=0,h=0,g=-1;for(let x=0,_=e.count;x<_;++x){const w=e.residueNumber.value(x);if(w!==g){const A=e.residueName.value(x),M=x1(u.add(A,x).type,A);(M!==h||w!==g+1&&!(99999===g&&0===w))&&(p=jD(f),f+=1,m=0),d=c.getEntityId(A,M,p),m+=1,g=w,h=M}i[x]=d,o[x]=p,s[x]=m,a[x]=x,l[x]=eA(e.atomName.value(x),e.residueName.value(x))}const y=ce.ofStringArray(o),v=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:y,auth_atom_id:n,auth_comp_id:r,auth_seq_id:e.residueNumber,Cartn_x:ce.ofFloatArray(ce.mapToArray(e.x,x=>10*x,Float32Array)),Cartn_y:ce.ofFloatArray(ce.mapToArray(e.y,x=>10*x,Float32Array)),Cartn_z:ce.ofFloatArray(ce.mapToArray(e.z,x=>10*x,Float32Array)),id:ce.ofIntArray(a),label_asym_id:y,label_atom_id:n,label_comp_id:r,label_seq_id:ce.ofIntArray(s),label_entity_id:ce.ofStringArray(i),occupancy:ce.ofConst(1,e.count,ce.Schema.float),type_symbol:ce.ofStringArray(l),pdbx_PDB_model_num:ce.ofConst(t,e.count,ce.Schema.int)},e.count);return hp({entity:c.getEntityTable(),chem_comp:u.getChemCompTable(),atom_site:v})}var cH;function mQe(e,t){const n=(o,s)=>(t.substr(o,s)||"").trim(),r={entry_id:Tt.ofString(e),length_a:Tt.ofString(n(6,9)),length_b:Tt.ofString(n(15,9)),length_c:Tt.ofString(n(24,9)),angle_alpha:Tt.ofString(n(33,7)),angle_beta:Tt.ofString(n(40,7)),angle_gamma:Tt.ofString(n(47,7)),Z_PDB:Tt.ofString(n(66,4)),pdbx_unique_axis:Tt.ofString("?")},i={entry_id:Tt.ofString(e),"space_group_name_H-M":Tt.ofString(n(55,11)),Int_Tables_number:Tt.ofString("?"),cell_setting:Tt.ofString("?"),space_group_name_Hall:Tt.ofString("?")};return[ll.ofFields("cell",r),ll.ofFields("symmetry",i)]}function wfe(e,t){return{id:e,details:t,groups:[]}}function gQe(e,t,n){const r=[];let i,o,s,a=1,l=1;const c=h=>e.data.substring(e.indices[2*h],e.indices[2*h+1]);for(let h=t;h<n;h++){let g=c(h);if("BIOMOLECULE:"===g.substr(11,12)){const y=g.substr(23).trim();let v=`Biomolecule ${y}`;g=c(h+1),"APPLY THE FOLLOWING TO CHAINS:"!==g.substr(11,30)&&(h++,v=g.substr(11).trim()),i=wfe(y,v),r.push(i)}else if("BIOMT"===g.substr(13,5)){const y=g.split(/\s+/),v=parseInt(g[18])-1;0===v&&(s=fe.identity(),o.operators.push({id:a++,matrix:s})),fe.setValue(s,v,0,parseFloat(y[4])),fe.setValue(s,v,1,parseFloat(y[5])),fe.setValue(s,v,2,parseFloat(y[6])),fe.setValue(s,v,3,parseFloat(y[7]))}else if("APPLY THE FOLLOWING TO CHAINS:"===g.substr(11,30)||"                   AND CHAINS:"===g.substr(11,30)){"APPLY"===g.substr(11,5)&&(o={chains:[],operators:[]},i.groups.push(o));const y=g.substr(41,30).split(",");for(let v=0,x=y.length;v<x;++v){const _=y[v].trim();_&&o.chains.push(_)}}else if("APPLYING THE FOLLOWING TO CHAINS:"===g.substr(11,33)){i=wfe(`${l}`,`Biomolecule ${l}`),r.push(i),l+=1,o={chains:[],operators:[]},i.groups.push(o),h++,g=c(h);const y=g.substr(11,69).split(",");for(let v=0,x=y.length;v<x;++v){const _=y[v].trim();_&&o.chains.push(_)}}}if(0===r.length)return[];const u={id:Tt.ofStrings(r.map(h=>h.id)),details:Tt.ofStrings(r.map(h=>h.details))},d=[];for(const h of r)for(const g of h.groups)d.push({assembly_id:h.id,oper_expression:g.operators.map(y=>y.id).join(","),asym_id_list:g.chains.join(",")});const f={assembly_id:Tt.ofStrings(d.map(h=>h.assembly_id)),oper_expression:Tt.ofStrings(d.map(h=>h.oper_expression)),asym_id_list:Tt.ofStrings(d.map(h=>h.asym_id_list))},p=[];for(const h of r)for(const g of h.groups)for(const y of g.operators){const v={id:""+y.id,type:"?",name:"?",symmetry_operation:"?"};for(let x=0;x<3;x++){for(let _=0;_<3;_++)v[`matrix[${x+1}][${_+1}]`]=""+fe.getValue(y.matrix,x,_);v[`vector[${x+1}]`]=""+fe.getValue(y.matrix,x,3)}p.push(v)}const m={id:Tt.ofStrings(p.map(h=>h.id)),type:Tt.ofStrings(p.map(h=>h.type)),name:Tt.ofStrings(p.map(h=>h.name)),symmetry_operation:Tt.ofStrings(p.map(h=>h.symmetry_operation))};for(let h=0;h<3;h++){for(let y=0;y<3;y++){const v=`matrix[${h+1}][${y+1}]`;m[v]=Tt.ofStrings(p.map(x=>x[v]))}const g=`vector[${h+1}]`;m[g]=Tt.ofStrings(p.map(y=>y[g]))}return[ll.ofFields("pdbx_struct_assembly",u),ll.ofFields("pdbx_struct_assembly_gen",f),ll.ofFields("pdbx_struct_oper_list",m)]}function yQe(e,t,n){const r=[];let i;const o=c=>e.data.substring(e.indices[2*c],e.indices[2*c+1]);for(let c=t;c<n;c++){const u=o(c),d=u.split(/\s+/),f=parseInt(u[5])-1;0===f&&(i=fe.identity(),r.push(i)),fe.setValue(i,f,0,parseFloat(d[2])),fe.setValue(i,f,1,parseFloat(d[3])),fe.setValue(i,f,2,parseFloat(d[4])),fe.setValue(i,f,3,parseFloat(d[5]))}if(0===r.length)return[];const s=[];let a=1;for(const c of r){const u={id:"ncsop"+a++,code:".",details:"."};for(let d=0;d<3;d++){for(let f=0;f<3;f++)u[`matrix[${d+1}][${f+1}]`]=""+fe.getValue(c,d,f);u[`vector[${d+1}]`]=""+fe.getValue(c,d,3)}s.push(u)}const l={id:Tt.ofStrings(s.map(c=>c.id)),code:Tt.ofStrings(s.map(c=>c.code)),details:Tt.ofStrings(s.map(c=>c.details))};for(let c=0;c<3;c++){for(let d=0;d<3;d++){const f=`matrix[${c+1}][${d+1}]`;l[f]=Tt.ofStrings(s.map(p=>p[f]))}const u=`vector[${c+1}]`;l[u]=Tt.ofStrings(s.map(d=>d[u]))}return[ll.ofFields("struct_ncs_oper",l)]}!function(e){e.is=function t(r){return"gro"===r?.kind},e.fromGro=function n(r){return{kind:"gro",name:r.structures[0].header.title,data:r}}}(cH||(cH={}));const bQe={1:"helx_rh_al_p",2:"helx_rh_om_p",3:"helx_rh_pi_p",4:"helx_rh_ga_p",5:"helx_rh_3t_p",6:"helx_lh_al_p",7:"helx_lh_om_p",8:"helx_lh_ga_p",9:"helx_rh_27_p",10:"helx_rh_pp_p"};function xQe(e,t,n){const r=[],i=u=>e.data.substring(e.indices[2*u],e.indices[2*u+1]);for(let u=t;u<n;u++){const d=i(u);r.push({serNum:d.substr(7,3).trim(),helixID:d.substr(11,3).trim(),initResName:d.substr(15,3).trim(),initChainID:d.substr(19,1).trim(),initSeqNum:d.substr(21,4).trim(),initICode:d.substr(25,1).trim(),endResName:d.substr(27,3).trim(),endChainID:d.substr(31,3).trim(),endSeqNum:d.substr(33,4).trim(),endICode:d.substr(37,1).trim(),helixClass:d.substr(38,2).trim(),comment:d.substr(40,30).trim(),length:d.substr(71,5).trim()})}const o=Tt.ofStrings(r.map(u=>u.initChainID)),s=Tt.ofStrings(r.map(u=>u.initResName)),a=Tt.ofStrings(r.map(u=>u.endChainID)),l=Tt.ofStrings(r.map(u=>u.endResName)),c={beg_label_asym_id:o,beg_label_comp_id:s,beg_label_seq_id:Tt.ofUndefined(r.length,ce.Schema.int),beg_auth_asym_id:o,beg_auth_comp_id:s,beg_auth_seq_id:Tt.ofStrings(r.map(u=>u.initSeqNum)),conf_type_id:Tt.ofStrings(r.map(u=>function vQe(e){return bQe[e]||"helx_p"}(u.helixClass))),details:Tt.ofStrings(r.map(u=>u.comment)),end_label_asym_id:a,end_label_comp_id:l,end_label_seq_id:Tt.ofUndefined(r.length,ce.Schema.int),end_auth_asym_id:a,end_auth_comp_id:l,end_auth_seq_id:Tt.ofStrings(r.map(u=>u.endSeqNum)),id:Tt.ofStrings(r.map(u=>u.serNum)),pdbx_beg_PDB_ins_code:Tt.ofStrings(r.map(u=>u.initICode)),pdbx_end_PDB_ins_code:Tt.ofStrings(r.map(u=>u.endICode)),pdbx_PDB_helix_class:Tt.ofStrings(r.map(u=>u.helixClass)),pdbx_PDB_helix_length:Tt.ofStrings(r.map(u=>u.length)),pdbx_PDB_helix_id:Tt.ofStrings(r.map(u=>u.helixID))};return ll.ofFields("struct_conf",c)}function _Qe(e,t,n){const r=[],i=f=>e.data.substring(e.indices[2*f],e.indices[2*f+1]);for(let f=t;f<n;f++){const p=i(f);r.push({strand:p.substr(7,3).trim(),sheetID:p.substr(11,3).trim(),numStrands:p.substr(14,2).trim(),initResName:p.substr(17,3).trim(),initChainID:p.substr(21,1).trim(),initSeqNum:p.substr(22,4).trim(),initICode:p.substr(26,1).trim(),endResName:p.substr(28,3).trim(),endChainID:p.substr(32,1).trim(),endSeqNum:p.substr(33,4).trim(),endICode:p.substr(37,1).trim(),sense:p.substr(38,2).trim(),curAtom:p.substr(41,4).trim(),curResName:p.substr(45,3).trim(),curChainId:p.substr(49,1).trim(),curResSeq:p.substr(50,4).trim(),curICode:p.substr(54,1).trim(),prevAtom:p.substr(56,4).trim(),prevResName:p.substr(60,3).trim(),prevChainId:p.substr(64,1).trim(),prevResSeq:p.substr(65,4).trim(),prevICode:p.substr(69,1).trim()})}const o=Tt.ofStrings(r.map(f=>f.initChainID)),s=Tt.ofStrings(r.map(f=>f.initResName)),a=Tt.ofStrings(r.map(f=>f.initSeqNum)),l=Tt.ofStrings(r.map(f=>f.endChainID)),c=Tt.ofStrings(r.map(f=>f.endResName)),u=Tt.ofStrings(r.map(f=>f.endSeqNum)),d={beg_label_asym_id:o,beg_label_comp_id:s,beg_label_seq_id:a,beg_auth_asym_id:o,beg_auth_comp_id:s,beg_auth_seq_id:a,end_label_asym_id:l,end_label_comp_id:l,end_label_seq_id:u,end_auth_asym_id:l,end_auth_comp_id:c,end_auth_seq_id:u,id:Tt.ofStrings(r.map(f=>f.strand)),sheet_id:Tt.ofStrings(r.map(f=>f.sheetID)),pdbx_beg_PDB_ins_code:Tt.ofStrings(r.map(f=>f.initICode)),pdbx_end_PDB_ins_code:Tt.ofStrings(r.map(f=>f.endICode))};return ll.ofFields("struct_sheet_range",d)}const SQe={MOL_ID:"",MOLECULE:"",CHAIN:"",FRAGMENT:"",SYNONYM:"",EC:"",ENGINEERED:"",MUTATION:"",OTHER_DETAILS:""};function CQe(e,t,n){const r=l=>e.data.substring(e.indices[2*l],e.indices[2*l+1]);let i,o={chains:[],description:""};const s=[];for(let l=t;l<n;l++){const u=r(l).substr(10,70).trim(),d=u.indexOf(":"),f=u.substring(0,d);let p;f in SQe?(i=f,p=u.substring(d+2)):p=u,p=p.replace(/;$/,""),"MOL_ID"===i?(o={chains:[],description:""},s.push(o)):"MOLECULE"===i?(o.description&&(o.description+=" "),o.description+=p):"CHAIN"===i&&Array.prototype.push.apply(o.chains,p.split(/\s*,\s*/))}const a=[];for(const l of s)for(const c of l.chains)a.push({description:l.description,chains:[c]});return a}function wQe(e,t,n){const r=o=>e.data.substring(e.indices[2*o],e.indices[2*o+1]),i=new Map;for(let o=t;o<n;o++){const s=r(o),a=s.substr(11,3).trim(),l=s.substr(15).trim();i.has(a)?i.set(a,`${i.get(a)} ${l}`):i.set(a,l)}return i}function Afe(e,t,n,r,i,o){const{data:s}=n,a=i-r;ot.addToken(e.group_PDB,kt.trim(n,r,r+6)),kt.trim(n,r+6,r+11),e.id[e.index]=n.data.substring(n.tokenStart,n.tokenEnd),ot.addToken(e.auth_atom_id,kt.trim(n,r+12,r+16)),32===s.charCodeAt(r+16)?ot.add(e.label_alt_id,0,0):ot.add(e.label_alt_id,r+16,r+17),ot.addToken(e.auth_comp_id,kt.trim(n,r+17,r+20)),ot.add(e.auth_asym_id,r+21,r+22),ot.addToken(e.auth_seq_id,kt.trim(n,r+22,r+26)),32===s.charCodeAt(r+26)?ot.add(e.pdbx_PDB_ins_code,0,0):ot.add(e.pdbx_PDB_ins_code,r+26,r+27),ot.addToken(e.Cartn_x,kt.trim(n,r+30,r+38)),ot.addToken(e.Cartn_y,kt.trim(n,r+38,r+46)),ot.addToken(e.Cartn_z,kt.trim(n,r+46,r+54)),ot.addToken(e.occupancy,kt.trim(n,r+54,r+60)),a>=66?ot.addToken(e.B_iso_or_equiv,kt.trim(n,r+60,r+66)):ot.add(e.B_iso_or_equiv,0,0),o&&ot.addToken(e.partial_charge,kt.trim(n,r+70,r+76)),a>=78&&!o?(kt.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?ot.addToken(e.type_symbol,n):MN(e.type_symbol,s,r+12,r+16)):MN(e.type_symbol,s,r+12,r+16),e.pdbx_PDB_model_num[e.index]=t,e.index++}function TQe(e){const t=Tt.ofTokens(e.pdbx_auth_seq_id),n=Tt.ofTokens(e.pdbx_auth_comp_id),r=Tt.ofTokens(e.pdbx_auth_asym_id),i=Tt.ofTokens(e.pdbx_auth_atom_id),o={id:Tt.ofStrings(e.id),type_symbol:Tt.ofTokens(e.type_symbol),pdbx_label_atom_id:i,pdbx_label_alt_id:Tt.ofTokens(e.pdbx_label_alt_id),pdbx_label_comp_id:n,pdbx_label_asym_id:r,pdbx_label_seq_id:t,pdbx_PDB_ins_code:Tt.ofTokens(e.pdbx_PDB_ins_code),pdbx_auth_seq_id:t,pdbx_auth_comp_id:n,pdbx_auth_asym_id:r,pdbx_auth_atom_id:i};return o["U[1][1]"]=Tt.ofNumbers(e["U[1][1]"]),o["U[2][2]"]=Tt.ofNumbers(e["U[2][2]"]),o["U[3][3]"]=Tt.ofNumbers(e["U[3][3]"]),o["U[1][2]"]=Tt.ofNumbers(e["U[1][2]"]),o["U[1][3]"]=Tt.ofNumbers(e["U[1][3]"]),o["U[2][3]"]=Tt.ofNumbers(e["U[2][3]"]),o}function DQe(e,t,n,r,i){const{data:o}=n,s=i-r;kt.trim(n,r+6,r+11),e.id[e.index]=o.substring(n.tokenStart,n.tokenEnd),ot.addToken(e.pdbx_auth_atom_id,kt.trim(n,r+12,r+16)),32===o.charCodeAt(r+16)?ot.add(e.pdbx_label_alt_id,0,0):ot.add(e.pdbx_label_alt_id,r+16,r+17),ot.addToken(e.pdbx_auth_comp_id,kt.trim(n,r+17,r+20)),ot.add(e.pdbx_auth_asym_id,r+21,r+22),ot.addToken(e.pdbx_auth_seq_id,kt.trim(n,r+22,r+26)),32===o.charCodeAt(r+26)?ot.add(e.pdbx_PDB_ins_code,0,0):ot.add(e.pdbx_PDB_ins_code,r+26,r+27),e["U[1][1]"][e.index]=Gx(o,r+28,r+35)/1e4,e["U[2][2]"][e.index]=Gx(o,r+35,r+42)/1e4,e["U[3][3]"][e.index]=Gx(o,r+42,r+49)/1e4,e["U[1][2]"][e.index]=Gx(o,r+49,r+56)/1e4,e["U[1][3]"][e.index]=Gx(o,r+56,r+63)/1e4,e["U[2][3]"][e.index]=Gx(o,r+63,r+70)/1e4,s>=78?(kt.trim(n,r+76,r+78),n.tokenStart<n.tokenEnd?ot.addToken(e.type_symbol,n):MN(e.type_symbol,o,r+12,r+16)):MN(e.type_symbol,o,r+12,r+16),e.index++}function kQe(e,t,n,r){const i=e.substring(t,n);r.id_code=i.substring(62,66).trim()||void 0,r.dep_date=i.substring(50,59).trim()||void 0,r.classification=i.substring(10,50).trim()||void 0}function uH(){return uH=le(function*(e){const{lines:t}=e,{data:n,indices:r}=t,i=kt(n),o=!!e.isPdbqt;let s=0,a=0;for(let T=0,F=t.count;T<F;T++){const R=r[2*T],N=r[2*T+1];switch(n[R]){case"A":zs(n,R,N,"ATOM  ")?s++:zs(n,R,N,"ANISOU")&&a++;break;case"H":zs(n,R,N,"HETATM")&&s++}}const l={},c=function AQe(e,t){const r=()=>ot.create(e,2*t);return{index:0,group_PDB:r(),id:[],auth_atom_id:r(),label_alt_id:r(),auth_comp_id:r(),auth_asym_id:r(),auth_seq_id:r(),pdbx_PDB_ins_code:r(),Cartn_x:r(),Cartn_y:r(),Cartn_z:r(),occupancy:r(),B_iso_or_equiv:r(),type_symbol:r(),pdbx_PDB_model_num:[],label_entity_id:[],partial_charge:r()}}(n,s),u=function EQe(e,t){const r=()=>new Float32Array(t),i=()=>ot.create(e,2*t);return{index:0,count:t,id:[],type_symbol:i(),pdbx_label_atom_id:i(),pdbx_label_alt_id:i(),pdbx_label_comp_id:i(),pdbx_label_asym_id:i(),pdbx_label_seq_id:i(),pdbx_PDB_ins_code:i(),"U[1][1]":r(),"U[2][2]":r(),"U[3][3]":r(),"U[1][2]":r(),"U[1][3]":r(),"U[2][3]":r(),pdbx_auth_seq_id:i(),pdbx_auth_comp_id:i(),pdbx_auth_asym_id:i(),pdbx_auth_atom_id:i()}}(n,a),d=new Gh,f=[],p=[];let g,m=0,h="",y=!1;const v=new Set;for(let T=0,F=t.count;T<F;T++){let R=r[2*T],N=r[2*T+1];switch(n[R]){case"A":zs(n,R,N,"ATOM  ")?(m||(m++,h=""+m),Afe(c,h,i,R,N,o)):zs(n,R,N,"ANISOU")&&DQe(u,0,i,R,N);break;case"C":if(zs(n,R,N,"CRYST1"))f.push(...mQe(e.id||"?",n.substring(R,N)));else if(zs(n,R,N,"CONECT")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"CONECT");)j++;g?$n&&console.log("only single CONECT block allowed, ignoring others"):g=[T,j],T=j-1}else if(zs(n,R,N,"COMPND")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"COMPND");)j++;d.setCompounds(CQe(t,T,j)),T=j-1}break;case"H":if(zs(n,R,N,"HEADER"))kQe(n,R,N,l);else if(zs(n,R,N,"HETATM"))m||(m++,h=""+m),Afe(c,h,i,R,N,o);else if(zs(n,R,N,"HELIX")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"HELIX");)j++;f.push(xQe(t,T,j)),T=j-1}else if(zs(n,R,N,"HETNAM")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"HETNAM");)j++;p.push(...Array.from(wQe(t,T,j).entries())),T=j-1}break;case"M":if(zs(n,R,N,"MODEL ")&&(m++,h=""+m),zs(n,R,N,"MTRIX")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"MTRIX");)j++;f.push(...yQe(t,T,j)),T=j-1}break;case"O":break;case"R":if(zs(n,R,N,"REMARK 350")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"REMARK 350");)j++;f.push(...gQe(t,T,j)),T=j-1,y=!0}break;case"S":if(zs(n,R,N,"SHEET")){let j=T+1;for(;R=r[2*j],N=r[2*j+1],zs(n,R,N,"SHEET");)j++;f.push(_Qe(t,T,j)),T=j-1}break;case"T":zs(n,R,N,"TER")&&v.add(c.index)}}if(l.id_code){const T={id:Tt.ofString(l.id_code)};f.push(ll.ofFields("entry",T))}if(l.classification){const T={pdbx_keywords:Tt.ofString(l.classification)};f.push(ll.ofFields("struct_keywords",T))}if(l.dep_date){const T={recvd_initial_deposition_date:Tt.ofString(l.dep_date)};f.push(ll.ofFields("pdbx_database_status",T))}const x=ce.ofIntTokens(c.auth_seq_id),_=ce.ofStringTokens(c.auth_atom_id),w=ce.ofStringTokens(c.auth_comp_id),A=ce.ofStringTokens(c.auth_asym_id),M=new qh(x,_);M.setNames(p),d.setNames(p);for(let T=0,F=w.rowCount;T<F;++T){const R=w.value(T),N=x1(M.add(R,T).type,R);c.label_entity_id[T]=d.getEntityId(R,N,A.value(T))}const E=function IQe(e,t,n){const r=Tt.ofStrings(e.pdbx_PDB_model_num),i=Tt.ofTokens(e.auth_asym_id),o=Tt.ofTokens(e.auth_seq_id),s=Tt.ofTokens(e.pdbx_PDB_ins_code),a=Tt.ofTokens(e.auth_atom_id),l=Tt.ofTokens(e.auth_comp_id),c=Tt.ofStrings(e.id);let u=r.str(0),d=i.str(0),f=o.int(0),p=s.str(0),m=d,h=f;const g=new Map,y=new Map,v=[],x=[],_=[];let w=!1;for(let D=0,T=c.rowCount;D<T;++D)if(""!==s.str(D)){w=!0;break}for(let D=0,T=c.rowCount;D<T;++D){const F=r.str(D),R=i.str(D),N=o.int(D),j=s.str(D);let W=a.str(D);if(F!==u?(g.clear(),y.clear(),u=F,d=R,f=N,p=j,m=R,h=N):d!==R?(y.clear(),d=R,f=N,p=j,m=R,h=N):f!==N?(y.clear(),f===h?h=N:h+=1,f=N,p=j):p!==j&&(y.clear(),p=j,h+=1),g.has(R)){if(t.has(D)&&!n.hasAssemblies){const z=g.get(R)+1;g.set(R,z),m=`${R}_${z}`}}else g.set(R,0);if(v[D]=m,y.has(W)){const z=y.get(W)+1;y.set(W,z),W=`${W}_${z}`}else y.set(W,0);x[D]=W,w&&(_[D]=h)}const A=ce.ofStringArray(v),M=ce.ofStringArray(x),E=w?Tt.ofColumn(ce.ofIntArray(_)):Tt.ofUndefined(e.index,ce.Schema.int);return{auth_asym_id:i,auth_atom_id:a,auth_comp_id:l,auth_seq_id:o,B_iso_or_equiv:Tt.ofTokens(e.B_iso_or_equiv),Cartn_x:Tt.ofTokens(e.Cartn_x),Cartn_y:Tt.ofTokens(e.Cartn_y),Cartn_z:Tt.ofTokens(e.Cartn_z),group_PDB:Tt.ofTokens(e.group_PDB),id:c,label_alt_id:Tt.ofTokens(e.label_alt_id),label_asym_id:Tt.ofColumn(A),label_atom_id:Tt.ofColumn(M),label_comp_id:l,label_seq_id:E,label_entity_id:Tt.ofStrings(e.label_entity_id),occupancy:VBe(e.occupancy)?Tt.ofUndefined(e.index,ce.Schema.float):Tt.ofTokens(e.occupancy),type_symbol:Tt.ofTokens(e.type_symbol),pdbx_PDB_ins_code:Tt.ofTokens(e.pdbx_PDB_ins_code),pdbx_PDB_model_num:r,partial_charge:Tt.ofTokens(e.partial_charge)}}(c,v,{hasAssemblies:y});o||delete E.partial_charge,g&&f.push(function PQe(e,t,n,r){const i={};for(let M=0,E=r.id.rowCount;M<E;++M)i[r.id.str(M)]=M;const o=M=>e.data.substring(e.indices[2*M],e.indices[2*M+1]),s=[],a=[],l=[],c=[],u=[],d=[],f=[],p=[],m=[],h=[],g=[],y=[],v=[],x=[],_=[11,16,21,26];let w=1;for(let M=t;M<n;M++){const E=o(M),D=i[parseInt(E.substr(6,5))],T={};if(void 0!==D)for(let F=0;F<4;++F){const R=parseInt(E.substr(_[F],5));if(Number.isNaN(R))continue;const N=i[R];void 0!==N&&(D>N||void 0===T[N]&&(s.push(`covale${w}`),a.push("covale"),l.push(r.label_asym_id.str(D)),c.push(r.label_seq_id.int(D)),u.push(r.auth_seq_id.int(D)),d.push(r.label_atom_id.str(D)),f.push(r.label_alt_id.str(D)),p.push(r.pdbx_PDB_ins_code.str(D)),m.push(r.label_asym_id.str(N)),h.push(r.label_seq_id.int(N)),g.push(r.auth_seq_id.int(N)),y.push(r.label_atom_id.str(N)),v.push(r.label_alt_id.str(N)),x.push(r.pdbx_PDB_ins_code.str(N)),w+=1))}}const A={id:Tt.ofStrings(s),conn_type_id:Tt.ofStrings(a),ptnr1_label_asym_id:Tt.ofStrings(l),ptnr1_label_seq_id:Tt.ofNumbers(c),ptnr1_auth_seq_id:Tt.ofNumbers(u),ptnr1_label_atom_id:Tt.ofStrings(d),pdbx_ptnr1_label_alt_id:Tt.ofStrings(f),pdbx_ptnr1_PDB_ins_code:Tt.ofStrings(p),ptnr2_label_asym_id:Tt.ofStrings(m),ptnr2_label_seq_id:Tt.ofNumbers(h),ptnr2_auth_seq_id:Tt.ofNumbers(g),ptnr2_label_atom_id:Tt.ofStrings(y),pdbx_ptnr2_label_alt_id:Tt.ofStrings(v),pdbx_ptnr2_PDB_ins_code:Tt.ofStrings(x)};return ll.ofFields("struct_conn",A)}(t,g[0],g[1],E));const D={entity:ll.ofTable("entity",d.getEntityTable()),chem_comp:ll.ofTable("chem_comp",M.getChemCompTable()),atom_site:ll.ofFields("atom_site",E),atom_site_anisotrop:ll.ofFields("atom_site_anisotrop",TQe(u))};for(const T of f)D[T.name]=T;return{header:e.id||"PDB",categoryNames:Object.keys(D),categories:D}}),uH.apply(this,arguments)}var tA,dH,fH;function OQe(e){return Object.keys(e).filter(t=>!isNaN(t)).map(t=>+t).sort((t,n)=>t-n).map(t=>e[t])}function pH(e,t,n){return e&&void 0!==e[t]?e[t]:n}function bt(e,...t){return{kind:"alias",aliases:t,symbol:e}}function RN(e,t,...n){return e.info.namespace="molscript-macro",e.id=`molscript-macro.${e.info.name}`,{kind:"macro",symbol:e,translate:t,aliases:[e.info.name,...n]}}function BQe(e){return"alias"===e.kind||"macro"===e.kind}!function(e){e.Descriptor={name:"atom_partial_charge"},e.Provider=jh.create(e.Descriptor)}(tA||(tA={})),function(e){e.is=function t(r){return"pdb"===r?.kind},e.create=function n(r){return{kind:"pdb",name:r.id||"",data:r}}}(dH||(dH={})),function(e){e.is=function t(r){return"psf"===r?.kind},e.fromPsf=function n(r){return{kind:"psf",name:r.id,data:r}}}(fH||(fH={}));const LQe=[["Core symbols",bt(Ee.core.type.bool,"bool"),bt(Ee.core.type.num,"num"),bt(Ee.core.type.str,"str"),bt(Ee.core.type.regex,"regex"),bt(Ee.core.type.list,"list"),bt(Ee.core.type.set,"set"),bt(Ee.core.type.compositeKey,"composite-key"),bt(Ee.core.logic.not,"not"),bt(Ee.core.logic.and,"and"),bt(Ee.core.logic.or,"or"),bt(Ee.core.ctrl.if,"if"),bt(Ee.core.ctrl.fn,"fn"),bt(Ee.core.ctrl.eval,"eval"),bt(Ee.core.math.add,"add","+"),bt(Ee.core.math.sub,"sub","-"),bt(Ee.core.math.mult,"mult","*"),bt(Ee.core.math.div,"div","/"),bt(Ee.core.math.pow,"pow","**"),bt(Ee.core.math.mod,"mod"),bt(Ee.core.math.min,"min"),bt(Ee.core.math.max,"max"),bt(Ee.core.math.cantorPairing,"cantor-pairing"),bt(Ee.core.math.sortedCantorPairing,"sorted-cantor-pairing"),bt(Ee.core.math.invertCantorPairing,"invert-cantor-pairing"),bt(Ee.core.math.floor,"floor"),bt(Ee.core.math.ceil,"ceil"),bt(Ee.core.math.roundInt,"round"),bt(Ee.core.math.trunc,"trunc"),bt(Ee.core.math.abs,"abs"),bt(Ee.core.math.sign,"sign"),bt(Ee.core.math.sqrt,"sqrt"),bt(Ee.core.math.cbrt,"cbrt"),bt(Ee.core.math.sin,"sin"),bt(Ee.core.math.cos,"cos"),bt(Ee.core.math.tan,"tan"),bt(Ee.core.math.asin,"asin"),bt(Ee.core.math.acos,"acos"),bt(Ee.core.math.atan,"atan"),bt(Ee.core.math.sinh,"sinh"),bt(Ee.core.math.cosh,"cosh"),bt(Ee.core.math.tanh,"tanh"),bt(Ee.core.math.exp,"exp"),bt(Ee.core.math.log,"log"),bt(Ee.core.math.log10,"log10"),bt(Ee.core.math.atan2,"atan2"),bt(Ee.core.rel.eq,"eq","="),bt(Ee.core.rel.neq,"neq","!="),bt(Ee.core.rel.lt,"lt","<"),bt(Ee.core.rel.lte,"lte","<="),bt(Ee.core.rel.gr,"gr",">"),bt(Ee.core.rel.gre,"gre",">="),bt(Ee.core.rel.inRange,"in-range"),bt(Ee.core.str.concat,"concat"),bt(Ee.core.str.match,"regex.match"),bt(Ee.core.list.getAt,"list.get"),bt(Ee.core.set.has,"set.has"),bt(Ee.core.set.isSubset,"set.subset")],["Structure",["Types",bt(Ee.structureQuery.type.entityType,"ent-type"),bt(Ee.structureQuery.type.authResidueId,"auth-resid"),bt(Ee.structureQuery.type.labelResidueId,"label-resid"),bt(Ee.structureQuery.type.ringFingerprint,"ringfp"),bt(Ee.structureQuery.type.bondFlags,"bond-flags")],["Slots",bt(Ee.structureQuery.slot.elementSetReduce,"atom.set.reduce.value")],["Generators",bt(Ee.structureQuery.generator.atomGroups,"sel.atom.atom-groups"),bt(Ee.structureQuery.generator.queryInSelection,"sel.atom.query-in-selection"),bt(Ee.structureQuery.generator.rings,"sel.atom.rings"),bt(Ee.structureQuery.generator.empty,"sel.atom.empty"),bt(Ee.structureQuery.generator.all,"sel.atom.all"),bt(Ee.structureQuery.generator.bondedAtomicPairs,"sel.atom.bonded-pairs"),RN(C3("sel.atom.atoms",dn.Dictionary({0:wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to each atom."})}),$t.ElementSelection,"A selection of singleton atom sets."),e=>pe.struct.generator.atomGroups({"atom-test":pH(e,0,!0)})),RN(C3("sel.atom.res",dn.Dictionary({0:wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each residue."})}),$t.ElementSelection,"A selection of atom sets grouped by residue."),e=>pe.struct.generator.atomGroups({"residue-test":pH(e,0,!0),"group-by":pe.ammp("residueKey")})),RN(C3("sel.atom.chains",dn.Dictionary({0:wt(Oe.Bool,{isOptional:!0,defaultValue:!0,description:"Test applied to the 1st atom of each chain."})}),$t.ElementSelection,"A selection of atom sets grouped by chain."),e=>pe.struct.generator.atomGroups({"chain-test":pH(e,0,!0),"group-by":pe.ammp("chainKey")}))],["Modifiers",bt(Ee.structureQuery.modifier.queryEach,"sel.atom.query-each"),bt(Ee.structureQuery.modifier.intersectBy,"sel.atom.intersect-by"),bt(Ee.structureQuery.modifier.exceptBy,"sel.atom.except-by"),bt(Ee.structureQuery.modifier.unionBy,"sel.atom.union-by"),bt(Ee.structureQuery.modifier.union,"sel.atom.union"),bt(Ee.structureQuery.modifier.cluster,"sel.atom.cluster"),bt(Ee.structureQuery.modifier.includeSurroundings,"sel.atom.include-surroundings"),bt(Ee.structureQuery.modifier.surroundingLigands,"sel.atom.surrounding-ligands"),bt(Ee.structureQuery.modifier.includeConnected,"sel.atom.include-connected"),bt(Ee.structureQuery.modifier.expandProperty,"sel.atom.expand-property")],["Filters",bt(Ee.structureQuery.filter.pick,"sel.atom.pick"),bt(Ee.structureQuery.filter.first,"sel.atom.first"),bt(Ee.structureQuery.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),bt(Ee.structureQuery.filter.intersectedBy,"sel.atom.intersected-by"),bt(Ee.structureQuery.filter.within,"sel.atom.within"),bt(Ee.structureQuery.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",bt(Ee.structureQuery.combinator.intersect,"sel.atom.intersect"),bt(Ee.structureQuery.combinator.merge,"sel.atom.merge"),bt(Ee.structureQuery.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",bt(Ee.structureQuery.atomSet.atomCount,"atom.set.atom-count"),bt(Ee.structureQuery.atomSet.countQuery,"atom.set.count-query"),bt(Ee.structureQuery.atomSet.reduce,"atom.set.reduce"),bt(Ee.structureQuery.atomSet.propertySet,"atom.set.property")],["Atom Properties",bt(Ee.structureQuery.atomProperty.core.elementSymbol,"atom.el"),bt(Ee.structureQuery.atomProperty.core.vdw,"atom.vdw"),bt(Ee.structureQuery.atomProperty.core.mass,"atom.mass"),bt(Ee.structureQuery.atomProperty.core.atomicNumber,"atom.atomic-number"),bt(Ee.structureQuery.atomProperty.core.x,"atom.x"),bt(Ee.structureQuery.atomProperty.core.y,"atom.y"),bt(Ee.structureQuery.atomProperty.core.z,"atom.z"),bt(Ee.structureQuery.atomProperty.core.sourceIndex,"atom.src-index"),bt(Ee.structureQuery.atomProperty.core.operatorName,"atom.op-name"),bt(Ee.structureQuery.atomProperty.core.operatorKey,"atom.op-key"),bt(Ee.structureQuery.atomProperty.core.modelIndex,"atom.model-index"),bt(Ee.structureQuery.atomProperty.core.modelLabel,"atom.model-label"),bt(Ee.structureQuery.atomProperty.core.atomKey,"atom.key"),bt(Ee.structureQuery.atomProperty.core.bondCount,"atom.bond-count"),bt(Ee.structureQuery.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),bt(Ee.structureQuery.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),bt(Ee.structureQuery.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),bt(Ee.structureQuery.atomProperty.macromolecular.residueKey,"atom.key.res"),bt(Ee.structureQuery.atomProperty.macromolecular.chainKey,"atom.key.chain"),bt(Ee.structureQuery.atomProperty.macromolecular.entityKey,"atom.key.entity"),bt(Ee.structureQuery.atomProperty.macromolecular.isHet,"atom.is-het"),bt(Ee.structureQuery.atomProperty.macromolecular.id,"atom.id"),bt(Ee.structureQuery.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),bt(Ee.structureQuery.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),bt(Ee.structureQuery.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),bt(Ee.structureQuery.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),bt(Ee.structureQuery.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),bt(Ee.structureQuery.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),bt(Ee.structureQuery.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),bt(Ee.structureQuery.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),bt(Ee.structureQuery.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),bt(Ee.structureQuery.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),bt(Ee.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),bt(Ee.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),bt(Ee.structureQuery.atomProperty.macromolecular.occupancy,"atom.occupancy"),bt(Ee.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),bt(Ee.structureQuery.atomProperty.macromolecular.entityType,"atom.entity-type"),bt(Ee.structureQuery.atomProperty.macromolecular.entitySubtype,"atom.entity-subtype"),bt(Ee.structureQuery.atomProperty.macromolecular.entityPrdId,"atom.entity-prd-id"),bt(Ee.structureQuery.atomProperty.macromolecular.entityDescription,"atom.entity-description"),bt(Ee.structureQuery.atomProperty.macromolecular.objectPrimitive,"atom.object-primitive"),bt(Ee.structureQuery.atomProperty.macromolecular.chemCompType,"atom.chem-comp-type"),bt(Ee.structureQuery.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),bt(Ee.structureQuery.atomProperty.macromolecular.isModified,"atom.is-modified"),bt(Ee.structureQuery.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent")],["Bond Properties",bt(Ee.structureQuery.bondProperty.order,"bond.order"),bt(Ee.structureQuery.bondProperty.length,"bond.length"),bt(Ee.structureQuery.bondProperty.key,"bond.key"),bt(Ee.structureQuery.bondProperty.atomA,"bond.atom-a"),bt(Ee.structureQuery.bondProperty.atomB,"bond.atom-b"),RN(C3("bond.is",dn.List($t.BondFlag),Oe.Bool,`Test if the current bond has at least one (or all if partial = false) of the specified flags: ${Oe.oneOfValues($t.BondFlag).join(", ")}`),e=>pe.core.flags.hasAny([pe.struct.bondProperty.flags(),pe.struct.type.bondFlags(OQe(e))]))]]],Ife=[];!function Efe(e){for(const t of e)BQe(t)?Ife.push(t):t instanceof Array&&Efe(t)}(LQe);const NN=function(){const e=[],t=Object.create(null),n=Ti.create(),r=Ti.create();for(const i of Ife){for(const s of i.aliases){if(e.push([s,i]),t[s])throw new Error(`Alias '${s}' already in use.`);t[s]=i}const o=i.symbol.args;if("dictionary"===o.kind)for(const s of Object.keys(o.map)){isNaN(s)&&Ti.add(n,s,s);const a=o.map[s];"oneof"===a.type.kind&&Oe.oneOfValues(a.type).forEach(l=>Ti.add(r,l,l))}else"oneof"===o.type.kind&&Oe.oneOfValues(o.type).forEach(s=>Ti.add(r,s,s))}return{symbolList:e,symbolMap:t,namedArgs:n.array,constants:r.array}}(),nA=NN.symbolMap;function UD(e){if(cl.isLiteral(e))return e;if(cl.isSymbol(e)){if(!nA[e.name])return e;const s=nA[e.name];if("alias"===s.kind)return cl.Symbol(nA[e.name].symbol.id);throw s.translate([])}const t=cl.isSymbol(e.head)&&!!nA[e.head.name]&&"macro"===nA[e.head.name].kind,n=t?e.head:UD(e.head),r=n!==e.head;if(!e.args)return t?UD(e.head):r?cl.Apply(n):e;let o,i=!1;if(cl.isArgumentsArray(e.args)){o=[];for(let s=0,a=e.args.length;s<a;s++){const l=e.args[s],c=UD(l);l!==c&&(i=!0),o[o.length]=c}if(i||(o=e.args),!t&&!r&&!i)return e}else{o={};for(const s of Object.keys(e.args)){const a=e.args[s],l=UD(a);a!==l&&(i=!0),o[s]=l}if(!t&&!r&&!i)return e;i||(o=e.args)}if(t){const s=nA[e.head.name];return"macro"!==s.kind?cl.Apply(n,o):s.translate(o)}return cl.Apply(n,o)}function jQe(e){return UD(e)}class Ye{constructor(t){this._=t}parse(t){const n=this.skip(Ye.eof)._(t,0);return n.status?{success:!0,value:n.value}:{success:!1,index:Tfe(t,n.furthest),expected:n.expected}}tryParse(t){const n=this.parse(t);if(n.success)return n.value;{const r=function VQe(e,t){return`expected ${function UQe(e){return 1===e.length?e[0]:"one of "+e.join(", ")}(t.expected)}${function zQe(e,t){const n=t.index,r=n.offset;if(r===e.length)return", got the end of the input";const o=e.length-r>12?"...'":"'";return` at line ${n.line} column ${n.column}, got ${r>0?"'...":"'"}${e.slice(r,r+12)}${o}`}(e,t)}`}(t,n);throw new Error(r)}}or(t){return Ye.alt(this,t)}trim(t){return this.wrap(t,t)}wrap(t,n){return hH(1,"string"==typeof t?Ye.string(t):t,this,"string"==typeof n?Ye.string(n):n)}thru(t){return t(this)}then(t){return hH(1,this,t)}many(){return new Ye((t,n)=>{const r=[];let i;for(;;){if(i=Np(this._(t,n),i),!i.status)return Np(ou(n,r),i);if(n===i.index)throw new Error("infinite loop detected in .many() parser --- calling .many() on a parser which can accept zero characters is usually the cause");n=i.index,r.push(i.value)}})}times(t,n){const r=typeof n>"u"?t:n;return new Ye((i,o)=>{const s=[];let a,l,c;for(c=0;c<t;c++){if(a=this._(i,o),l=Np(a,l),!a.status)return l;o=a.index,s.push(a.value)}for(;c<r&&(a=this._(i,o),l=Np(a,l),a.status);c+=1)o=a.index,s.push(a.value);return Np(ou(o,s),l)})}result(t){return this.map(()=>t)}atMost(t){return this.times(0,t)}atLeast(t){return Ye.seq(this.times(t),this.many()).map(n=>[...n[0],...n[1]])}map(t){return new Ye((n,r)=>{const i=this._(n,r);return i.status?Np(ou(i.index,t(i.value)),i):i})}skip(t){return hH(0,this,t)}mark(){return Ye.seq(Ye.index,this,Ye.index).map(t=>({start:t[0],value:t[1],end:t[2]}))}node(t){return Ye.seq(Ye.index,this,Ye.index).map(n=>({name:t,start:n[0],value:n[1],end:n[2]}))}sepBy(t){return Ye.sepBy(this,t)}sepBy1(t){return Ye.sepBy1(this,t)}lookahead(t){return this.skip(Ye.lookahead(t))}notFollowedBy(t){return this.skip(Ye.notFollowedBy(t))}desc(t){return new Ye((n,r)=>{const i=this._(n,r);return i.status||(i.expected=[t]),i})}fallback(t){return this.or(Ye.succeed(t))}ap(t){return Ye.seq(t,this).map(([n,r])=>n(r))}chain(t){return new Ye((n,r)=>{const i=this._(n,r);return i.status?Np(t(i.value)._(n,i.index),i):i})}}function hH(e,...t){const n=t.length;return new Ye((r,i)=>{let o,s,a=i;for(let l=0;l<n;l++){if(o=Np(t[l]._(r,a),o),!o.status)return o;e===l&&(s=o.value),a=o.index}return Np(ou(a,s),o)})}function ou(e,t){return{status:!0,index:e,value:t}}function Ny(e,t){return{status:!1,furthest:e,expected:[t]}}function Np(e,t){if(!t||e.status||t.status||e.furthest>t.furthest)return e;const n=e.furthest===t.furthest?function HQe(e,t){const n=e.length,r=t.length;if(0===n)return t;if(0===r)return e;const i=new Set,o=[];for(let s=0;s<n;s++)i.has(e[s])||(o[o.length]=e[s],i.add(e[s]));for(let s=0;s<r;s++)i.has(t[s])||(o[o.length]=t[s],i.add(t[s]));return o.sort(),o}(e.expected,t.expected):t.expected;return{status:e.status,furthest:t.furthest,expected:n}}function Tfe(e,t){const n=e.slice(0,t).split("\n");return{offset:t,line:n.length,column:n[n.length-1].length+1}}var mH;!function(e){function r(...E){const D=E.length;return new e((T,F)=>{let R;const N=new Array(D);let j=F;for(let W=0;W<D;W++){if(R=Np(E[W]._(T,j),R),!R.status)return R;N[W]=R.value,j=R.index}return Np(ou(j,N),R)})}function i(...E){return 0===E.length?f("zero alternates"):new e((T,F)=>{let R;for(let N=0;N<E.length;N++)if(R=Np(E[N]._(T,F),R),R.status)return R;return R})}function s(E,D){return r(E,D.then(E).many()).map(F=>[F[0],...F[1]])}function a(E){const D=`'${E}'`;if(1===E.length){const T=E.charCodeAt(0);return new e((F,R)=>F.charCodeAt(R)===T?ou(R+1,E):Ny(R,D))}return new e((T,F)=>{const R=F+E.length;return T.slice(F,R)===E?ou(R,E):Ny(F,D)})}function u(E,D=0){const T=function c(E){return RegExp("^(?:"+E.source+")",function l(E){const D=""+E;return D.slice(D.lastIndexOf("/")+1)}(E))}(E),F=""+E;return new e((R,N)=>{const j=T.exec(R.slice(N));return j?0<=D&&D<=j.length?ou(N+j[0].length,j[D]):Ny(N,`invalid match group (0 to ${j.length}) in ${F}`):Ny(N,F)})}function d(E){return new e((D,T)=>ou(T,E))}function f(E){return new e((D,T)=>Ny(T,E))}function h(E){return new e((D,T)=>{const F=D.charAt(T);return T<D.length&&E(F)?ou(T+1,F):Ny(T,"a character "+E)})}function _(E){const D=new e((T,F)=>{const R=E()._;return D._=R,R(T,F)});return D}e.seqMap=function t(E,D,T){const F=[].slice.call(arguments);if(0===F.length)throw new Error("seqMap needs at least one argument");const R=F.pop();return function qQe(e){if("function"!=typeof e)throw new Error("not a function: "+e)}(R),r.apply(null,F).map(function(N){return R.apply(null,N)})},e.createLanguage=function n(E){const D={};for(const T of Object.keys(E))!function(F){D[F]=_(()=>E[F](D))}(T);return D},e.seq=r,e.alt=i,e.sepBy=function o(E,D){return s(E,D).or(d([]))},e.sepBy1=s,e.string=a,e.regexp=u,e.succeed=d,e.fail=f,e.lookahead=function p(E){if(function GQe(e){return e instanceof Ye}(E))return new e((D,T)=>{const F=E._(D,T);return F.status&&(F.index=T,F.value=null),F});if("string"==typeof E)return p(a(E));if(E instanceof RegExp)return p(u(E));throw new Error("not a string, regexp, or parser: "+E)},e.notFollowedBy=function m(E){return new e((D,T)=>{const F=E._(D,T);return F.status?Ny(T,'not "'+D.slice(T,F.index)+'"'):ou(T,null)})},e.test=h,e.oneOf=function g(E){return h(D=>E.indexOf(D)>=0)},e.noneOf=function y(E){return h(D=>E.indexOf(D)<0)},e.range=function v(E,D){return h(T=>E<=T&&T<=D).desc(E+"-"+D)},e.takeWhile=function x(E){return new e((D,T)=>{let F=T;for(;F<D.length&&E(D.charAt(F));)F++;return ou(F,D.slice(T,F))})},e.lazy=_,e.empty=function w(){return f("empty")},e.index=new e(function(E,D){return ou(D,Tfe(E,D))}),e.anyChar=new e((E,D)=>D>=E.length?Ny(D,"any character"):ou(D+1,E.charAt(D))),e.all=new e(function(E,D){return ou(E.length,E.slice(D))}),e.eof=new e(function(E,D){return D<E.length?Ny(D,"EOF"):ou(D,null)}),e.digit=u(/[0-9]/).desc("a digit"),e.digits=u(/[0-9]*/).desc("optional digits"),e.letter=u(/[a-z]/i).desc("a letter"),e.letters=u(/[a-z]*/i).desc("optional letters"),e.optWhitespace=u(/\s*/).desc("optional whitespace"),e.whitespace=u(/\s+/).desc("whitespace"),e.cr=a("\r"),e.lf=a("\n"),e.crlf=a("\r\n"),e.newline=i(e.crlf,e.lf,e.cr).desc("newline"),e.end=i(e.newline,e.eof),e.of=function A(E){return d(E)},e.regex=function M(E){return u(E)}}(Ye||(Ye={})),function(e){let t;var _;(_=t||(t={})).str=function w(D){return{kind:"string",value:D}},_.symb=function A(D){return{kind:"symbol",value:D}},_.list=function M(D,T){return{kind:"list",bracket:D,nodes:T}},_.comment=function E(D){return{kind:"comment",value:D}};const n=Ye.regexp(/[\n\r\s]*/),r=Ye.lazy(()=>Ye.alt(i,d,o,s).trim(n)),i=Ye.takeWhile(_=>"`"!==_).trim("`").map(t.str),o=Ye.regexp(/[^()\[\]{};`,\n\r\s]+/).map(t.symb),s=Ye.regexp(/\s*;+([^\n\r]*)\n/,1).map(t.comment),a=r.many(),l=a.wrap("(",")").map(_=>t.list("(",_)),c=a.wrap("[","]").map(_=>t.list("[",_)),u=a.wrap("{","}").map(_=>t.list("{",_)),d=Ye.alt(l,c,u),f=r.many();function m(_){switch(_.kind){case"string":return _.value;case"symbol":{const w=_.value;if(w.length>1)switch(w.charAt(0)){case".":return pe.atomName(w.substr(1));case"_":return pe.struct.type.elementSymbol([w.substr(1)])}return"true"===w||"false"!==w&&(function v(_){return/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/.test(_)&&!isNaN(+_)}(w)?+w:cl.Symbol(w))}case"list":switch(_.bracket){case"[":return pe.core.type.list(y(_.nodes).map(m));case"{":return pe.core.type.set(y(_.nodes).map(m));case"(":{if("comment"===_.nodes[0].kind)throw new Error("Invalid expression");const w=m(_.nodes[0]);return cl.Apply(w,function h(_){if(_.length<=1)return;if(!function g(_){for(let w=1,A=_.length;w<A;w++){const M=_[w];if("symbol"===M.kind&&M.value.length>1&&":"===M.value.charAt(0))return!0}return!1}(_)){const E=[];for(let D=1,T=_.length;D<T;D++){const F=_[D];"comment"!==F.kind&&(E[E.length]=m(F))}return E}const w={};let A=!0,M=0;for(let E=1,D=_.length;E<D;E++){const T=_[E];if("comment"!==T.kind)if("symbol"===T.kind&&T.value.length>1&&":"===T.value.charAt(0)){const F=T.value.substr(1);for(++E;E<D&&"comment"===_[E].kind;)E++;if(E>=D)throw new Error(`There must be a value foolowed a named arg ':${F}'.`);if("comment"===_[E].kind)throw new Error("Invalid expression");w[F]=m(_[E]),isNaN(+F)&&(A=!1)}else w[M++]=m(T)}if(A){const E=Object.keys(w).map(T=>+T).sort((T,F)=>T-F);let D=!0;for(let T=0,F=E.length;T<F;T++)if(E[T]!==T){D=!1;break}if(D){const T=[];for(let F=0,R=E.length;F<R;F++)T[F]=w[F];return T}}return w}(_.nodes))}default:Hi()}default:Hi()}}function y(_){let w=!1;for(let A=0,M=_.length;A<M;A++)if("comment"===_[A].kind){w=!0;break}return w?_.filter(A=>"comment"!==A.kind):_}e.parse=function x(_){const w=function p(_){return f.tryParse(_)}(_),A=[];for(const M of w)"comment"!==M.kind&&(A[A.length]=m(M));return A}}(mH||(mH={}));const lo=pe;function su(e,t,n){const r=Ye.lazy(()=>Ye.seq(e,r).map(i=>n(...i)).or(t));return r}function FN(e,t,n){return Ye.seqMap(t,e.many(),(r,i)=>i.reduce((o,s)=>n(s,o),r))}function $u(e,t,n){return Ye.seqMap(t,Ye.seq(e,t).many(),(r,i)=>i.reduce((o,s)=>{const[a,l]=s;return n(a,o,l)},r))}function zD(e,t){return e.reduce((r,i)=>{const o=i.isUnsupported?q1(`operator '${i.name}' not supported`):i.map;return i.type(i.rule,r,o)},t)}function Fy(e,t=0){return Ye.optWhitespace.then(Ye.regexp(e,t).skip(Ye.optWhitespace))}function Pf(e,t=0){return Ye.regexp(e,t).skip(Ye.optWhitespace)}function ON(e,t=0){return Ye.optWhitespace.then(Ye.regexp(e,t))}function gH(e,t){const n=t?`${e}|${w3(t)}`:e;return Fy(RegExp(`(${n})\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF`,"i"),2).map(parseFloat)}function q1(e){return function(){throw new Error(e)}}function yH(e){return 1===e.length?e[0]:e.length>1?lo.core.logic.and(e):void 0}function bH(e,t){if(!t||void 0===t.op||void 0===t.val)return t&&void 0!==t.flags?lo.core.flags.hasAny([e,t.flags]):t&&void 0!==t.min&&void 0!==t.max?lo.core.rel.inRange([e,t.min,t.max]):Array.isArray(t)?t.length>1?lo.core.set.has([lo.core.type.set(t),e]):lo.core.rel.eq([e,t[0]]):lo.core.rel.eq([e,t]);{const n=[e,t.val];switch(t.op){case"=":return lo.core.rel.eq(n);case"!=":return lo.core.rel.neq(n);case">":return lo.core.rel.gr(n);case"<":return lo.core.rel.lt(n);case">=":return lo.core.rel.gre(n);case"<=":return lo.core.rel.lte(n);default:throw new Error(`operator '${t.op}' not supported`)}}}function kf(e){return lo.struct.generator.queryInSelection({0:e,query:lo.struct.generator.all(),"in-complement":!0})}function _g(e,t){return e.length<t.length?1:-1}function vH(e,t){const n=(t?[e].concat(t):[e]).sort(_g).map(w3).join("|");return RegExp(`${n}`,"i")}function Dfe(e){const t=[];return Object.keys(e).sort(_g).forEach(n=>{const r=e[n],i=q1(`property '${n}' not supported`),o=Ye.regexp(r.regex).map(l=>(r.isUnsupported&&i(),bH(r.property,r.map(l)))),s=Ye.regexp(vH(n,r.abbr)).trim(Ye.optWhitespace),a=l=>lo.struct.generator.atomGroups({[r.level]:l});t.push(r.isNumeric?s.then(Ye.seq(Ye.regexp(/>=|<=|=|!=|>|</).trim(Ye.optWhitespace),Ye.regexp(r.regex).map(r.map))).map(l=>(r.isUnsupported&&i(),bH(r.property,{op:l[0],val:l[1]}))).map(a):s.then(o).map(a))}),t}function xH(e){const t=[];return Object.keys(e).sort(_g).forEach(n=>{const r=e[n],i=r.map?r.map:q1(`keyword '${n}' not supported`),o=Ye.regexp(vH(n,r.abbr)).map(i);t.push(o)}),t}function _H(e,t){const n=[];return Object.keys(e).sort(_g).forEach(r=>{const i=e[r],o=q1(`property '${r}' not supported`),s=Ye.regexp(vH(r,i.abbr)).lookahead(t).map(()=>(i.isUnsupported&&o(),i.property));n.push(s)}),n}function SH(e,t,n,r){const i=[];for(const o in e)i.push(o),e[o].abbr&&i.push(...e[o].abbr);for(const o in t)i.push(o),t[o].abbr&&i.push(...t[o].abbr);return n.forEach(o=>{i.push(o.name),o.abbr&&i.push(...o.abbr)}),i}function Sg(e){return lo.core.type.set(e.map(lo.atomName))}function Cg(e){return lo.struct.generator.queryInSelection({0:e,query:lo.struct.generator.all()})}function VD(e,t,n){switch(e.head.name){case"structure-query.atom-property.macromolecular.label_atom_id":return lo.atomName(t);case"structure-query.atom-property.core.element-symbol":return lo.es(t);case"structure-query.atom-property.macromolecular.secondary-structure-flags":return n&&(t=[n[t.toUpperCase()]||"none"]),lo.struct.type.secondaryStructureFlags([t]);default:return t}}const KQe=["entityKey","label_entity_id","entityType"],ZQe=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"],QQe=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"];function JQe(e){if(e.head.name.startsWith("structure-query.atom-property.macromolecular.")){const t=e.head.name.substr(45);if(KQe.includes(t))return"entity-test";if(ZQe.includes(t))return"chain-test";if(QQe.includes(t))return"residue-test"}return"atom-test"}const eJe=["structure-query.atom-property.macromolecular.secondary-structure-flags"];function ri(e){return lo.struct.generator.atomGroups({"residue-test":lo.core.set.has([lo.core.type.set(e),lo.ammp("label_comp_id")])})}const da=pe,Fp=/[-+]?[0-9]*\.?[0-9]+/,HD=/[0-9]+/;function Dn(e){return e}const nJe={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function kfe(e){if(e.head){if(e.head.name&&"core.type.regex"===e.head.name&&(e=e.args[0].replace(/^\^|\$$/g,"")),e=nJe[e.toString().toLowerCase()]||"none",-1!==["dna","rna","carbohydrate"].indexOf(e))throw new Error("values 'dna', 'rna', 'carbohydrate' not yet supported for 'structure' property");return da.struct.type.secondaryStructureFlags([e])}}const Mfe={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:Dn,level:"atom-test",property:da.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:!0,regex:/[a-zA-Z0-9]/,map:Dn,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:!0,regex:HD,map:e=>parseInt(e),level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:!0,regex:HD,map:e=>parseInt(e),level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:e=>da.atomName(e),level:"atom-test",property:da.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:!0,regex:HD,map:e=>parseInt(e),level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:e=>da.atomName(e),level:"atom-test",property:da.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:!0,regex:HD,map:e=>parseInt(e),level:"atom-test",property:da.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:!0,regex:HD,map:e=>parseInt(e),level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:Dn,level:"chain-test",property:da.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:e=>da.es(e),level:"atom-test",property:da.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:e=>parseInt(e),level:"atom-test",property:da.acp("atomicNumber")},eta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},theta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:Dn,level:"residue-test",property:da.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:Dn,level:"residue-test",property:da.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:Dn,level:"atom-test",property:da.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:!0,regex:Fp,map:e=>parseFloat(e),level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:e=>parseInt(e),level:"residue-test",property:da.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"',"structure=3"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:Dn,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"',"substructure =9"],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:Dn,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:Fp,map:e=>parseFloat(e),level:"atom-test",property:da.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:!0,regex:/[0-9\s{}-]+/,map:Dn,level:"atom-test"}},Rfe=pe,Nfe=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:su,rule:Ye.alt(Ye.regex(/NOT/i).skip(Ye.whitespace),Ye.string("!").skip(Ye.optWhitespace)),map:(e,t)=>kf(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:$u,rule:Fy(/AND|&/i),map:(e,t,n)=>Rfe.struct.modifier.intersectBy({0:t,by:n})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:$u,rule:Fy(/OR|\||,/i),map:(e,t,n)=>Rfe.struct.combinator.merge([t,n])}],qe=pe,qo={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"],nucleic:["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]},Ffe_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],Ffe_protein=["C","N","CA"];function GD(){return qe.struct.combinator.merge([qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.set(...qo.nucleic),qe.ammp("label_comp_id")])}),qe.struct.filter.pick({0:qe.struct.generator.atomGroups({"group-by":qe.ammp("residueKey")}),test:qe.core.logic.and([qe.core.rel.eq([qe.struct.atomSet.atomCount(),1]),qe.core.rel.eq([qe.ammp("label_atom_id"),qe.atomName("P")])])}),qe.struct.filter.pick({0:qe.struct.generator.atomGroups({"group-by":qe.ammp("residueKey")}),test:qe.core.logic.or([qe.core.set.isSubset([Sg(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),qe.ammpSet("label_atom_id")]),qe.core.set.isSubset([Sg(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),qe.ammpSet("label_atom_id")])])})])}const Ofe={all:{"@desc":"all atoms; same as *",abbr:["*"],map:()=>qe.struct.generator.all()},bonded:{"@desc":"covalently bonded",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.rel.gr([qe.struct.atomProperty.core.bondCount({flags:qe.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.rel.gr([qe.struct.atomProperty.core.bondCount({flags:qe.struct.type.bondFlags()}),0])})},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:()=>qe.struct.generator.empty()},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(qe.es)),qe.acp("elementSymbol")])})},metal:{"@desc":"!nonmetal",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.logic.not([qe.core.set.has([qe.set(...["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(qe.es)),qe.acp("elementSymbol")])])})},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.set(...["Li","Na","K","Rb","Cs","Fr"].map(qe.es)),qe.acp("elementSymbol")])})},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.set(...["Be","Mg","Ca","Sr","Ba","Ra"].map(qe.es)),qe.acp("elementSymbol")])})},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.set(...["He","Ne","Ar","Kr","Xe","Rn"].map(qe.es)),qe.acp("elementSymbol")])})},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.set(...["B","Si","Ge","As","Sb","Te"].map(qe.es)),qe.acp("elementSymbol")])})},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.logic.or([qe.core.rel.inRange([qe.acp("atomicNumber"),21,30]),qe.core.rel.inRange([qe.acp("atomicNumber"),39,48]),qe.core.rel.inRange([qe.acp("atomicNumber"),72,80]),qe.core.rel.inRange([qe.acp("atomicNumber"),104,112]),qe.core.set.has([qe.set(57,89),qe.acp("atomicNumber")])])})},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.rel.inRange([qe.acp("atomicNumber"),57,71])})},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.rel.inRange([qe.acp("atomicNumber"),89,103])})},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.rel.gr([qe.struct.atomProperty.core.bondCount({flags:qe.struct.type.bondFlags(["aromatic"])}),0])})},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":'any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, \', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.',map:()=>GD()},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:()=>qe.struct.modifier.intersectBy({0:GD(),by:qe.struct.combinator.merge([qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.set("A","G","I","DA","DG","DI","+A","+G","+I"),qe.ammp("label_comp_id")])}),qe.struct.filter.pick({0:qe.struct.generator.atomGroups({"group-by":qe.ammp("residueKey")}),test:qe.core.set.isSubset([Sg(["N7","C8","N9"]),qe.ammpSet("label_atom_id")])})])})},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:()=>qe.struct.modifier.intersectBy({0:GD(),by:qe.struct.combinator.merge([qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.set("C","T","U","DC","DT","DU","+C","+T","+U"),qe.ammp("label_comp_id")])}),qe.struct.filter.pick({0:qe.struct.generator.atomGroups({"group-by":qe.ammp("residueKey")}),test:qe.core.logic.or([qe.core.set.has([qe.ammpSet("label_atom_id"),qe.atomName("O2*")]),qe.core.set.has([qe.ammpSet("label_atom_id"),qe.atomName("O2'")])])})])})},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:()=>qe.struct.modifier.intersectBy({0:GD(),by:qe.struct.combinator.merge([qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.set("DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"),qe.ammp("label_comp_id")])}),qe.struct.filter.pick({0:qe.struct.generator.atomGroups({"group-by":qe.ammp("residueKey")}),test:qe.core.logic.not([qe.core.logic.or([qe.core.set.has([qe.ammpSet("label_atom_id"),qe.atomName("O2*")]),qe.core.set.has([qe.ammpSet("label_atom_id"),qe.atomName("O2'")])])])})])})},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:()=>qe.struct.modifier.intersectBy({0:GD(),by:qe.struct.combinator.merge([qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.set("G","C","A","U","I","+U","+I"),qe.ammp("label_comp_id")])}),qe.struct.filter.pick({0:qe.struct.generator.atomGroups({"group-by":qe.ammp("residueKey")}),test:qe.core.logic.or([qe.core.set.has([qe.ammpSet("label_atom_id"),qe.atomName("O2*")]),qe.core.set.has([qe.ammpSet("label_atom_id"),qe.atomName("O2'")])])})])})},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).',map:()=>function rJe(){return qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.set(...qo.amino),qe.ammp("label_comp_id")])})}()},acidic:{"@desc":"ASP GLU",map:()=>ri(qo.acidic)},acyclic:{"@desc":"amino and not cyclic",map:()=>qe.struct.modifier.intersectBy({0:ri(qo.amino),by:kf(ri(qo.cyclic))})},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:()=>ri(qo.aliphatic)},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:()=>ri(qo.amino)},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:()=>ri(qo.aromatic)},basic:{"@desc":"ARG HIS LYS",map:()=>ri(qo.basic)},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:()=>ri(qo.buried)},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:()=>ri(qo.acidic.concat(qo.basic))},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:()=>ri(qo.cyclic)},helix:{"@desc":"secondary structure-related.",map:()=>qe.struct.generator.atomGroups({"residue-test":qe.core.flags.hasAny([qe.struct.type.secondaryStructureFlags(["helix"]),qe.ammp("secondaryStructureFlags")])})},helixalpha:{"@desc":"secondary structure-related.",map:()=>qe.struct.generator.atomGroups({"residue-test":qe.core.flags.hasAny([qe.struct.type.secondaryStructureFlags(["alpha"]),qe.ammp("secondaryStructureFlags")])})},helix310:{"@desc":"secondary structure-related.",map:()=>qe.struct.generator.atomGroups({"residue-test":qe.core.flags.hasAny([qe.struct.type.secondaryStructureFlags(["3-10"]),qe.ammp("secondaryStructureFlags")])})},helixpi:{"@desc":"secondary structure-related.",map:()=>qe.struct.generator.atomGroups({"residue-test":qe.core.flags.hasAny([qe.struct.type.secondaryStructureFlags(["pi"]),qe.ammp("secondaryStructureFlags")])})},hetero:{"@desc":"PDB atoms designated as HETATM",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.ammp("isHet")})},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:()=>ri(qo.hydrophobic)},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:()=>ri(qo.large)},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:()=>ri(qo.medium)},negative:{"@desc":"same as acidic -- ASP GLU",map:()=>ri(qo.acidic)},neutral:{"@desc":"amino and not (acidic or basic)",map:()=>qe.struct.modifier.intersectBy({0:ri(qo.amino),by:kf(ri(qo.acidic.concat(qo.basic)))})},polar:{"@desc":"amino and not hydrophobic",map:()=>qe.struct.modifier.intersectBy({0:ri(qo.amino),by:kf(ri(qo.hydrophobic))})},positive:{"@desc":"same as basic -- ARG HIS LYS",map:()=>ri(qo.basic)},sheet:{"@desc":"secondary structure-related",map:()=>qe.struct.generator.atomGroups({"residue-test":qe.core.flags.hasAny([qe.struct.type.secondaryStructureFlags(["sheet"]),qe.ammp("secondaryStructureFlags")])})},small:{"@desc":"ALA GLY SER",map:()=>ri(qo.small)},surface:{"@desc":"amino and not buried",map:()=>qe.struct.modifier.intersectBy({0:ri(qo.amino),by:kf(ri(qo.buried))})},turn:{"@desc":"secondary structure-related",map:()=>qe.struct.generator.atomGroups({"residue-test":qe.core.flags.hasAny([qe.struct.type.secondaryStructureFlags(["turn"]),qe.ammp("secondaryStructureFlags")])})},alpha:{"@desc":"(*.CA)",map:()=>qe.struct.generator.atomGroups({"atom-test":qe.core.rel.eq([qe.atomName("CA"),qe.ammp("label_atom_id")])})},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"],map:()=>function iJe(){return qe.struct.combinator.merge([qe.struct.modifier.intersectBy({0:qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.core.type.set(qo.amino),qe.ammp("label_comp_id")])}),by:qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.core.type.set(Ffe_protein),qe.ammp("label_atom_id")])})}),qe.struct.modifier.intersectBy({0:qe.struct.generator.atomGroups({"residue-test":qe.core.set.has([qe.core.type.set(qo.nucleic),qe.ammp("label_comp_id")])}),by:qe.struct.generator.atomGroups({"atom-test":qe.core.set.has([qe.core.type.set(Ffe_nucleic),qe.ammp("label_atom_id")])})})])}()},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}},gr=pe,oJe=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:$u,rule:Ye.regexp(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:(e,t,n)=>{let r;if("structure"===t?r=gr.core.flags.hasAny([gr.ammp("secondaryStructureFlags"),kfe(n)]):"structure"===n?r=gr.core.flags.hasAny([gr.ammp("secondaryStructureFlags"),kfe(t)]):void 0!==t.head?"core.type.regex"===t.head.name&&(r=gr.core.str.match([t,gr.core.type.str([n])])):void 0!==n.head?"core.type.regex"===n.head.name&&(r=gr.core.str.match([n,gr.core.type.str([t])])):"LIKE"===e.toUpperCase()&&(r=gr.core.str.match(t.head?[gr.core.type.regex([`^${n}$`,"i"]),gr.core.type.str([t])]:[gr.core.type.regex([`^${t}$`,"i"]),gr.core.type.str([n])])),!r)switch(t.head&&(n=VD(t,n)),n.head&&(t=VD(n,t)),e){case"=":r=gr.core.rel.eq([t,n]);break;case"!=":r=gr.core.rel.neq([t,n]);break;case">":r=gr.core.rel.gr([t,n]);break;case"<":r=gr.core.rel.lt([t,n]);break;case">=":r=gr.core.rel.gre([t,n]);break;case"<=":r=gr.core.rel.lte([t,n]);break;default:throw new Error(`value operator '${e}' not supported`)}return gr.struct.generator.atomGroups({"atom-test":r})}}];function sJe(e){const[t,n,r,i,o,s,a]=e[1],l={};o&&(l["chain-test"]=gr.core.rel.eq([gr.ammp("auth_asym_id"),o]));const c=[];t&&c.push(gr.core.rel.eq([gr.ammp("label_comp_id"),t])),n&&c.push(gr.core.logic.and([gr.core.rel.gre([gr.ammp("auth_seq_id"),n[0]]),gr.core.rel.lte([gr.ammp("auth_seq_id"),n[1]])])),r&&c.push(gr.core.rel.eq([gr.ammp("auth_seq_id"),r])),i&&c.push(gr.core.rel.eq([gr.ammp("pdbx_PDB_ins_code"),i])),c.length&&(l["residue-test"]=yH(c));const u=[];return s&&u.push(gr.core.rel.eq([gr.ammp("auth_atom_id"),s])),a&&u.push(gr.core.rel.eq([gr.ammp("label_alt_id"),a])),u.length&&(l["atom-test"]=yH(u)),gr.struct.generator.atomGroups(l)}const aJe=Ye.createLanguage({Integer:()=>Ye.regexp(/-?[0-9]+/).map(Number).desc("integer"),Parens:function(e){return Ye.alt(e.Parens,e.Operator,e.Expression).wrap(Ye.regexp(/\(\s*/),Ye.regexp(/\s*\)/))},Expression:function(e){return Ye.alt(e.Keywords,e.AtomExpression.map(sJe),e.Within.map(t=>gr.struct.modifier.includeSurroundings({0:t[1],radius:t[0]})),e.ValueQuery,e.Element.map(t=>gr.struct.generator.atomGroups({"atom-test":gr.core.rel.eq([gr.acp("elementSymbol"),gr.struct.type.elementSymbol(t)])})),e.Resname.map(t=>gr.struct.generator.atomGroups({"residue-test":gr.core.rel.eq([gr.ammp("label_comp_id"),t])})))},Operator:function(e){return zD(Nfe,Ye.alt(e.Parens,e.Expression))},AtomExpression:function(e){return Ye.seq(Ye.lookahead(e.AtomPrefix),Ye.seq(e.BracketedResname.or(Ye.of(null)),e.ResnoRange.or(Ye.of(null)),e.Resno.or(Ye.of(null)),e.Inscode.or(Ye.of(null)),e.Chainname.or(Ye.of(null)),e.Atomname.or(Ye.of(null)),e.Altloc.or(Ye.of(null)),e.Model.or(Ye.of(null)))).desc("expression")},AtomPrefix:()=>Ye.regexp(/[\[0-9:^%/.-]/).desc("atom-prefix"),Chainname:()=>Ye.regexp(/:([A-Za-z]{1,3})/,1).desc("chainname"),Model:()=>Ye.regexp(/\/([0-9]+)/,1).map(Number).desc("model"),Element:()=>Ye.regexp(/_([A-Za-z]{1,3})/,1).desc("element"),Atomname:()=>Ye.regexp(/\.([a-zA-Z0-9]{1,4})/,1).map(gr.atomName).desc("atomname"),Resname:()=>Ye.regexp(/[a-zA-Z0-9]{1,4}/).desc("resname"),Resno:e=>e.Integer.desc("resno"),Altloc:()=>Ye.regexp(/%([a-zA-Z0-9])/,1).desc("altloc"),Inscode:()=>Ye.regexp(/\^([a-zA-Z0-9])/,1).desc("inscode"),BracketedResname:()=>Ye.regexp(/\[([a-zA-Z0-9]{1,4})\]/,1).desc("bracketed-resname"),ResnoRange:e=>Ye.seq(e.Integer.skip(Ye.seq(Ye.optWhitespace,Ye.string("-"),Ye.optWhitespace)),e.Integer).desc("resno-range"),Within:e=>Ye.regexp(/within/i).skip(Ye.regexp(/\s*\(\s*/)).then(Ye.seq(e.Integer.skip(Ye.regexp(/\s*,\s*/)),e.Query)).skip(Ye.regexp(/\)/)),Keywords:()=>Ye.alt(...xH(Ofe)).desc("keyword"),Query:function(e){return Ye.alt(e.Operator,e.Parens,e.Expression).trim(Ye.optWhitespace)},Number:function(){return Ye.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){const e=SH(Mfe,Ofe,Nfe).sort(_g).map(w3).join("|");return Ye.alt(Ye.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),Ye.regexp(/'((?:[^"\\]|\\.)*)'/,1),Ye.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>gr.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return Ye.alt(e.Number,e.String)},ValueParens:function(e){return Ye.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(Ye.string("("),Ye.string(")"))},ValuePropertyNames:function(){return Ye.alt(..._H(Mfe,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(e){return zD(oJe,Ye.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return Ye.alt(e.Value,e.ValuePropertyNames)},ValueQuery:function(e){return Ye.alt(e.ValueOperator.map(t=>{if(t.head){if(t.head.name.startsWith("structure-query.generator"))return t}else if("string"==typeof t&&t.length<=4)return gr.struct.generator.atomGroups({"residue-test":gr.core.rel.eq([gr.ammp("label_comp_id"),t])});throw new Error(`values must be part of an comparison, value '${t}'`)}))}}),cc=pe,BN=/[-+]?[0-9]*\.?[0-9]+/;function rA(e){return e.split("+").map(t=>t.replace(/^["']|["']$/g,""))}function CH(e){if(e.includes("-")&&e.includes("+")){const t=e.split("+").map(r=>r.replace(/^["']|["']$/g,"")),n=[];return t.forEach(r=>{if(r.includes("-")&&!r.startsWith("-")){const[i,o]=r.split("-").map(s=>parseInt(s));for(let s=i;s<=o;s++)n.push(s)}else if(r.includes("-")&&r.startsWith("-")&&r.match(/[0-9]+-[-0-9]+/)){const i=-parseInt(r.split("-")[1]);let o;o=r.includes("--")?-parseInt(r.split("-")[3]):parseInt(r.split("-")[2]);for(let s=i;s<=o;s++)n.push(s)}else r.includes("-")&&r.startsWith("-")&&r.match(/[0-9]+-[-0-9]+/),n.push(parseInt(r))}),n}if(e.includes("-")&&!e.includes("+")){const t=[];if(e.startsWith("-"))if(e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/)){const n=-parseInt(e.split("-")[1]);let r;r=e.includes("--")?-parseInt(e.split("-")[3]):parseInt(e.split("-")[2]);for(let i=n;i<=r;i++)t.push(i)}else e.startsWith("-")&&e.match(/[0-9]+-[-0-9]+/),t.push(parseInt(e));else{const[n,r]=e.split("-").map(i=>parseInt(i));for(let i=n;i<=r;i++)t.push(i)}return t}return!e.includes("-")&&e.includes("+")?rA(e).map(t=>parseInt(t)):[parseInt(e)]}const dJe={H:"helix",S:"beta",L:"none"},LN={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:function uJe(e){return e.split("+").map(cc.struct.type.elementSymbol)},level:"atom-test",property:cc.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:function cJe(e){return e.split("+").map(cc.atomName)},level:"atom-test",property:cc.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:rA,level:"residue-test",property:cc.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:CH,level:"residue-test",property:cc.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:rA,level:"atom-test",property:cc.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:rA,level:"chain-test",property:cc.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:rA,level:"chain-test",property:cc.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:!0,abbr:["f."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:!0,abbr:["nt."],regex:/[0-9]+/,map:e=>parseInt(e),level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:!0,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:rA,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],regex:/[0-9+-]+/,map:CH,level:"atom-test",property:cc.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],regex:/[0-9+-]+/,map:CH,level:"atom-test",property:cc.ammp("id")},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:function fJe(e){return{flags:cc.struct.type.secondaryStructureFlags(e.toUpperCase().split("+").map(t=>dJe[t]||"none"))}},level:"residue-test",property:cc.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:!0,abbr:[],regex:BN,map:e=>parseFloat(e),level:"atom-test",property:cc.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:!0,abbr:[],regex:BN,map:e=>parseFloat(e),level:"atom-test",property:cc.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:!0,abbr:["fc."],regex:BN,map:e=>parseFloat(e),level:"atom-test",property:cc.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:!0,isNumeric:!0,abbr:["pc."],regex:BN,map:e=>parseFloat(e),level:"atom-test"},elem:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["elem N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>cc.es(e),level:"atom-test",property:cc.acp("elementSymbol")}},nr=pe,Bfe=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:su,rule:Ye.alt(Ye.regexp(/NOT/i).skip(Ye.whitespace),Ye.string("!").skip(Ye.optWhitespace)),map:(e,t)=>kf(t)},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:$u,rule:Fy(/AND|&/i),map:(e,t,n)=>nr.struct.modifier.intersectBy({0:t,by:n})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:$u,rule:Fy(/OR|\|/i),map:(e,t,n)=>nr.struct.combinator.merge([t,n])},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:$u,rule:Fy(/IN/i),map:(e,t,n)=>nr.struct.filter.withSameAtomProperties({0:t,source:n,property:nr.core.type.compositeKey([nr.ammp("label_atom_id"),nr.ammp("label_seq_id"),nr.ammp("label_comp_id"),nr.ammp("auth_asym_id"),nr.ammp("label_asym_id")])})},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:$u,rule:Fy(/LIKE|l\./i),map:(e,t,n)=>nr.struct.filter.withSameAtomProperties({0:t,source:n,property:nr.core.type.compositeKey([nr.ammp("label_atom_id"),nr.ammp("label_seq_id")])})},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:FN,rule:ON(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(e=>parseFloat(e)),map:(e,t)=>nr.struct.filter.within({0:nr.struct.generator.all(),target:t,"atom-radius":nr.acp("vdw"),"max-radius":e,invert:!0})},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:FN,rule:ON(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>nr.struct.modifier.exceptBy({0:nr.struct.filter.within({0:nr.struct.generator.all(),target:t,"max-radius":e}),by:t})},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:FN,rule:ON(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(e=>parseFloat(e)),map:(e,t)=>nr.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:$u,rule:gH("WITHIN","w."),map:(e,t,n)=>nr.struct.filter.within({0:t,target:n,"max-radius":e})},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:$u,rule:gH("NEAR_TO","nto."),map:(e,t,n)=>nr.struct.modifier.exceptBy({0:nr.struct.filter.within({0:t,target:n,"max-radius":e}),by:n})},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:$u,rule:gH("BEYOND","be."),map:(e,t,n)=>nr.struct.modifier.exceptBy({0:nr.struct.filter.within({0:t,target:n,"max-radius":e,invert:!0}),by:n})},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:su,rule:Pf(/BYRESIDUE|byresi|byres|br\./i),map:(e,t)=>Cg(nr.struct.modifier.expandProperty({0:nr.struct.modifier.union({0:t}),property:nr.ammp("residueKey")}))},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:su,rule:Pf(/BYCALPHA|bca\./i),map:(e,t)=>nr.struct.generator.queryInSelection({0:nr.struct.modifier.expandProperty({0:nr.struct.modifier.union({0:t}),property:nr.ammp("residueKey")}),query:nr.struct.generator.atomGroups({"atom-test":nr.core.rel.eq([nr.atomName("CA"),nr.ammp("label_atom_id")])})})},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",isUnsupported:!0,abbr:["bymol","bm."],type:su,rule:Pf(/BYMOLECULE|bymol|bm\./i),map:(e,t)=>Cg(nr.struct.modifier.expandProperty({0:nr.struct.modifier.union({0:t}),property:nr.atp("connectedComponentKey")}))},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:!0,type:su,rule:Pf(/BYFRAGMENT|byfrag|bf\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:su,rule:Pf(/BYSEGMENT|bysegi|byseg|bs\./i),map:(e,t)=>Cg(nr.struct.modifier.expandProperty({0:nr.struct.modifier.union({0:t}),property:nr.ammp("chainKey")}))},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:!0,type:su,rule:Pf(/BYOBJECT|byobj|bo\./i),map:(e,t)=>[e,t]},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:!0,type:su,rule:Pf(/BYCELL/i),map:(e,t)=>[e,t]},{"@desc":"All rings of size \u2264 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:su,rule:Pf(/BYRING/i),map:(e,t)=>Cg(nr.struct.modifier.intersectBy({0:nr.struct.filter.pick({0:nr.struct.generator.rings(),test:nr.core.logic.and([nr.core.rel.lte([nr.struct.atomSet.atomCount(),7]),nr.core.rel.gr([nr.struct.atomSet.countQuery([t]),1])])}),by:t}))},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOR resn CYS"],name:"neighbor",type:su,abbr:["nbr."],rule:Pf(/NEIGHBOR|nbr\./i),map:(e,t)=>nr.struct.modifier.exceptBy({0:Cg(nr.struct.modifier.includeConnected({0:nr.struct.modifier.union({0:t}),"bond-test":!0})),by:t})},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO name CA"],name:"bound_to",abbr:["bto."],type:su,rule:Pf(/BOUND_TO|bto\./i),map:(e,t)=>Cg(nr.struct.modifier.includeConnected({0:nr.struct.modifier.union({0:t})}))},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:FN,rule:ON(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(e=>parseInt(e)),map:(e,t)=>Cg(nr.struct.modifier.includeConnected({0:nr.struct.modifier.union({0:t}),"bond-test":!0,"layer-count":e}))}],Zt=pe,au={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]},Lfe_nucleic=["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*","C2'","C1'","O4'","O2'"],Lfe_protein=["C","N","CA","O"];function jfe(){return Zt.struct.combinator.merge([Zt.struct.modifier.intersectBy({0:Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.protein),Zt.ammp("label_comp_id")])}),by:Zt.struct.generator.atomGroups({"atom-test":Zt.core.set.has([Zt.core.type.set(Lfe_protein),Zt.ammp("label_atom_id")])})}),Zt.struct.modifier.intersectBy({0:Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.nucleic),Zt.ammp("label_comp_id")])}),by:Zt.struct.generator.atomGroups({"atom-test":Zt.core.set.has([Zt.core.type.set(Lfe_nucleic),Zt.ammp("label_atom_id")])})})])}const Ufe={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:()=>Zt.struct.generator.all()},none:{"@desc":"No atoms (empty selection)",map:()=>Zt.struct.generator.empty()},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:()=>Zt.struct.generator.atomGroups({"atom-test":Zt.core.rel.eq([Zt.acp("elementSymbol"),Zt.es("H")])})},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:()=>Zt.struct.generator.atomGroups({"atom-test":Zt.core.rel.eq([Zt.ammp("isHet"),!0])})},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:()=>Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.nucleic.concat(au.protein)),Zt.ammp("label_comp_id")])})},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."],map:()=>Zt.struct.modifier.exceptBy({0:Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.nucleic.concat(au.protein)),Zt.ammp("label_comp_id")])}),by:jfe()})},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:()=>Zt.struct.generator.atomGroups({"atom-test":Zt.core.rel.gr([Zt.struct.atomProperty.core.bondCount({flags:Zt.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:()=>Cg(Zt.struct.modifier.expandProperty({0:Zt.struct.modifier.union([Zt.struct.generator.queryInSelection({0:Zt.struct.generator.atomGroups({"residue-test":Zt.core.logic.not([Zt.core.set.has([Zt.core.type.set(au.nucleic.concat(au.protein)),Zt.ammp("label_comp_id")])])}),query:Zt.struct.generator.atomGroups({"atom-test":Zt.core.rel.eq([Zt.es("C"),Zt.acp("elementSymbol")])})})]),property:Zt.ammp("residueKey")}))},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:()=>Cg(Zt.struct.modifier.expandProperty({0:Zt.struct.modifier.union([Zt.struct.filter.pick({0:Zt.struct.generator.atomGroups({"residue-test":Zt.core.logic.not([Zt.core.set.has([Zt.core.type.set(au.nucleic.concat(au.protein).concat(au.solvent)),Zt.ammp("label_comp_id")])]),"group-by":Zt.ammp("residueKey")}),test:Zt.core.logic.not([Zt.core.set.has([Zt.struct.atomSet.propertySet([Zt.acp("elementSymbol")]),Zt.es("C")])])})]),property:Zt.ammp("residueKey")}))},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:()=>Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.solvent),Zt.ammp("label_comp_id")])})},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:()=>Zt.struct.combinator.merge([Zt.struct.generator.atomGroups({"atom-test":Zt.core.rel.eq([Zt.atomName("CA"),Zt.ammp("label_atom_id")]),"residue-test":Zt.core.set.has([Zt.core.type.set(au.protein),Zt.ammp("label_comp_id")])}),Zt.struct.generator.atomGroups({"atom-test":Zt.core.set.has([Sg(["C4*","C4'"]),Zt.ammp("label_atom_id")]),"residue-test":Zt.core.set.has([Zt.core.type.set(au.nucleic),Zt.ammp("label_comp_id")])})])},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."],map:()=>jfe()},"polymer.protein":{"@desc":"Protein (New in PyMOL 2.1)",abbr:["polymer.protein"],map:()=>Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.protein),Zt.ammp("label_comp_id")])})},"polymer.nucleic":{"@desc":"Nucleic Acid (New in PyMOL 2.1)",abbr:["polymer.nucleic"],map:()=>Zt.struct.generator.atomGroups({"residue-test":Zt.core.set.has([Zt.core.type.set(au.nucleic),Zt.ammp("label_comp_id")])})}},pJe=pe,fa=function YQe(e){const t={};return Object.keys(e).sort(_g).forEach(n=>{const r=e[n],i=q1(`property '${n}' not supported`),o=Ye.regexp(r.regex).map(s=>(r.isUnsupported&&i(),bH(r.property,r.map(s))));r.isNumeric||(t[n]=o)}),t}(LN),wa=Ye.string("/");function jo(e){return e.or(Ye.of(null))}function hJe(e){const t={},n={};for(const r in e){const i=LN[r];if(!i)throw new Error(`property '${r}' not supported, value '${e[r]}'`);null!==e[r]&&(n[i.level]||(n[i.level]=[]),n[i.level].push(e[r]))}for(const r in n)t[r]=yH(n[r]);return pJe.struct.generator.atomGroups(t)}const mJe=Ye.createLanguage({Parens:function(e){return Ye.alt(e.Parens,e.Operator,e.Expression).wrap(Ye.string("("),Ye.string(")"))},Expression:function(e){return Ye.alt(e.Keywords,e.AtomSelectionMacro.map(hJe),e.NamedAtomProperties,e.Pepseq,e.Rep,e.Object)},AtomSelectionMacro:function(e){return Ye.alt(wa.then(Ye.alt(Ye.seq(jo(e.ObjectProperty).skip(wa),jo(fa.segi).skip(wa),jo(fa.chain).skip(wa),jo(fa.resi).skip(wa),jo(fa.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),Ye.seq(jo(e.ObjectProperty).skip(wa),jo(fa.segi).skip(wa),jo(fa.chain).skip(wa),jo(fa.resi)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3]})),Ye.seq(jo(e.ObjectProperty).skip(wa),jo(fa.segi).skip(wa),jo(fa.chain)).map(t=>({object:t[0],segi:t[1],chain:t[2]})),Ye.seq(jo(e.ObjectProperty).skip(wa),jo(fa.segi)).map(t=>({object:t[0],segi:t[1]})),Ye.seq(jo(e.ObjectProperty)).map(t=>({object:t[0]})))),Ye.alt(Ye.seq(jo(e.ObjectProperty).skip(wa),jo(fa.segi).skip(wa),jo(fa.chain).skip(wa),jo(fa.resi).skip(wa),jo(fa.name)).map(t=>({object:t[0],segi:t[1],chain:t[2],resi:t[3],name:t[4]})),Ye.seq(jo(fa.segi).skip(wa),jo(fa.chain).skip(wa),jo(fa.resi).skip(wa),jo(fa.name)).map(t=>({segi:t[0],chain:t[1],resi:t[2],name:t[3]})),Ye.seq(jo(fa.chain).skip(wa),jo(fa.resi).skip(wa),jo(fa.name)).map(t=>({chain:t[0],resi:t[1],name:t[2]})),Ye.seq(jo(fa.resi).skip(wa),jo(fa.name)).map(t=>({resi:t[0],name:t[1]}))))},NamedAtomProperties:function(){return Ye.alt(...Dfe(LN))},Keywords:()=>Ye.alt(...xH(Ufe)),ObjectProperty:()=>{const e=SH(LN,Ufe,Bfe).sort(_g).map(w3).join("|");return Ye.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i"))},Object:e=>e.ObjectProperty.notFollowedBy(wa).map(t=>{throw new Error(`property 'object' not supported, value '${t}'`)}),Pepseq:()=>Ye.regexp(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(q1("operator 'pepseq' not supported")),Rep:()=>Ye.regexp(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(q1("operator 'rep' not supported")),Operator:function(e){return zD(Bfe,Ye.alt(e.Parens,e.Expression,e.Operator))},Query:function(e){return Ye.alt(e.Operator,e.Parens,e.Expression).trim(Ye.optWhitespace)}}),Ys=pe,kd=/[-+]?[0-9]*\.?[0-9]+/,jN=/[+]?[0-9]+/,qD=/[-+]?[0-9]+/;function T_(e){return e}const zfe={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function wH(e){return Ys.struct.type.secondaryStructureFlags([zfe[e.toUpperCase()]||"none"])}const D_={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:Ys.atomName,level:"atom-test",property:Ys.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:T_,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:!0,regex:jN,map:e=>parseInt(e)-1,level:"atom-test",property:Ys.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:!0,regex:jN,map:e=>parseInt(e),level:"atom-test",property:Ys.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:!0,regex:jN,map:e=>parseInt(e),level:"atom-test",property:Ys.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:e=>Ys.es(e),level:"atom-test",property:Ys.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:T_,level:"atom-test",property:Ys.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:T_,level:"residue-test",property:Ys.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:!0,regex:qD,map:e=>parseInt(e),level:"residue-test",property:Ys.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:!0,isNumeric:!0,regex:qD,map:e=>parseInt(e),level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:!0,isNumeric:!0,regex:qD,map:e=>parseInt(e),level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:!0,isNumeric:!0,regex:qD,map:e=>parseInt(e),level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:!0,regex:/[a-zA-Z0-9]+/,map:T_,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:!0,regex:jN,map:e=>parseInt(e),level:"atom-test",property:Ys.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:T_,level:"residue-test",property:Ys.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:!0,regex:qD,map:e=>parseInt(e),level:"residue-test",property:Ys.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:T_,level:"residue-test",property:Ys.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test",property:Ys.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:!0,isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:!0,regex:/[^']*/,map:T_,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:wH,level:"atom-test",property:Ys.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:!0,isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:!0,isNumeric:!0,regex:kd,map:e=>parseFloat(e),level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:!0,isNumeric:!0,regex:kd,map:e=>parseInt(e),level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:!0,isNumeric:!0,regex:kd,map:e=>parseInt(e),level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:!0,isNumeric:!0,regex:kd,map:e=>parseInt(e),level:"atom-test"}},P_=pe,yJe=Object.keys(D_).sort(_g).filter(e=>!D_[e].isUnsupported).join("|"),Vfe=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:su,rule:Ye.regexp(/NOT/i).skip(Ye.whitespace),map:(e,t)=>kf(t)},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:su,rule:Pf(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>P_.struct.modifier.includeSurroundings({0:t,radius:e})},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:su,rule:Pf(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(e=>parseFloat(e)),map:(e,t)=>P_.struct.modifier.exceptBy({0:P_.struct.modifier.includeSurroundings({0:t,radius:e}),by:t})},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:su,rule:Pf(new RegExp(`SAME\\s+(${yJe})\\s+AS`,"i"),1).map(e=>D_[e].property),map:(e,t)=>P_.struct.filter.withSameAtomProperties({0:P_.struct.generator.all(),source:t,property:e})},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:$u,rule:Ye.alt(Fy(/AND/i),Ye.whitespace),map:(e,t,n)=>P_.struct.modifier.intersectBy({0:t,by:n})},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:$u,rule:Fy(/OR/i),map:(e,t,n)=>P_.struct.combinator.merge([t,n])}],Cr=pe;function Oy(){return Cr.struct.filter.pick({0:Cr.struct.generator.atomGroups({"group-by":Cr.ammp("residueKey")}),test:Cr.core.set.isSubset([Sg(["C","N","CA","O"]),Cr.ammpSet("label_atom_id")])})}function AH(){return Cr.struct.filter.pick({0:Cr.struct.generator.atomGroups({"group-by":Cr.ammp("residueKey")}),test:Cr.core.logic.and([Cr.core.set.isSubset([Sg(["P"]),Cr.ammpSet("label_atom_id")]),Cr.core.logic.or([Cr.core.set.isSubset([Sg(["O3'","C3'","C4'","C5'","O5'"]),Cr.ammpSet("label_atom_id")]),Cr.core.set.isSubset([Sg(["O3*","C3*","C4*","C5*","O5*"]),Cr.ammpSet("label_atom_id")])])])})}function Hfe(){return Cr.struct.combinator.merge([Cr.struct.generator.queryInSelection({0:Oy(),query:Cr.struct.generator.atomGroups({"atom-test":Cr.core.set.has([Sg(Gfe.protein),Cr.ammp("label_atom_id")])})}),Cr.struct.generator.queryInSelection({0:AH(),query:Cr.struct.generator.atomGroups({"atom-test":Cr.core.set.has([Sg(Gfe.nucleic),Cr.ammp("label_atom_id")])})})])}function wg(e){return Cr.struct.generator.atomGroups({"residue-test":Cr.core.flags.hasAll([Cr.ammp("secondaryStructureFlags"),Cr.struct.type.secondaryStructureFlags(e)])})}const Gfe={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]},Aa={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]},qfe={all:{"@desc":"everything",map:()=>Cr.struct.generator.all()},none:{"@desc":"nothing",map:()=>Cr.struct.generator.empty()},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>Oy()},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:()=>AH()},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:()=>Hfe()},sidechain:{"@desc":"non-backbone atoms and bonds",map:()=>kf(Hfe())},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:()=>ri(Aa.water)},at:{"@desc":"residues named ADA A THY T",map:()=>ri(Aa.at)},acidic:{"@desc":"residues named ASP GLU",map:()=>ri(Aa.acidic)},acyclic:{"@desc":'"protein and not cyclic"',map:()=>Cr.struct.modifier.intersectBy({0:Oy(),by:kf(ri(Aa.cyclic))})},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:()=>ri(Aa.aliphatic)},alpha:{"@desc":"atom's residue is an alpha helix",map:()=>wg(["alpha"])},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:()=>Oy()},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:()=>ri(Aa.aromatic)},basic:{"@desc":"residues named ARG HIS LYS",map:()=>ri(Aa.basic)},bonded:{"@desc":"atoms for which numbonds > 0",map:()=>Cg(Cr.struct.filter.pick({0:Cr.struct.modifier.includeConnected({0:Cr.struct.generator.all(),"bond-test":Cr.core.flags.hasAny([Cr.struct.bondProperty.flags(),Cr.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:Cr.core.rel.gr([Cr.struct.atomSet.atomCount(),1])}))},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:()=>ri(Aa.buried)},cg:{"@desc":"residues named CYT C GUA G",map:()=>ri(Aa.cg)},charged:{"@desc":'"basic or acidic"',map:()=>ri(Aa.basic.concat(Aa.acidic))},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:()=>ri(Aa.cyclic)},hetero:{"@desc":'"not (protein or nucleic)"',map:()=>kf(Cr.struct.combinator.merge([Oy(),AH()]))},hydrogen:{"@desc":'name "[0-9]?H.*"',map:()=>Cr.struct.generator.atomGroups({"atom-test":Cr.core.str.match([Cr.core.type.regex(["^[0-9]?[H].*$","i"]),Cr.core.type.str([Cr.ammp("label_atom_id")])])})},large:{"@desc":'"protein and not (small or medium)"',map:()=>Cr.struct.modifier.intersectBy({0:Oy(),by:kf(ri(Aa.small.concat(Aa.medium)))})},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:()=>ri(Aa.medium)},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:()=>ri(Aa.neutral)},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:()=>ri(Aa.hydrophobic)},polar:{"@desc":'"protein and not hydrophobic"',map:()=>Cr.struct.modifier.intersectBy({0:Oy(),by:kf(ri(Aa.hydrophobic))})},purine:{"@desc":"residues named ADE A GUA G",map:()=>ri(Aa.purine)},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:()=>ri(Aa.pyrimidine)},small:{"@desc":"residues named ALA GLY SER",map:()=>ri(Aa.small)},surface:{"@desc":'"protein and not buried"',map:()=>Cr.struct.modifier.intersectBy({0:Oy(),by:kf(ri(Aa.buried))})},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:()=>wg(["alpha"])},pi_helix:{"@desc":"atom's residue is in a pi helix",map:()=>wg(["pi"])},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:()=>wg(["3-10"])},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:()=>wg(["helix"])},extended_beta:{"@desc":"atom's residue is a beta sheet",map:()=>wg(["sheet"])},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:()=>wg(["strand"])},sheet:{"@desc":"atom's residue is a beta sheet",map:()=>wg(["beta"])},turn:{"@desc":"atom's residue is in a turn conformation",map:()=>wg(["turn"])},coil:{"@desc":"atom's residue is in a coil conformation",map:()=>Cr.struct.modifier.intersectBy({0:Oy(),by:wg(["none"])})}},Lc=pe,bJe={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:e=>Lc.core.math.pow([e,2])},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:e=>Lc.core.math.sqrt([e])},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:e=>Lc.core.math.abs([e])},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:e=>Lc.core.math.floor([e])},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:e=>Lc.core.math.ceil([e])},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:e=>Lc.core.math.sin([e])},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:e=>Lc.core.math.cos([e])},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:e=>Lc.core.math.tan([e])},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:e=>Lc.core.math.atan([e])},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:e=>Lc.core.math.asin([e])},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:e=>Lc.core.math.acos([e])},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:e=>Lc.core.math.sinh([e])},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:e=>Lc.core.math.cosh([e])},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:e=>Lc.core.math.tanh([e])},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:e=>Lc.core.math.exp([e])},log:{"@desc":"natural log of x","@examples":["log(2)"],map:e=>Lc.core.math.log([e])},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:e=>Lc.core.math.log10([e])}},Jo=pe,vJe=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:$u,rule:Ye.regexp(/\s*(\*|\/)\s*/,1),map:(e,t,n)=>{switch(e){case"*":return Jo.core.math.mult([t,n]);case"/":return Jo.core.math.div([t,n]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:$u,rule:Ye.regexp(/\s*(-|\+)\s*/,1),map:(e,t,n)=>{switch(e){case"-":return Jo.core.math.sub([t,n]);case"+":return Jo.core.math.add([t,n]);default:throw new Error(`value operator '${e}' not supported`)}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:$u,rule:Ye.alt(Ye.regexp(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),Ye.whitespace.result("=")),map:(e,t,n)=>{let r;if(void 0!==t.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===t.head.name&&(r=Jo.core.flags.hasAny([t,wH(n)])),"core.type.regex"===t.head.name&&(r=Jo.core.str.match([t,Jo.core.type.str([n])]))):void 0!==n.head?("structure-query.atom-property.macromolecular.secondary-structure-flags"===n.head.name&&(r=Jo.core.flags.hasAny([n,wH(t)])),"core.type.regex"===n.head.name&&(r=Jo.core.str.match([n,Jo.core.type.str([t])]))):"=~"===e&&(r=Jo.core.str.match(t.head?[Jo.core.type.regex([`^${n}$`,"i"]),Jo.core.type.str([t])]:[Jo.core.type.regex([`^${t}$`,"i"]),Jo.core.type.str([n])])),!r)switch(t.head&&(n=VD(t,n)),n.head&&(t=VD(n,t)),e){case"=":case"==":r=Jo.core.rel.eq([t,n]);break;case"!=":r=Jo.core.rel.neq([t,n]);break;case">":r=Jo.core.rel.gr([t,n]);break;case"<":r=Jo.core.rel.lt([t,n]);break;case">=":r=Jo.core.rel.gre([t,n]);break;case"<=":r=Jo.core.rel.lte([t,n]);break;default:throw new Error(`value operator '${e}' not supported`)}return Jo.struct.generator.atomGroups({"atom-test":r})}}],xJe=Ye.createLanguage({Parens:function(e){return Ye.alt(e.Parens,e.Operator,e.Expression).wrap(Ye.string("("),Ye.string(")"))},Expression:function(e){return Ye.alt(e.RangeListProperty,e.ValueQuery,e.Keywords)},NamedAtomProperties:function(){return Ye.alt(...Dfe(D_))},Keywords:()=>Ye.alt(...xH(qfe)),ValueRange:function(e){return Ye.seq(e.Value.skip(Ye.regexp(/\s+TO\s+/i)),e.Value).map(t=>({range:t}))},RangeListProperty:function(e){return Ye.seq(Ye.alt(..._H(D_,/\s/)).skip(Ye.whitespace),Ye.alt(e.ValueRange,e.Value).sepBy1(Ye.whitespace)).map(t=>{const[n,r]=t,i=[],o=[];r.forEach(c=>{c.range?o.push(Jo.core.rel.inRange([n,c.range[0],c.range[1]])):i.push(VD(n,c,zfe))});const s=function $Qe(e){return 1===e.length?e[0]:e.length>1?lo.core.logic.or(e):void 0}(o),a=function tJe(e,t){if(eJe.includes(e.head.name)){const n=t[0].head,r=[];return t.forEach(i=>r.push(...i.args[0])),lo.core.flags.hasAny([e,{head:n,args:r}])}return 1===t.length?lo.core.rel.eq([e,t[0]]):t.length>1?lo.core.set.has([lo.core.type.set(t),e]):void 0}(n,i);let l;return l=s&&a?Jo.core.logic.or([s,a]):s||a,Jo.struct.generator.atomGroups({[JQe(n)]:l})})},Operator:function(e){return zD(Vfe,Ye.alt(e.Parens,e.Expression,e.ValueQuery))},Query:function(e){return Ye.alt(e.Operator,e.Parens,e.Expression).trim(Ye.optWhitespace)},Number:function(){return Ye.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){const e=SH(D_,qfe,Vfe).sort(_g).map(w3).join("|");return Ye.alt(Ye.regexp(new RegExp(`(?!(${e}))[A-Z0-9_]+`,"i")),Ye.regexp(/'((?:[^"\\]|\\.)*)'/,1),Ye.regexp(/"((?:[^"\\]|\\.)*)"/,1).map(t=>Jo.core.type.regex([`^${t}$`,"i"]))).desc("string")},Value:function(e){return Ye.alt(e.Number,e.String)},ValueParens:function(e){return Ye.alt(e.ValueParens,e.ValueOperator,e.ValueExpressions).wrap(Ye.string("("),Ye.string(")"))},ValuePropertyNames:function(){return Ye.alt(..._H(D_,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(e){return zD(vJe,Ye.alt(e.ValueParens,e.ValueExpressions))},ValueExpressions:function(e){return Ye.alt(e.ValueFunctions,e.Value,e.ValuePropertyNames)},ValueFunctions:function(e){return Ye.alt(...function XQe(e,t){const n=[],r=Ye.regexp(/\(\s*/),i=Ye.regexp(/\s*\)/);return Object.keys(e).sort(_g).forEach(o=>{const s=e[o],a=s.map?s.map:q1(`function '${o}' not supported`),l=Ye.regexp(new RegExp(o,"i")).skip(r).then(t).skip(i).map(a);n.push(l)}),n}(bJe,e.ValueOperator))},ValueQuery:function(e){return Ye.alt(e.ValueOperator.map(t=>{if(!t.head.name||!t.head.name.startsWith("structure-query.generator"))throw new Error(`values must be part of an comparison, value '${t}'`);return t}))}}),_Je={pymol:e=>mJe.Query.tryParse(e),vmd:e=>xJe.Query.tryParse(e),jmol:e=>aJe.Query.tryParse(e)},UN=new class CJe{constructor(){this.map=new Map}removeSymbol(t){this.map.delete(t.symbol.id)}addSymbol(t){this.map.has(t.symbol.id)&&console.warn(`Symbol '${t.symbol.id}' already added. Call removeSymbol/removeCustomProps re-adding the symbol.`),this.map.set(t.symbol.id,t)}addCustomProp(t){if(t.symbols)for(const n of Object.keys(t.symbols))this.addSymbol(t.symbols[n])}removeCustomProp(t){if(t.symbols)for(const n of Object.keys(t.symbols))this.removeSymbol(t.symbols[n])}getRuntime(t){return this.map.get(t)}};class wJe{constructor(t){this.table=t,this.constQueryContext=new _f(Xe.Empty)}}var Wfe,k_,WD,iA;!function(e){e.Const=function t(r){return{kind:"const",value:r}},e.Dynamic=function n(r){return{kind:"dynamic",runtime:r}}}(Wfe||(Wfe={})),function(e){e.Const=function t(r){return{isConst:!0,fn:function(o){return r}}},e.Dynamic=function n(r){return{isConst:!1,fn:r}}}(k_||(k_={})),function(e){e.forEachEval=function t(n,r,i,o){if("number"==typeof n.length)for(let s=0,a=n.length;s<a;s++)i(n[s](r),s,o);else{let s=0;for(const a of Object.keys(n))i(n[a](r),s++,o)}return o}}(WD||(WD={})),function(e){e.Const=function t(r,i){return new $fe(r,i,!0)},e.Dynamic=function n(r,i){return new $fe(r,i,!1)}}(iA||(iA={}));class $fe{compile(t,n){let r,i=!1;if(n)if(cl.isArgumentsArray(n)){r=[],i=!0;for(const o of n){const s=IH(t,o);i=i&&s.isConst,r.push(s.fn)}}else{r=Object.create(null),i=!0;for(const o of Object.keys(n)){const s=IH(t,n[o]);i=i&&s.isConst,r[o]=s.fn}}else r=void 0,i=!0;return this.isConst&&this.isConst&&i?k_.Const(this.fn(t.constQueryContext,r)):k_.Dynamic(function Yfe(e,t){return function(r){return e(r,t)}}(this.fn,r))}constructor(t,n,r){this.symbol=t,this.fn=n,this.isConst=r}}function IH(e,t){if(cl.isLiteral(t))return k_.Const(t);if(cl.isSymbol(t)){const r=e.table.getRuntime(t.name);return r?r.compile(e):k_.Const(t.name)}if(!cl.isSymbol(t.head))throw new Error("Can only apply symbols.");const n=e.table.getRuntime(t.head.name);if(!n)throw new Error(`Symbol '${t.head.name}' is not implemented.`);return n.compile(e,t.args)}function M_(e){return IH(new wJe(UN),e).fn}const Ln=iA.Const,mn=iA.Dynamic,AJe=[Ln(Ee.core.type.bool,function(t,n){return!!n[0](t)}),Ln(Ee.core.type.num,function(t,n){return+n[0](t)}),Ln(Ee.core.type.str,function(t,n){return""+n[0](t)}),Ln(Ee.core.type.list,function(t,n){return WD.forEachEval(n,t,(r,i,o)=>o[i]=r,[])}),Ln(Ee.core.type.set,function(t,n){return WD.forEachEval(n,t,function(i,o,s){return s.add(i)},new Set)}),Ln(Ee.core.type.regex,function(t,n){return new RegExp(n[0](t),n[1]&&n[1](t)||"")}),Ln(Ee.core.type.bitflags,function(t,n){return+n[0](t)}),Ln(Ee.core.type.compositeKey,function(t,n){return WD.forEachEval(n,t,(r,i,o)=>o[i]=""+r,[]).join("-")}),Ln(Ee.core.logic.not,(e,t)=>!t[0](e)),Ln(Ee.core.logic.and,(e,t)=>{if("number"==typeof t.length){for(let n=0,r=t.length;n<r;n++)if(!t[n](e))return!1}else for(const n of Object.keys(t))if(!t[n](e))return!1;return!0}),Ln(Ee.core.logic.or,(e,t)=>{if("number"==typeof t.length){for(let n=0,r=t.length;n<r;n++)if(t[n](e))return!0}else for(const n of Object.keys(t))if(t[n](e))return!0;return!1}),Ln(Ee.core.rel.eq,(e,t)=>t[0](e)===t[1](e)),Ln(Ee.core.rel.neq,(e,t)=>t[0](e)!==t[1](e)),Ln(Ee.core.rel.lt,(e,t)=>t[0](e)<t[1](e)),Ln(Ee.core.rel.lte,(e,t)=>t[0](e)<=t[1](e)),Ln(Ee.core.rel.gr,(e,t)=>t[0](e)>t[1](e)),Ln(Ee.core.rel.gre,(e,t)=>t[0](e)>=t[1](e)),Ln(Ee.core.rel.inRange,(e,t)=>{const n=t[0](e);return n>=t[1](e)&&n<=t[2](e)}),Ln(Ee.core.math.add,(e,t)=>{let n=0;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n+=t[r](e);else for(const r of Object.keys(t))n+=t[r](e);return n}),Ln(Ee.core.math.sub,(e,t)=>{let n=0;if("number"==typeof t.length){if(1===t.length)return-t[0](e);n=t[0](e)||0;for(let r=1,i=t.length;r<i;r++)n-=t[r](e)}else{const r=Object.keys(t);if(1===r.length)return-t[r[0]](e);n=t[r[0]](e)||0;for(let i=1,o=r.length;i<o;i++)n-=t[r[i]](e)}return n}),Ln(Ee.core.math.mult,(e,t)=>{let n=1;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n*=t[r](e);else for(const r of Object.keys(t))n*=t[r](e);return n}),Ln(Ee.core.math.div,(e,t)=>t[0](e)/t[1](e)),Ln(Ee.core.math.pow,(e,t)=>Math.pow(t[0](e),t[1](e))),Ln(Ee.core.math.mod,(e,t)=>t[0](e)%t[1](e)),Ln(Ee.core.math.min,(e,t)=>{let n=Number.POSITIVE_INFINITY;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=Math.min(t[r](e),n);else for(const r of Object.keys(t))n=Math.min(t[r](e),n);return n}),Ln(Ee.core.math.max,(e,t)=>{let n=Number.NEGATIVE_INFINITY;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=Math.max(t[r](e),n);else for(const r of Object.keys(t))n=Math.max(t[r](e),n);return n}),Ln(Ee.core.math.cantorPairing,(e,t)=>gf(t[0](e),t[1](e))),Ln(Ee.core.math.sortedCantorPairing,(e,t)=>v3(t[0](e),t[1](e))),Ln(Ee.core.math.invertCantorPairing,(e,t)=>Coe([0,0],t[0](e))),Ln(Ee.core.math.floor,(e,t)=>Math.floor(t[0](e))),Ln(Ee.core.math.ceil,(e,t)=>Math.ceil(t[0](e))),Ln(Ee.core.math.roundInt,(e,t)=>Math.round(t[0](e))),Ln(Ee.core.math.trunc,(e,t)=>Math.trunc(t[0](e))),Ln(Ee.core.math.abs,(e,t)=>Math.abs(t[0](e))),Ln(Ee.core.math.sign,(e,t)=>Math.sign(t[0](e))),Ln(Ee.core.math.sqrt,(e,t)=>Math.sqrt(t[0](e))),Ln(Ee.core.math.cbrt,(e,t)=>Math.cbrt(t[0](e))),Ln(Ee.core.math.sin,(e,t)=>Math.sin(t[0](e))),Ln(Ee.core.math.cos,(e,t)=>Math.cos(t[0](e))),Ln(Ee.core.math.tan,(e,t)=>Math.tan(t[0](e))),Ln(Ee.core.math.asin,(e,t)=>Math.asin(t[0](e))),Ln(Ee.core.math.acos,(e,t)=>Math.acos(t[0](e))),Ln(Ee.core.math.atan,(e,t)=>Math.atan(t[0](e))),Ln(Ee.core.math.sinh,(e,t)=>Math.sinh(t[0](e))),Ln(Ee.core.math.cosh,(e,t)=>Math.cosh(t[0](e))),Ln(Ee.core.math.tanh,(e,t)=>Math.tanh(t[0](e))),Ln(Ee.core.math.exp,(e,t)=>Math.exp(t[0](e))),Ln(Ee.core.math.log,(e,t)=>Math.log(t[0](e))),Ln(Ee.core.math.log10,(e,t)=>Math.log10(t[0](e))),Ln(Ee.core.math.atan2,(e,t)=>Math.atan2(t[0](e),t[1](e))),Ln(Ee.core.str.match,(e,t)=>t[0](e).test(t[1](e))),Ln(Ee.core.str.concat,(e,t)=>{const n=[];if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n.push(t[r](e).toString());else for(const r of Object.keys(t))n.push(t[r](e).toString());return n.join("")}),Ln(Ee.core.list.getAt,(e,t)=>t[0](e)[t[1](e)]),Ln(Ee.core.list.equal,(e,t)=>IU(t[0](e),t[1](e))),Ln(Ee.core.set.has,function(t,n){return n[0](t).has(n[1](t))}),Ln(Ee.core.set.isSubset,function(t,n){return Lo.isSuperset(n[1](t),n[0](t))}),Ln(Ee.core.flags.hasAny,(e,t)=>{const n=t[1](e),r=t[0](e);return n?!!(r&n):!!r}),Ln(Ee.core.flags.hasAll,(e,t)=>{const n=t[1](e),r=t[0](e);return n?(r&n)===n:!r}),Ln(Ee.structureQuery.type.elementSymbol,(e,t)=>Jx(t[0](e))),Ln(Ee.structureQuery.type.atomName,(e,t)=>function KLe(e){return e?"string"==typeof e?e.toUpperCase():`${e}`.toUpperCase():""}(t[0](e))),Ln(Ee.structureQuery.type.bondFlags,(e,t)=>{let n=0;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=Xfe(n,t[r](e));else for(const r of Object.keys(t))n=Xfe(n,t[r](e));return n}),Ln(Ee.structureQuery.type.ringFingerprint,(e,t)=>fp.elementFingerprint(function IJe(e,t){const n=[];if(!t)return n;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n.push(t[r](e));else{const r=Object.keys(t);for(let i=1,o=r.length;i<o;i++)n.push(t[r[i]](e))}return n}(e,t))),Ln(Ee.structureQuery.type.secondaryStructureFlags,(e,t)=>{let n=0;if("number"==typeof t.length)for(let r=0,i=t.length;r<i;r++)n=Kfe(n,t[r](e));else for(const r of Object.keys(t))n=Kfe(n,t[r](e));return n}),mn(Ee.structureQuery.filter.pick,(e,t)=>_i.filters.pick(t[0],t.test)(e)),mn(Ee.structureQuery.filter.first,(e,t)=>_i.filters.first(t[0])(e)),mn(Ee.structureQuery.filter.withSameAtomProperties,(e,t)=>_i.filters.withSameAtomProperties(t[0],t.source,t.property)(e)),mn(Ee.structureQuery.filter.intersectedBy,(e,t)=>_i.filters.areIntersectedBy(t[0],t.by)(e)),mn(Ee.structureQuery.filter.within,(e,t)=>{var n,r,i;return _i.filters.within({query:t[0],target:t.target,minRadius:null===(n=t["min-radius"])||void 0===n?void 0:n.call(t,e),maxRadius:null===(r=t["max-radius"])||void 0===r?void 0:r.call(t,e),elementRadius:t["atom-radius"],invert:null===(i=t.invert)||void 0===i?void 0:i.call(t,e)})(e)}),mn(Ee.structureQuery.filter.isConnectedTo,(e,t)=>{var n,r;return _i.filters.isConnectedTo({query:t[0],target:t.target,disjunct:null===(n=t.disjunct)||void 0===n?void 0:n.call(t,e),invert:null===(r=t.invert)||void 0===r?void 0:r.call(t,e),bondTest:t["bond-test"]})(e)}),mn(Ee.structureQuery.generator.atomGroups,function(t,n){return _i.generators.atoms({entityTest:n["entity-test"],chainTest:n["chain-test"],residueTest:n["residue-test"],atomTest:n["atom-test"],groupBy:n["group-by"]})(t)}),mn(Ee.structureQuery.generator.all,function(t){return _i.generators.all(t)}),mn(Ee.structureQuery.generator.empty,function(t){return _i.generators.none(t)}),mn(Ee.structureQuery.generator.bondedAtomicPairs,function(t,n){return _i.generators.bondedAtomicPairs(n&&n[0])(t)}),mn(Ee.structureQuery.generator.rings,function(t,n){var r,i;return _i.generators.rings(null===(r=n?.fingerprint)||void 0===r?void 0:r.call(n,t),null===(i=n?.["only-aromatic"])||void 0===i?void 0:i.call(n,t))(t)}),mn(Ee.structureQuery.generator.queryInSelection,function(t,n){var r;return _i.generators.querySelection(n[0],n.query,null===(r=n["in-complement"])||void 0===r?void 0:r.call(n,t))(t)}),mn(Ee.structureQuery.modifier.includeSurroundings,function(t,n){return _i.modifiers.includeSurroundings(n[0],{radius:n.radius(t),wholeResidues:!(!n["as-whole-residues"]||!n["as-whole-residues"](t)),elementRadius:n["atom-radius"]})(t)}),mn(Ee.structureQuery.modifier.surroundingLigands,function(t,n){return _i.modifiers.surroundingLigands({query:n[0],radius:n.radius(t),includeWater:!(!n["include-water"]||!n["include-water"](t))})(t)}),mn(Ee.structureQuery.modifier.wholeResidues,function(t,n){return _i.modifiers.wholeResidues(n[0])(t)}),mn(Ee.structureQuery.modifier.union,function(t,n){return _i.modifiers.union(n[0])(t)}),mn(Ee.structureQuery.modifier.expandProperty,function(t,n){return _i.modifiers.expandProperty(n[0],n.property)(t)}),mn(Ee.structureQuery.modifier.exceptBy,function(t,n){return _i.modifiers.exceptBy(n[0],n.by)(t)}),mn(Ee.structureQuery.modifier.includeConnected,function(t,n){var r,i;return _i.modifiers.includeConnected({query:n[0],bondTest:n["bond-test"],wholeResidues:!(!n["as-whole-residues"]||!n["as-whole-residues"](t)),layerCount:n["layer-count"]&&n["layer-count"](t)||1,fixedPoint:null!==(i=null===(r=n["fixed-point"])||void 0===r?void 0:r.call(n,t))&&void 0!==i&&i})(t)}),mn(Ee.structureQuery.modifier.intersectBy,function(t,n){return _i.modifiers.intersectBy(n[0],n.by)(t)}),mn(Ee.structureQuery.combinator.merge,(e,t)=>_i.combinators.merge(t)(e)),mn(Ee.structureQuery.atomProperty.core.elementSymbol,eo(Je.atom.type_symbol)),mn(Ee.structureQuery.atomProperty.core.vdw,(e,t)=>B3(Je.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),mn(Ee.structureQuery.atomProperty.core.mass,(e,t)=>function GUe(e){const t=v5[e];return void 0===t?10.81:UUe[t]}(Je.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),mn(Ee.structureQuery.atomProperty.core.atomicNumber,(e,t)=>L3(Je.atom.type_symbol(t&&t[0]&&t[0](e)||e.element))),mn(Ee.structureQuery.atomProperty.core.x,eo(Je.atom.x)),mn(Ee.structureQuery.atomProperty.core.y,eo(Je.atom.y)),mn(Ee.structureQuery.atomProperty.core.z,eo(Je.atom.z)),mn(Ee.structureQuery.atomProperty.core.sourceIndex,eo(Je.atom.sourceIndex)),mn(Ee.structureQuery.atomProperty.core.operatorName,eo(Je.unit.operator_name)),mn(Ee.structureQuery.atomProperty.core.operatorKey,eo(Je.unit.operator_key)),mn(Ee.structureQuery.atomProperty.core.modelIndex,eo(Je.unit.model_index)),mn(Ee.structureQuery.atomProperty.core.modelLabel,eo(Je.unit.model_label)),mn(Ee.structureQuery.atomProperty.core.atomKey,(e,t)=>{const n=t&&t[0]&&t[0](e)||e.element;return gf(n.unit.id,n.element)}),mn(Ee.structureQuery.atomProperty.macromolecular.residueKey,(e,t)=>function WVe(e){return ze.isAtomic(e.unit)?e.unit.residueIndex[e.element]:-1}(t&&t[0]&&t[0](e)||e.element)),mn(Ee.structureQuery.atomProperty.macromolecular.chainKey,(e,t)=>function $Ve(e){return ze.isAtomic(e.unit)?e.unit.chainIndex[e.element]:-1}(t&&t[0]&&t[0](e)||e.element)),mn(Ee.structureQuery.atomProperty.macromolecular.entityKey,(e,t)=>function YVe(e){return Je.entity.key(e)}(t&&t[0]&&t[0](e)||e.element)),mn(Ee.structureQuery.atomProperty.macromolecular.id,eo(Je.atom.id)),mn(Ee.structureQuery.atomProperty.macromolecular.isHet,(e,t)=>"ATOM"!==Je.residue.group_PDB(t&&t[0]&&t[0](e)||e.element)),mn(Ee.structureQuery.atomProperty.macromolecular.label_atom_id,eo(Je.atom.label_atom_id)),mn(Ee.structureQuery.atomProperty.macromolecular.label_alt_id,eo(Je.atom.label_alt_id)),mn(Ee.structureQuery.atomProperty.macromolecular.label_comp_id,eo(Je.atom.label_comp_id)),mn(Ee.structureQuery.atomProperty.macromolecular.label_seq_id,eo(Je.residue.label_seq_id)),mn(Ee.structureQuery.atomProperty.macromolecular.label_asym_id,eo(Je.chain.label_asym_id)),mn(Ee.structureQuery.atomProperty.macromolecular.label_entity_id,eo(Je.entity.id)),mn(Ee.structureQuery.atomProperty.macromolecular.auth_atom_id,eo(Je.atom.auth_atom_id)),mn(Ee.structureQuery.atomProperty.macromolecular.auth_comp_id,eo(Je.atom.auth_comp_id)),mn(Ee.structureQuery.atomProperty.macromolecular.auth_seq_id,eo(Je.residue.auth_seq_id)),mn(Ee.structureQuery.atomProperty.macromolecular.auth_asym_id,eo(Je.chain.auth_asym_id)),mn(Ee.structureQuery.atomProperty.macromolecular.pdbx_PDB_ins_code,eo(Je.residue.pdbx_PDB_ins_code)),mn(Ee.structureQuery.atomProperty.macromolecular.pdbx_formal_charge,eo(Je.atom.pdbx_formal_charge)),mn(Ee.structureQuery.atomProperty.macromolecular.occupancy,eo(Je.atom.occupancy)),mn(Ee.structureQuery.atomProperty.macromolecular.B_iso_or_equiv,eo(Je.atom.B_iso_or_equiv)),mn(Ee.structureQuery.atomProperty.macromolecular.entityType,eo(Je.entity.type)),mn(Ee.structureQuery.atomProperty.macromolecular.entitySubtype,eo(Je.entity.subtype)),mn(Ee.structureQuery.atomProperty.macromolecular.entityPrdId,eo(Je.entity.prd_id)),mn(Ee.structureQuery.atomProperty.macromolecular.entityDescription,eo(Je.entity.pdbx_description)),mn(Ee.structureQuery.atomProperty.macromolecular.objectPrimitive,eo(Je.unit.object_primitive)),mn(Ee.structureQuery.atomProperty.macromolecular.isNonStandard,eo(Je.residue.isNonStandard)),mn(Ee.structureQuery.atomProperty.macromolecular.secondaryStructureKey,eo(Je.residue.secondary_structure_key)),mn(Ee.structureQuery.atomProperty.macromolecular.secondaryStructureFlags,eo(Je.residue.secondary_structure_type)),mn(Ee.structureQuery.atomProperty.macromolecular.chemCompType,eo(Je.residue.chem_comp_type)),mn(Ee.structureQuery.atomSet.atomCount,function(t,n){return _i.atomset.atomCount(t)}),mn(Ee.structureQuery.atomSet.countQuery,function(t,n){return _i.atomset.countQuery(n[0])(t)}),mn(Ee.structureQuery.atomSet.propertySet,function(t,n){return _i.atomset.propertySet(n[0])(t)}),mn(Ee.structureQuery.bondProperty.order,(e,t)=>e.atomicBond.order),mn(Ee.structureQuery.bondProperty.flags,(e,t)=>e.atomicBond.type),mn(Ee.structureQuery.bondProperty.key,(e,t)=>e.atomicBond.key),mn(Ee.structureQuery.bondProperty.atomA,(e,t)=>e.atomicBond.a),mn(Ee.structureQuery.bondProperty.atomB,(e,t)=>e.atomicBond.b),mn(Ee.structureQuery.bondProperty.length,(e,t)=>e.atomicBond.length),mn(Ee.internal.generator.bundleElement,function(t,n){return aae(n.groupedUnits(t),n.ranges(t),n.set(t))}),mn(Ee.internal.generator.bundle,function(t,n){return lae(n.elements(t))(t)}),mn(Ee.internal.generator.current,function(t,n){return t.tryGetCurrentSelection()})];function eo(e){return(t,n)=>e(n&&n[0]&&n[0](t)||t.element)}function Xfe(e,t){return e|(Lr.isName(t)?Lr.fromName(t):0)}function Kfe(e,t){switch(t.toLowerCase()){case"helix":return 2|e;case"alpha":return 4098|e;case"pi":return 32770|e;case"310":return 2050|e;case"beta":return 4|e;case"strand":return 4194308|e;case"sheet":return 8388612|e;case"turn":return 16|e;case"bend":return 8|e;case"coil":return 536870912|e;default:return e}}function pa(e,t){return{expression:e,language:t}}!function(){for(const e of AJe)UN.addSymbol(e)}(),function(e){function r(a){switch(a.language){case"mol-script":const l=function WQe(e){return mH.parse(e)}(a.expression);if(0===l.length)throw new Error("No query");return jQe(l[0]);case"pymol":case"jmol":case"vmd":return function SJe(e,t){try{return _Je[e](t)}catch(n){throw console.error(n.message),n}}(a.language,a.expression);default:Hi()}}function i(a){return M_(r(a))}e.Info={"mol-script":"Mol-Script",pymol:"PyMOL",vmd:"VMD",jmol:"Jmol"},e.is=function t(a){return!!a&&"string"==typeof a.expression&&!!a.language},e.areEqual=function n(a,l){return a.language===l.language&&a.expression===l.expression},e.toExpression=r,e.toQuery=i,e.toLoci=function o(a,l){const u=i(a)(new _f(l));return Dt.toLociWithSourceUnits(u)},e.getStructureSelection=function s(a,l,c){return M_("function"==typeof a?a(pe):a)(new _f(l,c))}}(pa||(pa={}));const oA={dynamicBonds:I.Optional(I.Boolean(!1,{description:"Ensure bonds are recalculated upon model changes. Also enables calculation of inter-unit bonds in water molecules and ions."}))};var R_,lu;!function(e){function r(p,m,h,g,y){return i.apply(this,arguments)}function i(){return(i=le(function*(p,m,h,g,y){let v;const x=Vs.Provider.get(h);!g&&x&&0!==x.assemblies.length&&(g=x.assemblies[0].id),x&&0!==x.assemblies.length?(v=M3.findAssembly(h,g||""),v||p.log.warn(`Model '${h.entryId}' has no assembly called '${g}', returning model structure.`)):p.log.warn(`Model '${h.entryId}' has no assembly, returning model structure.`);const _=Xe.ofModel(h,y);if(!v){const M={label:"Model",description:Xe.elementDescription(_)};return new Se.Molecule.Structure(_,M)}g=v.id;const w=yield lg.buildAssembly(_,g).runInContext(m),A={label:`Assembly ${g}`,description:Xe.elementDescription(w)};return new Se.Molecule.Structure(w,A)})).apply(this,arguments)}function s(){return(s=le(function*(p,m,h,g,y){const v=Xe.ofModel(m,y),x=yield lg.buildSymmetryRange(v,h,g).runInContext(p),_={label:`Symmetry [${h}] to [${g}]`,description:Xe.elementDescription(x)};return new Se.Molecule.Structure(x,_)})).apply(this,arguments)}function l(){return(l=le(function*(p,m,h,g){const y=Xe.ofModel(m,g),v=yield lg.builderSymmetryMates(y,h).runInContext(p),x={label:"Symmetry Mates",description:Xe.elementDescription(v)};return new Se.Molecule.Structure(v,x)})).apply(this,arguments)}function u(){return(u=le(function*(p,m,h,g,y){const v=Xe.ofModel(m,y),x=yield lg.buildSymmetryAssembly(v,h,g).runInContext(p),_={label:"Symmetry Assembly",description:Xe.elementDescription(x)};return new Se.Molecule.Structure(x,_)})).apply(this,arguments)}function f(){return f=le(function*(p,m,h,g){const y=g?.params,v=Vs.Provider.get(h);if(!v||!g||"model"===g.name){const x=Xe.ofModel(h,y);return new Se.Molecule.Structure(x,{label:"Model",description:Xe.elementDescription(x)})}if("auto"===g.name){if(0===v.assemblies.length){const x=Xe.ofModel(h,y);return new Se.Molecule.Structure(x,{label:"Model",description:Xe.elementDescription(x)})}return r(p,m,h,void 0,y)}return"assembly"===g.name?r(p,m,h,g.params.id,y):"symmetry"===g.name?function o(p,m,h,g,y){return s.apply(this,arguments)}(m,h,g.params.ijkMin,g.params.ijkMax,y):"symmetry-mates"===g.name?function a(p,m,h,g){return l.apply(this,arguments)}(m,h,g.params.radius,y):"symmetry-assembly"===g.name?function c(p,m,h,g,y){return u.apply(this,arguments)}(m,h,g.params.generators,v,y):void Hi()}),f.apply(this,arguments)}e.getParams=function t(p,m){const h=p&&Vs.Provider.get(p),g=h?h.assemblies.map(A=>[A.id,`${A.id}: ${yf(A.details)}`]):[],y=!h||!Qc.isZero(h.spacegroup.cell),v=[];if(h){const{operators:A}=h.spacegroup;for(let M=0,E=A.length;M<E;M++)v.push([M,`${M+1}: ${wd.getOperatorXyz(A[M])}`])}const x=[];p&&p.properties.structAsymMap.forEach(A=>{x.push([A.id,A.id===A.auth_id?A.id:`${A.id} [auth ${A.auth_id}]`])});const _={auto:I.Group(oA),model:I.Group(oA),assembly:I.Group({id:I.Optional(p?I.Select(g.length?g[0][0]:"",g,{label:"Asm Id",description:"Assembly Id"}):I.Text("",{label:"Asm Id",description:"Assembly Id (use empty for the 1st assembly)"})),...oA},{isFlat:!0}),"symmetry-mates":I.Group({radius:I.Numeric(5,{min:0,max:50,step:1}),...oA},{isFlat:!0}),symmetry:I.Group({ijkMin:I.Vec3(C.create(-1,-1,-1),{step:1},{label:"Min IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),ijkMax:I.Vec3(C.create(1,1,1),{step:1},{label:"Max IJK",fieldLabels:{x:"I",y:"J",z:"K"}}),...oA},{isFlat:!0}),"symmetry-assembly":I.Group({generators:I.ObjectList({operators:I.ObjectList({index:I.Select(0,v),shift:I.Vec3(C(),{step:1},{label:"IJK",fieldLabels:{x:"I",y:"J",z:"K"}})},A=>`${A.index+1}_${A.shift.map(M=>M+5).join("")}`,{defaultValue:[]}),asymIds:I.MultiSelect([],x)},A=>`${A.asymIds.length} asym ids, ${A.operators.length} operators`,{defaultValue:[]}),...oA},{isFlat:!0})},w=[];return"auto"===m&&w.push(["auto","Auto"]),w.push(["model","Model"]),g.length>0&&w.push(["assembly","Assembly"]),y&&(w.push(["symmetry-mates","Symmetry Mates"]),w.push(["symmetry","Symmetry (indices)"]),w.push(["symmetry-assembly","Symmetry (assembly)"])),{type:I.MappedStatic(m||"model",_,{options:w})}},e.canAutoUpdate=function n(p,m){return!("symmetry-assembly"===m.name||"symmetry"===m.name&&"symmetry"===p.name)},e.create=function d(p,m,h,g){return f.apply(this,arguments)}}(R_||(R_={})),function(e){function n(a,l){const c=pa.is(l)?l:void 0,u=pa.is(l)?pa.toExpression(l):l;return{script:c,expression:u,compiled:M_(u),originalStructure:a,currentStructure:a}}function r(a,l){return a.compiled(new _f(l))}e.isUnchanged=function t(a,l,c){return a.currentStructure===c&&(pa.is(l)?!!a.script&&pa.areEqual(a.script,l):a.expression===l)},e.create=n,e.run=r,e.createAndRun=function i(a,l){const c=n(a,l);return{entry:c,selection:r(c,a)}},e.updateStructure=function o(a,l){return a.currentStructure=l,a.compiled(new _f(l))},e.updateStructureObject=function s(a,l,c){const u=Dt.unionStructure(l);a.label=`${c||"Selection"}`,a.description=Xe.elementDescription(u),a.data=u}}(lu||(lu={}));const EJe={H:"Hydrogen",HE:"Helium",LI:"Lithium",BE:"Beryllium",B:"Boron",C:"Carbon",N:"Nitrogen",O:"Oxygen",F:"Fluorine",NE:"Neon",NA:"Sodium",MG:"Magnesium",AL:"Aluminum",SI:"Silicon",P:"Phosphorus",S:"Sulfur",CL:"Chlorine",AR:"Argon",K:"Potassium",CA:"Calcium",SC:"Scandium",TI:"Titanium",V:"Vanadium",CR:"Chromium",MN:"Manganese",FE:"Iron",CO:"Cobalt",NI:"Nickel",CU:"Copper",ZN:"Zinc",GA:"Gallium",GE:"Germanium",AS:"Arsenic",SE:"Selenium",BR:"Bromine",KR:"Krypton",RB:"Rubidium",SR:"Strontium",Y:"Yttrium",ZR:"Zirconium",NB:"Niobium",MO:"Molybdenum",TC:"Technetium",RU:"Ruthenium",RH:"Rhodium",PD:"Palladium",AG:"Silver",CD:"Cadmium",IN:"Indium",SN:"Tin",SB:"Antimony",TE:"Tellurium",I:"Iodine",XE:"Xenon",CS:"Cesium",BA:"Barium",LA:"Lanthanum",CE:"Cerium",PR:"Praseodymium",ND:"Neodymium",PM:"Promethium",SM:"Samarium",EU:"Europium",GD:"Gadolinium",TB:"Terbium",DY:"Dysprosium",HO:"Holmium",ER:"Erbium",TM:"Thulium",YB:"Ytterbium",LU:"Lutetium",HF:"Hafnium",TA:"Tantalum",W:"Wolfram",RE:"Rhenium",OS:"Osmium",IR:"Iridium",PT:"Platinum",AU:"Gold",HG:"Mercury",TL:"Thallium",PB:"Lead",BI:"Bismuth",PO:"Polonium",AT:"Astatine",RN:"Radon",FR:"Francium",RA:"Radium",AC:"Actinium",TH:"Thorium",PA:"Protactinium",U:"Uranium",NP:"Neptunium",PU:"Plutonium",AM:"Americium",CM:"Curium",BK:"Berkelium",CF:"Californium",ES:"Einsteinium",FM:"Fermium",MD:"Mendelevium",NO:"Nobelium",LR:"Lawrencium",RF:"Rutherfordium",DB:"Dubnium",SG:"Seaborgium",BH:"Bohrium",HS:"Hassium",MT:"Meitnerium",DS:"Darmstadtium",RG:"Roentgenium",CN:"Copernicium",NH:"Nihonium",FL:"Flerovium",MC:"Moscovium",LV:"Livermorium",TS:"Tennessine",OG:"Oganesson"},TJe=new Set(["LI","NA","K","RB","CS","FR"]),PJe=new Set(["BE","MG","CA","SR","BA","RA"]),LJe=new Set(["ZN","GA","CD","IN","SN","HG","TI","PB","BI","PO","CN"]),zJe=new Set(["F","CL","BR","I","AT"]);function VJe(e){return zJe.has(e)}function Zfe(e){const t=L3(e);return t>=21&&t<=29||t>=39&&t<=47||t>=72&&t<=79||t>=104&&t<=108}function qJe(e){return function DJe(e){return TJe.has(e)}(e)||function kJe(e){return PJe.has(e)}(e)||function HJe(e){const t=L3(e);return t>=57&&t<=71}(e)||function GJe(e){const t=L3(e);return t>=89&&t<=103}(e)||Zfe(e)||function jJe(e){return LJe.has(e)}(e)}var yi=function(e){return e.Type="Type",e.Structure="Structure Property",e.Atom="Atom Property",e.Bond="Bond Property",e.Residue="Residue Property",e.AminoAcid="Amino Acid",e.NucleicBase="Nucleic Base",e.Manipulate="Manipulate Selection",e.Validation="Validation",e.Misc="Miscellaneous",e.Internal="Internal",e}(yi||{});function hi(e,t,n={}){var r;let i;return{label:e,expression:t,description:n.description||"",category:null!==(r=n.category)&&void 0!==r?r:yi.Misc,isHidden:!!n.isHidden,priority:n.priority||0,referencesCurrent:!!n.referencesCurrent,get query(){return i||(i=M_(t)),i},ensureCustomProperties:n.ensureCustomProperties,getSelection:(o,s,a)=>le(function*(){const l=o.managers.structure.selection.getStructure(a),c=l?Dt.Sequence(a,[l]):Dt.Empty(a);return n.ensureCustomProperties&&(yield n.ensureCustomProperties({runtime:s,assetManager:o.managers.asset},a)),i||(i=M_(t)),i(new _f(a,{currentSelection:c}))})()}}const WJe=hi("All",pe.struct.generator.all(),{category:"",priority:1e3}),$Je=hi("Current Selection",pe.internal.generator.current(),{category:"",referencesCurrent:!0}),YJe=hi("Polymer",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.logic.and([pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),pe.core.str.match([pe.re("(polypeptide|cyclic-pseudo-peptide|peptide-like|nucleotide|peptide nucleic acid)","i"),pe.ammp("entitySubtype")])])})]),{category:yi.Type}),XJe=hi("Trace",pe.struct.modifier.union([pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),"chain-test":pe.core.set.has([pe.set("sphere","gaussian"),pe.ammp("objectPrimitive")])})]),pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"atom-test":pe.core.set.has([pe.set("CA","P"),pe.ammp("label_atom_id")])})])])]),{category:yi.Structure}),sA=pe.core.logic.and([pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),pe.core.str.match([pe.re("(polypeptide|cyclic-pseudo-peptide|peptide-like)","i"),pe.ammp("entitySubtype")])]),zN=pe.core.logic.and([pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),pe.core.str.match([pe.re("(nucleotide|peptide nucleic acid)","i"),pe.ammp("entitySubtype")])]),N_=pe.core.str.match([pe.re("non-polymer|(amino|carboxy) terminus|peptide-like","i"),pe.ammp("chemCompType")]),KJe=hi("Backbone",pe.struct.modifier.union([pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":sA,"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([N_]),"atom-test":pe.core.set.has([pe.set(...Lo.toArray(Y0)),pe.ammp("label_atom_id")])})]),pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":zN,"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([N_]),"atom-test":pe.core.set.has([pe.set(...Lo.toArray(XR)),pe.ammp("label_atom_id")])})])])]),{category:yi.Structure}),ZJe=hi("Sidechain",pe.struct.modifier.union([pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":sA,"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([N_]),"atom-test":pe.core.logic.or([pe.core.logic.not([pe.core.set.has([pe.set(...Lo.toArray(Y0)),pe.ammp("label_atom_id")])])])})]),pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":zN,"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([N_]),"atom-test":pe.core.logic.or([pe.core.logic.not([pe.core.set.has([pe.set(...Lo.toArray(XR)),pe.ammp("label_atom_id")])])])})])])]),{category:yi.Structure}),QJe=hi("Sidechain with Trace",pe.struct.modifier.union([pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":sA,"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([N_]),"atom-test":pe.core.logic.or([pe.core.logic.not([pe.core.set.has([pe.set(...Lo.toArray(Y0)),pe.ammp("label_atom_id")])]),pe.core.rel.eq([pe.ammp("label_atom_id"),"CA"]),pe.core.logic.and([pe.core.rel.eq([pe.ammp("auth_comp_id"),"PRO"]),pe.core.rel.eq([pe.ammp("label_atom_id"),"N"])])])})]),pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":zN,"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([N_]),"atom-test":pe.core.logic.or([pe.core.logic.not([pe.core.set.has([pe.set(...Lo.toArray(XR)),pe.ammp("label_atom_id")])]),pe.core.rel.eq([pe.ammp("label_atom_id"),"P"])])})])])]),{category:yi.Structure}),JJe=hi("Protein",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":sA})]),{category:yi.Type}),eet=hi("Nucleic",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":zN})]),{category:yi.Type}),tet=hi("Helix",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":sA,"residue-test":pe.core.flags.hasAny([pe.ammp("secondaryStructureFlags"),pe.core.type.bitflags([2])])})]),{category:yi.Structure,ensureCustomProperties:(e,t)=>gp.attach(e,t)}),net=hi("Beta Strand/Sheet",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":sA,"residue-test":pe.core.flags.hasAny([pe.ammp("secondaryStructureFlags"),pe.core.type.bitflags([4])])})]),{category:yi.Structure,ensureCustomProperties:(e,t)=>gp.attach(e,t)}),ret=hi("Water",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entityType"),"water"])})]),{category:yi.Type}),iet=hi("Ion",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entitySubtype"),"ion"])})]),{category:yi.Type}),oet=hi("Lipid",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entitySubtype"),"lipid"])})]),{category:yi.Type}),VN=hi("Carbohydrate",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.logic.or([pe.core.rel.eq([pe.ammp("entityType"),"branched"]),pe.core.logic.and([pe.core.rel.eq([pe.ammp("entityType"),"non-polymer"]),pe.core.str.match([pe.re("oligosaccharide","i"),pe.ammp("entitySubtype")])])])})]),{category:yi.Type}),Qfe=hi("Carbohydrate with Connected",pe.struct.modifier.union([pe.struct.modifier.includeConnected({0:VN.expression,"layer-count":1,"as-whole-residues":!0})]),{category:yi.Internal,isHidden:!0}),Jfe=hi("Connected to Carbohydrate",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:Qfe.expression,by:VN.expression})]),{category:yi.Internal,isHidden:!0}),EH=hi("Ligand",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:pe.struct.modifier.union([pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.logic.and([pe.core.logic.or([pe.core.rel.eq([pe.ammp("entityType"),"non-polymer"]),pe.core.rel.neq([pe.ammp("entityPrdId"),""])]),pe.core.logic.not([pe.core.str.match([pe.re("(oligosaccharide|lipid|ion)","i"),pe.ammp("entitySubtype")])])]),"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.logic.not([pe.core.str.match([pe.re("saccharide","i"),pe.ammp("chemCompType")])])})]),pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":N_})])])]),by:pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.set.has([pe.set(...Lo.toArray(yw)),pe.ammp("label_comp_id")])})]),pe.struct.generator.atomGroups({"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.core.set.has([pe.set(...Lo.toArray(_6e)),pe.ammp("label_comp_id")])})])})]),{category:yi.Type}),epe=hi("Ligand with Connected",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:pe.struct.modifier.union([pe.struct.modifier.includeConnected({0:EH.expression,"layer-count":1,"as-whole-residues":!0,"bond-test":pe.core.flags.hasAny([pe.struct.bondProperty.flags(),pe.core.type.bitflags([3])])})]),by:VN.expression})]),{category:yi.Internal,isHidden:!0}),tpe=hi("Connected to Ligand",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:epe.expression,by:EH.expression})]),{category:yi.Internal,isHidden:!0}),set=hi("Connected to Ligand or Carbohydrate",pe.struct.modifier.union([pe.struct.combinator.merge([Jfe.expression,tpe.expression])]),{category:yi.Internal,isHidden:!0}),aet=hi("Disulfide Bridges",pe.struct.modifier.union([pe.struct.combinator.merge([pe.struct.modifier.union([pe.struct.modifier.wholeResidues([pe.struct.filter.isConnectedTo({0:pe.struct.generator.atomGroups({"residue-test":pe.core.set.has([pe.set("CYS"),pe.ammp("auth_comp_id")]),"atom-test":pe.core.set.has([pe.set("SG"),pe.ammp("label_atom_id")])}),target:pe.struct.generator.atomGroups({"residue-test":pe.core.set.has([pe.set("CYS"),pe.ammp("auth_comp_id")]),"atom-test":pe.core.set.has([pe.set("SG"),pe.ammp("label_atom_id")])}),"bond-test":!0})])]),pe.struct.modifier.union([pe.struct.modifier.wholeResidues([pe.struct.modifier.union([pe.struct.generator.bondedAtomicPairs({0:pe.core.flags.hasAny([pe.struct.bondProperty.flags(),pe.core.type.bitflags([8])])})])])])])]),{category:yi.Bond}),cet=hi("NOS Bridges",pe.struct.modifier.union([pe.struct.modifier.wholeResidues([pe.struct.filter.isConnectedTo({0:pe.struct.generator.atomGroups({"residue-test":pe.core.set.has([pe.set("CSO","LYS"),pe.ammp("auth_comp_id")]),"atom-test":pe.core.set.has([pe.set("OD","NZ"),pe.ammp("label_atom_id")])}),target:pe.struct.generator.atomGroups({"residue-test":pe.core.set.has([pe.set("CSO","LYS"),pe.ammp("auth_comp_id")]),"atom-test":pe.core.set.has([pe.set("OD","NZ"),pe.ammp("label_atom_id")])}),"bond-test":!0})])]),{category:yi.Bond}),uet=hi("Non-standard Residues in Polymers",pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.rel.eq([pe.ammp("entityType"),"polymer"]),"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":pe.ammp("isNonStandard")})]),{category:yi.Residue}),det=hi("Coarse Elements",pe.struct.modifier.union([pe.struct.generator.atomGroups({"chain-test":pe.core.set.has([pe.set("sphere","gaussian"),pe.ammp("objectPrimitive")])})]),{category:yi.Type}),fet=hi("Rings in Residues",pe.struct.modifier.union([pe.struct.generator.rings()]),{category:yi.Residue}),pet=hi("Aromatic Rings in Residues",pe.struct.modifier.union([pe.struct.generator.rings({"only-aromatic":!0})]),{category:yi.Residue}),het=hi("Surrounding Residues (5 \u212b) of Selection",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:pe.struct.modifier.includeSurroundings({0:pe.internal.generator.current(),radius:5,"as-whole-residues":!0}),by:pe.internal.generator.current()})]),{description:"Select residues within 5 \u212b of the current selection.",category:yi.Manipulate,referencesCurrent:!0}),met=hi("Surrounding Ligands (5 \u212b) of Selection",pe.struct.modifier.union([pe.struct.modifier.surroundingLigands({0:pe.internal.generator.current(),radius:5,"include-water":!0})]),{description:"Select ligand components within 5 \u212b of the current selection.",category:yi.Manipulate,referencesCurrent:!0}),get=hi("Surrounding Atoms (5 \u212b) of Selection",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:pe.struct.modifier.includeSurroundings({0:pe.internal.generator.current(),radius:5,"as-whole-residues":!1}),by:pe.internal.generator.current()})]),{description:"Select atoms within 5 \u212b of the current selection.",category:yi.Manipulate,referencesCurrent:!0}),yet=hi("Inverse / Complement of Selection",pe.struct.modifier.union([pe.struct.modifier.exceptBy({0:pe.struct.generator.all(),by:pe.internal.generator.current()})]),{description:"Select everything not in the current selection.",category:yi.Manipulate,referencesCurrent:!0}),bet=hi("Residues Covalently Bonded to Selection",pe.struct.modifier.union([pe.struct.modifier.includeConnected({0:pe.internal.generator.current(),"layer-count":1,"as-whole-residues":!0})]),{description:"Select residues covalently bonded to current selection.",category:yi.Manipulate,referencesCurrent:!0}),vet=hi("Covalently Bonded Component",pe.struct.modifier.union([pe.struct.modifier.includeConnected({0:pe.internal.generator.current(),"fixed-point":!0})]),{description:"Select covalently bonded component based on current selection.",category:yi.Manipulate,referencesCurrent:!0}),xet=hi("Residues with Cov. or Metallic Bond to Selection",pe.struct.modifier.union([pe.struct.modifier.includeConnected({0:pe.internal.generator.current(),"layer-count":1,"as-whole-residues":!0,"bond-test":pe.core.flags.hasAny([pe.struct.bondProperty.flags(),pe.core.type.bitflags([3])])})]),{description:"Select residues with covalent or metallic bond to current selection.",category:yi.Manipulate,referencesCurrent:!0}),_et=hi("Whole Residues of Selection",pe.struct.modifier.union([pe.struct.modifier.wholeResidues({0:pe.internal.generator.current()})]),{description:"Expand current selection to whole residues.",category:yi.Manipulate,referencesCurrent:!0}),Cet=[[["HIS"],"Histidine"],[["ARG"],"Arginine"],[["LYS"],"Lysine"],[["ILE"],"Isoleucine"],[["PHE"],"Phenylalanine"],[["LEU"],"Leucine"],[["TRP"],"Tryptophan"],[["ALA"],"Alanine"],[["MET"],"Methionine"],[["PRO"],"Proline"],[["CYS"],"Cysteine"],[["ASN"],"Asparagine"],[["VAL"],"Valine"],[["GLY"],"Glycine"],[["SER"],"Serine"],[["GLN"],"Glutamine"],[["TYR"],"Tyrosine"],[["ASP"],"Aspartic Acid"],[["GLU"],"Glutamic Acid"],[["THR"],"Threonine"],[["SEC"],"Selenocysteine"],[["PYL"],"Pyrrolysine"],[["UNK"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0),wet=[[["A","DA"],"Adenosine"],[["C","DC"],"Cytidine"],[["T","DT"],"Thymidine"],[["G","DG"],"Guanosine"],[["I","DI"],"Inosine"],[["U","DU"],"Uridine"],[["N","DN"],"Unknown"]].sort((e,t)=>e[1]<t[1]?-1:e[1]>t[1]?1:0);function TH([e,t],n,r=0){const i=1!==e.length||npe.has(e[0])?`${t} (${e.join(", ")})`:`[${e[0]}] ${t}`;return hi(i,pe.struct.modifier.union([pe.struct.generator.atomGroups({"residue-test":pe.core.set.has([pe.set(...e),pe.ammp("auth_comp_id")])})]),{category:n,priority:r,description:i})}const npe=Lo.unionMany(ez,I3,E3,KR);function Eet(e){const t=new Set;for(const r of e)r.uniqueElementSymbols.forEach(i=>t.add(i));const n=[];return t.forEach(r=>{n.push(function Aet([e,t],n,r){const i=`${t} (${e.join(", ")})`;return hi(i,pe.struct.modifier.union([pe.struct.generator.atomGroups({"atom-test":pe.core.set.has([pe.set(...e),pe.acp("elementSymbol")])})]),{category:n,priority:r,description:i})}([[r],EJe[r]||r],"Element Symbol",0))}),n}function Tet(e){const t=new Map,n=new Set;for(const i of e){i.uniqueResidueNames.forEach(o=>n.add(o));for(const o of i.models)i.uniqueResidueNames.forEach(s=>{const a=o.properties.chemicalComponentMap.get(s);a&&t.set(s,a.name)})}const r=[];return Lo.difference(n,npe).forEach(i=>{const o=t.get(i)||i;r.push(TH([[i],o],"Ligand/Non-standard Residue",200))}),r}function Det(e){const t=new Map,n=dt.create();for(const i of e){n.structure=i;for(const o of i.unitSymmetryGroups){n.unit=o.units[0],n.element=o.elements[0];const s=Je.entity.type(n);if("polymer"===s||"branched"===s){const a=Je.entity.pdbx_description(n);t.set(a.join(", "),a)}}}const r=[];return t.forEach((i,o)=>{r.push(function Iet([e,t],n,r){const i=`${t}`;return hi(`${t}`,pe.struct.modifier.union([pe.struct.generator.atomGroups({"entity-test":pe.core.list.equal([pe.list(...e),pe.ammp("entityDescription")])})]),{category:n,priority:r,description:i})}([i,o],"Polymer/Carbohydrate Entities",300))}),r}const Ps={all:WJe,current:$Je,polymer:YJe,trace:XJe,backbone:KJe,sidechain:ZJe,sidechainWithTrace:QJe,protein:JJe,nucleic:eet,helix:tet,beta:net,water:ret,ion:iet,lipid:oet,branched:VN,branchedPlusConnected:Qfe,branchedConnectedOnly:Jfe,ligand:EH,ligandPlusConnected:epe,ligandConnectedOnly:tpe,connectedOnly:set,disulfideBridges:aet,nosBridges:cet,nonStandardPolymer:uet,coarse:det,ring:fet,aromaticRing:pet,surroundings:het,surroundingLigands:met,surroundingAtoms:get,complement:yet,covalentlyBonded:bet,covalentlyOrMetallicBonded:xet,covalentlyBondedComponent:vet,wholeResidues:_et};class Pet{add(t){this.list.push(t),this.options.push([t,t.label,t.category]),this.version+=1}remove(t){const n=this.list.indexOf(t);-1!==n&&(this.list.splice(n,1),this.options.splice(n,1),this.version+=1)}constructor(){this.list=[],this.options=[],this.version=1,this.list.push(...Object.values(Ps),...Cet.map(t=>TH(t,yi.AminoAcid)),...wet.map(t=>TH(t,yi.NucleicBase))),this.options.push(...this.list.map(t=>[t,t.label,t.category]))}}function Net(e){switch(e){case 7:return-3;case 6:return-2;case 5:return-1;case 0:case 4:return 0;case 3:return 1;case 2:return 2;case 1:return 3;default:return console.error(`Value ${e} is outside the 0-7 range, defaulting to 0.`),0}}function rpe(e,t){const n=ot.create(e.data,2*t),r=ot.create(e.data,2*t),i=ot.create(e.data,2*t),o=ot.create(e.data,2*t),s=ot.create(e.data,2*t);for(let a=0;a<t;++a){kt.markLine(e);const{tokenStart:l,position:c}=e;kt.trim(e,l,l+10),ot.addUnchecked(n,e.tokenStart,e.tokenEnd),kt.trim(e,l+10,l+20),ot.addUnchecked(r,e.tokenStart,e.tokenEnd),kt.trim(e,l+20,l+30),ot.addUnchecked(i,e.tokenStart,e.tokenEnd),kt.trim(e,l+31,l+34),ot.addUnchecked(o,e.tokenStart,e.tokenEnd),kt.trim(e,l+36,l+39),ot.addUnchecked(s,e.tokenStart,e.tokenEnd),e.position=c}return{count:t,x:Pn(n)(ce.Schema.float),y:Pn(r)(ce.Schema.float),z:Pn(i)(ce.Schema.float),type_symbol:Pn(o)(ce.Schema.str),formal_charge:Pn(s)(ce.Schema.int)}}function ipe(e,t){const n=ot.create(e.data,2*t),r=ot.create(e.data,2*t),i=ot.create(e.data,2*t);for(let o=0;o<t;++o){kt.markLine(e);const{tokenStart:s,position:a}=e;kt.trim(e,s,s+3),ot.addUnchecked(n,e.tokenStart,e.tokenEnd),kt.trim(e,s+3,s+6),ot.addUnchecked(r,e.tokenStart,e.tokenEnd),kt.trim(e,s+6,s+9),ot.addUnchecked(i,e.tokenStart,e.tokenEnd),e.position=a}return{count:t,atomIdxA:Pn(n)(ce.Schema.int),atomIdxB:Pn(r)(ce.Schema.int),order:Pn(i)(ce.Schema.int)}}function Fet(e,t,n){kt.trim(e,t+6,t+9);const r=parseInt(kt.getTokenString(e));for(let i=0;i<r;++i){const o=9+8*i;kt.trim(e,t+o,t+o+4);const s=kt.getTokenString(e);n.atomIdx.push(+s),kt.trim(e,t+o+4,t+o+8);const a=kt.getTokenString(e);n.charge.push(+a)}kt.eatLine(e)}function ope(e){const r={atomIdx:[],charge:[]};for(;e.position<e.length;){const{position:o}=e;kt.trim(e,o+3,o+6);const s=kt.getTokenString(e);if("END"===s)break;"CHG"===(kt.eatLine(e),s)&&Fet(e,o,r)}return{atomIdx:ce.ofIntArray(r.atomIdx),charge:ce.ofIntArray(r.charge)}}function spe(e,t,n){return DH.apply(this,arguments)}function DH(){return DH=le(function*(e,t,n){const{atoms:r,bonds:i,formalCharges:o}=e,s=ce.ofConst("MOL",e.atoms.count,ce.Schema.str),a=ce.ofConst("A",e.atoms.count,ce.Schema.str),l=ce.asArrayColumn(r.type_symbol),c=ce.ofConst(1,r.count,ce.Schema.int),u=new Int32Array(e.atoms.count);if(o.atomIdx.rowCount>0)for(let g=0;g<o.atomIdx.rowCount;g++)u[o.atomIdx.value(g)-1]=o.charge.value(g);else for(let g=0;g<e.atoms.count;g++)u[g]=Net(r.formal_charge.value(g));const d=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:a,auth_atom_id:l,auth_comp_id:s,auth_seq_id:c,Cartn_x:ce.asArrayColumn(r.x,Float32Array),Cartn_y:ce.asArrayColumn(r.y,Float32Array),Cartn_z:ce.asArrayColumn(r.z,Float32Array),id:ce.range(0,r.count-1),label_asym_id:a,label_atom_id:l,label_comp_id:s,label_seq_id:c,label_entity_id:ce.ofConst("1",r.count,ce.Schema.str),occupancy:ce.ofConst(1,r.count,ce.Schema.float),type_symbol:l,pdbx_PDB_model_num:ce.ofConst(1,r.count,ce.Schema.int),pdbx_formal_charge:ce.ofIntArray(u)},r.count),f=new Gh;f.setNames([["MOL","Unknown Entity"]]),f.getEntityId("MOL",0,"A");const p=new qh(c,l);p.setNames([["MOL","Unknown Molecule"]]),p.add("MOL",0);const m=hp({entity:f.getEntityTable(),chem_comp:p.getChemCompTable(),atom_site:d}),h=yield cg(m,t??PH.create(e),n);if(h.frameCount>0){const g=ce.ofIntArray(ce.mapToArray(i.atomIdxA,_=>_-1,Int32Array)),y=ce.ofIntArray(ce.mapToArray(i.atomIdxB,_=>_-1,Int32Array)),v=ce.asArrayColumn(i.order,Int32Array),x=nc.fromData({pairs:{indexA:g,indexB:y,order:v},count:r.count},{maxDistance:1/0});nc.Provider.set(h.representative,x)}return h}),DH.apply(this,arguments)}var PH,$D,RH;function kH(){return kH=le(function*(e,t,n){var r;const i=e.atom_site._rowCount,o=ce.ofConst("MOL",i,ce.Schema.str),s=ce.ofConst("A",i,ce.Schema.str),a=ce.ofConst(1,i,ce.Schema.int),l=function Uet(e){const{cell:t,space_group:n}=e,r=function jet(e){const t=e.it_number.value(0),n=e["name_h-m_full"].value(0).replace("-"," ");return e.it_number.isDefined?t:n}(n),i=Qc.create(r,C.create(t.length_a.value(0),t.length_b.value(0),t.length_c.value(0)),C.scale(C(),C.create(t.angle_alpha.value(0),t.angle_beta.value(0),t.angle_gamma.value(0)),Math.PI/180));return{spacegroup:wd.create(i),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}(e),c=l.spacegroup.cell.fromFractional,{fract_x:u,fract_y:d,fract_z:f}=e.atom_site,p=new Float32Array(i),m=new Float32Array(i),h=new Float32Array(i),g=C();for(let F=0;F<i;++F)C.set(g,u.value(F),d.value(F),f.value(F)),C.transformMat4(g,g,c),p[F]=g[0],m[F]=g[1],h[F]=g[2];const{type_symbol:y,label:v}=e.atom_site;let x,_;if(y.isDefined){const F=new Array(i),R=new Int8Array(i);for(let N=0;N<i;++N){const j=y.value(N),W=j.length;"+"===j[W-1]?(F[N]=j.substring(0,W-2),R[N]=parseInt(j[W-2])):"+"===j[W-2]?(F[N]=j.substring(0,W-2),R[N]=parseInt(j[W-1])):"-"===j[W-1]?(F[N]=j.substring(0,W-2),R[N]=-parseInt(j[W-2])):"-"===j[W-2]?(F[N]=j.substring(0,W-2),R[N]=-parseInt(j[W-1])):(F[N]=j,R[N]=0)}x=ce.ofStringArray(F),_=ce.ofIntArray(R)}else{const F=new Array(i);for(let R=0;R<i;++R)F[R]=eA(v.value(R),"");x=ce.ofStringArray(F),_=ce.Undefined(i,ce.Schema.int)}const w=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:s,auth_atom_id:v,auth_comp_id:o,auth_seq_id:a,Cartn_x:ce.ofFloatArray(p),Cartn_y:ce.ofFloatArray(m),Cartn_z:ce.ofFloatArray(h),id:ce.range(0,i-1),label_asym_id:s,label_atom_id:v,label_comp_id:o,label_seq_id:a,label_entity_id:ce.ofConst("1",i,ce.Schema.str),occupancy:e.atom_site.occupancy.isDefined?e.atom_site.occupancy:ce.ofConst(1,i,ce.Schema.float),type_symbol:x,pdbx_formal_charge:_,pdbx_PDB_model_num:ce.ofConst(1,i,ce.Schema.int),B_iso_or_equiv:e.atom_site.u_iso_or_equiv},i),A=e.chemical.name_common.value(0)||e.chemical.name_systematic.value(0)||e.chemical_formula.sum.value(0),M=new Gh;M.setNames([["MOL",A||"Unknown Entity"]]),M.getEntityId("MOL",0,"A");const E=new qh(a,e.atom_site.type_symbol);E.setNames([["MOL",A||"Unknown Molecule"]]),E.add("MOL",0);const D=hp({entity:M.getEntityTable(),chem_comp:E.getChemCompTable(),atom_site:w}),T=yield cg(D,t,n);if(T.frameCount>0){const F=T.representative;Vs.Provider.set(F,l);const R=e.geom_bond._rowCount;if(R>0){const N={},{label:j}=e.atom_site;for(let ee=0,se=j.rowCount;ee<se;++ee)N[j.value(ee)]=ee;const W=null===(r=t.data.frame.categories.ccdc_geom_bond_type)||void 0===r?void 0:r.getField(""),z=[],$=[],V=[],X=[],H=[],oe=new Set;let te=0;const{atom_site_label_1:K,atom_site_label_2:Q,valence:G,distance:Z}=e.geom_bond;for(let ee=0;ee<R;++ee){const se=N[K.value(ee)],xe=N[Q.value(ee)],re=se<xe?gf(se,xe):gf(xe,se);if(!oe.has(re)){if(oe.add(re),z[te]=se,$[te]=xe,X[te]=Z.value(ee)||-1,W){const ae=W.str(ee);"D"===ae?(V[te]=2,H[te]=1):"A"===ae?(V[te]=1,H[te]=17):(V[te]=1,H[te]=1)}else H[te]=1,V[te]=G.isDefined?G.value(ee):1;te+=1}}nc.Provider.set(F,nc.fromData({pairs:{indexA:ce.ofIntArray(z),indexB:ce.ofIntArray($),order:ce.ofIntArray(V),distance:ce.ofFloatArray(X),flag:ce.ofIntArray(H)},count:i}))}}return T}),kH.apply(this,arguments)}function MH(){return MH=le(function*(e,t){const{atoms:n}=e,r=ce.ofConst("MOL",e.atoms.count,ce.Schema.str),i=ce.ofConst("A",e.atoms.count,ce.Schema.str),o=ce.ofArray({array:ce.mapToArray(n.number,d=>function d6e(e){return mse.has(e)?mse.get(e):Jx("H")}(d)),schema:ce.Schema.Aliased(ce.Schema.str)}),s=ce.ofConst(1,n.count,ce.Schema.int),a=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:i,auth_atom_id:o,auth_comp_id:r,auth_seq_id:s,Cartn_x:ce.asArrayColumn(n.x,Float32Array),Cartn_y:ce.asArrayColumn(n.y,Float32Array),Cartn_z:ce.asArrayColumn(n.z,Float32Array),id:ce.range(0,n.count-1),label_asym_id:i,label_atom_id:o,label_comp_id:r,label_seq_id:s,label_entity_id:ce.ofConst("1",n.count,ce.Schema.str),occupancy:ce.ofConst(1,n.count,ce.Schema.float),type_symbol:o,pdbx_PDB_model_num:ce.ofConst(1,n.count,ce.Schema.int)},n.count),l=new Gh;l.setNames([["MOL","Unknown Entity"]]),l.getEntityId("MOL",0,"A");const c=new qh(s,o);c.setNames([["MOL","Unknown Molecule"]]),c.add("MOL",0);const u=hp({entity:l.getEntityTable(),chem_comp:c.getChemCompTable(),atom_site:a});return yield cg(u,RH.create(e),t)}),MH.apply(this,arguments)}!function(e){e.is=function t(r){return"mol"===r?.kind},e.create=function n(r){return{kind:"mol",name:r.title,data:r}}}(PH||(PH={})),ag.Provider.formatRegistry.add("cifCore",function Vet(e){if(!$D.is(e.sourceData))return;const{atom_site:t,atom_site_aniso:n}=e.sourceData.data.db;return{data:Kr.ofPartialColumns(ag.Schema,{U:n.u},n._rowCount),elementToAnsiotrop:ag.getElementToAnsiotropFromLabel(t.label,n.label)}},function Het(e){return!!$D.is(e.sourceData)&&e.sourceData.data.db.atom_site_aniso.u.isDefined}),function(e){e.is=function t(r){return"cifCore"===r?.kind},e.fromFrame=function n(r,i){return i||(i=Hh.schema.cifCore(r)),{kind:"cifCore",name:i.database_code.depnum_ccdc_archive.value(0)||i.database_code.depnum_ccdc_fiz.value(0)||i.database_code.icsd.value(0)||i.database_code.mdf.value(0)||i.database_code.nbs.value(0)||i.database_code.csd.value(0)||i.database_code.cod.value(0)||i._name,data:{db:i,frame:r}}}}($D||($D={})),function(e){e.is=function t(r){return"cube"===r?.kind},e.create=function n(r){return{kind:"cube",name:r.header.comment1,data:r}}}(RH||(RH={}));const{skipWhitespace:NH,eatValue:ape,markLine:Op,getTokenString:Bp,readLine:lpe}=kt;function Yet(e,t){return{tokenizer:e,molecule:{mol_name:"",num_atoms:0,num_bonds:0,num_subst:0,num_feat:0,num_sets:0,mol_type:"",charge_type:"",status_bits:"",mol_comment:""},runtimeCtx:t}}const cpe=/\s+/g;function Xet(e){const{tokenizer:t,molecule:n}=e;for(;"@<TRIPOS>MOLECULE"!==Bp(t)&&t.position<t.data.length;)Op(t);Op(t),n.mol_name=Bp(t),Op(t);const r=Bp(t).trim().split(cpe);n.num_atoms=parseInt(r[0]),n.num_bonds=parseInt(r[1]),n.num_subst=parseInt(r[2]),n.num_feat=parseInt(r[3]),n.num_sets=parseInt(r[4]),Op(t);const i=Bp(t);if(i.startsWith("@<TRIPOS>"))return;n.mol_type=i,Op(t);const o=Bp(t);if(o.startsWith("@<TRIPOS>"))return;n.charge_type=o,Op(t);const s=Bp(t);if(s.startsWith("@<TRIPOS>"))return;n.status_bits=s,Op(t);const a=Bp(t);a.startsWith("@<TRIPOS>")||(n.mol_comment=a)}function Ket(e){return FH.apply(this,arguments)}function FH(){return FH=le(function*(e){const{tokenizer:t,molecule:n}=e;for(;"@<TRIPOS>ATOM"!==Bp(t)&&t.position<t.data.length;)Op(t);const r=t.position,i=t.lineNumber,a=lpe(t).trim().split(/\s+/g).length,l=ot.create(t.data,2*n.num_atoms),c=ot.create(t.data,2*n.num_atoms),u=ot.create(t.data,2*n.num_atoms),d=ot.create(t.data,2*n.num_atoms),f=ot.create(t.data,2*n.num_atoms),p=ot.create(t.data,2*n.num_atoms),m=ot.create(t.data,2*n.num_atoms),h=ot.create(t.data,2*n.num_atoms),g=ot.create(t.data,2*n.num_atoms),y=ot.create(t.data,2*n.num_atoms),v=ce.Undefined(n.num_atoms,ce.Schema.float),x=ce.Undefined(n.num_atoms,ce.Schema.int),_=ce.Undefined(n.num_atoms,ce.Schema.str);t.position=r,t.lineNumber=i;const{length:w}=t;let A=0;return yield G0(e.runtimeCtx,1e5,void 0,E=>{const D=Math.min(n.num_atoms-A,E);for(let T=0;T<D;T++)for(let F=0;F<a;F++)switch(NH(t),t.tokenStart=t.position,ape(t),F){case 0:ot.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 1:ot.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:ot.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 3:ot.addUnchecked(d,t.tokenStart,t.tokenEnd);break;case 4:ot.addUnchecked(f,t.tokenStart,t.tokenEnd);break;case 5:ot.addUnchecked(p,t.tokenStart,t.tokenEnd);break;case 6:ot.addUnchecked(m,t.tokenStart,t.tokenEnd);break;case 7:ot.addUnchecked(h,t.tokenStart,t.tokenEnd);break;case 8:ot.addUnchecked(g,t.tokenStart,t.tokenEnd);break;case 9:ot.addUnchecked(y,t.tokenStart,t.tokenEnd)}return A+=D,D},E=>E.update({message:"Parsing...",current:t.position,max:w})),{count:n.num_atoms,atom_id:Pn(l)(ce.Schema.int),atom_name:Pn(c)(ce.Schema.str),x:Pn(u)(ce.Schema.float),y:Pn(d)(ce.Schema.float),z:Pn(f)(ce.Schema.float),atom_type:a>5?Pn(p)(ce.Schema.str):_,subst_id:a>6?Pn(m)(ce.Schema.int):x,subst_name:a>7?Pn(h)(ce.Schema.str):_,charge:a>8?Pn(g)(ce.Schema.float):v,status_bit:a>9?Pn(y)(ce.Schema.str):_}}),FH.apply(this,arguments)}function Zet(e){return OH.apply(this,arguments)}function OH(){return OH=le(function*(e){const{tokenizer:t,molecule:n}=e;for(;"@<TRIPOS>BOND"!==Bp(t)&&t.position<t.data.length;)Op(t);const r=t.position,i=t.lineNumber,a=lpe(t).trim().split(/\s+/g).length,l=ot.create(t.data,2*n.num_bonds),c=ot.create(t.data,2*n.num_bonds),u=ot.create(t.data,2*n.num_bonds),d=ot.create(t.data,2*n.num_bonds),f=ot.create(t.data,2*n.num_bonds);t.position=r,t.lineNumber=i;const{length:p}=t;let m=0;return yield G0(e.runtimeCtx,1e5,void 0,g=>{const y=Math.min(n.num_bonds-m,g);for(let v=0;v<y;v++)for(let x=0;x<a;x++)switch(NH(t),t.tokenStart=t.position,ape(t),x){case 0:ot.addUnchecked(l,t.tokenStart,t.tokenEnd);break;case 1:ot.addUnchecked(c,t.tokenStart,t.tokenEnd);break;case 2:ot.addUnchecked(u,t.tokenStart,t.tokenEnd);break;case 3:ot.addUnchecked(d,t.tokenStart,t.tokenEnd);break;default:ot.addUnchecked(f,t.tokenStart,t.tokenEnd)}return m+=y,y},g=>g.update({message:"Parsing...",current:t.position,max:p})),{count:n.num_bonds,bond_id:Pn(l)(ce.Schema.int),origin_atom_id:Pn(c)(ce.Schema.int),target_atom_id:Pn(u)(ce.Schema.int),bond_type:Pn(d)(ce.Schema.str),status_bits:a>4?Pn(f)(ce.Schema.str):ce.Undefined(n.num_bonds,ce.Schema.str)}}),OH.apply(this,arguments)}function Qet(e){const{tokenizer:t}=e;for(;t.position<t.data.length;){const r=Bp(t);if("@<TRIPOS>MOLECULE"===r)return;if("@<TRIPOS>CRYSIN"===r)break;Op(t)}if(t.position>=t.data.length)return;Op(t);const n=Bp(t).trim().split(cpe);return{a:parseFloat(n[0]),b:parseFloat(n[1]),c:parseFloat(n[2]),alpha:parseFloat(n[3]),beta:parseFloat(n[4]),gamma:parseFloat(n[5]),spaceGroup:parseInt(n[6],10),setting:parseInt(n[7],10)}}function BH(){return BH=le(function*(e,t,n){const r=kt(t);e.update({message:"Parsing...",current:0,max:t.length});const i=[];for(;r.position<t.length;){const s=Yet(r,e);Xet(s);const a=yield Ket(s),l=yield Zet(s),c=Qet(s);for(i.push({molecule:s.molecule,atoms:a,bonds:l,crysin:c}),NH(r);"@<TRIPOS>MOLECULE"!==Bp(r)&&r.position<r.data.length;)Op(r)}return qi.success({name:n,structures:i})}),BH.apply(this,arguments)}function LH(){return LH=le(function*(e,t){const n=[];for(let r=0,i=e.structures.length;r<i;++r){const{molecule:o,atoms:s,bonds:a,crysin:l}=e.structures[r],c=ce.ofConst("A",s.count,ce.Schema.str),u=new Array(s.count);let d=!1;for(let y=0;y<s.count;++y)if(s.atom_type.value(y).includes(".")){d=!0;break}for(let y=0;y<s.count;++y)u[y]=d?s.atom_type.value(y).split(".")[0].toUpperCase():eA(s.atom_name.value(y),s.subst_name.value(y));const f=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:c,auth_atom_id:ce.asArrayColumn(s.atom_name),auth_comp_id:s.subst_name,auth_seq_id:s.subst_id,Cartn_x:ce.asArrayColumn(s.x,Float32Array),Cartn_y:ce.asArrayColumn(s.y,Float32Array),Cartn_z:ce.asArrayColumn(s.z,Float32Array),id:ce.asArrayColumn(s.atom_id),label_asym_id:c,label_atom_id:ce.asArrayColumn(s.atom_name),label_comp_id:s.subst_name,label_seq_id:s.subst_id,label_entity_id:ce.ofConst("1",s.count,ce.Schema.str),occupancy:ce.ofConst(1,s.count,ce.Schema.float),type_symbol:ce.ofStringArray(u),pdbx_PDB_model_num:ce.ofConst(r,s.count,ce.Schema.int)},s.count),p=new Gh;p.setNames([["MOL",o.mol_name||"Unknown Entity"]]),p.getEntityId("MOL",0,"A");const m=new qh(s.subst_id,s.atom_name);for(let y=0,v=s.subst_name.rowCount;y<v;++y)m.add(s.subst_name.value(y),y);const h=hp({entity:p.getEntityTable(),chem_comp:m.getChemCompTable(),atom_site:f}),g=yield cg(h,jH.create(e),t);if(g.frameCount>0){const y=ce.ofIntArray(ce.mapToArray(a.origin_atom_id,E=>E-1,Int32Array)),v=ce.ofIntArray(ce.mapToArray(a.target_atom_id,E=>E-1,Int32Array)),x=a.bond_id,_=ce.ofIntArray(ce.mapToArray(a.bond_type,E=>{switch(E){case"ar":case"am":case"un":return 1;case"du":case"nc":return 0;default:return parseInt(E)}},Int8Array)),w=ce.ofIntArray(ce.mapToArray(a.bond_type,E=>{switch(E){case"ar":case"am":return 17;case"du":case"nc":return 0;default:return 1}},Int8Array)),A=nc.fromData({pairs:{key:x,indexA:y,indexB:v,order:_,flag:w},count:s.count},{maxDistance:l?-1:1/0}),M=g.representative;if(nc.Provider.set(M,A),tA.Provider.set(M,{data:s.charge,type:o.charge_type}),l){const E=ntt(l);E&&Vs.Provider.set(M,E)}n.push(M)}}return new ay(n)}),LH.apply(this,arguments)}function ntt(e){if(1!==e.setting)return;const t=Qc.create(e.spaceGroup,C.create(e.a,e.b,e.c),C.scale(C(),C.create(e.alpha,e.beta,e.gamma),Math.PI/180));return{spacegroup:wd.create(t),assemblies:[],isNonStandardCrystalFrame:!1,ncsOperators:[]}}var jH;!function(e){e.is=function t(r){return"mol2"===r?.kind},e.create=function n(r){return{kind:"mol2",name:r.name,data:r}}}(jH||(jH={}));const aA=new Uint32Array([0,0,0,0,0,0,0,0,0,8,10,12,16,20,25,32,40,50,64,80,101,128,161,203,256,322,406,512,645,812,1024,1290,1625,2048,2580,3250,4096,5060,6501,8192,10321,13003,16384,20642,26007,32768,41285,52015,65536,82570,104031,131072,165140,208063,262144,330280,416127,524287,660561,832255,1048576,1321122,1664510,2097152,2642245,3329021,4194304,5284491,6658042,8388607,10568983,13316085,16777216]),UH=9;var Md,VH;function itt(){throw new Error("(xdrfile error) Undefined error.")}function zH(){return zH=le(function*(e,t){const n=new DataView(t.buffer,t.byteOffset),r={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},i=r.frames,o=r.boxes,s=r.times,a=[0,0,0,0,0,0],l=[0,0,0],c=[0,0,0],u=[0,0,0],d=[.1,.1,.1],f=[.1,.1,.1];let p=0;const m=Md.buf;for(;;){let h;const g=n.getInt32(p+4);p+=12,s.push(n.getFloat32(p)),p+=4;const y=new Float32Array(9);for(let v=0;v<9;++v)y[v]=10*n.getFloat32(p),p+=4;if(o.push(y),g<=9){h={count:g/3,x:new Float32Array(g/3),y:new Float32Array(g/3),z:new Float32Array(g/3)};for(let v=0;v<g/3;++v)h.x[v]=n.getFloat32(p),h.y[v]=n.getFloat32(p),h.z[v]=n.getFloat32(p),p+=4}else{m[0]=m[1]=m[2]=0,l[0]=l[1]=l[2]=0,u[0]=u[1]=u[2]=0,c[0]=c[1]=c[2]=0,d[0]=d[1]=d[2]=0,f[0]=f[1]=f[2]=0,h={count:g,x:new Float32Array(g),y:new Float32Array(g),z:new Float32Array(g)};let v=0;const x=n.getInt32(p);p+=4;const _=n.getFloat32(p);let w;p+=4,a[0]=n.getInt32(p),a[1]=n.getInt32(p+4),a[2]=n.getInt32(p+8),a[3]=n.getInt32(p+12),a[4]=n.getInt32(p+16),a[5]=n.getInt32(p+20),l[0]=a[3]-a[0]+1,l[1]=a[4]-a[1]+1,l[2]=a[5]-a[2]+1,p+=24,(l[0]|l[1]|l[2])>16777215?(c[0]=Md.sizeOfInt(l[0]),c[1]=Md.sizeOfInt(l[1]),c[2]=Md.sizeOfInt(l[2]),w=0):w=Md.sizeOfInts(3,l);let A=n.getInt32(p);p+=4;let M=A-1;M=UH>M?UH:M;let E=aA[M]/2|0,D=aA[A]/2|0;u[0]=u[1]=u[2]=aA[A];const T=4*Math.ceil(n.getInt32(p)/4);p+=4;const F=1/_;let R=0,N=0;for(d[0]=d[1]=d[2]=0;N<x;){0===w?(d[0]=Md.decodeBits(t,p,c[0]),d[1]=Md.decodeBits(t,p,c[1]),d[2]=Md.decodeBits(t,p,c[2])):Md.decodeInts(t,p,w,l,d),N++,d[0]+=a[0],d[1]+=a[1],d[2]+=a[2],f[0]=d[0],f[1]=d[1],f[2]=d[2];let W=0;if(1===Md.decodeBits(t,p,1)&&(R=Md.decodeBits(t,p,5),W=R%3,R-=W,W--),R>0){d[0]=d[1]=d[2]=0;for(let z=0;z<R;z+=3){if(Md.decodeInts(t,p,A,u,d),N++,d[0]+=f[0]-D,d[1]+=f[1]-D,d[2]+=f[2]-D,0===z){let $=d[0];d[0]=f[0],f[0]=$,$=d[1],d[1]=f[1],f[1]=$,$=d[2],d[2]=f[2],f[2]=$,h.x[v]=f[0]*F,h.y[v]=f[1]*F,h.z[v]=f[2]*F,v++}else f[0]=d[0],f[1]=d[1],f[2]=d[2];h.x[v]=d[0]*F,h.y[v]=d[1]*F,h.z[v]=d[2]*F,v++}}else h.x[v]=d[0]*F,h.y[v]=d[1]*F,h.z[v]=d[2]*F,v++;A+=W,W<0?(D=E,E=A>UH?aA[A-1]/2|0:0):W>0&&(E=D,D=aA[A]/2|0),u[0]=u[1]=u[2]=aA[A],(0===u[0]||0===u[1]||0===u[2])&&itt()}p+=T}for(let v=0;v<g;v++)h.x[v]*=10,h.y[v]*=10,h.z[v]*=10;if(i.push(h),e.shouldUpdate&&(yield e.update({current:p,max:t.length})),p>=t.length)break}return s.length>=1&&(r.timeOffset=s[0]),s.length>=2&&(r.deltaTime=s[1]-s[0]),r}),zH.apply(this,arguments)}function ltt(e){let t=e.position>=e.data.length-1?0:+kt.readLine(e);isNaN(t)&&(t=0);const n=kt.readLine(e),r=new Float64Array(t),i=new Float64Array(t),o=new Float64Array(t),s=new Array(t);for(let a=0;a<t;++a){const c=kt.readLineTrim(e).split(/\s+/g);s[a]=c[0],r[a]=+c[1],i[a]=+c[2],o[a]=+c[3]}return{count:t,comment:n,x:ce.ofFloatArray(r),y:ce.ofFloatArray(i),z:ce.ofFloatArray(o),type_symbol:ce.ofStringArray(s)}}function By(e){kt.skipWhitespace(e),kt.eatValue(e)}function Ly(e,t){const{position:n}=e;kt.skipWhitespace(e),kt.eatValue(e),kt.trim(e,n,e.position),ot.addUnchecked(t,e.tokenStart,e.tokenEnd)}!function(e){e.sizeOfInt=function t(u){let d=1,f=0;for(;u>=d&&f<32;)f++,d<<=1;return f};const n=new Uint8Array(32);e.sizeOfInts=function r(u,d){let f=1,p=0;n[0]=1;for(let h=0;h<u;h++){let g,y=0;for(g=0;g<f;g++)y+=n[g]*d[h],n[g]=255&y,y>>=8;for(;0!==y;)n[g++]=255&y,y>>=8;f=g}let m=1;for(f--;n[f]>=m;)p++,m*=2;return p+8*f};const i=new ArrayBuffer(24);e.buf=new Int32Array(i);const o=new Uint32Array(i);function s(u,d,f){let p=f;const m=(1<<p)-1;let h=o[1],g=o[2],y=e.buf[0],v=0;for(;p>=8;)g=g<<8|u[d+y++],v|=g>>h<<p-8,p-=8;return p>0&&(h<p&&(h+=8,g=g<<8|u[d+y++]),h-=p,v|=g>>h&(1<<p)-1),v&=m,e.buf[0]=y,e.buf[1]=h,e.buf[2]=g,v}function a(u,d){let f=o[2];const p=e.buf[0];return f=f<<8|u[d+p],e.buf[0]=p+1,e.buf[2]=f,f>>o[1]&255}e.decodeBits=s;const l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];e.decodeInts=function c(u,d,f,p,m){let h=f,g=0;for(l[0]=0,l[1]=0,l[2]=0,l[3]=0;h>8;)l[g++]=a(u,d),h-=8;h>0&&(l[g++]=s(u,d,h));for(let y=2;y>0;y--){let v=0;const x=p[y];for(let _=g-1;_>=0;_--){v=v<<8|l[_];const w=v/x|0;l[_]=w,v-=w*x}m[y]=v}m[0]=l[0]|l[1]<<8|l[2]<<16|l[3]<<24}}(Md||(Md={})),function(e){e.is=function t(r){return"xyz"===r?.kind},e.create=function n(r){return{kind:"xyz",name:"xyz",data:r}}}(VH||(VH={}));const HH="$$$$";function vtt(e){const t=kt.readLine(e).trim(),n=kt.readLine(e).trim(),r=kt.readLine(e).trim(),i=kt.readLine(e),o=function ptt(e){return e.trim().endsWith("V3000")}(i),{atomCount:s,bondCount:a}=o?function htt(e){const t=ot.create(e.data,1),n=ot.create(e.data,1);return kt.eatLine(e),By(e),By(e),By(e),Ly(e,t),Ly(e,n),kt.eatLine(e),{atomCount:Pn(t)(ce.Schema.int).value(0),bondCount:Pn(n)(ce.Schema.int).value(0)}}(e):function btt(e){return{atomCount:+e.substr(0,3),bondCount:+e.substr(3,3)}}(i);if(Number.isNaN(s)||Number.isNaN(a)){for(;e.position<e.length&&!kt.readLine(e).startsWith(HH););return}const l={atomIdx:ce.ofConst(0,s,ce.Schema.int),charge:ce.ofConst(0,s,ce.Schema.int)},c=o?function mtt(e,t){const n=ot.create(e.data,2*t),r=ot.create(e.data,2*t),i=ot.create(e.data,2*t),o=ot.create(e.data,2*t);for(let s=0;s<t;++s){kt.markLine(e),By(e),By(e),By(e);const{position:a}=e;Ly(e,o),Ly(e,n),Ly(e,r),Ly(e,i),e.position=a}return kt.eatLine(e),kt.eatLine(e),{count:t,x:Pn(n)(ce.Schema.float),y:Pn(r)(ce.Schema.float),z:Pn(i)(ce.Schema.float),type_symbol:Pn(o)(ce.Schema.str),formal_charge:ce.ofConst(0,t,ce.Schema.int)}}(e,s):rpe(e,s),u=o?function gtt(e,t){const n=ot.create(e.data,2*t),r=ot.create(e.data,2*t),i=ot.create(e.data,2*t);for(let o=0;o<t;++o){kt.markLine(e),By(e),By(e),By(e);const{position:s}=e;Ly(e,i),Ly(e,n),Ly(e,r),e.position=s}return kt.eatLine(e),kt.eatLine(e),{count:t,atomIdxA:Pn(n)(ce.Schema.float),atomIdxB:Pn(r)(ce.Schema.float),order:Pn(i)(ce.Schema.float)}}(e,a):ipe(e,a),d=o?l:ope(e),f=function ytt(e){const t=ot.create(e.data,32),n=ot.create(e.data,32);for(;e.position<e.length;){const r=kt.readLine(e);if(r.startsWith(HH))break;if(r&&r.startsWith("> ")){ot.add(t,e.tokenStart+2,e.tokenEnd),kt.markLine(e);const i=e.tokenStart;let o=e.tokenEnd,s=!1;for(;e.position<e.length;){const a=kt.readLine(e);if(!a||a.startsWith(HH)||a.startsWith("> ")){ot.add(n,i,o),s=!0;break}o=e.tokenEnd}s||ot.add(n,i,o)}}return{dataHeader:Pn(t)(ce.Schema.str),data:Pn(n)(ce.Schema.str)}}(e);return{molFile:{title:t,program:n,comment:r,atoms:c,bonds:u,formalCharges:d},dataItems:f}}var GH;function Stt(e){return Ke.create("Parse SDF",t=>spe(e.molFile,GH.create(e),t))}function qH(){return qH=le(function*(e){const t=new DataView(e.buffer),n={frames:[],boxes:[],times:[],timeOffset:0,deltaTime:0},r=n.frames,i=n.boxes,o=n.times;let s=0;for(;;){s+=8;const a=t.getInt32(s);s+=4,s+=a;const l=t.getInt32(s+8),c=t.getInt32(s+12),u=t.getInt32(s+16),d=t.getInt32(s+28),f=t.getInt32(s+32),p=t.getInt32(s+36),m=t.getInt32(s+40);s+=52;const h=l/9,g=3*m;if(o.push(8===h?t.getFloat64(s):t.getFloat32(s)),s+=2*h,l){const y=new Float32Array(9);if(8===h)for(let v=0;v<9;++v)y[v]=10*t.getFloat64(s),s+=8;else for(let v=0;v<9;++v)y[v]=10*t.getFloat32(s),s+=4;i.push(y)}if(s+=c,s+=u,d){const y=new Float32Array(m),v=new Float32Array(m),x=new Float32Array(m);if(8===h)for(let _=0;_<m;++_)y[_]=10*t.getFloat64(s),v[_]=10*t.getFloat64(s+8),x[_]=10*t.getFloat64(s+16),s+=24;else{const _=new Uint32Array(e.buffer,s,g);for(let A=0;A<g;++A){const M=_[A];_[A]=(255&M)<<24|(65280&M)<<8|M>>8&65280|M>>24&255}const w=new Float32Array(e.buffer,s,g);for(let A=0;A<m;++A)y[A]=10*w[3*A],v[A]=10*w[3*A+1],x[A]=10*w[3*A+2],s+=12}r.push({count:m,x:y,y:v,z:x})}if(s+=f,s+=p,s>=e.byteLength)break}return o.length>=1&&(n.timeOffset=o[0]),o.length>=2&&(n.deltaTime=o[1]-o[0]),n}),qH.apply(this,arguments)}!function(e){e.is=function t(r){return"sdf"===r?.kind},e.create=function n(r){return{kind:"sdf",name:r.molFile.title,data:r}}}(GH||(GH={}));const WH=[];class Ett{constructor(t,n={}){this._mark=0,this._marks=[],this.offset=0,this.littleEndian=!0;let r=!1;void 0===t&&(t=8192),"number"==typeof t?t=new ArrayBuffer(t):r=!0;const i=n.offset?n.offset>>>0:0,o=t.byteLength-i;let s=i;t instanceof ArrayBuffer||(t.byteLength!==t.buffer.byteLength&&(s=t.byteOffset+i),t=t.buffer),this._lastWrittenByte=r?o:0,this.buffer=t,this.length=o,this.byteLength=o,this.byteOffset=s,this._data=new DataView(this.buffer,s,o)}available(t=1){return this.offset+t<=this.length}isLittleEndian(){return this.littleEndian}setLittleEndian(){return this.littleEndian=!0,this}isBigEndian(){return!this.littleEndian}setBigEndian(){return this.littleEndian=!1,this}skip(t){return void 0===t&&(t=1),this.offset+=t,this}seek(t){return this.offset=t,this}mark(){return this._mark=this.offset,this}reset(){return this.offset=this._mark,this}pushMark(){return this._marks.push(this.offset),this}popMark(){const t=this._marks.pop();if(void 0===t)throw new Error("Mark stack empty");return this.seek(t),this}rewind(){return this.offset=0,this}ensureAvailable(t){if(void 0===t&&(t=1),!this.available(t)){const r=2*(this.offset+t),i=new Uint8Array(r);i.set(new Uint8Array(this.buffer)),this.buffer=i.buffer,this.length=this.byteLength=r,this._data=new DataView(this.buffer)}return this}readBoolean(){return 0!==this.readUint8()}readInt8(){return this._data.getInt8(this.offset++)}readUint8(){return this._data.getUint8(this.offset++)}readByte(){return this.readUint8()}readBytes(t){void 0===t&&(t=1);const n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=this.readByte();return n}readInt16(){const t=this._data.getInt16(this.offset,this.littleEndian);return this.offset+=2,t}readUint16(){const t=this._data.getUint16(this.offset,this.littleEndian);return this.offset+=2,t}readInt32(){const t=this._data.getInt32(this.offset,this.littleEndian);return this.offset+=4,t}readUint32(){const t=this._data.getUint32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat32(){const t=this._data.getFloat32(this.offset,this.littleEndian);return this.offset+=4,t}readFloat64(){const t=this._data.getFloat64(this.offset,this.littleEndian);return this.offset+=8,t}readChar(){return String.fromCharCode(this.readInt8())}readChars(t=1){WH.length=t;for(let n=0;n<t;n++)WH[n]=this.readChar();return WH.join("")}writeBoolean(t=!1){return this.writeUint8(t?255:0),this}writeInt8(t){return this.ensureAvailable(1),this._data.setInt8(this.offset++,t),this._updateLastWrittenByte(),this}writeUint8(t){return this.ensureAvailable(1),this._data.setUint8(this.offset++,t),this._updateLastWrittenByte(),this}writeByte(t){return this.writeUint8(t)}writeBytes(t){this.ensureAvailable(t.length);for(let n=0;n<t.length;n++)this._data.setUint8(this.offset++,t[n]);return this._updateLastWrittenByte(),this}writeInt16(t){return this.ensureAvailable(2),this._data.setInt16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeUint16(t){return this.ensureAvailable(2),this._data.setUint16(this.offset,t,this.littleEndian),this.offset+=2,this._updateLastWrittenByte(),this}writeInt32(t){return this.ensureAvailable(4),this._data.setInt32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeUint32(t){return this.ensureAvailable(4),this._data.setUint32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat32(t){return this.ensureAvailable(4),this._data.setFloat32(this.offset,t,this.littleEndian),this.offset+=4,this._updateLastWrittenByte(),this}writeFloat64(t){return this.ensureAvailable(8),this._data.setFloat64(this.offset,t,this.littleEndian),this.offset+=8,this._updateLastWrittenByte(),this}writeChar(t){return this.writeUint8(t.charCodeAt(0))}writeChars(t){for(let n=0;n<t.length;n++)this.writeUint8(t.charCodeAt(n));return this}toArray(){return new Uint8Array(this.buffer,this.byteOffset,this._lastWrittenByte)}_updateLastWrittenByte(){this.offset>this._lastWrittenByte&&(this._lastWrittenByte=this.offset)}}function Lp(e,t){if(e)throw new TypeError("Not a valid NetCDF v3.x file: "+t)}function upe(e){e.offset%4!=0&&e.skip(4-e.offset%4)}function $H(e){const t=e.readUint32(),n=e.readChars(t);return upe(e),n}const Xs={BYTE:1,CHAR:2,SHORT:3,INT:4,FLOAT:5,DOUBLE:6};function dpe(e){switch(Number(e)){case Xs.BYTE:return"byte";case Xs.CHAR:return"char";case Xs.SHORT:return"short";case Xs.INT:return"int";case Xs.FLOAT:return"float";case Xs.DOUBLE:return"double";default:return"undefined"}}function fpe(e){switch(Number(e)){case Xs.BYTE:case Xs.CHAR:return 1;case Xs.SHORT:return 2;case Xs.INT:case Xs.FLOAT:return 4;case Xs.DOUBLE:return 8;default:return-1}}function ppe(e){switch(String(e)){case"byte":return Xs.BYTE;case"char":return Xs.CHAR;case"short":return Xs.SHORT;case"int":return Xs.INT;case"float":return Xs.FLOAT;case"double":return Xs.DOUBLE;default:return-1}}function HN(e,t){if(1!==e){const n=new Array(e);for(let r=0;r<e;r++)n[r]=t();return n}return t()}function YH(e,t,n){switch(t){case Xs.BYTE:return e.readBytes(n);case Xs.CHAR:return function Ttt(e){return 0===e.charCodeAt(e.length-1)?e.substring(0,e.length-1):e}(e.readChars(n));case Xs.SHORT:return HN(n,e.readInt16.bind(e));case Xs.INT:return HN(n,e.readInt32.bind(e));case Xs.FLOAT:return HN(n,e.readFloat32.bind(e));case Xs.DOUBLE:return HN(n,e.readFloat64.bind(e));default:return void Lp(!0,"non valid type "+t)}}const lA=0,Rtt=12;function hpe(e){let t;const n=e.readUint32();if(n===lA)return Lp(e.readUint32()!==lA,"wrong empty tag for list of attributes"),[];{Lp(n!==Rtt,"wrong tag for list of attributes");const r=e.readUint32();t=new Array(r);for(let i=0;i<r;i++){const o=$H(e),s=e.readUint32();Lp(s<1||s>6,"non valid type "+s);const a=e.readUint32(),l=YH(e,s,a);upe(e),t[i]={name:o,type:dpe(s),value:l}}}return t}class Btt{constructor(t){const n=new Ett(t);n.setBigEndian(),Lp("CDF"!==n.readChars(3),"should start with CDF");const r=n.readByte();Lp(r>2,"unknown version"),this.header=function Ntt(e,t){const n={recordDimension:{length:e.readUint32()}};n.version=t;const r=function Ftt(e){let t,n,r;const i=e.readUint32();if(i===lA)return Lp(e.readUint32()!==lA,"wrong empty tag for list of dimensions"),[];{Lp(10!==i,"wrong tag for list of dimensions");const o=e.readUint32();t=new Array(o);for(let s=0;s<o;s++){const a=$H(e),l=e.readUint32();0===l&&(n=s,r=a),t[s]={name:a,size:l}}return{dimensions:t,recordId:n,recordName:r}}}(e);n.recordDimension.id=r.recordId,n.recordDimension.name=r.recordName,n.dimensions=r.dimensions,n.globalAttributes=hpe(e);const i=function Ott(e,t,n){const r=e.readUint32();let o,i=0;if(r===lA)return Lp(e.readUint32()!==lA,"wrong empty tag for list of variables"),[];{Lp(11!==r,"wrong tag for list of variables");const s=e.readUint32();o=new Array(s);for(let a=0;a<s;a++){const l=$H(e),c=e.readUint32(),u=new Array(c);for(let h=0;h<c;h++)u[h]=e.readUint32();const d=hpe(e),f=e.readUint32();Lp(f<1&&f>6,"non valid type "+f);const p=e.readUint32();let m=e.readUint32();2===n&&(Lp(m>0,"offsets larger than 4GB not supported"),m=e.readUint32()),u[0]===t&&(i+=p),o[a]={name:l,dimensions:u,attributes:d,type:dpe(f),size:p,offset:m,record:u[0]===t}}}return{variables:o,recordStep:i}}(e,r.recordId,t);return n.variables=i.variables,n.recordDimension.recordStep=i.recordStep,n}(n,r),this.buffer=n}get version(){return 1===this.header.version?"classic format":"64-bit offset format"}get recordDimension(){return this.header.recordDimension}get dimensions(){return this.header.dimensions}get globalAttributes(){return this.header.globalAttributes}get variables(){return this.header.variables}hasDataVariable(t){return this.header.variables&&-1!==this.header.variables.findIndex(n=>n.name===t)}getDataVariable(t){var n;let r;if(r="string"==typeof t?null===(n=this.header.variables)||void 0===n?void 0:n.find(i=>i.name===t):t,void 0===r)throw new Error("variable not found");return this.buffer.seek(r.offset),r.record?function Ptt(e,t,n){const r=ppe(t.type),i=t.size?t.size/fpe(r):1,o=n.length,s=new Array(o),a=n.recordStep;for(let l=0;l<o;l++){const c=e.offset;s[l]=YH(e,r,i),e.seek(c+a)}return s}(this.buffer,r,this.header.recordDimension):function Dtt(e,t){const n=ppe(t.type),r=t.size/fpe(n),i=new Array(r);for(let o=0;o<r;o++)i[o]=YH(e,n,1);return i}(this.buffer,r)}}function XH(){return XH=le(function*(e){const t=new Btt(e),n={coordinates:[],time:[],timeOffset:0,deltaTime:1};for(const r of t.getDataVariable("coordinates"))n.coordinates.push(r);if(t.hasDataVariable("velocities")){const r=[];for(const i of t.getDataVariable("velocities"))r.push(i);n.velocities=r}if(t.hasDataVariable("forces")){const r=[];for(const i of t.getDataVariable("forces"))r.push(i);n.forces=r}if(t.hasDataVariable("cell_lengths")){const r=[];for(const i of t.getDataVariable("cell_lengths"))r.push(i);n.cell_lengths=r}if(t.hasDataVariable("cell_angles")){const r=[];for(const i of t.getDataVariable("cell_angles"))r.push(i);n.cell_angles=r}if(t.hasDataVariable("time")){const r=[];for(const i of t.getDataVariable("time"))r.push(i);n.time=r}return n.time&&(n.time.length>=1&&(n.timeOffset=n.time[0]),n.time.length>=2&&(n.deltaTime=n.time[1]-n.time[0])),n}),XH.apply(this,arguments)}var KH,ZH;!function(e){e.is=function t(r){return"prmtop"===r?.kind},e.fromPrmtop=function n(r){return{kind:"prmtop",name:r.title.join(" ")||"PRMTOP",data:r}}}(KH||(KH={})),function(e){e.is=function t(r){return"top"===r?.kind},e.fromTop=function n(r){return{kind:"top",name:r.system||"TOP",data:r}}}(ZH||(ZH={}));const Wtt=nn.BuiltIn({name:"coordinates-from-dcd",display:{name:"Parse DCD",description:"Parse DCD binary data."},from:[Se.Data.Binary],to:Se.Molecule.Coordinates})({apply:({a:e})=>Ke.create("Parse DCD",function(){var t=le(function*(n){const r=yield function aWe(e){return Ke.create("Parse DCD",function(){var t=le(function*(n){try{const r=function sWe(e){const t=new DataView(e.buffer),n=Object.create(null),r=[];let i=0;const o=new Int32Array(e.buffer,0,23),s=o[0]!==t.getInt32(0);if(84!==o[0]){const h=e.byteLength;for(let g=0;g<h;g+=4)t.setFloat32(g,t.getFloat32(g),!0)}if(84!==o[0])throw new Error("dcd bad format, header block start");if("CORD"!==String.fromCharCode(t.getUint8(4),t.getUint8(5),t.getUint8(6),t.getUint8(7)))throw new Error("dcd bad format, format string");let l=!1,c=!1,u=!1;if(0!==o[22]&&(l=!0,0!==o[12]&&(c=!0),1===o[13]&&(u=!0)),n.NSET=o[2],n.ISTART=o[3],n.NSAVC=o[4],n.NAMNF=o[10],n.DELTA=l?t.getFloat32(44,s):t.getFloat64(44,s),84!==o[22])throw new Error("dcd bad format, header block end");i=i+84+8;const d=t.getInt32(i,s),f=i+1;if((d-4)%80!=0)throw new Error("dcd bad format, title block start");if(n.TITLE=function G6e(e){if(e.length>28672){const t=[];for(let n=0;n<e.length;n+=28672)t.push(String.fromCharCode.apply(null,e.subarray(n,n+28672)));return t.join("")}return String.fromCharCode.apply(null,e)}(e.subarray(f,d)),t.getInt32(f+d+4-1,s)!==d)throw new Error("dcd bad format, title block end");if(i=i+d+8,4!==t.getInt32(i,s))throw new Error("dcd bad format, natom block start");if(n.NATOM=t.getInt32(i+4,s),4!==t.getInt32(i+8,s))throw new Error("dcd bad format, natom block end");if(i=i+4+8,n.NAMNF>0)throw new Error("dcd format with fixed atoms unsupported, aborting");const p=n.NATOM,m=4*p;for(let h=0,g=n.NSET;h<g;++h){const y=Object.create(null);y.elementCount=p,c&&(i+=4,y.cell=[t.getFloat64(i,s),t.getFloat64(i+1,s),t.getFloat64(i+16,s),t.getFloat64(i+24,s),t.getFloat64(i+32,s),t.getFloat64(i+40,s)],i+=48,i+=4);for(let v=0;v<3;++v){if(t.getInt32(i,s)!==m)throw new Error(`dcd bad format, coord block start: ${h}, ${v}`);i+=4;const x=new Float32Array(e.buffer,i,p);if(0===v?y.x=x:1===v?y.y=x:y.z=x,i+=m,t.getInt32(i,s)!==m)throw new Error(`dcd bad format, coord block end: ${h}, ${v}`);i+=4}u&&(i+=4+t.getInt32(i,s)+4),r.push(y)}return{header:n,frames:r}}(e);return qi.success(r)}catch(r){return qi.error(r)}});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function lQe(e){return Ke.create("Parse DCD",function(){var t=le(function*(n){yield n.update("Converting to coordinates");const{header:r}=e,i=r.DELTA?_d(20.45482949774598*r.DELTA,"ps"):_d(1,"step"),o=_d(r.ISTART>=1?(r.ISTART-1)*i.value:0,i.unit),s=[];for(let a=0,l=e.frames.length;a<l;++a){const c=e.frames[a],u={elementCount:c.elementCount,time:_d(o.value+i.value*a,i.unit),x:c.x,y:c.y,z:c.z,xyzOrdering:{isIdentity:!0}};if(c.cell){const d=c.cell;u.cell=d[1]>=-1&&d[1]<=1&&d[3]>=-1&&d[3]<=1&&d[4]>=-1&&d[4]<=1?Ry.create(C.create(d[0],d[2],d[5]),C.create(Xr(90-90*Math.asin(d[1])/u3),Xr(90-90*Math.asin(d[3])/u3),Xr(90-90*Math.asin(d[4])/u3))):d[0]<0||d[1]<0||d[2]<0||d[3]<0||d[4]<0||d[5]<0||d[3]>180||d[4]>180||d[5]>180?Ry.fromBasis(C.create(d[0],d[1],d[3]),C.create(d[1],d[2],d[4]),C.create(d[3],d[4],d[5])):Ry.create(C.create(d[0],d[2],d[5]),C.create(Xr(Do(d[1],0,wi)?90:d[1]),Xr(Do(d[3],0,wi)?90:d[3]),Xr(Do(d[4],0,wi)?90:d[4])))}s.push(u)}return Wx.create(s,i,o)});return function(n){return t.apply(this,arguments)}}())}(r.result).runInContext(n);return new Se.Molecule.Coordinates(i,{label:e.label,description:"Coordinates"})});return function(n){return t.apply(this,arguments)}}())}),$tt=nn.BuiltIn({name:"coordinates-from-xtc",display:{name:"Parse XTC",description:"Parse XTC binary data."},from:[Se.Data.Binary],to:Se.Molecule.Coordinates})({apply:({a:e})=>Ke.create("Parse XTC",function(){var t=le(function*(n){const r=yield function stt(e){return Ke.create("Parse XTC",function(){var t=le(function*(n){try{n.update({canAbort:!0,message:"Parsing trajectory..."});const r=yield function ott(e,t){return zH.apply(this,arguments)}(n,e);return qi.success(r)}catch(r){return qi.error(""+r)}});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function att(e){return Ke.create("Parse XTC",function(){var t=le(function*(n){yield n.update("Converting to coordinates");const r=_d(e.deltaTime,"step"),i=_d(e.timeOffset,r.unit),o=[];for(let s=0,a=e.frames.length;s<a;++s){const l=e.boxes[s],c=C.fromArray(C(),l,0),u=C.fromArray(C(),l,3),d=C.fromArray(C(),l,6);o.push({elementCount:e.frames[s].count,cell:Ry.fromBasis(c,u,d),x:e.frames[s].x,y:e.frames[s].y,z:e.frames[s].z,xyzOrdering:{isIdentity:!0},time:_d(i.value+r.value*s,r.unit)})}return Wx.create(o,r,i)});return function(n){return t.apply(this,arguments)}}())}(r.result).runInContext(n);return new Se.Molecule.Coordinates(i,{label:e.label,description:"Coordinates"})});return function(n){return t.apply(this,arguments)}}())}),Ytt=nn.BuiltIn({name:"coordinates-from-trr",display:{name:"Parse TRR",description:"Parse TRR binary data."},from:[Se.Data.Binary],to:Se.Molecule.Coordinates})({apply:({a:e})=>Ke.create("Parse TRR",function(){var t=le(function*(n){const r=yield function wtt(e){return Ke.create("Parse TRR",function(){var t=le(function*(n){try{n.update({canAbort:!0,message:"Parsing trajectory..."});const r=yield function Ctt(e){return qH.apply(this,arguments)}(e);return qi.success(r)}catch(r){return qi.error(""+r)}});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function Att(e){return Ke.create("Parse TRR",function(){var t=le(function*(n){yield n.update("Converting to coordinates");const r=_d(e.deltaTime,"step"),i=_d(e.timeOffset,r.unit),o=[];for(let s=0,a=e.frames.length;s<a;++s){const l=e.boxes[s],c=C.fromArray(C(),l,0),u=C.fromArray(C(),l,3),d=C.fromArray(C(),l,6);o.push({elementCount:e.frames[s].count,cell:Ry.fromBasis(c,u,d),x:e.frames[s].x,y:e.frames[s].y,z:e.frames[s].z,xyzOrdering:{isIdentity:!0},time:_d(i.value+r.value*s,r.unit)})}return Wx.create(o,r,i)});return function(n){return t.apply(this,arguments)}}())}(r.result).runInContext(n);return new Se.Molecule.Coordinates(i,{label:e.label,description:"Coordinates"})});return function(n){return t.apply(this,arguments)}}())}),Xtt=nn.BuiltIn({name:"coordinates-from-nctraj",display:{name:"Parse NCTRAJ",description:"Parse NCTRAJ binary data."},from:[Se.Data.Binary],to:Se.Molecule.Coordinates})({apply:({a:e})=>Ke.create("Parse NCTRAJ",function(){var t=le(function*(n){const r=yield function jtt(e){return Ke.create("Parse NCTRAJ",function(){var t=le(function*(n){try{n.update({canAbort:!0,message:"Parsing trajectory..."});const r=yield function Ltt(e){return XH.apply(this,arguments)}(e);return qi.success(r)}catch(r){return qi.error(""+r)}});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function Utt(e){return Ke.create("Parse NCTRAJ",function(){var t=le(function*(n){yield n.update("Converting to coordinates");const r=_d(e.deltaTime,"step"),i=_d(e.timeOffset,r.unit),o=[];for(let s=0,a=e.coordinates.length;s<a;++s){const l=e.coordinates[s],c=l.length/3,u=new Float32Array(c),d=new Float32Array(c),f=new Float32Array(c);for(let m=0,h=l.length;m<h;m+=3)u[m/3]=l[m],d[m/3]=l[m+1],f[m/3]=l[m+2];const p={elementCount:c,x:u,y:d,z:f,xyzOrdering:{isIdentity:!0},time:_d(i.value+r.value*s,r.unit)};if(e.cell_lengths){const m=e.cell_lengths[s],h=C.scale(C(),C.unitX,m[0]),g=C.scale(C(),C.unitY,m[1]),y=C.scale(C(),C.unitZ,m[2]);p.cell=Ry.fromBasis(h,g,y)}o.push(p)}return Wx.create(o,r,i)});return function(n){return t.apply(this,arguments)}}())}(r.result).runInContext(n);return new Se.Molecule.Coordinates(i,{label:e.label,description:"Coordinates"})});return function(n){return t.apply(this,arguments)}}())}),Ktt=nn.BuiltIn({name:"topology-from-psf",display:{name:"PSF Topology",description:"Create topology from PSF."},from:[Se.Format.Psf],to:Se.Molecule.Topology})({apply:({a:e})=>Ke.create("Create Topology",function(){var t=le(function*(n){const r=yield function FQe(e){return Ke.create("Parse PSF",function(){var t=le(function*(n){const r=fH.fromPsf(e),i=function NQe(e){const t=new Array(e.count),n=new Array(e.count),r=new Uint32Array(e.count),i=new Uint32Array(e.count),o=new Array(e.count),s=new Gh,a=new qh(e.residueId,e.atomName);let l="",c=0,u="",d=0,f=e.segmentName.value(0),p=!1,m=0,h=-1;for(let y=0,v=e.count;y<v;++y){const x=e.residueId.value(y),_=e.segmentName.value(y);if(f!==_?(u=jD(c),c+=1,d=0,p=!0,f=_):p=!1,p||x!==h){const w=e.residueName.value(y),A=x1(a.add(w,y).type,w);!p&&(A!==m||x!==h+1)&&(u=jD(c),c+=1,d=0),l=s.getEntityId(w,A,u),d+=1,h=x,m=A}t[y]=l,n[y]=u,r[y]=d,i[y]=y,o[y]=eA(e.atomName.value(y),e.residueName.value(y))}const g=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:e.segmentName,auth_atom_id:e.atomName,auth_comp_id:e.residueName,auth_seq_id:e.residueId,id:ce.ofIntArray(i),label_asym_id:ce.ofStringArray(n),label_atom_id:e.atomName,label_comp_id:e.residueName,label_seq_id:ce.ofIntArray(r),label_entity_id:ce.ofStringArray(t),occupancy:ce.ofConst(1,e.count,ce.Schema.float),type_symbol:ce.ofStringArray(o),pdbx_PDB_model_num:ce.ofConst(1,e.count,ce.Schema.int)},e.count);return hp({entity:s.getEntityTable(),chem_comp:a.getChemCompTable(),atom_site:g})}(e.atoms),{atomIdA:o,atomIdB:s}=e.bonds,a={indexA:ce.ofLambda({value:l=>o.value(l)-1,rowCount:o.rowCount,schema:o.schema}),indexB:ce.ofLambda({value:l=>s.value(l)-1,rowCount:s.rowCount,schema:s.schema}),order:ce.ofConst(1,e.bonds.count,ce.Schema.int)};return f3.create(e.id,i,a,r)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);return new Se.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})});return function(n){return t.apply(this,arguments)}}())}),Ztt=nn.BuiltIn({name:"topology-from-prmtop",display:{name:"PRMTOP Topology",description:"Create topology from PRMTOP."},from:[Se.Format.Prmtop],to:Se.Molecule.Topology})({apply:({a:e})=>Ke.create("Create Topology",function(){var t=le(function*(n){const r=yield function Vtt(e){return Ke.create("Parse PRMTOP",function(){var t=le(function*(n){const r=KH.fromPrmtop(e),i=function ztt(e){const{pointers:t,residuePointer:n,residueLabel:r,atomName:i}=e,o=t.NATOM,s=t.NRES,a=new Uint32Array(o),l=[],c=(N,j,W)=>{const z=r.value(N);for(let $=j,V=W;$<V;++$)a[$]=N+1,l[$]=z};for(let N=0,j=s-1;N<j;++N)c(N,n.value(N)-1,n.value(N+1)-1);c(s-1,n.value(s-1)-1,o);const u=ce.ofIntArray(a),d=ce.ofStringArray(l),f=new Array(o),p=new Array(o),m=new Uint32Array(o),h=new Uint32Array(o),g=new Gh,y=new qh(u,i);let v="",x=0,_="",w=0,A=0,M=-1;for(let N=0,j=o;N<j;++N){const W=u.value(N);if(W!==M){const z=d.value(N),$=x1(y.add(z,N).type,z);$!==A&&(_=jD(x),x+=1,w=0),v=g.getEntityId(z,$,_),w+=1,M=W,A=$}f[N]=v,p[N]=_,m[N]=w,h[N]=N}const E=ce.ofIntArray(h),D=ce.ofStringArray(p),T=new Array(o);for(let N=0;N<o;++N)T[N]=eA(i.value(N),d.value(N));const F=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:D,auth_atom_id:ce.asArrayColumn(i),auth_comp_id:d,auth_seq_id:u,id:ce.asArrayColumn(E),label_asym_id:D,label_atom_id:ce.asArrayColumn(i),label_comp_id:d,label_seq_id:ce.ofIntArray(m),label_entity_id:ce.ofStringArray(f),occupancy:ce.ofConst(1,o,ce.Schema.float),type_symbol:ce.ofStringArray(T),pdbx_PDB_model_num:ce.ofConst(1,o,ce.Schema.int)},o);return hp({entity:g.getEntityTable(),chem_comp:y.getChemCompTable(),atom_site:F})}(e),{pointers:{NBONH:o,NBONA:s},bondsIncHydrogen:a,bondsWithoutHydrogen:l}=e,c=o+s,u={indexA:ce.ofLambda({value:d=>d<o?a.value(3*d)/3:l.value(3*(d-o))/3,rowCount:c,schema:ce.Schema.int}),indexB:ce.ofLambda({value:d=>d<o?a.value(3*d+1)/3:l.value(3*(d-o)+1)/3,rowCount:c,schema:ce.Schema.int}),order:ce.ofConst(1,c,ce.Schema.int)};return f3.create(e.title.join(" ")||"PRMTOP",i,u,r)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);return new Se.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})});return function(n){return t.apply(this,arguments)}}())}),Qtt=nn.BuiltIn({name:"topology-from-top",display:{name:"TOP Topology",description:"Create topology from TOP."},from:[Se.Format.Top],to:Se.Molecule.Topology})({apply:({a:e})=>Ke.create("Create Topology",function(){var t=le(function*(n){const r=yield function qtt(e){return Ke.create("Parse TOP",function(){var t=le(function*(n){const r=ZH.fromTop(e),i=function Htt(e){const{molecules:t,compounds:n}=e,r={};let i=0;for(let N=0,j=t._rowCount;N<j;++N){const W=t.compound.value(N),z=t.molCount.value(N),{atoms:$}=n[W];ce.asArrayColumn($.atom),ce.asArrayColumn($.resnr),ce.asArrayColumn($.residu),i+=z*$._rowCount;let V=$.resnr.value(0);r[W]=!0;for(let X=1,H=$._rowCount;X<H;++X){const oe=$.resnr.value(X);if(oe!==V){r[W]=!1;break}V=oe}}const o=new Array(i),s=new Uint32Array(i),a=new Array(i);let l=0;for(let N=0,j=t._rowCount;N<j;++N){const W=t.compound.value(N),z=t.molCount.value(N),{atoms:$}=n[W],V=r[W];for(let X=0;X<z;++X)for(let H=0,oe=$._rowCount;H<oe;++H)o[l]=$.atom.value(H),s[l]=$.resnr.value(H),a[l]=$.residu.value(H),V&&(s[l]+=X),l+=1}const c=ce.ofStringArray(o),u=ce.ofIntArray(s),d=ce.ofStringArray(a),f=new Array(i),p=new Array(i),m=new Uint32Array(i),h=new Uint32Array(i),g=new Gh,y=new qh(u,c);let v="",x=0,_="",w=0,A=0,M=-1;for(let N=0,j=i;N<j;++N){const W=u.value(N);if(W!==M){const z=d.value(N),$=x1(y.add(z,N).type,z);$!==A&&(_=jD(x),x+=1,w=0),v=g.getEntityId(z,$,_),w+=1,M=W,A=$}f[N]=v,p[N]=_,m[N]=w,h[N]=N}const E=ce.ofIntArray(h),D=ce.ofStringArray(p),T=new Array(i);for(let N=0;N<i;++N)T[N]=eA(c.value(N),d.value(N));const F=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:D,auth_atom_id:ce.asArrayColumn(c),auth_comp_id:d,auth_seq_id:u,id:ce.asArrayColumn(E),label_asym_id:D,label_atom_id:ce.asArrayColumn(c),label_comp_id:d,label_seq_id:ce.ofIntArray(m),label_entity_id:ce.ofStringArray(f),occupancy:ce.ofConst(1,i,ce.Schema.float),type_symbol:ce.ofStringArray(T),pdbx_PDB_model_num:ce.ofConst(1,i,ce.Schema.int)},i);return hp({entity:g.getEntityTable(),chem_comp:y.getChemCompTable(),atom_site:F})}(e),o=function Gtt(e){const{molecules:t,compounds:n}=e,r=[],i=[];let o=0;for(let s=0,a=t._rowCount;s<a;++s){const l=t.compound.value(s),c=t.molCount.value(s),{atoms:u,bonds:d}=n[l];if(d)for(let f=0;f<c;++f){for(let p=0,m=d._rowCount;p<m;++p)r.push(d.ai.value(p)-1+o),i.push(d.aj.value(p)-1+o);o+=u._rowCount}else if("TIP3"===l)for(let f=0;f<c;++f)r.push(0+o),i.push(1+o),r.push(0+o),i.push(2+o),o+=u._rowCount;else o+=c*u._rowCount}return{indexA:ce.ofIntArray(r),indexB:ce.ofIntArray(i),order:ce.ofConst(1,r.length,ce.Schema.int)}}(e);return f3.create(e.system||"TOP",i,o,r)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);return new Se.Molecule.Topology(r,{label:r.label||e.label,description:"Topology"})});return function(n){return t.apply(this,arguments)}}())});function QH(){return QH=le(function*(e,t,n){if(t.type===Se.Molecule.Topology.type){const r=t.data;return yield Sn.trajectoryFromTopologyAndCoordinates(r,n).runInContext(e)}if(t.type===Se.Molecule.Model.type)return Sn.trajectoryFromModelAndCoordinates(t.data,n);throw new Error("no model/topology found")}),QH.apply(this,arguments)}const JH=nn.BuiltIn({name:"trajectory-from-model-and-coordinates",display:{name:"Trajectory from Topology & Coordinates",description:"Create a trajectory from existing model/topology and coordinates."},from:Se.Root,to:Se.Molecule.Trajectory,params:{modelRef:I.Text("",{isHidden:!0}),coordinatesRef:I.Text("",{isHidden:!0})}})({apply:({params:e,dependencies:t})=>Ke.create("Create trajectory from model/topology and coordinates",function(){var n=le(function*(r){const i=t[e.coordinatesRef].data,o=yield function Jtt(e,t,n){return QH.apply(this,arguments)}(r,t[e.modelRef],i);return new Se.Molecule.Trajectory(o,{label:"Trajectory",description:`${o.frameCount} model${1===o.frameCount?"":"s"}`})});return function(r){return n.apply(this,arguments)}}())}),ent=nn.BuiltIn({name:"trajectory-from-blob",display:{name:"Parse Blob",description:"Parse format blob into a single trajectory."},from:Se.Format.Blob,to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse Format Blob",function(){var t=le(function*(n){const r=[];for(const o of e.data){if("cif"!==o.kind)continue;const s=o.data.blocks[0],a=yield jz(s).runInContext(n);if(0===a.frameCount)throw new Error("No models found.");for(let l=0;l<a.frameCount;l++){const c=yield Ke.resolveInContext(a.getFrameAtIndex(l),n);r.push(c)}}for(let o=0;o<r.length;o++)Sn.TrajectoryInfo.set(r[o],{index:o,size:r.length});const i={label:"Trajectory",description:`${r.length} model${1===r.length?"":"s"}`};return new Se.Molecule.Trajectory(new ay(r),i)});return function(n){return t.apply(this,arguments)}}())});function jy(e){return{label:`${e.representative.entry}`,description:`${e.frameCount} model${1===e.frameCount?"":"s"}`}}const tnt=nn.BuiltIn({name:"trajectory-from-mmcif",display:{name:"Trajectory from mmCIF",description:"Identify and create all separate models in the specified CIF data block"},from:Se.Format.Cif,to:Se.Molecule.Trajectory,params(e){if(!e)return{loadAllBlocks:I.Optional(I.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all datablocks into a single trajectory."})),blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:r=>!0===r.loadAllBlocks})),blockIndex:I.Optional(I.Numeric(0,{min:0,step:1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:r=>!0===r.loadAllBlocks||r.blockHeader}))};const{blocks:t}=e.data,n=t.map(r=>[r.header,r.header]);return n.push(["","[Use Block Index]"]),{loadAllBlocks:I.Optional(I.Boolean(!1,{description:"If True, ignore Block Header and Block Index parameters and parse all data blocks into a single trajectory."})),blockHeader:I.Optional(I.Select(t[0]&&t[0].header,n,{description:"Header of the block to parse. If not specifed, Block Index parameter applies.",hideIf:r=>!0===r.loadAllBlocks})),blockIndex:I.Optional(I.Numeric(0,{min:0,step:1,max:t.length-1},{description:"Zero-based index of the block to parse. Only applies when Block Header parameter is not specified.",hideIf:r=>!0===r.loadAllBlocks||r.blockHeader}))}}})({isApplicable:e=>e.data.blocks.length>0,apply:({a:e,params:t})=>Ke.create("Parse mmCIF",function(){var n=le(function*(r){var i;let o;if(t.loadAllBlocks){const a=[];for(const l of e.data.blocks){r.shouldUpdate&&(yield r.update(`Parsing ${l.header}...`));const c=yield jz(l).runInContext(r);for(let u=0;u<c.frameCount;u++)a.push(yield Ke.resolveInContext(c.getFrameAtIndex(u),r))}o=new ay(a)}else{const a=t.blockHeader||e.data.blocks[null!==(i=t.blockIndex)&&void 0!==i?i:0].header,l=e.data.blocks.find(u=>u.header===a);if(!l)throw new Error(`Data block '${[a]}' not found.`);o=!l.categoryNames.includes("chem_comp_atom")||l.categoryNames.includes("atom_site")||l.categoryNames.includes("ihm_sphere_obj_site")||l.categoryNames.includes("ihm_gaussian_obj_site")?yield jz(l,e.data).runInContext(r):yield function uze(e){const t=j3.fromFrame(e);return Ke.create("Create CCD Models",n=>function dze(e,t,n){return Uz.apply(this,arguments)}(t.data.db,j3.fromFrame(e),n))}(l).runInContext(r)}if(0===o.frameCount)throw new Error("No models found.");const s=jy(o);return new Se.Molecule.Trajectory(o,s)});return function(r){return n.apply(this,arguments)}}())}),nnt=nn.BuiltIn({name:"trajectory-from-pdb",display:{name:"Parse PDB",description:"Parse PDB string and create trajectory."},from:[Se.Data.String],to:Se.Molecule.Trajectory,params:{isPdbqt:I.Boolean(!1)}})({apply:({a:e,params:t})=>Ke.create("Parse PDB",function(){var n=le(function*(r){const i=yield function bWe(e,t,n=!1){return Ke.create("Parse PDB",function(){var r=le(function*(i){return qi.success({lines:yield kt.readAllLinesAsync(e,i),id:t,isPdbqt:n})});return function(i){return r.apply(this,arguments)}}())}(e.data,e.label,t.isPdbqt).runInContext(r);if(i.isError)throw new Error(i.message);const o=yield function RQe(e){return Ke.create("Parse PDB",function(){var t=le(function*(n){var r;yield n.update("Converting to mmCIF");const i=yield function MQe(e){return uH.apply(this,arguments)}(e),o=Ui.fromFrame(i,void 0,dH.create(e)),s=hp(o.data.db,!0),a=yield cg(s,o,n),l=null===(r=i.categories.atom_site)||void 0===r?void 0:r.getField("partial_charge");if(l&&1===a.frameCount){const c=a.representative,u=c.atomicHierarchy.atomSourceIndex,f=ce.isIdentity(u)?void 0:u.toArray({array:Int32Array}),p=l.toFloatArray(),m=ce.ofFloatArray(f?ce.mapToArray(u,h=>p[h],Float32Array):p);tA.Provider.set(c,{data:m,type:"GASTEIGER"})}return a});return function(n){return t.apply(this,arguments)}}())}(i.result).runInContext(r),s=jy(o);return new Se.Molecule.Trajectory(o,s)});return function(r){return n.apply(this,arguments)}}())}),rnt=nn.BuiltIn({name:"trajectory-from-gro",display:{name:"Parse GRO",description:"Parse GRO string and create trajectory."},from:[Se.Data.String],to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse GRO",function(){var t=le(function*(n){const r=yield function yWe(e){return Ke.create("Parse GRO",function(){var t=le(function*(n){return yield function gWe(e,t){return y9.apply(this,arguments)}(e,n)});return function(n){return t.apply(this,arguments)}}())}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function hQe(e){return Ke.create("Parse GRO",function(){var t=le(function*(n){const r=cH.fromGro(e),i=[];for(let o=0,s=e.structures.length;o<s;++o){const a=pQe(e.structures[o].atoms,o+1),l=yield cg(a,r,n);1===l.frameCount&&i.push(l.representative)}return new ay(i)});return function(n){return t.apply(this,arguments)}}())}(r.result).runInContext(n),o=jy(i);return new Se.Molecule.Trajectory(i,o)});return function(n){return t.apply(this,arguments)}}())}),int=nn.BuiltIn({name:"trajectory-from-xyz",display:{name:"Parse XYZ",description:"Parse XYZ string and create trajectory."},from:[Se.Data.String],to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse XYZ",function(){var t=le(function*(n){const r=yield function utt(e){return Ke.create("Parse Mol",le(function*(){return function ctt(e){const t=kt(e),n=[];for(;;){const i=ltt(t);if(0===i.count)break;n.push(i)}return qi.success({molecules:n})}(e)}))}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function ftt(e){return Ke.create("Parse XYZ",t=>function dtt(e,t){const{molecules:n}=e;let r=0;for(const x of n)r+=x.count;const i=new Array(r),o=new Int32Array(r),s=new Float32Array(r),a=new Float32Array(r),l=new Float32Array(r),c=new Int32Array(r);let u=0;for(let x=0;x<n.length;x++){const _=n[x];for(let w=0;w<_.count;w++)i[u]=_.type_symbol.value(w),s[u]=_.x.value(w),a[u]=_.y.value(w),l[u]=_.z.value(w),o[u]=w,c[u]=x,u++}const d=ce.ofConst("MOL",r,ce.Schema.str),f=ce.ofConst("A",r,ce.Schema.str),p=ce.ofConst(1,r,ce.Schema.int),m=ce.ofStringArray(i),h=Kr.ofPartialColumns(ic.atom_site,{auth_asym_id:f,auth_atom_id:m,auth_comp_id:d,auth_seq_id:p,Cartn_x:ce.ofFloatArray(s),Cartn_y:ce.ofFloatArray(a),Cartn_z:ce.ofFloatArray(l),id:ce.ofIntArray(o),label_asym_id:f,label_atom_id:m,label_comp_id:d,label_seq_id:p,label_entity_id:ce.ofConst("1",r,ce.Schema.str),occupancy:ce.ofConst(1,r,ce.Schema.float),type_symbol:m,pdbx_PDB_model_num:ce.ofIntArray(c)},r),g=new Gh;g.setNames([["MOL","Unknown Entity"]]),g.getEntityId("MOL",0,"A");const y=new qh(p,m);return y.setNames([["MOL","Unknown Molecule"]]),y.add("MOL",0),cg(hp({entity:g.getEntityTable(),chem_comp:y.getChemCompTable(),atom_site:h}),VH.create(e),t)}(e,t))}(r.result).runInContext(n),o=jy(i);return new Se.Molecule.Trajectory(i,o)});return function(n){return t.apply(this,arguments)}}())}),ont=nn.BuiltIn({name:"trajectory-from-mol",display:{name:"Parse MOL",description:"Parse MOL string and create trajectory."},from:[Se.Data.String],to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse MOL",function(){var t=le(function*(n){const r=yield function Bet(e){return Ke.create("Parse Mol",le(function*(){return function Oet(e){const t=kt(e),n=kt.readLine(t).trim(),r=kt.readLine(t).trim(),i=kt.readLine(t).trim(),o=kt.readLine(t),s=+o.substr(0,3),a=+o.substr(3,3),l=rpe(t,s),c=ipe(t,a),u=ope(t);return qi.success({title:n,program:r,comment:i,atoms:l,bonds:c,formalCharges:u})}(e)}))}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function Let(e){return Ke.create("Parse MOL",t=>spe(e,void 0,t))}(r.result).runInContext(n),o=jy(i);return new Se.Molecule.Trajectory(i,o)});return function(n){return t.apply(this,arguments)}}())}),snt=nn.BuiltIn({name:"trajectory-from-sdf",display:{name:"Parse SDF",description:"Parse SDF string and create trajectory."},from:[Se.Data.String],to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse SDF",function(){var t=le(function*(n){const r=yield function _tt(e){return Ke.create("Parse Sdf",le(function*(){return function xtt(e){const t=kt(e),n=[];for(;t.position<t.length;){const r=vtt(t);r&&n.push(r)}return qi.success({compounds:n})}(e)}))}(e.data).runInContext(n);if(r.isError)throw new Error(r.message);const i=[];for(const a of r.result.compounds){const l=yield Stt(a).runInContext(n);for(let c=0;c<l.frameCount;c++)i.push(yield Ke.resolveInContext(l.getFrameAtIndex(c),n))}const o=new ay(i),s=jy(o);return new Se.Molecule.Trajectory(o,s)});return function(n){return t.apply(this,arguments)}}())}),ant=nn.BuiltIn({name:"trajectory-from-mol2",display:{name:"Parse MOL2",description:"Parse MOL2 string and create trajectory."},from:[Se.Data.String],to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse MOL2",function(){var t=le(function*(n){const r=yield function ett(e,t){return Ke.create("Parse MOL2",function(){var n=le(function*(r){return yield function Jet(e,t,n){return BH.apply(this,arguments)}(r,e,t)});return function(r){return n.apply(this,arguments)}}())}(e.data,e.label).runInContext(n);if(r.isError)throw new Error(r.message);const i=yield function rtt(e){return Ke.create("Parse MOL2",t=>function ttt(e,t){return LH.apply(this,arguments)}(e,t))}(r.result).runInContext(n),o=jy(i);return new Se.Molecule.Trajectory(i,o)});return function(n){return t.apply(this,arguments)}}())}),lnt=nn.BuiltIn({name:"trajectory-from-cube",display:{name:"Parse Cube",description:"Parse Cube file to create a trajectory."},from:Se.Format.Cube,to:Se.Molecule.Trajectory})({apply:({a:e})=>Ke.create("Parse MOL",function(){var t=le(function*(n){const r=yield function Wet(e){return Ke.create("Parse Cube",t=>function qet(e,t){return MH.apply(this,arguments)}(e,t))}(e.data).runInContext(n),i=jy(r);return new Se.Molecule.Trajectory(r,i)});return function(n){return t.apply(this,arguments)}}())}),cnt=nn.BuiltIn({name:"trajectory-from-cif-core",display:{name:"Parse CIF Core",description:"Identify and create all separate models in the specified CIF data block"},from:Se.Format.Cif,to:Se.Molecule.Trajectory,params(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."}))};const{blocks:t}=e.data;return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(n=>[n.header,n.header]),{description:"Header of the block to parse"}))}}})({apply:({a:e,params:t})=>Ke.create("Parse CIF Core",function(){var n=le(function*(r){const i=t.blockHeader||e.data.blocks[0].header,o=e.data.blocks.find(l=>l.header===i);if(!o)throw new Error(`Data block '${[i]}' not found.`);const s=yield function Get(e){const t=$D.fromFrame(e);return Ke.create("Parse CIF Core",n=>function zet(e,t,n){return kH.apply(this,arguments)}(t.data.db,t,n))}(o).runInContext(r);if(0===s.frameCount)throw new Error("No models found.");const a=jy(s);return new Se.Molecule.Trajectory(s,a)});return function(r){return n.apply(this,arguments)}}())}),unt=e=>e+1,dnt=e=>e-1,mpe=nn.BuiltIn({name:"model-from-trajectory",display:{name:"Molecular Model",description:"Create a molecular model from specified index in a trajectory."},from:Se.Molecule.Trajectory,to:Se.Molecule.Model,params:e=>e?{modelIndex:I.Converted(unt,dnt,I.Numeric(1,{min:1,max:e.data.frameCount,step:1},{description:"Model Index",immediateUpdate:!0}))}:{modelIndex:I.Numeric(0,{},{description:"Zero-based index of the model",immediateUpdate:!0})}})({isApplicable:e=>e.data.frameCount>0,apply:({a:e,params:t})=>Ke.create("Model from Trajectory",function(){var n=le(function*(r){let i=t.modelIndex%e.data.frameCount;i<0&&(i+=e.data.frameCount);const o=yield Ke.resolveInContext(e.data.getFrameAtIndex(i),r);return new Se.Molecule.Model(o,{label:`Model ${i+1}`,description:1===e.data.frameCount?void 0:`of ${e.data.frameCount}`})});return function(r){return n.apply(this,arguments)}}()),interpolate:(e,t,n)=>({modelIndex:n>=1?t.modelIndex:e.modelIndex+Math.floor((t.modelIndex-e.modelIndex+1)*n)}),dispose({b:e}){e?.data.customProperties.dispose()}}),fnt=nn.BuiltIn({name:"structure-from-trajectory",display:{name:"Structure from Trajectory",description:"Create a molecular structure from a trajectory."},from:Se.Molecule.Trajectory,to:Se.Molecule.Structure})({apply:({a:e})=>Ke.create("Build Structure",function(){var t=le(function*(n){const r=yield Xe.ofTrajectory(e.data,n),i={label:"Ensemble",description:Xe.elementDescription(r)};return new Se.Molecule.Structure(r,i)});return function(n){return t.apply(this,arguments)}}()),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),pnt=nn.BuiltIn({name:"structure-from-model",display:{name:"Structure",description:"Create a molecular structure (model, assembly, or symmetry) from the specified model."},from:Se.Molecule.Model,to:Se.Molecule.Structure,params:e=>R_.getParams(e&&e.data)})({canAutoUpdate:({oldParams:e,newParams:t})=>R_.canAutoUpdate(e.type,t.type),apply:({a:e,params:t},n)=>Ke.create("Build Structure",function(){var r=le(function*(i){return R_.create(n,i,e.data,t&&t.type)});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,oldParams:n,newParams:r})=>tg(n,r)?t.data.model===e.data?yt.UpdateResult.Unchanged:Sn.areHierarchiesEqual(e.data,t.data.model)?(t.data=t.data.remapModel(e.data),yt.UpdateResult.Updated):yt.UpdateResult.Recreate:yt.UpdateResult.Recreate,dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),gpe=C(),ype=fe(),bpe=fe(),hnt=nn.BuiltIn({name:"transform-structure-conformation",display:{name:"Transform Conformation"},isDecorator:!0,from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:{transform:I.MappedStatic("components",{components:I.Group({axis:I.Vec3(C.create(1,0,0)),angle:I.Numeric(0,{min:-180,max:180,step:.1}),translation:I.Vec3(C.create(0,0,0))},{isFlat:!0}),matrix:I.Group({data:I.Mat4(fe.identity()),transpose:I.Boolean(!1)},{isFlat:!0})},{label:"Kind"})}})({canAutoUpdate:({newParams:e})=>"matrix"!==e.transform.name,apply({a:e,params:t}){const n=fe();if("components"===t.transform.name){const{axis:i,angle:o,translation:s}=t.transform.params,a=e.data.boundary.sphere.center;fe.fromTranslation(ype,C.negate(gpe,a)),fe.fromTranslation(bpe,C.add(gpe,a,s));const l=fe.fromRotation(fe(),Math.PI/180*o,C.normalize(C(),i));fe.mul3(n,bpe,l,ype)}else"matrix"===t.transform.name&&(fe.copy(n,t.transform.params.data),t.transform.params.transpose&&fe.transpose(n,n));const r=Xe.transform(e.data,n);return new Se.Molecule.Structure(r,{label:e.label,description:`${e.description} [Transformed]`})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),mnt=nn.BuiltIn({name:"structure-selection-from-expression",display:{name:"Selection",description:"Create a molecular structure from the specified expression."},from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:()=>({expression:I.Value(pe.struct.generator.all,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:n}){const{selection:r,entry:i}=lu.createAndRun(e.data,t.expression);if(n.entry=i,Dt.isEmpty(r))return vo.Null;const o=Dt.unionStructure(r),s={label:`${t.label||"Selection"}`,description:Xe.elementDescription(o)};return new Se.Molecule.Structure(o,s)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(n.expression!==r.expression)return yt.UpdateResult.Recreate;const o=i.entry;if(o.currentStructure===e.data)return yt.UpdateResult.Unchanged;const s=lu.updateStructure(o,e.data);return Dt.isEmpty(s)?yt.UpdateResult.Null:(lu.updateStructureObject(t,s,r.label),yt.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),gnt=nn.BuiltIn({name:"structure-multi-selection-from-expression",display:{name:"Multi-structure Measurement Selection",description:"Create selection object from multiple structures."},from:Se.Root,to:Se.Molecule.Structure.Selections,params:()=>({selections:I.ObjectList({key:I.Text(void 0,{description:"A unique key."}),ref:I.Text(),groupId:I.Optional(I.Text()),expression:I.Value(pe.struct.generator.empty)},e=>e.ref,{isHidden:!0}),isTransitive:I.Optional(I.Boolean(!1,{isHidden:!0,description:"Remap the selections from the original structure if structurally equivalent."})),label:I.Optional(I.Text("",{isHidden:!0}))})})({apply({params:e,cache:t,dependencies:n}){const r=new Map,i=[];let o=0;for(const a of e.selections){const{selection:l,entry:c}=lu.createAndRun(n[a.ref].data,a.expression);r.set(a.key,c);const u=Dt.toLociWithSourceUnits(l);i.push({key:a.key,loci:u,groupId:a.groupId}),o+=Me.size(u)}return t.entries=r,new Se.Molecule.Structure.Selections(i,{label:`${e.label||"Multi-selection"}`,description:`${e.selections.length} source(s), ${o} element(s) total`})},update:({b:e,oldParams:t,newParams:n,cache:r,dependencies:i})=>{if(!!t.isTransitive!=!!n.isTransitive)return yt.UpdateResult.Recreate;const o=r.entries,s=new Map,a=new Map;for(const d of e.data)a.set(d.key,d);let l=!1,c=0;const u=[];for(const d of n.selections){const f=i[d.ref].data;let p=!1;if(o.has(d.key)){const m=o.get(d.key);if(lu.isUnchanged(m,d.expression,f)&&a.has(d.key)){const h=a.get(d.key);h.groupId!==d.groupId&&(h.groupId=d.groupId,l=!0),s.set(d.key,m),u.push(h),c+=Me.size(h.loci);continue}if(m.expression!==d.expression)p=!0;else{let h=!1;if(n.isTransitive)if(Xe.areUnitIdsAndIndicesEqual(m.originalStructure,f)){const g=lu.run(m,m.originalStructure);m.currentStructure=f,s.set(d.key,m);const y=Me.remap(Dt.toLociWithSourceUnits(g),f);u.push({key:d.key,loci:y,groupId:d.groupId}),c+=Me.size(y),l=!0}else h=!0;else h=!0;if(h){l=!0;const g=lu.updateStructure(m,f);s.set(d.key,m);const y=Dt.toLociWithSourceUnits(g);u.push({key:d.key,loci:y,groupId:d.groupId}),c+=Me.size(y)}}}else p=!0;if(p){l=!0;const{selection:m,entry:h}=lu.createAndRun(f,d.expression);s.set(d.key,h);const g=Dt.toLociWithSourceUnits(m);u.push({key:d.key,loci:g}),c+=Me.size(g)}}return l?(r.entries=s,e.data=u,e.label=`${n.label||"Multi-selection"}`,e.description=`${u.length} source(s), ${c} element(s) total`,yt.UpdateResult.Updated):yt.UpdateResult.Unchanged}}),ynt=nn.BuiltIn({name:"structure-selection-from-script",display:{name:"Selection",description:"Create a molecular structure from the specified script."},from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:()=>({script:I.Script({language:"mol-script",expression:"(sel.atom.atom-groups :residue-test (= atom.resname ALA))"}),label:I.Optional(I.Text(""))})})({apply({a:e,params:t,cache:n}){const{selection:r,entry:i}=lu.createAndRun(e.data,t.script);n.entry=i;const o=Dt.unionStructure(r),s={label:`${t.label||"Selection"}`,description:Xe.elementDescription(o)};return new Se.Molecule.Structure(o,s)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(!pa.areEqual(n.script,r.script))return yt.UpdateResult.Recreate;const o=i.entry;if(o.currentStructure===e.data)return yt.UpdateResult.Unchanged;const s=lu.updateStructure(o,e.data);return lu.updateStructureObject(t,s,r.label),yt.UpdateResult.Updated},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),bnt=nn.BuiltIn({name:"structure-selection-from-bundle",display:{name:"Selection",description:"Create a molecular structure from the specified structure-element bundle."},from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:()=>({bundle:I.Value(Qr.Empty,{isHidden:!0}),label:I.Optional(I.Text("",{isHidden:!0}))})})({apply({a:e,params:t,cache:n}){if(t.bundle.hash!==e.data.hashCode)return vo.Null;n.source=e.data;const r=Qr.toStructure(t.bundle,e.data);if(0===r.elementCount)return vo.Null;const i={label:`${t.label||"Selection"}`,description:Xe.elementDescription(r)};return new Se.Molecule.Structure(r,i)},update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>{if(!Qr.areEqual(n.bundle,r.bundle))return yt.UpdateResult.Recreate;if(r.bundle.hash!==e.data.hashCode)return yt.UpdateResult.Null;if(i.source===e.data)return yt.UpdateResult.Unchanged;i.source=e.data;const o=Qr.toStructure(r.bundle,e.data);return 0===o.elementCount?yt.UpdateResult.Null:(t.label=`${r.label||"Selection"}`,t.description=Xe.elementDescription(o),t.data=o,yt.UpdateResult.Updated)},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),vpe={polymer:"polymer",protein:"protein",nucleic:"nucleic",water:"water",branched:"branched",ligand:"ligand","non-standard":"non-standard",coarse:"coarse","atomic-sequence":"atomic-sequence","atomic-het":"atomic-het",spheres:"spheres"},vnt=I.objectToOptions(vpe),xnt=nn.BuiltIn({name:"structure-complex-element",display:{name:"Complex Element",description:"Create a molecular structure from the specified model."},from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:{type:I.Select("atomic-sequence",vnt,{isHidden:!0})}})({apply({a:e,params:t}){let n,r;switch(t.type){case"polymer":n=Ps.polymer.query,r="Polymer";break;case"protein":n=Ps.protein.query,r="Protein";break;case"nucleic":n=Ps.nucleic.query,r="Nucleic";break;case"water":n=_i.internal.water(),r="Water";break;case"branched":n=Ps.branchedPlusConnected.query,r="Branched";break;case"ligand":n=Ps.ligandPlusConnected.query,r="Ligand";break;case"non-standard":n=Ps.nonStandardPolymer.query,r="Non-standard";break;case"coarse":n=Ps.coarse.query,r="Coarse";break;case"atomic-sequence":n=_i.internal.atomicSequence(),r="Sequence";break;case"atomic-het":n=_i.internal.atomicHet(),r="HET Groups/Ligands";break;case"spheres":n=_i.internal.spheres(),r="Coarse Spheres";break;default:Hi()}const i=n(new _f(e.data)),o=Dt.unionStructure(i);return 0===o.elementCount?vo.Null:new Se.Molecule.Structure(o,{label:r,description:Xe.elementDescription(o)})},dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),_nt=nn.BuiltIn({name:"structure-component",display:{name:"Component",description:"A molecular structure component."},from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:()=>({type:I.MappedStatic("static",{static:I.Text("polymer"),expression:I.Value(pe.struct.generator.all),bundle:I.Value(Qr.Empty),script:I.Script({language:"mol-script",expression:"(sel.atom.all)"})},{isHidden:!0}),nullIfEmpty:I.Optional(I.Boolean(!0,{isHidden:!0})),label:I.Text("",{isHidden:!0})})})({apply:({a:e,params:t,cache:n})=>function Met(e,t,n){n.source=e;let i,r=Xe.Empty;switch(t.type.name){case"static":{let s;switch(t.type.params){case"all":s=Ps.all.query,i="All";break;case"polymer":s=Ps.polymer.query,i="Polymer";break;case"protein":s=Ps.protein.query,i="Protein";break;case"nucleic":s=Ps.nucleic.query,i="Nucleic";break;case"water":s=_i.internal.water(),i="Water";break;case"ion":s=Ps.ion.query,i="Ion";break;case"lipid":s=Ps.lipid.query,i="Lipid";break;case"branched":s=Ps.branchedPlusConnected.query,i="Branched";break;case"ligand":s=Ps.ligandPlusConnected.query,i="Ligand";break;case"non-standard":s=Ps.nonStandardPolymer.query,i="Non-standard";break;case"coarse":s=Ps.coarse.query,i="Coarse";break;default:Hi()}const a=s(new _f(e));r=Dt.unionStructure(a);break}case"script":case"expression":{const{selection:s,entry:a}=lu.createAndRun(e,t.type.params);n.entry=a,r=Dt.unionStructure(s);break}case"bundle":if(t.type.params.hash!==e.hashCode)break;r=Qr.toStructure(t.type.params,e)}if(t.nullIfEmpty&&0===r.elementCount)return vo.Null;const o={label:`${t.label||i||"Component"}`,description:Xe.elementDescription(r)};return new Se.Molecule.Structure(r,o)}(e.data,t,n),update:({a:e,b:t,oldParams:n,newParams:r,cache:i})=>function Ret(e,t,n,r,i){if(n.type.name!==r.type.name)return yt.UpdateResult.Recreate;let o=!1;switch(r.type.name){case"static":return n.type.params===r.type.params&&Xe.areEquivalent(e,i.source)?t.data.model===e.model?yt.UpdateResult.Unchanged:Sn.areHierarchiesEqual(e.model,t.data.model)?(t.data=t.data.remapModel(e.model),yt.UpdateResult.Updated):yt.UpdateResult.Recreate:yt.UpdateResult.Recreate;case"script":if(!pa.areEqual(n.type.params,r.type.params))return yt.UpdateResult.Recreate;case"expression":{if(n.type.params!==r.type.params)return yt.UpdateResult.Recreate;if(e===i.source)break;const a=lu.updateStructure(i.entry,e);i.source=e,t.data=Dt.unionStructure(a),lu.updateStructureObject(t,a,r.label),o=!0;break}case"bundle":if(e===i.source&&Qr.areEqual(n.type.params,r.type.params))break;i.source=e,r.type.params.hash!==e.hashCode?(o=0!==t.data.elementCount,t.data=0===t.data.elementCount?t.data:Xe.Empty):(o=!0,t.data=Qr.toStructure(r.type.params,e))}if(o){if(r.nullIfEmpty&&0===t.data.elementCount)return yt.UpdateResult.Null;t.description=Xe.elementDescription(t.data)}return n.label!==r.label&&(o=!0,t.label=`${r.label||t.label}`),o?yt.UpdateResult.Updated:yt.UpdateResult.Unchanged}(e.data,t,n,r,i),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}}),xpe=nn.BuiltIn({name:"custom-model-properties",display:{name:"Custom Model Properties"},isDecorator:!0,from:Se.Molecule.Model,to:Se.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(e?.data)})({apply:({a:e,params:t},n)=>Ke.create("Custom Props",function(){var r=le(function*(i){return yield _pe(e.data,n,i,t),new Se.Molecule.Model(e.data,{label:e.label,description:e.description})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,oldParams:n,newParams:r},i)=>Ke.create("Custom Props",function(){var o=le(function*(s){t.data=e.data,t.label=e.label,t.description=e.description;for(const a of n.autoAttach){const l=i.customModelProperties.get(a);l&&e.data.customProperties.reference(l.descriptor,!1)}return yield _pe(e.data,i,s,r),yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}});function _pe(e,t,n,r){return eG.apply(this,arguments)}function eG(){return eG=le(function*(e,t,n,r){const i={runtime:n,assetManager:t.managers.asset},{autoAttach:o,properties:s}=r;for(const a of Object.keys(s)){const l=t.customModelProperties.get(a),c=s[a];if(o.includes(a)||l.isHidden)try{yield l.attach(i,e,c,!0)}catch(u){t.log.warn(`Error attaching model prop '${a}': ${u}`)}else l.set(e,c)}}),eG.apply(this,arguments)}const Spe=nn.BuiltIn({name:"custom-structure-properties",display:{name:"Custom Structure Properties"},isDecorator:!0,from:Se.Molecule.Structure,to:Se.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(e?.data.root)})({apply:({a:e,params:t},n)=>Ke.create("Custom Props",function(){var r=le(function*(i){return yield Cpe(e.data.root,n,i,t),new Se.Molecule.Structure(e.data,{label:e.label,description:e.description})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,oldParams:n,newParams:r},i)=>e.data!==t.data?yt.UpdateResult.Recreate:Ke.create("Custom Props",function(){var o=le(function*(s){t.data=e.data,t.label=e.label,t.description=e.description;for(const a of n.autoAttach){const l=i.customStructureProperties.get(a);l&&e.data.customPropertyDescriptors.reference(l.descriptor,!1)}return yield Cpe(e.data.root,i,s,r),yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}()),dispose({b:e}){e?.data.customPropertyDescriptors.dispose()}});function Cpe(e,t,n,r){return tG.apply(this,arguments)}function tG(){return tG=le(function*(e,t,n,r){const i={runtime:n,assetManager:t.managers.asset},{autoAttach:o,properties:s}=r;for(const a of Object.keys(s)){const l=t.customStructureProperties.get(a),c=s[a];if(o.includes(a)||l.isHidden)try{yield l.attach(i,e,c,!0)}catch(u){t.log.warn(`Error attaching structure prop '${a}': ${u}`)}else l.set(e,c)}}),tG.apply(this,arguments)}const Snt=nn.BuiltIn({name:"shape-from-ply",display:{name:"Shape from PLY",description:"Create Shape from PLY data"},from:Se.Format.Ply,to:Se.Shape.Provider,params:e=>({transforms:I.Optional(I.Value([],{isHidden:!0})),label:I.Optional(I.Text("",{isHidden:!0}))})})({apply:({a:e,params:t})=>Ke.create("Create shape from PLY",function(){var n=le(function*(r){const i=yield function sQe(e,t){return Ke.create("Shape Provider",function(){var n=le(function*(r){return{label:"Mesh",data:{source:e,transforms:t?.transforms},params:xfe(e),getShape:oQe(),geometryUtils:on.Utils}});return function(r){return n.apply(this,arguments)}}())}(e.data,t).runInContext(r);return new Se.Shape.Provider(i,{label:t.label||"Shape"})});return function(r){return n.apply(this,arguments)}}())});var nG,rG,iG,oG;!function(e){e.is=function t(r){return"ccp4"===r?.kind},e.create=function n(r){return{kind:"ccp4",name:r.name,data:r}}}(nG||(nG={})),function(e){e.is=function t(r){return"dsn6"===r?.kind},e.create=function n(r){return{kind:"dsn6",name:r.name,data:r}}}(rG||(rG={})),function(e){e.is=function t(r){return"dx"===r?.kind},e.create=function n(r){return{kind:"dx",name:r.name,data:r}}}(iG||(iG={})),function(e){e.is=function t(r){return"segcif"===r?.kind},e.create=function n(r){return{kind:"segcif",name:r._name,data:r}}}(oG||(oG={}));const Dnt=nn.BuiltIn({name:"volume-from-ccp4",display:{name:"Volume from CCP4/MRC/MAP",description:"Create Volume from CCP4/MRC/MAP data"},from:Se.Format.Ccp4,to:Se.Volume.Data,params:e=>({voxelSize:I.Vec3(C.create(1,1,1)),offset:I.Vec3(C.create(0,0,0)),entryId:I.Text("")})})({apply:({a:e,params:t})=>Ke.create("Create volume from CCP4/MRC/MAP",function(){var n=le(function*(r){const i=yield function Ant(e,t){return Ke.create("Create Volume",function(){var n=le(function*(r){const{header:i,values:o}=e,s=C.create(i.xLength,i.yLength,i.zLength);t&&t.voxelSize&&C.mul(s,s,t.voxelSize);const a=C.create(Xr(i.alpha),Xr(i.beta),Xr(i.gamma)),c=Qc.create((i.ISPG>65536?0:i.ISPG)||"P 1",s,a),u=C.create(i.MAPC-1,i.MAPR-1,i.MAPS-1),d=mr.convertToCanonicalAxisIndicesFastToSlow(u),f=[i.NX,i.NY,i.NZ],p=d([i.NC,i.NR,i.NS]),m=function Cnt(e){return 0===e.originX&&0===e.originY&&0===e.originZ?C.create(e.NCSTART,e.NRSTART,e.NSSTART):C.create(e.originX/(e.xLength/e.NX),e.originY/(e.yLength/e.NY),e.originZ/(e.zLength/e.NZ))}(i);t?.offset&&C.add(m,m,t.offset);const h=d(m),g=C.create(h[0]/f[0],h[1]/f[1],h[2]/f[2]),y=C.create(p[0]/f[0],p[1]/f[1],p[2]/f[2]),v=mr.Space(p,mr.invertAxisOrder(u),function wnt(e){const t=Hle(e);switch(t){case dl.Float32:return Float32Array;case dl.Int8:return Int8Array;case dl.Int16:return Int16Array;case dl.Uint16:return Uint16Array}throw Error(`${t} is not a supported value format.`)}(i)),x=mr.create(v,mr.Data1(o)),_=0===i.AMIN&&0===i.AMAX&&0===i.AMEAN&&0===i.ARMS;return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:c,fractionalBox:Gt.create(g,C.add(C.zero(),g,y))},cells:x,stats:{min:isNaN(i.AMIN)||_?OR(o):i.AMIN,max:isNaN(i.AMAX)||_?Bh(o):i.AMAX,mean:isNaN(i.AMEAN)||_?BR(o):i.AMEAN,sigma:isNaN(i.ARMS)||0===i.ARMS?LR(o):i.ARMS}},sourceData:nG.create(e),customProperties:new Oh,_propertyData:Object.create(null)}});return function(r){return n.apply(this,arguments)}}())}(e.data,{...t,label:e.data.name||e.label}).runInContext(r);return new Se.Volume.Data(i,{label:i.label||"Volume",description:`Volume ${e.data.header.NX}\xd7${e.data.header.NX}\xd7${e.data.header.NX}`})});return function(r){return n.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}}),Pnt=nn.BuiltIn({name:"volume-from-dsn6",display:{name:"Volume from DSN6/BRIX",description:"Create Volume from DSN6/BRIX data"},from:Se.Format.Dsn6,to:Se.Volume.Data,params:e=>({voxelSize:I.Vec3(C.create(1,1,1)),entryId:I.Text("")})})({apply:({a:e,params:t})=>Ke.create("Create volume from DSN6/BRIX",function(){var n=le(function*(r){const i=yield function Int(e,t){return Ke.create("Create Volume",function(){var n=le(function*(r){const{header:i,values:o}=e,s=C.create(i.xlen,i.ylen,i.zlen);t&&t.voxelSize&&C.mul(s,s,t.voxelSize);const a=C.create(Xr(i.alpha),Xr(i.beta),Xr(i.gamma)),l=Qc.create("P 1",s,a),c=[i.xRate,i.yRate,i.zRate],u=[i.xExtent,i.yExtent,i.zExtent],d=[i.xStart,i.yStart,i.zStart],f=C.create(d[0]/c[0],d[1]/c[1],d[2]/c[2]),p=C.create(u[0]/c[0],u[1]/c[1],u[2]/c[2]),m=mr.Space(u,[0,1,2],Float32Array),h=mr.create(m,mr.Data1(o));return{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"spacegroup",cell:l,fractionalBox:Gt.create(f,C.add(C.zero(),f,p))},cells:h,stats:{min:OR(o),max:Bh(o),mean:BR(o),sigma:void 0!==i.sigma?i.sigma:LR(o)}},sourceData:rG.create(e),customProperties:new Oh,_propertyData:Object.create(null)}});return function(r){return n.apply(this,arguments)}}())}(e.data,{...t,label:e.data.name||e.label}).runInContext(r);return new Se.Volume.Data(i,{label:i.label||"Volume",description:`Volume ${e.data.header.xExtent}\xd7${e.data.header.yExtent}\xd7${e.data.header.zExtent}`})});return function(r){return n.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}}),knt=nn.BuiltIn({name:"volume-from-cube",display:{name:"Volume from Cube",description:"Create Volume from Cube data"},from:Se.Format.Cube,to:Se.Volume.Data,params:e=>({dataIndex:e?I.Select(0,e.data.header.dataSetIds.map((n,r)=>[r,`${n}`])):I.Numeric(0),entryId:I.Text("")})})({apply:({a:e,params:t})=>Ke.create("Create volume from Cube",function(){var n=le(function*(r){const i=yield function iZe(e,t){return Ke.create("Create Volume",le(function*(){const{header:n,values:r}=e,i=mr.Space(n.dim,[0,1,2],Float64Array);let o;if(0===n.dataSetIds.length)o=r;else{const[c,u,d]=n.dim,f=(t?.dataIndex||0)+1;let p=0,m=0;o=new Float64Array(c*u*d);for(let h=0;h<c;h++)for(let g=0;g<u;g++)for(let y=0;y<d;y++)o[p++]=r[m],m+=f}const s=mr.create(i,mr.Data1(o)),a=fe.fromTranslation(fe(),n.origin),l=fe.fromBasis(fe(),n.basisX,n.basisY,n.basisZ);return fe.mul(a,a,l),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:a},cells:s,stats:{min:OR(o),max:Bh(o),mean:BR(o),sigma:LR(o)}},sourceData:EN.create(e),customProperties:new Oh,_propertyData:Object.create(null)}}))}(e.data,{...t,label:e.data.name||e.label}).runInContext(r);return new Se.Volume.Data(i,{label:i.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xd7${e.data.header.dim[1]}\xd7${e.data.header.dim[2]}`})});return function(r){return n.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}}),Mnt=nn.BuiltIn({name:"volume-from-dx",display:{name:"Parse DX",description:"Create volume from DX data."},from:Se.Format.Dx,to:Se.Volume.Data})({apply:({a:e})=>Ke.create("Parse DX",function(){var t=le(function*(n){const r=yield function Ent(e,t){return Ke.create("Create Volume",le(function*(){const{header:n,values:r}=e,i=mr.Space(n.dim,[0,1,2],Float64Array),o=mr.create(i,mr.Data1(r)),s=fe.fromTranslation(fe(),n.min),a=fe.fromScaling(fe(),n.h);return fe.mul(s,s,a),{label:t?.label,entryId:t?.entryId,grid:{transform:{kind:"matrix",matrix:s},cells:o,stats:{min:OR(r),max:Bh(r),mean:BR(r),sigma:LR(r)}},sourceData:iG.create(e),customProperties:new Oh,_propertyData:Object.create(null)}}))}(e.data,{label:e.data.name||e.label}).runInContext(n);return new Se.Volume.Data(r,{label:r.label||"Volume",description:`Volume ${e.data.header.dim[0]}\xd7${e.data.header.dim[1]}\xd7${e.data.header.dim[2]}`})});return function(n){return t.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}}),Rnt=nn.BuiltIn({name:"volume-from-density-server-cif",display:{name:"Volume from density-server CIF",description:"Identify and create all separate models in the specified CIF data block"},from:Se.Format.Cif,to:Se.Volume.Data,params(e){if(!e)return{blockHeader:I.Optional(I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),entryId:I.Text("")};const t=e.data.blocks.slice(1);return{blockHeader:I.Optional(I.Select(t[0]&&t[0].header,t.map(n=>[n.header,n.header]),{description:"Header of the block to parse"})),entryId:I.Text("")}}})({isApplicable:e=>e.data.blocks.length>0,apply:({a:e,params:t})=>Ke.create("Parse density-server CIF",function(){var n=le(function*(r){var i;const o=t.blockHeader||e.data.blocks[1].header,s=e.data.blocks.find(p=>p.header===o);if(!s)throw new Error(`Data block '${[o]}' not found.`);const a=Hh.schema.densityServer(s),l=yield pfe(a,{entryId:t.entryId}).runInContext(r),[c,u,d]=l.grid.cells.space.dimensions,f={label:null!==(i=t.entryId)&&void 0!==i?i:a.volume_data_3d_info.name.value(0),description:`Volume ${c}\xd7${u}\xd7${d}`};return new Se.Volume.Data(l,f)});return function(r){return n.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}}),Nnt=nn.BuiltIn({name:"volume-from-segmentation-cif",display:{name:"Volume from Segmentation CIF"},from:Se.Format.Cif,to:Se.Volume.Data,params(e){const t=e?.data.blocks.slice(1);return{blockHeader:I.Optional(t?I.Select(t[0]&&t[0].header,t.map(r=>[r.header,r.header]),{description:"Header of the block to parse"}):I.Text(void 0,{description:"Header of the block to parse. If none is specifed, the 1st data block in the file is used."})),segmentLabels:I.ObjectList({id:I.Numeric(-1),label:I.Text("")},r=>`${r.id} = ${r.label}`,{description:"Mapping of segment IDs to segment labels"}),ownerId:I.Text("",{isHidden:!0,description:"Reference to the object which manages this volume"})}}})({isApplicable:e=>e.data.blocks.length>0,apply:({a:e,params:t})=>Ke.create("Parse segmentation CIF",function(){var n=le(function*(r){const i=t.blockHeader||e.data.blocks[1].header,o=e.data.blocks.find(p=>p.header===i);if(!o)throw new Error(`Data block '${[i]}' not found.`);const s=Hh.schema.segmentation(o),a={};for(const p of t.segmentLabels)a[p.id]=p.label;const l=yield function Tnt(e,t){return Ke.create("Create Segmentation Volume",function(){var n=le(function*(r){var i;const{volume_data_3d_info:o,segmentation_data_3d:s}=e,a=Qc.create(o.spacegroup_number.value(0),C.ofArray(o.spacegroup_cell_size.value(0)),C.scale(C(),C.ofArray(o.spacegroup_cell_angles.value(0)),Math.PI/180)),l=o.axis_order.value(0),c=mr.convertToCanonicalAxisIndicesFastToSlow(l),u=c(o.sample_count.value(0)),d=mr.Space(u,mr.invertAxisOrder(l),Float32Array),f=mr.create(d,mr.Data1(s.values.toArray({array:Float32Array}))),p=C.ofArray(c(o.origin.value(0))),m=C.ofArray(c(o.dimensions.value(0))),h={label:t?.label,entryId:void 0,grid:{transform:{kind:"spacegroup",cell:a,fractionalBox:Gt.create(p,C.add(C(),p,m))},cells:f,stats:{min:0,max:1,mean:0,sigma:1}},sourceData:oG.create(e),customProperties:new Oh,_propertyData:{ownerId:t?.ownerId}};mt.PickingGranularity.set(h,"object");const g=new Map,y=new Map,{segment_id:v,set_id:x}=e.segmentation_data_table;for(let W=0,z=v.rowCount;W<z;++W){const $=v.value(W),V=x.value(W);0===V||0===$||(y.has(V)||y.set(V,new Set),y.get(V).add($))}y.forEach((W,z)=>{W.forEach($=>{g.has($)||g.set($,new Set),g.get($).add(z)})});const _=[0,0,0],w=f.space.getCoords,A=f.data,[M,E,D]=h.grid.cells.space.dimensions,T=M-1,F=E-1,R=D-1,N={};y.forEach((W,z)=>{N[z]=[T,F,R,-1,-1,-1]});for(let W=0,z=A.length;W<z;++W){const $=A[W];if(0===$)continue;w(W,_);const V=N[$];_[0]<V[0]&&(V[0]=_[0]),_[1]<V[1]&&(V[1]=_[1]),_[2]<V[2]&&(V[2]=_[2]),_[0]>V[3]&&(V[3]=_[0]),_[1]>V[4]&&(V[4]=_[1]),_[2]>V[5]&&(V[5]=_[2])}const j={};return g.forEach((W,z)=>{j[z]=Gt.create(C.create(T,F,R),C.create(-1,-1,-1))}),Nu(N,(W,z)=>{y.get(parseInt(z)).forEach($=>{const V=j[$];W[0]<V.min[0]&&(V.min[0]=W[0]),W[1]<V.min[1]&&(V.min[1]=W[1]),W[2]<V.min[2]&&(V.min[2]=W[2]),W[3]>V.max[0]&&(V.max[0]=W[3]),W[4]>V.max[1]&&(V.max[1]=W[4]),W[5]>V.max[2]&&(V.max[2]=W[5])})}),mt.Segmentation.set(h,{segments:g,sets:y,bounds:j,labels:null!==(i=t?.segmentLabels)&&void 0!==i?i:{}}),h});return function(r){return n.apply(this,arguments)}}())}(s,{segmentLabels:a,ownerId:t.ownerId}).runInContext(r),[c,u,d]=l.grid.cells.space.dimensions,f={label:s.volume_data_3d_info.name.value(0),description:`Segmentation ${c}\xd7${u}\xd7${d}`};return new Se.Volume.Data(l,f)});return function(r){return n.apply(this,arguments)}}()),dispose({b:e}){e?.data.customProperties.dispose()}}),Fnt=nn.BuiltIn({name:"assign-color-volume",display:{name:"Assign Color Volume",description:"Assigns another volume to be available for coloring."},from:Se.Volume.Data,to:Se.Volume.Data,isDecorator:!0,params(e,t){if(!e)return{ref:I.Text()};const n=t.state.data.select(Qn.Generators.root.subtree().ofType(Se.Volume.Data).filter(r=>{var i;return!(!r.obj||null!==(i=r.obj)&&void 0!==i&&i.data.colorVolume||r.obj===e)}));return 0===n.length?{ref:I.Text("",{isHidden:!0})}:{ref:I.Select(n[0].transform.ref,n.map(r=>[r.transform.ref,r.obj.label]))}}})({apply:({a:e,params:t,dependencies:n})=>Ke.create("Assign Color Volume",function(){var r=le(function*(i){if(!n||!n[t.ref])throw new Error("Dependency not available.");const s={...e.data,colorVolume:n[t.ref].data};return new Se.Volume.Data(s,{label:e.label,description:"Volume + Colors"})});return function(i){return r.apply(this,arguments)}}())}),GN=st(13421772),wpe={},Lnt={name:"carbohydrate-symbol",label:"Carbohydrate Symbol",category:xo.Residue,factory:function Ape(e,t){let n;if(e.structure){const{elements:r,getElementIndices:i}=e.structure.carbohydrates,o=(s,a)=>{if(!ze.isAtomic(s))return GN;const l=i(s,a);return l.length>0?r[l[0]].component.color:GN};n=(s,a)=>a?15854817:dt.is(s)?o(s.unit,s.element):fn.isLocation(s)?o(s.aUnit,s.aUnit.elements[s.aIndex]):GN}else n=()=>GN;return{factory:Ape,granularity:"group",color:n,props:t,description:"Assigns colors according to the Symbol Nomenclature for Glycans (SNFG).",legend:v1(s6e)}},getParams:function Bnt(e){return wpe},defaultValues:I.getDefaultValues(wpe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>Sn.hasCarbohydrate(t))},Ipe={hue:I.Interval([1,360],{min:0,max:360,step:1}),chroma:I.Interval([40,70],{min:0,max:100,step:1}),luminance:I.Interval([15,85],{min:0,max:100,step:1}),sort:I.Select("contrast",I.arrayToOptions(["none","contrast"]),{description:"no sorting leaves colors approximately ordered by hue"}),clusteringStepCount:I.Numeric(50,{min:10,max:200,step:1},{isHidden:!0}),minSampleCount:I.Numeric(800,{min:100,max:5e3,step:100},{isHidden:!0}),sampleCountFactor:I.Numeric(5,{min:1,max:100,step:1},{isHidden:!0})},cA=2,F_=[0,0,0],O_=[0,0,0];function jnt(e,t){return qa.toHcl(F_,e),qa.fromColor(O_,qa.toColor(e)),F_[0]>=t.hue[0]&&F_[0]<=t.hue[1]&&F_[1]>=t.chroma[0]&&F_[1]<=t.chroma[1]&&F_[2]>=t.luminance[0]&&F_[2]<=t.luminance[1]&&O_[0]>=e[0]-cA&&O_[0]<=e[0]+cA&&O_[1]>=e[1]-cA&&O_[1]<=e[1]+cA&&O_[2]>=e[2]-cA&&O_[2]<=e[2]+cA}function Epe(e,t){let n=1/0,r=0;for(let i=0;i<e.length;i++){const o=qa.distance(t,e[i]);o<n&&(n=o,r=i)}return r}const Tpe={type:"generate",colorList:"red-yellow-blue"};function cu(e={}){const t={...Tpe,...e};return{palette:I.MappedStatic(t.type,{colors:I.Group({list:I.ColorList(t.colorList)},{isFlat:!0}),generate:I.Group({...Ipe,maxCount:I.Numeric(75,{min:1,max:250,step:1})},{isFlat:!0})},{options:[["colors","Color List"],["generate","Generate Distinct"]]})}}I.getDefaultValues(cu());const Dpe={valueLabel:e=>`${e+1}`,minLabel:"Start",maxLabel:"End"};function Yu(e,t,n={}){var r;let i,o;if("colors"===t.palette.name&&"interpolate"===t.palette.params.list.kind){const{list:s}=t.palette.params,a=[0,e-1],{minLabel:l,maxLabel:c}={...Dpe,...n};let u=s.colors;0===u.length&&(u=cp(Tpe.colorList).list);const d=up.create({listOrName:u,domain:a,minLabel:l,maxLabel:c});o=d.legend,i=d.color}else{let s;"colors"===t.palette.name?(s=t.palette.params.list.colors.map(u=>Array.isArray(u)?u[0]:u),0===s.length&&(s=cp("dark-2").list.map(u=>Array.isArray(u)?u[0]:u))):(e=Math.min(e,t.palette.params.maxCount),s=function Vnt(e,t={}){const n={...I.getDefaultValues(Ipe),...t};if(e<=0)return[];const r=function znt(e,t){const n=new Map,r=Math.ceil(Math.cbrt(e)),i=Vh(),o=Math.max((t.hue[1]-t.hue[0])/r,1),s=Math.max((t.chroma[1]-t.chroma[0])/r,1),a=Math.max((t.luminance[1]-t.luminance[0])/r,1);for(let l=t.hue[0]+o/2;l<=t.hue[1];l+=o)for(let c=t.chroma[0]+s/2;c<=t.chroma[1];c+=s)for(let u=t.luminance[0]+a/2;u<=t.luminance[1];u+=a){const d=qa.fromHcl(qa(),Vh.set(i,l,c,u));jnt(d,t)&&n.set(qa.toColor(d),d)}return Array.from(n.values())}(Math.max(n.minSampleCount,e*n.sampleCountFactor),n);if(r.length<e)return console.warn("Not enough samples to generate distinct colors, increase sample count."),new Array(e).fill(qn.lightgrey);const i=[],o=[],s=Math.floor(r.length/e);for(let l=0;l<r.length&&(i.push(r[l]),o.push([]),!(i.length>=e));l+=s);for(let l=1;l<=n.clusteringStepCount;++l){const c=op(o),u=op(r);for(let f=0;f<i.length;++f){const p=Epe(u,i[f]);c[f].push(r[p]),u.splice(p,1)}for(let f=0;f<u.length;++f)c[Epe(i,r[f])].push(r[f]);const d=op(i);for(let f=0;f<c.length;++f){const p=c[f],m=p.length;if(0===m)continue;let h=0,g=0,y=0;for(const w of p)h+=w[0],g+=w[1],y+=w[2];i[f]=[h/m,g/m,y/m]}if(tg(d,i))break}return("contrast"===n.sort?function Unt(e){const t=e.slice(0),n=[t.shift()];for(;t.length>0;){const r=n[n.length-1];let i=0,o=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;++s){const a=qa.distance(r,t[s]);a>o&&(o=a,i=s)}n.push(t.splice(i,1)[0])}return n}(i):i).map(l=>qa.toColor(l))}(e,t.palette.params));const a=null!==(r=n.valueLabel)&&void 0!==r?r:Dpe.valueLabel,l=s.length,c=[];for(let u=0;u<e;++u){const d=u%l;void 0===c[d]?c[d]=[a(u),s[d]]:c[d][0]+=`, ${a(u)}`}o=v1(c),i=u=>s[u%l]}return{color:i,legend:o}}const Ppe=st(16448250),Gnt="Gives every chain a color based on its `asym_id` value.",YD={asymId:I.Select("auth",I.arrayToOptions(["auth","label"])),...cu({type:"colors",colorList:"many-distinct"})};function kpe(e,t){const n=function Wnt(e,t){switch(e.kind){case 0:return"auth"===t?Je.chain.auth_asym_id:Je.chain.label_asym_id;case 1:case 2:return Je.coarse.asym_id}}(e.unit,t)(e);return e.structure.root.models.length>1?Mpe(e.unit.model,n):n}function Mpe(e,t){return`${t}|${(Sn.Index.get(e).value||0)+1}`}function XD(e,t){let n,r;if(e.structure){const i=dt.create(e.structure.root),o=function $nt(e,t){const n=new Map;for(const r of e.models){const i=Sn.AsymIdOffset.get(r).value,o=("auth"===t?i?.auth:i?.label)||0;let s=0;r.properties.structAsymMap.forEach(({auth_id:a},l)=>{const c="auth"===t?a:l,u=e.models.length>1?Mpe(r,c):c;n.has(u)||(n.set(u,s+o),++s)})}return n}(e.structure.root,t.asymId),s=Array.from(o.keys()),l=Yu(o.size,t,{valueLabel:c=>s[c]});r=l.legend,n=c=>{let u;if(dt.is(c)){const d=kpe(c,t.asymId);u=o.get(d)}else if(fn.isLocation(c)){i.unit=c.aUnit,i.element=c.aUnit.elements[c.aIndex];const d=kpe(i,t.asymId);u=o.get(d)}return void 0===u?Ppe:l.color(u)}}else n=()=>Ppe;return{factory:XD,granularity:"group",color:n,props:t,description:Gnt,legend:r}}const Rpe={name:"chain-id",label:"Chain Id",category:xo.Chain,factory:XD,getParams:function qnt(e){var t;const n=I.clone(YD);return!(null===(t=e.structure)||void 0===t)&&t.models.some(r=>r.coarseHierarchy.isDefined)&&(n.asymId.defaultValue="label"),n},defaultValues:I.getDefaultValues(YD),isApplicable:e=>!!e.structure},Npe=st(13421772),Fpe={...cu({type:"colors",colorList:"red-yellow-blue"})},Knt={name:"element-index",label:"Element Index",category:xo.Atom,factory:function Ope(e,t){let n,r;if(e.structure){const{units:i}=e.structure.root,o=i.length,s=new Map,a=new Map;let l=0;for(let u=0;u<o;++u)s.set(u,l),l+=i[u].elements.length,a.set(i[u].id,u);const c=Yu(l,t);r=c.legend,n=u=>{if(dt.is(u)){const d=a.get(u.unit.id),f=Ve.findPredecessorIndex(i[d].elements,u.element);return c.color(s.get(d)+f)}if(fn.isLocation(u)){const d=a.get(u.aUnit.id),f=Ve.findPredecessorIndex(i[d].elements,u.aUnit.elements[u.aIndex]);return c.color(s.get(d)+f)}return Npe}}else n=()=>Npe;return{factory:Ope,granularity:"groupInstance",preferSmoothing:!0,color:n,props:t,description:"Gives every element (atom or coarse sphere/gaussian) a unique color based on the position (index) of the element in the list of elements in the structure.",legend:r}},getParams:function Xnt(e){return Fpe},defaultValues:I.getDefaultValues(Fpe),isApplicable:e=>!!e.structure};function qN(e){const t={};return Nu(e,(n,r)=>{t[r]=I.Color(e[r])}),t}const Bpe=st(13421772),Qnt="Assigns a color based on the operator name of a transformed chain.",sG={...cu({type:"colors",colorList:"many-distinct"})};function aG(e,t){let n,r;if(e.structure){const i=function ert(e){const t=new Map;for(let n=0,r=e.units.length;n<r;++n){const i=e.units[n].conformation.operator.name;t.has(i)||t.set(i,t.size)}return t}(e.structure.root),o=Array.from(i.keys()),a=Yu(i.size,t,{valueLabel:l=>o[l]});r=a.legend,n=l=>{let c;return dt.is(l)?c=i.get(l.unit.conformation.operator.name):fn.isLocation(l)&&(c=i.get(l.aUnit.conformation.operator.name)),void 0===c?Bpe:a.color(c)}}else n=()=>Bpe;return{factory:aG,granularity:"instance",color:n,props:t,description:Qnt,legend:r}}const lG={name:"operator-name",label:"Operator Name",category:xo.Symmetry,factory:aG,getParams:function Jnt(e){return I.clone(sG)},defaultValues:I.getDefaultValues(sG),isApplicable:e=>!!e.structure},Lpe=st(16448250),nrt="Gives every chain a color based on its `label_entity_id` value.",KD={...cu({type:"colors",colorList:"many-distinct"})};function ZD(e,t){return`${e}|${t}`}function jpe(e){switch(e.unit.kind){case 0:return Je.chain.label_entity_id(e);case 1:case 2:return Je.coarse.entity_id(e)}}function QD(e,t){let n,r;if(e.structure){const i=dt.create(e.structure.root),o=function irt(e){const t=new Map;for(let n=0,r=e.models.length;n<r;++n){const{label_entity_id:i}=e.models[n].atomicHierarchy.chains;for(let s=0,a=i.rowCount;s<a;++s){const l=ZD(i.value(s),n);t.has(l)||t.set(l,t.size)}const{coarseHierarchy:o}=e.models[n];if(o.isDefined){const{entity_id:s}=o.spheres;for(let l=0,c=s.rowCount;l<c;++l){const u=ZD(s.value(l),n);t.has(u)||t.set(u,t.size)}const{entity_id:a}=o.gaussians;for(let l=0,c=a.rowCount;l<c;++l){const u=ZD(a.value(l),n);t.has(u)||t.set(u,t.size)}}}return t}(e.structure.root),s=Array.from(o.keys()),l=Yu(o.size,t,{valueLabel:c=>s[c]});r=l.legend,n=c=>{let u;if(dt.is(c)){const p=ZD(jpe(c),c.structure.models.indexOf(c.unit.model));u=o.get(p)}else if(fn.isLocation(c)){i.unit=c.aUnit,i.element=c.aUnit.elements[c.aIndex];const p=ZD(jpe(i),i.structure.models.indexOf(i.unit.model));u=o.get(p)}return void 0===u?Lpe:l.color(u)}}else n=()=>Lpe;return{factory:QD,granularity:"group",color:n,props:t,description:nrt,legend:r}}const ort={name:"entity-id",label:"Entity Id",category:xo.Chain,factory:QD,getParams:function rrt(e){return I.clone(KD)},defaultValues:I.getDefaultValues(KD),isApplicable:e=>!!e.structure},cG="dark-2",WN=st(16448250),srt="Gives ranges of a polymer chain a color based on the entity source it originates from (e.g. gene, plasmid, organism).",JD={...cu({type:"colors",colorList:cG})};function Upe(e,t){return`${e}|${t}`}function lrt(e,t,n,r,i,o){return`${e}|${t}|${n}|${o||i||r}`}function uG(e,t,n,r,i,o,s,a){const{entity_id:l,pdbx_src_id:c,pdbx_beg_seq_num:u,pdbx_end_seq_num:d}=i;for(let f=0,p=i._rowCount;f<p;++f){const m=l.value(f),h=Upe(n,m);let g;if(e.has(h))g=e.get(h);else{const M=r.entities.getEntityIndex(m);g=new Int16Array(r.sequence.sequences[M].sequence.length),e.set(h,g)}const y=s?s.value(f):"",v=a?a.value(f)[0]:"",x=lrt(n,m,o.value(f),c.value(f),y,v),_=0===u.valueKind(f)?u.value(f):1,w=0===d.valueKind(f)?d.value(f):g.length;let A;t.has(x)?A=t.get(x):(A=t.size+1,t.set(x,A));for(let M=_,E=w;M<=E;++M)g[M-1]=A}}function zpe(e){const t=new Map,n=new Map;for(let r=0,i=e.length;r<i;++r){const o=e[r];if(!Ui.is(o.sourceData))continue;const{entity_src_gen:s,entity_src_nat:a,pdbx_entity_src_syn:l}=o.sourceData.data.db;uG(t,n,r,o,s,s.pdbx_gene_src_scientific_name,s.plasmid_name,s.pdbx_gene_src_gene),uG(t,n,r,o,a,a.pdbx_organism_scientific,a.pdbx_plasmid_name),uG(t,n,r,o,l,l.organism_scientific)}return{seqToSrcByModelEntity:t,srcKeySerialMap:n}}function eP(e,t){let n,r;if(e.structure){const i=dt.create(e.structure),{models:o}=e.structure.root,{seqToSrcByModelEntity:s,srcKeySerialMap:a}=zpe(o),l=function crt(e){let t=0;return Array.from(e.keys()).map(n=>{const r=n.split("|"),i=r[2];return`${function u8e(e){e=e.trim();const t=parseInt(e,10);return!isNaN(t)&&t.toString()===e}(r[3])?"Unnamed "+ ++t:r[3]}${i?` (${i})`:""}`})}(a),u=Yu(a.size,t,{valueLabel:f=>l[f]});r=u.legend;const d=f=>{const h=Upe(o.indexOf(f.unit.model),Je.entity.id(f)),g=s.get(h);if(g){const y=g[Je.residue.label_seq_id(f)-1]-1;return-1===y?WN:u.color(y)}return WN};n=f=>dt.is(f)?d(f):fn.isLocation(f)?(i.unit=f.aUnit,i.element=f.aUnit.elements[f.aIndex],d(i)):WN}else n=()=>WN;return{factory:eP,granularity:"group",color:n,props:t,description:srt,legend:r}}const urt={name:"entity-source",label:"Entity Source",category:xo.Chain,factory:eP,getParams:function art(e){const t=I.clone(JD);return e.structure&&zpe(e.structure.root.models).srcKeySerialMap.size>Ad[cG].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:cp(cG).list}}),t},defaultValues:I.getDefaultValues(JD),isApplicable:e=>!!e.structure},Vpe=st(13421772),drt="Gives every model a unique color based on its index.",tP={...cu({type:"colors",colorList:"many-distinct"})};function nP(e,t){var n;let r,i;if(e.structure){const s=Yu((null!==(n=Sn.MaxIndex.get(e.structure.models[0]).value)&&void 0!==n?n:-1)+1,t);i=s.legend,r=a=>dt.is(a)?s.color(Sn.Index.get(a.unit.model).value||0):fn.isLocation(a)?s.color(Sn.Index.get(a.aUnit.model).value||0):Vpe}else r=()=>Vpe;return{factory:nP,granularity:"instance",color:r,props:t,description:drt,legend:i}}const prt={name:"model-index",label:"Model Index",category:xo.Chain,factory:nP,getParams:function frt(e){return I.clone(tP)},defaultValues:I.getDefaultValues(tP),isApplicable:e=>!!e.structure&&e.structure.elementCount>0},Hpe=st(13421772),hrt="Gives every structure a unique color based on its index.",rP={...cu({type:"colors",colorList:"many-distinct"})};function iP(e,t){var n;let r,i;if(e.structure){const s=Yu((null!==(n=Xe.MaxIndex.get(e.structure).value)&&void 0!==n?n:-1)+1,t);i=s.legend,r=a=>dt.is(a)?s.color(Xe.Index.get(a.structure).value||0):fn.isLocation(a)?s.color(Xe.Index.get(a.aStructure).value||0):Hpe}else r=()=>Hpe;return{factory:iP,granularity:"instance",color:r,props:t,description:hrt,legend:i}}const grt={name:"structure-index",label:"Structure Index",category:xo.Chain,factory:iP,getParams:function mrt(e){return I.clone(rP)},defaultValues:I.getDefaultValues(rP),isApplicable:e=>!!e.structure&&e.structure.elementCount>0},dG="dark-2",Gpe=st(13421772),yrt="Gives every chain instance (single chain or collection of single elements) a unique color based on the position (index) of the chain in the list of chains in the structure.",fG={...cu({type:"colors",colorList:dG})};function pG(e,t){let n,r;if(e.structure){const{units:i}=e.structure.root,o=Yu(i.length,t);r=o.legend;const s=new Map;for(let a=0,l=i.length;a<l;++a)s.set(i[a].id,o.color(a));n=a=>dt.is(a)?s.get(a.unit.id):fn.isLocation(a)?s.get(a.aUnit.id):Gpe}else n=()=>Gpe;return{factory:pG,granularity:"instance",color:n,props:t,description:yrt,legend:r}}const vrt={name:"unit-index",label:"Chain Instance",category:xo.Chain,factory:pG,getParams:function brt(e){const t=I.clone(fG);return e.structure&&e.structure.root.units.length>Ad[dG].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:cp(dG).list}}),t},defaultValues:I.getDefaultValues(fG),isApplicable:e=>!!e.structure},qpe={H:16777215,D:16777152,T:16777120,HE:14286847,LI:13402367,BE:12779264,B:16758197,C:9474192,N:3166456,O:16715021,F:9494608,NE:11789301,NA:11230450,MG:9109248,AL:12560038,SI:1578e4,P:16744448,S:16777008,CL:2093087,AR:8442339,K:9388244,CA:4062976,SC:15132390,TI:12567239,V:10921643,CR:9083335,MN:10255047,FE:14706227,CO:15765664,NI:5296208,CU:13140019,ZN:8224944,GA:12750735,GE:6721423,AS:12419299,SE:16752896,BR:10889513,KR:6076625,RB:7351984,SR:65280,Y:9764863,ZR:9756896,NB:7586505,MO:5551541,TC:3907230,RU:2396047,RH:687500,PD:27013,AG:12632256,CD:16767375,IN:10909043,SN:6717568,SB:10380213,TE:13924864,I:9699476,XE:9699476,CS:5707663,BA:51456,LA:7394559,CE:16777159,PR:14286791,ND:13107143,PM:10747847,SM:9437127,EU:6422471,GD:4587463,TB:3211207,DY:2097095,HO:65436,ER:58997,TM:54354,YB:48952,LU:43812,HF:5096191,TA:5089023,W:2200790,RE:2522539,OS:2516630,IR:1528967,PT:13684960,AU:16765219,HG:12105936,TL:10900557,PB:5724513,BI:10375093,PO:11230208,AT:7688005,RN:4358806,FR:4325478,RA:32e3,AC:7384058,TH:47871,PA:41471,U:36863,NP:33023,PU:27647,AM:5528818,CM:7888099,BK:9064419,CF:10565332,ES:11739092,FM:11739066,MD:11734438,NO:12389767,LR:13041766,RF:13369433,DB:13697103,SG:14221381,BH:14680120,HS:15073326,MT:15400998,DS:16777215,RG:16777215,CN:16777215,UUT:16777215,FL:16777215,UUP:16777215,LV:16777215,UUH:16777215},Wpe=st(16777215),hG={carbonColor:I.MappedStatic("chain-id",{"chain-id":I.Group(YD),"unit-index":I.Group(fG,{label:"Chain Instance"}),"entity-id":I.Group(KD),"entity-source":I.Group(JD),"operator-name":I.Group(sG),"model-index":I.Group(tP),"structure-index":I.Group(rP),uniform:I.Group(Vw),"element-symbol":I.EmptyGroup()},{description:"Use chain-id coloring for carbon atoms."}),saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(.2,{min:-6,max:6,step:.1}),colors:I.MappedStatic("default",{default:I.EmptyGroup(),custom:I.Group(qN(qpe))})};function mG(e,t){var n;const r=YR("default"===t.colors.name?qpe:t.colors.params,t.saturation,t.lightness),i=null===(n=function Crt(e,t){switch(t.name){case"chain-id":return XD(e,t.params);case"unit-index":return pG(e,t.params);case"entity-id":return QD(e,t.params);case"entity-source":return eP(e,t.params);case"operator-name":return aG(e,t.params);case"model-index":return nP(e,t.params);case"structure-index":return iP(e,t.params);case"uniform":return I_(0,t.params);case"element-symbol":return;default:Hi()}}(e,t.carbonColor))||void 0===n?void 0:n.color;function o(l,c){return i&&"C"===l?i(c,!1):function Srt(e,t){const n=e[t];return void 0===n?Wpe:n}(r,l)}return{factory:mG,granularity:"operator-name"===t.carbonColor.name||"unit-index"===t.carbonColor.name?"groupInstance":"group",preferSmoothing:!0,color:function s(l){if(dt.is(l)){if(ze.isAtomic(l.unit)){const{type_symbol:c}=l.unit.model.atomicHierarchy.atoms;return o(c.value(l.element),l)}}else if(fn.isLocation(l)&&ze.isAtomic(l.aUnit)){const{type_symbol:c}=l.aUnit.model.atomicHierarchy.atoms;return o(c.value(l.aUnit.elements[l.aIndex]),l)}return Wpe},props:t,description:"Assigns a color to every atom according to its chemical element.",legend:v1(Object.keys(r).map(l=>[l,r[l]]))}}const wrt={name:"element-symbol",label:"Element Symbol",category:xo.Atom,factory:mG,getParams:function _rt(e){return I.clone(hG)},defaultValues:I.getDefaultValues(hG),isApplicable:e=>!!e.structure},$pe={water:3697840,ion:15729279,protein:12496596,RNA:16629894,DNA:12540695,PNA:4367514,saccharide:8374655},gG=st(16777113),$N={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1}),colors:I.MappedStatic("default",{default:I.EmptyGroup(),custom:I.Group(qN($pe))})};function Ype(e,t,n){switch(gz(t,n)){case 2:return e.water;case 3:return e.ion;case 5:return e.protein;case 6:return e.RNA;case 7:return e.DNA;case 8:return e.PNA;case 9:return e.saccharide}return gG}function YN(e,t){const n=YR("default"===t.colors.name?$pe:t.colors.params,t.saturation,t.lightness);return{factory:YN,granularity:"group",color:function r(i){return dt.is(i)?Ype(n,i.unit,i.element):fn.isLocation(i)?Ype(n,i.aUnit,i.aUnit.elements[i.aIndex]):gG},props:t,description:"Assigns a color based on the molecule type of a residue.",legend:v1(Object.keys(n).map(i=>[i,n[i]]).concat([["Other/unknown",gG]]))}}const Ert={name:"molecule-type",label:"Molecule Type",category:xo.Residue,factory:YN,getParams:function Irt(e){return $N},defaultValues:I.getDefaultValues($N),isApplicable:e=>!!e.structure},yG="dark-2",Xpe=st(16448250),Kpe={...cu({type:"colors",colorList:yG})};function Zpe(e){switch(e.kind){case 0:return Je.chain.label_asym_id;case 1:case 2:return Je.coarse.asym_id}}function Qpe(e){const t=new Map;for(let n=0,r=e.unitSymmetryGroups.length;n<r;++n){const i=e.unitSymmetryGroups[n].units[0],{model:o}=i;if(ze.isAtomic(i)){const{chainAtomSegments:s,chains:a}=o.atomicHierarchy,l=En.transientSegments(s,i.elements);for(;l.hasNext;){const{index:c}=l.move(),u=a.label_entity_id.value(c),d=o.entities.getEntityIndex(u);if("polymer"===o.entities.data.type.value(d)){const f=a.label_asym_id.value(c);t.has(f)||t.set(f,t.size)}}}else if(ze.isCoarse(i)){const{chainElementSegments:s,asym_id:a,entity_id:l}=ze.isSpheres(i)?o.coarseHierarchy.spheres:o.coarseHierarchy.gaussians,c=En.transientSegments(s,i.elements);for(;c.hasNext;){const{index:u}=c.move(),d=s.offsets[u],f=l.value(d),p=o.entities.getEntityIndex(f);if("polymer"===o.entities.data.type.value(p)){const m=a.value(d);t.has(m)||t.set(m,t.size)}}}}return t}const Prt={name:"polymer-id",label:"Polymer Chain Id",category:xo.Chain,factory:function Jpe(e,t){let n,r;if(e.structure){const i=dt.create(e.structure),o=Qpe(e.structure.root),s=Array.from(o.keys()),l=Yu(o.size,t,{valueLabel:c=>s[c]});r=l.legend,n=c=>{let u;if(dt.is(c)){const d=Zpe(c.unit);u=o.get(d(c))}else if(fn.isLocation(c)){const d=Zpe(c.aUnit);i.unit=c.aUnit,i.element=c.aUnit.elements[c.aIndex],u=o.get(d(i))}return void 0===u?Xpe:l.color(u)}}else n=()=>Xpe;return{factory:Jpe,granularity:"group",color:n,props:t,description:"Gives every polymer chain a color based on its `asym_id` value.",legend:r}},getParams:function Drt(e){const t=I.clone(Kpe);return e.structure&&Qpe(e.structure.root).size>Ad[yG].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:cp(yG).list}}),t},defaultValues:I.getDefaultValues(Kpe),isApplicable:e=>!!e.structure},bG="dark-2",ehe=st(13421772),the={...cu({type:"colors",colorList:bG})};function nhe(e){let t=0;const{units:n}=e;for(let r=0,i=n.length;r<i;++r)n[r].polymerElements.length>0&&++t;return t}const Rrt={name:"polymer-index",label:"Polymer Chain Instance",category:xo.Chain,factory:function rhe(e,t){let n,r;if(e.structure){const i=Yu(nhe(e.structure.root),t);r=i.legend;const{units:o}=e.structure.root,s=new Map;for(let a=0,l=0,c=o.length;a<c;++a)o[a].polymerElements.length>0&&(s.set(o[a].id,i.color(l)),++l);n=a=>{let l;return dt.is(a)?l=s.get(a.unit.id):fn.isLocation(a)&&(l=s.get(a.aUnit.id)),void 0!==l?l:ehe}}else n=()=>ehe;return{factory:rhe,granularity:"instance",color:n,props:t,description:"Gives every polymer chain instance a unique color based on the position (index) of the polymer in the list of polymers in the structure.",legend:r}},getParams:function Mrt(e){const t=I.clone(the);return e.structure&&nhe(e.structure.root)>Ad[bG].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:cp(bG).list}}),t},defaultValues:I.getDefaultValues(the),isApplicable:e=>!!e.structure},ihe={ALA:9240460,ARG:124,ASN:16743536,ASP:10485826,CYS:16777072,GLN:16731212,GLU:6684672,GLY:15658734,HIS:7368959,ILE:19456,LEU:4546117,LYS:4671416,MET:12099650,PHE:5459026,PRO:5395026,SER:16740418,THR:12078080,TRP:5195264,TYR:9203788,VAL:16747775,A:14423100,G:3329330,I:10145074,C:16766720,T:4286945,U:4251856,DA:14423100,DG:3329330,DI:10145074,DC:16766720,DT:4286945,DU:4251856,APN:14423100,GPN:3329330,CPN:16766720,TPN:4286945},vG=st(16711935),xG={saturation:I.Numeric(0,{min:-6,max:6,step:.1}),lightness:I.Numeric(1,{min:-6,max:6,step:.1}),colors:I.MappedStatic("default",{default:I.EmptyGroup(),custom:I.Group(qN(ihe))})};function ohe(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function she(e,t){const n=e.coarseElements.seq_id_begin.value(t);if(n===e.coarseElements.seq_id_end.value(t))return e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence.compId.value(n-1)}function XN(e,t){const n=e[t];return void 0===n?vG:n}function _G(e,t){const n=YR("default"===t.colors.name?ihe:t.colors.params,t.saturation,t.lightness);return{factory:_G,granularity:"group",preferSmoothing:!0,color:function r(i){if(dt.is(i)){if(ze.isAtomic(i.unit)){const o=ohe(i.unit,i.element);return XN(n,o)}{const o=she(i.unit,i.element);if(o)return XN(n,o)}}else if(fn.isLocation(i)){if(ze.isAtomic(i.aUnit)){const o=ohe(i.aUnit,i.aUnit.elements[i.aIndex]);return XN(n,o)}{const o=she(i.aUnit,i.aUnit.elements[i.aIndex]);if(o)return XN(n,o)}}return vG},props:t,description:"Assigns a color to every residue according to its name.",legend:v1(Object.keys(n).map(i=>[i,n[i]]).concat([["Unknown",vG]]))}}const Ort={name:"residue-name",label:"Residue Name",category:xo.Residue,factory:_G,getParams:function Frt(e){return xG},defaultValues:I.getDefaultValues(xG),isApplicable:e=>!!e.structure},ahe={alphaHelix:16711808,threeTenHelix:10485888,piHelix:6291584,betaTurn:6324479,betaStrand:16762880,coil:16777215,bend:6740169,turn:45670,dna:11403518,rna:16580962,carbohydrate:10921722},SG=st(8421504),CG={saturation:I.Numeric(-1,{min:-6,max:6,step:.1}),lightness:I.Numeric(0,{min:-6,max:6,step:.1}),colors:I.MappedStatic("default",{default:I.EmptyGroup(),custom:I.Group(qN(ahe))})};function lhe(e,t,n,r){let i=pi.create(0);if(r&&ze.isAtomic(t)){const o=r.get(t.invariantId);o&&(i=o.type[o.getIndex(t.residueIndex[n])])}if(pi.is(i,2))return pi.is(i,2048)?e.threeTenHelix:pi.is(i,32768)?e.piHelix:e.alphaHelix;if(pi.is(i,4))return e.betaStrand;if(pi.is(i,8))return e.bend;if(pi.is(i,16))return e.turn;{const o=gz(t,n);if(7===o)return e.dna;if(6===o)return e.rna;if(9===o)return e.carbohydrate;if(5===o)return e.coil}return SG}function wG(e,t){const n=e.structure&&gp.get(e.structure),r=n?Yx(n.id,n.version):-1,i=YR("default"===t.colors.name?ahe:t.colors.params,t.saturation,t.lightness);return{factory:wG,granularity:"group",preferSmoothing:!0,color:function o(s){return dt.is(s)?lhe(i,s.unit,s.element,n?.value):fn.isLocation(s)?lhe(i,s.aUnit,s.aUnit.elements[s.aIndex],n?.value):SG},props:t,contextHash:r,description:"Assigns a color based on the type of secondary structure and basic molecule type.",legend:v1(Object.keys(i).map(s=>[s,i[s]]).concat([["Other",SG]]))}}const jrt={name:"secondary-structure",label:"Secondary Structure",category:xo.Residue,factory:wG,getParams:function Lrt(e){return CG},defaultValues:I.getDefaultValues(CG),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?gp.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&gp.ref(e.structure,!1)}},Urt=st(13421772),che={list:I.ColorList("turbo",{presetKind:"scale"})};function uhe(e,t){const{model:n}=e;switch(e.kind){case 0:return n.atomicHierarchy.residues.label_seq_id.value(n.atomicHierarchy.residueAtomSegments.index[t]);case 1:return Math.round((n.coarseHierarchy.spheres.seq_id_begin.value(t)+n.coarseHierarchy.spheres.seq_id_end.value(t))/2);case 2:return Math.round((n.coarseHierarchy.gaussians.seq_id_begin.value(t)+n.coarseHierarchy.gaussians.seq_id_end.value(t))/2)}}function dhe(e,t){const{model:n}=e;let r="";switch(e.kind){case 0:r=n.atomicHierarchy.chains.label_entity_id.value(n.atomicHierarchy.chainAtomSegments.index[t]);break;case 1:r=n.coarseHierarchy.spheres.entity_id.value(t);break;case 2:r=n.coarseHierarchy.gaussians.entity_id.value(t)}if(""===r)return 0;const i=n.entities.getEntityIndex(r);if(-1===i)return 0;const o=n.sequence.byEntityKey[i];return void 0===o?0:o.sequence.length}const Hrt={name:"sequence-id",label:"Sequence Id",category:xo.Residue,factory:function fhe(e,t){const n=up.create({listOrName:t.list.colors,minLabel:"Start",maxLabel:"End"});return{factory:fhe,granularity:"group",preferSmoothing:!0,color:i=>{if(dt.is(i)){const{unit:o,element:s}=i,a=uhe(o,s);if(a>0){const l=dhe(o,s);if(l)return n.setDomain(0,l-1),n.color(a)}}else if(fn.isLocation(i)){const{aUnit:o,aIndex:s}=i,a=uhe(o,o.elements[s]);if(a>0){const l=dhe(o,o.elements[s]);if(l)return n.setDomain(0,l-1),n.color(a)}}return Urt},props:t,description:"Gives every polymer residue a color based on its `seq_id` value.",legend:n?n.legend:void 0}},getParams:function Vrt(e){return che},defaultValues:I.getDefaultValues(che),isApplicable:e=>!!e.structure},Grt=st(16777113),phe={domain:I.Interval([0,100]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function hhe(e,t){return ze.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t):ze.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]:0}const $rt={name:"uncertainty",label:"Uncertainty/Disorder",category:xo.Atom,factory:function mhe(e,t){const n=up.create({reverse:!0,domain:t.domain,listOrName:t.list.colors});return{factory:mhe,granularity:"group",preferSmoothing:!0,color:function r(i){return dt.is(i)?n.color(hhe(i.unit,i.element)):fn.isLocation(i)?n.color(hhe(i.aUnit,i.aUnit.elements[i.aIndex])):Grt},props:t,description:"Assigns a color based on the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique.",legend:n?n.legend:void 0}},getParams:function Wrt(e){return phe},defaultValues:I.getDefaultValues(phe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)},Yrt=st(15658734),ghe={style:I.MappedStatic("entity-id",{uniform:I.Group(Vw),"chain-id":I.Group(YD),"entity-id":I.Group(KD),"entity-source":I.Group(JD),"molecule-type":I.Group($N),"model-index":I.Group(tP),"structure-index":I.Group(rP)}),carbonLightness:I.Numeric(.8,{min:-6,max:6,step:.1})},Qrt={name:"illustrative",label:"Illustrative",category:xo.Misc,factory:function yhe(e,t){const{color:n,legend:r}=function Zrt(e,t){switch(t.name){case"uniform":return I_(0,t.params);case"chain-id":return XD(e,t.params);case"entity-id":return QD(e,t.params);case"entity-source":return eP(e,t.params);case"molecule-type":return YN(0,t.params);case"model-index":return nP(e,t.params);case"structure-index":return iP(e,t.params);default:Hi()}}(e,t.style);function i(s,a){const l=n(s,!1);return"C"===a?st.lighten(l,t.carbonLightness):l}return{factory:yhe,granularity:"group",preferSmoothing:!0,color:function o(s){if(dt.is(s)&&ze.isAtomic(s.unit)){const a=s.unit.model.atomicHierarchy.atoms.type_symbol.value(s.element);return i(s,a)}if(fn.isLocation(s)&&ze.isAtomic(s.aUnit)){const l=s.aUnit.model.atomicHierarchy.atoms.type_symbol.value(s.aUnit.elements[s.aIndex]);return i(s,l)}return Yrt},props:t,description:"Assigns an illustrative color that gives every chain a color based on the chosen style but with lighter carbons (inspired by David Goodsell's Molecule of the Month style).",legend:r}},getParams:function Krt(e){return I.clone(ghe)},defaultValues:I.getDefaultValues(ghe),isApplicable:e=>!!e.structure},bhe={list:I.ColorList("red-yellow-green",{presetKind:"scale"}),scale:I.Select("DGwif",[["DGwif","DG water-membrane"],["DGwoct","DG water-octanol"],["Oct-IF","DG difference"]])},tit={DGwif:0,DGwoct:1,"Oct-IF":2};function vhe(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(t)}function xhe(e,t){const n=e.coarseElements.seq_id_begin.value(t);if(n===e.coarseElements.seq_id_end.value(t))return e.model.sequence.byEntityKey[e.coarseElements.entityKey[t]].sequence.compId.value(n-1)}const rit={name:"hydrophobicity",label:"Hydrophobicity",category:xo.Residue,factory:function _he(e,t){const n=tit[t.scale];let r=1/0,i=-1/0;for(const a in nz){const l=nz[a][n];r=Math.min(r,l),i=Math.max(i,l)}const o=up.create({listOrName:t.list.colors,domain:[i,r],minLabel:"Hydrophilic",maxLabel:"Hydrophobic"});return{factory:_he,granularity:"group",preferSmoothing:!0,color:function s(a){let l;return dt.is(a)?l=ze.isAtomic(a.unit)?vhe(a.unit,a.element):xhe(a.unit,a.element):fn.isLocation(a)&&(l=ze.isAtomic(a.aUnit)?vhe(a.aUnit,a.aUnit.elements[a.aIndex]):xhe(a.aUnit,a.aUnit.elements[a.aIndex])),o.color(l?function nit(e,t){const n=nz[e];return void 0===n?0:n[t]}(l,n):0)},props:t,description:'Assigns a color to every amino acid according to the "Experimentally determined hydrophobicity scale for proteins at membrane interfaces" by Wimely and White (doi:10.1038/nsb1096-842).',legend:o?o.legend:void 0}},getParams:function eit(e){return bhe},defaultValues:I.getDefaultValues(bhe),isApplicable:e=>!!e.structure},She=st(13421772),Che={...cu({type:"colors",colorList:"purples"})},sit={name:"trajectory-index",label:"Trajectory Index",category:xo.Chain,factory:function whe(e,t){var n,r;let i,o;if(e.structure){const{models:s}=e.structure.root;let a=0;for(const u of s)a=Math.max(a,(null===(n=Sn.TrajectoryInfo.get(u))||void 0===n?void 0:n.size)||0);const l=Yu(a,t);o=l.legend;const c=new Map;for(let u=0,d=s.length;u<d;++u){const f=(null===(r=Sn.TrajectoryInfo.get(s[u]))||void 0===r?void 0:r.index)||0;c.set(f,l.color(f))}i=u=>dt.is(u)?c.get(Sn.TrajectoryInfo.get(u.unit.model).index):fn.isLocation(u)?c.get(Sn.TrajectoryInfo.get(u.aUnit.model).index):She}else i=()=>She;return{factory:whe,granularity:"instance",color:i,props:t,description:"Gives every model (frame) a unique color based on the index in its trajectory.",legend:o}},getParams:function oit(e){return I.clone(Che)},defaultValues:I.getDefaultValues(Che),isApplicable:e=>!!e.structure&&e.structure.elementCount>0&&Sn.TrajectoryInfo.get(e.structure.models[0]).size>1},ait=st(13421772),Ahe={domain:I.Interval([0,1]),list:I.ColorList("purples",{presetKind:"scale"})};function Ihe(e,t){return ze.isAtomic(e)?e.model.atomicConformation.occupancy.value(t):0}const uit={name:"occupancy",label:"Occupancy",category:xo.Atom,factory:function Ehe(e,t){const n=up.create({reverse:!1,domain:t.domain,listOrName:t.list.colors});return{factory:Ehe,granularity:"group",preferSmoothing:!0,color:function r(i){return dt.is(i)?n.color(Ihe(i.unit,i.element)):fn.isLocation(i)?n.color(Ihe(i.aUnit,i.aUnit.elements[i.aIndex])):ait},props:t,description:"Assigns a color based on the occupancy of an atom.",legend:n?n.legend:void 0}},getParams:function cit(e){return Ahe},defaultValues:I.getDefaultValues(Ahe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.occupancy.isDefined)},AG="dark-2",The=st(13421772),Dhe={...cu({type:"colors",colorList:AG})},oP=1e4;function IG(e){return e.map(t=>`${t+oP}`.padStart(5,"0")).join("")}function EG(e){const t=function l8e(e,t){return Math.abs(e)<t?0:Math.floor(Math.log10(Math.abs(e)))+1}(oP,0),n=parseInt(e.substr(0,t)),r=parseInt(e.substr(t,t)),i=parseInt(e.substr(t+t,t));return C.create(n-oP,r-oP,i-oP)}function TG(e){return e.map(t=>t+5).join("")}function Phe(e){const t=new Map,n=new Set;for(let s=0,a=e.units.length;s<a;++s){const l=IG(e.units[s].conformation.operator.hkl);n.add(l)}const r=Array.from(n.values()).sort();return r.forEach(s=>t.set(s,t.size)),{min:EG(r[0]),max:EG(r[r.length-1]),map:t}}const pit={name:"operator-hkl",label:"Operator HKL",category:xo.Symmetry,factory:function khe(e,t){let n,r;if(e.structure){const{min:i,max:o,map:s}=Phe(e.structure.root),a=[];s.forEach((u,d)=>{const f=u%s.size,p=TG(EG(d));void 0===a[f]?a[f]=p:a[f]+=`, ${p}`});const l={minLabel:TG(i),maxLabel:TG(o),valueLabel:u=>a[u]},c=Yu(s.size,t,l);r=c.legend,n=u=>{let d;if(dt.is(u)){const f=IG(u.unit.conformation.operator.hkl);d=s.get(f)}else if(fn.isLocation(u)){const f=IG(u.aUnit.conformation.operator.hkl);d=s.get(f)}return void 0===d?The:c.color(d)}}else n=()=>The;return{factory:khe,granularity:"instance",color:n,props:t,description:"Assigns a color based on the operator HKL value of a transformed chain.",legend:r}},getParams:function fit(e){const t=I.clone(Dhe);return e.structure&&Phe(e.structure.root).map.size>Ad[AG].list.length&&(t.palette.defaultValue.name="colors",t.palette.defaultValue.params={...t.palette.defaultValue.params,list:{kind:"interpolate",colors:cp(AG).list}}),t},defaultValues:I.getDefaultValues(Dhe),isApplicable:e=>!!e.structure},DG=st(16777113),Mhe={domain:I.Interval([-1,1]),list:I.ColorList("red-white-blue",{presetKind:"scale"})};function Rhe(e,t){var n;return null===(n=tA.Provider.get(e.model))||void 0===n?void 0:n.data.value(t)}const git={name:"partial-charge",label:"Partial Charge",category:xo.Atom,factory:function Nhe(e,t){const n=up.create({domain:t.domain,listOrName:t.list.colors});return{factory:Nhe,granularity:"group",preferSmoothing:!0,color:function r(i){if(dt.is(i)){const o=Rhe(i.unit,i.element);return void 0!==o?n.color(o):DG}if(fn.isLocation(i)){const o=Rhe(i.aUnit,i.aUnit.elements[i.aIndex]);return void 0!==o?n.color(o):DG}return DG},props:t,description:"Assigns a color based on the partial charge of an atom.",legend:n?n.legend:void 0}},getParams:function mit(e){return Mhe},defaultValues:I.getDefaultValues(Mhe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>void 0!==tA.Provider.get(t))},Fhe=st(16448250),Ohe={...cu({type:"colors",colorList:"many-distinct"})},_it={name:"atom-id",label:"Atom Id",category:xo.Atom,factory:function Bhe(e,t){let n,r;if(e.structure){const i=dt.create(e.structure.root),o=function xit(e){const t=new Map;for(const n of e.models){const{label_atom_id:r}=n.atomicHierarchy.atoms;for(let i=0,o=r.rowCount;i<o;++i){const s=r.value(i);t.has(s)||t.set(s,t.size)}}return t}(e.structure.root),s=Array.from(o.keys()),l=Yu(o.size,t,{valueLabel:c=>s[c]});r=l.legend,n=c=>{let u;if(dt.is(c)){const d=Je.atom.label_atom_id(c);u=o.get(d)}else if(fn.isLocation(c)){i.unit=c.aUnit,i.element=c.aUnit.elements[c.aIndex];const d=Je.atom.label_atom_id(i);u=o.get(d)}return void 0===u?Fhe:l.color(u)}}else n=()=>Fhe;return{factory:Bhe,granularity:"group",preferSmoothing:!0,color:n,props:t,description:"Gives every atom a color based on its `label_atom_id` value.",legend:r}},getParams:function vit(e){return I.clone(Ohe)},defaultValues:I.getDefaultValues(Ohe),isApplicable:e=>!!e.structure},Lhe={colorList:I.ColorList({kind:"interpolate",colors:[[qn.white,0],[qn.red,.25],[qn.white,.5],[qn.blue,.75],[qn.white,1]]},{offsets:!0,isEssential:!0})},wit={name:"volume-value",label:"Volume Value",category:xo.Misc,factory:function jhe(e,t){const n=up.create({domain:[0,1],listOrName:t.colorList.colors}),r=[];for(let o=0;o<256;++o)r[o]=n.color(o/255);return{factory:jhe,granularity:"direct",props:t,description:"Assign color based on the given value of a volume cell.",legend:n.legend,palette:{colors:r,filter:"linear"}}},getParams:function Cit(e){return Lhe},defaultValues:I.getDefaultValues(Lhe),isApplicable:e=>!!e.volume&&!mt.Segmentation.get(e.volume)},Uhe=st(13421772),zhe={...cu({type:"colors",colorList:"many-distinct"})},Eit={name:"volume-segment",label:"Volume Segment",category:xo.Misc,factory:function Vhe(e,t){let n,r;const i=e.volume&&mt.Segmentation.get(e.volume);if(i){const o=i.segments.size,s=Array.from(i.segments.keys()),a=Yu(o,t);r=a.legend,n=l=>mt.Segment.isLocation(l)?a.color(s.indexOf(l.segment)):Uhe}else n=()=>Uhe;return{factory:Vhe,granularity:"instance",color:n,props:t,description:"Gives every volume segment a unique color.",legend:r}},getParams:function Iit(e){return I.clone(zhe)},defaultValues:I.getDefaultValues(zhe),isApplicable:e=>!!e.volume&&!!mt.Segmentation.get(e.volume)},Hhe={volume:I.ValueRef(e=>e.state.data.selectQ(n=>n.root.subtree().filter(r=>{var i;return mt.is(null===(i=r.obj)||void 0===i?void 0:i.data)})).map(n=>{var r,i;return[n.transform.ref,null!==(i=null===(r=n.obj)||void 0===r?void 0:r.label)&&void 0!==i?i:"<unknown>"]}),(e,t)=>t(e)),coloring:I.MappedStatic("absolute-value",{"absolute-value":I.Group({domain:I.MappedStatic("auto",{custom:I.Interval([-1,1]),auto:I.Group({symmetric:I.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:I.ColorList("red-white-blue",{presetKind:"scale"})}),"relative-value":I.Group({domain:I.MappedStatic("auto",{custom:I.Interval([-1,1]),auto:I.Group({symmetric:I.Boolean(!1,{description:"If true the automatic range is determined as [-|max|, |max|]."})})}),list:I.ColorList("red-white-blue",{presetKind:"scale"})})}),defaultColor:I.Color(st(13421772))},Dit={name:"external-volume",label:"External Volume",category:xo.Misc,factory:function Ghe(e,t){let n,r;try{n=t.volume.getValue()}catch{}if(n){const i=t.coloring.params,{stats:o}=n.grid,s="custom"===i.domain.name?i.domain.params:[o.min,o.max],a="relative-value"===t.coloring.name;if("auto"===i.domain.name&&a&&(s[0]=(s[0]-o.mean)/o.sigma,s[1]=(s[1]-o.mean)/o.sigma),"auto"===t.coloring.params.domain.name&&t.coloring.params.domain.params.symmetric){const y=Math.max(Math.abs(s[0]),Math.abs(s[1]));s[0]=-y,s[1]=y}const l=up.create({domain:s,listOrName:i.list.colors}),c=Ca.getGridToCartesianTransform(n.grid);fe.invert(c,c);const u=C(),{dimensions:d,get:f}=n.grid.cells.space,p=n.grid.cells.data,[m,h,g]=d;r=y=>{if(!function IWe(e){return!!e&&"position-location"===e.kind}(y))return t.defaultColor;C.copy(u,y.position),C.transformMat4(u,u,c);const v=Math.floor(u[0]),x=Math.floor(u[1]),_=Math.floor(u[2]);if(v<0||v>=m||x<0||x>=h||_<0||_>=g)return t.defaultColor;const w=u[0]-v,A=u[1]-x,M=u[2]-_,E=Math.min(v+1,m-1),D=Math.min(x+1,h-1),T=Math.min(_+1,g-1);let F=f(p,v,x,_),R=f(p,E,x,_),N=f(p,v,D,_),j=f(p,E,D,_);const W=Po(Po(F,R,w),Po(N,j,w),A);F=f(p,v,x,T),R=f(p,E,x,T),N=f(p,v,D,T),j=f(p,E,D,T);const z=Po(Po(F,R,w),Po(N,j,w),A);let $=Po(W,z,M);return a&&($=($-o.mean)/o.sigma),l.color($)}}else r=()=>t.defaultColor;return{factory:Ghe,granularity:"vertex",preferSmoothing:!0,color:r,props:t,description:"Assigns a color based volume value at a given vertex."}},getParams:()=>Hhe,defaultValues:I.getDefaultValues(Hhe),isApplicable:e=>!0},qhe={mainchain:I.MappedStatic("molecule-type",{uniform:I.Group(Vw),"chain-id":I.Group(YD),"entity-id":I.Group(KD),"entity-source":I.Group(JD),"molecule-type":I.Group($N),"model-index":I.Group(tP),"structure-index":I.Group(rP),"secondary-structure":I.Group(CG)}),sidechain:I.MappedStatic("residue-name",{uniform:I.Group(Vw),"residue-name":I.Group(xG),"element-symbol":I.Group(hG)})},Nit={name:"cartoon",label:"Cartoon",category:xo.Misc,factory:function Whe(e,t){var n,r;const i=function Mit(e,t){switch(t.name){case"uniform":return I_(0,t.params);case"chain-id":return XD(e,t.params);case"entity-id":return QD(e,t.params);case"entity-source":return eP(e,t.params);case"molecule-type":return YN(0,t.params);case"model-index":return nP(e,t.params);case"structure-index":return iP(e,t.params);case"secondary-structure":return wG(e,t.params);default:Hi()}}(e,t.mainchain),o=function Rit(e,t){switch(t.name){case"uniform":return I_(0,t.params);case"residue-name":return _G(0,t.params);case"element-symbol":return mG(e,t.params);default:Hi()}}(e,t.sidechain);let a=i.legend;return"table-legend"===(null===(n=i.legend)||void 0===n?void 0:n.kind)&&"table-legend"===(null===(r=o.legend)||void 0===r?void 0:r.kind)&&(a={kind:"table-legend",table:[...i.legend.table,...o.legend.table]}),{factory:Whe,granularity:"group",preferSmoothing:!1,color:function s(l,c){return c?i.color(l,!1):o.color(l,!1)},props:t,description:"Uses separate themes for coloring mainchain and sidechain visuals.",legend:a}},getParams:function kit(e){return I.clone(qhe)},defaultValues:I.getDefaultValues(qhe),isApplicable:e=>!!e.structure};var Rd;!function(e){e.Category=xo,e.PaletteScale=16777215,e.EmptyFactory=()=>e.Empty;const t=st(13421772);e.Empty={factory:e.EmptyFactory,granularity:"uniform",color:()=>t,props:{}},e.areEqual=function n(i,o){return i.contextHash===o.contextHash&&i.factory===o.factory&&tg(i.props,o.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0},e.createRegistry=function r(){return new Jhe(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={"atom-id":_it,"carbohydrate-symbol":Lnt,cartoon:Nit,"chain-id":Rpe,"element-index":Knt,"element-symbol":wrt,"entity-id":ort,"entity-source":urt,hydrophobicity:rit,illustrative:Qrt,"model-index":prt,"molecule-type":Ert,occupancy:uit,"operator-hkl":pit,"operator-name":lG,"partial-charge":git,"polymer-id":Prt,"polymer-index":Rrt,"residue-name":Ort,"secondary-structure":jrt,"sequence-id":Hrt,"shape-group":NZe,"structure-index":grt,"trajectory-index":sit,uncertainty:$rt,"unit-index":vrt,uniform:iKe,"volume-segment":Eit,"volume-value":wit,"external-volume":Dit}}(Rd||(Rd={}));const $he={scale:I.Numeric(1,{min:.1,max:5,step:.1})};function PG(e,t){return ze.isAtomic(e)?B3(e.model.atomicHierarchy.atoms.type_symbol.value(t)):ze.isSpheres(e)?e.model.coarseConformation.spheres.radius[t]:0}const Lit={name:"physical",label:"Physical",category:"",factory:function Yhe(e,t){const n=void 0===t.scale?1:t.scale;return{factory:Yhe,granularity:"group",size:function r(i){let o;return o=dt.is(i)?n*PG(i.unit,i.element):fn.isLocation(i)?n*Math.min(PG(i.aUnit,i.aUnit.elements[i.aIndex]),PG(i.bUnit,i.bUnit.elements[i.bIndex])):1*n,o},props:t,description:"Assigns a physical size, i.e. vdW radius for atoms or given radius for coarse spheres."}},getParams:function Bit(e){return $he},defaultValues:I.getDefaultValues($he),isApplicable:e=>!!e.structure},Xhe={bfactorFactor:I.Numeric(.1,{min:0,max:1,step:.01}),rmsfFactor:I.Numeric(.05,{min:0,max:1,step:.01}),baseSize:I.Numeric(.2,{min:0,max:2,step:.1})};function Khe(e,t,n){return ze.isAtomic(e)?e.model.atomicConformation.B_iso_or_equiv.value(t)*n.bfactorFactor:ze.isSpheres(e)?e.model.coarseConformation.spheres.rmsf[t]*n.rmsfFactor:0}const zit={name:"uncertainty",label:"Uncertainty/Disorder",category:"",factory:function Zhe(e,t){return{factory:Zhe,granularity:"group",size:function n(r){let i=t.baseSize;return dt.is(r)?i+=Khe(r.unit,r.element,t):fn.isLocation(r)&&(i+=Khe(r.aUnit,r.aUnit.elements[r.aIndex],t)),i},props:t,description:"Assigns a size reflecting the uncertainty or disorder of an element's position, e.g. B-factor or RMSF, depending on the data availability and experimental technique."}},getParams:function Uit(e){return Xhe},defaultValues:I.getDefaultValues(Xhe),isApplicable:e=>!!e.structure&&e.structure.models.some(t=>t.atomicConformation.B_iso_or_equiv.isDefined||t.coarseHierarchy.isDefined)};var Ya,Ia;function Qhe(e){return e.map(t=>[t.name,t.provider.label,t.provider.category])}!function(e){e.EmptyFactory=()=>e.Empty,e.Empty={factory:e.EmptyFactory,granularity:"uniform",size:()=>1,props:{}},e.areEqual=function t(r,i){return r.contextHash===i.contextHash&&r.factory===i.factory&&tg(r.props,i.props)},e.EmptyProvider={name:"",label:"",category:"",factory:e.EmptyFactory,getParams:()=>({}),defaultValues:{},isApplicable:()=>!0},e.createRegistry=function n(){return new Jhe(e.BuiltIn,e.EmptyProvider)},e.BuiltIn={physical:Lit,"shape-group":PZe,uncertainty:zit,uniform:aKe}}(Ya||(Ya={})),function(e){function n(){return{color:Rd.Empty,size:Ya.Empty}}function i(){return(i=le(function*(s,a,l,c){var u,d;yield null===(u=a.colorThemeRegistry.get(c.colorTheme.name).ensureCustomProperties)||void 0===u?void 0:u.attach(s,l),yield null===(d=a.sizeThemeRegistry.get(c.sizeTheme.name).ensureCustomProperties)||void 0===d?void 0:d.attach(s,l)})).apply(this,arguments)}e.create=function t(s,a,l,c){c=c||n();const u=l.colorTheme,d=l.sizeTheme;return c.color=s.colorThemeRegistry.create(u.name,a,u.params),c.size=s.sizeThemeRegistry.create(d.name,a,d.params),c},e.createEmpty=n,e.ensureDependencies=function r(s,a,l,c){return i.apply(this,arguments)},e.releaseDependencies=function o(s,a,l){var c,u;null===(c=s.colorThemeRegistry.get(l.colorTheme.name).ensureCustomProperties)||void 0===c||c.detach(a),null===(u=s.sizeThemeRegistry.get(l.sizeTheme.name).ensureCustomProperties)||void 0===u||u.detach(a)}}(Ia||(Ia={}));class Jhe{get default(){return this._list[0]}get list(){return this._list}get types(){return Qhe(this._list)}constructor(t,n){this.emptyProvider=n,this._list=[],this._map=new Map,this._name=new Map,Nu(t,(r,i)=>{if(r.name!==i)throw new Error(`Fix build in themes to have matching names. ${r.name} ${i}`);this.add(r)})}sort(){this._list.sort((t,n)=>t.provider.category===n.provider.category?t.provider.label<n.provider.label?-1:t.provider.label>n.provider.label?1:0:t.provider.category<n.provider.category?-1:1)}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);const n=t.name;this._list.push({name:n,provider:t}),this._map.set(n,t),this._name.set(t,n),this.sort()}remove(t){this._list.splice(this._list.findIndex(r=>r.name===t.name),1);const n=this._map.get(t.name);n&&(this._map.delete(t.name),this._name.delete(n))}has(t){return this._map.has(t.name)}get(t){return this._map.get(t)||this.emptyProvider}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered theme provider.`);return this._name.get(t)}create(t,n,r={}){const i=this.get(t);return i.factory(n,{...I.getDefaultValues(i.getParams(n)),...r})}getApplicableList(t){return this._list.filter(n=>n.provider.isApplicable(t))}getApplicableTypes(t){return Qhe(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}}var uc,un=function(e){return e[e.None=0]="None",e[e.Highlight=1]="Highlight",e[e.RemoveHighlight=2]="RemoveHighlight",e[e.Select=4]="Select",e[e.Deselect=8]="Deselect",e[e.Toggle=16]="Toggle",e[e.Clear=32]="Clear",e}(un||{});function sP(e,t,n){switch(n){case un.Highlight:e[t]|=1;break;case un.RemoveHighlight:e[t]&=-2;break;case un.Select:e[t]|=2;break;case un.Deselect:e[t]&=-3;break;case un.Toggle:e[t]^=2;break;case un.Clear:e[t]=0}}function Qh(e,t,n){if(n===un.None)return!1;if(Pe.is(t)){const r=Pe.start(t),i=Pe.end(t),o=r+3>>2,s=o+(i-4*o>>2);if(s<=o){for(let f=r;f<i;++f)sP(e,f,n);return!0}const a=new Uint32Array(e.buffer,0,e.buffer.byteLength>>2),l=r,c=Math.min(4*o,i),u=Math.max(r,4*s),d=i;switch(n){case un.Highlight:for(let f=o;f<s;++f)a[f]|=16843009;break;case un.RemoveHighlight:for(let f=o;f<s;++f)a[f]&=-16843010;break;case un.Select:for(let f=o;f<s;++f)a[f]|=33686018;break;case un.Deselect:for(let f=o;f<s;++f)a[f]&=-33686019;break;case un.Toggle:for(let f=o;f<s;++f)a[f]^=33686018;break;case un.Clear:for(let f=o;f<s;++f)a[f]=0;break;default:Hi()}for(let f=l;f<c;++f)sP(e,f,n);for(let f=u;f<d;++f)sP(e,f,n)}else switch(n){case un.Highlight:for(let r=0,i=t.length;r<i;++r)e[t[r]]|=1;break;case un.RemoveHighlight:for(let r=0,i=t.length;r<i;++r)e[t[r]]&=-2;break;case un.Select:for(let r=0,i=t.length;r<i;++r)e[t[r]]|=2;break;case un.Deselect:for(let r=0,i=t.length;r<i;++r)e[t[r]]&=-3;break;case un.Toggle:for(let r=0,i=t.length;r<i;++r)e[t[r]]^=2;break;case un.Clear:for(let r=0,i=t.length;r<i;++r)e[t[r]]=0;break;default:Hi()}return!0}!function(e){e.is=Mc.has,e.All=un.Highlight|un.RemoveHighlight|un.Select|un.Deselect|un.Toggle|un.Clear,e.Highlighting=un.Highlight|un.RemoveHighlight|un.Clear,e.Selecting=un.Select|un.Deselect|un.Toggle|un.Clear,e.isReverse=function t(n,r){return n===un.Highlight&&r===un.RemoveHighlight||n===un.RemoveHighlight&&r===un.Highlight||n===un.Select&&r===un.Deselect||n===un.Deselect&&r===un.Select||n===un.Toggle&&r===un.Toggle}}(uc||(uc={}));const KN={kind:"every-loci"};function Xu(e){return!!e&&"every-loci"===e.kind}const qr={kind:"empty-loci"};function uu(e){return!!e&&"empty-loci"===e.kind}function aP(e){return!!e&&"data-loci"===e.kind}function ZN(e,t,n,r,i){return{kind:"data-loci",tag:e,data:t,elements:n,getBoundingSphere:r,getLabel:i}}var Yn,Ag;function Ea(e,t){return{kind:e,layers:t}}function dc(e,t){return{kind:e,layers:t}}!function(e){const t=new xf("98");function a(h,g){var y;if("every-loci"!==h.kind&&"empty-loci"!==h.kind){if(g||(g=ke()),"structure-loci"===h.kind)return ke.copy(g,h.structure.boundary.sphere);if("element-loci"===h.kind)return ke.copy(g,Me.getBoundary(h).sphere);if("bond-loci"===h.kind)return fn.getBoundingSphere(h,g);if("shape-loci"===h.kind)return ke.copy(g,h.shape.geometry.boundingSphere);if("group-loci"===h.kind)return Bc.getBoundingSphere(h,g);if("data-loci"===h.kind)return null===(y=h.getBoundingSphere)||void 0===y?void 0:y.call(h,g);if("volume-loci"===h.kind)return mt.getBoundingSphere(h.volume,g);if("isosurface-loci"===h.kind)return mt.Isosurface.getBoundingSphere(h.volume,h.isoValue,g);if("cell-loci"===h.kind)return mt.Cell.getBoundingSphere(h.volume,h.indices,g);if("segment-loci"===h.kind)return mt.Segment.getBoundingSphere(h.volume,h.segments,g)}}e.getBundleBoundingSphere=function n(h){const g=h.loci.map(y=>a(y)).filter(y=>!!y);t.reset();for(const y of g)t.includePositionRadius(y.center,y.radius);t.finishedIncludeStep();for(const y of g)t.radiusPositionRadius(y.center,y.radius);return t.getSphere()},e.areEqual=function r(h,g){return!!(Xu(h)&&Xu(g)||uu(h)&&uu(g))||(aP(h)&&aP(g)?function qit(e,t){if(!l3(e.data,t.data)||e.tag!==t.tag||e.elements.length!==t.elements.length)return!1;for(let n=0,r=e.elements.length;n<r;++n)if(!l3(e.elements[n],t.elements[n]))return!1;return!0}(h,g):Xe.isLoci(h)&&Xe.isLoci(g)?Xe.areLociEqual(h,g):Me.is(h)&&Me.is(g)?Me.areEqual(h,g):fn.isLoci(h)&&fn.isLoci(g)?fn.areLociEqual(h,g):zr.isLoci(h)&&zr.isLoci(g)?zr.areLociEqual(h,g):Bc.isLoci(h)&&Bc.isLoci(g)?Bc.areLociEqual(h,g):mt.isLoci(h)&&mt.isLoci(g)?mt.areLociEqual(h,g):mt.Isosurface.isLoci(h)&&mt.Isosurface.isLoci(g)?mt.Isosurface.areLociEqual(h,g):mt.Cell.isLoci(h)&&mt.Cell.isLoci(g)?mt.Cell.areLociEqual(h,g):!(!mt.Segment.isLoci(h)||!mt.Segment.isLoci(g))&&mt.Segment.areLociEqual(h,g))},e.isEvery=function i(h){return!!h&&"every-loci"===h.kind},e.isEmpty=function o(h){return!Xu(h)&&(!!uu(h)||(aP(h)?function Wit(e){return 0===e.elements.length}(h):Xe.isLoci(h)?Xe.isLociEmpty(h):Me.is(h)?Me.isEmpty(h):fn.isLoci(h)?fn.isLociEmpty(h):zr.isLoci(h)?zr.isLociEmpty(h):Bc.isLoci(h)?Bc.isLociEmpty(h):mt.isLoci(h)?mt.isLociEmpty(h):mt.Isosurface.isLoci(h)?mt.Isosurface.isLociEmpty(h):mt.Cell.isLoci(h)?mt.Cell.isLociEmpty(h):!!mt.Segment.isLoci(h)&&mt.Segment.isLociEmpty(h)))},e.remap=function s(h,g){return g instanceof Xe&&(Me.is(h)?h=Me.remap(h,g):Xe.isLoci(h)?h=Xe.remapLoci(h,g):fn.isLoci(h)&&(h=fn.remapLoci(h,g))),h},e.getBoundingSphere=a;const l=ke.zero();e.getCenter=function c(h,g){const y=a(h,l);return y?C.copy(g||C(),y.center):void 0},e.getPrincipalAxes=function u(h){if("every-loci"!==h.kind&&"empty-loci"!==h.kind){if("structure-loci"===h.kind)return Me.getPrincipalAxes(Xe.toStructureElementLoci(h.structure));if("element-loci"===h.kind)return Me.getPrincipalAxes(h);if("bond-loci"===h.kind)return;if("shape-loci"===h.kind)return;if("group-loci"===h.kind)return;if("data-loci"===h.kind)return;if("volume-loci"===h.kind)return;if("isosurface-loci"===h.kind)return;if("cell-loci"===h.kind)return;if("segment-loci"===h.kind)return}};const d={element:h=>h,residue:h=>Me.is(h)?Me.extendToWholeResidues(h,!0):h,chain:h=>Me.is(h)?Me.extendToWholeChains(h):h,entity:h=>Me.is(h)?Me.extendToWholeEntities(h):h,model:h=>Me.is(h)?Me.extendToWholeModels(h):h,operator:h=>Me.is(h)?Me.extendToWholeOperators(h):h,structure:h=>Me.is(h)?Xe.toStructureElementLoci(h.structure):Bc.isLoci(h)?zr.Loci(h.shape):mt.Cell.isLoci(h)?mt.Loci(h.volume):h,elementInstances:h=>Me.is(h)?Me.extendToAllInstances(h):h,residueInstances:h=>Me.is(h)?Me.extendToAllInstances(Me.extendToWholeResidues(h,!0)):h,chainInstances:h=>Me.is(h)?Me.extendToAllInstances(Me.extendToWholeChains(h)):h};function p(h,g){return d[g](h)}e.GranularityOptions=I.objectToOptions(d,h=>{switch(h){case"element":return"Atom/Coarse Element";case"elementInstances":return["Atom/Coarse Element Instances","With Symmetry"];case"structure":return"Structure/Shape";default:return h.indexOf("Instances")?[yf(h),"With Symmetry"]:yf(h)}}),e.simpleGranularity=function f(h){return h.replace("Instances","")},e.applyGranularity=p,e.normalize=function m(h,g,y=!1){return("element"!==g||y)&&fn.isLoci(h)&&(h=fn.toStructureElementLoci(h)),Xe.isLoci(h)&&(h=Xe.toStructureElementLoci(h.structure)),Me.is(h)&&(h=Me.remap(h,h.structure.root)),g&&(h=p(h,g)),h}}(Yn||(Yn={})),function(e){function n(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,u){if(0===c.layers.length&&0===u.layers.length)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,f=c.layers.length;d<f;++d)if(c.layers[d].clear!==u.layers[d].clear||c.layers[d].color!==u.layers[d].color||!Yn.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0},e.isEmpty=n,e.remap=function r(c,u){if("element-loci"===c.kind){const d=[];for(const f of c.layers){let{loci:p,color:m,clear:h}=f;p=Me.remap(p,u),Me.isEmpty(p)||d.push({loci:p,color:m,clear:h})}return{kind:"element-loci",layers:d}}return c},e.merge=function i(c){if(n(c))return c;if("element-loci"===c.kind){const{structure:u}=c.layers[0].loci,d=new Map;let f=Me.none(u);for(let m=0,h=c.layers.length;m<h;++m){let{loci:g,color:y,clear:v}=c.layers[h-m-1];if(g=Me.subtract(g,f),f=Me.union(g,f),!Me.isEmpty(g)){const x=v?-1:y;d.has(x)&&(g=Me.union(g,d.get(x))),d.set(x,g)}}const p=[];return d.forEach((m,h)=>{const g=-1===h,y=g?st(0):h;p.push({loci:m,color:y,clear:g})}),{kind:"element-loci",layers:p}}return c},e.filter=function o(c,u){if(n(c))return c;if("element-loci"===c.kind){const{structure:d}=c.layers[0].loci,f=[];for(const p of c.layers){let{loci:m,color:h,clear:g}=p;const y=Me.remap(m,u);m=Me.remap(y,d),Me.isEmpty(m)||f.push({loci:m,color:h,clear:g})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function s(c,u){const d=[];for(let f=0,p=c.length;f<p;++f){const{script:m,color:h,clear:g}=c[f],y=pa.toLoci(m,u);Me.isEmpty(y)||d.push({loci:y,color:h,clear:g})}return{kind:"element-loci",layers:d}},e.ofBundle=function a(c,u){const d=[];for(let f=0,p=c.length;f<p;++f){const{bundle:m,color:h,clear:g}=c[f],y=Qr.toLoci(m,u.root);d.push({loci:y,color:h,clear:g})}return{kind:"element-loci",layers:d}},e.toBundle=function l(c){const u=[];for(let d=0,f=c.layers.length;d<f;++d){const{loci:p,color:m,clear:h}=c.layers[d],g=Qr.fromLoci(p);u.push({bundle:g,color:m,clear:h})}return{kind:"element-loci",layers:u}}}(Ea||(Ea={})),function(e){function n(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,u){if(0===c.layers.length&&0===u.layers.length)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,f=c.layers.length;d<f;++d)if(c.layers[d].value!==u.layers[d].value||!Yn.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0},e.isEmpty=n,e.remap=function r(c,u){if("element-loci"===c.kind){const d=[];for(const f of c.layers){const p=Me.remap(f.loci,u);Me.isEmpty(p)||d.push({loci:p,value:f.value})}return{kind:"element-loci",layers:d}}return c},e.merge=function i(c){if(n(c))return c;if("element-loci"===c.kind){const{structure:u}=c.layers[0].loci,d=new Map;let f=Me.none(u);for(let m=0,h=c.layers.length;m<h;++m){let{loci:g,value:y}=c.layers[h-m-1];g=Me.subtract(g,f),f=Me.union(g,f),Me.isEmpty(g)||(d.has(y)&&(g=Me.union(g,d.get(y))),d.set(y,g))}const p=[];return d.forEach((m,h)=>{p.push({loci:m,value:h})}),{kind:"element-loci",layers:p}}return c},e.filter=function o(c,u){if(n(c))return c;if("element-loci"===c.kind){const{structure:d}=c.layers[0].loci,f=[];for(const p of c.layers){let{loci:m,value:h}=p;const g=Me.remap(m,u);m=Me.remap(g,d),Me.isEmpty(m)||f.push({loci:m,value:h})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function s(c,u){const d=[];for(let f=0,p=c.length;f<p;++f){const{script:m,value:h}=c[f],g=pa.toLoci(m,u);Me.isEmpty(g)||d.push({loci:g,value:h})}return{kind:"element-loci",layers:d}},e.ofBundle=function a(c,u){const d=[];for(let f=0,p=c.length;f<p;++f){const{bundle:m,value:h}=c[f],g=Qr.toLoci(m,u.root);d.push({loci:g,value:h})}return{kind:"element-loci",layers:d}},e.toBundle=function l(c){const u=[];for(let d=0,f=c.layers.length;d<f;++d){const{loci:p,value:m}=c.layers[d],h=Qr.fromLoci(p);u.push({bundle:h,value:m})}return{kind:"element-loci",layers:u}}}(dc||(dc={})),function(e){e.create=function t(){return{updateTransform:!1,updateMatrix:!1,updateColor:!1,updateSize:!1,createGeometry:!1,createNew:!1,info:{}}},e.reset=function n(r){r.updateTransform=!1,r.updateMatrix=!1,r.updateColor=!1,r.updateSize=!1,r.createGeometry=!1,r.createNew=!1}}(Ag||(Ag={}));const $it={lowestElementCount:1e6,lowerElementCount:5e5,lowElementCount:1e5,mediumElementCount:2e4,highElementCount:2e3,coarseGrainedFactor:10,elementCountFactor:1};function eme(e,t={}){const n={...$it,...t};let r=e.elementCount*n.elementCountFactor;return(e.isCoarseGrained||e.isCoarse)&&(r*=n.coarseGrainedFactor),r>n.lowestElementCount?"lowest":r>n.lowerElementCount?"lower":r>n.lowElementCount?"low":r>n.mediumElementCount?"medium":r>n.highElementCount?"high":"higher"}function kG(e,t){let n=Ll(e.quality,"auto"),r=Ll(e.detail,1),i=Ll(e.radialSegments,12),o=Ll(e.linearSegments,8),s=Ll(e.resolution,2),a=Ll(e.probePositions,12),l=Ll(e.doubleSided,!0),c=0;if("auto"===n)if(t instanceof Xe)n=eme(t.root),c=function Yit(e){if(1===e.root.models.length){const t=Vs.Provider.get(e.root.model);if(t&&"P 1"===t.spacegroup.name&&!Qc.isZero(t.spacegroup.cell))return t.spacegroup.cell.volume}return Gt.volume(e.root.boundary.box)}(t);else if(mt.is(t)){const[u,d,f]=t.grid.cells.space.dimensions;c=u*d*f,n=c<1e7?"medium":"low"}switch(n){case"highest":r=3,i=36,o=18,s=.1,a=72,l=!0;break;case"higher":r=3,i=28,o=14,s=.3,a=48,l=!0;break;case"high":r=2,i=20,o=10,s=.5,a=36,l=!0;break;case"medium":r=1,i=12,o=8,s=.8,a=24,l=!0;break;case"low":r=0,i=8,o=3,s=1.3,a=24,l=!1;break;case"lower":r=0,i=4,o=2,s=3,a=12,l=!1;break;case"lowest":r=0,i=2,o=1,s=8,a=12,l=!1}return s=Math.max(s,c/5e8),s=Math.min(s,20),"off"===e.transparentBackfaces&&(void 0!==e.alpha&&e.alpha<1||e.xrayShaded)&&(l=!1),{detail:r,radialSegments:i,linearSegments:o,resolution:s,probePositions:a,doubleSided:l}}const QN=C.set,tme=C.normalize,nme=C.sub,rme=C.addScalar,JN=C.scale,ime=C.toArray;function eF(e,t,n,r){let i=!1;if(mt.isLoci(e)){if(!mt.areEquivalent(e.volume,t))return!1;r(Pe.ofLength(t.grid.cells.data.length))&&(i=!0)}else if(mt.Isosurface.isLoci(e)){if(!mt.areEquivalent(e.volume,t))return!1;if(n?.isoValue){if(!mt.IsoValue.areSame(e.isoValue,n.isoValue,t.grid.stats))return!1;r(Pe.ofLength(t.grid.cells.data.length))&&(i=!0)}else{const{stats:o,cells:{data:s}}=t.grid,a=o.sigma,l=mt.IsoValue.toAbsolute(e.isoValue,o).absoluteValue;for(let c=0,u=s.length;c<u;++c)Do(l,s[c],a)&&r(Pe.ofSingleton(c))&&(i=!0)}}else if(mt.Cell.isLoci(e)){if(!mt.areEquivalent(e.volume,t))return!1;Pe.is(e.indices)?r(e.indices)&&(i=!0):Ve.forEach(e.indices,o=>{r(Pe.ofSingleton(o))&&(i=!0)})}else if(mt.Segment.isLoci(e)){if(!mt.areEquivalent(e.volume,t))return!1;if(n?.segments){if(!rt.areIntersecting(e.segments,n.segments))return!1;r(Pe.ofLength(t.grid.cells.data.length))&&(i=!0)}else{const o=mt.Segmentation.get(t);if(o){const s=new Set;for(let c=0,u=e.segments.length;c<u;++c)Lo.add(s,o.segments.get(e.segments[c]));const a=Array.from(s.values()),l=t.grid.cells.data;for(let c=0,u=l.length;c<u;++c)a.includes(l[c])&&r(Pe.ofSingleton(c))&&(i=!0)}}}return i}function W1(e,t=0){const r=Math.sqrt(e[0]*e[1]*e[2]),i=Math.pow(2,Math.ceil(Math.log(r)/Math.log(2)));let o=e[0]+t,s=e[1]+t,a=1,l=o;return i<o*e[2]?(l=Math.floor(i/o),a=Math.ceil(e[2]/l),o*=l,s*=a):o*=e[2],{width:o,height:s,columns:l,rows:a,powerOfTwoSize:s<i?i:2*i}}function ome(e,t,n=0){const{cells:{space:r,data:i},stats:{max:o,min:s}}=e.grid,a=r.dimensions,{dataOffset:l}=r,{width:c,height:u}=W1(a,n),d="data"===t?1:4,f=new Uint8Array(c*u*d),p={array:f,width:c,height:u},m=o-s,[h,g,y]=a,v=h+n,x=g+n,_=C(),w=C(),A=h-1,M=g-1,E=y-1;for(let D=0;D<y;++D)for(let T=0;T<g;++T)for(let F=0;F<h;++F){const R=Math.floor(D*v%c/v),W=d*(Math.floor(D*v/c)*x*c+T*c+(R*v+F)),z=l(F,T,D);"data"===t?f[W]=Math.round((i[z]-s)/m*255):("groups"===t?FD(z,f,W):(QN(_,i[l(Math.max(0,F-1),T,D)],i[l(F,Math.max(0,T-1),D)],i[l(F,T,Math.max(0,D-1))]),QN(w,i[l(Math.min(A,F+1),T,D)],i[l(F,Math.min(M,T+1),D)],i[l(F,T,Math.min(E,D+1))]),tme(_,nme(_,_,w)),rme(_,JN(_,_,.5),.5),ime(JN(_,_,255),f,W)),f[W+3]=Math.round((i[z]-s)/m*255))}return p}function tF(e,t,n,r,i){const{colorType:o,vertexCount:s,groupCount:a,positionBuffer:l,transformBuffer:c,groupBuffer:u,itemSize:d}=e,f=o.endsWith("Instance"),p=Gt.fromSphere3D(Gt(),f?e.boundingSphere:e.invariantBoundingSphere),m=1+t,h=Gt.expand(Gt(),p,C.create(m,m,m)),g=1/t,y=Gt.scale(Gt(),h,g),v=Gt.size(C(),y);C.ceil(v,v),C.add(v,v,C.create(2,2,2));const{min:x}=h,[_,w]=v,{width:A,height:M}=W1(v),E=new Float32Array(A*M*d),D=new Float32Array(A*M),T=new Uint8Array(A*M*d),F={array:T,width:A,height:M,filter:"linear"},R=f?e.instanceCount:1,N=e.colorData.array;function j(K,Q,G){const Z=Math.floor(G*_%A/_),ee=Math.floor(G*_/A);return d*(ee*w*A+Q*A+(Z*_+K))}const[z,$,V]=v,X=C();for(let K=0;K<R;++K)for(let Q=0;Q<s;Q+=n){C.fromArray(X,l,3*Q),f&&C.transformMat4Offset(X,X,c,0,0,16*K),C.sub(X,X,x),C.scale(X,X,g);const[G,Z,ee]=X,se=Math.floor(G),xe=Math.floor(Z),re=Math.floor(ee),ae=(K*a+u[Q])*d,ge=Math.max(0,se-2),Ie=Math.max(0,xe-2),me=Math.max(0,re-2),Ae=Math.min(z,se+2+2),he=Math.min($,xe+2+2),ie=Math.min(V,re+2+2);for(let ue=ge;ue<Ae;++ue){const _e=ue-G;for(let Fe=Ie;Fe<he;++Fe){const Ze=Fe-Z;for(let ct=me;ct<ie;++ct){const q=ct-ee,ne=Math.sqrt(_e*_e+Ze*Ze+q*q);if(ne>2)continue;const be=2-ne,Ce=j(ue,Fe,ct);for(let Re=0;Re<d;++Re)E[Ce+Re]+=N[ae+Re]*be;D[Ce/d]+=be}}}}for(let K=0,Q=D.length;K<Q;++K){const G=K*d,Z=D[K];for(let ee=0;ee<d;++ee)T[G+ee]=Math.round(E[G+ee]/Z)}const H=Ue.create(A,M),oe=Bn.create(x[0],x[1],x[2],g),te=f?"volumeInstance":"volume";if(r)return i||(i=r.resources.texture("image-uint8",4===d?"rgba":3===d?"rgb":"alpha","ubyte","linear")),i.load(F),{kind:"volume",texture:i,gridTexDim:H,gridDim:v,gridTransform:oe,type:te};{const K=function Zit(e){const{vertexCount:t,positionBuffer:n,transformBuffer:r,grid:i,gridDim:o,gridTexDim:s,gridTransform:a,vertexStride:l,colorStride:c}=e,u=e.itemOffset||0,d=e.outputStride;if(d+u>c)throw new Error("outputStride + itemOffset must NOT be larger than colorStride");const f=e.colorType.endsWith("Instance"),p=f?e.instanceCount:1,m=Sa(Math.max(1,p*t),d,Uint8Array),{array:h}=m,[g,y]=o,v=s[0],x=C.fromArray(C(),a,0),_=a[3];function w(T,F,R){const N=Math.floor(R*g%v/g),j=Math.floor(R*g/v);return c*(j*y*v+F*v+(N*g+T))}const A=C(),M=C(),E=C(),D=C();for(let T=0;T<p;++T)for(let F=0;F<t;++F){C.fromArray(A,n,F*l),f&&C.transformMat4Offset(A,A,r,0,0,16*T),C.sub(A,A,x),C.scale(A,A,_),C.floor(M,A),C.ceil(E,A),C.sub(D,A,M),C.sub(A,E,M),C.div(D,D,A);const[R,N,j]=M,[W,z,$]=E,[V,X,H]=D,oe=w(R,N,j)+u,te=w(W,N,j)+u,K=w(R,N,$)+u,Q=w(W,N,$)+u,G=w(R,z,j)+u,Z=w(W,z,j)+u,ee=w(R,z,$)+u,se=w(W,z,$)+u,xe=(T*t+F)*d;for(let re=0;re<d;++re){const Ie=i[K+re],me=i[Q+re],Ae=i[G+re],he=i[Z+re],ie=i[ee+re],ue=i[se+re],_e=Po(i[oe+re],i[te+re],V),Fe=Po(Ie,me,V),Ze=Po(Ae,he,V),ct=Po(ie,ue,V),q=Po(_e,Ze,X),ne=Po(Fe,ct,X);h[xe+re]=Po(q,ne,H)}}return m}({vertexCount:s,instanceCount:R,transformBuffer:c,positionBuffer:l,colorType:te,grid:T,gridDim:v,gridTexDim:H,gridTransform:oe,vertexStride:3,colorStride:d,outputStride:d});return{kind:"vertex",texture:K,texDim:Ue.create(K.width,K.height),type:f?"vertexInstance":"vertex"}}}function nF(e,t,n,r,i){if(!function Qit(e){return"group"===e||"groupInstance"===e}(e.dColorType.ref.value))return;const o=tF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tColor.ref.value,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:3},t,n,r,i);"volume"===o.kind?(O.updateIfChanged(e.dColorType,o.type),O.update(e.tColorGrid,o.texture),O.update(e.uColorTexDim,o.gridTexDim),O.update(e.uColorGridDim,o.gridDim),O.update(e.uColorGridTransform,o.gridTransform)):"vertex"===o.kind&&(O.updateIfChanged(e.dColorType,o.type),O.update(e.tColor,o.texture),O.update(e.uColorTexDim,o.texDim))}const oot="\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform sampler2D tCount;\nuniform vec2 uTexSize;\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n    float count = texture2D(tCount, coords).r;\n\n    gl_FragColor = color / count;\n}\n",sot="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uResolution;\n\nconst float p = 2.0;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition);\n    if (dist > p) discard;\n\n    float f = p - dist;\n    gl_FragColor = vColor * f;\n    gl_FragData[1] = vec4(f);\n}\n",aot="\nprecision highp float;\n\n#include common\n#include read_from_texture\n\nuniform int uGroupCount;\n\nattribute float aSample;\n#define SampleID int(aSample)\n\nattribute mat4 aTransform;\nattribute float aInstance;\n\nuniform vec2 uGeoTexDim;\nuniform sampler2D tPosition;\nuniform sampler2D tGroup;\n\nuniform vec2 uColorTexDim;\nuniform sampler2D tColor;\n\nvarying vec3 vPosition;\nvarying vec4 vColor;\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vec3 position = readFromTexture(tPosition, SampleID, uGeoTexDim).xyz;\n    float group = unpackRGBToInt(readFromTexture(tGroup, SampleID, uGeoTexDim).rgb);\n\n    position = (aTransform * vec4(position, 1.0)).xyz;\n    gl_PointSize = 7.0;\n    vPosition = (position - uBboxMin) / uResolution;\n    gl_Position = vec4(((position - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n\n    #if defined(dColorType_group)\n        vColor = readFromTexture(tColor, group, uColorTexDim);\n    #elif defined(dColorType_groupInstance)\n        vColor = readFromTexture(tColor, aInstance * float(uGroupCount) + group, uColorTexDim);\n    #endif\n}\n",lot={drawCount:_o("number"),instanceCount:_o("number"),stride:_o("number"),uGroupCount:Ne("i","material"),aTransform:Pi("float32",16,1),aInstance:Pi("float32",1,1),aSample:Pi("float32",1,0),uGeoTexDim:Ne("v2","material"),tPosition:xn("texture","rgba","float","nearest","material"),tGroup:xn("texture","rgba","float","nearest","material"),uColorTexDim:Ne("v2","material"),tColor:xn("texture","rgba","ubyte","nearest","material"),dColorType:cn("string",["group","groupInstance","vertex","vertexInstance"]),uCurrentSlice:Ne("f"),uCurrentX:Ne("f"),uCurrentY:Ne("f"),uBboxMin:Ne("v3","material"),uBboxSize:Ne("v3","material"),uResolution:Ne("f","material")},Mf="color-accumulate",lP="color-count";function sme(e,t){const n=new Float32Array(e);for(let r=0;r<e;++r)n[r]=r*t;return n}const fot={...ca,tColor:xn("texture","rgba","float","nearest"),tCount:xn("texture","alpha","float","nearest"),uTexSize:Ne("v2")},cP="color-normalize";function rF(e,t,n,r,i){const{drawBuffers:o}=r.extensions;if(!o)throw new Error("need WebGL draw buffers");It&&r.timer.mark("calcTextureMeshColorSmoothing");const{gl:s,resources:a,state:l,extensions:{colorBufferHalfFloat:c,textureHalfFloat:u}}=r,d=e.colorType.endsWith("Instance"),f=Gt.fromSphere3D(Gt(),d?e.boundingSphere:e.invariantBoundingSphere),p=1+t,m=Gt.expand(Gt(),f,C.create(p,p,p)),h=1/t,g=Gt.scale(Gt(),m,h),y=Gt.size(C(),g);C.ceil(y,y),C.add(y,y,C.create(2,2,2));const{min:v}=m,[x,_,w]=y,{texDimX:A,texDimY:M,texCols:E}=function got(e){const n=Math.sqrt(e[0]*e[1]*e[2]),r=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)));let i=0,o=e[1],s=1,a=e[2];return r<e[0]*e[2]?(a=Math.floor(r/e[0]),s=Math.ceil(e[2]/a),i=a*e[0],o*=s):i=e[0]*e[2],{texDimX:i,texDimY:o,texRows:s,texCols:a,powerOfTwoSize:o<r?r:2*r}}(y);r.namedFramebuffers[Mf]||(r.namedFramebuffers[Mf]=r.resources.framebuffer());const D=r.namedFramebuffers[Mf];Cn(s)?(r.namedTextures[Mf]||(r.namedTextures[Mf]=c&&u?a.texture("image-float16","rgba","fp16","nearest"):a.texture("image-float32","rgba","float","nearest")),r.namedTextures[lP]||(r.namedTextures[lP]=a.texture("image-float32","alpha","float","nearest"))):(r.namedTextures[Mf]||(r.namedTextures[Mf]=a.texture("image-float32","rgba","float","nearest")),r.namedTextures[lP]||(r.namedTextures[lP]=a.texture("image-float32","rgba","float","nearest")));const T=r.namedTextures[Mf],F=r.namedTextures[lP];T.define(A,M),F.define(A,M),T.attachFramebuffer(D,0),F.attachFramebuffer(D,1);const R=function cot(e,t,n,r,i){if(e.namedComputeRenderables[Mf]){const o=C.sub(C(),n.max,n.min),s=e.namedComputeRenderables[Mf].values,a=Math.round(t.vertexCount/i);(a>s.drawCount.ref.value||i!==s.stride.ref.value)&&O.update(s.aSample,sme(a,i)),O.updateIfChanged(s.drawCount,a),O.updateIfChanged(s.instanceCount,t.instanceCount),O.updateIfChanged(s.stride,i),O.updateIfChanged(s.uGroupCount,t.groupCount),O.update(s.aTransform,t.transformBuffer),O.update(s.aInstance,t.instanceBuffer),O.update(s.uGeoTexDim,Ue.set(s.uGeoTexDim.ref.value,t.positionTexture.getWidth(),t.positionTexture.getHeight())),O.update(s.tPosition,t.positionTexture),O.update(s.tGroup,t.groupTexture),O.update(s.uColorTexDim,Ue.set(s.uColorTexDim.ref.value,t.colorData.getWidth(),t.colorData.getHeight())),O.update(s.tColor,t.colorData),O.updateIfChanged(s.dColorType,t.colorType),O.updateIfChanged(s.uCurrentSlice,0),O.updateIfChanged(s.uCurrentX,0),O.updateIfChanged(s.uCurrentY,0),O.update(s.uBboxMin,n.min),O.update(s.uBboxSize,o),O.updateIfChanged(s.uResolution,r),e.namedComputeRenderables[Mf].update()}else e.namedComputeRenderables[Mf]=function uot(e,t,n,r,i){const o=C.sub(C(),n.max,n.min),s=Math.round(t.vertexCount/i),a={drawCount:O.create(s),instanceCount:O.create(t.instanceCount),stride:O.create(i),uGroupCount:O.create(t.groupCount),aTransform:O.create(t.transformBuffer),aInstance:O.create(t.instanceBuffer),aSample:O.create(sme(s,i)),uGeoTexDim:O.create(Ue.create(t.positionTexture.getWidth(),t.positionTexture.getHeight())),tPosition:O.create(t.positionTexture),tGroup:O.create(t.groupTexture),uColorTexDim:O.create(Ue.create(t.colorData.getWidth(),t.colorData.getHeight())),tColor:O.create(t.colorData),dColorType:O.create(t.colorType),uCurrentSlice:O.create(0),uCurrentX:O.create(0),uCurrentY:O.create(0),uBboxMin:O.create(n.min),uBboxSize:O.create(o),uResolution:O.create(r)},l={...lot};return ys(ms(e,"points",Wi("accumulate",aot,sot,{drawBuffers:"required"}),l,a),a)}(e,t,n,r,i);return e.namedComputeRenderables[Mf]}(r,e,m,t,n);l.currentRenderItemId=-1,D.bind(),o.drawBuffers([o.COLOR_ATTACHMENT0,o.COLOR_ATTACHMENT1]);const{uCurrentSlice:N,uCurrentX:j,uCurrentY:W}=R.values;It&&r.timer.mark("ColorAccumulate.render"),function dot(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD)}(r),l.viewport(0,0,A,M),l.scissor(0,0,A,M),s.clear(s.COLOR_BUFFER_BIT),O.update(W,0);let z=0,$=0,V=0;for(let te=0;te<w;++te)z>=E&&(z-=E,$+=_,V=0,O.update(W,$)),O.update(j,V),O.update(N,te),l.viewport(V,$,x,_),l.scissor(V,$,x,_),R.render(),++z,V+=x;T.detachFramebuffer(D,0),F.detachFramebuffer(D,1),o.drawBuffers([s.COLOR_ATTACHMENT0,s.NONE]),It&&r.timer.markEnd("ColorAccumulate.render"),It&&r.timer.mark("ColorNormalize.render"),(!i||function jXe(e){return e.format===Sde}(i))&&(i=a.texture("image-uint8","rgba","ubyte","linear")),i.define(A,M);const X=function pot(e,t,n){if(e.namedComputeRenderables[cP]){const r=e.namedComputeRenderables[cP].values;O.update(r.tColor,t),O.update(r.tCount,n),O.update(r.uTexSize,Ue.set(r.uTexSize.ref.value,t.getWidth(),t.getHeight())),e.namedComputeRenderables[cP].update()}else e.namedComputeRenderables[cP]=function hot(e,t,n){const r={...ua,tColor:O.create(t),tCount:O.create(n),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight()))},i={...fot};return ys(ms(e,"triangles",Wi("normalize",hl,oot),i,r),r)}(e,t,n);return e.namedComputeRenderables[cP]}(r,T,F);l.currentRenderItemId=-1,function mot(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0),n.blendFunc(t.ONE,t.ONE),n.blendEquation(t.FUNC_ADD)}(r),i.attachFramebuffer(D,0),l.viewport(0,0,A,M),l.scissor(0,0,A,M),s.clear(s.COLOR_BUFFER_BIT),X.render(),It&&r.timer.markEnd("ColorNormalize.render");const H=Bn.create(v[0],v[1],v[2],h),oe=d?"volumeInstance":"volume";return It&&r.timer.markEnd("calcTextureMeshColorSmoothing"),{texture:i,gridDim:y,gridTexDim:Ue.create(A,M),gridTransform:H,type:oe}}const MG="color-smoothing-rgb",uA="color-smoothing-rgba",RG="color-smoothing-alpha";function ame(e,t,n,r,i){if(!function yot(e){return"group"===e||"groupInstance"===e}(e.dColorType.ref.value))return;n*=3,r.namedTextures[MG]||(r.namedTextures[MG]=r.resources.texture("image-uint8","rgb","ubyte","nearest"));const o=r.namedTextures[MG];o.load(e.tColor.ref.value);const s=rF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:o,colorType:e.dColorType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);O.updateIfChanged(e.dColorType,s.type),O.update(e.tColorGrid,s.texture),O.update(e.uColorTexDim,s.gridTexDim),O.update(e.uColorGridDim,s.gridDim),O.update(e.uColorGridTransform,s.gridTransform)}var pr,lme;function co(e,t){return{kind:e,layers:t}}function fc(e,t){return{kind:e,layers:t}}!function(e){e.setVisibility=function t(f,p){f&&(f.state.visible=p)},e.setAlphaFactor=function n(f,p){f&&(f.state.alphaFactor=p)},e.setPickable=function r(f,p){f&&(f.state.pickable=p)},e.setColorOnly=function i(f,p){f&&(f.state.colorOnly=p)},e.mark=function o(f,p,m,h,g){if(!f||uu(p))return!1;const{tMarker:y,uMarker:v,markerAverage:x,markerStatus:_,uGroupCount:w,instanceCount:A,instanceGranularity:M}=f.values,E=M.ref.value?A.ref.value:w.ref.value*A.ref.value,{array:D}=y.ref.value,T=_.ref.value;if(!Xu(p)){let j=0;if(h(p,W=>(j+=Pe.size(W),!0),!0),0===j)return!1;j===E&&(p=KN)}let F=!1,R=-1,N=-1;if(Xu(p)){const j=function Hit(e,t){let n=-1,r=-1;switch(e){case un.Highlight:0===t||1===t?(n=1,r=1):2===t||3===t?(n=1,r=3):n=1;break;case un.RemoveHighlight:0===t||1===t?(n=0,r=0):(2===t||3===t)&&(n=1,r=2);break;case un.Select:1===t||3===t?(n=1,r=3):0===t||2===t?(n=1,r=2):n=1;break;case un.Deselect:1===t||3===t?(n=1,r=1):(0===t||2===t)&&(n=0,r=0);break;case un.Toggle:1===t?(n=1,r=3):2===t?(n=0,r=0):3===t?(n=1,r=1):0===t&&(n=1,r=2);break;case un.Clear:n=0,r=0}return{average:n,status:r}}(m,T);-1!==j.status?(F=T!==j.status,F&&function Vit(e,t,n){e.fill(t,0,n)}(D,j.status,E)):F=Qh(D,Pe.ofLength(E),m),R=j.average,N=j.status}else F=h(p,j=>Qh(D,j,m),!0),F&&(R=function Git(e,t){switch(e){case un.Highlight:return.5;case un.RemoveHighlight:return 0===t?0:2===t||3===t?.5:-1;case un.Select:return.5;case un.Deselect:return 1===t||3===t?.5:0===t?0:-1;case un.Toggle:return-1===t?-1:.5;case un.Clear:return-1===t?-1:0===t?0:.5;case un.None:return-1;default:Hi()}}(m,T),g&&-1!==g.status&&-1===R&&uc.isReverse(g.action,m)&&Yn.areEqual(p,g.loci)&&(N=g.status,R=0===N?0:.5));return F&&(-1===R&&(R=jue(D,E),0===R&&(N=0)),g&&(g.action=m,g.loci=p,g.status=T),O.updateIfChanged(v,N),-1===N&&O.update(y,y.ref.value),O.updateIfChanged(x,R),O.updateIfChanged(_,N)),F},e.setOverpaint=function s(f,p,m,h,g){if(!f)return;const{tOverpaint:y,dOverpaintType:v,dOverpaint:x,uGroupCount:_,instanceCount:w,instanceGranularity:A}=f.values,M=A.ref.value?w.ref.value:_.ref.value*w.ref.value,E=A.ref.value?"instance":"groupInstance";!function uKe(e,t,n){const r=Sa(Math.max(1,e),4,Uint8Array,n&&n.tOverpaint.ref.value.array);n?(O.update(n.tOverpaint,r),O.update(n.uOverpaintTexDim,Ue.create(r.width,r.height)),O.updateIfChanged(n.dOverpaint,e>0),O.updateIfChanged(n.dOverpaintType,t)):(O.create(r),O.create(Ue.create(r.width,r.height)),O.create(e>0),O.create(lc()),O.create(C.create(1,1,1)),O.create(Bn.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?M:0,E,f.values);const{array:D}=y.ref.value;h&&Pde(D,0,M);for(let T=0,F=p.layers.length;T<F;++T){const{loci:R,color:N,clear:j}=p.layers[T];m(R,z=>{const $=Pe.start(z),V=Pe.end(z);return j?Pde(D,$,V):cKe(D,$,V,N)},!1)}if(O.update(y,y.ref.value),O.updateIfChanged(v,E),O.updateIfChanged(x,p.layers.length>0),0!==p.layers.length&&"instance"!==E&&g&&hy(g.props)){const{geometry:T,props:F,webgl:R}=g;if("mesh"===T.kind){const{resolution:N,overpaintTexture:j}=T.meta,W=Dp(F.smoothColors,!0,N);W&&(function eot(e,t,n,r,i){if(!function Jit(e){return"groupInstance"===e}(e.dOverpaintType.ref.value))return;const o=tF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tOverpaint.ref.value,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,n,r,i);"volume"===o.kind?(O.updateIfChanged(e.dOverpaintType,o.type),O.update(e.tOverpaintGrid,o.texture),O.update(e.uOverpaintTexDim,o.gridTexDim),O.update(e.uOverpaintGridDim,o.gridDim),O.update(e.uOverpaintGridTransform,o.gridTransform)):"vertex"===o.kind&&(O.updateIfChanged(e.dOverpaintType,o.type),O.update(e.tOverpaint,o.texture),O.update(e.uOverpaintTexDim,o.texDim))}(f.values,W.resolution,W.stride,R,j),T.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}else if(R&&"texture-mesh"===T.kind){const{resolution:N,overpaintTexture:j}=T.meta,W=Dp(F.smoothColors,!0,N);W&&(function vot(e,t,n,r,i){if(!function bot(e){return"groupInstance"===e}(e.dOverpaintType.ref.value))return;n*=3,r.namedTextures[uA]||(r.namedTextures[uA]=r.resources.texture("image-uint8","rgba","ubyte","nearest"));const o=r.namedTextures[uA];o.load(e.tOverpaint.ref.value);const s=rF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:o,colorType:e.dOverpaintType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);O.updateIfChanged(e.dOverpaintType,s.type),O.update(e.tOverpaintGrid,s.texture),O.update(e.uOverpaintTexDim,s.gridTexDim),O.update(e.uOverpaintGridDim,s.gridDim),O.update(e.uOverpaintGridTransform,s.gridTransform)}(f.values,W.resolution,W.stride,R,j),T.meta.overpaintTexture=f.values.tOverpaintGrid.ref.value)}}},e.setTransparency=function a(f,p,m,h,g){if(!f)return;const{tTransparency:y,dTransparencyType:v,transparencyAverage:x,dTransparency:_,uGroupCount:w,instanceCount:A,instanceGranularity:M}=f.values,E=M.ref.value?A.ref.value:w.ref.value*A.ref.value,D=M.ref.value?"instance":"groupInstance";!function pKe(e,t,n){const r=Sa(Math.max(1,e),1,Uint8Array,n&&n.tTransparency.ref.value.array);n?(O.update(n.tTransparency,r),O.update(n.uTransparencyTexDim,Ue.create(r.width,r.height)),O.updateIfChanged(n.dTransparency,e>0),O.updateIfChanged(n.transparencyAverage,Mde(r.array,e)),O.updateIfChanged(n.dTransparencyType,t)):(O.create(r),O.create(Ue.create(r.width,r.height)),O.create(e>0),O.create(0),O.create(lc()),O.create(C.create(1,1,1)),O.create(Bn.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?E:0,D,f.values);const{array:T}=y.ref.value;h&&function fKe(e,t,n){e.fill(0,t,n)}(T,0,E);for(let F=0,R=p.layers.length;F<R;++F){const{loci:N,value:j}=p.layers[F];m(N,z=>{const $=Pe.start(z),V=Pe.end(z);return dKe(T,$,V,j)},!1)}if(O.update(y,y.ref.value),O.updateIfChanged(x,Mde(T,E)),O.updateIfChanged(v,D),O.updateIfChanged(_,p.layers.length>0),0!==p.layers.length&&"instance"!==D&&g&&hy(g.props)){const{geometry:F,props:R,webgl:N}=g;if("mesh"===F.kind){const{resolution:j,transparencyTexture:W}=F.meta,z=Dp(R.smoothColors,!0,j);z&&(function not(e,t,n,r,i){if(!function tot(e){return"groupInstance"===e}(e.dTransparencyType.ref.value))return;const o=tF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tTransparency.ref.value,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:1},t,n,r,i);"volume"===o.kind?(O.updateIfChanged(e.dTransparencyType,o.type),O.update(e.tTransparencyGrid,o.texture),O.update(e.uTransparencyTexDim,o.gridTexDim),O.update(e.uTransparencyGridDim,o.gridDim),O.update(e.uTransparencyGridTransform,o.gridTransform)):"vertex"===o.kind&&(O.updateIfChanged(e.dTransparencyType,o.type),O.update(e.tTransparency,o.texture),O.update(e.uTransparencyTexDim,o.texDim))}(f.values,z.resolution,z.stride,N,W),F.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}else if(N&&"texture-mesh"===F.kind){const{resolution:j,transparencyTexture:W}=F.meta,z=Dp(R.smoothColors,!0,j);z&&(function _ot(e,t,n,r,i){if(!function xot(e){return"groupInstance"===e}(e.dTransparencyType.ref.value))return;n*=3,r.namedTextures[RG]||(r.namedTextures[RG]=r.resources.texture("image-uint8","alpha","ubyte","nearest"));const o=r.namedTextures[RG];o.load(e.tTransparency.ref.value);const s=rF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:o,colorType:e.dTransparencyType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);O.updateIfChanged(e.dTransparencyType,s.type),O.update(e.tTransparencyGrid,s.texture),O.update(e.uTransparencyTexDim,s.gridTexDim),O.update(e.uTransparencyGridDim,s.gridDim),O.update(e.uTransparencyGridTransform,s.gridTransform)}(f.values,z.resolution,z.stride,N,W),F.meta.transparencyTexture=f.values.tTransparencyGrid.ref.value)}}},e.setSubstance=function l(f,p,m,h,g){if(!f)return;const{tSubstance:y,dSubstanceType:v,dSubstance:x,uGroupCount:_,instanceCount:w,instanceGranularity:A}=f.values,M=A.ref.value?w.ref.value:_.ref.value*w.ref.value,E=A.ref.value?"instance":"groupInstance";!function bKe(e,t,n){const r=Sa(Math.max(1,e),4,Uint8Array,n&&n.tSubstance.ref.value.array);n?(O.update(n.tSubstance,r),O.update(n.uSubstanceTexDim,Ue.create(r.width,r.height)),O.updateIfChanged(n.dSubstance,e>0),O.updateIfChanged(n.dSubstanceType,t)):(O.create(r),O.create(Ue.create(r.width,r.height)),O.create(e>0),O.create(lc()),O.create(C.create(1,1,1)),O.create(Bn.create(0,0,0,1)),O.create(t),O.create(1))}(p.layers.length?M:0,E,f.values);const{array:D}=y.ref.value;h&&Fde(D,0,M);for(let T=0,F=p.layers.length;T<F;++T){const{loci:R,material:N,clear:j}=p.layers[T];m(R,z=>{const $=Pe.start(z),V=Pe.end(z);return j?Fde(D,$,V):yKe(D,$,V,N)},!1)}if(O.update(y,y.ref.value),O.updateIfChanged(v,E),O.updateIfChanged(x,p.layers.length>0),0!==p.layers.length&&"instance"!==E&&g&&hy(g.props)){const{geometry:T,props:F,webgl:R}=g;if("mesh"===T.kind){const{resolution:N,substanceTexture:j}=T.meta,W=Dp(F.smoothColors,!0,N);W&&(function iot(e,t,n,r,i){if(!function rot(e){return"groupInstance"===e}(e.dSubstanceType.ref.value))return;const o=tF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionBuffer:e.aPosition.ref.value,groupBuffer:e.aGroup.ref.value,colorData:e.tSubstance.ref.value,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value,itemSize:4},t,n,r,i);"volume"===o.kind?(O.updateIfChanged(e.dSubstanceType,o.type),O.update(e.tSubstanceGrid,o.texture),O.update(e.uSubstanceTexDim,o.gridTexDim),O.update(e.uSubstanceGridDim,o.gridDim),O.update(e.uSubstanceGridTransform,o.gridTransform)):"vertex"===o.kind&&(O.updateIfChanged(e.dSubstanceType,o.type),O.update(e.tSubstance,o.texture),O.update(e.uSubstanceTexDim,o.texDim))}(f.values,W.resolution,W.stride,R,j),T.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}else if(R&&"texture-mesh"===T.kind){const{resolution:N,substanceTexture:j}=T.meta,W=Dp(F.smoothColors,!0,N);W&&(function Cot(e,t,n,r,i){if(!function Sot(e){return"groupInstance"===e}(e.dSubstanceType.ref.value))return;n*=3,r.namedTextures[uA]||(r.namedTextures[uA]=r.resources.texture("image-uint8","rgba","ubyte","nearest"));const o=r.namedTextures[uA];o.load(e.tSubstance.ref.value);const s=rF({vertexCount:e.uVertexCount.ref.value,instanceCount:e.uInstanceCount.ref.value,groupCount:e.uGroupCount.ref.value,transformBuffer:e.aTransform.ref.value,instanceBuffer:e.aInstance.ref.value,positionTexture:e.tPosition.ref.value,groupTexture:e.tGroup.ref.value,colorData:o,colorType:e.dSubstanceType.ref.value,boundingSphere:e.boundingSphere.ref.value,invariantBoundingSphere:e.invariantBoundingSphere.ref.value},t,n,r,i);O.updateIfChanged(e.dSubstanceType,s.type),O.update(e.tSubstanceGrid,s.texture),O.update(e.uSubstanceTexDim,s.gridTexDim),O.update(e.uSubstanceGridDim,s.gridDim),O.update(e.uSubstanceGridTransform,s.gridTransform)}(f.values,W.resolution,W.stride,R,j),T.meta.substanceTexture=f.values.tSubstanceGrid.ref.value)}}},e.setClipping=function c(f,p,m,h){if(!f)return;const{tClipping:g,dClippingType:y,dClipping:v,uGroupCount:x,instanceCount:_,instanceGranularity:w}=f.values,A=w.ref.value?_.ref.value:x.ref.value*_.ref.value,{layers:M}=p,E=w.ref.value?"instance":"groupInstance";!function gKe(e,t,n){const r=Sa(Math.max(1,e),1,Uint8Array,n&&n.tClipping.ref.value.array);n?(O.update(n.tClipping,r),O.update(n.uClippingTexDim,Ue.create(r.width,r.height)),O.updateIfChanged(n.dClipping,e>0),O.updateIfChanged(n.dClippingType,t)):(O.create(r),O.create(Ue.create(r.width,r.height)),O.create(e>0),O.create(t))}(M.length?A:0,E,f.values);const{array:D}=g.ref.value;h&&function mKe(e,t,n){e.fill(0,t,n)}(D,0,A);for(let T=0,F=p.layers.length;T<F;++T){const{loci:R,groups:N}=p.layers[T];m(R,W=>{const z=Pe.start(W),$=Pe.end(W);return hKe(D,z,$,N)},!1)}O.update(g,g.ref.value),O.updateIfChanged(y,E),O.updateIfChanged(v,p.layers.length>0)},e.setThemeStrength=function u(f,p){f&&(O.updateIfChanged(f.values.uOverpaintStrength,p.overpaint),O.updateIfChanged(f.values.uTransparencyStrength,p.transparency),O.updateIfChanged(f.values.uSubstanceStrength,p.substance))},e.setTransform=function d(f,p,m){if(!f||!p&&!m)return;const{values:h}=f;p&&(fe.copy(h.matrix.ref.value,p),O.update(h.matrix,h.matrix.ref.value)),m?(h.extraTransform.ref.value.set(m),O.update(h.extraTransform,h.extraTransform.ref.value)):null===m&&(yN(h.extraTransform.ref.value,h.instanceCount.ref.value),O.update(h.extraTransform,h.extraTransform.ref.value)),Ide(h,h.invariantBoundingSphere.ref.value,h.instanceGrid.ref.value.cellSize,h.instanceGrid.ref.value.batchSize);const g=pl(h.invariantBoundingSphere.ref.value,h.transform.ref.value,h.instanceCount.ref.value,0);O.update(h.boundingSphere,g)}}(pr||(pr={})),function(e){let t;function r(u){return 0===u.layers.length}e.Empty={kind:"empty-loci",layers:[]},function(u){let d;var y;function m(y){switch(y){case"one":return d.One;case"two":return d.Two;case"three":return d.Three;case"four":return d.Four;case"five":return d.Five;case"six":return d.Six}}u.is=Mc.has,(y=d=u.Flag||(u.Flag={}))[y.None=0]="None",y[y.One=1]="One",y[y.Two=2]="Two",y[y.Three=4]="Three",y[y.Four=8]="Four",y[y.Five=16]="Five",y[y.Six=32]="Six",u.create=function f(y){return Mc.create(y)},u.Names={one:d.One,two:d.Two,three:d.Three,four:d.Four,five:d.Five,six:d.Six},u.isName=function p(y){return y in u.Names},u.fromName=m,u.fromNames=function h(y){let v=d.None;for(let x=0,_=y.length;x<_;++x)v|=m(y[x]);return v},u.toNames=function g(y){const v=[];return u.is(y,d.One)&&v.push("one"),u.is(y,d.Two)&&v.push("two"),u.is(y,d.Three)&&v.push("three"),u.is(y,d.Four)&&v.push("four"),u.is(y,d.Five)&&v.push("five"),u.is(y,d.Six)&&v.push("six"),v}}(t=e.Groups||(e.Groups={})),e.areEqual=function n(u,d){if(u.layers.length!==d.layers.length)return!1;for(let f=0,p=u.layers.length;f<p;++f)if(u.layers[f].groups!==d.layers[f].groups||!Yn.areEqual(u.layers[f].loci,d.layers[f].loci))return!1;return!0},e.isEmpty=r,e.remap=function i(u,d){if("element-loci"===u.kind){const f=[];for(const p of u.layers){let{loci:m,groups:h}=p;m=Me.remap(m,d),Me.isEmpty(m)||f.push({loci:m,groups:h})}return{kind:"element-loci",layers:f}}return u},e.merge=function o(u){if(r(u))return u;if("element-loci"===u.kind){const{structure:d}=u.layers[0].loci,f=new Map;let p=Me.none(d);for(let h=0,g=u.layers.length;h<g;++h){let{loci:y,groups:v}=u.layers[g-h-1];y=Me.subtract(y,p),p=Me.union(y,p),Me.isEmpty(y)||(f.has(v)&&(y=Me.union(y,f.get(v))),f.set(v,y))}const m=[];return f.forEach((h,g)=>{m.push({loci:h,groups:g})}),{kind:"element-loci",layers:m}}return u},e.filter=function s(u,d){if(r(u))return u;if("element-loci"===u.kind){const{structure:f}=u.layers[0].loci,p=[];for(const m of u.layers){let{loci:h,groups:g}=m;const y=Me.remap(h,d);h=Me.remap(y,f),Me.isEmpty(h)||p.push({loci:h,groups:g})}return{kind:"element-loci",layers:p}}return u},e.ofScript=function a(u,d){const f=[];for(let p=0,m=u.length;p<m;++p){const{script:h,groups:g}=u[p],y=pa.toLoci(h,d);Me.isEmpty(y)||f.push({loci:y,groups:g})}return{kind:"element-loci",layers:f}},e.ofBundle=function l(u,d){const f=[];for(let p=0,m=u.length;p<m;++p){const{bundle:h,groups:g}=u[p],y=Qr.toLoci(h,d.root);f.push({loci:y,groups:g})}return{kind:"element-loci",layers:f}},e.toBundle=function c(u){const d=[];for(let f=0,p=u.layers.length;f<p;++f){const{loci:m,groups:h}=u.layers[f],g=Qr.fromLoci(m);d.push({bundle:g,groups:h})}return{kind:"element-loci",layers:d}}}(co||(co={})),function(e){function n(c){return 0===c.layers.length}e.Empty={kind:"empty-loci",layers:[]},e.areEqual=function t(c,u){if(0===c.layers.length&&0===u.layers.length)return!0;if(c.layers.length!==u.layers.length)return!1;for(let d=0,f=c.layers.length;d<f;++d)if(c.layers[d].clear!==u.layers[d].clear||!FR(c.layers[d].material,u.layers[d].material)||!Yn.areEqual(c.layers[d].loci,u.layers[d].loci))return!1;return!0},e.isEmpty=n,e.remap=function r(c,u){if("element-loci"===c.kind){const d=[];for(const f of c.layers){let{loci:p,material:m,clear:h}=f;p=Me.remap(p,u),Me.isEmpty(p)||d.push({loci:p,material:m,clear:h})}return{kind:"element-loci",layers:d}}return c},e.merge=function i(c){if(n(c))return c;if("element-loci"===c.kind){const{structure:u}=c.layers[0].loci;let d;const f=new Map;let p=Me.none(u);for(let h=0,g=c.layers.length;h<g;++h){let{loci:y,material:v,clear:x}=c.layers[g-h-1];y=Me.subtract(y,p),p=Me.union(y,p),Me.isEmpty(y)||(x?d=d?Me.union(y,d):y:(f.has(v)&&(y=Me.union(y,f.get(v))),f.set(v,y)))}const m=[];return d&&m.push({loci:d,material:tu(),clear:!0}),f.forEach((h,g)=>{m.push({loci:h,material:g,clear:!1})}),{kind:"element-loci",layers:m}}return c},e.filter=function o(c,u){if(n(c))return c;if("element-loci"===c.kind){const{structure:d}=c.layers[0].loci,f=[];for(const p of c.layers){let{loci:m,material:h,clear:g}=p;const y=Me.remap(m,u);m=Me.remap(y,d),Me.isEmpty(m)||f.push({loci:m,material:h,clear:g})}return{kind:"element-loci",layers:f}}return c},e.ofScript=function s(c,u){const d=[];for(let f=0,p=c.length;f<p;++f){const{script:m,material:h,clear:g}=c[f],y=pa.toLoci(m,u);Me.isEmpty(y)||d.push({loci:y,material:h,clear:g})}return{kind:"element-loci",layers:d}},e.ofBundle=function a(c,u){const d=[];for(let f=0,p=c.length;f<p;++f){const{bundle:m,material:h,clear:g}=c[f],y=Qr.toLoci(m,u.root);d.push({loci:y,material:h,clear:g})}return{kind:"element-loci",layers:d}},e.toBundle=function l(c){const u=[];for(let d=0,f=c.layers.length;d<f;++d){const{loci:p,material:m,clear:h}=c.layers[d],g=Qr.fromLoci(p);u.push({bundle:g,material:m,clear:h})}return{kind:"element-loci",layers:u}}}(fc||(fc={})),function(e){e.getDetaultParams=function t(n,r,i){return I.getDefaultValues(n.getParams(r,i))}}(lme||(lme={}));const wot={name:"",label:"",description:"",factory:()=>Xn.Empty,getParams:()=>({}),defaultValues:{},defaultColorTheme:Rd.EmptyProvider,defaultSizeTheme:Ya.EmptyProvider,isApplicable:()=>!0};function cme(e){return e.map(t=>[t.name,t.provider.label])}class ume{get default(){return this._list[0]}get types(){return cme(this._list)}constructor(){this._list=[],this._map=new Map,this._name=new Map}add(t){if(this._map.has(t.name))throw new Error(`${t.name} already registered.`);this._list.push({name:t.name,provider:t}),this._map.set(t.name,t),this._name.set(t,t.name)}getName(t){if(!this._name.has(t))throw new Error(`'${t.label}' is not a registered represenatation provider.`);return this._name.get(t)}remove(t){const n=t.name;this._list.splice(this._list.findIndex(i=>i.name===n),1);const r=this._map.get(n);r&&(this._map.delete(n),this._name.delete(r))}get(t){return this._map.get(t)||wot}get list(){return this._list}getApplicableList(t){return this._list.filter(n=>n.provider.isApplicable(t))}getApplicableTypes(t){return cme(this.getApplicableList(t))}clear(){this._list.length=0,this._map.clear(),this._name.clear()}}var Xn;function Xa(e,t,n={}){let r=0;const i=new si,o=Xn.createState(),s=ky(),a=[];let l,c,u=-1;const d=Ia.createEmpty();let m,h,f=I.getDefaultValues(t.Params);n.modifyState&&Xn.updateState(o,n.modifyState(o));const g=Ag.create();function _(w,A){return Xu(w)||zr.isLoci(w)&&w.shape===c?A(Pe.ofBounds(0,f.instanceGranularity?c.transforms.length:c.groupCount*c.transforms.length)):f.instanceGranularity?function x(w,A,M){let E=!1;if(!Bc.isLoci(w)||Bc.isLociEmpty(w)||w.shape!==A)return!1;for(const D of w.groups)M(Pe.ofSingleton(D.instance))&&(E=!0);return E}(w,c,A):function Aot(e,t,n){if(!Bc.isLoci(e)||e.shape!==t)return!1;let r=!1;const{groupCount:i}=t,{groups:o}=e;for(const{ids:s,instance:a}of o)if(Pe.is(s)){const l=a*i+Pe.start(s),c=a*i+Pe.end(s);n(Pe.ofBounds(l,c))&&(r=!0)}else for(let l=0,c=s.length;l<c;l++)n(Pe.ofSingleton(a*i+s[l]))&&(r=!0);return r}(w,c,A)}return{label:"Shape geometry",get groupCount(){return m?m.count:0},get props(){return f},get params(){},get state(){return o},get theme(){return d},renderObjects:a,get geometryVersion(){return u},updated:i,createOrUpdate:function v(w={},A){return n.modifyProps&&(w=n.modifyProps(w)),Ke.create("ShapeRepresentation.create",function(){var M=le(function*(E){const D=Object.assign(f,w),T=A?yield e(E,A,D,c):void 0;if(function y(w={},A){Ag.reset(g),(A||c)&&(A&&!c?g.createNew=!0:A&&c&&A.id===c.id||(A&&c&&A.id!==c.id?(g.updateTransform=!0,g.createGeometry=!0):A&&console.warn("unexpected state")),w.instanceGranularity!==f.instanceGranularity&&(g.updateTransform=!0),g.updateTransform&&(g.updateColor=!0,g.updateSize=!0,g.updateMatrix=!0),g.createGeometry&&(g.updateColor=!0,g.updateSize=!0))}(w,T),T&&(c=T,Object.assign(d,zr.getTheme(c))),g.createNew){a.length=0,m=zr.groupIterator(c);const F=zr.createTransform(c.transforms,c.geometry.boundingSphere,D.cellSize,D.batchSize),R=t.createValues(c.geometry,F,m,d,D),N=t.createRenderableState(D);n.modifyState&&Object.assign(N,n.modifyState(N)),Xn.updateState(o,N),l=Jw(c.geometry.kind,R,N,s),l&&a.push(l),h=t.createPositionIterator(c.geometry,l.values)}else{if(!l)throw new Error("expected renderObject to be available");if(g.updateTransform){m=zr.groupIterator(c);const{instanceCount:F,groupCount:R}=m;w.instanceGranularity?hs(F,"instance",l.values):hs(F*R,"groupInstance",l.values)}g.updateMatrix&&(zr.createTransform(c.transforms,c.geometry.boundingSphere,D.cellSize,D.batchSize,l.values),"lodLevels"in l.values&&O.update(l.values.lodLevels,l.values.lodLevels.ref.value)),g.createGeometry&&(O.updateIfChanged(l.values.drawCount,$a.getDrawCount(c.geometry)),O.updateIfChanged(l.values.uVertexCount,$a.getVertexCount(c.geometry)),O.updateIfChanged(l.values.uGroupCount,$a.getGroupCount(c.geometry))),(g.updateTransform||g.createGeometry)&&(t.updateBoundingSphere(l.values,c.geometry),h=t.createPositionIterator(c.geometry,l.values)),g.updateColor&&Ef(m,h,d.color,l.values),g.updateSize&&"uSize"in l.values&&xy(m,d.size,l.values),t.updateValues(l.values,D),t.updateRenderableState(l.state,D)}f=D,(g.createGeometry||g.createNew)&&(u+=1),i.next(r++)});return function(E){return M.apply(this,arguments)}}())},getLoci(w){const{objectId:A,groupId:M,instanceId:E}=w;return l&&l.id===A?Bc.Loci(c,[{ids:Ve.ofSingleton(M),instance:E}]):qr},getAllLoci:()=>[zr.Loci(c)],eachLocation:w=>{for(m.reset();m.hasNext;){const{location:A,isSecondary:M}=m.move();w(A,M)}},mark(w,A){if(!uc.is(o.markerActions,A))return!1;if(Bc.isLoci(w)||zr.isLoci(w)){if(w.shape!==c)return!1}else if(!Xu(w))return!1;return pr.mark(l,w,A,_)},setState(w){n.modifyState&&(w=n.modifyState(w)),l&&(void 0!==w.visible&&pr.setVisibility(l,w.visible),void 0!==w.alphaFactor&&pr.setAlphaFactor(l,w.alphaFactor),void 0!==w.pickable&&pr.setPickable(l,w.pickable),void 0!==w.colorOnly&&pr.setColorOnly(l,w.colorOnly),void 0!==w.overpaint&&pr.setOverpaint(l,w.overpaint,_,!0),void 0!==w.transparency&&pr.setTransparency(l,w.transparency,_,!0),void 0!==w.substance&&pr.setSubstance(l,w.substance,_,!0),void 0!==w.transform&&pr.setTransform(l,w.transform)),Xn.updateState(o,w)},setTheme(w){$n&&console.warn("The `ShapeRepresentation` theme is fixed to `ShapeGroupColorTheme` and `ShapeGroupSizeTheme`. Colors are taken from `Shape.getColor` and sizes from `Shape.getSize`")},destroy(){a.length=0,l&&(l.state.disposed=!0,l=void 0)}}}!function(e){let t;var a;function n(){return{visible:!0,alphaFactor:1,pickable:!0,colorOnly:!1,syncManually:!1,transform:fe.identity(),overpaint:Ea.Empty,transparency:dc.Empty,substance:fc.Empty,clipping:co.Empty,themeStrength:{overpaint:1,transparency:1,substance:1},markerActions:uc.All}}function r(a,l){void 0!==l.visible&&(a.visible=l.visible),void 0!==l.alphaFactor&&(a.alphaFactor=l.alphaFactor),void 0!==l.pickable&&(a.pickable=l.pickable),void 0!==l.colorOnly&&(a.colorOnly=l.colorOnly),void 0!==l.overpaint&&(a.overpaint=l.overpaint),void 0!==l.transparency&&(a.transparency=l.transparency),void 0!==l.substance&&(a.substance=l.substance),void 0!==l.clipping&&(a.clipping=l.clipping),void 0!==l.themeStrength&&(a.themeStrength=l.themeStrength),void 0!==l.syncManually&&(a.syncManually=l.syncManually),void 0!==l.transform&&fe.copy(a.transform,l.transform),void 0!==l.markerActions&&(a.markerActions=l.markerActions)}(a=t=e.Loci||(e.Loci={})).areEqual=function l(u,d){return u.repr===d.repr&&Yn.areEqual(u.loci,d.loci)},a.isEmpty=function c(u){return Yn.isEmpty(u.loci)},a.Empty={loci:qr},e.createState=n,e.updateState=r,e.StateBuilder={create:n,update:r},e.Empty={label:"",groupCount:0,renderObjects:[],geometryVersion:-1,props:{},params:{},updated:new si,state:n(),theme:Ia.createEmpty(),createOrUpdate:()=>Ke.constant("",void 0),setState:()=>{},setTheme:()=>{},getLoci:()=>qr,getAllLoci:()=>[],eachLocation:()=>{},mark:()=>!1,destroy:()=>{}};class i{constructor(){this.curr=new Set,this.next=new Set,this._version=-1}get version(){return this._version}add(l,c){this.next.add(gf(l,c))}snapshot(){Lo.areEqual(this.curr,this.next)||(this._version+=1),[this.curr,this.next]=[this.next,this.curr],this.next.clear()}}e.GeometryState=i,e.createMulti=function o(a,l,c,u,d){let f=0;const p=new si,m=new i,h=u.create();let y,v,x,g=Ia.createEmpty();const _={},w=Object.keys(d).map((A,M)=>{_[M]=A;const E=d[A](l,c);return E.setState(h),E});return{label:a,updated:p,get groupCount(){let A=0;if(v){const{visuals:M}=v;for(let E=0,D=w.length;E<D;++E)(!M||M.includes(_[E]))&&(A+=w[E].groupCount)}return A},get renderObjects(){const A=[];if(v){const{visuals:M}=v;for(let E=0,D=w.length;E<D;++E)(!M||M.includes(_[E]))&&A.push(...w[E].renderObjects)}return A},get geometryVersion(){return m.version},get props(){return v},get params(){return y},createOrUpdate:(A={},M)=>{M&&M!==x&&(y=c(l,M),x=M,v||(v=I.getDefaultValues(y)));const E=kG(Object.assign({},v,A),x);Object.assign(v,A,E);const{visuals:D}=v;return Ke.create(`Creating or updating '${a}' representation`,function(){var T=le(function*(F){for(let R=0,N=w.length;R<N;++R)(!D||D.includes(_[R]))&&(yield w[R].createOrUpdate(v,x).runInContext(F)),m.add(R,w[R].geometryVersion);m.snapshot(),p.next(f++)});return function(F){return T.apply(this,arguments)}}())},get state(){return h},get theme(){return g},getLoci:A=>{const{visuals:M}=v;for(let E=0,D=w.length;E<D;++E)if(!M||M.includes(_[E])){const T=w[E].getLoci(A);if(!uu(T))return T}return qr},getAllLoci:()=>{const A=[],{visuals:M}=v;for(let E=0,D=w.length;E<D;++E)(!M||M.includes(_[E]))&&A.push(...w[E].getAllLoci());return A},eachLocation:A=>{const{visuals:M}=v;for(let E=0,D=w.length;E<D;++E)(!M||M.includes(_[E]))&&w[E].eachLocation(A)},mark:(A,M)=>{let E=!1;for(let D=0,T=w.length;D<T;++D)E=w[D].mark(A,M)||E;return E},setState:A=>{u.update(h,A);for(let M=0,E=w.length;M<E;++M)w[M].setState(A)},setTheme:A=>{g=A;for(let M=0,E=w.length;M<E;++M)w[M].setTheme(A)},destroy(){for(let A=0,M=w.length;A<M;++A)w[A].destroy()}}},e.fromRenderObject=function s(a,l){let c=0;const u=new si,d=new i,f=e.createState(),p=Ia.createEmpty(),m=I.clone(xt.Params),h=I.getDefaultValues(xt.Params);return{label:a,updated:u,get groupCount(){return l.values.uGroupCount.ref.value},get renderObjects(){return[l]},get geometryVersion(){return d.version},get props(){return h},get params(){return m},createOrUpdate:(g={})=>{const y=kG(Object.assign({},h,g));return Object.assign(h,g,y),Ke.create(`Updating '${a}' representation`,function(){var v=le(function*(x){d.add(0,l.id),d.snapshot(),u.next(c++)});return function(x){return v.apply(this,arguments)}}())},get state(){return f},get theme(){return p},getLoci:()=>qr,getAllLoci:()=>[],eachLocation:()=>{},mark:(g,y)=>!1,setState:g=>{void 0!==g.visible&&pr.setVisibility(l,g.visible),void 0!==g.alphaFactor&&pr.setAlphaFactor(l,g.alphaFactor),void 0!==g.pickable&&pr.setPickable(l,g.pickable),void 0!==g.colorOnly&&pr.setColorOnly(l,g.colorOnly),void 0!==g.themeStrength&&pr.setThemeStrength(l,g.themeStrength),void 0!==g.transform&&pr.setTransform(l,g.transform),e.updateState(f,g)},setTheme:()=>{},destroy(){}}}}(Xn||(Xn={}));const dme=fe();class dA{constructor(t){this.structure=t,this.groupUnitTransforms=[],this.unitOffsetMap=sp.Mutable(),this.groupIndexMap=sp.Mutable(),this._isIdentity=void 0,this.version=0,this.unitTransforms=new Float32Array(16*t.units.length),this.size=t.units.length,this.reset();let n=0;for(let r=0,i=t.unitSymmetryGroups.length;r<i;++r){const o=t.unitSymmetryGroups[r];this.groupIndexMap.set(o.hashCode,r);const s=this.unitTransforms.subarray(n,n+16*o.units.length);this.groupUnitTransforms.push(s);for(let a=0,l=o.units.length;a<l;++a)this.unitOffsetMap.set(o.units[a].id,n+16*a);n+=16*o.units.length}}reset(){this.version=0,yN(this.unitTransforms,this.size),this._isIdentity=!0}get isIdentity(){if(void 0===this._isIdentity){this._isIdentity=!0;for(let t=0,n=16*this.size;t<n;t+=16)if(fe.fromArray(dme,this.unitTransforms,t),!fe.isIdentity(dme)){this._isIdentity=!1;break}}return this._isIdentity}setTransform(t,n){this.version=(this.version+1)%2147483647,fe.toArray(t,this.unitTransforms,this.unitOffsetMap.get(n.id)),this._isIdentity=void 0}getTransform(t,n){return fe.fromArray(t,this.unitTransforms,this.unitOffsetMap.get(n.id))}getSymmetryGroupTransforms(t){return this.groupUnitTransforms[this.groupIndexMap.get(t.hashCode)]}}const fme=fe();function pme(e,t,n){for(let r=0,i=e.units.length;r<i;r++){const o=e.units[r];ko.lerpFromIdentity(fme,o.conformation.operator,n),t.setTransform(fme,o)}}const hme=C(),fA=C(),iF=fe();function mme(e,t,n,r){const i=r.radius*n;for(let o=0,s=e.units.length;o<s;o++){const a=e.units[o];C.transformMat4(hme,a.lookup3d.boundary.sphere.center,a.conformation.operator.matrix),C.sub(fA,hme,r.center),C.setMagnitude(fA,fA,i),fe.fromTranslation(iF,fA),t.setTransform(iF,a)}}const Iot={axis:I.MappedStatic("custom",{structure:I.Group({principalAxis:I.Select("dirA",[["dirA","A"],["dirB","B"],["dirC","C"]])}),custom:I.Group({vector:I.Vec3(C.create(0,0,1))})}),origin:I.MappedStatic("structure",{structure:I.Group({}),custom:I.Group({vector:I.Vec3(C.create(0,0,0))})})};function gme(e,t){let n,r;return n="custom"===t.axis.name?t.axis.params.vector:Xe.getPrincipalAxes(e).momentsAxes[t.axis.params.principalAxis],r="custom"===t.origin.name?t.origin.params.vector:Xe.getPrincipalAxes(e).momentsAxes.origin,{axis:n,origin:r}}const yme=fe(),bme=fe(),oF=fe();function vme(e,t,n,r,i){for(let o=0,s=e.units.length;o<s;o++){const a=e.units[o];C.negate(fA,i),fe.fromTranslation(iF,fA),fe.fromRotation(yme,Math.PI*n*2,r),fe.fromTranslation(bme,i),fe.mul(oF,yme,iF),fe.mul(oF,bme,oF),t.setTransform(oF,a)}}const Eot=fe.fromTranslation(fe(),C.create(.5,.5,.5)),Tot=zde(Ude(cfe()),Eot),Jh=C(),xme=fe(),kot={...on.Params,cellColor:I.Color(qn.orange),cellScale:I.Numeric(2,{min:.1,max:5,step:.1}),ref:I.Select("model",I.objectToOptions({origin:"Origin",model:"Model"}),{isEssential:!0}),attachment:I.Select("corner",I.objectToOptions({corner:"Corner",center:"Center"}),{isEssential:!0})},Mot={mesh:(e,t)=>Xa(Not,on.Utils)},_me={...kot};function Not(e,t,n,r){const i=function Rot(e,t,n){const r=Ct.createState(256,128,n),{fromFractional:i}=e.symmetry.spacegroup.cell;C.copy(Jh,e.ref),"center"===t.attachment?(C.trunc(Jh,Jh),C.subScalar(Jh,Jh,.5)):C.floor(Jh,Jh),fe.fromTranslation(xme,Jh);const o=zde(Ude(Tot),xme),s=Math.cbrt(e.symmetry.spacegroup.cell.volume)/300*t.cellScale;r.currentGroup=1,Ct.addCage(r,i,o,s,2,20);const a=ke.fromDimensionsAndTransform(ke(),C.unit,i);C.transformMat4(Jh,Jh,i),ke.translate(a,a,Jh),ke.expand(a,a,s);const l=Ct.getMesh(r);return l.setBoundingSphere(a),l}(t,n,r&&r.geometry),o=M3.getUnitcellLabel(t.symmetry);return zr.create(o,t,i,()=>n.cellColor,()=>1,()=>o)}function Sme(e,t,n){const r=C();return"model"===n.ref&&C.transformMat4(r,Sn.getCenter(e),t.spacegroup.cell.toFractional),{symmetry:t,ref:r}}const jp=new Uint16Array([0,1,2,1,3,2]),B_=tt.add3,pc=tt.add2,Cme=tt.add;var Ig;!function(e){e.create=function t(n={},r=2048,i=1024,o){r*=2,i*=2;const s=tt.create(Float32Array,3,i,o?o.centerBuffer.ref.value:r),a=tt.create(Float32Array,2,i,o?o.mappingBuffer.ref.value:r),l=tt.create(Float32Array,1,i,o?o.depthBuffer.ref.value:r),c=tt.create(Uint32Array,3,i,o?o.indexBuffer.ref.value:r),u=tt.create(Float32Array,1,i,o?o.groupBuffer.ref.value:r),d=tt.create(Float32Array,2,i,o?o.tcoordBuffer.ref.value:r),f={...I.getDefaultValues(Tf.Params),...n},{attachment:p,background:m,backgroundMargin:h,tether:g,tetherLength:y,tetherBaseWidth:v}=f,x=function ZKe(e){const t=JSON.stringify(e);return void 0===W9[t]&&(W9[t]=new QKe(e)),W9[t]}(f),_=.4*h,w=x.buffer/x.lineHeight,A=(M,E,D,T,F)=>{B_(s,M,E,D),Cme(l,T),Cme(u,F)};return{add:(M,E,D,T,F,R,N)=>{let j=0;const W=M.length;for(let Q=0;Q<W;++Q)j+=x.get(M[Q]).nw-2*w;let $,V;if($=p.startsWith("top")?.8:p.startsWith("middle")?.4:0,V=p.endsWith("right")?j:p.endsWith("center")?j/2:0,g)switch(p){case"bottom-left":V-=y/2+_+.1,$-=y/2+_;break;case"bottom-center":$-=y+_;break;case"bottom-right":V+=y/2+_+.1,$-=y/2+_;break;case"middle-left":V-=y+_+.1;break;case"middle-center":break;case"middle-right":V+=y+_+.1;break;case"top-left":V-=y/2+_+.1,$+=y/2+_;break;case"top-center":$+=y+_;break;case"top-right":V+=y/2+_+.1,$+=y/2+_}const X=(-V-_-.1)*R,H=(j-V+_+.1)*R,oe=(.8-$+_)*R,te=(-$-_)*R;if(m){pc(a,X,oe),pc(a,X,te),pc(a,H,oe),pc(a,H,te);const Q=s.elementCount;for(let G=0;G<4;++G)pc(d,10,10),A(E,D,T,F,N);B_(c,Q+jp[0],Q+jp[1],Q+jp[2]),B_(c,Q+jp[3],Q+jp[4],Q+jp[5])}if(g){let Q,G,Z,ee,se,xe,re,ae;const ge=y*R,Ie=v*R;switch(p){case"bottom-left":Q=X-ge/2,Z=X+Ie/2,se=X,re=X,G=te-ge/2,ee=te,xe=te+Ie/2,ae=te;break;case"bottom-center":Q=0,Z=Ie/2,se=-Ie/2,re=0,G=te-ge,ee=te,xe=te,ae=te;break;case"bottom-right":Q=H+ge/2,Z=H,se=H-Ie/2,re=H,G=te-ge/2,ee=te+Ie/2,xe=te,ae=te;break;case"middle-left":Q=X-ge,Z=X,se=X,re=X,G=0,ee=-Ie/2,xe=Ie/2,ae=0;break;case"middle-center":Q=0,Z=0,se=0,re=0,G=0,ee=0,xe=0,ae=0;break;case"middle-right":Q=H+ge,Z=H,se=H,re=H,G=0,ee=Ie/2,xe=-Ie/2,ae=0;break;case"top-left":Q=X-ge/2,Z=X+Ie/2,se=X,re=X,G=oe+ge/2,ee=oe,xe=oe-Ie/2,ae=oe;break;case"top-center":Q=0,Z=Ie/2,se=-Ie/2,re=0,G=oe+ge,ee=oe,xe=oe,ae=oe;break;case"top-right":Q=H+ge/2,Z=H,se=H-Ie/2,re=H,G=oe+ge/2,ee=oe-Ie/2,xe=oe,ae=oe;break;default:Hi()}pc(a,Q,G),pc(a,Z,ee),pc(a,se,xe),pc(a,re,ae);const me=s.elementCount;for(let Ae=0;Ae<4;++Ae)pc(d,10,10),A(E,D,T,F,N);B_(c,me,me+1,me+3),B_(c,me,me+3,me+2)}V+=w,$+=w;let K=0;for(let Q=0;Q<W;++Q){const G=x.get(M[Q]),Z=(K-V)*R,ee=(K+G.nw-V)*R,se=(G.nh-$)*R,xe=-$*R;pc(a,Z,se),pc(a,Z,xe),pc(a,ee,se),pc(a,ee,xe);const re=x.texture.width,ae=x.texture.height;pc(d,G.x/re,G.y/ae),pc(d,G.x/re,(G.y+G.h)/ae),pc(d,(G.x+G.w)/re,G.y/ae),pc(d,(G.x+G.w)/re,(G.y+G.h)/ae),K+=G.nw-2*w;const ge=s.elementCount;for(let Ie=0;Ie<4;++Ie)A(E,D,T,F,N);B_(c,ge+jp[0],ge+jp[1],ge+jp[2]),B_(c,ge+jp[3],ge+jp[4],ge+jp[5])}},getText:()=>{const M=x.texture,E=tt.compact(s,!0),D=tt.compact(a,!0),T=tt.compact(l,!0),F=tt.compact(c,!0),R=tt.compact(u,!0),N=tt.compact(d,!0);return Tf.create(M,E,D,T,F,R,N,c.elementCount/2,o)}}}}(Ig||(Ig={}));const pA={granularity:"element",condensed:!1,reverse:!1,countsOnly:!1,hidePrefix:!1,htmlStyling:!0};function L_(e,t={}){var n;switch(e.kind){case"structure-loci":return e.structure.models.map(d=>d.entry).filter(d=>!!d).join(", ");case"element-loci":return dP(Wh.ofLoci(e),t);case"bond-loci":const r=e.bonds[0];return r?NG(r,t):"";case"shape-loci":return e.shape.name;case"group-loci":const i=e.groups[0];return i?e.shape.getLabel(Ve.start(i.ids),i.instance):"";case"every-loci":return"Everything";case"empty-loci":return"Nothing";case"data-loci":return e.getLabel();case"volume-loci":return e.volume.label||"Volume";case"isosurface-loci":return[`${e.volume.label||"Volume"}`,`Isosurface at ${mt.IsoValue.toString(e.isoValue)}`].join(" | ");case"cell-loci":const o=Ve.size(e.indices),s=Ve.start(e.indices),a=mt.IsoValue.absolute(e.volume.grid.cells.data[s]),l=mt.IsoValue.toRelative(a,e.volume.grid.stats),c=[`${e.volume.label||"Volume"}`,1===o?`Cell #${s}`:`${o} Cells`];return 1===o&&c.push(`${mt.IsoValue.toString(a)} (${mt.IsoValue.toString(l)})`),c.join(" | ");case"segment-loci":const u=null===(n=mt.Segmentation.get(e.volume))||void 0===n?void 0:n.labels;if(u&&1===e.segments.length){const d=u[e.segments[0]];if(d)return d}return[`${e.volume.label||"Volume"}`,1===e.segments.length?`Segment ${e.segments[0]}`:`${e.segments.length} Segments`].join(" | ")}}function hA(e,t){return 1===e?`1 ${t}`:`${e} ${t}s`}function uP(e,t,n,r,i,o){return`${em(t,{granularity:n,hidePrefix:r,reverse:i,condensed:o})} <small>[+ ${hA(e-1,`other ${y1(n)}`)}]</small>`}function dP(e,t={}){const n={...pA,...t},r=function Bot(e,t=!1,n=!1,r=!1,i=!1){const{structureCount:o,chainCount:s,residueCount:a,conformationCount:l,elementCount:c}=e;if(!t&&1===c&&0===a&&0===s)return em(e.firstElementLoc,{hidePrefix:n,condensed:r,granularity:"element",reverse:i});if(!t&&0===c&&1===a&&0===s)return em(e.firstResidueLoc,{hidePrefix:n,condensed:r,granularity:"residue",reverse:i});if(t||0!==c||0!==a||1!==s){if(t){const u=[];return o>0&&u.push(hA(o,"Structure")),s>0&&u.push(hA(s,"Chain")),a>0&&u.push(hA(a,"Residue")),l>0&&u.push(hA(l,"Conformation")),c>0&&u.push(hA(c,"Element")),u.join("<small> + </small>")}{const u=[];return o>0&&u.push(1===o?em(e.firstStructureLoc,{hidePrefix:n,condensed:r,granularity:"structure",reverse:i}):uP(o,e.firstStructureLoc,"structure",n,i,r)),s>0&&(u.push(1===s?em(e.firstChainLoc,{condensed:r,granularity:"chain",hidePrefix:n,reverse:i}):uP(s,e.firstChainLoc,"chain",n,i,r)),n=!0),a>0&&(u.push(1===a?em(e.firstResidueLoc,{condensed:r,granularity:"residue",hidePrefix:n,reverse:i}):uP(a,e.firstResidueLoc,"residue",n,i,r)),n=!0),l>0&&(u.push(1===l?em(e.firstConformationLoc,{condensed:r,granularity:"conformation",hidePrefix:n,reverse:i}):uP(l,e.firstConformationLoc,"conformation",n,i,r)),n=!0),c>0&&u.push(1===c?em(e.firstElementLoc,{condensed:r,granularity:"element",hidePrefix:n,reverse:i}):uP(c,e.firstElementLoc,"element",n,i,r)),u.join("<small> + </small>")}}{const{unit:u}=e.firstChainLoc,d=ze.isAtomic(u)&&1===function Oot(e){const{elements:t,model:n}=e,{chainAtomSegments:r,residueAtomSegments:i}=n.atomicHierarchy;return i.index[r.offsets[r.index[t[t.length-1]]+1]-1]-i.index[r.offsets[r.index[t[0]]]]+1}(u)||ze.Traits.is(u.traits,ze.Trait.MultiChain)?"residue":"chain";return em(e.firstChainLoc,{hidePrefix:n,condensed:r,granularity:d,reverse:i})}}(e,n.countsOnly,n.hidePrefix,n.condensed,n.reverse);return n.htmlStyling?r:b1(r)}function fP(e,t={}){const n=Wh.create();for(const r of e)Wh.add(n,n,Wh.ofLoci(r));return dP(n,t)}function NG(e,t={}){return sF({loci:[Me(e.aStructure,[{unit:e.aUnit,indices:Ve.ofSingleton(e.aIndex)}]),Me(e.bStructure,[{unit:e.bUnit,indices:Ve.ofSingleton(e.bIndex)}])]},t)}function sF(e,t={}){const n={...pA,...t},r=function Lot(e,t){const{granularity:n,hidePrefix:r,reverse:i,condensed:o}=t;let s=!0;for(const a of e.loci)if(!Me.is(a)||1!==Me.size(a)){s=!1;break}if(s){const l=e.loci.map(u=>{const{unit:d,indices:f}=u.elements[0];return dt.create(u.structure,d,d.elements[Ve.start(f)])}).map(u=>wme(u,n,r,i||o));if(o)return l.map(u=>u[0].replace(/\[.*\]/g,"").trim()).filter(u=>!!u).join(" \u2014 ");let c=0;for(let u=0,d=Math.min(...l.map(f=>f.length))-1;u<d;++u){let f=!0;for(let p=1,m=l.length;p<m;++p)if(l[0][u]!==l[p][u]){f=!1;break}if(!f)break;c+=1}if(c>0){const u=[l[0].join(" | ")];for(let d=1,f=l.length;d<f;++d)u.push(l[d].slice(c).filter(p=>!!p).join(" | "));return u.join(" \u2014 ")}return l.map(u=>u.filter(d=>!!d).join(" | ")).filter(u=>!!u).join("</br>")}return e.loci.map(l=>L_(l,t)).filter(l=>!!l).join(o?" \u2014 ":"</br>")}(e,n);return n.htmlStyling?r:b1(r)}function em(e,t={}){var n,r;const i={...pA,...t},o=wme(e,i.granularity,i.hidePrefix,i.reverse||i.condensed),s=i.condensed?null!==(r=null===(n=o[0])||void 0===n?void 0:n.replace(/\[.*\]/g,"").trim())&&void 0!==r?r:"":o.filter(a=>!!a).join(" | ");return i.htmlStyling?s:b1(s)}function wme(e,t="element",n=!1,r=!1){const i=[];if(!n){let o=e.unit.model.entry;o.length>30&&(o=o.substr(0,27)+"\u2026"),i.push(`<small>${o}</small>`),"structure"!==t&&(i.push(`<small>Model ${e.unit.model.modelNum}</small>`),i.push(`<small>Instance ${e.unit.conformation.operator.name}</small>`))}return ze.isAtomic(e.unit)?i.push(...function jot(e,t,n=!1){const r=dt.residueIndex(e),i=Je.chain.label_asym_id(e),o=Je.chain.auth_asym_id(e),s=0===e.unit.model.atomicHierarchy.residues.label_seq_id.valueKind(r),a=Je.residue.label_seq_id(e),l=Je.residue.auth_seq_id(e),c=Je.residue.pdbx_PDB_ins_code(e),u=Je.atom.label_comp_id(e),d=Je.atom.label_atom_id(e),f=Je.atom.label_alt_id(e),p=Je.atom.occupancy(e),m=Je.residue.microheterogeneityCompIds(e),h="residue"===t&&m.length>1?`(${m.join("|")})`:u,g=[];switch(t){case"element":g.push(`<b>${d}</b>${f?`%${f}`:""}`);case"conformation":"conformation"===t&&f&&g.push(`<small>Conformation</small> <b>${f}</b>`);case"residue":const y=a!==l&&s?a:l;g.push(`<b>${h} ${y}</b>${y!==l?` <small>[auth</small> <b>${l}</b><small>]</small>`:""}<b>${c||""}</b>`);case"chain":i===o?g.push(`<b>${i}</b>`):"chain"===t&&ze.Traits.is(e.unit.traits,ze.Trait.MultiChain)?g.push(`<small>[auth</small> <b>${o}</b><small>]</small>`):g.push(`<b>${i}</b> <small>[auth</small> <b>${o}</b><small>]</small>`)}return g.length>0&&1!==p&&!n&&(g[0]=`${g[0]} <small>[occupancy</small> <b>${Math.round(100*p)/100}</b><small>]</small>`),g.reverse()}(e,t,r)):ze.isCoarse(e.unit)?i.push(...function Uot(e,t){const n=Je.coarse.asym_id(e),r=Je.coarse.seq_id_begin(e),i=Je.coarse.seq_id_end(e),o=[];switch(t){case"element":case"conformation":case"residue":if(r===i){const s=Je.coarse.entityKey(e),l=e.unit.model.sequence.byEntityKey[s].sequence.compId.value(r-1);o.push(`<b>${l} ${r}</b>`)}else o.push(`<b>${r}-${i}</b>`);case"chain":o.push(`<b>${n}</b>`)}return o.reverse()}(e,t)):i.push("Unknown"),r?i.reverse():i}function aF(e,t={}){const n={...pA,measureOnly:!1,unitLabel:"\u212b",...t},[r,i]=e.loci.map(a=>Yn.getCenter(a)),o=`${C.distance(r,i).toFixed(2)} ${n.unitLabel}`;if(n.measureOnly)return o;const s=sF(e,n);return n.condensed?`${o} | ${s}`:`Distance ${o}</br>${s}`}function lF(e,t={}){const n={...pA,measureOnly:!1,...t},[r,i,o]=e.loci.map(u=>Yn.getCenter(u)),s=C.sub(C(),r,i),a=C.sub(C(),o,i),l=`${pf(C.angle(s,a)).toFixed(2)}\xb0`;if(n.measureOnly)return l;const c=sF(e,n);return n.condensed?`${l} | ${c}`:`Angle ${l}</br>${c}`}function cF(e,t={}){const n={...pA,measureOnly:!1,...t},[r,i,o,s]=e.loci.map(c=>Yn.getCenter(c)),a=`${pf(C.dihedralAngle(r,i,o,s)).toFixed(2)}\xb0`;if(n.measureOnly)return a;const l=sF(e,n);return n.condensed?`${a} | ${l}`:`Dihedral ${a}</br>${l}`}const Ame={customText:I.Text("",{label:"Text",description:"Override the label with custom value.",isEssential:!0}),textColor:I.Color(qn.black,{isEssential:!0}),textSize:I.Numeric(.5,{min:.1,max:10,step:.1},{isEssential:!0})},uF={...Tf.Params,...Ame,borderWidth:I.Numeric(.2,{min:0,max:.5,step:.01})},Ime={unitLabel:I.Text("\u212b",{isEssential:!0})},zot={...Mo.Params,...Ime,lineSizeAttenuation:I.Boolean(!0),linesColor:I.Color(qn.lightgreen,{isEssential:!0}),linesSize:I.Numeric(.075,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.2,{min:.01,max:.2,step:.01})},Vot={...uF,...Ime},Eme={lines:(e,t)=>Xa(qot,Mo.Utils,{modifyState:n=>({...n,markerActions:uc.Highlighting})}),text:(e,t)=>Xa($ot,Tf.Utils,{modifyState:n=>({...n,markerActions:un.None})})},Tme={...zot,...Vot,visuals:I.MultiSelect(["lines","text"],I.objectToOptions(Eme))};function Dme(e,t){const{sphereA:n,sphereB:r,center:i}=t,[o,s]=e.loci;return Yn.getBoundingSphere(o,n),Yn.getBoundingSphere(s,r),C.add(i,n.center,r.center),C.scale(i,i,.5),t.distance=C.distance(n.center,r.center),t}const pP=function Hot(){return{sphereA:ke(),sphereB:ke(),center:C(),distance:0}}();function Pme(e,t){return 1===e.pairs.length?`Distance ${aF(e.pairs[0],{unitLabel:t,measureOnly:!0})}`:`${e.pairs.length} Distances`}function qot(e,t,n,r){const i=function Got(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.pairs.length;i<o;++i)Dme(e.pairs[i],pP),r.addFixedLengthDashes(pP.sphereA.center,pP.sphereB.center,t.dashLength,i);return r.getLines()}(t,n,r&&r.geometry),o=Pme(t,n.unitLabel);return zr.create(o,t,i,()=>n.linesColor,()=>n.linesSize,a=>aF(t.pairs[a],n))}function $ot(e,t,n,r){const i=function Wot(e,t,n){const r=Ig.create(t,128,64,n);for(let i=0,o=e.pairs.length;i<o;++i){Dme(e.pairs[i],pP);const{center:s,distance:a,sphereA:l,sphereB:c}=pP,u=t.customText||`${a.toFixed(2)} ${t.unitLabel}`,f=Math.max(2,l.radius,c.radius)/2;r.add(u,s[0],s[1],s[2],1,f,i)}return r.getText()}(t,n,r&&r.geometry),o=Pme(t,n.unitLabel);return zr.create(o,t,i,()=>n.textColor,()=>n.textSize,a=>aF(t.pairs[a],n))}function kme(e){return{pairs:[{loci:[e[0].loci,e[1].loci]}]}}function Mme(e){return{triples:[{loci:[e[0].loci,e[1].loci,e[2].loci]}]}}function Rme(e){return{quads:[{loci:[e[0].loci,e[1].loci,e[2].loci,e[3].loci]}]}}function Nme(e){return{infos:[{loci:e[0].loci}]}}function Fme(e){return{locis:e.map(t=>t.loci)}}function Ome(e){return{locis:e.map(t=>t.loci)}}const Xot={...uF},Bme={text:(e,t)=>Xa(Jot,Tf.Utils)},Lme={...Xot,scaleByRadius:I.Boolean(!0),visuals:I.MultiSelect(["text"],I.objectToOptions(Bme)),snapshotKey:I.Text("",{isEssential:!0,disableInteractiveUpdates:!0,description:"Activate the snapshot with the provided key when clicking on the label"}),tooltip:I.Text("",{isEssential:!0,multiline:!0,disableInteractiveUpdates:!0,placeholder:"Tooltip",description:"Tooltip text to be displayed when hovering over the label"})},Kot=ke();function FG(e,t=!1){return e.label||L_(e.loci,{hidePrefix:!0,htmlStyling:!1,condensed:t})}function Jot(e,t,n,r){var i,o;const s=function Qot(e,t,n){const r=Ig.create(t,128,64,n),i=t.customText.trim();for(let o=0,s=e.infos.length;o<s;++o){const a=e.infos[o],l=Yn.getBoundingSphere(a.loci,Kot);if(!l)continue;const{center:c,radius:u}=l,d=i||FG(a,!0);r.add(d,c[0],c[1],c[2],t.scaleByRadius?u/.9:0,t.scaleByRadius?Math.max(1,u):1,o)}return r.getText()}(t,n,r&&r.geometry),a=function Zot(e){return 1===e.infos.length?FG(e.infos[0]):`${e.infos.length} Labels`}(t),l=null!==(o=null===(i=n.tooltip)||void 0===i?void 0:i.trim())&&void 0!==o?o:"",c=n.customText.trim();let u;return u=l?d=>l:c?d=>c:d=>FG(t.infos[d]),zr.create(a,t,s,()=>n.textColor,()=>n.textSize,u)}const j_=C(),tst=fe.identity(),U_=new Float32Array(18),nst=new Uint8Array([0,1,2,3,4,5]);C.zero(),C.zero();const $1=C(),ist=C(),ost=C(),sst=C(),ast=fe.identity(),jme=new Float32Array(24),lst=new Uint8Array([0,1,0,3,0,6,1,2,1,7,2,3,2,4,3,5,4,5,4,7,5,6,6,7]),ust=fe.identity(),Ume=C();function OG(e,t,n,r,i,o){Ct.addPrimitive(e,function dst(e,t,n,r,i){return C.add(Ume,t,n),fe.targetTo(e,t,Ume,r),fe.setTranslation(e,t),fe.scale(e,e,i)}(ust,t,n,r,i),Gde(o))}const BG={color:I.Color(qn.orange),scaleFactor:I.Numeric(1,{min:.1,max:10,step:.1}),radiusScale:I.Numeric(2,{min:.1,max:10,step:.1})},fst={...on.Params,...BG},pst={...on.Params,...BG},hst={...on.Params,...BG},zme={axes:(e,t)=>Xa(yst,on.Utils),box:(e,t)=>Xa(xst,on.Utils),ellipsoid:(e,t)=>Xa(Cst,on.Utils)},Vme={...fst,...pst,...hst,visuals:I.MultiSelect(["box"],I.objectToOptions(zme))};function yst(e,t,n,r){const i=function gst(e,t,n){const r=Ct.createState(256,128,n),i=Me.getPrincipalAxesMany(e.locis);return rc.scale(i.momentsAxes,i.momentsAxes,t.scaleFactor),r.currentGroup=0,function rst(e,t,n,r,i){const{origin:o,dirA:s,dirB:a,dirC:l}=t;C.add(j_,o,s),C.toArray(C.add(j_,o,s),U_,0),C.toArray(C.sub(j_,o,s),U_,3),C.toArray(C.add(j_,o,a),U_,6),C.toArray(C.sub(j_,o,a),U_,9),C.toArray(C.add(j_,o,l),U_,12),C.toArray(C.sub(j_,o,l),U_,15);const c=MD(U_,nst),u=rc.volume(t),d=Math.cbrt(u)/300*n;Ct.addCage(e,tst,c,d,r,i)}(r,i.momentsAxes,t.radiusScale,2,20),Ct.getMesh(r)}(t,n,r&&r.geometry),o=function mst(e){return`Principal Axes of ${fP(e,{countsOnly:!0})}`}(t.locis);return zr.create(o,t,i,()=>n.color,()=>1,()=>o)}function xst(e,t,n,r){const i=function vst(e,t,n){const r=Ct.createState(256,128,n),i=Me.getPrincipalAxesMany(e.locis);return rc.scale(i.boxAxes,i.boxAxes,t.scaleFactor),r.currentGroup=0,function cst(e,t,n,r,i){const{origin:o,dirA:s,dirB:a,dirC:l}=t,c=C.negate(ist,s),u=C.negate(ost,a),d=C.negate(sst,l);let f=0;const p=function(y,v,x){C.copy($1,o),C.add($1,$1,y),C.add($1,$1,v),C.add($1,$1,x),C.toArray($1,jme,f),f+=3};p(s,a,l),p(s,a,d),p(s,u,d),p(s,u,l),p(c,u,d),p(c,u,l),p(c,a,l),p(c,a,d);const m=MD(jme,lst),h=rc.volume(t),g=Math.cbrt(h)/300*n;Ct.addCage(e,ast,m,g,r,i)}(r,i.boxAxes,t.radiusScale,2,20),Ct.getMesh(r)}(t,n,r&&r.geometry),o=function bst(e){return`Oriented Box of ${fP(e,{countsOnly:!0})}`}(t.locis);return zr.create(o,t,i,()=>n.color,()=>1,()=>o)}function Cst(e,t,n,r){const i=function Sst(e,t,n){const r=Ct.createState(256,128,n),o=Me.getPrincipalAxesMany(e.locis).boxAxes,{origin:s,dirA:a,dirB:l}=o,c=rc.size(C(),o);C.scale(c,c,.5*t.scaleFactor);const u=C.create(c[2],c[1],c[0]);return r.currentGroup=0,OG(r,s,a,l,u,2),Ct.getMesh(r)}(t,n,r&&r.geometry),o=function _st(e){return`Oriented Ellipsoid of ${fP(e,{countsOnly:!0})}`}(t.locis);return zr.create(o,t,i,()=>n.color,()=>1,()=>o)}const Ast={radius:1,segments:36,thetaStart:0,thetaLength:2*Math.PI};function Hme(e){const{radius:t,segments:n,thetaStart:r,thetaLength:i}={...Ast,...e},o=i===2*Math.PI,s=o?n+1:n+2,a=new Float32Array(3*s),l=new Float32Array(3*s),c=new Uint32Array(3*n);a[0]=0,a[1]=0,a[2]=0,l[0]=0,l[1]=1,l[2]=0;for(let u=0,d=3;u<n;++u,d+=3){const f=r+u/n*i;a[d]=t*Math.sin(f),a[d+1]=0,a[d+2]=t*Math.cos(f),l[d]=0,l[d+1]=1,l[d+2]=0}for(let u=1,d=0;u<n;++u,d+=3)c[d]=u,c[d+1]=u+1,c[d+2]=0;if(o){const u=3*(n-1);c[u]=n,c[u+1]=1,c[u+2]=0}else{const u=r+i,d=3*(n+1);a[d]=t*Math.sin(u),a[d+1]=0,a[d+2]=t*Math.cos(u),l[d]=0,l[d+1]=1,l[d+2]=0;const f=3*(n-1);c[f]=n,c[f+1]=n+1,c[f+2]=0}return{vertices:a,normals:l,indices:c}}const Gme={color:I.Color(qn.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},qme={...Mo.Params,...Gme,lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})},Ist={...qme},Est={...qme},Tst={...on.Params,...Gme,ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})},Wme={vectors:(e,t)=>Xa(kst,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),arc:(e,t)=>Xa(Rst,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),sector:(e,t)=>Xa(Fst,on.Utils,{modifyProps:n=>({...n,alpha:n.sectorOpacity}),modifyState:n=>({...n,markerActions:uc.Highlighting})}),text:(e,t)=>Xa(Bst,Tf.Utils,{modifyState:n=>({...n,markerActions:un.None})})},$me={...Ist,...Est,...Tst,...uF,visuals:I.MultiSelect(["vectors","sector","text"],I.objectToOptions(Wme))},Y1=C(),hP=fe();function dF(e,t,n){const{sphereA:r,sphereB:i,sphereC:o}=t,{arcDirA:s,arcDirC:a,arcNormal:l}=t,[c,u,d]=e.loci;Yn.getBoundingSphere(c,r),Yn.getBoundingSphere(u,i),Yn.getBoundingSphere(d,o),C.sub(s,r.center,i.center),C.sub(a,o.center,i.center),C.cross(l,s,a);const p=Math.min(C.magnitude(s),C.magnitude(a))*n;return t.radius=p,t.angle=C.angle(s,a),t}function Yme(e,t){const{radius:n,angle:r}=e,i=t?ooe(r,n)/t:32;return fe.targetTo(hP,e.sphereB.center,e.sphereA.center,e.arcNormal),fe.setTranslation(hP,e.sphereB.center),fe.mul(hP,hP,fe.rotY180),P9(Hme({radius:n,thetaLength:r,segments:i}),hP)}const hc=function Dst(){return{sphereA:ke(),sphereB:ke(),sphereC:ke(),arcDirA:C(),arcDirC:C(),arcNormal:C(),radius:0,angle:0}}();function fF(e){return 1===e.triples.length?`Angle ${lF(e.triples[0],{measureOnly:!0})}`:`${e.triples.length} Angles`}function kst(e,t,n,r){const i=function Pst(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.triples.length;i<o;++i)dF(e.triples[i],hc,t.arcScale),r.addFixedLengthDashes(hc.sphereB.center,hc.sphereA.center,t.dashLength,i),r.addFixedLengthDashes(hc.sphereB.center,hc.sphereC.center,t.dashLength,i);return r.getLines()}(t,n,r&&r.geometry),o=fF(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Rst(e,t,n,r){const i=function Mst(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.triples.length;i<o;++i){dF(e.triples[i],hc,t.arcScale);const s=Yme(hc,t.dashLength),{indices:a,vertices:l}=s;for(let c=0,u=a.length;c<u;c+=3){if(c%2==1)continue;const d=3*a[c],f=3*a[c+1];r.add(l[d],l[d+1],l[d+2],l[f],l[f+1],l[f+2],i)}}return r.getLines()}(t,n,r&&r.geometry),o=fF(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Fst(e,t,n,r){const i=function Nst(e,t,n){const r=Ct.createState(128,64,n);for(let i=0,o=e.triples.length;i<o;++i){dF(e.triples[i],hc,t.arcScale);const s=Yme(hc);r.currentGroup=i,Ct.addPrimitive(r,fe.id,s),Ct.addPrimitiveFlipped(r,fe.id,s)}return Ct.getMesh(r)}(t,n,r&&r.geometry),o=fF(t);return zr.create(o,t,i,()=>n.color,()=>1,a=>lF(t.triples[a]))}function Bst(e,t,n,r){const i=function Ost(e,t,n){const r=Ig.create(t,128,64,n);for(let i=0,o=e.triples.length;i<o;++i){dF(e.triples[i],hc,t.arcScale),C.add(Y1,hc.arcDirA,hc.arcDirC),C.setMagnitude(Y1,Y1,hc.radius),C.add(Y1,hc.sphereB.center,Y1);const s=pf(hc.angle).toFixed(2),a=t.customText||`${s}\xb0`,c=Math.max(2,hc.sphereA.radius,hc.sphereB.radius,hc.sphereC.radius)/2;r.add(a,Y1[0],Y1[1],Y1[2],.1,c,i)}return r.getText()}(t,n,r&&r.geometry),o=fF(t);return zr.create(o,t,i,()=>n.textColor,()=>n.textSize,a=>lF(t.triples[a]))}const Xme={color:I.Color(qn.lightgreen),arcScale:I.Numeric(.7,{min:.01,max:1,step:.01})},pF={...Mo.Params,...Xme,lineSizeAttenuation:I.Boolean(!0),linesSize:I.Numeric(.04,{min:.01,max:5,step:.01}),dashLength:I.Numeric(.04,{min:.01,max:.2,step:.01})},jst={...pF},Ust={...pF},zst={...pF},Vst={...pF},Hst={...on.Params,...Xme,ignoreLight:I.Boolean(!0),sectorOpacity:I.Numeric(.75,{min:0,max:1,step:.01})},Kme={vectors:(e,t)=>Xa(Wst,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),extenders:(e,t)=>Xa(Qst,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),connector:(e,t)=>Xa(Yst,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),arms:(e,t)=>Xa(Kst,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),arc:(e,t)=>Xa(eat,Mo.Utils,{modifyState:n=>({...n,pickable:!1})}),sector:(e,t)=>Xa(nat,on.Utils,{modifyProps:n=>({...n,alpha:n.sectorOpacity}),modifyState:n=>({...n,markerActions:uc.Highlighting})}),text:(e,t)=>Xa(iat,Tf.Utils,{modifyState:n=>({...n,markerActions:un.None})})},Zme={...jst,...Ust,...zst,...Vst,...Hst,...uF,visuals:I.MultiSelect(["extenders","arms","sector","text"],I.objectToOptions(Kme))},du=C(),mP=fe();function z_(e,t,n){const{sphereA:r,sphereB:i,sphereC:o,sphereD:s,dirBA:a,dirCD:l,projA:c,projD:u}=t,{arcPointA:d,arcPointD:f,arcDirA:p,arcDirD:m,arcCenter:h,arcNormal:g}=t,[y,v,x,_]=e.loci;Yn.getBoundingSphere(y,r),Yn.getBoundingSphere(v,i),Yn.getBoundingSphere(x,o),Yn.getBoundingSphere(_,s),C.add(h,i.center,o.center),C.scale(h,h,.5),C.sub(a,r.center,i.center),C.sub(l,s.center,o.center),C.add(d,h,a),C.add(f,h,l),C.sub(g,o.center,i.center),C.orthogonalize(p,g,a),C.orthogonalize(m,g,l),C.projectPointOnVector(c,d,p,h),C.projectPointOnVector(u,f,m,h);const A=Math.min(C.distance(c,h),C.distance(u,h))*n;C.setMagnitude(p,p,A),C.setMagnitude(m,m,A),C.add(d,h,p),C.add(f,h,m),t.radius=A,t.angle=C.dihedralAngle(r.center,i.center,o.center,s.center),C.matchDirection(du,g,C.sub(du,d,r.center));const M=C.angle(a,du),E=A/Math.cos(M-u3);C.add(c,i.center,C.setMagnitude(du,a,E)),C.matchDirection(du,g,C.sub(du,f,s.center));const D=C.angle(l,du),T=A/Math.cos(D-u3);return C.add(u,o.center,C.setMagnitude(du,l,T)),t}function Qme(e,t){const{radius:n,angle:r}=e,i=t?ooe(r,n)/t:32;return fe.targetTo(mP,e.arcCenter,r<0?e.arcPointD:e.arcPointA,e.arcNormal),fe.setTranslation(mP,e.arcCenter),fe.mul(mP,mP,fe.rotY180),P9(Hme({radius:n,thetaLength:Math.abs(r),segments:i}),mP)}const uo=function Gst(){return{sphereA:ke(),sphereB:ke(),sphereC:ke(),sphereD:ke(),dirBA:C(),dirCD:C(),projA:C(),projD:C(),arcPointA:C(),arcPointD:C(),arcDirA:C(),arcDirD:C(),arcCenter:C(),arcNormal:C(),radius:0,angle:0}}();function V_(e){return 1===e.quads.length?`Dihedral ${cF(e.quads[0],{measureOnly:!0})}`:`${e.quads.length} Dihedrals`}function Wst(e,t,n,r){const i=function qst(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.quads.length;i<o;++i)z_(e.quads[i],uo,t.arcScale),r.addFixedLengthDashes(uo.arcCenter,uo.arcPointA,t.dashLength,i),r.addFixedLengthDashes(uo.arcCenter,uo.arcPointD,t.dashLength,i);return r.getLines()}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Yst(e,t,n,r){const i=function $st(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.quads.length;i<o;++i)z_(e.quads[i],uo,t.arcScale),r.addFixedLengthDashes(uo.sphereB.center,uo.sphereC.center,t.dashLength,i);return r.getLines()}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Kst(e,t,n,r){const i=function Xst(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.quads.length;i<o;++i)z_(e.quads[i],uo,t.arcScale),r.addFixedLengthDashes(uo.sphereB.center,uo.sphereA.center,t.dashLength,i),r.addFixedLengthDashes(uo.sphereC.center,uo.sphereD.center,t.dashLength,i);return r.getLines()}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function Qst(e,t,n,r){const i=function Zst(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.quads.length;i<o;++i)z_(e.quads[i],uo,t.arcScale),r.addFixedLengthDashes(uo.arcPointA,uo.projA,t.dashLength,i),r.addFixedLengthDashes(uo.arcPointD,uo.projD,t.dashLength,i);return r.getLines()}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function eat(e,t,n,r){const i=function Jst(e,t,n){const r=Pd.create(128,64,n);for(let i=0,o=e.quads.length;i<o;++i){z_(e.quads[i],uo,t.arcScale);const s=Qme(uo,t.dashLength),{indices:a,vertices:l}=s;for(let c=0,u=a.length;c<u;c+=3){if(c%2==1)continue;const d=3*a[c],f=3*a[c+1];r.add(l[d],l[d+1],l[d+2],l[f],l[f+1],l[f+2],i)}}return r.getLines()}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.color,()=>n.linesSize,()=>"")}function nat(e,t,n,r){const i=function tat(e,t,n){const r=Ct.createState(128,64,n);for(let i=0,o=e.quads.length;i<o;++i){z_(e.quads[i],uo,t.arcScale);const s=Qme(uo);r.currentGroup=i,Ct.addPrimitive(r,fe.id,s),Ct.addPrimitiveFlipped(r,fe.id,s)}return Ct.getMesh(r)}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.color,()=>1,a=>cF(t.quads[a]))}function iat(e,t,n,r){const i=function rat(e,t,n){const r=Ig.create(t,128,64,n);for(let i=0,o=e.quads.length;i<o;++i){z_(e.quads[i],uo,t.arcScale),C.add(du,uo.arcDirA,uo.arcDirD),C.setMagnitude(du,du,uo.radius),C.add(du,uo.arcCenter,du);let s=pf(uo.angle).toFixed(2);"-0.00"===s&&(s="0.00");const a=t.customText||`${s}\xb0`,c=Math.max(2,uo.sphereA.radius,uo.sphereB.radius,uo.sphereC.radius,uo.sphereD.radius)/2;r.add(a,du[0],du[1],du[2],.1,c,i)}return r.getText()}(t,n,r&&r.geometry),o=V_(t);return zr.create(o,t,i,()=>n.textColor,()=>n.textSize,a=>cF(t.quads[a]))}const sat=nn.BuiltIn({name:"box-shape-3d",display:"Box Shape",from:Se.Root,to:Se.Shape.Provider,params:{bottomLeft:I.Vec3(C()),topRight:I.Vec3(C.create(1,1,1)),radius:I.Numeric(.15,{min:.01,max:4,step:.01}),color:I.Color(qn.red)}})({canAutoUpdate:()=>!0,apply:({params:e})=>Ke.create("Shape Representation",function(){var t=le(function*(n){return new Se.Shape.Provider({label:"Box",data:e,params:on.Params,getShape:(r,i)=>{const o=LG(Gt.create(e.bottomLeft,e.topRight),e.radius);return zr.create("Box",i,o,()=>i.color,()=>1,()=>"Box")},geometryUtils:on.Utils},{label:"Box"})});return function(n){return t.apply(this,arguments)}}())});function LG(e,t,n){const r=C.sub(C(),e.max,e.min),i=fe.fromTranslation(fe(),C.create(.5,.5,.5)),o=fe.fromScaling(fe(),r),s=fe.fromTranslation(fe(),e.min),a=fe.mul3(fe(),s,o,i),l=Ct.createState(256,128,n);l.currentGroup=1,Ct.addCage(l,a,cfe(),t,2,20);const c=Ct.getMesh(l),u=C.scaleAndAdd(C(),e.min,r,.5),d=C.distance(e.min,u);return c.setBoundingSphere(ke.create(u,d)),c}const Jme={vertices:new Float32Array([-.5,.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),normals:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1]),indices:new Uint32Array([0,2,1,1,2,3])};new Uint32Array([0,1,2,3,3,1,2,0]);const cat={...on.Params,color:I.Color(qn.orange),scaleFactor:I.Numeric(1,{min:.1,max:10,step:.1})},ege={plane:(e,t)=>Xa(fat,on.Utils)},tge={...cat,visuals:I.MultiSelect(["plane"],I.objectToOptions(ege))},X1=fe(),jG=C();function fat(e,t,n,r){const i=function dat(e,t,n){const r=Ct.createState(256,128,n),o=Me.getPrincipalAxesMany(e.locis).boxAxes,s=function lat(){return Jme}();return C.add(jG,o.origin,o.dirC),fe.targetTo(X1,jG,o.origin,o.dirB),fe.scale(X1,X1,rc.size(jG,o)),fe.scaleUniformly(X1,X1,t.scaleFactor),fe.setTranslation(X1,o.origin),r.currentGroup=0,Ct.addPrimitive(r,X1,s),Ct.addPrimitiveFlipped(r,X1,s),Ct.getMesh(r)}(t,n,r&&r.geometry),o=function uat(e){return`Best Fit Plane of ${fP(e,{countsOnly:!0})}`}(t.locis);return zr.create(o,t,i,()=>n.color,()=>1,()=>o)}const hF=nn.BuiltIn({name:"structure-representation-3d",display:"3D Representation",from:Se.Molecule.Structure,to:Se.Molecule.Structure.Representation3D,params:(e,t)=>{const{registry:n,themes:r}=t.representation.structure,i=n.get(n.default.name);if(!e){const a={help:l=>{const{name:c,params:u}=l,f=r.colorThemeRegistry.get(c).factory({},u);return{description:f.description,legend:f.legend}}};return{type:I.Mapped(n.default.name,n.types,l=>I.Group(n.get(l).getParams(r,Xe.Empty))),colorTheme:I.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.types,l=>I.Group(r.colorThemeRegistry.get(l).getParams({structure:Xe.Empty})),a),sizeTheme:I.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.types,l=>I.Group(r.sizeThemeRegistry.get(l).getParams({structure:Xe.Empty})))}}const o={structure:e.data},s={help:a=>{const{name:l,params:c}=a,d=r.colorThemeRegistry.get(l).factory(o,c);return{description:d.description,legend:d.legend}}};return{type:I.Mapped(n.default.name,n.getApplicableTypes(e.data),a=>I.Group(n.get(a).getParams(r,e.data))),colorTheme:I.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.getApplicableTypes(o),a=>I.Group(r.colorThemeRegistry.get(a).getParams(o)),s),sizeTheme:I.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.getApplicableTypes(o),a=>I.Group(r.sizeThemeRegistry.get(a).getParams(o)))}}})({canAutoUpdate:({a:e,oldParams:t,newParams:n})=>e.data.elementCount<1e4||t.type.name===n.type.name&&"custom"!==n.type.params.quality,apply:({a:e,params:t},r)=>Ke.create("Structure Representation",function(){var i=le(function*(o){var s,a;const l={runtime:o,assetManager:r.managers.asset},c=r.representation.structure.registry.get(t.type.name),u=(null===(s=c.getData)||void 0===s?void 0:s.call(c,e.data,t.type.params))||e.data;c.ensureCustomProperties&&(yield c.ensureCustomProperties.attach(l,u));const d=c.factory({webgl:null===(a=r.canvas3d)||void 0===a?void 0:a.webgl,...r.representation.structure.themes},c.getParams);yield Ia.ensureDependencies(l,r.representation.structure.themes,{structure:u},t),d.setTheme(Ia.create(r.representation.structure.themes,{structure:u},t));const f=t.type.params||{};return yield d.createOrUpdate(f,u).runInContext(o),new Se.Molecule.Structure.Representation3D({repr:d,sourceData:e.data},{label:c.label})});return function(o){return i.apply(this,arguments)}}()),update:({a:e,b:t,oldParams:n,newParams:r},o)=>Ke.create("Structure Representation",function(){var s=le(function*(a){var l,c;if(r.type.name!==n.type.name)return yt.UpdateResult.Recreate;const u=o.representation.structure.registry.get(r.type.name);if(null!==(l=u.mustRecreate)&&void 0!==l&&l.call(u,n.type.params,r.type.params))return yt.UpdateResult.Recreate;const d=(null===(c=u.getData)||void 0===c?void 0:c.call(u,e.data,r.type.params))||e.data,f={runtime:a,assetManager:o.managers.asset};u.ensureCustomProperties&&(yield u.ensureCustomProperties.attach(f,d)),Ia.releaseDependencies(o.representation.structure.themes,{structure:t.data.sourceData},n),yield Ia.ensureDependencies(f,o.representation.structure.themes,{structure:d},r),t.data.repr.setTheme(Ia.create(o.representation.structure.themes,{structure:d},r));const p={...t.data.repr.props,...r.type.params};return yield t.data.repr.createOrUpdate(p,d).runInContext(a),t.data.sourceData=e.data,yt.UpdateResult.Updated});return function(a){return s.apply(this,arguments)}}()),dispose({b:e,params:t},n){if(!e||!t)return;const r=e.data.sourceData,i=n.representation.structure.registry.get(t.type.name);i.ensureCustomProperties&&i.ensureCustomProperties.detach(r),Ia.releaseDependencies(n.representation.structure.themes,{structure:r},t)},interpolate(e,t,n){if("uniform"!==e.colorTheme.name||"uniform"!==t.colorTheme.name)return n<=.5?e:t;const o=st.interpolate(e.colorTheme.params.value,t.colorTheme.params.value,n);return{type:n<=.5?e.type:t.type,colorTheme:{name:"uniform",params:{value:o}},sizeTheme:n<=.5?e.sizeTheme:t.sizeTheme}}}),hat=nn.BuiltIn({name:"unwind-structure-assembly-representation-3d",display:"Unwind Assembly 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=new dA(n);return pme(n,r,t.t),new Se.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new dA(n)},info:n,repr:e.data.repr},{label:`Unwind T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=t.data.info;return e.data.sourceData!==i||e.data.repr!==t.data.repr?yt.UpdateResult.Recreate:r.t===n.t?yt.UpdateResult.Unchanged:(pme(i,t.data.state.unitTransforms,n.t),t.label=`Unwind T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,yt.UpdateResult.Updated)}}),mat=nn.BuiltIn({name:"explode-structure-representation-3d",display:"Explode 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01})}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=new dA(n);return mme(n,r,t.t,n.root.boundary.sphere),new Se.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new dA(n)},info:n,repr:e.data.repr},{label:`Explode T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=e.data.sourceData;return t.data.info!==i||e.data.repr!==t.data.repr?yt.UpdateResult.Recreate:r.t===n.t?yt.UpdateResult.Unchanged:(mme(i,t.data.state.unitTransforms,n.t,i.root.boundary.sphere),t.label=`Explode T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,yt.UpdateResult.Updated)}}),gat=nn.BuiltIn({name:"spin-structure-representation-3d",display:"Spin 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:{t:I.Numeric(0,{min:0,max:1,step:.01}),...Iot}})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=new dA(n),{axis:i,origin:o}=gme(n.root,t);return vme(n,r,t.t,i,o),new Se.Molecule.Structure.Representation3DState({state:{unitTransforms:r},initialState:{unitTransforms:new dA(n)},info:n,repr:e.data.repr},{label:`Spin T = ${t.t.toFixed(2)}`})},update({a:e,b:t,newParams:n,oldParams:r}){const i=e.data.sourceData;if(t.data.info!==i||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;if(r.t===n.t&&r.axis===n.axis&&r.origin===n.origin)return yt.UpdateResult.Unchanged;const o=t.data.state.unitTransforms,{axis:s,origin:a}=gme(i.root,n);return vme(i,o,n.t,s,a),t.label=`Spin T = ${n.t.toFixed(2)}`,t.data.repr=e.data.repr,yt.UpdateResult.Updated}}),yat=nn.BuiltIn({name:"overpaint-structure-representation-3d-from-script",display:"Overpaint 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({script:I.Script(pa("(sel.atom.all)","mol-script")),color:I.Color(qn.blueviolet),clear:I.Boolean(!1)},e=>`${e.clear?"Clear":st.toRgbString(e.color)}`,{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),color:qn.blueviolet,clear:!1}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=Ea.ofScript(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Ea.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Overpaint (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info,o=e.data.sourceData;if(o!==i.structure||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const s=e.data.repr.geometryVersion;if(s!==i.geometryVersion&&hy(e.data.repr.props))return yt.UpdateResult.Recreate;const a=t.data.state.overpaint,l=Ea.ofScript(n.layers,o);return Ea.areEqual(a,l)?yt.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,yt.UpdateResult.Updated)}}),bat=nn.BuiltIn({name:"overpaint-structure-representation-3d-from-bundle",display:"Overpaint 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({bundle:I.Value(Qr.Empty),color:I.Color(qn.blueviolet),clear:I.Boolean(!1)},e=>`${e.clear?"Clear":st.toRgbString(e.color)}`,{defaultValue:[{bundle:Qr.Empty,color:qn.blueviolet,clear:!1}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=Ea.ofBundle(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{overpaint:i},initialState:{overpaint:Ea.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Overpaint (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info,o=e.data.sourceData;if(o!==i.structure||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const s=e.data.repr.geometryVersion;if(s!==i.geometryVersion&&hy(e.data.repr.props))return yt.UpdateResult.Recreate;const a=t.data.state.overpaint,l=Ea.ofBundle(n.layers,o);return Ea.areEqual(a,l)?yt.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.overpaint=l,t.data.repr=e.data.repr,t.label=`Overpaint (${l.layers.length} Layers)`,yt.UpdateResult.Updated)}}),vat=nn.BuiltIn({name:"transparency-structure-representation-3d-from-script",display:"Transparency 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({script:I.Script(pa("(sel.atom.all)","mol-script")),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),value:.5}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=dc.ofScript(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:dc.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Transparency (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info,o=e.data.sourceData;if(o!==i.structure||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const s=e.data.repr.geometryVersion;if(s!==i.geometryVersion&&hy(e.data.repr.props))return yt.UpdateResult.Recreate;const a=t.data.state.transparency,l=dc.ofScript(n.layers,o);return dc.areEqual(a,l)?yt.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,yt.UpdateResult.Updated)}}),xat=nn.BuiltIn({name:"transparency-structure-representation-3d-from-bundle",display:"Transparency 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({bundle:I.Value(Qr.Empty),value:I.Numeric(.5,{min:0,max:1,step:.01},{label:"Transparency"})},e=>`Transparency (${e.value})`,{defaultValue:[{bundle:Qr.Empty,value:.5}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=dc.ofBundle(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{transparency:i},initialState:{transparency:dc.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Transparency (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info,o=e.data.sourceData;if(o!==i.structure||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const s=e.data.repr.geometryVersion;if(s!==i.geometryVersion&&hy(e.data.repr.props))return yt.UpdateResult.Recreate;const a=t.data.state.transparency,l=dc.ofBundle(n.layers,o);return dc.areEqual(a,l)?yt.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.transparency=l,t.data.repr=e.data.repr,t.label=`Transparency (${l.layers.length} Layers)`,yt.UpdateResult.Updated)}}),_at=nn.BuiltIn({name:"substance-structure-representation-3d-from-script",display:"Substance 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({script:I.Script(pa("(sel.atom.all)","mol-script")),material:tu.getParam(),clear:I.Boolean(!1)},e=>`${e.clear?"Clear":tu.toString(e.material)}`,{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),material:tu({roughness:1}),clear:!1}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=fc.ofScript(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:fc.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Substance (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info,o=e.data.sourceData;if(o!==i.structure||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const s=e.data.repr.geometryVersion;if(s!==i.geometryVersion&&hy(e.data.repr.props))return yt.UpdateResult.Recreate;const a=t.data.state.substance,l=fc.ofScript(n.layers,o);return fc.areEqual(a,l)?yt.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,yt.UpdateResult.Updated)}}),Sat=nn.BuiltIn({name:"substance-structure-representation-3d-from-bundle",display:"Substance 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({bundle:I.Value(Qr.Empty),material:tu.getParam(),clear:I.Boolean(!1)},e=>`${e.clear?"Clear":tu.toString(e.material)}`,{defaultValue:[{bundle:Qr.Empty,material:tu({roughness:1}),clear:!1}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=e.data.repr.geometryVersion,i=fc.ofBundle(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{substance:i},initialState:{substance:fc.Empty},info:{structure:n,geometryVersion:r},repr:e.data.repr},{label:`Substance (${i.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info,o=e.data.sourceData;if(o!==i.structure||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const s=e.data.repr.geometryVersion;if(s!==i.geometryVersion&&hy(e.data.repr.props))return yt.UpdateResult.Recreate;const a=t.data.state.substance,l=fc.ofBundle(n.layers,o);return fc.areEqual(a,l)?yt.UpdateResult.Unchanged:(i.geometryVersion=s,t.data.state.substance=l,t.data.repr=e.data.repr,t.label=`Substance (${l.layers.length} Layers)`,yt.UpdateResult.Updated)}}),Cat=nn.BuiltIn({name:"clipping-structure-representation-3d-from-script",display:"Clipping 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({script:I.Script(pa("(sel.atom.all)","mol-script")),groups:I.Converted(e=>co.Groups.toNames(e),e=>co.Groups.fromNames(e),I.MultiSelect(DR(co.Groups.Names),I.objectToOptions(co.Groups.Names)))},e=>`${co.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{script:pa("(sel.atom.all)","mol-script"),groups:co.Groups.Flag.None}]})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=co.ofScript(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{clipping:r},initialState:{clipping:co.Empty},info:n,repr:e.data.repr},{label:`Clipping (${r.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info;if(e.data.sourceData!==i||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const o=t.data.state.clipping,s=co.ofScript(n.layers,i);return co.areEqual(o,s)?yt.UpdateResult.Unchanged:(t.data.state.clipping=s,t.data.repr=e.data.repr,t.label=`Clipping (${s.layers.length} Layers)`,yt.UpdateResult.Updated)}}),wat=nn.BuiltIn({name:"clipping-structure-representation-3d-from-bundle",display:"Clipping 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({layers:I.ObjectList({bundle:I.Value(Qr.Empty),groups:I.Converted(e=>co.Groups.toNames(e),e=>co.Groups.fromNames(e),I.MultiSelect(DR(co.Groups.Names),I.objectToOptions(co.Groups.Names)))},e=>`${co.Groups.toNames(e.groups).length} group(s)`,{defaultValue:[{bundle:Qr.Empty,groups:co.Groups.Flag.None}],isHidden:!0})})})({canAutoUpdate:()=>!0,apply({a:e,params:t}){const n=e.data.sourceData,r=co.ofBundle(t.layers,n);return new Se.Molecule.Structure.Representation3DState({state:{clipping:r},initialState:{clipping:co.Empty},info:n,repr:e.data.repr},{label:`Clipping (${r.layers.length} Layers)`})},update({a:e,b:t,newParams:n}){const i=t.data.info;if(e.data.sourceData!==i||e.data.repr!==t.data.repr)return yt.UpdateResult.Recreate;const o=t.data.state.clipping,s=co.ofBundle(n.layers,i);return co.areEqual(o,s)?yt.UpdateResult.Unchanged:(t.data.state.clipping=s,t.data.repr=e.data.repr,t.label=`Clipping (${s.layers.length} Layers)`,yt.UpdateResult.Updated)}}),Aat=nn.BuiltIn({name:"theme-strength-representation-3d",display:"Theme Strength 3D Representation",from:Se.Molecule.Structure.Representation3D,to:Se.Molecule.Structure.Representation3DState,params:()=>({overpaintStrength:I.Numeric(1,{min:0,max:1,step:.01}),transparencyStrength:I.Numeric(1,{min:0,max:1,step:.01}),substanceStrength:I.Numeric(1,{min:0,max:1,step:.01})})})({canAutoUpdate:()=>!0,apply:({a:e,params:t})=>new Se.Molecule.Structure.Representation3DState({state:{themeStrength:{overpaint:t.overpaintStrength,transparency:t.transparencyStrength,substance:t.substanceStrength}},initialState:{themeStrength:{overpaint:1,transparency:1,substance:1}},info:{},repr:e.data.repr},{label:"Theme Strength",description:`${t.overpaintStrength.toFixed(2)}, ${t.transparencyStrength.toFixed(2)}, ${t.substanceStrength.toFixed(2)}`}),update({a:e,b:t,newParams:n}){var i,o,s;return n.overpaintStrength===(null===(i=t.data.state.themeStrength)||void 0===i?void 0:i.overpaint)&&n.transparencyStrength===(null===(o=t.data.state.themeStrength)||void 0===o?void 0:o.transparency)&&n.substanceStrength===(null===(s=t.data.state.themeStrength)||void 0===s?void 0:s.substance)?yt.UpdateResult.Unchanged:(t.data.state.themeStrength={overpaint:n.overpaintStrength,transparency:n.transparencyStrength,substance:n.substanceStrength},t.data.repr=e.data.repr,t.label="Theme Strength",t.description=`${n.overpaintStrength.toFixed(2)}, ${n.transparencyStrength.toFixed(2)}, ${n.substanceStrength.toFixed(2)}`,yt.UpdateResult.Updated)},interpolate:(e,t,n)=>({overpaintStrength:Po(e.overpaintStrength,t.overpaintStrength,n),transparencyStrength:Po(e.transparencyStrength,t.transparencyStrength,n),substanceStrength:Po(e.substanceStrength,t.substanceStrength,n)})});var Eg;!function(e){e.getDefaultParams=function t(i,o,s,a,l,c,u,d){const f=i.representation.volume.registry.get(o),p=i.representation.volume.themes.colorThemeRegistry.get(l||f.defaultColorTheme.name),m=i.representation.volume.themes.sizeThemeRegistry.get(u||f.defaultSizeTheme.name),h=I.getDefaultValues(f.getParams(i.representation.volume.themes,s));return{type:{name:o,params:a?{...h,...a}:h},colorTheme:{name:p.name,params:c?{...p.defaultValues,...c}:p.defaultValues},sizeTheme:{name:m.name,params:d?{...m.defaultValues,...d}:m.defaultValues}}},e.getDefaultParamsStatic=function n(i,o,s,a,l,c,u){const d=i.representation.volume.registry.get(o),f=i.representation.volume.themes.colorThemeRegistry.get(a||d.defaultColorTheme.name),p=i.representation.volume.themes.sizeThemeRegistry.get(c||d.defaultSizeTheme.name);return{type:{name:o,params:s?{...d.defaultValues,...s}:d.defaultValues},colorTheme:{name:d.defaultColorTheme.name,params:l?{...f.defaultValues,...l}:f.defaultValues},sizeTheme:{name:d.defaultSizeTheme.name,params:u?{...p.defaultValues,...u}:p.defaultValues}}},e.getDescription=function r(i){var o,s,a,l;return i.isoValue?mt.IsoValue.toString(i.isoValue):null!==(s=null===(o=i.renderMode)||void 0===o?void 0:o.params)&&void 0!==s&&s.isoValue?mt.IsoValue.toString(null===(l=null===(a=i.renderMode)||void 0===a?void 0:a.params)||void 0===l?void 0:l.isoValue):void 0}}(Eg||(Eg={}));const Iat=nn.BuiltIn({name:"volume-representation-3d",display:"3D Representation",from:Se.Volume.Data,to:Se.Volume.Representation3D,params:(e,t)=>{const{registry:n,themes:r}=t.representation.volume,i=n.get(n.default.name);if(!e)return{type:I.Mapped(n.default.name,n.types,s=>I.Group(n.get(s).getParams(r,mt.One))),colorTheme:I.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.types,s=>I.Group(r.colorThemeRegistry.get(s).getParams({volume:mt.One}))),sizeTheme:I.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.types,s=>I.Group(r.sizeThemeRegistry.get(s).getParams({volume:mt.One})))};const o={volume:e.data};return{type:I.Mapped(n.default.name,n.types,s=>I.Group(n.get(s).getParams(r,e.data))),colorTheme:I.Mapped(i.defaultColorTheme.name,r.colorThemeRegistry.getApplicableTypes(o),s=>I.Group(r.colorThemeRegistry.get(s).getParams(o))),sizeTheme:I.Mapped(i.defaultSizeTheme.name,r.sizeThemeRegistry.getApplicableTypes(o),s=>I.Group(r.sizeThemeRegistry.get(s).getParams(o)))}}})({canAutoUpdate:({oldParams:e,newParams:t})=>e.type.name===t.type.name,apply:({a:e,params:t},n)=>Ke.create("Volume Representation",function(){var r=le(function*(i){var o;const s={runtime:i,assetManager:n.managers.asset},a=n.representation.volume.registry.get(t.type.name);a.ensureCustomProperties&&(yield a.ensureCustomProperties.attach(s,e.data));const l=a.factory({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.volume.themes},a.getParams);l.setTheme(Ia.create(n.representation.volume.themes,{volume:e.data},t));const c=t.type.params||{};return yield l.createOrUpdate(c,e.data).runInContext(i),new Se.Volume.Representation3D({repr:l,sourceData:e.data},{label:a.label,description:Eg.getDescription(c)})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,oldParams:n,newParams:r},i)=>Ke.create("Volume Representation",function(){var o=le(function*(s){var a;if(r.type.name!==n.type.name)return null===(a=i.representation.volume.registry.get(n.type.name).ensureCustomProperties)||void 0===a||a.detach(e.data),yt.UpdateResult.Recreate;const l={...t.data.repr.props,...r.type.params};return t.data.repr.setTheme(Ia.create(i.representation.volume.themes,{volume:e.data},r)),yield t.data.repr.createOrUpdate(l,e.data).runInContext(s),t.data.sourceData=e.data,t.description=Eg.getDescription(l),yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Eat=nn.BuiltIn({name:"shape-representation-3d",display:"3D Representation",from:Se.Shape.Provider,to:Se.Shape.Representation3D,params:(e,t)=>e?e.data.params:xt.Params})({canAutoUpdate:()=>!0,apply:({a:e,params:t},n)=>Ke.create("Shape Representation",function(){var r=le(function*(i){const o={...I.getDefaultValues(e.data.params),...t},s=Xa(e.data.getShape,e.data.geometryUtils);return yield s.createOrUpdate(o,e.data.data).runInContext(i),new Se.Shape.Representation3D({repr:s,sourceData:e.data},{label:e.data.label})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Shape Representation",function(){var o=le(function*(s){const a={...t.data.repr.props,...r};return yield t.data.repr.createOrUpdate(a,e.data.data).runInContext(s),t.data.sourceData=e.data,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Tat=nn.BuiltIn({name:"model-unitcell-3d",display:"Model Unit Cell",from:Se.Molecule.Model,to:Se.Shape.Representation3D,params:()=>({..._me})})({isApplicable:e=>!!Vs.Provider.get(e.data),canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Model Unit Cell",function(){var r=le(function*(i){var o;const s=Vs.Provider.get(e.data);if(!s)return vo.Null;const a=Sme(e.data,s,t),l=function Fot(e,t){return Xn.createMulti("Unit Cell",e,t,Xn.StateBuilder,Mot)}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>_me);return yield l.createOrUpdate(t,a).runInContext(i),new Se.Shape.Representation3D({repr:l,sourceData:a},{label:"Unit Cell",description:s.spacegroup.name})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:n})=>Ke.create("Model Unit Cell",function(){var r=le(function*(i){const o=Vs.Provider.get(e.data);if(!o)return yt.UpdateResult.Null;const s={...t.data.repr.props,...n},a=Sme(e.data,o,s);return yield t.data.repr.createOrUpdate(s,a).runInContext(i),t.data.sourceData=a,yt.UpdateResult.Updated});return function(i){return r.apply(this,arguments)}}())}),Dat=nn.BuiltIn({name:"structure-bounding-box-3d",display:"Bounding Box",from:Se.Molecule.Structure,to:Se.Shape.Representation3D,params:{radius:I.Numeric(.05,{min:.01,max:4,step:.01},{isEssential:!0}),color:I.Color(qn.red,{isEssential:!0}),...on.Params}})({canAutoUpdate:()=>!0,apply:({a:e,params:t},n)=>Ke.create("Bounding Box",function(){var r=le(function*(i){const o=Xa((s,a,l,c)=>{const u=LG(a.box,a.radius,c?.geometry);return zr.create("Bouding Box",a,u,()=>a.color,()=>1,()=>"Bounding Box")},on.Utils);return yield o.createOrUpdate(t,{box:e.data.boundary.box,radius:t.radius,color:t.color}).runInContext(i),new Se.Shape.Representation3D({repr:o,sourceData:e.data},{label:"Bounding Box"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Bounding Box",function(){var o=le(function*(s){return yield t.data.repr.createOrUpdate(r,{box:e.data.boundary.box,radius:r.radius,color:r.color}).runInContext(s),t.data.sourceData=e.data,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Pat=nn.BuiltIn({name:"structure-selections-distance-3d",display:"3D Distance",from:Se.Molecule.Structure.Selections,to:Se.Shape.Representation3D,params:()=>({...Tme})})({canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Structure Distance",function(){var r=le(function*(i){var o;const s=kme(e.data),a=function Yot(e,t){return Xn.createMulti("Distance",e,t,Xn.StateBuilder,Eme)}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>Tme);return yield a.createOrUpdate(t,s).runInContext(i),new Se.Shape.Representation3D({repr:a,sourceData:s},{label:"Distance"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Structure Distance",function(){var o=le(function*(s){const a={...t.data.repr.props,...r},l=kme(e.data);return yield t.data.repr.createOrUpdate(a,l).runInContext(s),t.data.sourceData=l,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),kat=nn.BuiltIn({name:"structure-selections-angle-3d",display:"3D Angle",from:Se.Molecule.Structure.Selections,to:Se.Shape.Representation3D,params:()=>({...$me})})({canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Structure Angle",function(){var r=le(function*(i){var o;const s=Mme(e.data),a=function Lst(e,t){return Xn.createMulti("Angle",e,t,Xn.StateBuilder,Wme)}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>$me);return yield a.createOrUpdate(t,s).runInContext(i),new Se.Shape.Representation3D({repr:a,sourceData:s},{label:"Angle"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Structure Angle",function(){var o=le(function*(s){const a={...t.data.repr.props,...r},l=Mme(e.data);return yield t.data.repr.createOrUpdate(a,l).runInContext(s),t.data.sourceData=l,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Mat=nn.BuiltIn({name:"structure-selections-dihedral-3d",display:"3D Dihedral",from:Se.Molecule.Structure.Selections,to:Se.Shape.Representation3D,params:()=>({...Zme})})({canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Structure Dihedral",function(){var r=le(function*(i){var o;const s=Rme(e.data),a=function oat(e,t){return Xn.createMulti("Dihedral",e,t,Xn.StateBuilder,Kme)}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>Zme);return yield a.createOrUpdate(t,s).runInContext(i),new Se.Shape.Representation3D({repr:a,sourceData:s},{label:"Dihedral"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Structure Dihedral",function(){var o=le(function*(s){const a={...t.data.repr.props,...r},l=Rme(e.data);return yield t.data.repr.createOrUpdate(a,l).runInContext(s),t.data.sourceData=l,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Rat=nn.BuiltIn({name:"structure-selections-label-3d",display:"3D Label",from:Se.Molecule.Structure.Selections,to:Se.Shape.Representation3D,params:()=>({...Lme})})({canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Structure Label",function(){var r=le(function*(i){var o,s,a;const l=Nme(e.data),c=function est(e,t){return Xn.createMulti("Label",e,t,Xn.StateBuilder,Bme)}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>Lme);yield c.createOrUpdate(t,l).runInContext(i);const u=!!(null!==(s=t.snapshotKey)&&void 0!==s&&s.trim()||null!==(a=t.tooltip)&&void 0!==a&&a.trim());return c.setState({pickable:u,markerActions:u?uc.Highlighting:un.None}),new Se.Shape.Representation3D({repr:c,sourceData:l},{label:"Label"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Structure Label",function(){var o=le(function*(s){var a,l;const c={...t.data.repr.props,...r},u=Nme(e.data);yield t.data.repr.createOrUpdate(c,u).runInContext(s),t.data.sourceData=u;const d=!!(null!==(a=r.snapshotKey)&&void 0!==a&&a.trim()||null!==(l=r.tooltip)&&void 0!==l&&l.trim());return t.data.repr.setState({pickable:d,markerActions:d?uc.Highlighting:un.None}),yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Nat=nn.BuiltIn({name:"structure-selections-orientation-3d",display:"3D Orientation",from:Se.Molecule.Structure.Selections,to:Se.Shape.Representation3D,params:()=>({...Vme})})({canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Structure Orientation",function(){var r=le(function*(i){var o;const s=Fme(e.data),a=function wst(e,t){const n=Xn.createMulti("Orientation",e,t,Xn.StateBuilder,zme);return n.setState({markerActions:uc.Highlighting}),n}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>Vme);return yield a.createOrUpdate(t,s).runInContext(i),new Se.Shape.Representation3D({repr:a,sourceData:s},{label:"Orientation"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Structure Orientation",function(){var o=le(function*(s){const a={...t.data.repr.props,...r},l=Fme(e.data);return yield t.data.repr.createOrUpdate(a,l).runInContext(s),t.data.sourceData=l,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),Fat=nn.BuiltIn({name:"structure-selections-plane-3d",display:"3D Plane",from:Se.Molecule.Structure.Selections,to:Se.Shape.Representation3D,params:()=>({...tge})})({canAutoUpdate:({})=>!0,apply:({a:e,params:t},n)=>Ke.create("Structure Plane",function(){var r=le(function*(i){var o;const s=Ome(e.data),a=function pat(e,t){const n=Xn.createMulti("Plane",e,t,Xn.StateBuilder,ege);return n.setState({markerActions:uc.Highlighting}),n}({webgl:null===(o=n.canvas3d)||void 0===o?void 0:o.webgl,...n.representation.structure.themes},()=>tge);return yield a.createOrUpdate(t,s).runInContext(i),new Se.Shape.Representation3D({repr:a,sourceData:s},{label:"Plane"})});return function(i){return r.apply(this,arguments)}}()),update:({a:e,b:t,newParams:r},i)=>Ke.create("Structure Plane",function(){var o=le(function*(s){const a={...t.data.repr.props,...r},l=Ome(e.data);return yield t.data.repr.createOrUpdate(a,l).runInContext(s),t.data.sourceData=l,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())}),at={Data:Ci,Misc:rr,Model:or,Volume:kr,Representation:Rs,Shape:lr};function gP(e){let t;return e=e.replace(/^#/,""),[t,e]=[e.slice(6,8),e.slice(0,6)],[st.fromHexStyle("#"+e),1-+("0x"+(t||"ff"))/255]}const Bat=yt.builderFactory("interactions")({name:"interactions",from:Se.Root,to:Se.Shape.Provider,params:{data:I.Value(void 0,{isHidden:!1})}})({apply:({params:e})=>new Se.Shape.Provider({label:"",data:e.data,params:on.Params,geometryUtils:on.Utils,getShape:(t,n)=>function Oat(e){const t=Ct.createState(512,512);for(let n=0;n<e.length;n++){const r=e[n];t.currentGroup=n;const i=C.distance(r.from,r.to),o=Math.floor(i/.33);Yw(t,r.from,r.to,1,o,!0,{radialSegments:8,radiusTop:r.size,radiusBottom:r.size,topCap:!0,bottomCap:!0})}return zr.create("",e,Ct.getMesh(t),n=>e[n].color,()=>1,n=>e[n].label)}(n)},{label:""})}),UG=new Map([["ALA","A"],["ARG","R"],["ASN","N"],["ASP","D"],["CYS","C"],["GLN","Q"],["GLU","E"],["GLY","G"],["HIS","H"],["ILE","I"],["LEU","L"],["LYS","K"],["MET","M"],["PHE","F"],["PRO","P"],["SER","S"],["THR","T"],["TRP","W"],["TYR","Y"],["VAL","V"]]);new Map(Array.from(UG.entries()).map(([e,t])=>[t,e]));class zG extends(Se.Create({name:"Volume Streaming",typeClass:"Object"})){}var nge;function mF(e,t){return`${e}${"/"===e[e.length-1]||"/"===t[0]?"":"/"}${t}`}!function(e){let t;var n;(n=t=e.ValueType||(e.ValueType={})).Float32="float32",n.Int8="int8"}(nge||(nge={}));const Lat={get preferWebGl1(){if(typeof navigator>"u"||typeof window>"u")return!1;if(["Version/15.1 Safari","Version/15.2 Safari","Version/15.3 Safari"].some(i=>navigator.userAgent.indexOf(i)>0))return!0;const t=/iPad|iPhone|iPod/.test(navigator.userAgent),n=navigator.userAgent.includes("Macintosh"),r=navigator.maxTouchPoints>=4;return!window.MSStream&&(t||n&&r)}};class jat{toString(){return this.key}valueOf(){return this.key}constructor(t,n){this.key=t,this.defaultValue=n}}function Ro(e,t){return new jat(e,t)}const ei={item:Ro,General:{IsBusyTimeoutMs:Ro("plugin-config.is-busy-timeout",750),DisableAntialiasing:Ro("plugin-config.disable-antialiasing",!1),DisablePreserveDrawingBuffer:Ro("plugin-config.disable-preserve-drawing-buffer",!1),PixelScale:Ro("plugin-config.pixel-scale",1),PickScale:Ro("plugin-config.pick-scale",.25),Transparency:Ro("plugin-config.transparency","wboit"),PreferWebGl1:Ro("plugin-config.prefer-webgl1",Lat.preferWebGl1),AllowMajorPerformanceCaveat:Ro("plugin-config.allow-major-performance-caveat",!1),PowerPreference:Ro("plugin-config.power-preference","high-performance")},State:{DefaultServer:Ro("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),CurrentServer:Ro("plugin-state.server","https://webchem.ncbr.muni.cz/molstar-state"),HistoryCapacity:Ro("history-capacity.server",5)},VolumeStreaming:{Enabled:Ro("volume-streaming.enabled",!0),DefaultServer:Ro("volume-streaming.server","https://ds.litemol.org"),CanStream:Ro("volume-streaming.can-stream",(e,t)=>1===e.models.length&&Sn.probablyHasDensityMap(e.models[0])),EmdbHeaderServer:Ro("volume-streaming.emdb-header-server","https://files.wwpdb.org/pub/emdb/structures")},Viewport:{ShowExpand:Ro("viewer.show-expand-button",!0),ShowControls:Ro("viewer.show-controls-button",!0),ShowSettings:Ro("viewer.show-settings-button",!0),ShowSelectionMode:Ro("viewer.show-selection-model-button",!0),ShowAnimation:Ro("viewer.show-animation-button",!0),ShowTrajectoryControls:Ro("viewer.show-trajectory-controls",!0)},Download:{DefaultPdbProvider:Ro("download.default-pdb-provider","pdbe"),DefaultEmdbProvider:Ro("download.default-emdb-provider","pdbe")},Structure:{SizeThresholds:Ro("structure.size-thresholds",Xe.DefaultSizeThresholds),DefaultRepresentationPreset:Ro("structure.default-representation-preset","auto"),DefaultRepresentationPresetParams:Ro("structure.default-representation-preset-params",{}),SaccharideCompIdMapType:Ro("structure.saccharide-comp-id-map-type","default")},Background:{Styles:Ro("background.styles",[])}};class Uat{get(t){return this._config.has(t)?this._config.get(t):t.defaultValue}set(t,n){this._config.set(t,n)}delete(t){this._config.delete(t)}constructor(t){this._config=new Map,t&&t.forEach(([n,r])=>this._config.set(n,r))}}function rge(e,t,n,r){return VG.apply(this,arguments)}function VG(){return VG=le(function*(e,t,n,r){switch(e){case"emdb":return ige(t,n,r);case"pdbe":return function qat(e,t,n){return GG.apply(this,arguments)}(t,n,r)}}),VG.apply(this,arguments)}function ige(e,t,n){return HG.apply(this,arguments)}function HG(){return HG=le(function*(e,t,n){const r=e.config.get(ei.VolumeStreaming.EmdbHeaderServer),s=(yield e.fetch({url:`${r}/${n.toUpperCase()}/header/${n.toLowerCase()}.xml`,type:"xml"}).runInContext(t)).getElementsByTagName("map")[0].getElementsByTagName("contour");let a=s[0];for(let c=1;c<s.length;c++)if("true"===s[c].getAttribute("primary")){a=s[c];break}return parseFloat(a.getElementsByTagName("level")[0].textContent)}),HG.apply(this,arguments)}function GG(){return GG=le(function*(e,t,n){var r,i,o,s;n=n.toUpperCase();const a=yield e.fetch({url:`https://www.ebi.ac.uk/emdb/api/entry/map/${n}`,type:"json"}).runInContext(t),l=null===(i=null===(r=a?.map)||void 0===r?void 0:r.contour_list)||void 0===i?void 0:i.contour;return l&&0!==l.length?null!==(s=null===(o=l.find(c=>c.primary))||void 0===o?void 0:o.level)&&void 0!==s?s:l[0].level:function Wat(e,t,n){return qG.apply(this,arguments)}(e,t,n)}),GG.apply(this,arguments)}function qG(){return qG=le(function*(e,t,n){var r,i,o;n=n.toUpperCase();const s=yield e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/emdb/entry/map/${n}`,type:"json"}).runInContext(t),a=s?.[n];let l;return void 0!==(null===(o=null===(i=null===(r=a?.[0])||void 0===r?void 0:r.map)||void 0===i?void 0:i.contour_level)||void 0===o?void 0:o.value)&&(l=+a[0].map.contour_level.value),l}),qG.apply(this,arguments)}function $at(e,t,n){return WG.apply(this,arguments)}function WG(){return WG=le(function*(e,t,n){var r;const i=yield e.fetch({url:`https://www.ebi.ac.uk/pdbe/api/pdb/entry/summary/${n}`,type:"json"}).runInContext(t),o=i?.[n],s=[];if(null===(r=o?.[0])||void 0===r||!r.related_structures)throw new Error(`No related EMDB entry found for '${n}'.`);{const a=o[0].related_structures.filter(l=>"EMDB"===l.resource&&"associated EM volume"===l.relationship);if(!a.length)throw new Error(`No related EMDB entry found for '${n}'.`);s.push(...a.map(l=>l.accession))}return s}),WG.apply(this,arguments)}var ii,yP;function So(){const e=(t,n)=>t.commands.dispatch(e,n||{});return e.subscribe=(t,n)=>t.commands.subscribe(e,n),e.id=oo.create22(),e}!function(e){class t extends(Se.Create({name:"Root",typeClass:"Root"})){}e.Root=t;class n extends(Se.Create({name:"Category",typeClass:"Object"})){}e.Category=n;class r extends(Se.CreateBehavior({name:"Behavior"})){}e.Behavior=r,e.Categories={common:"Common",representation:"Representation",interaction:"Interaction","custom-props":"Custom Properties",misc:"Miscellaneous"},e.CreateCategory=nn.BuiltIn({name:"create-behavior-category",display:{name:"Behavior Category"},from:t,to:n,params:{label:I.Text("",{isHidden:!0})}})({apply:({params:u})=>new n({},{label:u.label})});const i=new Map;e.getCategoryId=function o(u){return i.get(u.id)},e.create=function s(u){const d=nn.CreateBuiltIn({name:u.name,display:u.display,from:[t],to:[r],params:u.params,apply({params:f},p){const m=u.label?u.label(f):{label:u.display.name,description:u.display.description};return new r(new u.ctor(p,f),m)},update:({b:f,newParams:p})=>Ke.create("Update Behavior",le(function*(){return f.data.update&&(yield f.data.update(p))?yt.UpdateResult.Updated:yt.UpdateResult.Unchanged})),canAutoUpdate:u.canAutoUpdate});return i.set(d.id,u.category),d},e.simpleCommandHandler=function a(u,d){return class{register(){this.sub=u.subscribe(this.ctx,f=>d(f,this.ctx))}dispose(){this.sub&&this.sub.unsubscribe(),this.sub=void 0}constructor(f){this.ctx=f,this.sub=void 0}}},e.Handler=class l{subscribeCommand(d,f){this.subs.push(d.subscribe(this.ctx,f))}subscribeObservable(d,f){this.subs.push(d.subscribe(f))}track(d){this.subs.push(d)}dispose(){for(const d of this.subs)d.unsubscribe();this.subs=[]}update(d){return!lw(d,this.params)&&(this.params=d,!0)}constructor(d,f){this.ctx=d,this.params=f,this.subs=[]}},e.WithSubscribers=class c{subscribeCommand(d,f){this.subs.push(d.subscribe(this.plugin,f))}subscribeObservable(d,f){const p=d.subscribe(f);return this.subs.push(p),{unsubscribe:()=>{const m=this.subs.indexOf(p);m>=0&&(this.subs.splice(m,1),p.unsubscribe())}}}dispose(){for(const d of this.subs)d.unsubscribe();this.subs=[]}constructor(d,f){this.plugin=d,this.params=f,this.subs=[]}}}(ii||(ii={})),function(e){e.create=function n(s){return{entries:KU(),capacity:Math.max(1,s)}},e.get=function r(s,a){for(let l=s.entries.first;l;l=l.next)if(l.value.key===a)return s.entries.remove(l),s.entries.addLast(l.value),l.value.data},e.set=function i(s,a,l){let c;if(s.entries.count>=s.capacity){const u=s.entries.first;c=u.value.data,s.entries.remove(u)}return s.entries.addLast(function t(s,a){return{key:s,data:a}}(a,l)),c},e.remove=function o(s,a){for(let l=s.entries.first;l;l=l.next)if(l.value.key===a){s.entries.remove(l);break}}}(yP||(yP={}));class Yat{constructor(){this.subs=new Map,this.disposing=!1}subscribe(t,n){let r=this.subs.get(t.id);return r||(r=[],this.subs.set(t.id,r)),r.push(n),{unsubscribe:()=>{const i=this.subs.get(t.id);if(!i)return;const o=i.indexOf(n);if(!(o<0)){for(let s=o+1;s<i.length;s++)i[s-1]=i[s];i.pop()}}}}dispatch(t,n){return new Promise((r,i)=>{this.disposing?i("disposed"):this.subs.get(t.id)?this.resolve({cmd:t,params:n,resolve:r,reject:i}):r()})}dispose(){this.subs.clear()}resolve(t){var n=this;return le(function*(){const r=n.subs.get(t.cmd.id);if(r)try{for(const i of r)yield i(t.params);t.resolve()}catch(i){t.reject(i)}else t.resolve()})()}}const jt={State:{SetCurrentObject:So(),ApplyAction:So(),Update:So(),RemoveObject:So(),ToggleExpanded:So(),ToggleVisibility:So(),Snapshots:{Add:So(),Replace:So(),Move:So(),Remove:So(),Apply:So(),Clear:So(),Upload:So(),Fetch:So(),DownloadToFile:So(),OpenFile:So(),OpenUrl:So()}},Interactivity:{Object:{Highlight:So()},Structure:{Highlight:So(),Select:So()},ClearHighlights:So()},Layout:{Update:So()},Toast:{Show:So(),Hide:So()},Camera:{Reset:So(),SetSnapshot:So(),Focus:So(),OrientAxes:So(),ResetAxes:So()},Canvas3D:{SetSettings:So(),ResetSettings:So()}};class Xat extends Il{constructor(t,n){super()}schedule(t,n=0){return this}}const gF={setInterval(e,t,...n){const{delegate:r}=gF;return r?.setInterval?r.setInterval(e,t,...n):setInterval(e,t,...n)},clearInterval(e){const{delegate:t}=gF;return(t?.clearInterval||clearInterval)(e)},delegate:void 0};class bP{constructor(t,n=bP.now){this.schedulerActionCtor=t,this.now=n}schedule(t,n=0,r){return new this.schedulerActionCtor(this,t).schedule(r,n)}}bP.now=gU.now;const yF=new class Zat extends bP{constructor(t,n=bP.now){super(t,n),this.actions=[],this._active=!1}flush(t){const{actions:n}=this;if(this._active)return void n.push(t);let r;this._active=!0;do{if(r=t.execute(t.state,t.delay))break}while(t=n.shift());if(this._active=!1,r){for(;t=n.shift();)t.unsubscribe();throw r}}}(class Kat extends Xat{constructor(t,n){super(t,n),this.scheduler=t,this.work=n,this.pending=!1}schedule(t,n=0){var r;if(this.closed)return this;this.state=t;const i=this.id,o=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(o,i,n)),this.pending=!0,this.delay=n,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(o,this.id,n),this}requestAsyncId(t,n,r=0){return gF.setInterval(t.flush.bind(t,this),r)}recycleAsyncId(t,n,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return n;null!=n&&gF.clearInterval(n)}execute(t,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(t,n);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,n){let i,r=!1;try{this.work(t)}catch(o){r=!0,i=o||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:t,scheduler:n}=this,{actions:r}=n;this.work=this.state=this.scheduler=null,this.pending=!1,mb(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,super.unsubscribe()}}}),Qat=yF;function oge(e=0,t,n=Qat){let r=-1;return null!=t&&(qre(t)?n=t:r=t),new Ra(i=>{let o=function elt(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;o<0&&(o=0);let s=0;return n.schedule(function(){i.closed||(i.next(s++),0<=r?this.schedule(void 0,r):i.complete())},o)})}function mA(e,t=yF,n){const r=oge(e,t);return function Jat(e,t){return is((n,r)=>{const{leading:i=!0,trailing:o=!1}=t??{};let s=!1,a=null,l=null,c=!1;const u=()=>{l?.unsubscribe(),l=null,o&&(p(),c&&r.complete())},d=()=>{l=null,c&&r.complete()},f=m=>l=vd(e(m)).subscribe(Xo(r,u,d)),p=()=>{if(s){s=!1;const m=a;a=null,r.next(m),!c&&f(m)}};n.subscribe(Xo(r,m=>{s=!0,a=m,(!l||l.closed)&&(i?p():f(m))},()=>{c=!0,(!(o&&s&&l)||l.closed)&&r.complete()}))})}(()=>r,n)}function sge(e,t=ah){return e=e??tlt,is((n,r)=>{let i,o=!0;n.subscribe(Xo(r,s=>{const a=t(s);(o||!e(i,a))&&(o=!1,i=a,r.next(s))}))})}function tlt(e,t){return e===t}class nlt{constructor(t=!1){this.isRunning=!1,this.queue=[],this.counter=0,this.log=t}enqueue(t){this.log&&console.log("SingleAsyncQueue enqueue",this.counter),this.queue[0]={id:this.counter,func:t},this.counter++,this.run()}run(){var t=this;return le(function*(){if(t.isRunning)return;const n=t.queue.pop();if(n){t.isRunning=!0;try{t.log&&console.log("SingleAsyncQueue run",n.id),yield n.func(),t.log&&console.log("SingleAsyncQueue complete",n.id)}finally{t.isRunning=!1,t.run()}}})()}}class fu extends(Se.CreateBehavior({name:"Volume Streaming"})){}function K1(e,t,n){return{i:e,j:t,k:n}}function Up(e,t){return{a:e,b:t}}!function(e){function t(l,c,u,d,f={}){var p,m,h,g;return I.Group({isoValue:mt.createIsoValueParam(null!==(p=f.isoValue)&&void 0!==p?p:u,d),color:I.Color(null!==(m=f.color)&&void 0!==m?m:c),wireframe:I.Boolean(null!==(h=f.wireframe)&&void 0!==h&&h),opacity:I.Numeric(null!==(g=f.opacity)&&void 0!==g?g:.3,{min:0,max:1,step:.01})},{label:l,isExpanded:!0})}e.RootTag="volume-streaming-info";const n={byteOffset:0,rate:1,sampleCount:[1,1,1],valuesInfo:[{mean:0,min:-1,max:1,sigma:.1},{mean:0,min:-1,max:1,sigma:.1}]};function i(l){const{entryData:c,defaultView:u,structure:d,channelParams:f={}}=l,p=c||{kind:"em",header:{sampling:[n],availablePrecisions:[{precision:0,maxVoxels:0}]},emDefaultContourLevel:mt.IsoValue.relative(0)},m=d&&d.boundary.box||Gt();return{view:I.MappedStatic(u||("em"===p.kind?"auto":"selection-box"),{off:I.Group({}),box:I.Group({bottomLeft:I.Vec3(m.min),topRight:I.Vec3(m.max)},{description:"Static box defined by cartesian coords.",isFlat:!0}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),bottomLeft:I.Vec3(C.create(0,0,0),{},{isHidden:!0}),topRight:I.Vec3(C.create(0,0,0),{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0}),"camera-target":I.Group({radius:I.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),dynamicDetailLevel:o(p.header.availablePrecisions,0,{label:"Dynamic Detail"}),bottomLeft:I.Vec3(C.create(0,0,0),{},{isHidden:!0}),topRight:I.Vec3(C.create(0,0,0),{},{isHidden:!0})},{description:"Box around camera target.",isFlat:!0}),cell:I.Group({}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),selectionDetailLevel:o(p.header.availablePrecisions,6,{label:"Selection Detail"}),isSelection:I.Boolean(!1,{isHidden:!0}),bottomLeft:I.Vec3(m.min,{},{isHidden:!0}),topRight:I.Vec3(m.max,{},{isHidden:!0})},{description:"Box around focused element.",isFlat:!0})},{options:e.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Interaction" shows the volume around the focused element/atom. "Whole Structure" shows the volume for the whole structure.'}),detailLevel:o(p.header.availablePrecisions,3),channels:I.Group("em"===p.kind?{em:t("EM",st(6524815),p.emDefaultContourLevel||mt.IsoValue.relative(1),p.header.sampling[0].valuesInfo[0],f.em)}:{"2fo-fc":t("2Fo-Fc",st(3367602),mt.IsoValue.relative(1.5),p.header.sampling[0].valuesInfo[0],f["2fo-fc"]),"fo-fc(+ve)":t("Fo-Fc(+ve)",st(3390259),mt.IsoValue.relative(3),p.header.sampling[0].valuesInfo[1],f["fo-fc(+ve)"]),"fo-fc(-ve)":t("Fo-Fc(-ve)",st(12268339),mt.IsoValue.relative(-3),p.header.sampling[0].valuesInfo[1],f["fo-fc(-ve)"])},{isFlat:!0})}}function o(l,c,u){return I.Select(Math.min(c,l.length-1),l.map((d,f)=>[f,`${f+1} [ ${0|Math.pow(d.maxVoxels,1/3)}^3 cells ]`]),{description:"Determines the maximum number of voxels. Depending on the size of the volume options are in the range from 1 (0.52M voxels) to 7 (25.17M voxels).",...u})}function s(l){return{entry:{name:l.entry.name,params:{detailLevel:l.entry.params.detailLevel,channels:l.entry.params.channels,view:{name:l.entry.params.view.name,params:{...l.entry.params.view.params}}}}}}e.createParams=function r(l={}){const{data:c,defaultView:u,channelParams:d}=l,f=new Map;c&&c.entries.forEach(h=>f.set(h.dataId,h));const p=c?c.entries.map(h=>[h.dataId,h.dataId]):[];return{entry:I.Mapped(c?c.entries[0].dataId:"",p,h=>I.Group(i({entryData:f.get(h),defaultView:u,structure:c&&c.structure,channelParams:d})))}},e.createEntryParams=i,e.copyParams=s,e.ViewTypeOptions=[["off","Off"],["box","Bounded Box"],["selection-box","Around Focus"],["camera-target","Around Camera"],["cell","Whole Structure"],["auto","Auto"]],e.ChannelTypeOptions=[["em","em"],["2fo-fc","2fo-fc"],["fo-fc(+ve)","fo-fc(+ve)"],["fo-fc(-ve)","fo-fc(-ve)"]],e.Behavior=class a extends ii.WithSubscribers{get info(){return this.infoMap.get(this.params.entry.name)}queryData(c){var u=this;return le(function*(){let d=mF(u.data.serverUrl,`${u.info.kind}/${u.info.dataId.toLowerCase()}`);if(c){const{min:v,max:x}=c;d+=`/box/${v.map(_=>Math.round(1e3*_)/1e3).join(",")}/${x.map(_=>Math.round(1e3*_)/1e3).join(",")}`}else d+="/cell";let f=u.params.entry.params.detailLevel;"auto"===u.params.entry.params.view.name&&u.params.entry.params.view.params.isSelection&&(f=u.params.entry.params.view.params.selectionDetailLevel),"camera-target"===u.params.entry.params.view.name&&c&&(f=u.decideDetail(c,u.params.entry.params.view.params.dynamicDetailLevel)),d+=`?detail=${f}`;const p=yP.get(u.cache,d);if(p)return p.data;const m=jr.getUrlAsset(u.plugin.managers.asset,d),h=yield u.plugin.runTask(u.plugin.managers.asset.resolve(m,"binary")),g=yield u.parseCif(h.data);if(!g)return;const y=yP.set(u.cache,d,{data:g,asset:h});return y&&y.asset.dispose(),g})()}parseCif(c){var u=this;return le(function*(){const d=yield u.plugin.runTask(Hh.parseBinary(c));if(d.isError)return void u.plugin.log.error("VolumeStreaming, parsing CIF: "+d.toString());if(d.result.blocks.length<2)return void u.plugin.log.error("VolumeStreaming: Invalid data.");const f={};for(let p=1;p<d.result.blocks.length;p++){const m=d.result.blocks[p],h=Hh.schema.densityServer(m),g=yield u.plugin.runTask(pfe(h));f[m.header]=g}return f})()}updateParams(c,u=!1){var d=this;return le(function*(){const f=s(d.params),p=f.entry.params.view.name;"off"!==p&&"cell"!==p&&(f.entry.params.view.params.bottomLeft=c?.min||C.zero(),f.entry.params.view.params.topRight=c?.max||C.zero()),"auto"===p&&(f.entry.params.view.params.isSelection=u);const m=d.plugin.state.data,h=m.build().to(d.ref).update(f);yield jt.State.Update(d.plugin,{state:m,tree:h,options:{doNotUpdateCurrent:!0}})})()}getStructureRoot(){return this.plugin.state.data.select(Qn.Generators.byRef(this.ref).rootOfType(Se.Molecule.Structure))[0]}register(c){this.ref=c,this.subscribeObservable(this.plugin.state.events.object.removed,u=>{!Se.Molecule.Structure.is(u.obj)||!Me.is(this.lastLoci)||this.lastLoci.structure===u.obj.data&&(this.lastLoci=qr)}),this.subscribeObservable(this.plugin.state.events.object.updated,u=>{!Se.Molecule.Structure.is(u.oldObj)||!Me.is(this.lastLoci)||this.lastLoci.structure===u.oldObj.data&&(this.lastLoci=qr)}),this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,u=>{if(!this.plugin.state.data.tree.children.has(this.ref))return;const d=u?u.loci:qr;switch(this.params.entry.params.view.name){case"auto":this.updateAuto(d);break;case"selection-box":this.updateSelectionBox(d);break;default:this.lastLoci=d}})}unregister(){let c=this.cache.entries.first;for(;c;)c.value.data.asset.dispose(),c=c.next}isCameraTargetSame(c,u){if(!c||!u)return!1;const d=C.equals(c.target,u.target),f=C.squaredDistance(c.target,c.position),p=C.squaredDistance(u.target,u.position),m=Math.abs(f-p)/f<.001;return d&&m}cameraTargetDistance(c){return C.distance(c.target,c.position)}getBoxFromLoci(c){var u,d,f;if(Yn.isEmpty(c)||uu(c))return Gt();const p=this.plugin.helpers.substructureParent.get(c.structure,!0);if(!p)return Gt();const m=this.getStructureRoot();if(!m||(null===(u=m.obj)||void 0===u?void 0:u.data)!==(null===(d=p.obj)||void 0===d?void 0:d.data))return Gt();const h=s_.get(null===(f=m.obj)||void 0===f?void 0:f.data.models[0]);h&&fe.invert(this._invTransform,h);const g=Me.extendToWholeResidues(c),y=Me.getBoundary(g,h&&!Number.isNaN(this._invTransform[0])?this._invTransform:void 0).box;return 1===Me.size(g)&&Gt.expand(y,y,C.create(1,1,1)),y}updateAuto(c){var u=this;this.updateQueue.enqueue(le(function*(){u.lastLoci=c,uu(c)?yield u.updateParams("x-ray"===u.info.kind?u.data.structure.boundary.box:void 0,!1):yield u.updateParams(u.getBoxFromLoci(c),!0)}))}updateSelectionBox(c){var u=this;this.updateQueue.enqueue(le(function*(){u.lastLoci=Yn.areEqual(u.lastLoci,c)?qr:c;const d=u.getBoxFromLoci(u.lastLoci);yield u.updateParams(d)}))}updateCameraTarget(c){var u=this;this.updateQueue.enqueue(le(function*(){var d,f,p;const m=null===(d=u.plugin.canvas3d)||void 0===d?void 0:d.props.camera.manualReset;try{m||null===(f=u.plugin.canvas3d)||void 0===f||f.setProps({camera:{manualReset:!0}});const h=u.boxFromCameraTarget(c,!0);yield u.updateParams(h)}finally{m||null===(p=u.plugin.canvas3d)||void 0===p||p.setProps({camera:{manualReset:m}})}}))}boxFromCameraTarget(c,u){var d;const f=c.target,p=this.cameraTargetDistance(c);let h=Math.tan(.5*c.fov)*p;const g=null===(d=this.plugin.canvas3d)||void 0===d?void 0:d.camera.viewport;let v,x,_;if(g&&g.width>g.height&&(h*=g.width/g.height),h*="camera-target"===this.params.entry.params.view.name?this.params.entry.params.view.params.radius:.5,u){const w=C.zero();Gt.size(w,this.data.structure.boundary.box),v=Math.min(h,.5*w[0]),x=Math.min(h,.5*w[1]),_=Math.min(h,.5*w[2])}else v=x=_=h;return Gt.create(C.create(f[0]-v,f[1]-x,f[2]-_),C.create(f[0]+v,f[1]+x,f[2]+_))}decideDetail(c,u){const d="x-ray"===this.info.kind?Gt.volume(this.data.structure.boundary.box):this.info.header.spacegroup.size.reduce((g,y)=>g*y,1);let p=Gt.volume(c)/d;const m=this.info.header.availablePrecisions.length-1;let h=u;for(;p<=.5&&h<m;)p*=2,h+=1;return h}update(c){var u=this;return le(function*(){const d="selection-box"===c.entry.params.view.name&&u.params&&u.params.entry&&u.params.entry.params&&u.params.entry.params.view&&"selection-box"!==u.params.entry.params.view.name;u.params=c;let f,p=!1;switch("camera-target"!==c.entry.params.view.name&&u.cameraTargetSubscription&&(u.cameraTargetSubscription.unsubscribe(),u.cameraTargetSubscription=void 0),c.entry.params.view.name){case"off":p=!0;break;case"box":f=Gt.create(c.entry.params.view.params.bottomLeft,c.entry.params.view.params.topRight),p=Gt.volume(f)<1e-4;break;case"selection-box":{f=d?u.getBoxFromLoci(u.lastLoci)||Gt():Gt.create(C.clone(c.entry.params.view.params.bottomLeft),C.clone(c.entry.params.view.params.topRight));const g=c.entry.params.view.params.radius;p=Gt.volume(f)<1e-4,Gt.expand(f,f,C.create(g,g,g));break}case"camera-target":u.cameraTargetSubscription||(u.cameraTargetSubscription=u.subscribeObservable(u.cameraTargetObservable,g=>u.updateCameraTarget(g))),f=u.boxFromCameraTarget(u.plugin.canvas3d.camera.getSnapshot(),!0);break;case"cell":f="x-ray"===u.info.kind?u.data.structure.boundary.box:void 0;break;case"auto":if(f=c.entry.params.view.params.isSelection||"x-ray"===u.info.kind?Gt.create(C.clone(c.entry.params.view.params.bottomLeft),C.clone(c.entry.params.view.params.topRight)):void 0,f&&(p=Gt.volume(f)<1e-4,c.entry.params.view.params.isSelection)){const g=c.entry.params.view.params.radius;Gt.expand(f,f,C.create(g,g,g))}}const m=p?{}:yield u.queryData(f);if(!m)return!1;const h=c.entry.params.channels;return"x-ray"===u.info.kind?(u.channels["2fo-fc"]=u.createChannel(m["2FO-FC"]||mt.One,h["2fo-fc"],u.info.header.sampling[0].valuesInfo[0]),u.channels["fo-fc(+ve)"]=u.createChannel(m["FO-FC"]||mt.One,h["fo-fc(+ve)"],u.info.header.sampling[0].valuesInfo[1]),u.channels["fo-fc(-ve)"]=u.createChannel(m["FO-FC"]||mt.One,h["fo-fc(-ve)"],u.info.header.sampling[0].valuesInfo[1])):u.channels.em=u.createChannel(m.EM||mt.One,h.em,u.info.header.sampling[0].valuesInfo[0]),!0})()}createChannel(c,u,d){return{data:c,color:u.color,wireframe:u.wireframe,opacity:u.opacity,isoValue:"relative"===u.isoValue.kind?u.isoValue:mt.IsoValue.toRelative(u.isoValue,d)}}getDescription(){return"selection-box"===this.params.entry.params.view.name?"Selection":"camera-target"===this.params.entry.params.view.name?"Camera":"box"===this.params.entry.params.view.name?"Static Box":"cell"===this.params.entry.params.view.name?"Cell":""}constructor(c,u){super(c,{}),this.plugin=c,this.data=u,this.cache=yP.create(25),this.params={},this.lastLoci=qr,this.ref="",this.cameraTargetObservable=this.plugin.canvas3d.didDraw.pipe(mA(500,void 0,{leading:!0,trailing:!0}),hn(()=>{var d;return null===(d=this.plugin.canvas3d)||void 0===d?void 0:d.camera.getSnapshot()}),sge((d,f)=>this.isCameraTargetSame(d,f)),xd(d=>void 0!==d)),this.cameraTargetSubscription=void 0,this.channels={},this._invTransform=fe(),this.infoMap=new Map,this.data.entries.forEach(d=>this.infoMap.set(d.dataId,d)),this.updateQueue=new nlt}}}(fu||(fu={}));const Ks=[K1(0,0,0),K1(1,0,0),K1(1,1,0),K1(0,1,0),K1(0,0,1),K1(1,0,1),K1(1,1,1),K1(0,1,1)],rlt=[Up(Ks[0],Ks[1]),Up(Ks[1],Ks[2]),Up(Ks[2],Ks[3]),Up(Ks[3],Ks[0]),Up(Ks[4],Ks[5]),Up(Ks[5],Ks[6]),Up(Ks[6],Ks[7]),Up(Ks[7],Ks[4]),Up(Ks[0],Ks[4]),Up(Ks[1],Ks[5]),Up(Ks[2],Ks[6]),Up(Ks[3],Ks[7])],ilt=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}],olt=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0],gA=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],$G=[[0,4,4,4,2,0,0,0,2,2,0,0],[4,0,4,4,0,8,0,0,0,8,8,0],[4,4,0,4,0,0,8,0,0,0,8,8],[4,4,4,0,0,0,0,1,1,0,0,1],[2,0,0,0,0,8,8,8,2,2,0,0],[0,8,0,0,8,0,8,8,0,8,8,0],[0,0,8,0,8,8,0,8,0,0,8,8],[0,0,0,1,8,8,8,0,1,0,0,1],[2,0,0,1,2,0,0,1,0,2,0,1],[2,8,0,0,2,8,0,0,2,0,8,0],[0,8,8,0,0,8,8,0,0,8,0,8],[0,0,8,1,0,0,8,1,1,0,8,0]];function age(e){return{...e,bottomLeft:Ll(e.bottomLeft,[0,0,0]),topRight:Ll(e.topRight,e.scalarField.space.dimensions)}}function lge(e){return{dX:e.topRight[0]-e.bottomLeft[0],dY:e.topRight[1]-e.bottomLeft[1],dZ:e.topRight[2]-e.bottomLeft[2]}}function yA(e,t){return Ke.create("Marching Cubes Mesh",function(){var n=le(function*(r){const i=age(e),{dX:o,dY:s,dZ:a}=lge(i),c=function slt(e,t){const n=Math.min(65536,4*e),r=tt.create(Float32Array,3,e,t&&t.vertexBuffer.ref.value),i=tt.create(Float32Array,3,e,t&&t.normalBuffer.ref.value),o=tt.create(Float32Array,1,e,t&&t.groupBuffer.ref.value),s=tt.create(Uint32Array,3,n,t&&t.indexBuffer.ref.value);let a=0,l=0;return{addVertex:(c,u,d)=>(++a,tt.add3(r,c,u,d)),addNormal:(c,u,d)=>{tt.add3(i,c,u,d)},addGroup:c=>{tt.add(o,c)},addTriangle:(c,u,d,f)=>{const p=c[u],m=c[d],h=c[f];p>=0&&m>=0&&h>=0&&(++l,tt.add3(s,p,m,h))},get:()=>{const c=tt.compact(r,!0),u=tt.compact(i,!0),d=tt.compact(s,!0),f=tt.compact(o,!0);return on.create(c,d,u,f,a,l,t)}}}(Math.min(262144,Math.max(o*s*a/32,1024)),t);return yield new cge(r,c,i).run(),c.get()});return function(r){return n.apply(this,arguments)}}())}function YG(e,t){return Ke.create("Marching Cubes Lines",function(){var n=le(function*(r){const i=age(e),{dX:o,dY:s,dZ:a}=lge(i),c=function alt(e,t){const n=tt.create(Float32Array,3,e),r=tt.create(Float32Array,1,e),i=tt.create(Float32Array,2,e);let o=0;return{addVertex:(s,a,l)=>tt.add3(n,s,a,l),addNormal:()=>rp,addGroup:s=>{tt.add(r,s)},addTriangle:(s,a,l,c,u)=>{s[a]>=0&&s[l]>=0&&s[c]>=0&&($G[a][l]&u&&(++o,tt.add2(i,s[a],s[l])),$G[l][c]&u&&(++o,tt.add2(i,s[l],s[c])),$G[a][c]&u&&(++o,tt.add2(i,s[a],s[c])))},get:()=>{const s=tt.compact(n,!0),a=tt.compact(i,!0),l=tt.compact(r,!0),c=Pd.create(o,o/10,t);for(let u=0;u<o;++u){const d=a[2*u],f=a[2*u+1];c.add(s[3*d],s[3*d+1],s[3*d+2],s[3*f],s[3*f+1],s[3*f+2],l[d])}return c.getLines()}}}(Math.min(262144,Math.max(o*s*a/32,1024)),t);return yield new cge(r,c,i).run(),c.get()});return function(r){return n.apply(this,arguments)}}())}class cge{doSlices(){var t=this;return le(function*(){let n=0;t.edgeFilter=15;for(let r=t.minZ;r<t.maxZ;r++,t.edgeFilter&=-5)t.slice(r),n+=t.sliceSize,t.ctx.shouldUpdate&&(yield t.ctx.update({message:"Computing surface...",current:n,max:t.size}))})()}slice(t){this.edgeFilter|=2;for(let n=this.minY;n<this.maxY;n++,this.edgeFilter&=-3){this.edgeFilter|=1;for(let r=this.minX;r<this.maxX;r++,this.edgeFilter&=-2)this.state.processCell(r,n,t,this.edgeFilter)}this.state.clearEdgeVertexIndexSlice(t)}run(){var t=this;return le(function*(){yield t.doSlices()})()}constructor(t,n,r){this.ctx=t,this.minX=0,this.minY=0,this.minZ=0,this.maxX=0,this.maxY=0,this.maxZ=0,this.state=new llt(n,r),this.minX=r.bottomLeft[0],this.minY=r.bottomLeft[1],this.minZ=r.bottomLeft[2],this.maxX=r.topRight[0]-1,this.maxY=r.topRight[1]-1,this.maxZ=r.topRight[2]-1,this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ),this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}}class llt{get3dOffsetFromEdgeInfo(t){return this.nX*((this.k+t.k)%2*this.nY+this.j+t.j)+this.i+t.i}clearEdgeVertexIndexSlice(t){this.verticesOnEdges.fill(0,t%2==0?0:3*this.nX*this.nY,t%2==0?3*this.nX*this.nY:this.verticesOnEdges.length)}interpolate(t){const n=ilt[t],r=3*this.get3dOffsetFromEdgeInfo(n)+n.e,i=this.verticesOnEdges[r];if(i>0)return i-1;const o=this.scalarField,s=this.scalarFieldGet,a=rlt[t],l=a.a,c=a.b,u=l.i+this.i,d=l.j+this.j,f=l.k+this.k,p=c.i+this.i,m=c.j+this.j,h=c.k+this.k,g=s(o,u,d,f),y=s(o,p,m,h),v=(this.isoLevel-g)/(g-y);if(this.idField){const N=this.idFieldGet(this.idField,u,d,f),j=this.idFieldGet(this.idField,p,m,h);let W=v<.5?N:j;if(-1===W&&(W=v<.5?j:N),-2===W)return-1;this.builder.addGroup(W)}else this.builder.addGroup(0);const x=this.builder.addVertex(u+v*(u-p),d+v*(d-m),f+v*(f-h));this.verticesOnEdges[r]=x+1;const _=s(o,Math.max(0,u-1),d,f)-s(o,Math.min(this.nX-1,u+1),d,f),w=s(o,u,Math.max(0,d-1),f)-s(o,u,Math.min(this.nY-1,d+1),f),A=s(o,u,d,Math.max(0,f-1))-s(o,u,d,Math.min(this.nZ,f+1)),T=_+v*(_-(s(o,Math.max(0,p-1),m,h)-s(o,Math.min(this.nX-1,p+1),m,h))),F=w+v*(w-(s(o,p,Math.max(0,m-1),h)-s(o,p,Math.min(this.nY-1,m+1),h))),R=A+v*(A-(s(o,p,m,Math.max(0,h-1))-s(o,p,m,Math.min(this.nZ-1,h+1))));return this.isoLevel>=0?this.builder.addNormal(T,F,R):this.builder.addNormal(-T,-F,-R),x}constructor(t,n){this.builder=t,this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0],this.i=0,this.j=0,this.k=0;const r=n.scalarField.space.dimensions;this.nX=r[0],this.nY=r[1],this.nZ=r[2],this.isoLevel=n.isoLevel,this.scalarFieldGet=n.scalarField.space.get,this.scalarField=n.scalarField.data,n.idField&&(this.idField=n.idField.data,this.idFieldGet=n.idField.space.get),this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}get(t,n,r){return this.scalarFieldGet(this.scalarField,t,n,r)}processCell(t,n,r,i){let o=0;if(this.get(t,n,r)<this.isoLevel&&(o|=1),this.get(t+1,n,r)<this.isoLevel&&(o|=2),this.get(t+1,n+1,r)<this.isoLevel&&(o|=4),this.get(t,n+1,r)<this.isoLevel&&(o|=8),this.get(t,n,r+1)<this.isoLevel&&(o|=16),this.get(t+1,n,r+1)<this.isoLevel&&(o|=32),this.get(t+1,n+1,r+1)<this.isoLevel&&(o|=64),this.get(t,n+1,r+1)<this.isoLevel&&(o|=128),0===o||255===o)return;this.i=t,this.j=n,this.k=r;const s=olt[o];(1&s)>0&&(this.vertList[0]=this.interpolate(0)),(2&s)>0&&(this.vertList[1]=this.interpolate(1)),(4&s)>0&&(this.vertList[2]=this.interpolate(2)),(8&s)>0&&(this.vertList[3]=this.interpolate(3)),(16&s)>0&&(this.vertList[4]=this.interpolate(4)),(32&s)>0&&(this.vertList[5]=this.interpolate(5)),(64&s)>0&&(this.vertList[6]=this.interpolate(6)),(128&s)>0&&(this.vertList[7]=this.interpolate(7)),(256&s)>0&&(this.vertList[8]=this.interpolate(8)),(512&s)>0&&(this.vertList[9]=this.interpolate(9)),(1024&s)>0&&(this.vertList[10]=this.interpolate(10)),(2048&s)>0&&(this.vertList[11]=this.interpolate(11));const a=gA[o];for(let l=0;l<a.length;l+=3){const c=a[l],u=a[l+1],d=a[l+2];this.isoLevel>=0?this.builder.addTriangle(this.vertList,c,u,d,i):this.builder.addTriangle(this.vertList,d,u,c,i)}}}function H_(e,t){const{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:o,eachLocation:s,setUpdateState:a,mustRecreate:l,dispose:c}=e,{updateValues:u,updateBoundingSphere:d,updateRenderableState:f,createPositionIterator:p}=e.geometryUtils,m=Ag.create();let h,g,y,v,x,A,M,E,T,F,_=Object.assign({},n),w=Ia.createEmpty(),D=-1;function N(z){if(m.createNew){if(T=i(v,x),!z)throw new Error("expected geometry to be given");h=function clt(e,t,n,r,i,o){const{createValues:s,createRenderableState:a}=$a.getUtils(t),c=s(t,E9(),n,r,i),u=a(i);return Jw(t.kind,c,u,o)}(0,z,T,y,g,t),F=p(z,h.values)}else{if(!h)throw new Error("expected renderObject to be available");if(m.updateTransform){T=i(v,x);const{instanceCount:$,groupCount:V}=T;g.instanceGranularity?hs($,"instance",h.values):hs($*V,"groupInstance",h.values)}else T.reset();if(m.createGeometry){if(!z)throw new Error("expected geometry to be given");O.updateIfChanged(h.values.drawCount,$a.getDrawCount(z)),O.updateIfChanged(h.values.uVertexCount,$a.getVertexCount(z)),O.updateIfChanged(h.values.uGroupCount,$a.getGroupCount(z))}(m.updateTransform||m.createGeometry)&&(d(h.values,z||E),F=p(z||E,h.values)),m.updateSize&&"uSize"in h.values&&xy(T,y.size,h.values),m.updateColor&&Ef(T,F,y.color,h.values),u(h.values,g),f(h.state,g)}_=g,w=y,A=v,M=x,z&&(E=z,D+=1)}function W(z,$){return Xu(z)?$(Pe.ofBounds(0,_.instanceGranularity?T.instanceCount:T.groupCount*T.instanceCount)):_.instanceGranularity?function j(z,$,V,X){let H=!1;if(mt.Cell.isLoci(z)){if(mt.Cell.isLociEmpty(z)||!mt.areEquivalent(z.volume,$))return!1;X(Pe.ofSingleton(0))&&(H=!0)}else if(mt.Segment.isLoci(z)){if(mt.Segment.isLociEmpty(z)||!mt.areEquivalent(z.volume,$)||!rt.has(z.segments,V))return!1;X(Pe.ofSingleton(0))&&(H=!0)}return H}(z,A,M,$):s(z,A,M,_,$)}return{get groupCount(){return T?T.count:0},get renderObject(){return h},get geometryVersion(){return D},createOrUpdate:(z,$,V={},X)=>le(function*(){if(function R(z,$,V,X){if(!V&&!A)throw new Error("missing volume");g=Object.assign({},_,$),y=z,v=V,x=X,Ag.reset(m),h?(!mt.areEquivalent(v,A)||x!==M)&&(m.createNew=!0):m.createNew=!0,m.createNew?m.createGeometry=!0:(a(m,V,g,_,y,w),Rd.areEqual(z.color,w.color)||(m.updateColor=!0),m.createGeometry&&(m.updateColor=!0),g.instanceGranularity!==_.instanceGranularity&&(m.updateTransform=!0))}($,V,X?.volume||A,X?.key||M),m.createGeometry){const H=r(z,v,x,y,g,E);return PR(H)?H.then(N):N(H)}N()})(),getLoci:z=>h?o(z,A,M,_,h.id):qr,eachLocation(z){for(T.reset();T.hasNext;){const{location:$,isSecondary:V}=T.move();z($,V)}},mark:(z,$)=>pr.mark(h,z,$,W),setVisibility(z){pr.setVisibility(h,z)},setAlphaFactor(z){pr.setAlphaFactor(h,z)},setPickable(z){pr.setPickable(h,z)},setColorOnly(z){pr.setColorOnly(h,z)},setTransform(z,$){pr.setTransform(h,z,$)},setOverpaint:z=>pr.setOverpaint(h,z,W,!0),setTransparency:z=>pr.setTransparency(h,z,W,!0),setSubstance:z=>pr.setSubstance(h,z,W,!0),setClipping:z=>pr.setClipping(h,z,W,!0),setThemeStrength(z){pr.setThemeStrength(h,z)},destroy(){c?.(E),h&&(h.state.disposed=!0,h=void 0)},mustRecreate:l}}function vP(e,t,n,r,i,o=(()=>[-1])){let s=0;const{webgl:a}=t,l=new si,c=new Xn.GeometryState,u=ky(),d=[],f=Xn.createState(),p=new Map;let m,h,g,y,v=Ia.createEmpty();function x(F,R){return _.apply(this,arguments)}function _(){return(_=le(function*(F,R){var N;let j=p.get(R);return j?!(null===(N=j.mustRecreate)||void 0===N)&&N.call(j,{volume:m,key:R},y,a)&&(j.destroy(),j=r(u,m,R,y,a),p.set(R,j)):(j=r(u,m,R,y,a),p.set(R,j)),j.createOrUpdate({webgl:a,runtime:F},v,y,{volume:m,key:R})})).apply(this,arguments)}return{label:e,get groupCount(){let F=0;return p.forEach(R=>{R.renderObject&&(F+=R.groupCount)}),F},get props(){return y},get params(){return g},get state(){return f},get theme(){return v},get geometryVersion(){return c.version},renderObjects:d,updated:l,createOrUpdate:function w(F={},R){R&&R!==m&&(g=n(t,R),m=R,y||(y=I.getDefaultValues(g)));const N=kG(Object.assign({},y,F),m);return Object.assign(y,F,N),h=o(y),Ke.create("Creating or updating VolumeRepresentation",function(){var j=le(function*(W){const z=new Set(p.keys());for(let $=0,V=h.length;$<V;++$){const X=h[$];z.delete(X);const H=x(W,X);H&&(yield H)}z.forEach($=>{var V;null===(V=p.get($))||void 0===V||V.destroy(),p.delete($)}),d.length=0,p.forEach($=>{$.renderObject&&(d.push($.renderObject),c.add($.renderObject.id,$.geometryVersion))}),c.snapshot(),l.next(s++)});return function(W){return j.apply(this,arguments)}}())},setState:function E(F){const{visible:R,alphaFactor:N,pickable:j,overpaint:W,transparency:z,substance:$,clipping:V,transform:X,themeStrength:H,syncManually:oe,markerActions:te}=F,K={};void 0!==R&&(K.visible=R),void 0!==N&&(K.alphaFactor=N),void 0!==j&&(K.pickable=j),void 0!==W&&(K.overpaint=W),void 0!==z&&(K.transparency=z),void 0!==$&&(K.substance=$),void 0!==V&&(K.clipping=V),void 0!==H&&(K.themeStrength=H),void 0!==X&&!fe.areEqual(X,f.transform,wi)&&(K.transform=X),void 0!==oe&&(K.syncManually=oe),void 0!==te&&(K.markerActions=te),p.forEach(Q=>function M(F,R){void 0!==R.visible&&F&&F.setVisibility(R.visible),void 0!==R.alphaFactor&&F&&F.setAlphaFactor(R.alphaFactor),void 0!==R.pickable&&F&&F.setPickable(R.pickable),void 0!==R.overpaint&&F&&F.setOverpaint(R.overpaint),void 0!==R.transparency&&F&&F.setTransparency(R.transparency),void 0!==R.substance&&F&&F.setSubstance(R.substance),void 0!==R.clipping&&F&&F.setClipping(R.clipping),void 0!==R.transform&&F&&F.setTransform(R.transform),void 0!==R.themeStrength&&F&&F.setThemeStrength(R.themeStrength)}(Q,K)),Xn.updateState(f,F)},setTheme:function D(F){v=F},getLoci:F=>{let R=qr;return p.forEach(N=>{const j=N.getLoci(F);uu(j)||(R=j)}),R},getAllLoci:()=>[i(m,y)],eachLocation:F=>{p.forEach(R=>{R.eachLocation(F)})},mark:function A(F,R){let N=!1;return p.forEach(j=>{N=j.mark(F,R)||N}),N},destroy:function T(){p.forEach(F=>F.destroy()),p.clear()}}}const ult="\nprecision highp float;\nprecision highp int;\n\n#if __VERSION__ == 100\n    precision highp sampler2D;\n    uniform sampler2D tTexture;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tTexture;\n#endif\n\nvoid main(void) {\n    #if __VERSION__ == 100\n        gl_FragColor = texture2D(tTexture, vec2(0.5));\n    #else\n        gl_FragColor = ivec4(texture2D(tTexture, vec2(0.5)).r);\n    #endif\n}\n",dlt={...ca,tTexture:xn("texture","rgba","float","nearest")},zp="histopyramid-sum";const bF=new Uint8Array(4),uge=new Int32Array(4),glt="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tInputLevel;\n\n// previous level used to evaluate the new level\n#if __VERSION__ == 100\n    uniform sampler2D tPreviousLevel;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tPreviousLevel;\n#endif\n\n// inverted size of the previous level texture.\nuniform float uSize;\nuniform float uTexSize;\nuniform bool uFirst;\n\n#include common\n\nvoid main(void) {\n    float k = 0.5 * uSize;\n    vec2 position = floor((gl_FragCoord.xy / uTexSize) / uSize) * uSize;\n\n    #if __VERSION__ == 100\n        float a, b, c, d;\n\n        if (uFirst) {\n            a = texture2D(tInputLevel, position).r * 255.0;\n            b = texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0;\n            c = texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0;\n            d = texture2D(tInputLevel, position + vec2(k, k)).r * 255.0;\n        } else {\n            a = unpackRGBToInt(texture2D(tPreviousLevel, position).rgb);\n            b = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, 0.0)).rgb);\n            c = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(0.0, k)).rgb);\n            d = unpackRGBToInt(texture2D(tPreviousLevel, position + vec2(k, k)).rgb);\n        }\n        gl_FragColor = vec4(packIntToRGB(a + b + c + d), 1.0);\n    #else\n        int a, b, c, d;\n\n        if (uFirst) {\n            a = int(texture2D(tInputLevel, position).r * 255.0);\n            b = int(texture2D(tInputLevel, position + vec2(k, 0.0)).r * 255.0);\n            c = int(texture2D(tInputLevel, position + vec2(0.0, k)).r * 255.0);\n            d = int(texture2D(tInputLevel, position + vec2(k, k)).r * 255.0);\n        } else {\n            a = texture2D(tPreviousLevel, position).r;\n            b = texture2D(tPreviousLevel, position + vec2(k, 0.0)).r;\n            c = texture2D(tPreviousLevel, position + vec2(0.0, k)).r;\n            d = texture2D(tPreviousLevel, position + vec2(k, k)).r;\n        }\n        gl_FragColor = ivec4(a + b + c + d);\n    #endif\n}\n",ylt={...ca,tInputLevel:xn("texture","rgba","float","nearest"),tPreviousLevel:xn("texture","rgba","float","nearest"),uSize:Ne("f"),uTexSize:Ne("f"),uFirst:Ne("b")},Z1="histogram-pyramid";function xlt(e,t){const n=Math.pow(2,t),r=`level${t}`,i=e.isWebGL2?vF(r,e,"image-int32","alpha","int","nearest"):vF(r,e,"image-uint8","rgba","ubyte","nearest");i.define(n,n);let o=function Slt(e,t){return t.namedFramebuffers[`${Z1}-${e}`]}(r,e);return o||(o=dge(r,e),i.attachFramebuffer(o,0)),{texture:i,framebuffer:o}}function dge(e,t){const n=`${Z1}-${e}`;return t.namedFramebuffers[n]||(t.namedFramebuffers[n]=t.resources.framebuffer()),t.namedFramebuffers[n]}function vF(e,t,n,r,i,o){const s=`${Z1}-${e}`;return t.namedTextures[s]||(t.namedTextures[s]=t.resources.texture(n,r,i,o)),t.namedTextures[s]}function Clt(e,t,n,r){It&&e.timer.mark("createHistogramPyramid");const{gl:i,state:o}=e,s=t.getWidth();if(s!==t.getHeight()||!d3(s))throw new Error("inputTexture must be of square power-of-two size");const l=Math.ceil(Math.log(s)/Math.log(2)),c=Math.pow(2,l),u=Math.pow(2,l),d=Math.pow(2,l-1),f=e.isWebGL2?vF("pyramid",e,"image-int32","alpha","int","nearest"):vF("pyramid",e,"image-uint8","rgba","ubyte","nearest");f.define(u,d);const p=dge("pyramid",e);f.attachFramebuffer(p,0),o.viewport(0,0,u,d),Cn(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT);const m=[];for(let x=0;x<l;++x)m.push(xlt(e,x));const h=function blt(e,t,n){if(e.namedComputeRenderables[Z1]){const r=e.namedComputeRenderables[Z1].values;O.update(r.tInputLevel,t),O.update(r.tPreviousLevel,n),e.namedComputeRenderables[Z1].update()}else e.namedComputeRenderables[Z1]=function vlt(e,t,n){const r={...ua,tInputLevel:O.create(t),tPreviousLevel:O.create(n),uSize:O.create(0),uTexSize:O.create(0),uFirst:O.create(!0)},i={...ylt};return ys(ms(e,"triangles",Wi("reduction",hl,glt,{},{0:"ivec4"}),i,r),r)}(e,t,n);return e.namedComputeRenderables[Z1]}(e,t,m[0].texture);o.currentRenderItemId=-1,function _lt(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e);let g=0;for(let x=0;x<l;x++){const _=l-1-x;m[_].framebuffer.bind();const A=Math.pow(2,_);O.update(h.values.uSize,Math.pow(2,x+1)/c),O.update(h.values.uTexSize,A),O.updateIfChanged(h.values.uFirst,0===x),x>0&&(O.update(h.values.tPreviousLevel,m[l-x].texture),h.update()),o.currentRenderItemId=-1,o.viewport(0,0,A,A),o.scissor(0,0,A,A),Cn(i)?i.clearBufferiv(i.COLOR,0,[0,0,0,0]):i.clear(i.COLOR_BUFFER_BIT),o.scissor(0,0,r[0],r[1]),h.render(),f.bind(0),i.copyTexSubImage2D(i.TEXTURE_2D,0,g,0,0,0,A,A),f.unbind(0),g+=A}i.finish(),It&&e.timer.markEnd("createHistogramPyramid");const y=Math.max(1,function mlt(e,t){It&&e.timer.mark("getHistopyramidSum");const{gl:n,state:r,resources:i}=e,o=function flt(e,t){return e.namedComputeRenderables[zp]?(O.update(e.namedComputeRenderables[zp].values.tTexture,t),e.namedComputeRenderables[zp].update()):e.namedComputeRenderables[zp]=function plt(e,t){const n={...ua,tTexture:O.create(t)},r={...dlt};return ys(ms(e,"triangles",Wi("sum",hl,ult,{},{0:"ivec4"}),r,n),n)}(e,t),e.namedComputeRenderables[zp]}(e,t);e.state.currentRenderItemId=-1,e.namedFramebuffers[zp]||(e.namedFramebuffers[zp]=i.framebuffer());const s=e.namedFramebuffers[zp];return e.namedTextures[zp]||(e.namedTextures[zp]=Cn(n)?i.texture("image-int32","rgba","int","nearest"):i.texture("image-uint8","rgba","ubyte","nearest"),e.namedTextures[zp].define(1,1)),e.namedTextures[zp].attachFramebuffer(s,0),function hlt(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e),r.viewport(0,0,1,1),o.render(),n.finish(),e.readPixels(0,0,1,1,Cn(n)?uge:bF),e.unbindFramebuffer(),It&&e.timer.markEnd("getHistopyramidSum"),Cn(n)?uge[0]:H9(bF[0],bF[1],bF[2])}(e,m[0].texture));return{pyramidTex:f,count:y,height:Math.ceil(y/Math.pow(2,l)),levels:l,scale:n}}let xP,_P;function wlt(){if(void 0!==xP)return xP;xP=Sa(256,1,Uint8Array);const{array:e}=xP;for(let t=0,n=gA.length;t<n;++t)e[t]=gA[t].length/3;return xP}function Alt(){if(void 0!==_P)return _P;_P=Sa(4096,1,Uint8Array);const{array:e}=_P;for(let t=0,n=gA.length;t<n;++t)for(let r=0;r<16;++r)e[16*t+r]=r<gA[t].length?gA[t][r]:255;return _P}const Ilt="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#if __VERSION__ == 100\n    uniform sampler2D tActiveVoxelsPyramid;\n#else\n    precision highp isampler2D;\n    uniform isampler2D tActiveVoxelsPyramid;\n#endif\n\nuniform sampler2D tActiveVoxelsBase;\nuniform sampler2D tVolumeData;\nuniform sampler2D tTriIndices;\n\nuniform float uIsoValue;\nuniform float uLevels;\nuniform float uSize;\nuniform float uCount;\nuniform bool uInvert;\n\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform mat4 uGridTransform;\n\n// scale to volume data coord\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord + 0.5 / (texDim / uScale));\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvec4 voxelPadded(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(vec2(2.0), 1.0)); // remove xy padding\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nint idot2(const in ivec2 a, const in ivec2 b) {\n    return a.x * b.x + a.y * b.y;\n}\n\nint idot4(const in ivec4 a, const in ivec4 b) {\n    return a.x * b.x + a.y * b.y + a.z * b.z + a.w * b.w;\n}\n\n#if __VERSION__ == 100\n    int pyramidVoxel(vec2 pos) {\n        return int(unpackRGBToInt(texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).rgb));\n    }\n#else\n    int pyramidVoxel(vec2 pos) {\n        return texture2D(tActiveVoxelsPyramid, pos / (vec2(1.0, 0.5) * uSize)).r;\n    }\n#endif\n\nvec4 baseVoxel(vec2 pos) {\n    return texture2D(tActiveVoxelsBase, pos / uSize);\n}\n\nvec4 getGroup(const in vec3 p) {\n    vec3 gridDim = uGridDim - vec3(1.0, 1.0, 0.0); // remove xy padding\n    // note that we swap x and z because the texture is flipped around y\n    #if defined(dAxisOrder_012)\n        float group = p.z + p.y * gridDim.z + p.x * gridDim.z * gridDim.y; // 210\n    #elif defined(dAxisOrder_021)\n        float group = p.y + p.z * gridDim.y + p.x * gridDim.y * gridDim.z; // 120\n    #elif defined(dAxisOrder_102)\n        float group = p.z + p.x * gridDim.z + p.y * gridDim.z * gridDim.x; // 201\n    #elif defined(dAxisOrder_120)\n        float group = p.x + p.z * gridDim.x + p.y * gridDim.x * gridDim.z; // 021\n    #elif defined(dAxisOrder_201)\n        float group = p.y + p.x * gridDim.y + p.z * gridDim.y * gridDim.x; // 102\n    #elif defined(dAxisOrder_210)\n        float group = p.x + p.y * gridDim.x + p.z * gridDim.x * gridDim.y; // 012\n    #endif\n    return vec4(group > 16777215.5 ? vec3(1.0) : packIntToRGB(group), 1.0);\n}\n\nvoid main(void) {\n    // get 1D index\n    int vI = int(gl_FragCoord.x) + int(gl_FragCoord.y) * int(uSize);\n\n    // ignore 1D indices outside of the grid\n    if(vI >= int(uCount)) discard;\n\n    ivec2 offset = ivec2(int(uSize) - 2, 0);\n\n    int start = 0;\n    ivec4 starts = ivec4(0);\n    ivec4 ends = ivec4(0);\n    int diff = 2;\n    ivec4 m = ivec4(0);\n    ivec2 position = ivec2(0);\n    ivec4 vI4 = ivec4(vI);\n\n    ivec2 relativePosition = ivec2(0);\n    int end = 0;\n    ivec2 pos1 = ivec2(0);\n    ivec2 pos2 = ivec2(0);\n    ivec2 pos3 = ivec2(0);\n    ivec2 pos4 = ivec2(0);\n    ivec3 vI3 = ivec3(vI);\n    ivec3 mask = ivec3(0);\n\n    // traverse the different levels of the pyramid\n    for(int i = 1; i < 14; i++) {\n        if(float(i) >= uLevels) break;\n\n        offset.x -= diff;\n        diff *= 2;\n        relativePosition = position + offset;\n\n        end = start + pyramidVoxel(vec2(relativePosition));\n        pos1 = ivec2(relativePosition);\n        starts.x = start;\n        ends.x = end;\n        pos2 = ivec2(relativePosition + ivec2(1, 0));\n        starts.y = ends.x;\n        ends.y = ends.x + pyramidVoxel(vec2(pos2));\n        pos3 = relativePosition + ivec2(0, 1);\n        starts.z = ends.y;\n        ends.z = ends.y + pyramidVoxel(vec2(pos3));\n        pos4 = relativePosition + ivec2(1, 1);\n        starts.w = ends.z;\n        mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n        m = ivec4(mask, 1 - int(any(bvec3(mask))));\n\n        relativePosition = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n        start = idot4(m, starts);\n        position = 2 * (relativePosition - offset);\n    }\n\n    end = start + int(baseVoxel(vec2(position)).r * 255.0);\n    pos1 = position;\n    starts.x = start;\n    ends.x = end;\n    pos2 = position + ivec2(1, 0);\n    starts.y = ends.x;\n    ends.y = ends.x + int(baseVoxel(vec2(pos2)).r * 255.0);\n    pos3 = position + ivec2(0, 1);\n    starts.z = ends.y;\n    ends.z = ends.y + int(baseVoxel(vec2(pos3)).r * 255.0);\n    pos4 = position + ivec2(1, 1);\n    starts.w = ends.z;\n    mask = ivec3(greaterThanEqual(vI3, starts.rgb)) * ivec3(lessThan(vI3, ends.rgb));\n    m = ivec4(mask, 1 - int(any(bvec3(mask))));\n    position = m.x * pos1 + m.y * pos2 + m.z * pos3 + m.w * pos4;\n\n    vec2 coord2d = (vec2(position) / uSize) / uScale;\n    vec3 coord3d = floor(index3dFrom2d(coord2d) + 0.5);\n\n    float edgeIndex = floor(baseVoxel(vec2(position)).a * 255.0 + 0.5);\n\n    // current vertex for the up to 15 MC cases\n    int currentVertex = vI - idot4(m, starts);\n\n    // ensure winding-order is the same for negative and positive iso-levels\n    if (uInvert) {\n        int v = imod(currentVertex + 1, 3);\n        if (v == 1) currentVertex += 2;\n        else if (v == 0) currentVertex -= 2;\n    }\n\n    // get index into triIndices table\n    int mcIndex = 16 * int(edgeIndex) + currentVertex;\n    vec4 mcData = texture2D(tTriIndices, vec2(imod(mcIndex, 64), mcIndex / 64) / 64.);\n\n    // bit mask to avoid conditionals (see comment below) for getting MC case corner\n    vec4 m0 = vec4(floor(mcData.a * 255.0 + 0.5));\n\n    // get edge value masks\n    vec4 m1 = vec4(equal(m0, vec4(0., 1., 2., 3.)));\n    vec4 m2 = vec4(equal(m0, vec4(4., 5., 6., 7.)));\n    vec4 m3 = vec4(equal(m0, vec4(8., 9., 10., 11.)));\n\n    // apply bit masks\n    vec3 b0 = coord3d +\n                m1.y * c1 +\n                m1.z * c2 +\n                m1.w * c3 +\n                m2.x * c4 +\n                m2.y * c5 +\n                m2.z * c6 +\n                m2.w * c7 +\n                m3.y * c1 +\n                m3.z * c2 +\n                m3.w * c3;\n    vec3 b1 = coord3d +\n                m1.x * c1 +\n                m1.y * c2 +\n                m1.z * c3 +\n                m2.x * c5 +\n                m2.y * c6 +\n                m2.z * c7 +\n                m2.w * c4 +\n                m3.x * c4 +\n                m3.y * c5 +\n                m3.z * c6 +\n                m3.w * c7;\n\n    // the conditionals that are avoided by above bitmasks\n    // vec3 b0 = coord3d;\n    // vec3 b1 = coord3d;\n    // if (mcIndex == 0.0) {\n    //     b1 += c1;\n    // } else if (mcIndex == 1.0) {\n    //     b0 += c1; b1 += c2;\n    // } else if (mcIndex == 2.0) {\n    //     b0 += c2; b1 += c3;\n    // } else if (mcIndex == 3.0) {\n    //     b0 += c3;\n    // } else if (mcIndex == 4.0) {\n    //     b0 += c4; b1 += c5;\n    // } else if (mcIndex == 5.0) {\n    //     b0 += c5; b1 += c6;\n    // } else if (mcIndex == 6.0) {\n    //     b0 += c6; b1 += c7;\n    // } else if (mcIndex == 7.0) {\n    //     b0 += c7; b1 += c4;\n    // } else if (mcIndex == 8.0) {\n    //     b1 += c4;\n    // } else if (mcIndex == 9.0) {\n    //     b0 += c1; b1 += c5;\n    // } else if (mcIndex == 10.0) {\n    //     b0 += c2; b1 += c6;\n    // } else if (mcIndex == 11.0) {\n    //     b0 += c3; b1 += c7;\n    // }\n    // b0 = floor(b0 + 0.5);\n    // b1 = floor(b1 + 0.5);\n\n    vec4 d0 = voxel(b0);\n    vec4 d1 = voxel(b1);\n\n    float v0 = d0.a;\n    float v1 = d1.a;\n\n    float t = (uIsoValue - v0) / (v0 - v1);\n    gl_FragData[0].xyz = (uGridTransform * vec4(b0 + t * (b0 - b1), 1.0)).xyz;\n\n    // group id\n    #if __VERSION__ == 100 || defined(dConstantGroup)\n        // webgl1 does not support 'flat' interpolation (i.e. no interpolation)\n        // ensure a constant group id per triangle as needed\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(voxel(coord3d).rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(coord3d);\n        #endif\n    #else\n        #ifdef dPackedGroup\n            gl_FragData[1] = vec4(t < 0.5 ? d0.rgb : d1.rgb, 1.0);\n        #else\n            gl_FragData[1] = getGroup(t < 0.5 ? b0 : b1);\n        #endif\n    #endif\n\n    // normals from gradients\n    vec3 n0 = -normalize(vec3(\n        voxelPadded(b0 - c1).a - voxelPadded(b0 + c1).a,\n        voxelPadded(b0 - c3).a - voxelPadded(b0 + c3).a,\n        voxelPadded(b0 - c4).a - voxelPadded(b0 + c4).a\n    ));\n    vec3 n1 = -normalize(vec3(\n        voxelPadded(b1 - c1).a - voxelPadded(b1 + c1).a,\n        voxelPadded(b1 - c3).a - voxelPadded(b1 + c3).a,\n        voxelPadded(b1 - c4).a - voxelPadded(b1 + c4).a\n    ));\n    gl_FragData[2].xyz = -vec3(\n        n0.x + t * (n0.x - n1.x),\n        n0.y + t * (n0.y - n1.y),\n        n0.z + t * (n0.z - n1.z)\n    );\n\n    // ensure normal-direction is the same for negative and positive iso-levels\n    if (uInvert) {\n        gl_FragData[2].xyz *= -1.0;\n    }\n\n    // apply normal matrix\n    gl_FragData[2].xyz *= transpose3(inverse3(mat3(uGridTransform)));\n}\n",Elt="\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tTriCount;\nuniform sampler2D tVolumeData;\n\nuniform float uIsoValue;\nuniform vec3 uGridDim;\nuniform vec3 uGridTexDim;\nuniform vec2 uScale;\n\n#include common\n\n// cube corners (excluding origin)\nconst vec3 c1 = vec3(1., 0., 0.);\nconst vec3 c2 = vec3(1., 1., 0.);\nconst vec3 c3 = vec3(0., 1., 0.);\nconst vec3 c4 = vec3(0., 0., 1.);\nconst vec3 c5 = vec3(1., 0., 1.);\nconst vec3 c6 = vec3(1., 1., 1.);\nconst vec3 c7 = vec3(0., 1., 1.);\n\nvec3 index3dFrom2d(vec2 coord) {\n    vec2 gridTexPos = coord * uGridTexDim.xy;\n    vec2 columnRow = ivec2Div(gridTexPos, uGridDim.xy);\n    vec2 posXY = gridTexPos - columnRow * uGridDim.xy;\n    float posZ = columnRow.y * intDiv(uGridTexDim.x, uGridDim.x) + columnRow.x;\n    return vec3(posXY, posZ);\n}\n\nvec4 texture3dFrom2dNearest(sampler2D tex, vec3 pos, vec3 gridDim, vec2 texDim) {\n    float zSlice = floor(pos.z * gridDim.z + 0.5); // round to nearest z-slice\n    float column = intDiv(intMod(zSlice * gridDim.x, texDim.x), gridDim.x);\n    float row = intDiv(zSlice * gridDim.x, texDim.x);\n    vec2 coord = (vec2(column * gridDim.x, row * gridDim.y) + (pos.xy * gridDim.xy)) / (texDim / uScale);\n    return texture2D(tex, coord);\n}\n\nvec4 voxel(vec3 pos) {\n    pos = min(max(vec3(0.0), pos), uGridDim - vec3(1.0));\n    return texture3dFrom2dNearest(tVolumeData, pos / uGridDim, uGridDim, uGridTexDim.xy);\n}\n\nvoid main(void) {\n    vec2 uv = gl_FragCoord.xy / uGridTexDim.xy;\n    vec3 posXYZ = index3dFrom2d(uv);\n\n    // get MC case as the sum of corners that are below the given iso level\n    float c = step(voxel(posXYZ).a, uIsoValue)\n        + 2. * step(voxel(posXYZ + c1).a, uIsoValue)\n        + 4. * step(voxel(posXYZ + c2).a, uIsoValue)\n        + 8. * step(voxel(posXYZ + c3).a, uIsoValue)\n        + 16. * step(voxel(posXYZ + c4).a, uIsoValue)\n        + 32. * step(voxel(posXYZ + c5).a, uIsoValue)\n        + 64. * step(voxel(posXYZ + c6).a, uIsoValue)\n        + 128. * step(voxel(posXYZ + c7).a, uIsoValue);\n    c *= step(c, 254.);\n\n    // handle out of bounds positions\n    posXYZ += 1.0;\n    posXYZ.xy += 1.0; // pixel padding (usually ok even if the texture has no padding)\n    if (posXYZ.x >= uGridDim.x || posXYZ.y >= uGridDim.y || posXYZ.z >= uGridDim.z)\n        c = 0.0;\n\n    // get total triangles to generate for calculated MC case from triCount texture\n    float totalTrianglesToGenerate = texture2D(tTriCount, vec2(intMod(c, 16.), floor(c / 16.)) / 16.).a;\n    gl_FragColor = vec4(vec3(totalTrianglesToGenerate * 3.0), c / 255.0);\n}\n",Tlt={...ca,tTriCount:xn("image-uint8","alpha","ubyte","nearest"),tVolumeData:xn("texture","rgba","ubyte","nearest"),uIsoValue:Ne("f"),uGridDim:Ne("v3"),uGridTexDim:Ne("v3"),uScale:Ne("v2")},tm="active-voxels";const Rlt={...ca,tTriIndices:xn("image-uint8","alpha","ubyte","nearest"),tActiveVoxelsPyramid:xn("texture","rgba","float","nearest"),tActiveVoxelsBase:xn("texture","rgba","float","nearest"),tVolumeData:xn("texture","rgba","ubyte","nearest"),uIsoValue:Ne("f"),uSize:Ne("f"),uLevels:Ne("f"),uCount:Ne("f"),uInvert:Ne("b"),uGridDim:Ne("v3"),uGridTexDim:Ne("v3"),uGridTransform:Ne("m4"),uScale:Ne("v2"),dPackedGroup:cn("boolean"),dAxisOrder:cn("string",["012","021","102","120","201","210"]),dConstantGroup:cn("boolean")},Q1="isosurface";function xF(e,t,n,r,i,o,s,a,l,c,u,d,f,p){It&&e.timer.mark("extractIsosurface");const m=function Mlt(e,t,n,r,i,o){It&&e.timer.mark("calcActiveVoxels");const{gl:s,state:a,resources:l}=e,c=t.getWidth(),u=t.getHeight();e.namedFramebuffers[tm]||(e.namedFramebuffers[tm]=l.framebuffer());const d=e.namedFramebuffers[tm];d.bind(),e.namedTextures[tm]||(e.namedTextures[tm]=l.texture("image-uint8","rgba","ubyte","nearest"));const f=e.namedTextures[tm];f.define(c,u);const p=function Dlt(e,t,n,r,i,o){if(e.namedComputeRenderables[tm]){const s=e.namedComputeRenderables[tm].values;O.update(s.uQuadScale,o),O.update(s.tVolumeData,t),O.updateIfChanged(s.uIsoValue,i),O.update(s.uGridDim,n),O.update(s.uGridTexDim,r),O.update(s.uScale,o),e.namedComputeRenderables[tm].update()}else e.namedComputeRenderables[tm]=function Plt(e,t,n,r,i,o){const s={...ua,tTriCount:O.create(wlt()),uQuadScale:O.create(o),tVolumeData:O.create(t),uIsoValue:O.create(i),uGridDim:O.create(n),uGridTexDim:O.create(r),uScale:O.create(o)},a={...Tlt};return ys(ms(e,"triangles",Wi("active-voxels",hl,Elt),a,s),s)}(e,t,n,r,i,o);return e.namedComputeRenderables[tm]}(e,t,n,r,i,o);return e.state.currentRenderItemId=-1,f.attachFramebuffer(d,0),function klt(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e),a.viewport(0,0,c,u),a.scissor(0,0,c,u),s.clear(s.COLOR_BUFFER_BIT),a.scissor(0,0,r[0],r[1]),p.render(),s.finish(),It&&e.timer.markEnd("calcActiveVoxels"),f}(e,t,n,r,s,i),g=function Blt(e,t,n,r,i,o,s,a,l,c,u,d,f,p,m){const{drawBuffers:h}=e.extensions;if(!h)throw new Error("need WebGL draw buffers");It&&e.timer.mark("createIsosurfaceBuffers");const{gl:g,state:y,resources:v,extensions:x}=e,{pyramidTex:_,height:w,levels:A,scale:M,count:E}=r,D=_.getWidth();e.namedFramebuffers[Q1]||(e.namedFramebuffers[Q1]=v.framebuffer());const T=e.namedFramebuffers[Q1];Cn(g)?(f||(f=v.texture("image-float32","rgba","float","nearest")),p||(p=v.texture("image-uint8","rgba","ubyte","nearest")),m||(m=x.colorBufferHalfFloat&&x.textureHalfFloat?v.texture("image-float16","rgba","fp16","nearest"):v.texture("image-float32","rgba","float","nearest"))):(f||(f=v.texture("image-float32","rgba","float","nearest")),p||(p=v.texture("image-float32","rgba","float","nearest")),m||(m=v.texture("image-float32","rgba","float","nearest"))),f.define(D,w),p.define(D,w),m.define(D,w),f.attachFramebuffer(T,0),p.attachFramebuffer(T,1),m.attachFramebuffer(T,2);const F=function Nlt(e,t,n,r,i,o,s,a,l,c,u,d,f,p,m){if(e.namedComputeRenderables[Q1]){const h=e.namedComputeRenderables[Q1].values;O.update(h.tActiveVoxelsPyramid,t),O.update(h.tActiveVoxelsBase,n),O.update(h.tVolumeData,r),O.updateIfChanged(h.uIsoValue,a),O.updateIfChanged(h.uSize,Math.pow(2,l)),O.updateIfChanged(h.uLevels,l),O.updateIfChanged(h.uCount,u),O.updateIfChanged(h.uInvert,d),O.update(h.uGridDim,i),O.update(h.uGridTexDim,o),O.update(h.uGridTransform,s),O.update(h.uScale,c),O.updateIfChanged(h.dPackedGroup,f),O.updateIfChanged(h.dAxisOrder,p.join("")),O.updateIfChanged(h.dConstantGroup,m),e.namedComputeRenderables[Q1].update()}else e.namedComputeRenderables[Q1]=function Flt(e,t,n,r,i,o,s,a,l,c,u,d,f,p,m){const h={...ua,tTriIndices:O.create(Alt()),tActiveVoxelsPyramid:O.create(t),tActiveVoxelsBase:O.create(n),tVolumeData:O.create(r),uIsoValue:O.create(a),uSize:O.create(Math.pow(2,l)),uLevels:O.create(l),uCount:O.create(u),uInvert:O.create(d),uGridDim:O.create(i),uGridTexDim:O.create(o),uGridTransform:O.create(s),uScale:O.create(c),dPackedGroup:O.create(f),dAxisOrder:O.create(p.join("")),dConstantGroup:O.create(m)},g={...Rlt};return ys(ms(e,"triangles",Wi("isosurface",hl,Ilt,{drawBuffers:"required"}),g,h),h)}(e,t,n,r,i,o,s,a,l,c,u,d,f,p,m);return e.namedComputeRenderables[Q1]}(e,_,t,n,i,o,s,a,A,M,E,l,c,u,d);return e.state.currentRenderItemId=-1,T.bind(),h.drawBuffers([h.COLOR_ATTACHMENT0,h.COLOR_ATTACHMENT1,h.COLOR_ATTACHMENT2]),function Olt(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.disable(t.BLEND),n.disable(t.DEPTH_TEST),n.disable(t.SCISSOR_TEST),n.depthMask(!1),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0)}(e),y.viewport(0,0,D,w),g.clear(g.COLOR_BUFFER_BIT),F.render(),g.finish(),It&&e.timer.markEnd("createIsosurfaceBuffers"),{vertexTexture:f,groupTexture:p,normalTexture:m,vertexCount:E}}(e,m,t,Clt(e,m,i,r),n,r,o,s,a,l,c,u,d,f,p);return It&&e.timer.markEnd("extractIsosurface"),g}const fge={isoValue:mt.IsoValueParam},SP=1;function XG(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;const n=e.grid.cells.space.dimensions,{powerOfTwoSize:r}=W1(n,SP);return r<=t.maxTextureSize/2}function jlt(e,t,n,r,i){return r.tryUseGpu&&i&&function Llt(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(i)&&XG(t,i)?function Hlt(e){return H_({defaultProps:I.getDefaultValues(JG),createGeometry:Vlt,createLocationIterator:t=>Vi(t.grid.cells.data.length,1,1,()=>Gu),getLoci:KG,eachLocation:ZG,setUpdateState:(t,n,r,i)=>{mt.IsoValue.areSame(r.isoValue,i.isoValue,n.grid.stats)||(t.createGeometry=!0)},geometryUtils:iu.Utils,mustRecreate:(t,n,r)=>!n.tryUseGpu||!r||!XG(t.volume,r),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}(e):function zlt(e){return H_({defaultProps:I.getDefaultValues(JG),createGeometry:Ult,createLocationIterator:t=>Vi(t.grid.cells.data.length,1,1,()=>Gu),getLoci:KG,eachLocation:ZG,setUpdateState:(t,n,r,i)=>{mt.IsoValue.areSame(r.isoValue,i.isoValue,n.grid.stats)||(t.createGeometry=!0)},geometryUtils:on.Utils,mustRecreate:(t,n,r)=>n.tryUseGpu&&!!r&&XG(t.volume,r)},e)}(e)}function pge(e,t){return mt.Isosurface.Loci(e,t.isoValue)}function KG(e,t,n,r,i){const{objectId:o,groupId:s}=e;if(i===o){const a=mt.PickingGranularity.get(t);return"volume"===a?mt.Loci(t):"object"===a?mt.Isosurface.Loci(t,r.isoValue):mt.Cell.Loci(t,Pe.ofSingleton(s))}return qr}function ZG(e,t,n,r,i){return eF(e,t,{isoValue:r.isoValue},i)}function Ult(e,t,n,r,i,o){return QG.apply(this,arguments)}function QG(){return QG=le(function*(e,t,n,r,i,o){e.runtime.update({message:"Marching cubes..."});const s=Sd(new Int32Array(t.grid.cells.data.length)),a=yield yA({isoLevel:mt.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:mr.create(t.grid.cells.space,mr.Data1(s))},o).runAsChild(e.runtime),l=Ca.getGridToCartesianTransform(t.grid);return on.transform(a,l),e.webgl&&!e.webgl.isWebGL2?(on.uniformTriangleGroup(a,!1),O.updateIfChanged(a.varyingGroup,!1)):O.updateIfChanged(a.varyingGroup,!0),a.setBoundingSphere(mt.Isosurface.getBoundingSphere(t,i.isoValue)),a}),QG.apply(this,arguments)}const JG={...on.Params,...iu.Params,...fge,quality:{...on.Params.quality,isEssential:!1},tryUseGpu:I.Boolean(!0)};var eq;function Vlt(e,t,n,r,i,o){return tq.apply(this,arguments)}function tq(){return tq=le(function*(e,t,n,r,i,o){if(!e.webgl)throw new Error("webgl context required to create volume isosurface texture-mesh");if(t.grid.cells.data.length<=1)return iu.createEmpty(o);const{max:s,min:a}=t.grid.stats,l=s-a,c=mt.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,u=(c-a)/l,{texture:d,gridDimension:f,gridTexDim:p,gridTexScale:m,transform:h}=eq.get(t,e.webgl),g=t.grid.cells.space.axisOrderSlowToFast,y=o?.doubleBuffer.get(),v=xF(e.webgl,d,f,p,m,h,u,c<0,!1,g,!0,y?.vertex,y?.group,y?.normal),x=t.grid.cells.data.length,_=mt.getBoundingSphere(t),w=iu.create(v.vertexCount,x,v.vertexTexture,v.groupTexture,v.normalTexture,_,o);return w.meta.webgl=e.webgl,w}),tq.apply(this,arguments)}function Glt(e,t,n,r,i,o){return nq.apply(this,arguments)}function nq(){return nq=le(function*(e,t,n,r,i,o){e.runtime.update({message:"Marching cubes..."});const s=Sd(new Int32Array(t.grid.cells.data.length)),a=yield YG({isoLevel:mt.IsoValue.toAbsolute(i.isoValue,t.grid.stats).absoluteValue,scalarField:t.grid.cells,idField:mr.create(t.grid.cells.space,mr.Data1(s))},o).runAsChild(e.runtime),l=Ca.getGridToCartesianTransform(t.grid);return Mo.transform(a,l),a.setBoundingSphere(mt.Isosurface.getBoundingSphere(t,i.isoValue)),a}),nq.apply(this,arguments)}!function(e){const t="volume-isosurface-texture";e.descriptor=hf({name:t}),e.get=function n(r,i){const{resources:o}=i,s=Ca.getGridToCartesianTransform(r.grid),a=C.clone(r.grid.cells.space.dimensions),{width:l,height:c,powerOfTwoSize:u}=W1(a,SP),d=C.create(l,c,0),f=Ue.create(l/u,c/u);if(u>i.maxTextureSize/2)throw new Error("volume too large for gpu isosurface extraction");if(!r._propertyData[t]){r._propertyData[t]=o.texture("image-uint8","alpha","ubyte","linear");const p=r._propertyData[t];p.define(u,u),p.load(ome(r,"data",SP),!0),r.customProperties.add(e.descriptor),r.customProperties.assets(e.descriptor,[{dispose:()=>p.destroy()}])}return a[0]+=SP,a[1]+=SP,{texture:r._propertyData[t],transform:s,gridDimension:a,gridTexDim:d,gridTexScale:f}}}(eq||(eq={}));const hge={...Mo.Params,...fge,quality:{...Mo.Params.quality,isEssential:!1},sizeFactor:I.Numeric(3,{min:0,max:10,step:.1})};function qlt(e){return H_({defaultProps:I.getDefaultValues(hge),createGeometry:Glt,createLocationIterator:t=>Vi(t.grid.cells.data.length,1,1,()=>Gu),getLoci:KG,eachLocation:ZG,setUpdateState:(t,n,r,i)=>{mt.IsoValue.areSame(r.isoValue,i.isoValue,n.grid.stats)||(t.createGeometry=!0)},geometryUtils:Mo.Utils},e)}const mge={solid:(e,t)=>vP("Isosurface mesh",e,t,jlt,pge),wireframe:(e,t)=>vP("Isosurface wireframe",e,t,qlt,pge)},gge={...JG,...hge,visuals:I.MultiSelect(["solid"],I.objectToOptions(mge)),bumpFrequency:I.Numeric(1,{min:0,max:10,step:.1},xt.ShadingCategory)},Ylt={name:"isosurface",label:"Isosurface",description:"Displays a triangulated isosurface of volumetric data.",factory:function $lt(e,t){return Xn.createMulti("Isosurface",e,t,Xn.StateBuilder,mge)},getParams:function Wlt(e,t){const n=I.clone(gge);return n.isoValue=mt.createIsoValueParam(mt.IsoValue.relative(2),t.grid.stats),n},defaultValues:I.getDefaultValues(gge),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!mt.isEmpty(e)&&!mt.Segmentation.get(e)};function Xlt(e,t,n,r,i,o){return rq.apply(this,arguments)}function rq(){return rq=le(function*(e,t,n,r,i,o){const{dimension:{name:s},isoValue:a}=i,{space:l,data:c}=t.grid.cells,{min:u,max:d}=t.grid.stats,f=mt.IsoValue.toAbsolute(a,t.grid.stats).absoluteValue,p="color"in r.color?r.color.color(Gu,!1):st(16777215),[m,h,g]=st.toRgbNormalized(p),{width:y,height:v,x,y:_,z:w,x0:A,y0:M,z0:E,nx:D,ny:T,nz:F}=iq(t.grid,i),R=new Float32Array("x"===s?[x,0,0,x,_,0,x,0,w,x,_,w]:"y"===s?[0,_,0,x,_,0,0,_,w,x,_,w]:[0,0,w,0,_,w,x,0,w,x,_,w]),N=new Uint8Array(y*v*4),j=function Klt(e,t){const{space:n}=e.cells,{width:r,height:i,x0:o,y0:s,z0:a,nx:l,ny:c,nz:u}=iq(e,t),d=new Uint8Array(r*i*4);let f=0;for(let p=s;p<c;++p)for(let m=o;m<l;++m)for(let h=a;h<u;++h)FD(n.dataOffset(m,p,h),d,f),f+=4;return d}(t.grid,i);let W=0;for(let X=M;X<T;++X)for(let H=A;H<D;++H)for(let oe=E;oe<F;++oe){const te=l.get(c,H,X,oe),K=(te-u)/(d-u);N[W]=m*K*2*255,N[W+1]=h*K*2*255,N[W+2]=g*K*2*255,N[W+3]=te>=f?255:0,W+=4}const z={width:y,height:v,array:N,flipY:!0},$={width:y,height:v,array:j,flipY:!0};return w_(Ca.getGridToCartesianTransform(t.grid),R,0,4),Py.create(z,R,$,o)}),rq.apply(this,arguments)}function iq(e,t){const{dimension:{name:n,params:r}}=t,{space:i}=e.cells;let o,s,a,l,c,u=0,d=0,f=0,[p,m,h]=i.dimensions;return"x"===n?(a=r,l=m-1,c=h-1,o=h,s=m,u=a,p=u+1):"y"===n?(a=p-1,l=r,c=h-1,o=h,s=p,d=l,m=d+1):(a=p-1,l=m-1,c=r,o=p,s=m,f=c,h=f+1),{width:o,height:s,x:a,y:l,z:c,x0:u,y0:d,z0:f,nx:p,ny:m,nz:h}}function yge(e,t){const n=function Zlt(e,t){const{space:n}=e.cells,{width:r,height:i,x0:o,y0:s,z0:a,nx:l,ny:c,nz:u}=iq(e,t),d=new Uint32Array(r*i);let f=0;for(let p=s;p<c;++p)for(let m=o;m<l;++m)for(let h=a;h<u;++h)d[f]=n.dataOffset(m,p,h),f+=1;return d}(e.grid,t);return mt.Cell.Loci(e,rt.ofUnsortedArray(n))}function Qlt(e,t,n,r,i){const{objectId:o,groupId:s}=e;if(i===o){const a=mt.PickingGranularity.get(t);return"volume"===a?mt.Loci(t):"object"===a?yge(t,r):mt.Cell.Loci(t,Pe.ofSingleton(s))}return qr}function Jlt(e,t,n,r,i){return eF(e,t,void 0,i)}const oq={...Py.Params,quality:{...Py.Params.quality,isEssential:!1},dimension:I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:0,step:1}),y:I.Numeric(0,{min:0,max:0,step:1}),z:I.Numeric(0,{min:0,max:0,step:1})},{isEssential:!0}),isoValue:mt.IsoValueParam};function tct(e){return H_({defaultProps:I.getDefaultValues(oq),createGeometry:Xlt,createLocationIterator:t=>Vi(t.grid.cells.data.length,1,1,()=>Gu),getLoci:Qlt,eachLocation:Jlt,setUpdateState:(t,n,r,i,o,s)=>{t.createGeometry=r.dimension.name!==i.dimension.name||r.dimension.params!==i.dimension.params||!mt.IsoValue.areSame(r.isoValue,i.isoValue,n.grid.stats)||!Rd.areEqual(o.color,s.color)},geometryUtils:{...Py.Utils,createRenderableState:t=>{const n=Py.Utils.createRenderableState(t);return bge(n,t),n},updateRenderableState:bge}},e)}function bge(e,t){Py.Utils.updateRenderableState(e,t),e.opaque=!1,e.writeDepth=!0}const rct={name:"slice",label:"Slice",description:"Slice of volume rendered as image with interpolation.",factory:function nct(e,t){return vP("Slice",e,t,tct,yge)},getParams:function ect(e,t){const n=I.clone(oq),r=t.grid.cells.space.dimensions;return n.dimension=I.MappedStatic("x",{x:I.Numeric(0,{min:0,max:r[0]-1,step:1}),y:I.Numeric(0,{min:0,max:r[1]-1,step:1}),z:I.Numeric(0,{min:0,max:r[2]-1,step:1})},{isEssential:!0}),n.isoValue=mt.createIsoValueParam(mt.IsoValue.absolute(t.grid.stats.min),t.grid.stats),n},defaultValues:I.getDefaultValues(oq),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!mt.isEmpty(e)&&!mt.Segmentation.get(e)};function vge(e,t){const n=Gt();return Gt.add(n,e),Gt.transform(n,n,t),n}function xge(e){if("matrix"===e.transform.kind)return{unitToCartn:fe.mul(fe(),e.transform.matrix,fe.fromScaling(fe(),e.cells.space.dimensions)),cellDim:fe.getScaling(C(),e.transform.matrix)};const t=e.transform.fractionalBox,n=Gt.size(C(),t);return{unitToCartn:fe.mul3(fe(),e.transform.cell.fromFractional,fe.fromTranslation(fe(),t.min),fe.fromScaling(fe(),n)),cellDim:C.div(C(),e.transform.cell.size,e.cells.space.dimensions)}}function sct(e,t,n,r,i,o){return sq.apply(this,arguments)}function sq(){return sq=le(function*(e,t,n,r,i,o){const{webgl:a}=e;if(void 0===a)throw new Error("DirectVolumeVisual requires `webgl` in props");return a.isWebGL2?function oct(e,t,n,r){const i=n.grid.cells.space.dimensions;if(Math.max(...i)>t.max3dTextureSize/2)throw new Error("volume too large for direct-volume rendering");const o=function Xit(e){const{cells:{space:t,data:n},stats:{max:r,min:i}}=e.grid,[o,s,a]=t.dimensions,{dataOffset:l}=t,c=new Uint8Array(o*s*a*4),u={array:c,width:o,height:s,depth:a},d=r-i,f=C(),p=C(),m=o-1,h=s-1,g=a-1;let y=0;for(let v=0;v<a;++v)for(let x=0;x<s;++x)for(let _=0;_<o;++_){const w=l(_,x,v);QN(f,n[l(Math.max(0,_-1),x,v)],n[l(_,Math.max(0,x-1),v)],n[l(_,x,Math.max(0,v-1))]),QN(p,n[l(Math.min(m,_+1),x,v)],n[l(_,Math.min(h,x+1),v)],n[l(_,x,Math.min(g,v+1))]),tme(f,nme(f,f,p)),rme(f,JN(f,f,.5),.5),ime(JN(f,f,255),c,y),c[y+3]=Math.round((n[w]-i)/d*255),y+=4}return u}(n),s=Ca.getGridToCartesianTransform(n.grid),a=vge(i,s),l=r?r.gridTexture.ref.value:t.resources.texture("volume-uint8","rgba","ubyte","linear");l.load(o);const{unitToCartn:c,cellDim:u}=xge(n.grid);return Df.create(a,i,s,c,u,l,n.grid.stats,!1,n.grid.cells.space.axisOrderSlowToFast,r)}(0,a,t,o):function ict(e,t,n,r){const i=n.grid.cells.space.dimensions,{width:o,height:s}=W1(i);if(Math.max(o,s)>t.maxTextureSize/2)throw new Error("volume too large for direct-volume rendering");const a=ome(n,"normals"),l=Ca.getGridToCartesianTransform(n.grid),c=vge(i,l),u=r?r.gridTexture.ref.value:t.resources.texture("image-uint8","rgba","ubyte","linear");u.load(a);const{unitToCartn:d,cellDim:f}=xge(n.grid);return Df.create(c,i,l,d,f,u,n.grid.stats,!1,n.grid.cells.space.axisOrderSlowToFast,r)}(0,a,t,o)}),sq.apply(this,arguments)}function act(e,t){return mt.Loci(e)}function lct(e,t,n,r,i){const{objectId:o,groupId:s}=e;return i===o?mt.Cell.Loci(t,Pe.ofSingleton(s)):qr}function cct(e,t,n,r,i){return eF(e,t,void 0,i)}const aq={...Df.Params,quality:{...Df.Params.quality,isEssential:!1}};function dct(e){return H_({defaultProps:I.getDefaultValues(aq),createGeometry:sct,createLocationIterator:t=>Vi(t.grid.cells.data.length,1,1,()=>Gu),getLoci:lct,eachLocation:cct,setUpdateState:(t,n,r,i)=>{},geometryUtils:Df.Utils,dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}const pct={name:"direct-volume",label:"Direct Volume",description:"Direct rendering of volumetric data.",factory:function fct(e,t){return vP("Direct Volume",e,t,dct,act)},getParams:function uct(e,t){const n=I.clone(aq);return n.controlPoints.getVolume=()=>t,n},defaultValues:I.getDefaultValues(aq),defaultColorTheme:{name:"volume-value"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!mt.isEmpty(e)&&!mt.Segmentation.get(e)},hct={segments:I.Converted(e=>e.map(t=>`${t}`),e=>e.map(t=>parseInt(t)),I.MultiSelect(["0"],I.arrayToOptions(["0"]),{isEssential:!0}))},CP=1;function lq(e,t){if(e.grid.cells.data.length<Math.pow(10,3))return!1;const n=e.grid.cells.space.dimensions,{powerOfTwoSize:r}=W1(n,CP);return r<=t.maxTextureSize/2}const gct=fe();function _ge(e,t){const n=Ca.getGridToCartesianTransform(e),r=fe.fromTranslation(gct,t.min);return fe.mul(fe(),n,r)}function yct(e,t,n,r,i){return r.tryUseGpu&&i&&function mct(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.drawBuffers}(i)&&lq(t,i)?function wct(e){return H_({defaultProps:I.getDefaultValues(uq),createGeometry:Cct,createLocationIterator:(t,n)=>{const r=mt.Segment.Location(t,n);return Vi(t.grid.cells.data.length,1,1,()=>r)},getLoci:Sge,eachLocation:Cge,setUpdateState:(t,n,r,i)=>{},geometryUtils:iu.Utils,mustRecreate:(t,n,r)=>!n.tryUseGpu||!r||!lq(t.volume,r),dispose:t=>{t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy()}},e)}(e):function _ct(e){return H_({defaultProps:I.getDefaultValues(uq),createGeometry:xct,createLocationIterator:(t,n)=>{const r=mt.Segment.Location(t,n);return Vi(t.grid.cells.data.length,1,1,()=>r)},getLoci:Sge,eachLocation:Cge,setUpdateState:(t,n,r,i)=>{},geometryUtils:on.Utils,mustRecreate:(t,n,r)=>n.tryUseGpu&&!!r&&lq(t.volume,r)},e)}(e)}function bct(e,t){return mt.Segment.Loci(e,t.segments)}function Sge(e,t,n,r,i){const{objectId:o,groupId:s}=e;if(i===o){const a=mt.PickingGranularity.get(t);return"volume"===a?mt.Loci(t):"object"===a?mt.Segment.Loci(t,[n]):mt.Cell.Loci(t,Pe.ofSingleton(s))}return qr}function Cge(e,t,n,r,i){return eF(e,t,{segments:rt.ofSingleton(n)},i)}function xct(e,t,n,r,i,o){return cq.apply(this,arguments)}function cq(){return cq=le(function*(e,t,n,r,i,o){const s=mt.Segmentation.get(t);if(!s)throw new Error("missing volume segmentation");e.runtime.update({message:"Marching cubes..."});const a=Gt.clone(s.bounds[n]);Gt.expand(a,a,C.create(2,2,2));const c=function vct(e,t,n){const r=n.data,i=n.space.dataOffset,o=Gt.size(C(),t),[s,a,l]=o,c=s-1,u=a-1,d=l-1,[f,p,m]=t.min,[h,g,y]=t.max,v=[...n.space.axisOrderSlowToFast],x=mr.Space(o,v,Uint8Array),_=mr.create(x,x.create()),w=_.data,A=x.set;for(let M=0;M<l;++M)for(let E=0;E<a;++E)for(let D=0;D<s;++D){const T=e.includes(r[i(D+f,E+p,M+m)])?255:0,F=e.includes(r[i(Math.min(c+h,D+1+f),E+p,M+m)])?255:0,R=e.includes(r[i(Math.max(0,D-1+f),E+p,M+m)])?255:0,N=e.includes(r[i(D+f,Math.min(u+g,E+1+p),M+m)])?255:0,j=e.includes(r[i(D+f,Math.max(0,E-1+p),M+m)])?255:0,W=e.includes(r[i(D+f,E+p,Math.min(d+y,M+1+m))])?255:0,z=e.includes(r[i(D+f,E+p,Math.max(0,M-1+m))])?255:0;A(w,D,E,M,Math.round((T+T+F+R+N+j+W+z)/8))}return _}(Array.from(s.segments.get(n).values()),a,t.grid.cells),u=Sd(new Int32Array(c.data.length)),d=yield yA({isoLevel:128,scalarField:c,idField:mr.create(c.space,mr.Data1(u))},o).runAsChild(e.runtime),f=_ge(t.grid,a);return on.transform(d,f),e.webgl&&!e.webgl.isWebGL2?(on.uniformTriangleGroup(d,!1),O.updateIfChanged(d.varyingGroup,!1)):O.updateIfChanged(d.varyingGroup,!0),d.setBoundingSphere(mt.Segment.getBoundingSphere(t,[n])),d}),cq.apply(this,arguments)}const uq={...on.Params,...iu.Params,...hct,quality:{...on.Params.quality,isEssential:!1},tryUseGpu:I.Boolean(!0)},dq="segment-texture";function Cct(e,t,n,r,i,o){return fq.apply(this,arguments)}function fq(){return fq=le(function*(e,t,n,r,i,o){if(!e.webgl)throw new Error("webgl context required to create volume segment texture-mesh");if(t.grid.cells.data.length<=1)return iu.createEmpty(o);const{texture:s,gridDimension:a,gridTexDim:l,gridTexScale:c,transform:u}=function Sct(e,t,n){const r=mt.Segmentation.get(e);if(!r)throw new Error("missing volume segmentation");const{resources:i}=n,o=Gt.clone(r.bounds[t]);Gt.expand(o,o,C.create(2,2,2));const s=_ge(e.grid,o),a=Gt.size(C(),o),{width:l,height:c,powerOfTwoSize:u}=W1(a,CP),d=C.create(l,c,0),f=Ue.create(l/u,c/u);if(u>n.maxTextureSize/2)throw new Error("volume too large for gpu segment extraction");n.namedTextures[dq]||(n.namedTextures[dq]=i.texture("image-uint8","alpha","ubyte","linear"));const p=n.namedTextures[dq];p.define(u,u);const m=Array.from(r.segments.get(t).values());return p.load(function Kit(e,t,n,r=0){const i=e.grid.cells.data,o=Gt.size(C(),n),s=e.grid.cells.space.dataOffset,{width:a,height:l}=W1(o,r),u=new Uint8Array(a*l*1),d={array:u,width:a,height:l},[f,p,m]=o,h=f-1,g=p-1,y=m-1,v=f+r,x=p+r,[_,w,A]=n.min,[M,E,D]=n.max;for(let T=0;T<m;++T)for(let F=0;F<p;++F)for(let R=0;R<f;++R){const N=Math.floor(T*v%a/v),z=1*(Math.floor(T*v/a)*x*a+F*a+(N*v+R)),$=t.includes(i[s(R+_,F+w,T+A)])?255:0,V=t.includes(i[s(Math.min(h+M,R+1+_),F+w,T+A)])?255:0,X=t.includes(i[s(Math.max(0,R-1+_),F+w,T+A)])?255:0,H=t.includes(i[s(R+_,Math.min(g+E,F+1+w),T+A)])?255:0,oe=t.includes(i[s(R+_,Math.max(0,F-1+w),T+A)])?255:0,te=t.includes(i[s(R+_,F+w,Math.min(y+D,T+1+A))])?255:0,K=t.includes(i[s(R+_,F+w,Math.max(0,T-1+A))])?255:0;u[z]=Math.round(($+$+V+X+H+oe+te+K)/8)}return d}(e,m,o,CP),!0),a[0]+=CP,a[1]+=CP,{texture:p,transform:s,gridDimension:a,gridTexDim:d,gridTexScale:f}}(t,n,e.webgl),d=t.grid.cells.space.axisOrderSlowToFast,f=o?.doubleBuffer.get(),p=xF(e.webgl,s,a,l,c,u,.5,!1,!1,d,!0,f?.vertex,f?.group,f?.normal);return iu.create(p.vertexCount,t.grid.cells.data.length,p.vertexTexture,p.groupTexture,p.normalTexture,mt.Segment.getBoundingSphere(t,[n]),o)}),fq.apply(this,arguments)}function Act(e){return rt.ofUnsortedArray(e.segments)}const wge={segment:(e,t)=>vP("Segment mesh",e,t,yct,bct,Act)},Age={...uq,visuals:I.MultiSelect(["segment"],I.objectToOptions(wge)),bumpFrequency:I.Numeric(1,{min:0,max:10,step:.1},xt.ShadingCategory)},Tct={name:"segment",label:"Segment",description:"Displays a triangulated segment of volumetric data.",factory:function Ect(e,t){return Xn.createMulti("Segment",e,t,Xn.StateBuilder,wge)},getParams:function Ict(e,t){const n=I.clone(Age),r=mt.Segmentation.get(t);if(r){const i=Array.from(r.segments.keys());n.segments=I.Converted(o=>o.map(s=>`${s}`),o=>o.map(s=>parseInt(s)),I.MultiSelect(i.map(o=>`${o}`),I.arrayToOptions(i.map(o=>`${o}`)),{isEssential:!0}))}return n},defaultValues:I.getDefaultValues(Age),defaultColorTheme:{name:"volume-segment"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>!mt.isEmpty(e)&&!!mt.Segmentation.get(e)};class bA extends ume{constructor(){super(),Nu(bA.BuiltIn,(t,n)=>{if(t.name!==n)throw new Error(`Fix BuiltInVolumeRepresentations to have matching names. ${t.name} ${n}`);this.add(t)})}}function Ige(e,t,n,r){e.push({source:"em"===t?{name:"em",params:{isoValue:mt.IsoValue.absolute(r||0)}}:{name:"x-ray",params:{}},dataId:n})}!function(e){e.BuiltIn={isosurface:Ylt,slice:rct,"direct-volume":pct,segment:Tct}}(bA||(bA={}));const pq=Hu.build({display:{name:"Volume Streaming"},from:Se.Molecule.Structure,params(e,t){const n=function zat(e,t="x-ray"){if(!e)return t;const n=e.models[0];return Ui.is(n.sourceData)?Sn.hasEmMap(n)?"em":Sn.hasXrayMap(n)?"x-ray":Sn.isFromEm(n)?"em":Sn.isFromXray(n)?"x-ray":t:t}(e&&e.data),r=function Gat(e,t){if(!t||!t.models.length)return[];const n=t.models[0];switch(e){case"em":return function Vat(e){const t=[];if(!Ui.is(e.sourceData))return[e.entryId];const{db_id:n,db_name:r,content_type:i}=e.sourceData.data.db.pdbx_database_related;if(!r.isDefined)return[e.entryId];for(let o=0,s=r.rowCount;o<s;++o)"EMDB"===r.value(o).toUpperCase()&&"associated EM volume"===i.value(o)&&t.push(n.value(o));return t}(n);case"x-ray":return function Hat(e){return[e.entryId]}(n)}}(n,e&&e.data);return{method:I.Select(n,[["em","EM"],["x-ray","X-Ray"]]),entries:I.ObjectList({id:I.Text(r[0]||"")},({id:i})=>i,{defaultValue:r.map(i=>({id:i}))}),defaultView:I.Select("em"===n?"auto":"selection-box",fu.ViewTypeOptions),options:I.Group({serverUrl:I.Text(t.config.get(ei.VolumeStreaming.DefaultServer)||"https://ds.litemol.org"),behaviorRef:I.Text("",{isHidden:!0}),emContourProvider:I.Select("emdb",[["emdb","EMDB"],["pdbe","PDBe"]],{isHidden:!0}),channelParams:I.Value({},{isHidden:!0})})}},isApplicable:(e,t,n)=>{const r=n.config.get(ei.VolumeStreaming.CanStream);return r?r(e.data,n):1===e.data.models.length&&Sn.probablyHasDensityMap(e.data.models[0])}})(({ref:e,state:t,params:n},r)=>Ke.create("Volume Streaming",function(){var i=le(function*(o){const s=[];for(let f=0,p=n.entries.length;f<p;++f){const m=n.entries[f].id.toLowerCase();let h;if("em"===n.method){if(!m.toUpperCase().startsWith("EMD")){yield o.update("Getting EMDB info...");const g=yield $at(r,o,m);for(let y=0,v=g.length;y<v;++y){const x=g[y];let _;try{_=yield rge(n.options.emContourProvider,r,o,x)}catch(w){console.info(`Could not get map info for ${x}: ${w}`);continue}Ige(s,n.method,x,_||0)}continue}try{h=yield rge(n.options.emContourProvider,r,o,m)}catch(g){console.info(`Could not get map info for ${m}: ${g}`);continue}}Ige(s,n.method,m,h||0)}const a=t.build().to(e).applyOrUpdateTagged(fu.RootTag,kct,{serverUrl:n.options.serverUrl,entries:s});yield a.commit();const l=a.selector;if(!l.isOk)return;const c=t.tree.children.get(l.ref);c?.size>0&&(yield r.managers.structure.hierarchy.remove(c?.toArray()));const u=l.cell.obj,d=t.build().to(a.ref).apply(hq,I.getDefaultValues(fu.createParams({data:u.data,defaultView:n.defaultView,channelParams:n.options.channelParams})),{ref:n.options.behaviorRef?n.options.behaviorRef:void 0});"em"===n.method?d.apply(_F,{channel:"em"},{state:{isGhost:!0},tags:"em"}):(d.apply(_F,{channel:"2fo-fc"},{state:{isGhost:!0},tags:"2fo-fc"}),d.apply(_F,{channel:"fo-fc(+ve)"},{state:{isGhost:!0},tags:"fo-fc(+ve)"}),d.apply(_F,{channel:"fo-fc(-ve)"},{state:{isGhost:!0},tags:"fo-fc(-ve)"})),yield t.updateTree(d).runInContext(o)});return function(o){return i.apply(this,arguments)}}())),Dct=Hu.build({display:{name:"Boxify Volume Streaming",description:"Make the current box permanent."},from:fu,isApplicable:e=>"selection-box"===e.data.params.entry.params.view.name})(({a:e,ref:t,state:n},r)=>{const i=e.data.params;if("selection-box"!==i.entry.params.view.name)return;const o=Gt.create(C.clone(i.entry.params.view.params.bottomLeft),C.clone(i.entry.params.view.params.topRight)),s=i.entry.params.view.params.radius;Gt.expand(o,o,C.create(s,s,s));const a={...i,entry:{name:i.entry.name,params:{...i.entry.params,view:{name:"box",params:{bottomLeft:o.min,topRight:o.max}}}}};return n.updateTree(n.build().to(t).update(a))}),Pct={dataId:I.Text(""),source:I.MappedStatic("x-ray",{em:I.Group({isoValue:mt.createIsoValueParam(mt.IsoValue.relative(1))}),"x-ray":I.Group({})})},kct=nn.BuiltIn({name:"create-volume-streaming-info",display:{name:"Volume Streaming Info"},from:Se.Molecule.Structure,to:zG,params:e=>({serverUrl:I.Text("https://ds.litemol.org"),entries:I.ObjectList(Pct,({dataId:t})=>t,{defaultValue:[{dataId:"",source:{name:"x-ray",params:{}}}]})})})({apply:({a:e,params:t},n)=>Ke.create("",function(){var r=le(function*(i){const o=[];for(let a=0,l=t.entries.length;a<l;++a){const c=t.entries[a],u=c.dataId,d="em"===c.source.name?c.source.params.isoValue:mt.IsoValue.relative(1);yield i.update("Getting server header...");const f=yield n.fetch({url:mF(t.serverUrl,`${c.source.name}/${u.toLocaleLowerCase()}`),type:"json"}).runInContext(i);o.push({dataId:u,kind:c.source.name,header:f,emDefaultContourLevel:d})}return new zG({serverUrl:t.serverUrl,entries:o,structure:e.data},{label:"Volume Server",description:`${o.map(a=>a.dataId).join(", ")}`})});return function(i){return r.apply(this,arguments)}}())}),hq=nn.BuiltIn({name:"create-volume-streaming-behavior",display:{name:"Volume Streaming Behavior"},from:zG,to:fu,params:e=>fu.createParams({data:e&&e.data})})({canAutoUpdate:({oldParams:e,newParams:t})=>e.entry.params.view===t.entry.params.view||"selection-box"===t.entry.params.view.name||"camera-target"===t.entry.params.view.name||"off"===t.entry.params.view.name,apply:({a:e,params:t},n)=>Ke.create("Volume streaming",function(){var r=le(function*(i){const o=new fu.Behavior(n,e.data);return yield o.update(t),new fu(o,{label:"Volume Streaming",description:o.getDescription()})});return function(i){return r.apply(this,arguments)}}()),update:({b:t,oldParams:n,newParams:r})=>Ke.create("Update Volume Streaming",function(){var i=le(function*(o){if(n.entry.name!==r.entry.name&&"em"in r.entry.params.channels){const{emDefaultContourLevel:a}=t.data.infoMap.get(r.entry.name);a&&(r.entry.params.channels.em.isoValue=a)}const s=(yield t.data.update(r))?yt.UpdateResult.Updated:yt.UpdateResult.Unchanged;return t.description=t.data.getDescription(),s});return function(o){return i.apply(this,arguments)}}())}),_F=nn.BuiltIn({name:"create-volume-streaming-visual",display:{name:"Volume Streaming Visual"},from:fu,to:Se.Volume.Representation3D,params:{channel:I.Select("em",fu.ChannelTypeOptions,{isHidden:!0})}})({apply:({a:e,params:t,spine:n},r)=>Ke.create("Volume Representation",function(){var i=le(function*(o){var s,a;const l=e.data.channels[t.channel];if(!l)return vo.Null;const c=Ege(e.data,t.channel),u=bA.BuiltIn.isosurface,d=c.type.params||{},f=u.factory({webgl:null===(s=r.canvas3d)||void 0===s?void 0:s.webgl,...r.representation.volume.themes},u.getParams);f.setTheme(Ia.create(r.representation.volume.themes,{volume:l.data},c));const p=null===(a=n.getAncestorOfType(Se.Molecule.Structure))||void 0===a?void 0:a.data,m=0===p?.models.length?void 0:s_.get(p?.models[0]);return yield f.createOrUpdate(d,l.data).runInContext(o),m&&f.setState({transform:m}),new Se.Volume.Representation3D({repr:f,sourceData:l.data},{label:`${Math.round(100*l.isoValue.relativeValue)/100} \u03c3 [${t.channel}]`})});return function(o){return i.apply(this,arguments)}}()),update:({a:e,b:t,newParams:n},i)=>Ke.create("Volume Representation",function(){var o=le(function*(s){const a=e.data.channels[n.channel];if(!a)return yt.UpdateResult.Unchanged;const l=t.data.repr.state.visible,c=Ege(e.data,n.channel),u={...t.data.repr.props,...c.type.params};return t.data.repr.setTheme(Ia.create(i.representation.volume.themes,{volume:a.data},c)),yield t.data.repr.createOrUpdate(u,a.data).runInContext(s),t.data.repr.setState({visible:l}),t.data.sourceData=a.data,yt.UpdateResult.Updated});return function(s){return o.apply(this,arguments)}}())});function Ege(e,t){const n=e.channels[t];return Eg.getDefaultParamsStatic(e.plugin,"isosurface",{isoValue:n.isoValue,alpha:n.opacity,visuals:n.wireframe?["wireframe"]:["solid"]},"uniform",{value:n.color})}var Uy;!function(e){e.create=function t(r){return r},e.getDuration=function n(r,i){var o,s;if(i.customDurationMs)return i.customDurationMs;const a=null===(s=(o=i.definition).getDuration)||void 0===s?void 0:s.call(o,i.params,r);return"fixed"===a?.kind?a.durationMs:void 0}}(Uy||(Uy={}));const Mct=Uy.create({name:"built-in.animate-assembly-unwind",display:{name:"Unwind Assembly"},isExportable:!0,params:e=>{const t=[["all","All"]],n=e.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Structure));for(const r of n)t.push([r.transform.ref,r.obj.data.models[0].label]);return{durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100}),playOnce:I.Boolean(!1),target:I.Select(t[0][0],t)}},canApply:e=>({canApply:e.state.data.select(Qn.Generators.ofType(Se.Molecule.Structure.Representation3D,vr.RootRef)).length>0}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),initialState:()=>({t:0}),setup(e,t,n){const r=n.state.data,o=r.select(Qn.Generators.ofType(Se.Molecule.Structure.Representation3D,e.target&&"all"!==e.target?e.target:vr.RootRef)),s=r.build();let a=!1;for(const l of o)r.select(Qn.Generators.ofTransformer(at.Representation.UnwindStructureAssemblyRepresentation3D,l.transform.ref)).length>0||(a=!0,s.to(l).apply(at.Representation.UnwindStructureAssemblyRepresentation3D,{t:0},{tags:"animate-assembly-unwind"}));if(a)return s.commit({doNotUpdateCurrent:!0})},teardown(e,t,n){const r=n.state.data,i=r.select(Qn.Generators.ofType(Se.Molecule.Structure.Representation3DState).withTag("animate-assembly-unwind"));if(0===i.length)return;const o=r.build();for(const s of i)o.delete(s.transform.ref);return o.commit()},apply:(e,t,n)=>le(function*(){const r=n.plugin.state.data,o=r.select(Qn.Generators.ofTransformer(at.Representation.UnwindStructureAssemblyRepresentation3D,n.params.target&&"all"!==n.params.target?n.params.target:vr.RootRef));if(0===o.length)return{kind:"finished"};const s=r.build();let l=e.t+(t.current-t.lastApplied)/n.params.durationInMs,c=!1;n.params.playOnce&&l>=1?(c=!0,l=1):l%=1;for(const u of o)s.to(u).update({t:l});return yield jt.State.Update(n.plugin,{state:r,tree:s,options:{doNotLogTiming:!0}}),c?{kind:"finished"}:{kind:"next",state:{t:l}}})()}),SF=C(),Tge=C(),Dge=Ai(),Rct=Uy.create({name:"built-in.animate-camera-spin",display:{name:"Camera Spin",description:"Spin the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:I.Numeric(4e3,{min:100,max:2e4,step:100}),speed:I.Numeric(1,{min:1,max:10,step:1},{description:"How many times to spin in the specified duration."}),direction:I.Select("cw",[["cw","Clockwise"],["ccw","Counter Clockwise"]],{cycle:!0})}),initialState:(e,t)=>{var n;return{snapshot:null===(n=t.canvas3d)||void 0===n?void 0:n.camera.getSnapshot()}},getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,n)=>{var r;null===(r=n.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:(e,t,n)=>le(function*(){var r,i;if(0===t.current)return{kind:"next",state:e};const o=e.snapshot;if(o.radiusMax<1e-4)return{kind:"finished"};const s=t.animation?(null===(r=t.animation)||void 0===r?void 0:r.currentFrame)/(t.animation.frameCount+1):al(t.current/n.params.durationInMs,0,1),a=2*Math.PI*s*n.params.speed*("ccw"===n.params.direction?-1:1);C.sub(SF,o.position,o.target),C.normalize(Tge,o.up),Ai.setAxisAngle(Dge,Tge,a),C.transformQuat(SF,SF,Dge);const l=C.add(C(),o.target,SF);return null===(i=n.plugin.canvas3d)||void 0===i||i.requestCameraReset({snapshot:{...o,position:l},durationMs:0}),s>=.99999?{kind:"finished"}:{kind:"next",state:e}})()}),Nct=Uy.create({name:"built-in.animate-model-index",display:{name:"Animate Trajectory"},isExportable:!0,params:()=>({mode:I.MappedStatic("loop",{palindrome:I.Group({}),loop:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])}),once:I.Group({direction:I.Select("forward",[["forward","Forward"],["backward","Backward"]])},{isFlat:!0})},{options:[["palindrome","Palindrome"],["loop","Loop"],["once","Once"]]}),duration:I.MappedStatic("fixed",{fixed:I.Group({durationInS:I.Numeric(5,{min:1,max:120,step:.1},{description:"Duration in seconds"})},{isFlat:!0}),computed:I.Group({targetFps:I.Numeric(30,{min:5,max:250,step:1},{label:"Target FPS"})},{isFlat:!0}),sequential:I.Group({maxFps:I.Numeric(30,{min:5,max:60,step:1})},{isFlat:!0})})}),canApply(e){const t=e.state.data,n=t.select(Qn.Generators.ofTransformer(at.Model.ModelFromTrajectory));for(const r of n){const i=Qn.findAncestorOfType(t.tree,t.cells,r.transform.ref,Se.Molecule.Trajectory);if(i&&i.obj&&i.obj.data.frameCount>1)return{canApply:!0}}return{canApply:!1,reason:"No trajectory to animate"}},getDuration:(e,t)=>{var n;if("fixed"===(null===(n=e.duration)||void 0===n?void 0:n.name))return{kind:"fixed",durationMs:1e3*e.duration.params.durationInS};if("computed"===e.duration.name){const r=t.state.data,i=r.select(Qn.Generators.ofTransformer(at.Model.ModelFromTrajectory));let o=0;for(const s of i){const a=Qn.findAncestorOfType(r.tree,r.cells,s.transform.ref,Se.Molecule.Trajectory);a&&a.obj&&(o=Math.max(Math.ceil(1e3*a.obj.data.frameCount/e.duration.params.targetFps),o))}return{kind:"fixed",durationMs:o}}return{kind:"unknown"}},initialState:()=>({}),apply:(e,t,n)=>le(function*(){if("sequential"===n.params.duration.name&&t.current>0&&t.current-t.lastApplied<1e3/n.params.duration.params.maxFps)return{kind:"skip"};const r=n.plugin.state.data,i=r.select(Qn.Generators.ofTransformer(at.Model.ModelFromTrajectory));if(0===i.length)return{kind:"finished"};const o=r.build(),s=n.params,a=e.palindromeDirections||{};let l=!1,c=!0;for(const u of i){const d=Qn.findAncestorOfType(r.tree,r.cells,u.transform.ref,Se.Molecule.Trajectory);if(!d||!d.obj)continue;const f=d.obj;f.data.frameCount<=1||o.to(u).update(p=>{const m=f.data.frameCount;if(1===m)return p;if(c=!1,"sequential"===s.duration.name){let h=1;if("once"===s.mode.name){if(h="backward"===s.mode.params.direction?-1:1,-1===h&&0===p.modelIndex||1===h&&p.modelIndex===m-1)return l=!0,p}else"palindrome"===s.mode.name&&(h=0===p.modelIndex?1:p.modelIndex===m-1?-1:a[u.transform.ref]||1);a[u.transform.ref]=h;let g=(p.modelIndex+h)%m;return g<0&&(g+=m),l=l||-1===h&&0===g||1===h&&g===m-1,{modelIndex:g}}{const h="fixed"===s.duration.name?1e3*s.duration.params.durationInS:Math.ceil(1e3*f.data.frameCount/s.duration.params.targetFps);if("once"===s.mode.name&&t.current>=h)return l=!0,{modelIndex:f.data.frameCount-1};let g=t.current%h/h;return"loop"===s.mode.name&&"backward"===s.mode.params.direction&&(g=1-g),"palindrome"===s.mode.name&&(g*=2,g>1&&(g=2-g)),{modelIndex:Math.min(Math.floor(f.data.frameCount*g),f.data.frameCount-1)}}})}return c||(yield jt.State.Update(n.plugin,{state:r,tree:o,options:{doNotLogTiming:!0}})),c||"once"===s.mode.name&&l?{kind:"finished"}:"palindrome"===s.mode.name?{kind:"next",state:{palindromeDirections:a}}:{kind:"next",state:{}}})()});function Pge(e,t){return mq.apply(this,arguments)}function mq(){return mq=le(function*(e,t,n=!1){var r;t.snapshot.data&&(yield e.runTask(e.state.data.setSnapshot(t.snapshot.data))),t.snapshot.camera&&(null===(r=e.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t.snapshot.camera.current,durationMs:n||"instant"===t.snapshot.camera.transitionStyle?0:t.snapshot.camera.transitionDurationInMs}))}),mq.apply(this,arguments)}const Fct=Uy.create({name:"built-in.animate-state-snapshots",display:{name:"State Snapshots"},isExportable:!0,params:()=>({}),canApply(e){const t=e.managers.snapshot.state.entries;return t.size<2?{canApply:!1,reason:"At least 2 states required."}:t.some(n=>!!n?.snapshot.startAnimation)?{canApply:!1,reason:"Nested animations not supported."}:{canApply:e.managers.snapshot.state.entries.size>1}},setup(e,t,n){const r=n.managers.snapshot.state.entries.get(0);Pge(n,r,!0)},getDuration:(e,t)=>({kind:"fixed",durationMs:t.managers.snapshot.state.entries.toArray().reduce((n,r)=>{var i;return n+(null!==(i=r.snapshot.durationInMs)&&void 0!==i?i:0)},0)}),initialState:(e,t)=>{const n=t.managers.snapshot.state.entries.toArray();return{totalDuration:n.reduce((r,i)=>{var o;return r+(null!==(o=i.snapshot.durationInMs)&&void 0!==o?o:0)},0),snapshots:n,currentIndex:0}},apply:(e,t,n)=>le(function*(){var r;if(t.current>=e.totalDuration)return{kind:"finished"};let i=0,o=0;for(const s of e.snapshots){if(i+=null!==(r=s.snapshot.durationInMs)&&void 0!==r?r:0,t.current<i)break;o++}return o>=e.snapshots.length?{kind:"finished"}:o===e.currentIndex?{kind:"skip"}:(Pge(n.plugin,e.snapshots[o]),{kind:"next",state:{...e,currentIndex:o}})})()});class wP{constructor(){this.subs=void 0}subscribe(t,n){typeof this.subs>"u"&&(this.subs=[]);let r=t.subscribe(n);return this.subs.push(r),{unsubscribe:()=>{r&&this.subs&&$x(this.subs,r)&&(r.unsubscribe(),r=void 0)}}}get ev(){return this._ev||(this._ev=uy.create())}dispose(){if(this._ev&&this._ev.dispose(),this.subs){for(const t of this.subs)t.unsubscribe();this.subs=void 0}}}class zy extends wP{updateState(...t){const n=this.state,r=function doe(e,t){let n=e;for(let r=0;r<t.length;r++)if(t[r]&&(n=WFe(e,t[r]),n!==e)){for(let i=r+1;i<t.length;i++)n=Object.assign(n,t[i]);break}return n}(n,t);return r!==n&&(this._state=r,!0)}get state(){return this._state}constructor(t){super(),this._state=t}}var Oct=new Date(typeof __MOLSTAR_DEBUG_TIMESTAMP__<"u"?__MOLSTAR_DEBUG_TIMESTAMP__:1708343741030);function yq(e,t,n){return bq.apply(this,arguments)}function bq(){return bq=le(function*(e,t,n){return new Promise((r,i)=>{const o=s=>{s?r(s):i("no blob returned")};HTMLCanvasElement.prototype.toBlob?e.toBlob(o,t,n):function jct(e,t,n,r){const i=atob(e.toDataURL(n,r).split(",")[1]),o=i.length,s=o>>2,a=new Uint8Array(o),l=new Uint32Array(a.buffer,0,s);let c=0;for(let d=0;d<s;++d)l[d]=i.charCodeAt(c++)|i.charCodeAt(c++)<<8|i.charCodeAt(c++)<<16|i.charCodeAt(c++)<<24;let u=3&o;for(;u--;)a[c]=i.charCodeAt(c++);t(new Blob([a],{type:n||"image/png"}))}(e,o,t,n)})}),bq.apply(this,arguments)}let vA=(()=>{class e extends zy{getIndex(n){return this.state.entries.indexOf(n)}getEntry(n){if(n)return this.entryMap.get(n)}remove(n){const r=this.entryMap.get(n);r&&(r?.image&&this.plugin.managers.asset.delete(r.image),this.entryMap.delete(n),this.updateState({current:this.state.current===n?void 0:this.state.current,entries:this.state.entries.delete(this.getIndex(r))}),this.events.changed.next(void 0))}add(n){this.entryMap.set(n.snapshot.id,n),this.updateState({current:n.snapshot.id,entries:this.state.entries.push(n)}),this.events.changed.next(void 0)}replace(n,r,i){var o,s,a;const l=this.getEntry(n);if(!l)return;this.defaultSnapshotId=void 0,l?.image&&this.plugin.managers.asset.delete(l.image);const c=this.getIndex(l),u=e.Entry(r,{key:null!==(o=i?.key)&&void 0!==o?o:l.key,name:null!==(s=i?.name)&&void 0!==s?s:l.name,description:null!==(a=i?.description)&&void 0!==a?a:l.description,image:i?.image});this.entryMap.set(r.id,u),this.updateState({current:u.snapshot.id,entries:this.state.entries.set(c,u)}),this.events.changed.next(void 0)}move(n,r){const i=this.state.entries.size;if(i<2)return;const o=this.getEntry(n);if(!o)return;const s=this.getIndex(o);let a=(s+r)%i;a<0&&(a+=i);const l=this.state.entries.get(a),c=this.state.entries.asMutable();c.set(a,o),c.set(s,l),this.updateState({current:o.snapshot.id,entries:c.asImmutable()}),this.events.changed.next(void 0)}update(n,r){var i,o,s;const a=this.getIndex(n);if(a<0)return;const l=this.state.entries.set(a,{...n,key:(null===(i=r.key)||void 0===i?void 0:i.trim())||void 0,name:(null===(o=r.name)||void 0===o?void 0:o.trim())||void 0,description:(null===(s=r.description)||void 0===s?void 0:s.trim())||void 0});this.updateState({entries:l}),this.entryMap.set(n.snapshot.id,this.state.entries.get(a)),this.events.changed.next(void 0)}clear(){0!==this.state.entries.size&&(this.entryMap.forEach(n=>{n?.image&&this.plugin.managers.asset.delete(n.image)}),this.entryMap.clear(),this.updateState({current:void 0,entries:cy()}),this.events.changed.next(void 0))}applyKey(n){const r=this.state.entries.find(i=>i.key===n);r&&(this.updateState({current:r.snapshot.id}),this.events.changed.next(void 0),this.plugin.state.setSnapshot(r.snapshot))}setCurrent(n){const r=this.getEntry(n);return r&&(this.updateState({current:n}),this.events.changed.next(void 0)),r&&r.snapshot}getNextId(n,r){const i=this.state.entries.size;if(!n){if(0===i)return;return this.state.entries.get(-1===r?i-1:0).snapshot.id}const o=this.getEntry(n);if(!o)return;let s=this.getIndex(o);return s<0?void 0:(s=(s+r)%i,s<0&&(s+=i),this.state.entries.get(s).snapshot.id)}setStateSnapshot(n){var r=this;return le(function*(){r.clear();const i=cy().asMutable();for(const l of n.entries)r.entryMap.set(l.snapshot.id,l),i.push(l);const o=n.current?n.current:n.entries.length>0?n.entries[0].snapshot.id:void 0;if(r.updateState({current:o,entries:i.asImmutable(),isPlaying:!1,nextSnapshotDelayInMs:n.playback?n.playback.nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),r.events.changed.next(void 0),!o)return;const s=r.getEntry(o),a=s&&s.snapshot;return a?(yield r.plugin.state.setSnapshot(a),n.playback&&n.playback.isPlaying&&r.play(!0),a):void 0})()}syncCurrent(n){var r=this;return le(function*(){var i,o;const s=0===r.state.entries.size,a=1===r.state.entries.size&&r.state.current&&r.state.current===r.defaultSnapshotId;if(!s&&!a)return;const l=r.plugin.state.getSnapshot(n?.params),c=(null!==(o=null===(i=n?.params)||void 0===i?void 0:i.image)&&void 0!==o?o:r.plugin.state.snapshotParams.value.image)?yield e.getCanvasImageAsset(r.plugin,`${l.id}-image.png`):void 0;if(s)r.add(e.Entry(l,{name:n?.name,description:n?.description,image:c}));else if(a){const u=r.getEntry(r.state.current);u?.image&&r.plugin.managers.asset.delete(u.image),r.replace(r.state.current,l,{image:c})}r.defaultSnapshotId=l.id})()}getStateSnapshot(n){var r=this;return le(function*(){return yield r.syncCurrent(n),{timestamp:+new Date,version:"4.0.1",name:n&&n.name,description:n&&n.description,current:r.state.current,playback:{isPlaying:!(!n||!n.playOnLoad),nextSnapshotDelayInMs:r.state.nextSnapshotDelayInMs},entries:r.state.entries.valueSeq().toArray()}})()}serialize(n){var r=this;return le(function*(){const i=JSON.stringify(yield r.getStateSnapshot({params:n?.params}),null,2);if(!n?.type||"json"===n.type||"molj"===n.type)return new Blob([i],{type:"application/json;charset=utf-8"});{const o=new Uint8Array(o5(i));vw(o,0,i);const s={"state.json":o},a=[];for(const{asset:c,file:u}of r.plugin.managers.asset.assets)a.push([c.id,c]),s[`assets/${c.id}`]=new Uint8Array(yield u.arrayBuffer());if(a.length>0){const c=JSON.stringify(a,null,2),u=new Uint8Array(o5(c));vw(u,0,c),s["assets.json"]=u}const l=yield r.plugin.runTask(function Oze(e,t=!1){return Ke.create("Zip",n=>function Bze(e,t){return i7.apply(this,arguments)}(n,e,t))}(s));return new Blob([l],{type:"application/zip"})}})()}open(n){var r=this;return le(function*(){try{const i=n.name.toLowerCase();if(i.endsWith("json")||i.endsWith("molj")){const o=yield r.plugin.runTask(ry(n,"string")),s=JSON.parse(o);e.isStateSnapshot(s)?yield r.setStateSnapshot(s):e.isStateSnapshot(s.data)?yield r.setStateSnapshot(s.data):yield r.plugin.state.setSnapshot(s)}else{const o=yield r.plugin.runTask(ry(n,"zip")),s=Object.create(null);Nu(o,(u,d)=>{if("state.json"===d||"assets.json"===d)return;const f=d.substring(d.indexOf("/")+1);s[f]=u});const a=new File([o["state.json"]],"state.json"),l=yield r.plugin.runTask(ry(a,"string"));if(o["assets.json"]){const u=new File([o["assets.json"]],"assets.json"),d=JSON.parse(yield r.plugin.runTask(ry(u,"string")));for(const[f,p]of d)r.plugin.managers.asset.set(p,new File([s[f]],p.name))}const c=JSON.parse(l);yield r.setStateSnapshot(c)}r.events.opened.next(void 0)}catch(i){console.error(i),r.plugin.log.error("Error reading state")}})()}play(n=!1){if(this.updateState({isPlaying:!0}),n){const r=this.getEntry(this.state.current);if(!r)return void this.next();this.events.changed.next(void 0);const i=r.snapshot;this.timeoutHandle=setTimeout(this.next,typeof i.durationInMs<"u"?i.durationInMs:this.state.nextSnapshotDelayInMs)}else this.next()}stop(){this.updateState({isPlaying:!1}),typeof this.timeoutHandle<"u"&&clearTimeout(this.timeoutHandle),this.timeoutHandle=void 0,this.events.changed.next(void 0)}togglePlay(){this.state.isPlaying?(this.stop(),this.plugin.managers.animation.stop()):this.play()}dispose(){super.dispose(),this.entryMap.clear()}constructor(n){var r;super({current:void 0,entries:cy(),isPlaying:!1,nextSnapshotDelayInMs:e.DefaultNextSnapshotDelayInMs}),r=this,this.plugin=n,this.entryMap=new Map,this.defaultSnapshotId=void 0,this.events={changed:this.ev(),opened:this.ev()},this.timeoutHandle=void 0,this.next=le(function*(){r.timeoutHandle=void 0;const i=r.getNextId(r.state.current,1);if(!i||i===r.state.current)return void r.stop();const o=r.setCurrent(i);yield r.plugin.state.setSnapshot(o),r.state.isPlaying&&(r.timeoutHandle=setTimeout(r.next,typeof o.durationInMs<"u"?o.durationInMs:r.state.nextSnapshotDelayInMs))})}}return e.DefaultNextSnapshotDelayInMs=1500,e})();function kge(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}function Mge(e,t="download"){if(e)if("download"in HTMLAnchorElement.prototype){const n=document.createElement("a");n.download=t,n.rel="noopener","string"==typeof e?(n.href=e,kge(n)):(n.href=URL.createObjectURL(e),setTimeout(()=>URL.revokeObjectURL(n.href),4e4),setTimeout(()=>kge(n)))}else if(typeof navigator<"u"&&navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(e,t);else{const n=window.navigator.userAgent,r=/Safari/i.test(n),i=/CriOS\/[\d]+/.test(n),o=s=>{!function zct(e){window.open(e,"_blank")||(window.location.href=e)}(i?s:s.replace(/^data:[^;]*;/,"data:attachment/file;"))};if((r||i)&&FileReader)if(e instanceof Blob){const s=new FileReader;s.onloadend=()=>o(s.result),s.readAsDataURL(e)}else o(e);else{const s=URL.createObjectURL("string"==typeof e?new Blob([e]):e);location.href=s,setTimeout(()=>URL.revokeObjectURL(s),4e4)}}}function Vct(e){Rge(e),Nge(e),Fge(e),Oge(e),Bge(e),Lge(e),jge(e),Uge(e),zge(e),Vge(e)}function Rge(e){e.state.events.object.created.subscribe(t=>{Se.isBehavior(t.obj)&&t.obj.data.register(t.ref)}),e.state.events.object.removed.subscribe(t=>{var n,r,i,o;Se.isBehavior(t.obj)&&(null===(r=(n=t.obj.data).unregister)||void 0===r||r.call(n),null===(o=(i=t.obj.data).dispose)||void 0===o||o.call(i))}),e.state.events.object.updated.subscribe(t=>{var n,r,i,o;"recreate"===t.action&&(t.oldObj&&Se.isBehavior(t.oldObj)&&(null===(r=(n=t.oldObj.data).unregister)||void 0===r||r.call(n),null===(o=(i=t.oldObj.data).dispose)||void 0===o||o.call(i)),t.obj&&Se.isBehavior(t.obj)&&t.obj.data.register(t.ref))})}function Nge(e){jt.State.SetCurrentObject.subscribe(e,({state:t,ref:n})=>t.setCurrent(n))}function Fge(e){jt.State.Update.subscribe(e,({state:t,tree:n,options:r})=>e.runTask(t.updateTree(n,r)))}function Oge(e){jt.State.ApplyAction.subscribe(e,({state:t,action:n,ref:r})=>e.runTask(t.applyAction(n.action,n.params,r)))}function Bge(e){function t(n,r){const i=n.build().delete(r);return e.runTask(n.updateTree(i))}jt.State.RemoveObject.subscribe(e,({state:n,ref:r,removeParentGhosts:i})=>{if(!i)return t(n,r);{const o=n.tree;let s=o.transforms.get(r);if(s.parent===r)return t(n,r);for(;;){const a=o.children.get(s.parent);if(s.parent===s.ref||a.size>1)return t(n,s.ref);const l=o.transforms.get(s.parent);if(!l.state.isGhost)return t(n,s.ref);s=l}}})}function Lge(e){jt.State.ToggleExpanded.subscribe(e,({state:t,ref:n})=>t.updateCellState(n,({isCollapsed:r})=>({isCollapsed:!r})))}function jge(e){jt.State.ToggleVisibility.subscribe(e,({state:t,ref:n})=>G_(t,n,!t.cells.get(n).state.isHidden))}function G_(e,t,n){la.doPreOrder(e.tree,e.transforms.get(t),{state:e,value:n},Hct)}function Hct(e,t,n){n.state.updateCellState(e.ref,{isHidden:n.value})}function Uge(e){jt.Interactivity.Object.Highlight.subscribe(e,({state:t,ref:n})=>{if(!e.canvas3d||e.isBusy)return;e.managers.interactivity.lociHighlights.clearHighlights();const r="string"==typeof n?[n]:n;for(const i of r){const o=t.cells.get(i);if(o)if(Se.Molecule.Structure.is(o.obj))e.managers.interactivity.lociHighlights.highlight({loci:Xe.Loci(o.obj.data)},!1);else if(o&&Se.isRepresentation3D(o.obj)){const{repr:s}=o.obj.data;for(const a of s.getAllLoci())e.managers.interactivity.lociHighlights.highlight({loci:a,repr:s},!1)}else if(Se.Molecule.Structure.Selections.is(o.obj))for(const s of o.obj.data)e.managers.interactivity.lociHighlights.highlight({loci:s.loci},!1)}})}function zge(e){jt.Interactivity.ClearHighlights.subscribe(e,()=>{e.managers.interactivity.lociHighlights.clearHighlights()})}function Vge(e){e.config.set(ei.State.CurrentServer,e.config.get(ei.State.DefaultServer)),jt.State.Snapshots.Clear.subscribe(e,()=>{e.managers.snapshot.clear()}),jt.State.Snapshots.Remove.subscribe(e,({id:t})=>{e.managers.snapshot.remove(t)}),jt.State.Snapshots.Add.subscribe(e,function(){var t=le(function*({key:n,name:r,description:i,params:o}){var s;const a=e.state.getSnapshot(o),l=(null!==(s=o?.image)&&void 0!==s?s:e.state.snapshotParams.value.image)?yield vA.getCanvasImageAsset(e,`${a.id}-image.png`):void 0,c=vA.Entry(a,{key:n,name:r,description:i,image:l});e.managers.snapshot.add(c)});return function(n){return t.apply(this,arguments)}}()),jt.State.Snapshots.Replace.subscribe(e,function(){var t=le(function*({id:n,params:r}){var i;const o=e.state.getSnapshot(r),s=(null!==(i=r?.image)&&void 0!==i?i:e.state.snapshotParams.value.image)?yield vA.getCanvasImageAsset(e,`${o.id}-image.png`):void 0;e.managers.snapshot.replace(n,e.state.getSnapshot(r),{image:s})});return function(n){return t.apply(this,arguments)}}()),jt.State.Snapshots.Move.subscribe(e,({id:t,dir:n})=>{e.managers.snapshot.move(t,n)}),jt.State.Snapshots.Apply.subscribe(e,({id:t})=>{const n=e.managers.snapshot.setCurrent(t);if(n)return e.state.setSnapshot(n)}),jt.State.Snapshots.Upload.subscribe(e,function(){var t=le(function*({name:n,description:r,playOnLoad:i,serverUrl:o}){return fetch(mF(o,`set?name=${encodeURIComponent(n||"")}&description=${encodeURIComponent(r||"")}`),{method:"POST",mode:"cors",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(yield e.managers.snapshot.getStateSnapshot({name:n,description:r,playOnLoad:i}))})});return function(n){return t.apply(this,arguments)}}()),jt.State.Snapshots.Fetch.subscribe(e,function(){var t=le(function*({url:n}){const r=yield e.runTask(e.fetch({url:n,type:"json"}));yield e.managers.snapshot.setStateSnapshot(r.data)});return function(n){return t.apply(this,arguments)}}()),jt.State.Snapshots.DownloadToFile.subscribe(e,function(){var t=le(function*({name:n,type:r,params:i}){const o=`mol-star_state_${n||function Uct(){const e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds()}()}.${"json"===r?"molj":"molx"}`;Mge(yield e.managers.snapshot.serialize({type:r,params:i}),`${o}`)});return function(n){return t.apply(this,arguments)}}()),jt.State.Snapshots.OpenFile.subscribe(e,({file:t})=>e.managers.snapshot.open(t)),jt.State.Snapshots.OpenUrl.subscribe(e,function(){var t=le(function*({url:n,type:r}){const i=yield e.runTask(e.fetch({url:n,type:"binary"}));return e.managers.snapshot.open(new File([i],`state.${r}`))});return function(n){return t.apply(this,arguments)}}())}function Gct(e){Hge(e),Gge(e),qge(e)}function Hge(e){const t=e.state.data.events;t.object.created.subscribe(n=>{var r;Se.isRepresentation3D(n.obj)&&(vq(n.state.cells.get(n.ref),n.obj.data.repr),n.obj.data.repr.setState({syncManually:!0}),null===(r=e.canvas3d)||void 0===r||r.add(n.obj.data.repr))}),t.object.updated.subscribe(n=>{var r,i;n.oldObj&&Se.isRepresentation3D(n.oldObj)&&(null===(r=e.canvas3d)||void 0===r||r.remove(n.oldObj.data.repr),n.oldObj.data.repr.destroy()),Se.isRepresentation3D(n.obj)&&(vq(n.state.cells.get(n.ref),n.obj.data.repr),"recreate"===n.action&&n.obj.data.repr.setState({syncManually:!0}),null===(i=e.canvas3d)||void 0===i||i.add(n.obj.data.repr))}),t.object.removed.subscribe(n=>{var r;Se.isRepresentation3D(n.obj)&&(null===(r=e.canvas3d)||void 0===r||r.remove(n.obj.data.repr),n.obj.data.repr.destroy())})}function Gge(e){const t=e.state.data.events;t.object.created.subscribe(n=>{var r;if(!Se.Molecule.Structure.Representation3DState.is(n.obj))return;const i=n.obj.data;i.repr.setState(i.state),null===(r=e.canvas3d)||void 0===r||r.update(i.repr)}),t.object.updated.subscribe(n=>{var r;if(!Se.Molecule.Structure.Representation3DState.is(n.obj))return;const i=n.obj.data;i.repr.setState(i.state),null===(r=e.canvas3d)||void 0===r||r.update(i.repr)}),t.object.removed.subscribe(n=>{var r;if(!Se.Molecule.Structure.Representation3DState.is(n.obj))return;const i=n.obj.data;i.repr.setState(i.initialState),null===(r=e.canvas3d)||void 0===r||r.update(i.repr)})}function qge(e){e.state.data.events.cell.stateUpdated.subscribe(t=>{var n;const r=t.state.cells.get(t.ref);Se.isRepresentation3D(r.obj)&&vq(r,r.obj.data.repr)&&(null===(n=e.canvas3d)||void 0===n||n.syncVisibility())})}function vq(e,t){return t.state.visible===!!e.state.isHidden&&(t.setState({visible:!e.state.isHidden}),!0)}function qct(e){Wge(e),Yge(e),$ge(e),Xge(e),Kge(e)}function Wge(e){jt.Camera.Reset.subscribe(e,t=>{e.managers.camera.reset(t?.snapshot,t?.durationMs)})}function $ge(e){jt.Camera.SetSnapshot.subscribe(e,({snapshot:t,durationMs:n})=>{e.managers.camera.setSnapshot(t,n)})}function Yge(e){jt.Camera.Focus.subscribe(e,({center:t,radius:n,durationMs:r})=>{e.managers.camera.focusSphere({center:t,radius:n},{durationMs:r}),e.events.canvas3d.settingsUpdated.next(void 0)})}function Xge(e){jt.Camera.OrientAxes.subscribe(e,({structures:t,durationMs:n})=>{e.managers.camera.orientAxes(t,n)})}function Kge(e){jt.Camera.ResetAxes.subscribe(e,({durationMs:t})=>{e.managers.camera.resetAxes(t)})}function Da(){return Da.zero()}!function(e){function i(){return(i=le(function*(o,s){if(!o.helpers.viewportScreenshot)return;const a=o.helpers.viewportScreenshot.getPreview(512);if(!a)return;const l=yield yq(a.canvas,"png"),c=new File([l],s),u={kind:"file",id:oo.create22(),name:s};return o.managers.asset.set(u,c),u})).apply(this,arguments)}e.Entry=function t(o,s){return{timestamp:+new Date,snapshot:o,...s}},e.isStateSnapshot=function n(o){return!!o&&!!o.timestamp&&!!o.entries},e.getCanvasImageAsset=function r(o,s){return i.apply(this,arguments)}}(vA||(vA={})),function(e){e.zero=function t(){return{x:0,y:0,width:0,height:0}},e.create=function n(l,c,u,d){return{x:l,y:c,width:u,height:d}},e.clone=function r(l){return{...l}},e.copy=function i(l,c){return Object.assign(l,c)},e.set=function o(l,c,u,d,f){return l.x=c,l.y=u,l.width=d,l.height=f,l},e.toVec4=function s(l,c){return l[0]=c.x,l[1]=c.y,l[2]=c.width,l[3]=c.height,l},e.equals=function a(l,c){return l.x===c.x&&l.y===c.y&&l.width===c.width&&l.height===c.height}}(Da||(Da={}));const Tg=Bn();function CF(e,t,n,r){const{x:i,y:o,width:s,height:a}=n,c=t[1]-o,u=t[2];return e[0]=2*(t[0]-i)/s-1,e[1]=2*c/a-1,e[2]=2*u-1,C.transformMat4(e,e,r)}function q_(e){if("object"==typeof e){if("buttons"in e)return e.buttons;if("which"in e){const t=e.which;if(2===t)return 4;if(3===t)return 2;if(t>0)return 1<<t-1}}return 0}function xA(e){if("object"==typeof e&&"button"in e){const t=e.button;if(1===t)return 4;if(2===t)return 2;if(t>=0)return 1<<t}return 0}function wF(e){return{alt:"altKey"in e&&e.altKey,shift:"shiftKey"in e&&e.shiftKey,control:"ctrlKey"in e&&e.ctrlKey,meta:"metaKey"in e&&e.metaKey}}const Zge={noScroll:!0,noMiddleClickScroll:!0,noContextMenu:!0,noPinchZoom:!0,noTextSelect:!0,preventGestures:!1,mask:(e,t)=>!0,pixelScale:1};var Rf,es;!function(e){function t(o,s){return o.shift===s.shift&&o.alt===s.alt&&o.control===s.control&&o.meta===s.meta}function i(o={}){return{shift:!!o.shift,alt:!!o.alt,control:!!o.control,meta:!!o.meta}}e.None=i(),e.areEqual=t,e.areNone=function n(o){return t(o,e.None)},e.size=function r(o){if(!o)return 0;let s=0;return o.shift&&s++,o.alt&&s++,o.control&&s++,o.meta&&s++,s},e.create=i}(Rf||(Rf={})),function(e){let t;var n;e.has=Mc.has,e.create=Mc.create,(n=t=e.Flag||(e.Flag={}))[n.None=0]="None",n[n.Primary=1]="Primary",n[n.Secondary=2]="Secondary",n[n.Auxilary=4]="Auxilary",n[n.Forth=8]="Forth",n[n.Five=16]="Five"}(es||(es={}));const Qge={key:"",code:"",modifiers:Rf.None,x:-1,y:-1,pageX:-1,pageY:-1,preventDefault:rp};var W_=function(e){return e[e.Stopped=0]="Stopped",e[e.Started=1]="Started",e[e.Moving=2]="Moving",e}(W_||{});function Jge(){return{drag:new si,interactionEnd:new si,click:new si,move:new si,wheel:new si,pinch:new si,gesture:new si,resize:new si,leave:new si,enter:new si,modifiers:new si,key:new si,keyUp:new si,keyDown:new si,lock:new si}}const $ct=["Backspace","Delete"];var xq;!function(e){e.create=function t(r={}){const{noScroll:i,noContextMenu:o}={...Zge,...r};return{noScroll:i,noContextMenu:o,pointerLock:!1,width:0,height:0,pixelRatio:1,...Jge(),setPixelScale:rp,requestPointerLock:rp,exitPointerLock:rp,dispose:rp}},e.fromElement=function n(r,i={}){let{noScroll:o,noContextMenu:a,noPinchZoom:l,noTextSelect:c,mask:u,pixelScale:d,preventGestures:f}={...Zge,...i},p=r.clientWidth*T(),m=r.clientHeight*T(),h=!1,g=Da(),y=0,v=0;const x=Ue(),_=Ue(),w=Ue(),A=Ue(),M=Ue(),E={shift:!1,alt:!1,control:!1,meta:!1},D={x:-1,y:-1,pageX:-1,pageY:-1};function T(){return window.devicePixelRatio*d}function F(){return{...E}}function R(Qe){return Qe.target===document.body||Qe.target===r}let X,N=W_.Stopped,j=!1,W=es.create(es.Flag.None),z=es.Flag.None,$=!1,V=!1;typeof window.ResizeObserver<"u"&&(X=new window.ResizeObserver(pn));const H=Jge(),{drag:oe,interactionEnd:te,wheel:K,pinch:Q,gesture:G,click:Z,move:ee,leave:se,enter:xe,resize:re,modifiers:ae,key:ge,keyUp:Ie,keyDown:me,lock:Ae}=H;function ue(){h=r.ownerDocument.pointerLockElement===r,vm(h),Ae.next(h)}function _e(){console.error("Unable to use Pointer Lock API"),h=!1,vm(h),Ae.next(h)}function Fe(Qe){u(Qe.clientX,Qe.clientY)&&a&&Qe.preventDefault()}function Ze(Qe){E.alt=Qe.altKey,E.shift=Qe.shiftKey,E.control=Qe.ctrlKey,E.meta=Qe.metaKey}function ct(){(W||E.shift||E.alt||E.meta||E.control)&&(W=0,E.shift=E.alt=E.control=E.meta=!1)}function q(Qe){let Mn=!1;!E.alt&&Qe.altKey&&(Mn=!0,E.alt=!0),!E.shift&&Qe.shiftKey&&(Mn=!0,E.shift=!0),!E.control&&Qe.ctrlKey&&(Mn=!0,E.control=!0),!E.meta&&Qe.metaKey&&(Mn=!0,E.meta=!0),Mn&&$&&ae.next(F()),R(Qe)&&$&&me.next({key:Qe.key,code:Qe.code,modifiers:F(),...D,preventDefault:()=>Qe.preventDefault()})}function ne(Qe){let Mn=!1;E.alt&&!Qe.altKey&&(Mn=!0,E.alt=!1),E.shift&&!Qe.shiftKey&&(Mn=!0,E.shift=!1),E.control&&!Qe.ctrlKey&&(Mn=!0,E.control=!1),E.meta&&!Qe.metaKey&&(Mn=!0,E.meta=!1),Mn&&$&&ae.next(F()),$ct.includes(Qe.key)&&be(Qe),R(Qe)&&$&&Ie.next({key:Qe.key,code:Qe.code,modifiers:F(),...D,preventDefault:()=>Qe.preventDefault()})}function be(Qe){!R(Qe)||!$||ge.next({key:Qe.key,code:Qe.code,modifiers:F(),...D,preventDefault:()=>Qe.preventDefault()})}function Ce(Qe){const Mn=Qe.touches[0],gt=Qe.touches[1];return{clientX:(Mn.clientX+gt.clientX)/2,clientY:(Mn.clientY+gt.clientY)/2,pageX:(Mn.pageX+gt.pageX)/2,pageY:(Mn.pageY+gt.pageY)/2,target:Qe.target}}function Re(Qe){const Mn=Qe.touches[0].pageX-Qe.touches[1].pageX,gt=Qe.touches[0].pageY-Qe.touches[1].pageY;return Math.sqrt(Mn*Mn+gt*gt)}!function he(){r.addEventListener("contextmenu",Fe,!1),r.addEventListener("wheel",Et,!1),r.addEventListener("mousedown",St,!1),window.addEventListener("mousemove",Mt,!1),window.addEventListener("mouseup",Qt,!1),r.addEventListener("touchstart",ft,!1),r.addEventListener("touchmove",Pt,!1),r.addEventListener("touchend",vt,!1),r.addEventListener("gesturechange",Ft,!1),r.addEventListener("gesturestart",Te,!1),r.addEventListener("gestureend",Vt,!1),window.addEventListener("blur",ct),window.addEventListener("keyup",ne,!1),window.addEventListener("keydown",q,!1),window.addEventListener("keypress",be,!1),document.addEventListener("pointerlockchange",ue,!1),document.addEventListener("pointerlockerror",_e,!1),null!=X?X.observe(r.parentElement):window.addEventListener("resize",pn,!1)}();let $e,Be=-1;const nt=Ue(),ht=Ue();function ft(Qe){if(Qe.preventDefault(),$e=void 0,Be=-1,1===Qe.touches.length)Be=0,Ue.set(nt,Qe.touches[0].pageX,Qe.touches[0].pageY),$e=Qe.touches[0],W=z=es.Flag.Primary,Kn(Qe.touches[0]);else if(2===Qe.touches.length){W=es.Flag.Secondary&es.Flag.Auxilary,z=es.Flag.Secondary,Kn(Ce(Qe));const Mn=Re(Qe);y=Mn,Q.next({distance:Mn,fraction:1,fractionDelta:0,delta:0,isStart:!0,buttons:W,button:z,modifiers:F()})}else 3===Qe.touches.length&&(W=z=es.Flag.Forth,Kn(Ce(Qe)))}function vt(Qe){if(An(),$e&&Be<=4){const Mn=$e;if(!u(Mn.clientX,Mn.clientY))return;bi(ht,Mn);const{pageX:gt,pageY:Jt}=ns(Mn),[_n,Xi]=ht;Z.next({x:_n,y:Xi,pageX:gt,pageY:Jt,buttons:W,button:z,modifiers:F()})}$e=void 0}function Pt(Qe){if(z=es.Flag.None,l&&(Qe.preventDefault(),Qe.stopPropagation(),Qe.originalEvent&&(Qe.originalEvent.preventDefault(),Qe.originalEvent.stopPropagation())),$e=void 0,1===Qe.touches.length)W=es.Flag.Primary,$e=Qe.touches[0],function Ge(Qe){Be<0||(Ue.set(ht,Qe.touches[0].pageX,Qe.touches[0].pageY),Be+=Ue.distance(nt,ht),Ue.copy(nt,ht))}(Qe),ut(Qe.touches[0]);else if(2===Qe.touches.length){const Mn=Re(Qe),gt=y-Mn;if(Math.abs(gt)<4)W=es.Flag.Secondary,ut(Ce(Qe));else{W=es.Flag.Auxilary,Ze(Qe);const Jt=y/Mn;Q.next({delta:gt,fraction:Jt,fractionDelta:v-Jt,distance:Mn,isStart:!1,buttons:W,button:z,modifiers:F()}),v=Jt}y=Mn}else 3===Qe.touches.length&&(W=es.Flag.Forth,ut(Ce(Qe)))}function St(Qe){Ze(Qe),W=q_(Qe),z=xA(Qe),Kn(Qe)}function Mt(Qe){Ze(Qe),W=q_(Qe),z=es.Flag.None,ut(Qe)}function Qt(Qe){Ze(Qe),W=q_(Qe),z=xA(Qe),function ti(Qe){if(N=W_.Stopped,u(Qe.clientX,Qe.clientY)){if(bi(w,Qe),!V&&Ue.distance(w,x)<4){const{pageX:Mn,pageY:gt}=ns(Qe),[Jt,_n]=w;Z.next({x:Jt,y:_n,pageX:Mn,pageY:gt,buttons:W,button:z,modifiers:F()})}V=!1}}(Qe),An()}function An(){te.next(void 0)}function Kn(Qe){u(Qe.clientX,Qe.clientY)&&(bi(_,Qe),Ue.copy(x,_),Pr(_)&&(N=W_.Started))}function ut(Qe){var Mn;bi(w,Qe);const{pageX:gt,pageY:Jt}=ns(Qe),[_n,Xi]=w,{movementX:Sc,movementY:vu}=Qe,od=Pr(w)&&u(Qe.clientX,Qe.clientY);if($&&!od?se.next(void 0):!$&&od&&xe.next(void 0),$=od,D.x=_n,D.y=Xi,D.pageX=gt,D.pageY=Jt,ee.next({x:_n,y:Xi,pageX:gt,pageY:Jt,movementX:Sc,movementY:vu,buttons:W,button:z,modifiers:F(),inside:od,onElement:Qe.target===r}),N===W_.Stopped||(c&&(null===(Mn=Qe.preventDefault)||void 0===Mn||Mn.call(Qe)),Ue.div(A,Ue.sub(A,w,_),function Jn(Qe){return Qe[0]=r.clientWidth,Qe[1]=r.clientHeight,Qe}(M)),Ue.magnitude(A)<wi))return;const sd=N===W_.Started;if(sd&&!u(Qe.clientX,Qe.clientY))return;Ue.distance(w,x)>=4&&(V=!0);const[wv,Av]=A;oe.next({x:_n,y:Xi,dx:wv,dy:Av,pageX:gt,pageY:Jt,buttons:W,button:z,modifiers:F(),isStart:sd}),Ue.copy(_,w),N=W_.Moving}function Et(Qe){if(!u(Qe.clientX,Qe.clientY))return;bi(w,Qe);const{pageX:Mn,pageY:gt}=ns(Qe),[Jt,_n]=w;o&&Qe.preventDefault();const Xi=function Yct(e){let i=0,o=0,s=0,a=0,l=0;return"detail"in e&&(o=e.detail),"wheelDelta"in e&&(o=-e.wheelDelta/120),"wheelDeltaY"in e&&(o=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(i=-e.wheelDeltaX/120),"axis"in e&&e.axis===e.HORIZONTAL_AXIS&&(i=o,o=0),s=10*i,a=10*o,"deltaY"in e&&(a=e.deltaY),"deltaX"in e&&(s=e.deltaX),"deltaZ"in e&&(l=e.deltaZ),(s||a||l)&&e.deltaMode&&(1===e.deltaMode?(s*=40,a*=40,l*=40):(s*=800,a*=800,l*=800)),s&&!i&&(i=s<1?-1:1),a&&!o&&(o=a<1?-1:1),{spinX:i,spinY:o,dx:s,dy:a,dz:l}}(Qe);W=z=es.Flag.Auxilary,(Xi.dx||Xi.dy||Xi.dz)&&K.next({x:Jt,y:_n,pageX:Mn,pageY:gt,...Xi,buttons:W,button:z,modifiers:F()})}function Nt(Qe){var Mn,gt;f&&(Qe.preventDefault(),null===(Mn=Qe.stopImmediatePropagation)||void 0===Mn||Mn.call(Qe),null===(gt=Qe.stopPropagation)||void 0===gt||gt.call(Qe))}let ye=0,we=0;function Te(Qe){Nt(Qe),ye=Qe.scale,we=Qe.rotation,G.next({scale:Qe.scale,rotation:Qe.rotation,deltaRotation:0,deltaScale:0,isStart:!0})}function je(Qe,Mn){G.next({scale:Qe.scale,rotation:Qe.rotation,deltaRotation:we-Qe.rotation,deltaScale:ye-Qe.scale,isEnd:Mn}),we=Qe.rotation,ye=Qe.scale}function Ft(Qe){Nt(Qe),je(Qe)}function Vt(Qe){Nt(Qe),je(Qe,!0)}function pn(){re.next({})}function Pr(Qe){if(r instanceof Window||r instanceof Document||r===document.body)return!0;{const Mn=r.getBoundingClientRect();return Qe[0]>=0&&Qe[1]>=0&&Qe[0]<Mn.width&&Qe[1]<Mn.height}}function bi(Qe,Mn){if(p=r.clientWidth*T(),m=r.clientHeight*T(),h){const gt=T();Qe[0]=(g.x+g.width/2)/gt,Qe[1]=(m-(g.y+g.height/2))/gt}else{const gt=r.getBoundingClientRect();Qe[0]=(Mn.clientX||0)-gt.left,Qe[1]=(Mn.clientY||0)-gt.top}return Qe}function ns(Qe){return h?{pageX:Math.round(window.innerWidth/2)+g.x,pageY:Math.round(window.innerHeight/2)+g.y}:{pageX:Qe.pageX,pageY:Qe.pageY}}const _c=30,Js=function id(){var Qe;const Mn=document.createElement("div"),_n="#000 30%, #0000 0 calc(100% - 30%), #000 0";return Object.assign(Mn.style,{width:`${_c}px`,aspectRatio:1,background:`linear-gradient(0deg, ${_n}) 50%/10% 100% no-repeat, linear-gradient(90deg, ${_n}) 50%/100% 10% no-repeat, radial-gradient(circle at 50%, #000 5%, #0000 5%)`,display:"none",zIndex:1e3,position:"absolute",mixBlendMode:"difference",filter:"invert(1)"}),null===(Qe=r.parentElement)||void 0===Qe||Qe.appendChild(Mn),Mn}();function vm(Qe){if(Js.style.display=Qe?"block":"none",Qe){const Mn=T(),gt=(g.x+g.width/2)/Mn,Jt=(g.y+g.height/2)/Mn;Js.style.width=`${_c}px`,Js.style.left=`calc(${gt}px - ${_c/2}px)`,Js.style.bottom=`calc(${Jt}px - ${_c/2}px)`}}return{get noScroll(){return o},set noScroll(Qe){o=Qe},get noContextMenu(){return a},set noContextMenu(Qe){a=Qe},get width(){return p},get height(){return m},get pixelRatio(){return T()},get pointerLock(){return h},...H,setPixelScale:Qe=>{d=Qe,p=r.clientWidth*T(),m=r.clientHeight*T()},requestPointerLock:Qe=>{g=Qe,h||r.requestPointerLock()},exitPointerLock:()=>{h&&r.ownerDocument.exitPointerLock()},dispose:function ie(){j||(j=!0,r.removeEventListener("contextmenu",Fe,!1),r.removeEventListener("wheel",Et,!1),r.removeEventListener("mousedown",St,!1),window.removeEventListener("mousemove",Mt,!1),window.removeEventListener("mouseup",Qt,!1),r.removeEventListener("touchstart",ft,!1),r.removeEventListener("touchmove",Pt,!1),r.removeEventListener("touchend",vt,!1),r.removeEventListener("gesturechange",Ft,!1),r.removeEventListener("gesturestart",Te,!1),r.removeEventListener("gestureend",Vt,!1),window.removeEventListener("blur",ct),window.removeEventListener("keyup",ne,!1),window.removeEventListener("keydown",q,!1),window.removeEventListener("keypress",be,!1),document.removeEventListener("pointerlockchange",ue,!1),document.removeEventListener("pointerlockerror",_e,!1),Js.remove(),null!=X?(X.unobserve(r.parentElement),X.disconnect()):window.removeEventListener("resize",pn,!1))}}}}(xq||(xq={}));var $_=function(e){return e[e.None=0]="None",e[e.Object=1]="Object",e[e.Instance=2]="Instance",e[e.Group=3]="Group",e}($_||{}),AF=function(e){return e[e.None=0]="None",e[e.Depth=1]="Depth",e[e.Mask=2]="Mask",e}(AF||{});const _q={backgroundColor:I.Color(st(0),{description:"Background color of the 3D canvas"}),pickingAlphaThreshold:I.Numeric(.5,{min:0,max:1,step:.01},{description:"The minimum opacity value needed for an object to be pickable."}),interiorDarkening:I.Numeric(.5,{min:0,max:1,step:.01}),interiorColorFlag:I.Boolean(!0,{label:"Use Interior Color"}),interiorColor:I.Color(st.fromNormalizedRgb(.3,.3,.3)),colorMarker:I.Boolean(!0,{description:"Enable color marker"}),highlightColor:I.Color(st.fromNormalizedRgb(1,.4,.6)),selectColor:I.Color(st.fromNormalizedRgb(.2,1,.1)),dimColor:I.Color(st.fromNormalizedRgb(1,1,1)),highlightStrength:I.Numeric(.3,{min:0,max:1,step:.1}),selectStrength:I.Numeric(.3,{min:0,max:1,step:.1}),dimStrength:I.Numeric(0,{min:0,max:1,step:.1}),markerPriority:I.Select(1,[[1,"Highlight"],[2,"Select"]]),xrayEdgeFalloff:I.Numeric(1,{min:0,max:3,step:.1}),exposure:I.Numeric(1,{min:0,max:3,step:.01}),light:I.ObjectList({inclination:I.Numeric(150,{min:0,max:180,step:1}),azimuth:I.Numeric(320,{min:0,max:360,step:1}),color:I.Color(st.fromNormalizedRgb(1,1,1)),intensity:I.Numeric(.6,{min:0,max:5,step:.01})},e=>st.toHexString(e.color),{defaultValue:[{inclination:150,azimuth:320,color:st.fromNormalizedRgb(1,1,1),intensity:.6}]}),ambientColor:I.Color(st.fromNormalizedRgb(1,1,1)),ambientIntensity:I.Numeric(.4,{min:0,max:2,step:.01})},e0e=C(),Sq=C();function t0e(e,t){const n=e.length,{direction:r,color:i}=t||{direction:new Array(3*n).fill(0),color:new Array(3*n).fill(0)};for(let o=0;o<n;++o){const s=e[o];C.directionFromSpherical(e0e,Xr(s.inclination),Xr(s.azimuth),1),C.toArray(e0e,r,3*o),C.scale(Sq,st.toVec3Normalized(Sq,s.color),s.intensity),C.toArray(Sq,i,3*o)}return{count:n,direction:r,color:i}}var Cq;function Ut(e,t="",n=""){return Ut.create(e,t,n)}!function(e){e.create=function t(n,r={}){const{gl:i,state:o,stats:s}=n,a=I.merge(_q,I.getDefaultValues(_q),r),l=t0e(a.light),c=Da(),u=Ue.create(i.drawingBufferWidth,i.drawingBufferHeight),d=st.toVec3Normalized(C(),a.backgroundColor);let f=!1,p=null;const m=n.resources.texture("image-uint8","rgba","ubyte","nearest");m.define(1,1),m.load({array:new Uint8Array([255,255,255,255]),width:1,height:1});const h=[["tDepth",m]],g=fe(),y=fe(),v=fe(),x=fe(),_=fe(),w=fe(),A=fe(),M=C(),E=C(),D=gs(),T=Ue(),F=E_(),R=C();C.scale(R,st.toArrayNormalized(a.ambientColor,R,0),a.ambientIntensity);const N={uDrawId:O.create(0),uModel:O.create(fe.identity()),uView:O.create(g),uInvView:O.create(y),uModelView:O.create(v),uInvModelView:O.create(x),uInvProjection:O.create(_),uProjection:O.create(fe()),uModelViewProjection:O.create(w),uInvModelViewProjection:O.create(A),uIsOrtho:O.create(1),uViewOffset:O.create(T),uPixelRatio:O.create(n.pixelRatio),uViewport:O.create(Da.toVec4(Bn(),c)),uDrawingBufferSize:O.create(u),uCameraPosition:O.create(E),uCameraDir:O.create(M),uCameraPlane:O.create(gs.toArray(D,Bn(),0)),uNear:O.create(1),uFar:O.create(1e4),uFog:O.create(!0),uFogNear:O.create(1),uFogFar:O.create(1e4),uFogColor:O.create(d),uRenderMask:O.create(0),uMarkingDepthTest:O.create(!1),uPickType:O.create($_.None),uMarkingType:O.create(AF.None),uTransparentBackground:O.create(!1),uLightDirection:O.create(l.direction),uLightColor:O.create(l.color),uAmbientColor:O.create(R),uPickingAlphaThreshold:O.create(a.pickingAlphaThreshold),uInteriorDarkening:O.create(a.interiorDarkening),uInteriorColorFlag:O.create(a.interiorColorFlag),uInteriorColor:O.create(st.toVec3Normalized(C(),a.interiorColor)),uHighlightColor:O.create(st.toVec3Normalized(C(),a.highlightColor)),uSelectColor:O.create(st.toVec3Normalized(C(),a.selectColor)),uDimColor:O.create(st.toVec3Normalized(C(),a.dimColor)),uHighlightStrength:O.create(a.highlightStrength),uSelectStrength:O.create(a.selectStrength),uDimStrength:O.create(a.dimStrength),uMarkerPriority:O.create(a.markerPriority),uMarkerAverage:O.create(0),uXrayEdgeFalloff:O.create(a.xrayEdgeFalloff),uExposure:O.create(a.exposure)},j=Object.entries(N);let W=!0;const z=(me,Ae,he)=>{var ie,ue,_e;if(me.state.disposed||!me.state.visible||!me.state.pickable&&"pick"===Ae||!E_.intersectsSphere3D(F,me.values.boundingSphere.ref.value))return;const[Fe,Ze]=me.values.uLod.ref.value;if(0!==Fe||0!==Ze){const{center:ne,radius:be}=me.values.boundingSphere.ref.value,Ce=gs.distanceToPoint(D,ne);if(Ce+be<Fe||Ce-be>Ze)return}me.values.instanceGrid.ref.value.cellSize>1||me.values.lodLevels?me.cull(D,F,p,n.stats):me.uncull();let ct=!1;me.values.dLightCount.ref.value!==l.count&&(O.update(me.values.dLightCount,l.count),ct=!0),me.values.dColorMarker.ref.value!==a.colorMarker&&(O.update(me.values.dColorMarker,a.colorMarker),ct=!0),ct&&me.update();const q=me.getProgram(Ae);if(o.currentProgramId!==q.id&&(W=!0,q.use()),W&&(q.setUniforms(j),q.bindTextures(h,0),W=!1),"directVolume"===me.values.dGeometryType.ref.value){if("color"!==Ae)return;o.disable(i.CULL_FACE),o.frontFace(i.CCW),3===he&&(o.disable(i.DEPTH_TEST),o.depthMask(!1))}else 1===he?(o.enable(i.CULL_FACE),null!==(ie=me.values.dFlipSided)&&void 0!==ie&&ie.ref.value?(o.frontFace(i.CW),o.cullFace(i.FRONT)):(o.frontFace(i.CCW),o.cullFace(i.BACK))):2===he?(o.enable(i.CULL_FACE),null!==(ue=me.values.dFlipSided)&&void 0!==ue&&ue.ref.value?(o.frontFace(i.CW),o.cullFace(i.BACK)):(o.frontFace(i.CCW),o.cullFace(i.FRONT))):(me.values.uDoubleSided?me.values.uDoubleSided.ref.value||me.values.hasReflection.ref.value?o.disable(i.CULL_FACE):o.enable(i.CULL_FACE):o.disable(i.CULL_FACE),null!==(_e=me.values.dFlipSided)&&void 0!==_e&&_e.ref.value?(o.frontFace(i.CW),o.cullFace(i.FRONT)):(o.frontFace(i.CCW),o.cullFace(i.BACK)));me.render(Ae,h.length)},V=(me,Ae,he,ie,ue)=>{UR(h,"tDepth",he||m),O.update(N.uModel,me.view),O.update(N.uModelView,fe.mul(v,Ae.view,me.view)),O.update(N.uInvModelView,fe.invert(x,v)),O.update(N.uModelViewProjection,fe.mul(w,v,Ae.projection)),O.update(N.uInvModelViewProjection,fe.invert(A,w)),O.updateIfChanged(N.uRenderMask,ie),O.updateIfChanged(N.uMarkingDepthTest,ue),o.enable(i.SCISSOR_TEST),o.colorMask(!0,!0,!0,!0);const{x:_e,y:Fe,width:Ze,height:ct}=c;o.viewport(_e,Fe,Ze,ct),o.scissor(_e,Fe,Ze,ct),W=!0,o.currentRenderItemId=-1},Z=(me,Ae,he)=>{var ie,ue;It&&n.timer.mark("Renderer.renderBlendedOpaque"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,1,!1);const{renderables:_e}=me;for(let Fe=0,Ze=_e.length;Fe<Ze;++Fe){const ct=_e[Fe];ct.state.opaque?z(ct,"color",0):null!==(ie=ct.values.uDoubleSided)&&void 0!==ie&&ie.ref.value&&"opaque"===(null===(ue=ct.values.dTransparentBackfaces)||void 0===ue?void 0:ue.ref.value)&&z(ct,"color",2)}It&&n.timer.markEnd("Renderer.renderBlendedOpaque")},ee=(me,Ae,he)=>{var ie,ue;It&&n.timer.mark("Renderer.renderBlendedTransparent"),o.enable(i.DEPTH_TEST),V(me,Ae,he,2,!1);const{renderables:_e}=me;f?o.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA):o.blendFuncSeparate(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA),o.enable(i.BLEND),o.depthMask(!0);for(let Fe=0,Ze=_e.length;Fe<Ze;++Fe){const ct=_e[Fe];!ct.state.opaque&&ct.state.writeDepth&&z(ct,"color",0)}o.depthMask(!1);for(let Fe=0,Ze=_e.length;Fe<Ze;++Fe){const ct=_e[Fe];(!ct.state.opaque&&!ct.state.writeDepth||ct.values.transparencyAverage.ref.value>0)&&(null!==(ie=ct.values.uDoubleSided)&&void 0!==ie&&ie.ref.value?("opaque"!==(null===(ue=ct.values.dTransparentBackfaces)||void 0===ue?void 0:ue.ref.value)&&z(ct,"color",2),z(ct,"color",1)):z(ct,"color",0))}It&&n.timer.markEnd("Renderer.renderBlendedTransparent")};return{clear:(me,Ae)=>{o.enable(i.SCISSOR_TEST),o.enable(i.DEPTH_TEST),o.colorMask(!0,!0,!0,!0),o.depthMask(!0),f&&!Ae?o.clearColor(0,0,0,0):me?o.clearColor(d[0],d[1],d[2],1):o.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},clearDepth:(me=!1)=>{o.enable(i.SCISSOR_TEST),me?(o.colorMask(!0,!0,!0,!0),o.clearColor(1,1,1,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):(o.enable(i.DEPTH_TEST),o.depthMask(!0),i.clear(i.DEPTH_BUFFER_BIT))},update:(me,Ae)=>{O.update(N.uView,me.view),O.update(N.uInvView,fe.invert(y,me.view)),O.update(N.uProjection,me.projection),O.update(N.uInvProjection,fe.invert(_,me.projection)),O.updateIfChanged(N.uIsOrtho,"orthographic"===me.state.mode?1:0),O.update(N.uViewOffset,me.viewOffset.enabled?Ue.set(T,16*me.viewOffset.offsetX,16*me.viewOffset.offsetY):Ue.set(T,0,0)),O.update(N.uCameraPosition,C.copy(E,me.state.position)),O.update(N.uCameraDir,C.normalize(M,C.sub(M,me.state.target,me.state.position))),O.updateIfChanged(N.uFar,me.far),O.updateIfChanged(N.uNear,me.near),O.updateIfChanged(N.uFog,me.state.fog>0),O.updateIfChanged(N.uFogFar,me.fogFar),O.updateIfChanged(N.uFogNear,me.fogNear),O.updateIfChanged(N.uTransparentBackground,f),E_.fromProjectionMatrix(F,me.projectionView),gs.copy(D,F[5]),D.constant-=gs.distanceToPoint(D,E),O.update(N.uCameraPlane,gs.toArray(D,N.uCameraPlane.ref.value,0)),O.updateIfChanged(N.uMarkerAverage,Ae.markerAverage)},renderPick:(me,Ae,he,ie,ue)=>{It&&n.timer.mark("Renderer.renderPick"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,ie,0,!1),O.updateIfChanged(N.uPickType,ue);const{renderables:_e}=me;for(let Fe=0,Ze=_e.length;Fe<Ze;++Fe)_e[Fe].state.colorOnly||z(_e[Fe],he,0);It&&n.timer.markEnd("Renderer.renderPick")},renderDepth:(me,Ae,he)=>{It&&n.timer.mark("Renderer.renderDepth"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,0,!1);const{renderables:ie}=me;for(let ue=0,_e=ie.length;ue<_e;++ue)z(ie[ue],"depth",0);It&&n.timer.markEnd("Renderer.renderDepth")},renderDepthOpaque:(me,Ae,he)=>{var ie,ue;It&&n.timer.mark("Renderer.renderDepthOpaque"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,1,!1);const{renderables:_e}=me;for(let Fe=0,Ze=_e.length;Fe<Ze;++Fe){const ct=_e[Fe],q="on"===(null===(ie=ct.values.dXrayShaded)||void 0===ie?void 0:ie.ref.value)||"inverted"===(null===(ue=ct.values.dXrayShaded)||void 0===ue?void 0:ue.ref.value);ct.state.opaque&&1!==ct.values.transparencyAverage.ref.value&&!q&&z(ct,"depth",0)}It&&n.timer.markEnd("Renderer.renderDepthOpaque")},renderDepthTransparent:(me,Ae,he)=>{var ie,ue;It&&n.timer.mark("Renderer.renderDepthTransparent"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,2,!1);const{renderables:_e}=me;for(let Fe=0,Ze=_e.length;Fe<Ze;++Fe){const ct=_e[Fe],q="on"===(null===(ie=ct.values.dXrayShaded)||void 0===ie?void 0:ie.ref.value)||"inverted"===(null===(ue=ct.values.dXrayShaded)||void 0===ue?void 0:ue.ref.value);(!ct.state.opaque||ct.values.transparencyAverage.ref.value>0||q)&&z(ct,"depth",0)}It&&n.timer.markEnd("Renderer.renderDepthTransparent")},renderMarkingDepth:(me,Ae,he)=>{It&&n.timer.mark("Renderer.renderMarkingDepth"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,0,!1),O.updateIfChanged(N.uMarkingType,AF.Depth);const{renderables:ie}=me;for(let ue=0,_e=ie.length;ue<_e;++ue){const Fe=ie[ue];0!==al(Fe.values.alpha.ref.value*Fe.state.alphaFactor,0,1)&&1!==Fe.values.markerAverage.ref.value&&z(ie[ue],"marking",0)}It&&n.timer.markEnd("Renderer.renderMarkingDepth")},renderMarkingMask:(me,Ae,he)=>{It&&n.timer.mark("Renderer.renderMarkingMask"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,0,!!he),O.updateIfChanged(N.uMarkingType,AF.Mask);const{renderables:ie}=me;for(let ue=0,_e=ie.length;ue<_e;++ue)ie[ue].values.markerAverage.ref.value>0&&z(ie[ue],"marking",0);It&&n.timer.markEnd("Renderer.renderMarkingMask")},renderBlended:(me,Ae)=>{me.hasOpaque&&Z(me,Ae,null),me.opacityAverage<1&&ee(me,Ae,null)},renderBlendedOpaque:Z,renderBlendedTransparent:ee,renderBlendedVolume:(me,Ae,he)=>{It&&n.timer.mark("Renderer.renderBlendedVolume"),o.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),o.enable(i.BLEND),V(me,Ae,he,2,!1);const{renderables:ie}=me;for(let ue=0,_e=ie.length;ue<_e;++ue){const Fe=ie[ue];"directVolume"===Fe.values.dGeometryType.ref.value&&z(Fe,"color",3)}It&&n.timer.markEnd("Renderer.renderBlendedVolume")},renderWboitOpaque:(me,Ae,he)=>{var ie,ue,_e,Fe;It&&n.timer.mark("Renderer.renderWboitOpaque"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,1,!1);const{renderables:Ze}=me;for(let ct=0,q=Ze.length;ct<q;++ct){const ne=Ze[ct],be=al(ne.values.alpha.ref.value*ne.state.alphaFactor,0,1),Ce="on"===(null===(ie=ne.values.dXrayShaded)||void 0===ie?void 0:ie.ref.value)||"inverted"===(null===(ue=ne.values.dXrayShaded)||void 0===ue?void 0:ue.ref.value);(1===be&&1!==ne.values.transparencyAverage.ref.value&&"directVolume"!==ne.values.dGeometryType.ref.value&&"fuzzy"!==(null===(_e=ne.values.dPointStyle)||void 0===_e?void 0:_e.ref.value)&&!Ce||"opaque"===(null===(Fe=ne.values.dTransparentBackfaces)||void 0===Fe?void 0:Fe.ref.value))&&z(ne,"color",0)}It&&n.timer.markEnd("Renderer.renderWboitOpaque")},renderWboitTransparent:(me,Ae,he)=>{var ie,ue,_e;It&&n.timer.mark("Renderer.renderWboitTransparent"),V(me,Ae,he,2,!1);const{renderables:Fe}=me;for(let Ze=0,ct=Fe.length;Ze<ct;++Ze){const q=Fe[Ze],ne=al(q.values.alpha.ref.value*q.state.alphaFactor,0,1),be="on"===(null===(ie=q.values.dXrayShaded)||void 0===ie?void 0:ie.ref.value)||"inverted"===(null===(ue=q.values.dXrayShaded)||void 0===ue?void 0:ue.ref.value);(ne<1&&0!==ne||q.values.transparencyAverage.ref.value>0||"directVolume"===q.values.dGeometryType.ref.value||"fuzzy"===(null===(_e=q.values.dPointStyle)||void 0===_e?void 0:_e.ref.value)||"text"===q.values.dGeometryType.ref.value||be)&&z(q,"color",0)}It&&n.timer.markEnd("Renderer.renderWboitTransparent")},renderDpoitOpaque:(me,Ae,he)=>{var ie,ue,_e,Fe;It&&n.timer.mark("Renderer.renderDpoitOpaque"),o.disable(i.BLEND),o.enable(i.DEPTH_TEST),o.depthMask(!0),V(me,Ae,he,1,!1);const{renderables:Ze}=me;for(let ct=0,q=Ze.length;ct<q;++ct){const ne=Ze[ct],be=al(ne.values.alpha.ref.value*ne.state.alphaFactor,0,1),Ce="on"===(null===(ie=ne.values.dXrayShaded)||void 0===ie?void 0:ie.ref.value)||"inverted"===(null===(ue=ne.values.dXrayShaded)||void 0===ue?void 0:ue.ref.value);(1===be&&1!==ne.values.transparencyAverage.ref.value&&"fuzzy"!==(null===(_e=ne.values.dPointStyle)||void 0===_e?void 0:_e.ref.value)&&!Ce||"opaque"===(null===(Fe=ne.values.dTransparentBackfaces)||void 0===Fe?void 0:Fe.ref.value))&&z(ne,"color",0)}It&&n.timer.markEnd("Renderer.renderDpoitOpaque")},renderDpoitTransparent:(me,Ae,he,ie)=>{var ue,_e,Fe;It&&n.timer.mark("Renderer.renderDpoitTransparent"),o.enable(i.BLEND),UR(h,"tDpoitDepth",ie.depth),UR(h,"tDpoitFrontColor",ie.frontColor),UR(h,"tDpoitBackColor",ie.backColor),V(me,Ae,he,2,!1);const{renderables:Ze}=me;for(let ct=0,q=Ze.length;ct<q;++ct){const ne=Ze[ct],be=al(ne.values.alpha.ref.value*ne.state.alphaFactor,0,1),Ce="on"===(null===(ue=ne.values.dXrayShaded)||void 0===ue?void 0:ue.ref.value)||"inverted"===(null===(_e=ne.values.dXrayShaded)||void 0===_e?void 0:_e.ref.value);(be<1&&0!==be||ne.values.transparencyAverage.ref.value>0||"fuzzy"===(null===(Fe=ne.values.dPointStyle)||void 0===Fe?void 0:Fe.ref.value)||"text"===ne.values.dGeometryType.ref.value||Ce)&&z(ne,"color",0)}It&&n.timer.markEnd("Renderer.renderDpoitTransparent")},renderDpoitVolume:(me,Ae,he)=>{It&&n.timer.mark("Renderer.renderDpoitVolume"),o.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),o.enable(i.BLEND),V(me,Ae,he,2,!1);const{renderables:ie}=me;for(let ue=0,_e=ie.length;ue<_e;++ue){const Fe=ie[ue];"directVolume"===Fe.values.dGeometryType.ref.value&&z(Fe,"color",0)}It&&n.timer.markEnd("Renderer.renderDpoitVolume")},setProps:me=>{void 0!==me.backgroundColor&&me.backgroundColor!==a.backgroundColor&&(a.backgroundColor=me.backgroundColor,st.toVec3Normalized(d,a.backgroundColor),O.update(N.uFogColor,C.copy(N.uFogColor.ref.value,d))),void 0!==me.pickingAlphaThreshold&&me.pickingAlphaThreshold!==a.pickingAlphaThreshold&&(a.pickingAlphaThreshold=me.pickingAlphaThreshold,O.update(N.uPickingAlphaThreshold,a.pickingAlphaThreshold)),void 0!==me.interiorDarkening&&me.interiorDarkening!==a.interiorDarkening&&(a.interiorDarkening=me.interiorDarkening,O.update(N.uInteriorDarkening,a.interiorDarkening)),void 0!==me.interiorColorFlag&&me.interiorColorFlag!==a.interiorColorFlag&&(a.interiorColorFlag=me.interiorColorFlag,O.update(N.uInteriorColorFlag,a.interiorColorFlag)),void 0!==me.interiorColor&&me.interiorColor!==a.interiorColor&&(a.interiorColor=me.interiorColor,O.update(N.uInteriorColor,st.toVec3Normalized(N.uInteriorColor.ref.value,a.interiorColor))),void 0!==me.colorMarker&&me.colorMarker!==a.colorMarker&&(a.colorMarker=me.colorMarker),void 0!==me.highlightColor&&me.highlightColor!==a.highlightColor&&(a.highlightColor=me.highlightColor,O.update(N.uHighlightColor,st.toVec3Normalized(N.uHighlightColor.ref.value,a.highlightColor))),void 0!==me.selectColor&&me.selectColor!==a.selectColor&&(a.selectColor=me.selectColor,O.update(N.uSelectColor,st.toVec3Normalized(N.uSelectColor.ref.value,a.selectColor))),void 0!==me.dimColor&&me.dimColor!==a.dimColor&&(a.dimColor=me.dimColor,O.update(N.uDimColor,st.toVec3Normalized(N.uDimColor.ref.value,a.dimColor))),void 0!==me.highlightStrength&&me.highlightStrength!==a.highlightStrength&&(a.highlightStrength=me.highlightStrength,O.update(N.uHighlightStrength,a.highlightStrength)),void 0!==me.selectStrength&&me.selectStrength!==a.selectStrength&&(a.selectStrength=me.selectStrength,O.update(N.uSelectStrength,a.selectStrength)),void 0!==me.dimStrength&&me.dimStrength!==a.dimStrength&&(a.dimStrength=me.dimStrength,O.update(N.uDimStrength,a.dimStrength)),void 0!==me.markerPriority&&me.markerPriority!==a.markerPriority&&(a.markerPriority=me.markerPriority,O.update(N.uMarkerPriority,a.markerPriority)),void 0!==me.xrayEdgeFalloff&&me.xrayEdgeFalloff!==a.xrayEdgeFalloff&&(a.xrayEdgeFalloff=me.xrayEdgeFalloff,O.update(N.uXrayEdgeFalloff,a.xrayEdgeFalloff)),void 0!==me.exposure&&me.exposure!==a.exposure&&(a.exposure=me.exposure,O.update(N.uExposure,a.exposure)),void 0!==me.light&&!tg(me.light,a.light)&&(a.light=me.light,Object.assign(l,t0e(me.light,l)),O.update(N.uLightDirection,l.direction),O.update(N.uLightColor,l.color)),void 0!==me.ambientColor&&me.ambientColor!==a.ambientColor&&(a.ambientColor=me.ambientColor,C.scale(R,st.toArrayNormalized(a.ambientColor,R,0),a.ambientIntensity),O.update(N.uAmbientColor,R)),void 0!==me.ambientIntensity&&me.ambientIntensity!==a.ambientIntensity&&(a.ambientIntensity=me.ambientIntensity,C.scale(R,st.toArrayNormalized(a.ambientColor,R,0),a.ambientIntensity),O.update(N.uAmbientColor,R))},setViewport:(me,Ae,he,ie)=>{o.viewport(me,Ae,he,ie),o.scissor(me,Ae,he,ie),(me!==c.x||Ae!==c.y||he!==c.width||ie!==c.height)&&(Da.set(c,me,Ae,he,ie),O.update(N.uViewport,Bn.set(N.uViewport.ref.value,me,Ae,he,ie)))},setTransparentBackground:me=>{f=me},setDrawingBufferSize:(me,Ae)=>{(me!==u[0]||Ae!==u[1])&&O.update(N.uDrawingBufferSize,Ue.set(u,me,Ae))},setPixelRatio:me=>{O.update(N.uPixelRatio,me)},setOcclusionTest:me=>{p=me},props:a,get stats(){return{programCount:n.stats.resourceCounts.program,shaderCount:n.stats.resourceCounts.shader,attributeCount:n.stats.resourceCounts.attribute,elementsCount:n.stats.resourceCounts.elements,framebufferCount:n.stats.resourceCounts.framebuffer,renderbufferCount:n.stats.resourceCounts.renderbuffer,textureCount:n.stats.resourceCounts.texture,vertexArrayCount:n.stats.resourceCounts.vertexArray,drawCount:s.drawCount,instanceCount:s.instanceCount,instancedDrawCount:s.instancedDrawCount}},get light(){return l},dispose:()=>{}}}}(Cq||(Cq={})),function(e){function s(u){return u.triggers.map(l.format).join(" or ")}function l(u,d){return l.create(u,d)}var u;e.create=function t(u,d="",f=""){return{triggers:u,action:d,description:f}},e.isBinding=function n(u){return!!u&&Array.isArray(u.triggers)&&"string"==typeof u.action},e.Empty={triggers:[],action:"",description:""},e.isEmpty=function r(u){return 0===u.triggers.length||u.triggers.every(d=>void 0===d.buttons&&void 0===d.modifiers&&!d.code)},e.match=function i(u,d,f){return u.triggers.some(p=>l.match(p,d,f))},e.matchKey=function o(u,d,f,p){return u.triggers.some(m=>l.matchKey(m,d,f,p))},e.formatTriggers=s,e.format=function a(u,d=""){return function ZLe(e,t){const n=Object.keys(t),r=Object.values(t);return new Function(...n,`return \`${e}\`;`)(...r)}(u.description||yf(d),{triggers:"<i>"+s(u)+"</i>"})},e.Trigger=l,e.TriggerKey=function c(u,d){return l.create(void 0,d,u)},(u=l=e.Trigger||(e.Trigger={})).create=function d(h,g,y){return{buttons:h,modifiers:g,code:y}},u.Empty={},u.match=function f(h,g,y){const{buttons:v,modifiers:x}=h;return void 0!==v&&(v===g||es.has(v,g))&&(!x||Rf.areEqual(x,y))},u.matchKey=function p(h,g,y,v){const{modifiers:x,code:_}=h;return void 0!==_&&(_===g||1===_.length&&4===g.length&&g.startsWith("Key")&&!!v&&1===v.length&&v.toUpperCase()===_.toUpperCase())&&(!x||Rf.areEqual(x,y))},u.format=function m(h){const g=[],y=function Xct(e,t){const n=[];return void 0!==e||t?0===e?n.push("mouse hover"):void 0!==e&&(J1.has(e,J1.Flag.Primary)&&n.push("left mouse button"),J1.has(e,J1.Flag.Secondary)&&n.push("right mouse button"),J1.has(e,J1.Flag.Auxilary)&&n.push("wheel/middle mouse button"),J1.has(e,J1.Flag.Forth)&&n.push("three fingers")):n.push("any mouse button"),n.join(" + ")}(h.buttons,h.code);y&&g.push(y);const v=function Zct(e){return e?.startsWith("Key")&&(e=e.substring(3)),e&&Rc(e).toLowerCase()}(h.code);v&&g.push(v);const x=function Kct(e,t){const n=[];return e?(e.alt&&n.push("alt key"),e.control&&n.push("control key"),e.meta&&n.push("meta/command key"),e.shift&&n.push("shift key"),t&&0===n.length&&n.push("no key")):t&&n.push("any key"),n.join(" + ")}(h.modifiers);return x&&g.push(x),g.join(" + ")}}(Ut||(Ut={}));const J1=es,ev=es,Nf=Rf,tv=Ut.Trigger,Nd=Ut.TriggerKey,n0e={dragRotate:Ut([tv(ev.Flag.Primary,Nf.create())],"Rotate","Drag using ${triggers}"),dragRotateZ:Ut([tv(ev.Flag.Primary,Nf.create({shift:!0,control:!0}))],"Rotate around z-axis (roll)","Drag using ${triggers}"),dragPan:Ut([tv(ev.Flag.Secondary,Nf.create()),tv(ev.Flag.Primary,Nf.create({control:!0}))],"Pan","Drag using ${triggers}"),dragZoom:Ut.Empty,dragFocus:Ut([tv(ev.Flag.Forth,Nf.create())],"Focus","Drag using ${triggers}"),dragFocusZoom:Ut([tv(ev.Flag.Auxilary,Nf.create())],"Focus and zoom","Drag using ${triggers}"),scrollZoom:Ut([tv(ev.Flag.Auxilary,Nf.create())],"Zoom","Scroll using ${triggers}"),scrollFocus:Ut([tv(ev.Flag.Auxilary,Nf.create({shift:!0}))],"Clip","Scroll using ${triggers}"),scrollFocusZoom:Ut.Empty,keyMoveForward:Ut([Nd("KeyW")],"Move forward","Press ${triggers}"),keyMoveBack:Ut([Nd("KeyS")],"Move back","Press ${triggers}"),keyMoveLeft:Ut([Nd("KeyA")],"Move left","Press ${triggers}"),keyMoveRight:Ut([Nd("KeyD")],"Move right","Press ${triggers}"),keyMoveUp:Ut([Nd("KeyR")],"Move up","Press ${triggers}"),keyMoveDown:Ut([Nd("KeyF")],"Move down","Press ${triggers}"),keyRollLeft:Ut([Nd("KeyQ")],"Roll left","Press ${triggers}"),keyRollRight:Ut([Nd("KeyE")],"Roll right","Press ${triggers}"),keyPitchUp:Ut([Nd("ArrowUp",Nf.create({shift:!0}))],"Pitch up","Press ${triggers}"),keyPitchDown:Ut([Nd("ArrowDown",Nf.create({shift:!0}))],"Pitch down","Press ${triggers}"),keyYawLeft:Ut([Nd("ArrowLeft",Nf.create({shift:!0}))],"Yaw left","Press ${triggers}"),keyYawRight:Ut([Nd("ArrowRight",Nf.create({shift:!0}))],"Yaw right","Press ${triggers}"),boostMove:Ut([Nd("ShiftLeft")],"Boost move","Press ${triggers}"),enablePointerLock:Ut([Nd("Space",Nf.create({control:!0}))],"Enable pointer lock","Press ${triggers}")},r0e={noScroll:I.Boolean(!0,{isHidden:!0}),rotateSpeed:I.Numeric(5,{min:1,max:10,step:1}),zoomSpeed:I.Numeric(7,{min:1,max:15,step:1}),panSpeed:I.Numeric(1,{min:.1,max:5,step:.1}),moveSpeed:I.Numeric(.75,{min:.1,max:3,step:.1}),boostMoveFactor:I.Numeric(5,{min:.1,max:10,step:.1}),flyMode:I.Boolean(!1),animate:I.MappedStatic("off",{off:I.EmptyGroup(),spin:I.Group({speed:I.Numeric(1,{min:-20,max:20,step:1})},{description:"Spin the 3D scene around the x-axis in view space"}),rock:I.Group({speed:I.Numeric(.3,{min:-5,max:5,step:.1}),angle:I.Numeric(10,{min:0,max:90,step:1},{description:"How many degrees to rotate in each direction."})},{description:"Rock the 3D scene around the x-axis in view space"})}),staticMoving:I.Boolean(!0,{isHidden:!0}),dynamicDampingFactor:I.Numeric(.2,{},{isHidden:!0}),minDistance:I.Numeric(.01,{},{isHidden:!0}),maxDistance:I.Numeric(1e150,{},{isHidden:!0}),gestureScaleFactor:I.Numeric(1,{},{isHidden:!0}),maxWheelDelta:I.Numeric(.02,{},{isHidden:!0}),bindings:I.Value(n0e,{isHidden:!0}),autoAdjustMinMaxDistance:I.MappedStatic("on",{off:I.EmptyGroup(),on:I.Group({minDistanceFactor:I.Numeric(0),minDistancePadding:I.Numeric(5),maxDistanceFactor:I.Numeric(10),maxDistanceMin:I.Numeric(20)})},{isHidden:!0})};var wq,IF;!function(e){e.create=function t(n,r,i,o={}){const s={...I.getDefaultValues(r0e),...o,bindings:{...n0e,...o.bindings}},a=s.bindings,l=Da.clone(r.viewport);let c=!1;const u=n.drag.subscribe(function ti({x:gt,y:Jt,pageX:_n,pageY:Xi,buttons:Sc,modifiers:vu,isStart:od}){const sd=Mt(gt,Jt);if(od&&sd||!od&&!_)return;_=!0,Qe();const wv=Ut.match(a.dragRotate,Sc,vu),Av=Ut.match(a.dragRotateZ,Sc,vu),NI=Ut.match(a.dragPan,Sc,vu),FI=Ut.match(a.dragZoom,Sc,vu),OI=Ut.match(a.dragFocus,Sc,vu),V2=Ut.match(a.dragFocusZoom,Sc,vu);se(_n,Xi),function Z(gt,Jt){Ue.set(G,(gt-l.x)/l.width,(Jt-l.y)/l.height)}(_n,Xi);const BI=n.pixelRatio,LI=(gt*BI-l.width/2-l.x)/l.width,jI=-(n.height-Jt*BI-l.height/2-l.y)/l.height;if(od&&(wv&&(Ue.copy(E,ee),Ue.copy(M,E)),Av&&(Ue.set(R,LI,jI),Ue.copy(F,R)),(FI||V2)&&(Ue.copy(z,G),Ue.copy($,z)),OI&&(Ue.copy(V,G),Ue.copy(X,V)),NI&&(Ue.copy(H,G),Ue.copy(oe,H))),wv&&Ue.copy(E,ee),Av&&Ue.set(R,LI,jI),(FI||V2)&&Ue.copy($,G),OI&&Ue.copy(X,G),V2){const H2=C.distance(r.state.position,r.state.target);r.setState({radius:H2/5})}NI&&Ue.copy(oe,G)}),d=n.interactionEnd.subscribe(function ut(){_=!1}),f=n.wheel.subscribe(function Et({x:gt,y:Jt,spinX:_n,spinY:Xi,dz:Sc,buttons:vu,modifiers:od}){if(Mt(gt,Jt))return;let sd=function SFe(...e){let t=0,n=0;for(let r=0,i=e.length;r<i;++r){const o=e[r],s=Math.abs(o);s>n&&(t=o,n=s)}return t}(.075*_n,.075*Xi,1e-4*Sc);sd<-s.maxWheelDelta?sd=-s.maxWheelDelta:sd>s.maxWheelDelta&&(sd=s.maxWheelDelta),Ut.match(a.scrollZoom,vu,od)&&($[1]+=sd),Ut.match(a.scrollFocus,vu,od)&&(X[1]+=sd)}),p=n.pinch.subscribe(function Nt({fractionDelta:gt,buttons:Jt,modifiers:_n}){Ut.match(a.scrollZoom,Jt,_n)&&(_=!0,$[1]+=s.gestureScaleFactor*gt)}),m=n.gesture.subscribe(function ye({deltaScale:gt}){_=!0,$[1]+=s.gestureScaleFactor*gt}),h=n.keyDown.subscribe(function Te({modifiers:gt,code:Jt,key:_n,x:Xi,y:Sc}){Mt(Xi,Sc)||(Ut.matchKey(a.keyMoveForward,Jt,gt,_n)?Ge.moveForward=1:Ut.matchKey(a.keyMoveBack,Jt,gt,_n)?Ge.moveBack=1:Ut.matchKey(a.keyMoveLeft,Jt,gt,_n)?Ge.moveLeft=1:Ut.matchKey(a.keyMoveRight,Jt,gt,_n)?Ge.moveRight=1:Ut.matchKey(a.keyMoveUp,Jt,gt,_n)?Ge.moveUp=1:Ut.matchKey(a.keyMoveDown,Jt,gt,_n)?Ge.moveDown=1:Ut.matchKey(a.keyRollLeft,Jt,gt,_n)?Ge.rollLeft=1:Ut.matchKey(a.keyRollRight,Jt,gt,_n)?Ge.rollRight=1:Ut.matchKey(a.keyPitchUp,Jt,gt,_n)?Ge.pitchUp=1:Ut.matchKey(a.keyPitchDown,Jt,gt,_n)?Ge.pitchDown=1:Ut.matchKey(a.keyYawLeft,Jt,gt,_n)?Ge.yawLeft=1:Ut.matchKey(a.keyYawRight,Jt,gt,_n)&&(Ge.yawRight=1),Ut.matchKey(a.boostMove,Jt,gt,_n)&&(Ge.boostMove=1),Ut.matchKey(a.enablePointerLock,Jt,gt,_n)&&n.requestPointerLock(l))}),g=n.keyUp.subscribe(function je({modifiers:gt,code:Jt,key:_n,x:Xi,y:Sc}){var vu,od,sd,wv,Av,NI,FI,OI,V2,BI,LI,jI;if(Mt(Xi,Sc))return;let H2=!1;Jt.startsWith("Alt")?(H2=!0,gt.alt=!0):Jt.startsWith("Shift")?(H2=!0,gt.shift=!0):Jt.startsWith("Control")?(H2=!0,gt.control=!0):Jt.startsWith("Meta")&&(H2=!0,gt.meta=!0);const Gd=[];H2?(Ge.moveForward&&Gd.push((null===(vu=a.keyMoveForward.triggers[0])||void 0===vu?void 0:vu.code)||""),Ge.moveBack&&Gd.push((null===(od=a.keyMoveBack.triggers[0])||void 0===od?void 0:od.code)||""),Ge.moveLeft&&Gd.push((null===(sd=a.keyMoveLeft.triggers[0])||void 0===sd?void 0:sd.code)||""),Ge.moveRight&&Gd.push((null===(wv=a.keyMoveRight.triggers[0])||void 0===wv?void 0:wv.code)||""),Ge.moveUp&&Gd.push((null===(Av=a.keyMoveUp.triggers[0])||void 0===Av?void 0:Av.code)||""),Ge.moveDown&&Gd.push((null===(NI=a.keyMoveDown.triggers[0])||void 0===NI?void 0:NI.code)||""),Ge.rollLeft&&Gd.push((null===(FI=a.keyRollLeft.triggers[0])||void 0===FI?void 0:FI.code)||""),Ge.rollRight&&Gd.push((null===(OI=a.keyRollRight.triggers[0])||void 0===OI?void 0:OI.code)||""),Ge.pitchUp&&Gd.push((null===(V2=a.keyPitchUp.triggers[0])||void 0===V2?void 0:V2.code)||""),Ge.pitchDown&&Gd.push((null===(BI=a.keyPitchDown.triggers[0])||void 0===BI?void 0:BI.code)||""),Ge.yawLeft&&Gd.push((null===(LI=a.keyYawLeft.triggers[0])||void 0===LI?void 0:LI.code)||""),Ge.yawRight&&Gd.push((null===(jI=a.keyYawRight.triggers[0])||void 0===jI?void 0:jI.code)||"")):Gd.push(Jt);for(const rh of Gd)Ut.matchKey(a.keyMoveForward,rh,gt,_n)?Ge.moveForward=0:Ut.matchKey(a.keyMoveBack,rh,gt,_n)?Ge.moveBack=0:Ut.matchKey(a.keyMoveLeft,rh,gt,_n)?Ge.moveLeft=0:Ut.matchKey(a.keyMoveRight,rh,gt,_n)?Ge.moveRight=0:Ut.matchKey(a.keyMoveUp,rh,gt,_n)?Ge.moveUp=0:Ut.matchKey(a.keyMoveDown,rh,gt,_n)?Ge.moveDown=0:Ut.matchKey(a.keyRollLeft,rh,gt,_n)?Ge.rollLeft=0:Ut.matchKey(a.keyRollRight,rh,gt,_n)?Ge.rollRight=0:Ut.matchKey(a.keyPitchUp,rh,gt,_n)?Ge.pitchUp=0:Ut.matchKey(a.keyPitchDown,rh,gt,_n)?Ge.pitchDown=0:Ut.matchKey(a.keyYawLeft,rh,gt,_n)?Ge.yawLeft=0:Ut.matchKey(a.keyYawRight,rh,gt,_n)&&(Ge.yawRight=0);Ut.matchKey(a.boostMove,Jt,gt,_n)&&(Ge.boostMove=0)}),y=n.move.subscribe(function we({movementX:gt,movementY:Jt}){if(!n.pointerLock||void 0===gt||void 0===Jt)return;const _n=.5*l.width-l.x,Xi=.5*l.height-l.y;Ue.copy(M,se(_n,Xi)),Ue.copy(E,se(gt+_n,Jt+Xi))}),v=n.lock.subscribe(function pn(gt){gt?Ft():Vt()}),x=n.leave.subscribe(function Jn(){!function Pr(){Ge.moveForward=0,Ge.moveBack=0,Ge.moveLeft=0,Ge.moveRight=0,Ge.moveUp=0,Ge.moveDown=0,Ge.rollLeft=0,Ge.rollRight=0,Ge.pitchUp=0,Ge.pitchDown=0,Ge.yawLeft=0,Ge.yawRight=0,Ge.boostMove=0}()});let _=!1;const w=C(),A=C(),M=Ue(),E=Ue(),D=C();let T=0;const F=Ue(),R=Ue();let N=0,j=0,W=0;const z=Ue(),$=Ue(),V=Ue(),X=Ue(),H=Ue(),oe=Ue(),te=C.clone(r.target),K=C.clone(r.position),Q=C.clone(r.up),G=Ue(),ee=Ue();function se(gt,Jt){return Ue.set(ee,(gt-.5*l.width-l.x)/(.5*l.width),(l.height+2*(l.y-Jt))/l.width)}function xe(){return s.rotateSpeed*n.pixelRatio*(n.width/n.height)}const re=C(),ae=Ai(),ge=C(),Ie=C(),me=C(),Ae=C(),ie=Ai(),ue=C(),Fe=Ai(),Ze=C(),q=Ai(),ne=C(),Be=Ue(),$e=C(),nt=C(),Ge={moveUp:0,moveDown:0,moveLeft:0,moveRight:0,moveForward:0,moveBack:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0,boostMove:0},ft=C(),vt=C();function St(){const gt=Math.min(Math.max(1e3*r.state.radiusMax,.01),s.maxDistance);C.squaredMagnitude(A)>gt*gt&&(C.setMagnitude(A,A,gt),C.add(r.position,r.target,A),Ue.copy(z,$),Ue.copy(V,X)),C.squaredMagnitude(A)<s.minDistance*s.minDistance&&(C.setMagnitude(A,A,s.minDistance),C.add(r.position,r.target,A),Ue.copy(z,$),Ue.copy(V,X))}function Mt(gt,Jt){return Jt*=n.pixelRatio,(gt*=n.pixelRatio)>l.x+l.width||n.height-Jt>l.y+l.height||gt<l.x||n.height-Jt<l.y}let Qt=-1;function An(gt){if(Qt===gt)return;const Jt=gt-Qt;Qt>0&&("spin"===s.animate.name?function _c(gt){if("spin"!==s.animate.name||0===s.animate.params.speed||_)return;const Jt=s.animate.params.speed/1e3;ns[0]=60*Math.min(Math.abs(gt),125)/1e3*Jt,Ue.add(E,M,ns)}(Jt):"rock"===s.animate.name&&function vm(gt){if("rock"!==s.animate.name||0===s.animate.params.speed||_)return;const Jt=gt/1e3*s.animate.params.speed,_n=Xr(s.animate.params.angle)/xe(),Xi=Math.sin(Js*Math.PI*2)*_n,Sc=Math.sin((Js+Jt)*Math.PI*2)*_n;id[0]=Sc-Xi,Ue.add(E,M,id),Js+=Jt,Js>=1&&(Js=0)}(Jt)),C.sub(A,r.position,r.target),function he(){const gt=E[0]-M[0],Jt=E[1]-M[1];C.set(Ae,gt,Jt,0);const _n=C.magnitude(Ae)*xe();_n?(C.sub(A,r.position,r.target),C.normalize(ge,A),C.normalize(Ie,r.up),C.normalize(me,C.cross(me,Ie,ge)),C.setMagnitude(Ie,Ie,Jt),C.setMagnitude(me,me,gt),C.add(Ae,Ie,me),C.normalize(re,C.cross(re,Ae,A)),Ai.setAxisAngle(ae,re,_n),C.transformQuat(A,A,ae),C.transformQuat(r.up,r.up,ae),C.copy(D,re),T=_n):!s.staticMoving&&T&&(T*=Math.sqrt(1-s.dynamicDampingFactor),C.sub(A,r.position,r.target),Ai.setAxisAngle(ae,D,T),C.transformQuat(A,A,ae),C.transformQuat(r.up,r.up,ae)),Ue.copy(M,E)}(),function _e(){const gt=(Ge.rollRight-Ge.rollLeft)/45,Jt=(R[0]-F[0])*-Math.sign(R[1]),_n=(R[1]-F[1])*-Math.sign(R[0]),Xi=-s.rotateSpeed*(-Jt+_n)+gt;Xi?(C.normalize(ue,A),Ai.setAxisAngle(ie,ue,Xi),C.transformQuat(r.up,r.up,ie),N=Xi):!s.staticMoving&&N&&(N*=Math.sqrt(1-s.dynamicDampingFactor),C.normalize(ue,A),Ai.setAxisAngle(ie,ue,N),C.transformQuat(r.up,r.up,ie)),Ue.copy(F,R)}(),function ct(){const Jt=(Ge.pitchUp-Ge.pitchDown)/(s.flyMode?360:90)*-s.rotateSpeed;Jt?(C.cross(Ze,A,r.up),C.normalize(Ze,Ze),Ai.setAxisAngle(Fe,Ze,Jt),C.transformQuat(A,A,Fe),C.transformQuat(r.up,r.up,Fe),j=Jt):!s.staticMoving&&j&&(j*=Math.sqrt(1-s.dynamicDampingFactor),C.cross(Ze,A,r.up),C.normalize(Ze,Ze),Ai.setAxisAngle(Fe,Ze,j),C.transformQuat(A,A,Fe),C.transformQuat(r.up,r.up,Fe))}(),function be(){const Jt=(Ge.yawRight-Ge.yawLeft)/(s.flyMode?360:90)*-s.rotateSpeed;Jt?(C.normalize(ne,r.up),Ai.setAxisAngle(q,ne,Jt),C.transformQuat(A,A,q),C.transformQuat(r.up,r.up,q),W=Jt):!s.staticMoving&&W&&(W*=Math.sqrt(1-s.dynamicDampingFactor),C.normalize(ne,r.up),Ai.setAxisAngle(q,ne,W),C.transformQuat(A,A,q),C.transformQuat(r.up,r.up,q))}(),function Ce(){const gt=1+($[1]-z[1])*s.zoomSpeed;1!==gt&&gt>0&&C.scale(A,A,gt),s.staticMoving?Ue.copy(z,$):z[1]+=($[1]-z[1])*s.dynamicDampingFactor}(),function Re(){const gt=(X[1]-V[1])*s.zoomSpeed;if(0!==gt){const Jt=Math.max(1,r.state.radius+r.state.radius*gt);r.setState({radius:Jt})}s.staticMoving?Ue.copy(V,X):V[1]+=(X[1]-V[1])*s.dynamicDampingFactor}(),function ht(){if(Ue.sub(Be,Ue.copy(Be,oe),H),Ue.squaredMagnitude(Be)){const gt=n.pixelRatio*s.panSpeed;Be[0]*=1/r.zoom*r.viewport.width*gt,Be[1]*=1/r.zoom*r.viewport.height*gt,C.cross(nt,C.copy(nt,A),r.up),C.setMagnitude(nt,nt,Be[0]),C.setMagnitude($e,r.up,Be[1]),C.add(nt,nt,$e),C.add(r.position,r.position,nt),C.add(r.target,r.target,nt),s.staticMoving?Ue.copy(H,oe):(Ue.sub(Be,oe,H),Ue.scale(Be,Be,s.dynamicDampingFactor),Ue.add(H,H,Be))}}(),C.add(r.position,r.target,A),St(),Qt>0&&function Pt(gt){C.sub(vt,r.position,r.target);const Jt=Math.max(r.state.minNear,s.minDistance);C.setMagnitude(vt,vt,Jt);const _n=.06*gt*s.moveSpeed*(1===Ge.boostMove?s.boostMoveFactor:1);if(1===Ge.moveForward&&(C.normalize(ft,vt),C.scaleAndSub(r.position,r.position,ft,_n),(s.flyMode||n.pointerLock)&&C.sub(r.target,r.position,vt)),1===Ge.moveBack&&(C.normalize(ft,vt),C.scaleAndAdd(r.position,r.position,ft,_n),(s.flyMode||n.pointerLock)&&C.sub(r.target,r.position,vt)),1===Ge.moveLeft&&(C.cross(ft,vt,r.up),C.normalize(ft,ft),s.flyMode||n.pointerLock?(C.scaleAndAdd(r.position,r.position,ft,_n),C.sub(r.target,r.position,vt)):(C.scaleAndSub(r.position,r.position,ft,_n),C.sub(r.target,r.position,A))),1===Ge.moveRight&&(C.cross(ft,vt,r.up),C.normalize(ft,ft),s.flyMode||n.pointerLock?(C.scaleAndSub(r.position,r.position,ft,_n),C.sub(r.target,r.position,vt)):(C.scaleAndAdd(r.position,r.position,ft,_n),C.sub(r.target,r.position,A))),1===Ge.moveUp&&(C.normalize(ft,r.up),s.flyMode||n.pointerLock?(C.scaleAndAdd(r.position,r.position,ft,_n),C.sub(r.target,r.position,vt)):(C.scaleAndSub(r.position,r.position,ft,_n),C.sub(r.target,r.position,A))),1===Ge.moveDown&&(C.normalize(ft,r.up),s.flyMode||n.pointerLock?(C.scaleAndSub(r.position,r.position,ft,_n),C.sub(r.target,r.position,vt)):(C.scaleAndAdd(r.position,r.position,ft,_n),C.sub(r.target,r.position,A))),s.flyMode||n.pointerLock){const Xi=C.distance(r.position,i.boundingSphereVisible.center);r.setState({minFar:Xi+i.boundingSphereVisible.radius})}}(Math.min(Jt,250)),C.sub(A,r.position,r.target),St(),C.squaredDistance(w,r.position)>wi&&C.copy(w,r.position),Qt=gt}function Ft(){C.sub(vt,r.position,r.target);const gt=Math.max(r.state.minNear,s.minDistance);C.setMagnitude(vt,vt,gt),C.sub(r.target,r.position,vt);const Jt=C.distance(r.position,i.boundingSphereVisible.center);r.setState({minFar:Jt+i.boundingSphereVisible.radius})}function Vt(){const{center:gt,radius:Jt}=i.boundingSphereVisible;if(C.distance(r.position,gt)>Jt){const Xi=r.getFocus(gt,Jt);r.setState({...Xi,minFar:0})}else r.setState({minFar:0,radius:i.boundingSphereVisible.radius})}const ns=Ue.create(.005,0);let Js=0;const id=Ue.create(.005,0);function Qe(){Js=0}return{viewport:l,get isAnimating(){return"off"!==s.animate.name},get isMoving(){return 1===Ge.moveForward||1===Ge.moveBack||1===Ge.moveLeft||1===Ge.moveRight||1===Ge.moveUp||1===Ge.moveDown||1===Ge.rollLeft||1===Ge.rollRight||1===Ge.pitchUp||1===Ge.pitchDown||1===Ge.yawLeft||1===Ge.yawRight},get props(){return s},setProps:gt=>{var Jt;"rock"===(null===(Jt=gt.animate)||void 0===Jt?void 0:Jt.name)&&"rock"!==s.animate.name&&Qe(),void 0!==gt.flyMode&&gt.flyMode!==s.flyMode&&(gt.flyMode?Ft():Vt()),Object.assign(s,gt),Object.assign(a,gt.bindings)},start:function Mn(gt){Qt=-1,An(gt)},update:An,reset:function Kn(){C.copy(r.target,te),C.copy(r.position,K),C.copy(r.up,Q),C.sub(A,r.position,r.target),C.copy(w,r.position)},dispose:function bi(){c||(c=!0,u.unsubscribe(),f.unsubscribe(),p.unsubscribe(),m.unsubscribe(),d.unsubscribe(),h.unsubscribe(),g.unsubscribe(),y.unsubscribe(),v.unsubscribe(),x.unsubscribe())}}}}(wq||(wq={})),function(e){e.create=function t(){return{view:fe.identity(),position:C.create(0,0,0),direction:C.create(0,0,-1),up:C.create(0,1,0)}};const n=C.zero();e.update=function r(i){C.add(n,i.position,i.direction),fe.lookAt(i.view,i.position,n,i.up)}}(IF||(IF={}));class Qct{constructor(){this.removeList=KU(),this.removeMap=new Map,this.addList=KU(),this.addMap=new Map}get isEmpty(){return 0===this.removeList.count&&0===this.addList.count}get size(){return this.removeMap.size+this.addMap.size}add(t){if(this.removeMap.has(t)){const r=this.removeMap.get(t);this.removeMap.delete(t),this.removeList.remove(r)}if(this.addMap.has(t))return;const n=this.addList.addLast(t);this.addMap.set(t,n)}remove(t){if(this.addMap.has(t)){const r=this.addMap.get(t);this.addMap.delete(t),this.addList.remove(r)}if(this.removeMap.has(t))return;const n=this.removeList.addLast(t);this.removeMap.set(t,n)}tryGetRemove(){const t=this.removeList.removeFirst();return t&&this.removeMap.delete(t),t}tryGetAdd(){const t=this.addList.removeFirst();return t&&this.addMap.delete(t),t}}const AP=new xf("98");function i0e(e,t,n){AP.reset();for(let r=0,i=e.length;r<i;++r){if(n&&!e[r].state.visible)continue;const o=e[r].values.boundingSphere.ref.value;o.radius&&AP.includeSphere(o)}AP.finishedIncludeStep();for(let r=0,i=e.length;r<i;++r){if(n&&!e[r].state.visible)continue;const o=e[r].values.boundingSphere.ref.value;o.radius&&AP.radiusSphere(o)}return AP.getSphere(t)}function Jct(e,t){const n=e.getProgram("color").id,r=t.getProgram("color").id,i=e.materialId,o=t.materialId;return n!==r?n-r:i!==o?i-o:e.id-t.id}var _A;!function(e){e.create=function t(n,r="blended"){const i=new Map,o=[],s=ke(),a=ke(),l=[],c=[];let u=!0,d=!0,f=!0,p=!0,m=!0,h=0,g=0,y=!1;const v=IF.create(),{view:x,position:_,direction:w,up:A}=v;function M(V){if(i.has(V))console.warn(`RenderObject with id '${V.id}' already present`);else{const X=function eQe(e,t,n){switch(t.type){case"mesh":return function LZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...BZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",Yue,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"points":return function UZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...jZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"points",F$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"spheres":return function GZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...HZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",O$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"cylinders":return function QZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...ZZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",B$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"text":return function WZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...qZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",L$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"lines":return function VZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...zZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",j$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"direct-volume":return function OZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...FZe};e.isWebGL2||(s.uMaxSteps=cn("number"));const a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",U$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"image":return function KZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...XZe},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",z$e,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n);case"texture-mesh":return function YZe(e,t,n,r,i,o){const s={...wy,...Ay,...Iy,...$Ze},a={uObjectId:O.create(t)};return Dy(Ty(e,"triangles",Yue,s,{...n,...a},i,o),n,r)}(e,t.id,t.values,t.state,t.materialId,n)}throw new Error("unsupported type")}(n,V,r);o.push(X),"direct-volume"===V.type?c.push(X):l.push(X),i.set(V,X),u=!0,d=!0}}function E(V){const X=i.get(V);X&&(X.dispose(),$x(o,X),$x(l,X),$x(c,X),i.delete(V),u=!0,d=!0)}const F=new Qct;let R=-1;function j(){const V=function N(){let V=23;for(let X=0,H=o.length;X<H;++X)o[X].state.visible&&(V=31*V+o[X].id|0);return V=Soe(V),-1===V&&(V=0),V}();return V!==R&&(d=!0,f=!0,p=!0,m=!0,R=V,!0)}return{view:x,position:_,direction:w,up:A,renderables:o,primitives:{view:x,position:_,direction:w,up:A,renderables:l},volumes:{view:x,position:_,direction:w,up:A,renderables:c},syncVisibility:j,setTransparency:V=>{r=V;for(let X=0,H=o.length;X<H;++X)o[X].setTransparency(V)},update(V,X){var H;if(IF.update(v),V)for(let oe=0,te=V.length;oe<te;++oe)null===(H=i.get(V[oe]))||void 0===H||H.update();else for(let oe=0,te=o.length;oe<te;++oe)o[oe].update();X?j():(u=!0,d=!0),f=!0,p=!0,m=!0},add:V=>F.add(V),remove:V=>F.remove(V),commit:(V=Number.MAX_VALUE)=>function T(V){const X=Bo();let H=0;for(;;){const oe=F.tryGetRemove();if(!oe)break;if(E(oe),++H%100==0&&Bo()-X>V)return!1}for(;;){const oe=F.tryGetAdd();if(!oe)break;if(M(oe),++H%100==0&&Bo()-X>V)return!1}return o.sort(Jct),f=!0,p=!0,m=!0,!0}(V),get commitQueueSize(){return F.size},get needsCommit(){return!F.isEmpty},has:V=>i.has(V),clear:()=>{for(let V=0,X=o.length;V<X;++V)o[V].dispose();o.length=0,l.length=0,c.length=0,i.clear(),u=!0,d=!0},forEach:V=>{i.forEach(V)},get count(){return o.length},get boundingSphere(){return u&&(i0e(o,s,!1),u=!1),s},get boundingSphereVisible(){return d&&(i0e(o,a,!0),d=!1),a},get markerAverage(){return f&&(h=function W(){if(0===l.length)return 0;let V=0,X=0;for(let H=0,oe=l.length;H<oe;++H)l[H].state.visible&&(X+=l[H].values.markerAverage.ref.value,V+=1);return V>0?X/V:0}(),f=!1),h},get opacityAverage(){return p&&(g=function z(){var V,X;if(0===l.length)return 0;let H=0,oe=0;for(let te=0,K=l.length;te<K;++te){const Q=l[te];if(!Q.state.visible)continue;const G=al(Q.values.alpha.ref.value*Q.state.alphaFactor,0,1),Z=null!==(V=Q.values.dXrayShaded)&&void 0!==V&&V.ref.value?.5:1,ee="fuzzy"===(null===(X=Q.values.dPointStyle)||void 0===X?void 0:X.ref.value)?.5:1;oe+=(1-Q.values.transparencyAverage.ref.value)*G*Z*ee*("text"===Q.values.dGeometryType.ref.value?.5:1),H+=1}return H>0?oe/H:0}(),p=!1),g},get hasOpaque(){return m&&(y=function $(){var V;if(0===l.length)return!1;for(let X=0,H=l.length;X<H;++X){const oe=l[X];if(oe.state.visible&&(oe.state.opaque||1===oe.state.alphaFactor&&1===oe.values.alpha.ref.value&&1!==oe.values.transparencyAverage.ref.value||"opaque"===(null===(V=oe.values.dTransparentBackfaces)||void 0===V?void 0:V.ref.value)))return!0}return!1}(),m=!1),y}}}}(_A||(_A={}));class SA{get source(){return this._source}get target(){return this._target}apply(t,n=0,r){(!this.inTransition||n>0)&&Si.copySnapshot(this._source,this.camera.state),this.inTransition||Si.copySnapshot(this._target,this.camera.state),Si.copySnapshot(this._target,t),this._target.radius>this._target.radiusMax&&(this._target.radius=this._target.radiusMax),this._target.radius<.01&&(this._target.radius=.01),this._target.radiusMax<.01&&(this._target.radiusMax=.01),!this.inTransition&&n<=0||typeof t.mode<"u"&&t.mode!==this.camera.state.mode?this.finish(this._target):(this.inTransition=!0,this.func=r||SA.defaultTransition,(!this.inTransition||n>0)&&(this.start=this.t,this.durationMs=n))}tick(t){this.t=t,this.update()}finish(t){Si.copySnapshot(this.camera.state,t),this.inTransition=!1}update(){if(!this.inTransition)return;const t=Math.min((this.t-this.start)/this.durationMs,1);1!==t?(this.func(this._current,t,this._source,this._target),Si.copySnapshot(this.camera.state,this._current)):this.finish(this._target)}constructor(t){this.camera=t,this.t=0,this.func=SA.defaultTransition,this.start=0,this.inTransition=!1,this.durationMs=0,this._source=Si.createDefaultSnapshot(),this._target=Si.createDefaultSnapshot(),this._current=Si.createDefaultSnapshot()}}!function(e){const t=Ai.identity();e.defaultTransition=function n(r,i,o,s){Si.copySnapshot(r,s),Ai.slerp(t,Ai.Identity,Ai.rotationTo(t,o.up,s.up),i),C.transformQuat(r.up,o.up,t),C.lerp(r.target,o.target,s.target,i),C.lerp(r.position,o.position,s.position,i),r.radius=Po(o.radius,s.radius,i),r.radiusMax=Po(o.radiusMax,s.radiusMax,i),r.fov=Po(o.fov,s.fov,i),r.fog=Po(o.fog,s.fog,i)}}(SA||(SA={}));const o0e=C(),s0e=C(),EF=Bn();class Si{get position(){return this.state.position}set position(t){C.copy(this.state.position,t)}get up(){return this.state.up}set up(t){C.copy(this.state.up,t)}get target(){return this.state.target}set target(t){C.copy(this.state.target,t)}update(){const t=this.state;if(0===t.radiusMax)return!1;const n=2*Math.tan(t.fov/2)*C.distance(t.position,t.target);switch(this.zoom=this.viewport.height/n,function nut(e){let{radius:t,radiusMax:n,fog:i,clipFar:o,minNear:s,minFar:a}=e.state;t<.01&&(t=.01);const l=Math.max(o?t:n,a),c=C.distance(e.position,e.target);let u=c-t,d=c+l;u=Math.max(Math.min(n,s),u),d=Math.max(s,d),u===d&&(d=u+.01);const p=c-l*(-(50-i)/50),m=d;e.near=u,e.far=d,e.fogNear=p,e.fogFar=m}(this),this.state.mode){case"orthographic":!function eut(e){const{viewport:t,zoom:n,near:r,far:i,viewOffset:o}=e,s=-t.width/2,a=t.width/2,l=t.height/2,c=-t.height/2,u=(a-s)/(2*n),d=(l-c)/(2*n),f=(a+s)/2,p=(l+c)/2;let m=f-u,h=f+u,g=p+d,y=p-d;if(o.enabled){const v=n/(o.width/o.fullWidth),x=n/(o.height/o.fullHeight),_=(a-s)/o.width,w=(l-c)/o.height;m+=_*(o.offsetX/v),h=m+_*(o.width/v),g-=w*(o.offsetY/x),y=g-w*(o.height/x)}fe.ortho(e.projection,m,h,g,y,r,i),fe.lookAt(e.view,e.position,e.target,e.up)}(this);break;case"perspective":!function tut(e){const t=e.viewport.width/e.viewport.height,{near:n,far:r,viewOffset:i}=e;let o=n*Math.tan(.5*e.state.fov),s=2*o,a=t*s,l=-.5*a;i.enabled&&(l+=i.offsetX*a/i.fullWidth,o-=i.offsetY*s/i.fullHeight,a*=i.width/i.fullWidth,s*=i.height/i.fullHeight),fe.perspective(e.projection,l,l+a,o,o-s,n,r),fe.lookAt(e.view,e.position,e.target,e.up)}(this);break;default:Hi()}const r=!fe.areEqual(this.projection,this.prevProjection,wi)||!fe.areEqual(this.view,this.prevView,wi);if(r){if(fe.mul(this.projectionView,this.projection,this.view),!fe.tryInvert(this.inverseProjectionView,this.projectionView))return fe.copy(this.view,this.prevView),fe.copy(this.projection,this.prevProjection),fe.mul(this.projectionView,this.projection,this.view),!1;fe.copy(this.prevView,this.view),fe.copy(this.prevProjection,this.projection)}return r}setState(t,n){this.transition.apply(t,n),this.stateChanged.next(t)}getSnapshot(){return Si.copySnapshot(Si.createDefaultSnapshot(),this.state)}getTargetDistance(t){return Si.targetDistance(t,this.state.mode,this.state.fov,this.viewport.width,this.viewport.height)}getFocus(t,n,r,i,o){var s,a;const l=Math.max(n,.01),c=this.getTargetDistance(l);C.sub(this.deltaDirection,null!==(s=o?.target)&&void 0!==s?s:this.target,null!==(a=o?.position)&&void 0!==a?a:this.position),i&&C.matchDirection(this.deltaDirection,i,this.deltaDirection),C.setMagnitude(this.deltaDirection,this.deltaDirection,c),C.sub(this.newPosition,t,this.deltaDirection);const u=Si.copySnapshot(Si.createDefaultSnapshot(),this.state);return u.target=C.clone(t),u.radius=l,u.position=C.clone(this.newPosition),r&&C.matchDirection(u.up,r,u.up),u}getCenter(t,n){C.sub(this.deltaDirection,this.target,this.position),C.sub(this.newPosition,t,this.deltaDirection);const r=Si.copySnapshot(Si.createDefaultSnapshot(),this.state);return r.target=C.clone(t),r.position=C.clone(this.newPosition),n&&(r.radius=Math.max(n,.01)),r}getInvariantFocus(t,n,r,i){const o=Math.max(n,.01),s=this.getTargetDistance(o);C.copy(this.deltaDirection,i),C.setMagnitude(this.deltaDirection,this.deltaDirection,s),C.sub(this.newPosition,t,this.deltaDirection);const a=Si.copySnapshot(Si.createDefaultSnapshot(),this.state);return a.target=C.clone(t),a.radius=o,a.position=C.clone(this.newPosition),C.copy(a.up,r),a}focus(t,n,r,i,o){n>0&&this.setState(this.getFocus(t,n,i,o),r)}center(t,n){this.setState(this.getCenter(t),n)}project(t,n){return function Wct(e,t,n,r){const{x:i,y:o,width:s,height:a}=n;Bn.set(Tg,t[0],t[1],t[2],1),Bn.transformMat4(Tg,Tg,r);const l=Tg[3];return 0!==l&&(Tg[0]/=l,Tg[1]/=l,Tg[2]/=l),e[0]=(Tg[0]+1)*s*.5+i,e[1]=(Tg[1]+1)*a*.5+o,e[2]=.5*(Tg[2]+1),e[3]=0===l?0:1/l,e}(t,n,this.viewport,this.projectionView)}unproject(t,n){return CF(t,n,this.viewport,this.inverseProjectionView)}getPixelSize(t){return this.project(EF,t),this.unproject(o0e,EF),EF[0]+=1,this.unproject(s0e,EF),C.distance(o0e,s0e)}constructor(t,n=Da.create(0,0,128,128)){this.view=fe.identity(),this.projection=fe.identity(),this.projectionView=fe.identity(),this.inverseProjectionView=fe.identity(),this.state=Si.createDefaultSnapshot(),this.viewOffset=Si.ViewOffset(),this.near=1,this.far=1e4,this.fogNear=5e3,this.fogFar=1e4,this.zoom=1,this.transition=new SA(this),this.stateChanged=new Ao(this.state),this.prevProjection=fe.identity(),this.prevView=fe.identity(),this.deltaDirection=C(),this.newPosition=C(),this.viewport=n,Si.copySnapshot(this.state,t)}}!function(e){e.ViewOffset=function t(){return{enabled:!1,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}},e.setViewOffset=function n(l,c,u,d,f,p,m){l.fullWidth=c,l.fullHeight=u,l.offsetX=d,l.offsetY=f,l.width=p,l.height=m},e.copyViewOffset=function r(l,c){l.enabled=c.enabled,l.fullWidth=c.fullWidth,l.fullHeight=c.fullHeight,l.offsetX=c.offsetX,l.offsetY=c.offsetY,l.width=c.width,l.height=c.height},e.targetDistance=function i(l,c,u,d,f){const p=Math.max(l,.01),h=f<d?1:d/f;return Math.abs("orthographic"===c?p/h/Math.tan(u/2):p/h/Math.sin(u/2))},e.createDefaultSnapshot=function o(){return{mode:"perspective",fov:Math.PI/4,position:C.create(0,0,100),up:C.create(0,1,0),target:C.create(0,0,0),radius:0,radiusMax:10,fog:50,clipFar:!0,minNear:5,minFar:0}},e.copySnapshot=function s(l,c){return c&&(typeof c.mode<"u"&&(l.mode=c.mode),typeof c.fov<"u"&&(l.fov=c.fov),typeof c.position<"u"&&C.copy(l.position,c.position),typeof c.up<"u"&&C.copy(l.up,c.up),typeof c.target<"u"&&C.copy(l.target,c.target),typeof c.radius<"u"&&(l.radius=c.radius),typeof c.radiusMax<"u"&&(l.radiusMax=c.radiusMax),typeof c.fog<"u"&&(l.fog=c.fog),typeof c.clipFar<"u"&&(l.clipFar=c.clipFar),typeof c.minNear<"u"&&(l.minNear=c.minNear),typeof c.minFar<"u"&&(l.minFar=c.minFar)),l},e.areSnapshotsEqual=function a(l,c){return l.mode===c.mode&&l.fov===c.fov&&l.radius===c.radius&&l.radiusMax===c.radiusMax&&l.fog===c.fog&&l.clipFar===c.clipFar&&l.minNear===c.minNear&&l.minFar===c.minFar&&C.exactEquals(l.position,c.position)&&C.exactEquals(l.up,c.up)&&C.exactEquals(l.target,c.target)}}(Si||(Si={}));const Aq={sceneBoundingSpheres:I.Boolean(!1,{description:"Show full scene bounding spheres."}),visibleSceneBoundingSpheres:I.Boolean(!1,{description:"Show visible scene bounding spheres."}),objectBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible render objects."}),instanceBoundingSpheres:I.Boolean(!1,{description:"Show bounding spheres of visible instances."})};class rut{constructor(t,n,r){this.objectsData=new Map,this.instancesData=new Map,this.scene=_A.create(t,"blended"),this.parent=n,this._props={...I.getDefaultValues(Aq),...r}}update(){const t=TF(this.scene,this.parent.boundingSphere,this.sceneData,qn.lightgrey,out);t&&(this.sceneData=t);const n=TF(this.scene,this.parent.boundingSphereVisible,this.visibleSceneData,qn.black,sut);n&&(this.visibleSceneData=n),this.parent.forEach((r,i)=>{const o=this.objectsData.get(i),s=TF(this.scene,r.values.boundingSphere.ref.value,o,qn.tomato,aut);s&&this.objectsData.set(i,s);const a=this.instancesData.get(i),l=TF(this.scene,r.values.invariantBoundingSphere.ref.value,a,qn.skyblue,lut,{aTransform:i.values.aTransform,matrix:i.values.matrix,transform:i.values.transform,extraTransform:i.values.extraTransform,uInstanceCount:i.values.uInstanceCount,instanceCount:i.values.instanceCount,aInstance:i.values.aInstance,hasReflection:i.values.hasReflection,instanceGrid:i.values.instanceGrid});l&&this.instancesData.set(i,l)}),this.objectsData.forEach((r,i)=>{this.parent.has(i)||(this.scene.remove(r.renderObject),this.objectsData.delete(i))}),this.instancesData.forEach((r,i)=>{this.parent.has(i)||(this.scene.remove(r.renderObject),this.instancesData.delete(i))}),this.scene.update(void 0,!1),this.scene.commit()}syncVisibility(){this.sceneData&&(this.sceneData.renderObject.state.visible=this._props.sceneBoundingSpheres),this.visibleSceneData&&(this.visibleSceneData.renderObject.state.visible=this._props.visibleSceneBoundingSpheres),this.parent.forEach((t,n)=>{const r=this.objectsData.get(n);r&&(r.renderObject.state.visible=n.state.visible&&this._props.objectBoundingSpheres);const i=this.instancesData.get(n);i&&(i.renderObject.state.visible=n.state.visible&&this._props.instanceBoundingSpheres)})}clear(){this.sceneData=void 0,this.objectsData.clear(),this.scene.clear()}get isEnabled(){return this._props.sceneBoundingSpheres||this._props.visibleSceneBoundingSpheres||this._props.objectBoundingSpheres||this._props.instanceBoundingSpheres}get props(){return this._props}setProps(t){Object.assign(this._props,t),this.isEnabled&&this.update()}}function TF(e,t,n,r,i,o){if(!n||!ke.equals(n.boundingSphere,t)){const s=function iut(e,t){const r=qw(2),i=Ct.createState(r,r/2,t);if(e.radius&&(Jr(i,e.center,e.radius,2),ke.hasExtrema(e)))for(const o of e.extrema)Jr(i,o,1,0);return Ct.getMesh(i)}(t,n&&n.mesh),a=n?n.renderObject:function cut(e,t,n,r){return Jw("mesh",on.Utils.createValuesSimple(e,{alpha:.1,doubleSided:!1,cellSize:0,batchSize:0},t,1,r),{disposed:!1,visible:!0,alphaFactor:1,pickable:!1,colorOnly:!1,opaque:!1,writeDepth:!1},n)}(s,r,i,o);return n?O.updateIfChanged(a.values.drawCount,$a.getDrawCount(s)):e.add(a),{boundingSphere:ke.clone(t),renderObject:a,mesh:s}}}const out=ky(),sut=ky(),aut=ky(),lut=ky();var Y_=function(e){return e[e.Move=0]="Move",e[e.Click=1]="Click",e[e.Drag=2]="Drag",e}(Y_||{});const Iq=C(),Eq=C(),a0e=C(),l0e={maxFps:I.Numeric(30,{min:10,max:60,step:10}),preferAtomPixelPadding:I.Numeric(3,{min:0,max:20,step:1},{description:"Number of extra pixels at which to prefer atoms over bonds."})};class uut{setProps(t){Object.assign(this.props,t)}identify(t,n){const r=this.startX!==this.endX||this.startY!==this.endY||this.input.pointerLock&&!this.controls.isMoving;if(t===Y_.Drag)return void(r&&!this.outsideViewport(this.startX,this.startY)&&(this.events.drag.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,pageStart:Ue.create(this.startX,this.startY),pageEnd:Ue.create(this.endX,this.endY)}),this.startX=this.endX,this.startY=this.endY));if(r){const o=this.canvasIdentify(this.endX,this.endY);this.id=o?.id,this.position=o?.position,this.startX=this.endX,this.startY=this.endY}if(t===Y_.Click){const o=this.getLoci(this.id,this.position);return this.events.click.next({current:o,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ue.create(this.endX,this.endY),position:this.position}),void(this.prevLoci=o)}if(!this.inside||this.currentIdentifyT!==n||!r||this.outsideViewport(this.endX,this.endY))return;const i=this.getLoci(this.id,this.position);this.events.hover.next({current:i,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ue.create(this.endX,this.endY),position:this.position}),this.prevLoci=i}tick(t){this.inside&&t-this.prevT>1e3/this.props.maxFps&&(this.prevT=t,this.currentIdentifyT=t,this.identify(this.isInteracting?Y_.Drag:Y_.Move,t))}leave(){this.inside=!1,Xn.Loci.isEmpty(this.prevLoci)||(this.prevLoci=Xn.Loci.Empty,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers}))}move(t,n,r,i,o){this.inside=!0,this.buttons=r,this.button=i,this.modifiers=o,this.endX=t,this.endY=n}click(t,n,r,i,o){this.endX=t,this.endY=n,this.buttons=r,this.button=i,this.modifiers=o,this.identify(Y_.Click,0)}drag(t,n,r,i,o){this.endX=t,this.endY=n,this.buttons=r,this.button=i,this.modifiers=o,this.identify(Y_.Drag,0)}modify(t){Rf.areEqual(t,this.modifiers)||(this.modifiers=t,this.events.hover.next({current:this.prevLoci,buttons:this.buttons,button:this.button,modifiers:this.modifiers,page:Ue.create(this.endX,this.endY),position:this.position}))}outsideViewport(t,n){const{input:r,camera:{viewport:i}}=this;return n*=r.pixelRatio,(t*=r.pixelRatio)>i.x+i.width||r.height-n>i.y+i.height||t<i.x||r.height-n<i.y}getLoci(t,n){var r;const{repr:i,loci:o}=this.lociGetter(t);if(n&&i&&fn.isLoci(o)&&2===o.bonds.length){const{aUnit:s,aIndex:a}=o.bonds[0];s.conformation.position(s.elements[a],Iq),C.sub(a0e,this.camera.state.position,this.camera.state.target),C.projectPointOnPlane(Eq,n,a0e,Iq);const l=this.camera.getPixelSize(Eq);let c=i.theme.size.size(o.bonds[0])*(null!==(r=i.props.sizeFactor)&&void 0!==r?r:1);if(!1===i.props.lineSizeAttenuation&&(c*=l/2),c+=this.props.preferAtomPixelPadding*l,C.distance(Eq,Iq)<c)return{repr:i,loci:fn.toFirstStructureElementLoci(o)}}return{repr:i,loci:o}}dispose(){this.ev.dispose()}constructor(t,n,r,i,o,s={}){this.canvasIdentify=t,this.lociGetter=n,this.input=r,this.camera=i,this.controls=o,this.ev=uy.create(),this.events={hover:this.ev(),drag:this.ev(),click:this.ev()},this.startX=-1,this.startY=-1,this.endX=-1,this.endY=-1,this.id=void 0,this.position=void 0,this.currentIdentifyT=0,this.isInteracting=!1,this.prevLoci=Xn.Loci.Empty,this.prevT=0,this.inside=!1,this.buttons=es.create(0),this.button=es.create(0),this.modifiers=Rf.None,this.props={...I.getDefaultValues(l0e),...s},r.drag.subscribe(({x:a,y:l,buttons:c,button:u,modifiers:d})=>{this.isInteracting=!0,this.drag(a,l,c,u,d)}),r.move.subscribe(({x:a,y:l,inside:c,buttons:u,button:d,modifiers:f,onElement:p})=>{if(c&&!this.isInteracting){if(!p)return void this.leave();this.move(a,l,u,d,f)}}),r.leave.subscribe(()=>{this.leave()}),r.click.subscribe(({x:a,y:l,buttons:c,button:u,modifiers:d})=>{this.outsideViewport(a,l)||this.click(a,l,c,u,d)}),r.interactionEnd.subscribe(()=>{this.isInteracting=!1}),r.modifiers.subscribe(a=>{this.modify(a)})}}const gut={edgeThresholdMin:I.Numeric(.0312,{min:.0312,max:.0833,step:1e-4},{description:"Trims the algorithm from processing darks."}),edgeThresholdMax:I.Numeric(.063,{min:.063,max:.333,step:.001},{description:"The minimum amount of local contrast required to apply algorithm."}),iterations:I.Numeric(12,{min:0,max:16,step:1},{description:"Number of edge exploration steps."}),subpixelQuality:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Choose the amount of sub-pixel aliasing removal."})};class yut{constructor(t,n){this.webgl=t,this.renderable=function xut(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ua,tColor:O.create(t),uTexSizeInv:O.create(Ue.create(1/n,1/r)),dEdgeThresholdMin:O.create(.0312),dEdgeThresholdMax:O.create(.125),dIterations:O.create(12),dSubpixelQuality:O.create(.3)},o={...but};return ys(ms(e,"triangles",vut,o,i),i)}(t,n)}updateState(t){const{gl:n,state:r}=this.webgl;r.enable(n.SCISSOR_TEST),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.depthMask(!1);const{x:i,y:o,width:s,height:a}=t;r.viewport(i,o,s,a),r.scissor(i,o,s,a),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)}setSize(t,n){O.update(this.renderable.values.uTexSizeInv,Ue.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/n))}update(t,n){const{values:r}=this.renderable,{edgeThresholdMin:i,edgeThresholdMax:o,iterations:s,subpixelQuality:a}=n;let l=!1;r.tColor.ref.value!==t&&(O.update(this.renderable.values.tColor,t),l=!0),r.dEdgeThresholdMin.ref.value!==i&&(l=!0),O.updateIfChanged(r.dEdgeThresholdMin,i),r.dEdgeThresholdMax.ref.value!==o&&(l=!0),O.updateIfChanged(r.dEdgeThresholdMax,o),r.dIterations.ref.value!==s&&(l=!0),O.updateIfChanged(r.dIterations,s),r.dSubpixelQuality.ref.value!==a&&(l=!0),O.updateIfChanged(r.dSubpixelQuality,a),l&&this.renderable.update()}render(t,n){It&&this.webgl.timer.mark("FxaaPass.render"),n?n.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),It&&this.webgl.timer.markEnd("FxaaPass.render")}}const but={...ca,tColor:xn("texture","rgba","ubyte","linear"),uTexSizeInv:Ne("v2"),dEdgeThresholdMin:cn("number"),dEdgeThresholdMax:cn("number"),dIterations:cn("number"),dSubpixelQuality:cn("number")},vut=Wi("fxaa",hl,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\n// adapted from https://github.com/kosua20/Rendu\n// MIT License Copyright (c) 2017 Simon Rodriguez\n\n#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))\n\nfloat rgb2luma(vec3 rgb){\n    return sqrt(dot(rgb, vec3(0.299, 0.587, 0.114)));\n}\n\nfloat sampleLuma(vec2 uv) {\n    return rgb2luma(texture2D(tColor, uv).rgb);\n}\n\nfloat sampleLuma(vec2 uv, float uOffset, float vOffset) {\n    uv += uTexSizeInv * vec2(uOffset, vOffset);\n    return sampleLuma(uv);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec2 inverseScreenSize = uTexSizeInv;\n\n    vec4 colorCenter = texture2D(tColor, coords);\n\n    // Luma at the current fragment\n    float lumaCenter = rgb2luma(colorCenter.rgb);\n\n    // Luma at the four direct neighbours of the current fragment.\n    float lumaDown = sampleLuma(coords, 0.0, -1.0);\n    float lumaUp = sampleLuma(coords, 0.0, 1.0);\n    float lumaLeft = sampleLuma(coords, -1.0, 0.0);\n    float lumaRight = sampleLuma(coords, 1.0, 0.0);\n\n    // Find the maximum and minimum luma around the current fragment.\n    float lumaMin = min(lumaCenter, min(min(lumaDown, lumaUp), min(lumaLeft, lumaRight)));\n    float lumaMax = max(lumaCenter, max(max(lumaDown, lumaUp), max(lumaLeft, lumaRight)));\n\n    // Compute the delta.\n    float lumaRange = lumaMax - lumaMin;\n\n    // If the luma variation is lower that a threshold (or if we are in a really dark area),\n    // we are not on an edge, don't perform any AA.\n    if (lumaRange < max(dEdgeThresholdMin, lumaMax * dEdgeThresholdMax)) {\n        gl_FragColor = colorCenter;\n        return;\n    }\n\n    // Query the 4 remaining corners lumas.\n    float lumaDownLeft = sampleLuma(coords, -1.0, -1.0);\n    float lumaUpRight = sampleLuma(coords, 1.0, 1.0);\n    float lumaUpLeft = sampleLuma(coords, -1.0, 1.0);\n    float lumaDownRight = sampleLuma(coords, 1.0, -1.0);\n\n    // Combine the four edges lumas (using intermediary variables for future computations\n    // with the same values).\n    float lumaDownUp = lumaDown + lumaUp;\n    float lumaLeftRight = lumaLeft + lumaRight;\n\n    // Same for corners\n    float lumaLeftCorners = lumaDownLeft + lumaUpLeft;\n    float lumaDownCorners = lumaDownLeft + lumaDownRight;\n    float lumaRightCorners = lumaDownRight + lumaUpRight;\n    float lumaUpCorners = lumaUpRight + lumaUpLeft;\n\n    // Compute an estimation of the gradient along the horizontal and vertical axis.\n    float edgeHorizontal = abs(-2.0 * lumaLeft + lumaLeftCorners) + abs(-2.0 * lumaCenter + lumaDownUp) * 2.0 + abs(-2.0 * lumaRight + lumaRightCorners);\n    float edgeVertical = abs(-2.0 * lumaUp + lumaUpCorners) + abs(-2.0 * lumaCenter + lumaLeftRight) * 2.0 + abs(-2.0 * lumaDown + lumaDownCorners);\n\n    // Is the local edge horizontal or vertical ?\n    bool isHorizontal = (edgeHorizontal >= edgeVertical);\n\n    // Choose the step size (one pixel) accordingly.\n    float stepLength = isHorizontal ? inverseScreenSize.y : inverseScreenSize.x;\n\n    // Select the two neighboring texels lumas in the opposite direction to the local edge.\n    float luma1 = isHorizontal ? lumaDown : lumaLeft;\n    float luma2 = isHorizontal ? lumaUp : lumaRight;\n    // Compute gradients in this direction.\n    float gradient1 = luma1 - lumaCenter;\n    float gradient2 = luma2 - lumaCenter;\n\n    // Which direction is the steepest ?\n    bool is1Steepest = abs(gradient1) >= abs(gradient2);\n\n    // Gradient in the corresponding direction, normalized.\n    float gradientScaled = 0.25 * max(abs(gradient1), abs(gradient2));\n\n    // Average luma in the correct direction.\n    float lumaLocalAverage = 0.0;\n    if(is1Steepest){\n        // Switch the direction\n        stepLength = -stepLength;\n        lumaLocalAverage = 0.5 * (luma1 + lumaCenter);\n    } else {\n        lumaLocalAverage = 0.5 * (luma2 + lumaCenter);\n    }\n\n    // Shift UV in the correct direction by half a pixel.\n    vec2 currentUv = coords;\n    if(isHorizontal){\n        currentUv.y += stepLength * 0.5;\n    } else {\n        currentUv.x += stepLength * 0.5;\n    }\n\n    // Compute offset (for each iteration step) in the right direction.\n    vec2 offset = isHorizontal ? vec2(inverseScreenSize.x, 0.0) : vec2(0.0, inverseScreenSize.y);\n    // Compute UVs to explore on each side of the edge, orthogonally.\n    // The QUALITY allows us to step faster.\n    vec2 uv1 = currentUv - offset * QUALITY(0);\n    vec2 uv2 = currentUv + offset * QUALITY(0);\n\n    // Read the lumas at both current extremities of the exploration segment,\n    // and compute the delta wrt to the local average luma.\n    float lumaEnd1 = sampleLuma(uv1);\n    float lumaEnd2 = sampleLuma(uv2);\n    lumaEnd1 -= lumaLocalAverage;\n    lumaEnd2 -= lumaLocalAverage;\n\n    // If the luma deltas at the current extremities is larger than the local gradient,\n    // we have reached the side of the edge.\n    bool reached1 = abs(lumaEnd1) >= gradientScaled;\n    bool reached2 = abs(lumaEnd2) >= gradientScaled;\n    bool reachedBoth = reached1 && reached2;\n\n    // If the side is not reached, we continue to explore in this direction.\n    if(!reached1){\n        uv1 -= offset * QUALITY(1);\n    }\n    if(!reached2){\n        uv2 += offset * QUALITY(1);\n    }\n\n    // If both sides have not been reached, continue to explore.\n    if(!reachedBoth){\n        for(int i = 2; i < dIterations; i++){\n            // If needed, read luma in 1st direction, compute delta.\n            if(!reached1){\n                lumaEnd1 = sampleLuma(uv1);\n                lumaEnd1 = lumaEnd1 - lumaLocalAverage;\n            }\n            // If needed, read luma in opposite direction, compute delta.\n            if(!reached2){\n                lumaEnd2 = sampleLuma(uv2);\n                lumaEnd2 = lumaEnd2 - lumaLocalAverage;\n            }\n            // If the luma deltas at the current extremities is larger than the local gradient,\n            // we have reached the side of the edge.\n            reached1 = abs(lumaEnd1) >= gradientScaled;\n            reached2 = abs(lumaEnd2) >= gradientScaled;\n            reachedBoth = reached1 && reached2;\n\n            // If the side is not reached, we continue to explore in this direction,\n            // with a variable quality.\n            if(!reached1){\n                uv1 -= offset * QUALITY(i);\n            }\n            if(!reached2){\n                uv2 += offset * QUALITY(i);\n            }\n\n            // If both sides have been reached, stop the exploration.\n            if(reachedBoth){\n                break;\n            }\n        }\n    }\n\n    // Compute the distances to each side edge of the edge (!).\n    float distance1 = isHorizontal ? (coords.x - uv1.x) : (coords.y - uv1.y);\n    float distance2 = isHorizontal ? (uv2.x - coords.x) : (uv2.y - coords.y);\n\n    // In which direction is the side of the edge closer ?\n    bool isDirection1 = distance1 < distance2;\n    float distanceFinal = min(distance1, distance2);\n\n    // Thickness of the edge.\n    float edgeThickness = (distance1 + distance2);\n\n    // Is the luma at center smaller than the local average ?\n    bool isLumaCenterSmaller = lumaCenter < lumaLocalAverage;\n\n    // If the luma at center is smaller than at its neighbour,\n    // the delta luma at each end should be positive (same variation).\n    bool correctVariation1 = (lumaEnd1 < 0.0) != isLumaCenterSmaller;\n    bool correctVariation2 = (lumaEnd2 < 0.0) != isLumaCenterSmaller;\n\n    // Only keep the result in the direction of the closer side of the edge.\n    bool correctVariation = isDirection1 ? correctVariation1 : correctVariation2;\n\n    // UV offset: read in the direction of the closest side of the edge.\n    float pixelOffset = - distanceFinal / edgeThickness + 0.5;\n\n    // If the luma variation is incorrect, do not offset.\n    float finalOffset = correctVariation ? pixelOffset : 0.0;\n\n    // Sub-pixel shifting\n    // Full weighted average of the luma over the 3x3 neighborhood.\n    float lumaAverage = (1.0 / 12.0) * (2.0 * (lumaDownUp + lumaLeftRight) + lumaLeftCorners + lumaRightCorners);\n    // Ratio of the delta between the global average and the center luma,\n    // over the luma range in the 3x3 neighborhood.\n    float subPixelOffset1 = clamp(abs(lumaAverage - lumaCenter) / lumaRange, 0.0, 1.0);\n    float subPixelOffset2 = (-2.0 * subPixelOffset1 + 3.0) * subPixelOffset1 * subPixelOffset1;\n    // Compute a sub-pixel offset based on this delta.\n    float subPixelOffsetFinal = subPixelOffset2 * subPixelOffset2 * float(dSubpixelQuality);\n\n    // Pick the biggest of the two offsets.\n    finalOffset = max(finalOffset, subPixelOffsetFinal);\n\n    // Compute the final UV coordinates.\n    vec2 finalUv = coords;\n    if(isHorizontal){\n        finalUv.y += finalOffset * stepLength;\n    } else {\n        finalUv.x += finalOffset * stepLength;\n    }\n\n    // Read the color at the new UV coordinates, and use it.\n    gl_FragColor = texture2D(tColor, finalUv);\n}\n"),Eut={edgeThreshold:I.Numeric(.1,{min:.05,max:.15,step:.01}),maxSearchSteps:I.Numeric(16,{min:0,max:32,step:1})};class Tut{get supported(){return this._supported}constructor(t,n){if(this.webgl=t,this._supported=!1,typeof HTMLImageElement>"u")return void($n&&console.log('Missing "HTMLImageElement" required for "SMAA"'));const r=n.getWidth(),i=n.getHeight();this.edgesTarget=t.createRenderTarget(r,i,!1,"uint8","linear"),this.weightsTarget=t.createRenderTarget(r,i,!1,"uint8","linear"),this.edgesRenderable=function kut(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ua,tColor:O.create(t),uTexSizeInv:O.create(Ue.create(1/n,1/r)),uViewport:O.create(Bn()),dEdgeThreshold:O.create(.1)},o={...Dut};return ys(ms(e,"triangles",Put,o,i),i)}(t,n),this.weightsRenderable=function Nut(e,t){const n=t.getWidth(),r=t.getHeight(),i=e.resources.texture("image-uint8","rgb","ubyte","linear"),o=e.resources.texture("image-uint8","rgba","ubyte","nearest"),s={...ua,tEdges:O.create(t),tArea:O.create(i),tSearch:O.create(o),uTexSizeInv:O.create(Ue.create(1/n,1/r)),uViewport:O.create(Bn()),dMaxSearchSteps:O.create(16)};_de("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII=",s.tArea,i),_de("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII=",s.tSearch,o);const a={...Mut};return ys(ms(e,"triangles",Rut,a,s),s)}(t,this.edgesTarget.texture),this.blendRenderable=function But(e,t,n){const r=t.getWidth(),i=t.getHeight(),o={...ua,tColor:O.create(t),tWeights:O.create(n),uTexSizeInv:O.create(Ue.create(1/r,1/i)),uViewport:O.create(Bn())},s={...Fut};return ys(ms(e,"triangles",Out,s,o),o)}(t,n,this.weightsTarget.texture),this._supported=!0}updateState(t){const{gl:n,state:r}=this.webgl;r.enable(n.SCISSOR_TEST),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.depthMask(!1);const{x:i,y:o,width:s,height:a}=t;r.viewport(i,o,s,a),r.scissor(i,o,s,a),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),O.update(this.edgesRenderable.values.uViewport,Da.toVec4(this.edgesRenderable.values.uViewport.ref.value,t)),O.update(this.weightsRenderable.values.uViewport,Da.toVec4(this.weightsRenderable.values.uViewport.ref.value,t)),O.update(this.blendRenderable.values.uViewport,Da.toVec4(this.blendRenderable.values.uViewport.ref.value,t))}setSize(t,n){const r=this.edgesTarget.getWidth(),i=this.edgesTarget.getHeight();(t!==r||n!==i)&&(this.edgesTarget.setSize(t,n),this.weightsTarget.setSize(t,n),O.update(this.edgesRenderable.values.uTexSizeInv,Ue.set(this.edgesRenderable.values.uTexSizeInv.ref.value,1/t,1/n)),O.update(this.weightsRenderable.values.uTexSizeInv,Ue.set(this.weightsRenderable.values.uTexSizeInv.ref.value,1/t,1/n)),O.update(this.blendRenderable.values.uTexSizeInv,Ue.set(this.blendRenderable.values.uTexSizeInv.ref.value,1/t,1/n)))}update(t,n){let r=!1;this.edgesRenderable.values.tColor.ref.value!==t&&(O.update(this.edgesRenderable.values.tColor,t),r=!0),this.edgesRenderable.values.dEdgeThreshold.ref.value!==n.edgeThreshold&&(O.update(this.edgesRenderable.values.dEdgeThreshold,n.edgeThreshold),r=!0),r&&this.edgesRenderable.update(),this.weightsRenderable.values.dMaxSearchSteps.ref.value!==n.maxSearchSteps&&(O.update(this.weightsRenderable.values.dMaxSearchSteps,n.maxSearchSteps),this.weightsRenderable.update()),this.blendRenderable.values.tColor.ref.value!==t&&(O.update(this.blendRenderable.values.tColor,t),this.blendRenderable.update())}render(t,n){It&&this.webgl.timer.mark("SmaaPass.render"),this.edgesTarget.bind(),this.updateState(t),this.edgesRenderable.render(),this.weightsTarget.bind(),this.updateState(t),this.weightsRenderable.render(),n?n.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.blendRenderable.render(),It&&this.webgl.timer.markEnd("SmaaPass.render")}}const Dut={...ca,tColor:xn("texture","rgba","ubyte","linear"),uTexSizeInv:Ne("v2"),uViewport:Ne("v4"),dEdgeThreshold:cn("number")},Put=Wi("smaa-edges","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvoid SMAAEdgeDetectionVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n    vOffset[2] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-2.0, 0.0, 0.0, 2.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAAEdgeDetectionVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\n\nvec4 SMAAColorEdgeDetectionPS(vec2 texcoord, vec4 offset[3], sampler2D colorTex) {\n    vec2 threshold = vec2(dEdgeThreshold, dEdgeThreshold);\n\n    // Calculate color deltas:\n    vec4 delta;\n    vec3 C = texture2D(colorTex, texcoord).rgb;\n\n    vec3 Cleft = texture2D(colorTex, offset[0].xy).rgb;\n    vec3 t = abs(C - Cleft);\n    delta.x = max(max(t.r, t.g), t.b);\n\n    vec3 Ctop = texture2D(colorTex, offset[0].zw).rgb;\n    t = abs(C - Ctop);\n    delta.y = max(max(t.r, t.g), t.b);\n\n    // We do the usual threshold:\n    vec2 edges = step(threshold, delta.xy);\n\n    // Then discard if there is no edge:\n    if (dot(edges, vec2(1.0, 1.0 )) == 0.0)\n        discard;\n\n    // Calculate right and bottom deltas:\n    vec3 Cright = texture2D(colorTex, offset[1].xy).rgb;\n    t = abs( C - Cright );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Cbottom  = texture2D(colorTex, offset[1].zw).rgb;\n    t = abs(C - Cbottom);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the maximum delta in the direct neighborhood:\n    float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w );\n\n    // Calculate left-left and top-top deltas:\n    vec3 Cleftleft  = texture2D(colorTex, offset[2].xy).rgb;\n    t = abs( C - Cleftleft );\n    delta.z = max(max(t.r, t.g), t.b);\n\n    vec3 Ctoptop = texture2D(colorTex, offset[2].zw).rgb;\n    t = abs(C - Ctoptop);\n    delta.w = max(max(t.r, t.g), t.b);\n\n    // Calculate the final maximum delta:\n    maxDelta = max(max(maxDelta, delta.z), delta.w);\n\n    // Local contrast adaptation in action:\n    edges.xy *= step(0.5 * maxDelta, delta.xy);\n\n    return vec4(edges, 0.0, 0.0);\n}\n\nvoid main() {\n    gl_FragColor = SMAAColorEdgeDetectionPS(vUv, vOffset, tColor);\n}\n"),Mut={...ca,tEdges:xn("texture","rgba","ubyte","linear"),tArea:xn("texture","rgb","ubyte","linear"),tSearch:xn("texture","rgba","ubyte","nearest"),uTexSizeInv:Ne("v2"),uViewport:Ne("v4"),dMaxSearchSteps:cn("number")},Rut=Wi("smaa-weights","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\nvoid SMAABlendingWeightCalculationVS(vec2 texCoord) {\n    vPixCoord = texCoord / uTexSizeInv;\n\n    // We will use these offsets for the searches later on (see @PSEUDO_GATHER4):\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.25, 0.125, 1.25, 0.125); // WebGL port note: Changed sign in Y and W components\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-0.125, 0.25, -0.125, -1.25); // WebGL port note: Changed sign in Y and W components\n\n    // And these for the searches, they indicate the ends of the loops:\n    vOffset[2] = vec4(vOffset[0].xz, vOffset[1].yw) + vec4(-2.0, 2.0, -2.0, 2.0) * uTexSizeInv.xxyy * float(dMaxSearchSteps);\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAABlendingWeightCalculationVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#define SMAASampleLevelZeroOffset(tex, coord, offset) texture2D(tex, coord + float(offset) * uTexSizeInv, 0.0)\n\n#define SMAA_AREATEX_MAX_DISTANCE 16\n#define SMAA_AREATEX_PIXEL_SIZE (1.0 / vec2(160.0, 560.0))\n#define SMAA_AREATEX_SUBTEX_SIZE (1.0 / 7.0)\n\nuniform sampler2D tEdges;\nuniform sampler2D tArea;\nuniform sampler2D tSearch;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[3];\nvarying vec2 vPixCoord;\n\n#if __VERSION__ == 100\n    vec2 round(vec2 x) {\n        return sign(x) * floor(abs(x) + 0.5);\n    }\n#endif\n\nfloat SMAASearchLength(sampler2D searchTex, vec2 e, float bias, float scale) {\n    // Not required if searchTex accesses are set to point:\n    // float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);\n    // e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +\n    //     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;\n    e.r = bias + e.r * scale;\n    return 255.0 * texture2D(searchTex, e, 0.0).r;\n}\n\nfloat SMAASearchXLeft(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    /**\n     * @PSEUDO_GATHER4\n     * This texCoord has been offset by (-0.25, -0.125) in the vertex shader to\n     * sample between edge, thus fetching four edges in a row.\n     * Sampling with different offsets in each direction allows to disambiguate\n     * which edges are active from the four fetched ones.\n     */\n    vec2 e = vec2(0.0, 1.0);\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D( edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x > end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    // We correct the previous (-0.25, -0.125) offset we applied:\n    texCoord.x += 0.25 * uTexSizeInv.x;\n\n    // The searches are bias by 1, so adjust the coords accordingly:\n    texCoord.x += uTexSizeInv.x;\n\n    // Disambiguate the length added by the last step:\n    texCoord.x += 2.0 * uTexSizeInv.x; // Undo last step\n    texCoord.x -= uTexSizeInv.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n\n    return texCoord.x;\n}\n\nfloat SMAASearchXRight(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 0.0, 1.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(2.0, 0.0) * uTexSizeInv;\n        if (!(texCoord.x < end && e.g > 0.8281 && e.r == 0.0)) break;\n    }\n\n    texCoord.x -= 0.25 * uTexSizeInv.x;\n    texCoord.x -= uTexSizeInv.x;\n    texCoord.x -= 2.0 * uTexSizeInv.x;\n    texCoord.x += uTexSizeInv.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n\n    return texCoord.x;\n}\n\nfloat SMAASearchYUp(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord += vec2(0.0, 2.0) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y > end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y -= 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.0, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nfloat SMAASearchYDown(sampler2D edgesTex, sampler2D searchTex, vec2 texCoord, float end) {\n    vec2 e = vec2( 1.0, 0.0 );\n\n    for (int i = 0; i < dMaxSearchSteps; i++) { // WebGL port note: Changed while to for\n        e = texture2D(edgesTex, texCoord, 0.0).rg;\n        texCoord -= vec2( 0.0, 2.0 ) * uTexSizeInv; // WebGL port note: Changed sign\n        if (!(texCoord.y < end && e.r > 0.8281 && e.g == 0.0)) break;\n    }\n\n    texCoord.y += 0.25 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y += 2.0 * uTexSizeInv.y; // WebGL port note: Changed sign\n    texCoord.y -= uTexSizeInv.y * SMAASearchLength(searchTex, e.gr, 0.5, 0.5); // WebGL port note: Changed sign\n\n    return texCoord.y;\n}\n\nvec2 SMAAArea(sampler2D areaTex, vec2 dist, float e1, float e2, float offset) {\n    // Rounding prevents precision errors of bilinear filtering:\n    vec2 texCoord = float(SMAA_AREATEX_MAX_DISTANCE) * round(4.0 * vec2(e1, e2)) + dist;\n\n    // We do a scale and bias for mapping to texel space:\n    texCoord = SMAA_AREATEX_PIXEL_SIZE * texCoord + (0.5 * SMAA_AREATEX_PIXEL_SIZE);\n\n    // Move to proper place, according to the subpixel offset:\n    texCoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;\n\n    return texture2D(areaTex, texCoord, 0.0).rg;\n}\n\nvec4 SMAABlendingWeightCalculationPS(vec2 texCoord, vec2 pixCoord, vec4 offset[3], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices) {\n    vec4 weights = vec4(0.0, 0.0, 0.0, 0.0);\n\n    vec2 e = texture2D(edgesTex, texCoord).rg;\n\n    if (e.g > 0.0) { // Edge at north\n        vec2 d;\n\n        // Find the distance to the left:\n        vec2 coords;\n        coords.x = SMAASearchXLeft(edgesTex, searchTex, offset[0].xy, offset[2].x );\n        coords.y = offset[1].y; // offset[1].y = texCoord.y - 0.25 * uTexSizeInv.y (@CROSSING_OFFSET)\n        d.x = coords.x;\n\n        // Now fetch the left crossing edges, two at a time using bilinear\n        // filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to\n        // discern what value each edge has:\n        float e1 = texture2D(edgesTex, coords, 0.0).r;\n\n        // Find the distance to the right:\n        coords.x = SMAASearchXRight(edgesTex, searchTex, offset[0].zw, offset[2].y);\n        d.y = coords.x;\n\n        // We want the distances to be in pixel units (doing this here allow to\n        // better interleave arithmetic and memory accesses):\n        d = d / uTexSizeInv.x - pixCoord.x;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the right crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(1, 0)).r;\n\n        // Ok, we know how this pattern looks like, now it is time for getting\n        // the actual area:\n        weights.rg = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.y));\n    }\n\n    if (e.r > 0.0) { // Edge at west\n        vec2 d;\n\n        // Find the distance to the top:\n        vec2 coords;\n\n        coords.y = SMAASearchYUp(edgesTex, searchTex, offset[1].xy, offset[2].z );\n        coords.x = offset[0].x; // offset[1].x = texCoord.x - 0.25 * uTexSizeInv.x;\n        d.x = coords.y;\n\n        // Fetch the top crossing edges:\n        float e1 = texture2D(edgesTex, coords, 0.0).g;\n\n        // Find the distance to the bottom:\n        coords.y = SMAASearchYDown(edgesTex, searchTex, offset[1].zw, offset[2].w);\n        d.y = coords.y;\n\n        // We want the distances to be in pixel units:\n        d = d / uTexSizeInv.y - pixCoord.y;\n\n        // SMAAArea below needs a sqrt, as the areas texture is compressed\n        // quadratically:\n        vec2 sqrt_d = sqrt(abs(d));\n\n        // Fetch the bottom crossing edges:\n        coords.y -= 1.0 * uTexSizeInv.y; // WebGL port note: Added\n        float e2 = SMAASampleLevelZeroOffset(edgesTex, coords, ivec2(0, 1)).g;\n\n        // Get the area for this direction:\n        weights.ba = SMAAArea(areaTex, sqrt_d, e1, e2, float(subsampleIndices.x));\n    }\n\n    return weights;\n}\n\nvoid main() {\n    gl_FragColor = SMAABlendingWeightCalculationPS(vUv, vPixCoord, vOffset, tEdges, tArea, tSearch, ivec4(0.0));\n}\n"),Fut={...ca,tColor:xn("texture","rgba","ubyte","linear"),tWeights:xn("texture","rgba","ubyte","linear"),uTexSizeInv:Ne("v2"),uViewport:Ne("v4")},Out=Wi("smaa-blend","\nprecision highp float;\n\nattribute vec2 aPosition;\nuniform vec2 uQuadScale;\n\nuniform vec2 uTexSizeInv;\nuniform vec4 uViewport;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvoid SMAANeighborhoodBlendingVS(vec2 texCoord) {\n    vOffset[0] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(-1.0, 0.0, 0.0, 1.0); // WebGL port note: Changed sign in W component\n    vOffset[1] = texCoord.xyxy + uTexSizeInv.xyxy * vec4(1.0, 0.0, 0.0, -1.0); // WebGL port note: Changed sign in W component\n}\n\nvoid main() {\n    vec2 scale = uViewport.zw * uTexSizeInv;\n    vec2 shift = uViewport.xy * uTexSizeInv;\n    vUv = (aPosition + 1.0) * 0.5 * scale + shift;\n    SMAANeighborhoodBlendingVS(vUv);\n    vec2 position = aPosition * uQuadScale - vec2(1.0, 1.0) + uQuadScale;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n","\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tWeights;\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nvarying vec2 vUv;\nvarying vec4 vOffset[2];\n\nvec4 SMAANeighborhoodBlendingPS(vec2 texCoord, vec4 offset[2], sampler2D colorTex, sampler2D blendTex) {\n    // Fetch the blending weights for current pixel:\n    vec4 a;\n    a.xz = texture2D(blendTex, texCoord).xz;\n    a.y = texture2D(blendTex, offset[1].zw).g;\n    a.w = texture2D(blendTex, offset[1].xy).a;\n\n    // Is there any blending weight with a value greater than 0.0?\n    if (dot(a, vec4(1.0, 1.0, 1.0, 1.0)) < 1e-5) {\n        return texture2D(colorTex, texCoord, 0.0);\n    } else {\n        // Up to 4 lines can be crossing a pixel (one through each edge). We\n        // favor blending by choosing the line with the maximum weight for each\n        // direction:\n        vec2 offset;\n        offset.x = a.a > a.b ? a.a : -a.b; // left vs. right\n        offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs\n\n        // Then we go in the direction that has the maximum weight:\n        if (abs(offset.x) > abs(offset.y)) { // horizontal vs. vertical\n            offset.y = 0.0;\n        } else {\n            offset.x = 0.0;\n        }\n\n        // Fetch the opposite color and lerp by hand:\n        vec4 C = texture2D(colorTex, texCoord, 0.0);\n        texCoord += sign(offset) * uTexSizeInv;\n        vec4 Cop = texture2D(colorTex, texCoord, 0.0);\n        float s = abs(offset.x) > abs(offset.y) ? abs(offset.x) : abs(offset.y);\n\n        // WebGL port note: Added gamma correction\n        C.xyz = pow(C.xyz, vec3(2.2));\n        Cop.xyz = pow(Cop.xyz, vec3(2.2));\n        vec4 mixed = mix(C, Cop, s);\n        mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));\n\n        return mixed;\n    }\n}\n\nvoid main() {\n    gl_FragColor = SMAANeighborhoodBlendingPS(vUv, vOffset, tColor, tWeights);\n}\n"),c0e={opacity:I.Numeric(1,{min:0,max:1,step:.01}),saturation:I.Numeric(0,{min:-1,max:1,step:.01}),lightness:I.Numeric(0,{min:-1,max:1,step:.01})},Vut={faces:I.MappedStatic("urls",{urls:I.Group({nx:I.Text("",{label:"Negative X / Left"}),ny:I.Text("",{label:"Negative Y / Bottom"}),nz:I.Text("",{label:"Negative Z / Back"}),px:I.Text("",{label:"Positive X / Right"}),py:I.Text("",{label:"Positive Y / Top"}),pz:I.Text("",{label:"Positive Z / Front"})},{isExpanded:!0,label:"URLs"}),files:I.Group({nx:I.File({label:"Negative X / Left",accept:"image/*"}),ny:I.File({label:"Negative Y / Bottom",accept:"image/*"}),nz:I.File({label:"Negative Z / Back",accept:"image/*"}),px:I.File({label:"Positive X / Right",accept:"image/*"}),py:I.File({label:"Positive Y / Top",accept:"image/*"}),pz:I.File({label:"Positive Z / Front",accept:"image/*"})},{isExpanded:!0,label:"Files"})}),blur:I.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or when "EXT_shader_texture_lod" is available.'}),...c0e},Hut={source:I.MappedStatic("url",{url:I.Text(""),file:I.File({accept:"image/*"})}),blur:I.Numeric(0,{min:0,max:1,step:.01},{description:'Note, this only works in WebGL2 or with power-of-two images and when "EXT_shader_texture_lod" is available.'}),...c0e,coverage:I.Select("viewport",I.arrayToOptions(["viewport","canvas"]))},Gut={topColor:I.Color(st(14540253)),bottomColor:I.Color(st(15658734)),ratio:I.Numeric(.5,{min:0,max:1,step:.01}),coverage:I.Select("viewport",I.arrayToOptions(["viewport","canvas"]))},qut={centerColor:I.Color(st(14540253)),edgeColor:I.Color(st(15658734)),ratio:I.Numeric(.5,{min:0,max:1,step:.01}),coverage:I.Select("viewport",I.arrayToOptions(["viewport","canvas"]))},Wut={variant:I.MappedStatic("off",{off:I.EmptyGroup(),skybox:I.Group(Vut,{isExpanded:!0}),image:I.Group(Hut,{isExpanded:!0}),horizontalGradient:I.Group(Gut,{isExpanded:!0}),radialGradient:I.Group(qut,{isExpanded:!0})},{label:"Environment"})};class $ut{constructor(t,n,r,i){this.webgl=t,this.assetManager=n,this.camera=new Si,this.target=C(),this.position=C(),this.dir=C(),this.renderable=function ndt(e,t,n){const r={drawCount:O.create(6),instanceCount:O.create(1),aPosition:O.create(nH),tSkybox:O.create(lc()),tImage:O.create(lc()),uImageScale:O.create(Ue()),uImageOffset:O.create(Ue()),uTexSize:O.create(Ue.create(t,n)),uViewport:O.create(Bn()),uViewportAdjusted:O.create(!0),uViewDirectionProjectionInverse:O.create(fe()),uGradientColorA:O.create(C()),uGradientColorB:O.create(C()),uGradientRatio:O.create(.5),uBlur:O.create(0),uOpacity:O.create(1),uSaturation:O.create(0),uLightness:O.create(0),dVariant:O.create("skybox")},i={...edt};return ys(ms(e,"triangles",tdt,i,r),r)}(t,r,i)}setSize(t,n){const[r,i]=this.renderable.values.uTexSize.ref.value;(t!==r||n!==i)&&O.update(this.renderable.values.uTexSize,Ue.set(this.renderable.values.uTexSize.ref.value,t,n))}clearSkybox(){void 0!==this.skybox&&(this.skybox.texture.destroy(),this.skybox.assets.forEach(t=>this.assetManager.release(t)),this.skybox=void 0)}updateSkybox(t,n,r){var i;const o=null===(i=this.skybox)||void 0===i?void 0:i.props.faces,s=n.faces.params;if(!(s.nx&&s.ny&&s.nz&&s.px&&s.py&&s.pz))return this.clearSkybox(),void r?.(!1);if(this.skybox&&o&&function Kut(e,t){return d0e(e)===d0e(t)}(n.faces,this.skybox.props.faces))r?.(!1);else{this.clearSkybox();const{texture:c,assets:u}=function Zut(e,t,n,r){const i=function Yut(e,t){return"urls"===t.name?{nx:jr.getUrlAsset(e,t.params.nx),ny:jr.getUrlAsset(e,t.params.ny),nz:jr.getUrlAsset(e,t.params.nz),px:jr.getUrlAsset(e,t.params.px),py:jr.getUrlAsset(e,t.params.py),pz:jr.getUrlAsset(e,t.params.pz)}:{nx:t.params.nx,ny:t.params.ny,nz:t.params.nz,px:t.params.px,py:t.params.py,pz:t.params.pz}}(t,n),o=function Xut(e,t){const n=r=>e.resolve(r,"binary").run().then(i=>new Blob([i.data]));return{nx:n(t.nx),ny:n(t.ny),nz:n(t.nz),px:n(t.px),py:n(t.py),pz:n(t.pz)}}(t,i),s=[i.nx,i.ny,i.nz,i.px,i.py,i.pz];return typeof HTMLImageElement>"u"?(console.error('Missing "HTMLImageElement" required for background skybox'),r?.(!0),{texture:lc(),assets:s}):{texture:e.resources.cubeTexture(o,!0,r),assets:s}}(this.webgl,this.assetManager,n.faces,d=>{this.skybox&&(this.skybox.loaded=!d),r?.(!0)});this.skybox={texture:c,props:{...n},assets:u,loaded:!1},O.update(this.renderable.values.tSkybox,c),this.renderable.update()}if(!this.skybox)return;let a=t;"orthographic"===t.state.mode&&(this.camera.setState({...t.state,mode:"perspective"}),this.camera.update(),a=this.camera);const l=this.renderable.values.uViewDirectionProjectionInverse.ref.value;C.sub(this.dir,a.state.position,a.state.target),C.setMagnitude(this.dir,this.dir,.1),C.copy(this.position,this.dir),fe.lookAt(l,this.position,this.target,a.state.up),fe.mul(l,a.projection,l),fe.invert(l,l),O.update(this.renderable.values.uViewDirectionProjectionInverse,l),O.updateIfChanged(this.renderable.values.uBlur,n.blur),O.updateIfChanged(this.renderable.values.uOpacity,n.opacity),O.updateIfChanged(this.renderable.values.uSaturation,n.saturation),O.updateIfChanged(this.renderable.values.uLightness,n.lightness),O.updateIfChanged(this.renderable.values.dVariant,"skybox"),this.renderable.update()}clearImage(){void 0!==this.image&&(this.image.texture.destroy(),this.assetManager.release(this.image.asset),this.image=void 0)}updateImage(t,n){if(!t.source.params)return this.clearImage(),void n?.(!1);if(this.image&&this.image.props.source.params&&function Qut(e,t){return p0e(e)===p0e(t)}(t.source,this.image.props.source))n?.(!1);else{this.clearImage();const{texture:r,asset:i}=function Jut(e,t,n,r){const i="url"===n.name?jr.getUrlAsset(t,n.params):n.params;if(typeof HTMLImageElement>"u")return console.error('Missing "HTMLImageElement" required for background image'),r?.(!0),{texture:lc(),asset:i};const o=e.resources.texture("image-uint8","rgba","ubyte","linear"),s=new Image;return s.onload=()=>{o.load(s),(e.isWebGL2||d3(s.width)&&d3(s.height))&&o.mipmap(),r?.()},s.onerror=()=>{r?.(!0)},t.resolve(i,"binary").run().then(a=>{const l=new Blob([a.data]);s.src=URL.createObjectURL(l)}),{texture:o,asset:i}}(this.webgl,this.assetManager,t.source,o=>{this.image&&(this.image.loaded=!o),n?.(!0)});this.image={texture:r,props:{...t},asset:i,loaded:!1},O.update(this.renderable.values.tImage,r),this.renderable.update()}this.image&&(O.updateIfChanged(this.renderable.values.uBlur,t.blur),O.updateIfChanged(this.renderable.values.uOpacity,t.opacity),O.updateIfChanged(this.renderable.values.uSaturation,t.saturation),O.updateIfChanged(this.renderable.values.uLightness,t.lightness),O.updateIfChanged(this.renderable.values.uViewportAdjusted,"viewport"===t.coverage),O.updateIfChanged(this.renderable.values.dVariant,"image"),this.renderable.update())}updateImageScaling(){var t,n;const r=this.renderable.values,[i,o]=r.uTexSize.ref.value,s=(null===(t=this.image)||void 0===t?void 0:t.texture.getWidth())||0,a=(null===(n=this.image)||void 0===n?void 0:n.texture.getHeight())||0,l=i/o;O.update(r.uImageScale,l<s/a?Ue.set(r.uImageScale.ref.value,s*o/a,o):Ue.set(r.uImageScale.ref.value,i,a*i/s));const[u,d]=r.uImageScale.ref.value,f=u/d;O.update(r.uImageOffset,f>l?Ue.set(r.uImageOffset.ref.value,(1-l/f)/2,0):Ue.set(r.uImageOffset.ref.value,0,(1-f/l)/2))}updateGradient(t,n,r,i,o){O.update(this.renderable.values.uGradientColorA,st.toVec3Normalized(this.renderable.values.uGradientColorA.ref.value,t)),O.update(this.renderable.values.uGradientColorB,st.toVec3Normalized(this.renderable.values.uGradientColorB.ref.value,n)),O.updateIfChanged(this.renderable.values.uGradientRatio,r),O.updateIfChanged(this.renderable.values.uViewportAdjusted,o),O.updateIfChanged(this.renderable.values.dVariant,i),this.renderable.update()}update(t,n,r){if("off"===n.variant.name)return this.clearSkybox(),this.clearImage(),void r?.(!1);"skybox"===n.variant.name?(this.clearImage(),this.updateSkybox(t,n.variant.params,r)):"image"===n.variant.name?(this.clearSkybox(),this.updateImage(n.variant.params,r)):"horizontalGradient"===n.variant.name?(this.clearSkybox(),this.clearImage(),this.updateGradient(n.variant.params.topColor,n.variant.params.bottomColor,n.variant.params.ratio,n.variant.name,"viewport"===n.variant.params.coverage),r?.(!1)):"radialGradient"===n.variant.name&&(this.clearSkybox(),this.clearImage(),this.updateGradient(n.variant.params.centerColor,n.variant.params.edgeColor,n.variant.params.ratio,n.variant.name,"viewport"===n.variant.params.coverage),r?.(!1));const{x:i,y:o,width:s,height:a}=t.viewport;O.update(this.renderable.values.uViewport,Bn.set(this.renderable.values.uViewport.ref.value,i,o,s,a))}isEnabled(t){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===t.variant.name||"radialGradient"===t.variant.name)}isReady(){return!!(this.skybox&&this.skybox.loaded||this.image&&this.image.loaded||"horizontalGradient"===this.renderable.values.dVariant.ref.value||"radialGradient"===this.renderable.values.dVariant.ref.value)}render(){this.isReady()&&("image"===this.renderable.values.dVariant.ref.value&&this.updateImageScaling(),It&&this.webgl.timer.mark("BackgroundPass.render"),this.renderable.render(),It&&this.webgl.timer.markEnd("BackgroundPass.render"))}dispose(){this.clearSkybox(),this.clearImage()}}const u0e="background-skybox";function d0e(e){var t,n,r,i,o,s;return"urls"===e.name?`${u0e}_${e.params.nx}|${e.params.ny}|${e.params.nz}|${e.params.px}|${e.params.py}|${e.params.pz}`:`${u0e}_${null===(t=e.params.nx)||void 0===t?void 0:t.id}|${null===(n=e.params.ny)||void 0===n?void 0:n.id}|${null===(r=e.params.nz)||void 0===r?void 0:r.id}|${null===(i=e.params.px)||void 0===i?void 0:i.id}|${null===(o=e.params.py)||void 0===o?void 0:o.id}|${null===(s=e.params.pz)||void 0===s?void 0:s.id}`}const f0e="background-image";function p0e(e){var t;return"url"===e.name?`${f0e}_${e.params}`:`${f0e}_${null===(t=e.params)||void 0===t?void 0:t.id}`}const edt={drawCount:_o("number"),instanceCount:_o("number"),aPosition:Pi("float32",2,0),tSkybox:xn("texture","rgba","ubyte","linear"),tImage:xn("texture","rgba","ubyte","linear"),uImageScale:Ne("v2"),uImageOffset:Ne("v2"),uTexSize:Ne("v2"),uViewport:Ne("v4"),uViewportAdjusted:Ne("b"),uViewDirectionProjectionInverse:Ne("m4"),uGradientColorA:Ne("v3"),uGradientColorB:Ne("v3"),uGradientRatio:Ne("f"),uBlur:Ne("f"),uOpacity:Ne("f"),uSaturation:Ne("f"),uLightness:Ne("f"),dVariant:cn("string",["skybox","image","verticalGradient","horizontalGradient","radialGradient"])},tdt=Wi("background","\nprecision mediump float;\n\nattribute vec2 aPosition;\n\nvarying vec4 vPosition;\n\nvoid main() {\n    vPosition = vec4(aPosition, 1.0, 1.0);\n    gl_Position = vec4(aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\nprecision mediump samplerCube;\nprecision mediump sampler2D;\n\n#if defined(dVariant_skybox)\n    uniform samplerCube tSkybox;\n    uniform mat4 uViewDirectionProjectionInverse;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_image)\n    uniform sampler2D tImage;\n    uniform vec2 uImageScale;\n    uniform vec2 uImageOffset;\n    uniform float uBlur;\n    uniform float uOpacity;\n    uniform float uSaturation;\n    uniform float uLightness;\n#elif defined(dVariant_horizontalGradient) || defined(dVariant_radialGradient)\n    uniform vec3 uGradientColorA;\n    uniform vec3 uGradientColorB;\n    uniform float uGradientRatio;\n#endif\n\nuniform vec2 uTexSize;\nuniform vec4 uViewport;\nuniform bool uViewportAdjusted;\nvarying vec4 vPosition;\n\n// TODO: add as general pp option to remove banding?\n// Iestyn's RGB dither from http://alex.vlachos.com/graphics/Alex_Vlachos_Advanced_VR_Rendering_GDC2015.pdf\nvec3 ScreenSpaceDither(vec2 vScreenPos) {\n    vec3 vDither = vec3(dot(vec2(171.0, 231.0), vScreenPos.xy));\n    vDither.rgb = fract(vDither.rgb / vec3(103.0, 71.0, 97.0));\n    return vDither.rgb / 255.0;\n}\n\nvec3 saturateColor(vec3 c, float amount) {\n    // https://www.w3.org/TR/WCAG21/#dfn-relative-luminance\n    const vec3 W = vec3(0.2125, 0.7154, 0.0721);\n    vec3 intensity = vec3(dot(c, W));\n    return mix(intensity, c, 1.0 + amount);\n}\n\nvec3 lightenColor(vec3 c, float amount) {\n    return c + amount;\n}\n\nvoid main() {\n    #if defined(dVariant_skybox)\n        vec4 t = uViewDirectionProjectionInverse * vPosition;\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = textureCubeLodEXT(tSkybox, normalize(t.xyz / t.w), uBlur * 8.0);\n        #else\n            gl_FragColor = textureCube(tSkybox, normalize(t.xyz / t.w));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_image)\n        vec2 coords;\n        if (uViewportAdjusted) {\n            coords = ((gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uImageScale) + uImageOffset;\n        } else {\n            coords = (gl_FragCoord.xy / uImageScale) + uImageOffset;\n        }\n        #ifdef enabledShaderTextureLod\n            gl_FragColor = texture2DLodEXT(tImage, vec2(coords.x, 1.0 - coords.y), uBlur * 8.0);\n        #else\n            gl_FragColor = texture2D(tImage, vec2(coords.x, 1.0 - coords.y));\n        #endif\n        gl_FragColor.a = uOpacity;\n        gl_FragColor.rgb = lightenColor(saturateColor(gl_FragColor.rgb, uSaturation), uLightness);\n    #elif defined(dVariant_horizontalGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = ((gl_FragCoord.y - uViewport.y) * (uTexSize.y / uViewport.w) / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        } else {\n            d = (gl_FragCoord.y / uTexSize.y) + 1.0 - (uGradientRatio * 2.0);\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #elif defined(dVariant_radialGradient)\n        float d;\n        if (uViewportAdjusted) {\n            d = distance(vec2(0.5), (gl_FragCoord.xy - uViewport.xy) * (uTexSize / uViewport.zw) / uTexSize) + uGradientRatio - 0.5;\n        } else {\n            d = distance(vec2(0.5), gl_FragCoord.xy / uTexSize) + uGradientRatio - 0.5;\n        }\n        gl_FragColor = vec4(mix(uGradientColorB, uGradientColorA, 1.0 - clamp(d, 0.0, 1.0)), 1.0);\n        gl_FragColor.rgb += ScreenSpaceDither(gl_FragCoord.xy);\n    #endif\n}\n",{shaderTextureLod:"optional"}),odt={sharpness:I.Numeric(.5,{min:0,max:1,step:.05}),denoise:I.Boolean(!0)};class sdt{constructor(t,n){this.webgl=t,this.renderable=function cdt(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ua,tColor:O.create(t),uTexSizeInv:O.create(Ue.create(1/n,1/r)),uSharpness:O.create(.5),dDenoise:O.create(!0)},o={...adt};return ys(ms(e,"triangles",ldt,o,i),i)}(t,n)}updateState(t){const{gl:n,state:r}=this.webgl;r.enable(n.SCISSOR_TEST),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.depthMask(!1);const{x:i,y:o,width:s,height:a}=t;r.viewport(i,o,s,a),r.scissor(i,o,s,a),r.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT)}setSize(t,n){O.update(this.renderable.values.uTexSizeInv,Ue.set(this.renderable.values.uTexSizeInv.ref.value,1/t,1/n))}update(t,n){const{values:r}=this.renderable,{sharpness:i,denoise:o}=n;let s=!1;r.tColor.ref.value!==t&&(O.update(this.renderable.values.tColor,t),s=!0),O.updateIfChanged(r.uSharpness,2-2*Math.pow(i,.25)),r.dDenoise.ref.value!==o&&(s=!0),O.updateIfChanged(r.dDenoise,o),s&&this.renderable.update()}render(t,n){It&&this.webgl.timer.mark("CasPass.render"),n?n.bind():this.webgl.unbindFramebuffer(),this.updateState(t),this.renderable.render(),It&&this.webgl.timer.markEnd("CasPass.render")}}const adt={...ca,tColor:xn("texture","rgba","ubyte","linear"),uTexSizeInv:Ne("v2"),uSharpness:Ne("f"),dDenoise:cn("boolean")},ldt=Wi("cas",hl,"\nprecision mediump float;\nprecision mediump sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSizeInv;\n\nuniform float uSharpness;\n\n// adapted from https://www.shadertoy.com/view/stXSWB\n\n/*\n* FidelityFX Super Resolution scales up a low resolution\n* image, while adding fine detail.\n*\n* MIT Open License\n*\n* https://gpuopen.com/fsr\n*\n* Left: FSR processed\n* Right: Original texture, bilinear interpolation\n*\n* Mouse at top: Sharpness 0 stops (maximum)\n* Mouse at bottom: Sharpness 2 stops (minimum)\n*\n* It works in two passes-\n*   EASU upsamples the image with a clamped Lanczos kernel.\n*   RCAS sharpens the image at the target resolution.\n*\n* I needed to make a few changes to improve readability and\n* WebGL compatibility in an algorithm I don't fully understand.\n* Expect bugs.\n*\n* Shader not currently running for WebGL1 targets (eg. mobile Safari)\n*\n* There is kind of no point to using FSR in Shadertoy, as it renders buffers\n* at full target resolution. But this might be useful for WebGL based demos\n* running smaller-than-target render buffers.\n*\n* For sharpening with a full resolution render buffer,\n* FidelityFX CAS is a better option.\n* https://www.shadertoy.com/view/ftsXzM\n*\n* For readability and compatibility, these optimisations have been removed:\n*   * Fast approximate inverse and inversesqrt\n*   * textureGather fetches (not WebGL compatible)\n*   * Multiplying by reciprocal instead of division\n*\n* Apologies to AMD for the numerous slowdowns and errors I have introduced.\n*\n*/\n\n/***** RCAS *****/\n#define FSR_RCAS_LIMIT (0.25-(1.0/16.0))\n\n// Input callback prototypes that need to be implemented by calling shader\nvec4 FsrRcasLoadF(vec2 p);\n//------------------------------------------------------------------------------------------------------------------------------\nvoid FsrRcasCon(\n    out float con,\n    // The scale is {0.0 := maximum, to N>0, where N is the number of stops (halving) of the reduction of sharpness}.\n    float sharpness\n) {\n    // Transform from stops to linear value.\n    con = exp2(-sharpness);\n}\n\nvec3 FsrRcasF(\n    vec2 ip, // Integer pixel position in output.\n    float con\n) {\n    // Constant generated by RcasSetup().\n    // Algorithm uses minimal 3x3 pixel neighborhood.\n    //    b\n    //  d e f\n    //    h\n    vec2 sp = vec2(ip);\n    vec3 b = FsrRcasLoadF(sp + vec2( 0,-1)).rgb;\n    vec3 d = FsrRcasLoadF(sp + vec2(-1, 0)).rgb;\n    vec3 e = FsrRcasLoadF(sp).rgb;\n    vec3 f = FsrRcasLoadF(sp + vec2( 1, 0)).rgb;\n    vec3 h = FsrRcasLoadF(sp + vec2( 0, 1)).rgb;\n\n    // Luma times 2.\n    float bL = b.g + .5 * (b.b + b.r);\n    float dL = d.g + .5 * (d.b + d.r);\n    float eL = e.g + .5 * (e.b + e.r);\n    float fL = f.g + .5 * (f.b + f.r);\n    float hL = h.g + .5 * (h.b + h.r);\n\n    // Noise detection.\n    #ifdef dDenoise\n        float nz = .25 * (bL + dL + fL + hL) - eL;\n        nz=clamp(\n            abs(nz)\n            /(\n                max(max(bL,dL),max(eL,max(fL,hL)))\n                -min(min(bL,dL),min(eL,min(fL,hL)))\n            ),\n            0., 1.\n        );\n        nz=1.-.5*nz;\n    #endif\n\n    // Min and max of ring.\n    vec3 mn4 = min(b, min(f, h));\n    vec3 mx4 = max(b, max(f, h));\n\n    // Immediate constants for peak range.\n    vec2 peakC = vec2(1., -4.);\n\n    // Limiters, these need to be high precision RCPs.\n    vec3 hitMin = mn4 / (4. * mx4);\n    vec3 hitMax = (peakC.x - mx4) / (4.* mn4 + peakC.y);\n    vec3 lobeRGB = max(-hitMin, hitMax);\n    float lobe = max(\n        -FSR_RCAS_LIMIT,\n        min(max(lobeRGB.r, max(lobeRGB.g, lobeRGB.b)), 0.)\n    )*con;\n\n    // Apply noise removal.\n    #ifdef dDenoise\n        lobe *= nz;\n    #endif\n\n    // Resolve, which needs the medium precision rcp approximation to avoid visible tonality changes.\n    return (lobe * (b + d + h + f) + e) / (4. * lobe + 1.);\n}\n\n\nvec4 FsrRcasLoadF(vec2 p) {\n    return texture2D(tColor, p * uTexSizeInv);\n}\n\nvoid main() {\n    // Set up constants\n    float con;\n    FsrRcasCon(con, uSharpness);\n\n    // Perform RCAS pass\n    vec3 col = FsrRcasF(gl_FragCoord.xy, con);\n\n    gl_FragColor = vec4(col, FsrRcasLoadF(gl_FragCoord.xy).a);\n}\n"),udt={...ca,tDepthOpaque:xn("texture","rgba","ubyte","nearest"),tDepthTransparent:xn("texture","rgba","ubyte","nearest"),uTexSize:Ne("v2"),dOrthographic:cn("number"),uNear:Ne("f"),uFar:Ne("f"),uInvProjection:Ne("m4"),uOutlineThreshold:Ne("f"),dTransparentOutline:cn("boolean")},fdt={...ca,tDepth:xn("texture","rgba","ubyte","nearest"),uTexSize:Ne("v2"),uProjection:Ne("m4"),uInvProjection:Ne("m4"),uBounds:Ne("v4"),dOrthographic:cn("number"),uNear:Ne("f"),uFar:Ne("f"),dSteps:cn("number"),uMaxDistance:Ne("f"),uTolerance:Ne("f"),uBias:Ne("f"),uLightDirection:Ne("v3[]"),uLightColor:Ne("v3[]"),dLightCount:cn("number")},hdt={...ca,tDepth:xn("texture","rgba","ubyte","nearest"),tDepthHalf:xn("texture","rgba","ubyte","nearest"),tDepthQuarter:xn("texture","rgba","ubyte","nearest"),uSamples:Ne("v3[]"),dNSamples:cn("number"),uProjection:Ne("m4"),uInvProjection:Ne("m4"),uBounds:Ne("v4"),uTexSize:Ne("v2"),uRadius:Ne("f"),uBias:Ne("f"),dMultiScale:cn("boolean"),dLevels:cn("number"),uLevelRadius:Ne("f[]"),uLevelBias:Ne("f[]"),uNearThreshold:Ne("f"),uFarThreshold:Ne("f")},gdt={...ca,tSsaoDepth:xn("texture","rgba","ubyte","nearest"),uTexSize:Ne("v2"),uKernel:Ne("f[]"),dOcclusionKernelSize:cn("number"),uBlurDirectionX:Ne("f"),uBlurDirectionY:Ne("f"),uInvProjection:Ne("m4"),uNear:Ne("f"),uFar:Ne("f"),uBounds:Ne("v4"),dOrthographic:cn("number")};function h0e(e,t,n){const r={...ua,tSsaoDepth:O.create(t),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight())),uKernel:O.create(m0e(15)),dOcclusionKernelSize:O.create(15),uBlurDirectionX:O.create("horizontal"===n?1:0),uBlurDirectionY:O.create("vertical"===n?1:0),uInvProjection:O.create(fe.identity()),uNear:O.create(0),uFar:O.create(1e4),uBounds:O.create(Bn()),dOrthographic:O.create(0)},i={...gdt};return ys(ms(e,"triangles",Wi("ssao_blur",hl,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uKernel[dOcclusionKernelSize];\n\nuniform float uBlurDirectionX;\nuniform float uBlurDirectionY;\n\nuniform mat4 uInvProjection;\nuniform float uNear;\nuniform float uFar;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec2 packedDepth = texture2D(tSsaoDepth, coords).zw;\n\n    if (outsideBounds(coords)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfDepth = unpackRGToUnitInterval(packedDepth);\n    // if background and if second pass\n    if (isBackground(selfDepth) && uBlurDirectionY != 0.0) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), packedDepth);\n        return;\n    }\n\n    float selfViewZ = getViewZ(selfDepth);\n    float pixelSize = getPixelSize(coords, selfDepth);\n    float maxDiffViewZ = pixelSize * 10.0;\n\n    vec2 offset = vec2(uBlurDirectionX, uBlurDirectionY) / uTexSize;\n\n    float sum = 0.0;\n    float kernelSum = 0.0;\n    // only if kernelSize is odd\n    for (int i = -dOcclusionKernelSize / 2; i <= dOcclusionKernelSize / 2; i++) {\n        if (abs(float(i)) > 1.0 && abs(float(i)) * pixelSize > 0.8) continue;\n\n        vec2 sampleCoords = coords + float(i) * offset;\n        if (outsideBounds(sampleCoords)) {\n            continue;\n        }\n\n        vec4 sampleSsaoDepth = texture2D(tSsaoDepth, sampleCoords);\n\n        float sampleDepth = unpackRGToUnitInterval(sampleSsaoDepth.zw);\n        if (isBackground(sampleDepth)) {\n            continue;\n        }\n\n        if (abs(float(i)) > 1.0) {\n            float sampleViewZ = getViewZ(sampleDepth);\n            if (abs(selfViewZ - sampleViewZ) > maxDiffViewZ) {\n                continue;\n            }\n        }\n\n        float kernel = uKernel[int(abs(float(i)))]; // abs is not defined for int in webgl1\n        float sampleValue = unpackRGToUnitInterval(sampleSsaoDepth.xy);\n\n        sum += kernel * sampleValue;\n        kernelSum += kernel;\n    }\n\n    gl_FragColor = vec4(packUnitIntervalToRG(sum / kernelSum), packedDepth);\n}\n"),i,r),r)}function m0e(e){const t=e/3,n=Math.floor((e+1)/2),r=[];for(let i=0;i<n;i++)r.push(1/(Math.sqrt(2*Math.PI)*t)*Math.exp(-i*i/(2*t*t)));return r}const DF=[];for(let e=0;e<256;e++){const t=C();t[0]=2*Math.random()-1,t[1]=2*Math.random()-1,t[2]=Math.random(),C.normalize(t,t),C.scale(t,t,Math.random()),DF.push(t)}function g0e(e){const t=[];for(let n=0;n<e;n++){let r=(n*n+2*n+1)/(e*e);r=.1+.9*r,t.push(DF[n][0]*r),t.push(DF[n][1]*r),t.push(DF[n][2]*r)}return t}const ydt={...ca,tSsaoDepth:xn("texture","rgba","ubyte","nearest"),tColor:xn("texture","rgba","ubyte","nearest"),tDepthOpaque:xn("texture","rgba","ubyte","nearest"),tDepthTransparent:xn("texture","rgba","ubyte","nearest"),tShadows:xn("texture","rgba","ubyte","nearest"),tOutlines:xn("texture","rgba","ubyte","nearest"),uTexSize:Ne("v2"),dOrthographic:cn("number"),uNear:Ne("f"),uFar:Ne("f"),uFogNear:Ne("f"),uFogFar:Ne("f"),uFogColor:Ne("v3"),uOutlineColor:Ne("v3"),uOcclusionColor:Ne("v3"),uTransparentBackground:Ne("b"),dOcclusionEnable:cn("boolean"),uOcclusionOffset:Ne("v2"),dShadowEnable:cn("boolean"),dOutlineEnable:cn("boolean"),dOutlineScale:cn("number"),dTransparentOutline:cn("boolean")},Tq={occlusion:I.MappedStatic("on",{on:I.Group({samples:I.Numeric(32,{min:1,max:256,step:1}),multiScale:I.MappedStatic("off",{on:I.Group({levels:I.ObjectList({radius:I.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x"}),bias:I.Numeric(1,{min:0,max:3,step:.1})},e=>`${e.radius}, ${e.bias}`,{defaultValue:[{radius:2,bias:1},{radius:5,bias:1},{radius:8,bias:1},{radius:11,bias:1}]}),nearThreshold:I.Numeric(10,{min:0,max:50,step:1}),farThreshold:I.Numeric(1500,{min:0,max:1e4,step:100})}),off:I.Group({})},{cycle:!0}),radius:I.Numeric(5,{min:0,max:20,step:.1},{description:"Final occlusion radius is 2^x",hideIf:e=>"on"===e?.multiScale.name}),bias:I.Numeric(.8,{min:0,max:3,step:.1}),blurKernelSize:I.Numeric(15,{min:1,max:25,step:2}),resolutionScale:I.Numeric(1,{min:.1,max:1,step:.05},{description:"Adjust resolution of occlusion calculation"}),color:I.Color(st(0))}),off:I.Group({})},{cycle:!0,description:"Darken occluded crevices with the ambient occlusion effect"}),shadow:I.MappedStatic("off",{on:I.Group({steps:I.Numeric(1,{min:1,max:64,step:1}),bias:I.Numeric(.6,{min:0,max:1,step:.01}),maxDistance:I.Numeric(3,{min:0,max:256,step:1}),tolerance:I.Numeric(1,{min:0,max:10,step:.1})}),off:I.Group({})},{cycle:!0,description:"Simplistic shadows"}),outline:I.MappedStatic("off",{on:I.Group({scale:I.Numeric(1,{min:1,max:5,step:1}),threshold:I.Numeric(.33,{min:.01,max:1,step:.01}),color:I.Color(st(0)),includeTransparent:I.Boolean(!0,{description:"Whether to show outline for transparent objects"})}),off:I.Group({})},{cycle:!0,description:"Draw outline around 3D objects"}),antialiasing:I.MappedStatic("smaa",{fxaa:I.Group(gut),smaa:I.Group(Eut),off:I.Group({})},{options:[["fxaa","FXAA"],["smaa","SMAA"],["off","Off"]],description:"Smooth pixel edges"}),sharpening:I.MappedStatic("off",{on:I.Group(odt),off:I.Group({})},{cycle:!0,description:"Contrast Adaptive Sharpening"}),background:I.Group(Wut,{isFlat:!0})};class Zu{static isEnabled(t){return"on"===t.occlusion.name||"on"===t.shadow.name||"on"===t.outline.name||"off"!==t.background.variant.name}static isTransparentOutlineEnabled(t){return"on"===t.outline.name&&t.outline.params.includeTransparent}calcSsaoScale(t){return Math.min(1,1/this.webgl.pixelRatio)*t}constructor(t,n,r){this.webgl=t,this.drawPass=r,this.bgColor=C(),this.occlusionOffset=[0,0],this.transparentBackground=!1;const{colorTarget:i,depthTextureTransparent:o,depthTextureOpaque:s}=r,a=i.getWidth(),l=i.getHeight();this.nSamples=1,this.blurKernelSize=1,this.ssaoScale=this.calcSsaoScale(1),this.levels=[],this.target=t.createRenderTarget(a,l,!1,"uint8","linear"),this.outlinesTarget=t.createRenderTarget(a,l,!1),this.outlinesRenderable=function ddt(e,t,n,r){const i=t.getWidth(),o=t.getHeight(),s={...ua,tDepthOpaque:O.create(t),tDepthTransparent:O.create(n),uTexSize:O.create(Ue.create(i,o)),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),uInvProjection:O.create(fe.identity()),uOutlineThreshold:O.create(.33),dTransparentOutline:O.create(r)},a={...udt};return ys(ms(e,"triangles",Wi("outlines",hl,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform mat4 uInvProjection;\n\nuniform float uOutlineThreshold;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\nvoid main(void) {\n    float backgroundViewZ = 2.0 * uFar;\n\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float selfDepthOpaque = getDepthOpaque(coords);\n    float selfViewZOpaque = isBackground(selfDepthOpaque) ? backgroundViewZ : getViewZ(selfDepthOpaque);\n    float pixelSizeOpaque = getPixelSize(coords, selfDepthOpaque) * uOutlineThreshold;\n\n    float selfDepthTransparent = getDepthTransparent(coords);\n    float selfViewZTransparent = isBackground(selfDepthTransparent) ? backgroundViewZ : getViewZ(selfDepthTransparent);\n    float pixelSizeTransparent = getPixelSize(coords, selfDepthTransparent) * uOutlineThreshold;\n\n    float outline = 1.0;\n    float bestDepth = 1.0;\n    float transparentFlag = 0.0;\n\n    for (int y = -1; y <= 1; y++) {\n        for (int x = -1; x <= 1; x++) {\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            float sampleDepthOpaque = getDepthOpaque(sampleCoords);\n            float sampleDepthTransparent = getDepthTransparent(sampleCoords);\n\n            float sampleViewZOpaque = isBackground(sampleDepthOpaque) ? backgroundViewZ : getViewZ(sampleDepthOpaque);\n            if (abs(selfViewZOpaque - sampleViewZOpaque) > pixelSizeOpaque && selfDepthOpaque > sampleDepthOpaque && sampleDepthOpaque <= bestDepth) {\n                outline = 0.0;\n                bestDepth = sampleDepthOpaque;\n            }\n\n            if (sampleDepthTransparent < sampleDepthOpaque) {\n                float sampleViewZTransparent = isBackground(sampleDepthTransparent) ? backgroundViewZ : getViewZ(sampleDepthTransparent);\n                if (abs(selfViewZTransparent - sampleViewZTransparent) > pixelSizeTransparent && selfDepthTransparent > sampleDepthTransparent && sampleDepthTransparent <= bestDepth) {\n                    outline = 0.0;\n                    bestDepth = sampleDepthTransparent;\n                    transparentFlag = 1.0;\n                }\n            }\n        }\n    }\n\n    gl_FragColor = vec4(outline, packUnitIntervalToRG(bestDepth), transparentFlag);\n}\n"),a,s),s)}(t,s,o,!0),this.shadowsTarget=t.createRenderTarget(a,l,!1),this.shadowsRenderable=function pdt(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ua,tDepth:O.create(t),uTexSize:O.create(Ue.create(n,r)),uProjection:O.create(fe.identity()),uInvProjection:O.create(fe.identity()),uBounds:O.create(Bn()),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),dSteps:O.create(1),uMaxDistance:O.create(3),uTolerance:O.create(1),uBias:O.create(.6),uLightDirection:O.create([]),uLightColor:O.create([]),dLightCount:O.create(0)},o={...fdt};return ys(ms(e,"triangles",Wi("shadows",hl,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform float uNear;\nuniform float uFar;\n\n#if dLightCount != 0\n    uniform vec3 uLightDirection[dLightCount];\n    uniform vec3 uLightColor[dLightCount];\n#endif\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\nuniform float uMaxDistance;\nuniform float uTolerance;\nuniform float uBias;\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nbool outsideBounds(const in vec2 p) {\n    return p.x < uBounds.x || p.y < uBounds.y || p.x > uBounds.z || p.y > uBounds.w;\n}\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepth(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, coords));\n    #endif\n}\n\nfloat screenFade(const in vec2 coords) {\n    vec2 c = (coords - uBounds.xy) / (uBounds.zw - uBounds.xy);\n    vec2 fade = max(12.0 * abs(c - 0.5) - 5.0, vec2(0.0));\n    return saturate(1.0 - dot(fade, fade));\n}\n\n// based on https://panoskarabelas.com/posts/screen_space_shadows/\nfloat screenSpaceShadow(const in vec3 position, const in vec3 lightDirection, const in float stepLength) {\n    // Ray position and direction (in view-space)\n    vec3 rayPos = position;\n    vec3 rayDir = -lightDirection;\n\n    // Compute ray step\n    vec3 rayStep = rayDir * stepLength;\n\n    // Ray march towards the light\n    float occlusion = 0.0;\n    vec4 rayCoords = vec4(0.0);\n    for (int i = 0; i < dSteps; ++i) {\n        // Step the ray\n        rayPos += rayStep;\n\n        rayCoords = uProjection * vec4(rayPos, 1.0);\n        rayCoords.xyz = (rayCoords.xyz / rayCoords.w) * 0.5 + 0.5;\n\n        if (outsideBounds(rayCoords.xy))\n            return 1.0;\n\n        // Compute the difference between the ray's and the camera's depth\n        float depth = getDepth(rayCoords.xy);\n        float viewZ = getViewZ(depth);\n        float zDelta = rayPos.z - viewZ;\n\n        if (zDelta < uTolerance) {\n            occlusion = 1.0;\n\n            // Fade out as we approach the edges of the screen\n            occlusion *= screenFade(rayCoords.xy);\n\n            break;\n        }\n    }\n\n    return 1.0 - (uBias * occlusion);\n}\n\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(0.0);\n        return;\n    }\n\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n    float stepLength = uMaxDistance / float(dSteps);\n\n    float o = 1.0;\n    #if dLightCount != 0\n        float sh[dLightCount];\n        #pragma unroll_loop_start\n        for (int i = 0; i < dLightCount; ++i) {\n            sh[i] = screenSpaceShadow(selfViewPos, uLightDirection[i], stepLength);\n            o = min(o, sh[i]);\n        }\n        #pragma unroll_loop_end\n    #endif\n\n    gl_FragColor = vec4(o);\n}\n"),o,i),i)}(t,s),this.ssaoFramebuffer=t.resources.framebuffer(),this.ssaoBlurFirstPassFramebuffer=t.resources.framebuffer(),this.ssaoBlurSecondPassFramebuffer=t.resources.framebuffer();const c=Math.floor(a*this.ssaoScale),u=Math.floor(l*this.ssaoScale),d=Math.max(1,Math.floor(.5*c)),f=Math.max(1,Math.floor(.5*u)),p=Math.max(1,Math.floor(.25*c)),m=Math.max(1,Math.floor(.25*u));this.downsampledDepthTarget=r.packedDepth?t.createRenderTarget(c,u,!1,"uint8","linear","rgba"):t.createRenderTarget(c,u,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.downsampleDepthRenderable=Zw(t,s);const h=1===this.ssaoScale?s:this.downsampledDepthTarget.texture;this.depthHalfTarget=r.packedDepth?t.createRenderTarget(d,f,!1,"uint8","linear","rgba"):t.createRenderTarget(d,f,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.depthHalfRenderable=Zw(t,h),this.depthQuarterTarget=r.packedDepth?t.createRenderTarget(p,m,!1,"uint8","linear","rgba"):t.createRenderTarget(p,m,!1,"float32","linear",t.isWebGL2?"alpha":"rgba"),this.depthQuarterRenderable=Zw(t,this.depthHalfTarget.texture),this.ssaoDepthTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthTexture.define(c,u),this.ssaoDepthTexture.attachFramebuffer(this.ssaoFramebuffer,"color0"),this.ssaoDepthBlurProxyTexture=t.resources.texture("image-uint8","rgba","ubyte","linear"),this.ssaoDepthBlurProxyTexture.define(c,u),this.ssaoDepthBlurProxyTexture.attachFramebuffer(this.ssaoBlurFirstPassFramebuffer,"color0"),this.ssaoDepthTexture.attachFramebuffer(this.ssaoBlurSecondPassFramebuffer,"color0"),this.ssaoRenderable=function mdt(e,t,n,r){const i={...ua,tDepth:O.create(t),tDepthHalf:O.create(n),tDepthQuarter:O.create(r),uSamples:O.create(g0e(32)),dNSamples:O.create(32),uProjection:O.create(fe.identity()),uInvProjection:O.create(fe.identity()),uBounds:O.create(Bn()),uTexSize:O.create(Ue.create(e.gl.drawingBufferWidth,e.gl.drawingBufferHeight)),uRadius:O.create(Math.pow(2,5)),uBias:O.create(.8),dMultiScale:O.create(!1),dLevels:O.create(3),uLevelRadius:O.create([Math.pow(2,2),Math.pow(2,5),Math.pow(2,8)]),uLevelBias:O.create([.8,.8,.8]),uNearThreshold:O.create(10),uFarThreshold:O.create(1500)},o={...hdt};return ys(ms(e,"triangles",Wi("ssao",hl,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\n#include common\n\nuniform sampler2D tDepth;\nuniform sampler2D tDepthHalf;\nuniform sampler2D tDepthQuarter;\nuniform vec2 uTexSize;\nuniform vec4 uBounds;\n\nuniform vec3 uSamples[dNSamples];\n\nuniform mat4 uProjection;\nuniform mat4 uInvProjection;\n\n#ifdef dMultiScale\n    uniform float uLevelRadius[dLevels];\n    uniform float uLevelBias[dLevels];\n    uniform float uNearThreshold;\n    uniform float uFarThreshold;\n#else\n    uniform float uRadius;\n#endif\nuniform float uBias;\n\nfloat smootherstep(float edge0, float edge1, float x) {\n    x = clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n    return x * x * x * (x * (x * 6.0 - 15.0) + 10.0);\n}\n\nfloat noise(const in vec2 coords) {\n    float a = 12.9898;\n    float b = 78.233;\n    float c = 43758.5453;\n    float dt = dot(coords, vec2(a,b));\n    float sn = mod(dt, PI);\n    return abs(fract(sin(sn) * c)); // is abs necessary?\n}\n\nvec2 getNoiseVec2(const in vec2 coords) {\n    return vec2(noise(coords), noise(coords + vec2(PI, 2.71828)));\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getDepth(const in vec2 coords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    #ifdef depthTextureSupport\n        return texture2D(tDepth, c).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepth, c));\n    #endif\n}\n\n#define dQuarterThreshold 0.1\n#define dHalfThreshold 0.05\n\nfloat getMappedDepth(const in vec2 coords, const in vec2 selfCoords) {\n    vec2 c = vec2(clamp(coords.x, uBounds.x, uBounds.z), clamp(coords.y, uBounds.y, uBounds.w));\n    float d = distance(coords, selfCoords);\n    #ifdef depthTextureSupport\n        if (d > dQuarterThreshold) {\n            return texture2D(tDepthQuarter, c).r;\n        } else if (d > dHalfThreshold) {\n            return texture2D(tDepthHalf, c).r;\n        } else {\n            return texture2D(tDepth, c).r;\n        }\n    #else\n        if (d > dQuarterThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthQuarter, c));\n        } else if (d > dHalfThreshold) {\n            return unpackRGBAToDepth(texture2D(tDepthHalf, c));\n        } else {\n            return unpackRGBAToDepth(texture2D(tDepth, c));\n        }\n    #endif\n}\n\nvec3 normalFromDepth(const in float depth, const in float depth1, const in float depth2, vec2 offset1, vec2 offset2) {\n    vec3 p1 = vec3(offset1, depth1 - depth);\n    vec3 p2 = vec3(offset2, depth2 - depth);\n\n    vec3 normal = cross(p1, p2);\n    normal.z = -normal.z;\n\n    return normalize(normal);\n}\n\nfloat getPixelSize(const in vec2 coords, const in float depth) {\n    vec3 viewPos0 = screenSpaceToViewSpace(vec3(coords, depth), uInvProjection);\n    vec3 viewPos1 = screenSpaceToViewSpace(vec3(coords + vec2(1.0, 0.0) / uTexSize, depth), uInvProjection);\n    return distance(viewPos0, viewPos1);\n}\n\n// StarCraft II Ambient Occlusion by [Filion and McNaughton 2008]\nvoid main(void) {\n    vec2 invTexSize = 1.0 / uTexSize;\n    vec2 selfCoords = gl_FragCoord.xy * invTexSize;\n\n    float selfDepth = getDepth(selfCoords);\n    vec2 selfPackedDepth = packUnitIntervalToRG(selfDepth);\n\n    if (isBackground(selfDepth)) {\n        gl_FragColor = vec4(packUnitIntervalToRG(1.0), selfPackedDepth);\n        return;\n    }\n\n    vec2 offset1 = vec2(0.0, invTexSize.y);\n    vec2 offset2 = vec2(invTexSize.x, 0.0);\n\n    float selfDepth1 = getDepth(selfCoords + offset1);\n    float selfDepth2 = getDepth(selfCoords + offset2);\n\n    vec3 selfViewNormal = normalFromDepth(selfDepth, selfDepth1, selfDepth2, offset1, offset2);\n    vec3 selfViewPos = screenSpaceToViewSpace(vec3(selfCoords, selfDepth), uInvProjection);\n\n    vec3 randomVec = normalize(vec3(getNoiseVec2(selfCoords) * 2.0 - 1.0, 0.0));\n    vec3 tangent = normalize(randomVec - selfViewNormal * dot(randomVec, selfViewNormal));\n    vec3 bitangent = cross(selfViewNormal, tangent);\n    mat3 TBN = mat3(tangent, bitangent, selfViewNormal);\n\n    float occlusion = 0.0;\n    #ifdef dMultiScale\n        float pixelSize = getPixelSize(selfCoords, selfDepth);\n\n        for(int l = 0; l < dLevels; l++) {\n            // TODO: smooth transition\n            if (pixelSize * uNearThreshold > uLevelRadius[l]) continue;\n            if (pixelSize * uFarThreshold < uLevelRadius[l]) continue;\n\n            float levelOcclusion = 0.0;\n            for(int i = 0; i < dNSamples; i++) {\n                vec3 sampleViewPos = TBN * uSamples[i];\n                sampleViewPos = selfViewPos + sampleViewPos * uLevelRadius[l];\n\n                vec4 offset = vec4(sampleViewPos, 1.0);\n                offset = uProjection * offset;\n                offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n                float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n                float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n                levelOcclusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uLevelRadius[l] / abs(selfViewPos.z - sampleViewZ)) * uLevelBias[l];\n            }\n            occlusion = max(occlusion, levelOcclusion);\n        }\n    #else\n        for(int i = 0; i < dNSamples; i++) {\n            vec3 sampleViewPos = TBN * uSamples[i];\n            sampleViewPos = selfViewPos + sampleViewPos * uRadius;\n\n            vec4 offset = vec4(sampleViewPos, 1.0);\n            offset = uProjection * offset;\n            offset.xyz = (offset.xyz / offset.w) * 0.5 + 0.5;\n\n            float sampleDepth = getMappedDepth(offset.xy, selfCoords);\n            float sampleViewZ = screenSpaceToViewSpace(vec3(offset.xy, sampleDepth), uInvProjection).z;\n\n            occlusion += step(sampleViewPos.z + 0.025, sampleViewZ) * smootherstep(0.0, 1.0, uRadius / abs(selfViewPos.z - sampleViewZ));\n        }\n    #endif\n    occlusion = 1.0 - (uBias * occlusion / float(dNSamples));\n\n    vec2 packedOcclusion = packUnitIntervalToRG(clamp(occlusion, 0.01, 1.0));\n\n    gl_FragColor = vec4(packedOcclusion, selfPackedDepth);\n}\n"),o,i),i)}(t,h,this.depthHalfTarget.texture,this.depthQuarterTarget.texture),this.ssaoBlurFirstPassRenderable=h0e(t,this.ssaoDepthTexture,"horizontal"),this.ssaoBlurSecondPassRenderable=h0e(t,this.ssaoDepthBlurProxyTexture,"vertical"),this.renderable=function bdt(e,t,n,r,i,o,s,a){const l={...ua,tSsaoDepth:O.create(s),tColor:O.create(t),tDepthOpaque:O.create(n),tDepthTransparent:O.create(r),tShadows:O.create(i),tOutlines:O.create(o),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight())),dOrthographic:O.create(0),uNear:O.create(1),uFar:O.create(1e4),uFogNear:O.create(1e4),uFogFar:O.create(1e4),uFogColor:O.create(C.create(1,1,1)),uOutlineColor:O.create(C.create(0,0,0)),uOcclusionColor:O.create(C.create(0,0,0)),uTransparentBackground:O.create(!1),dOcclusionEnable:O.create(!0),uOcclusionOffset:O.create(Ue.create(0,0)),dShadowEnable:O.create(!1),dOutlineEnable:O.create(!1),dOutlineScale:O.create(1),dTransparentOutline:O.create(a)},c={...ydt};return ys(ms(e,"triangles",Wi("postprocessing",hl,"\nprecision highp float;\nprecision highp int;\nprecision highp sampler2D;\n\nuniform sampler2D tSsaoDepth;\nuniform sampler2D tColor;\nuniform sampler2D tDepthOpaque;\nuniform sampler2D tDepthTransparent;\nuniform sampler2D tShadows;\nuniform sampler2D tOutlines;\nuniform vec2 uTexSize;\n\nuniform float uNear;\nuniform float uFar;\nuniform float uFogNear;\nuniform float uFogFar;\nuniform vec3 uFogColor;\nuniform vec3 uOutlineColor;\nuniform vec3 uOcclusionColor;\nuniform bool uTransparentBackground;\nuniform vec2 uOcclusionOffset;\n\n#include common\n\nfloat getViewZ(const in float depth) {\n    #if dOrthographic == 1\n        return orthographicDepthToViewZ(depth, uNear, uFar);\n    #else\n        return perspectiveDepthToViewZ(depth, uNear, uFar);\n    #endif\n}\n\nfloat getDepthOpaque(const in vec2 coords) {\n    #ifdef depthTextureSupport\n        return texture2D(tDepthOpaque, coords).r;\n    #else\n        return unpackRGBAToDepth(texture2D(tDepthOpaque, coords));\n    #endif\n}\n\nfloat getDepthTransparent(const in vec2 coords) {\n    #ifdef dTransparentOutline\n        return unpackRGBAToDepth(texture2D(tDepthTransparent, coords));\n    #else\n        return 1.0;\n    #endif\n}\n\nbool isBackground(const in float depth) {\n    return depth == 1.0;\n}\n\nfloat getOutline(const in vec2 coords, const in float opaqueDepth, out float closestTexel) {\n    float backgroundViewZ = 2.0 * uFar;\n    vec2 invTexSize = 1.0 / uTexSize;\n\n    float transparentDepth = getDepthTransparent(coords);\n    float opaqueSelfViewZ = isBackground(opaqueDepth) ? backgroundViewZ : getViewZ(opaqueDepth);\n    float transparentSelfViewZ = isBackground(transparentDepth) ? backgroundViewZ : getViewZ(transparentDepth);\n    float selfDepth = min(opaqueDepth, transparentDepth);\n\n    float outline = 1.0;\n    closestTexel = 1.0;\n    for (int y = -dOutlineScale; y <= dOutlineScale; y++) {\n        for (int x = -dOutlineScale; x <= dOutlineScale; x++) {\n            if (x * x + y * y > dOutlineScale * dOutlineScale) {\n                continue;\n            }\n\n            vec2 sampleCoords = coords + vec2(float(x), float(y)) * invTexSize;\n\n            vec4 sampleOutlineCombined = texture2D(tOutlines, sampleCoords);\n            float sampleOutline = sampleOutlineCombined.r;\n            float sampleOutlineDepth = unpackRGToUnitInterval(sampleOutlineCombined.gb);\n            float sampleOutlineViewZ = isBackground(sampleOutlineDepth) ? backgroundViewZ : getViewZ(sampleOutlineDepth);\n\n            float selfViewZ = sampleOutlineCombined.a == 0.0 ? opaqueSelfViewZ : transparentSelfViewZ;\n            if (sampleOutline == 0.0 && sampleOutlineDepth < closestTexel) {\n                outline = 0.0;\n                closestTexel = sampleOutlineDepth;\n            }\n        }\n    }\n    return closestTexel < opaqueDepth ? outline : 1.0;\n}\n\nfloat getSsao(vec2 coords) {\n    float rawSsao = unpackRGToUnitInterval(texture2D(tSsaoDepth, coords).xy);\n    if (rawSsao > 0.999) {\n        return 1.0;\n    } else if (rawSsao > 0.001) {\n        return rawSsao;\n    }\n    // treat values close to 0.0 as errors and return no occlusion\n    return 1.0;\n}\n\nvoid main(void) {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    vec4 color = texture2D(tColor, coords);\n\n    float viewDist;\n    float fogFactor;\n    float opaqueDepth = getDepthOpaque(coords);\n\n    #ifdef dOcclusionEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            float occlusionFactor = getSsao(coords + uOcclusionOffset);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(uOcclusionColor, uFogColor, fogFactor), color.rgb, occlusionFactor);\n            } else {\n                color.rgb = mix(uOcclusionColor * (1.0 - fogFactor), color.rgb, occlusionFactor);\n            }\n        }\n    #endif\n\n    #ifdef dShadowEnable\n        if (!isBackground(opaqueDepth)) {\n            viewDist = abs(getViewZ(opaqueDepth));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            vec4 shadow = texture2D(tShadows, coords);\n            if (!uTransparentBackground) {\n                color.rgb = mix(mix(vec3(0), uFogColor, fogFactor), color.rgb, shadow.a);\n            } else {\n                color.rgb = mix(vec3(0) * (1.0 - fogFactor), color.rgb, shadow.a);\n            }\n        }\n    #endif\n\n    // outline needs to be handled after occlusion and shadow to keep them clean\n    #ifdef dOutlineEnable\n        float closestTexel;\n        float outline = getOutline(coords, opaqueDepth, closestTexel);\n        if (outline == 0.0) {\n            viewDist = abs(getViewZ(closestTexel));\n            fogFactor = smoothstep(uFogNear, uFogFar, viewDist);\n            if (!uTransparentBackground) {\n                color.rgb = mix(uOutlineColor, uFogColor, fogFactor);\n            } else {\n                color.a = 1.0 - fogFactor;\n                color.rgb = mix(uOutlineColor, color.rgb, fogFactor);\n            }\n        }\n    #endif\n\n    gl_FragColor = color;\n}\n"),c,l),l)}(t,i.texture,s,o,this.shadowsTarget.texture,this.outlinesTarget.texture,this.ssaoDepthTexture,!0),this.background=new $ut(t,n,a,l)}setSize(t,n){const[r,i]=this.renderable.values.uTexSize.ref.value,o=this.calcSsaoScale(1);if(t!==r||n!==i||this.ssaoScale!==o){this.ssaoScale=o,this.target.setSize(t,n),this.outlinesTarget.setSize(t,n),this.shadowsTarget.setSize(t,n);const s=Math.floor(t*this.ssaoScale),a=Math.floor(n*this.ssaoScale);this.downsampledDepthTarget.setSize(s,a),this.ssaoDepthTexture.define(s,a),this.ssaoDepthBlurProxyTexture.define(s,a);const l=Math.max(1,Math.floor(.5*s)),c=Math.max(1,Math.floor(.5*a));this.depthHalfTarget.setSize(l,c);const u=Math.max(1,Math.floor(.25*s)),d=Math.max(1,Math.floor(.25*a));this.depthQuarterTarget.setSize(u,d),O.update(this.renderable.values.uTexSize,Ue.set(this.renderable.values.uTexSize.ref.value,t,n)),O.update(this.outlinesRenderable.values.uTexSize,Ue.set(this.outlinesRenderable.values.uTexSize.ref.value,t,n)),O.update(this.shadowsRenderable.values.uTexSize,Ue.set(this.shadowsRenderable.values.uTexSize.ref.value,t,n)),O.update(this.downsampleDepthRenderable.values.uTexSize,Ue.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,s,a)),O.update(this.depthHalfRenderable.values.uTexSize,Ue.set(this.depthHalfRenderable.values.uTexSize.ref.value,l,c)),O.update(this.depthQuarterRenderable.values.uTexSize,Ue.set(this.depthQuarterRenderable.values.uTexSize.ref.value,u,d)),O.update(this.ssaoRenderable.values.uTexSize,Ue.set(this.ssaoRenderable.values.uTexSize.ref.value,s,a)),O.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ue.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,s,a)),O.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ue.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,s,a));const f=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;O.update(this.depthHalfRenderable.values.tColor,f),O.update(this.ssaoRenderable.values.tDepth,f),this.depthHalfRenderable.update(),this.ssaoRenderable.update(),this.background.setSize(t,n)}}updateState(t,n,r,i,o){var s;let a=!1,l=!1,c=!1,u=!1,d=!1,f=!1;const p="orthographic"===t.state.mode?1:0,m="on"===i.outline.name,h="on"===i.shadow.name,g="on"===i.occlusion.name,y=fe.identity();fe.invert(y,t.projection);const[v,x]=this.renderable.values.uTexSize.ref.value,_=t.viewport;if("on"===i.occlusion.name){O.update(this.ssaoRenderable.values.uProjection,t.projection),O.update(this.ssaoRenderable.values.uInvProjection,y);const M=this.ssaoRenderable.values.uBounds,E=this.ssaoScale;Bn.set(M.ref.value,Math.floor(_.x*E)/(v*E),Math.floor(_.y*E)/(x*E),Math.ceil((_.x+_.width)*E)/(v*E),Math.ceil((_.y+_.height)*E)/(x*E)),O.update(M,M.ref.value),O.update(this.ssaoBlurFirstPassRenderable.values.uBounds,M.ref.value),O.update(this.ssaoBlurSecondPassRenderable.values.uBounds,M.ref.value),O.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uNear,t.near),O.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uNear,t.near),O.updateIfChanged(this.ssaoBlurFirstPassRenderable.values.uFar,t.far),O.updateIfChanged(this.ssaoBlurSecondPassRenderable.values.uFar,t.far),O.update(this.ssaoBlurFirstPassRenderable.values.uInvProjection,y),O.update(this.ssaoBlurSecondPassRenderable.values.uInvProjection,y),this.ssaoBlurFirstPassRenderable.values.dOrthographic.ref.value!==p&&(u=!0,O.update(this.ssaoBlurFirstPassRenderable.values.dOrthographic,p),O.update(this.ssaoBlurSecondPassRenderable.values.dOrthographic,p)),this.nSamples!==i.occlusion.params.samples&&(c=!0,this.nSamples=i.occlusion.params.samples,O.update(this.ssaoRenderable.values.uSamples,g0e(this.nSamples)),O.updateIfChanged(this.ssaoRenderable.values.dNSamples,this.nSamples));const D="on"===i.occlusion.params.multiScale.name;if(this.ssaoRenderable.values.dMultiScale.ref.value!==D&&(c=!0,O.update(this.ssaoRenderable.values.dMultiScale,D)),"on"===i.occlusion.params.multiScale.name){const F=i.occlusion.params.multiScale.params;if(!tg(this.levels,F.levels)){c=!0,this.levels=F.levels;const R=function vdt(e,t){const n=e.length,{radius:r,bias:i}=t||{radius:new Array(3*n).fill(0),bias:new Array(3*n).fill(0)};e=e.slice().sort((o,s)=>o.radius-s.radius);for(let o=0;o<n;++o){const s=e[o];r[o]=Math.pow(2,s.radius),i[o]=s.bias}return{count:n,radius:r,bias:i}}(F.levels);O.updateIfChanged(this.ssaoRenderable.values.dLevels,R.count),O.update(this.ssaoRenderable.values.uLevelRadius,R.radius),O.update(this.ssaoRenderable.values.uLevelBias,R.bias)}O.updateIfChanged(this.ssaoRenderable.values.uNearThreshold,F.nearThreshold),O.updateIfChanged(this.ssaoRenderable.values.uFarThreshold,F.farThreshold)}else O.updateIfChanged(this.ssaoRenderable.values.uRadius,Math.pow(2,i.occlusion.params.radius));if(O.updateIfChanged(this.ssaoRenderable.values.uBias,i.occlusion.params.bias),this.blurKernelSize!==i.occlusion.params.blurKernelSize){u=!0,this.blurKernelSize=i.occlusion.params.blurKernelSize;const F=m0e(this.blurKernelSize);O.update(this.ssaoBlurFirstPassRenderable.values.uKernel,F),O.update(this.ssaoBlurSecondPassRenderable.values.uKernel,F),O.update(this.ssaoBlurFirstPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize),O.update(this.ssaoBlurSecondPassRenderable.values.dOcclusionKernelSize,this.blurKernelSize)}const T=this.calcSsaoScale(i.occlusion.params.resolutionScale);if(this.ssaoScale!==T){c=!0,d=!0,this.ssaoScale=T;const F=Math.floor(v*this.ssaoScale),R=Math.floor(x*this.ssaoScale);this.downsampledDepthTarget.setSize(F,R),this.ssaoDepthTexture.define(F,R),this.ssaoDepthBlurProxyTexture.define(F,R);const N=Math.floor(.5*F),j=Math.floor(.5*R);this.depthHalfTarget.setSize(N,j);const W=Math.floor(.25*F),z=Math.floor(.25*R);this.depthQuarterTarget.setSize(W,z);const $=1===this.ssaoScale?this.drawPass.depthTextureOpaque:this.downsampledDepthTarget.texture;O.update(this.depthHalfRenderable.values.tColor,$),O.update(this.ssaoRenderable.values.tDepth,$),O.update(this.ssaoRenderable.values.tDepthHalf,this.depthHalfTarget.texture),O.update(this.ssaoRenderable.values.tDepthQuarter,this.depthQuarterTarget.texture),O.update(this.downsampleDepthRenderable.values.uTexSize,Ue.set(this.downsampleDepthRenderable.values.uTexSize.ref.value,F,R)),O.update(this.depthHalfRenderable.values.uTexSize,Ue.set(this.depthHalfRenderable.values.uTexSize.ref.value,N,j)),O.update(this.depthQuarterRenderable.values.uTexSize,Ue.set(this.depthQuarterRenderable.values.uTexSize.ref.value,W,z)),O.update(this.ssaoRenderable.values.uTexSize,Ue.set(this.ssaoRenderable.values.uTexSize.ref.value,F,R)),O.update(this.ssaoBlurFirstPassRenderable.values.uTexSize,Ue.set(this.ssaoBlurFirstPassRenderable.values.uTexSize.ref.value,F,R)),O.update(this.ssaoBlurSecondPassRenderable.values.uTexSize,Ue.set(this.ssaoBlurSecondPassRenderable.values.uTexSize.ref.value,F,R))}O.update(this.renderable.values.uOcclusionColor,st.toVec3Normalized(this.renderable.values.uOcclusionColor.ref.value,i.occlusion.params.color))}if("on"===i.shadow.name&&(O.update(this.shadowsRenderable.values.uProjection,t.projection),O.update(this.shadowsRenderable.values.uInvProjection,y),Bn.set(this.shadowsRenderable.values.uBounds.ref.value,_.x/v,_.y/x,(_.x+_.width)/v,(_.y+_.height)/x),O.update(this.shadowsRenderable.values.uBounds,this.shadowsRenderable.values.uBounds.ref.value),O.updateIfChanged(this.shadowsRenderable.values.uNear,t.near),O.updateIfChanged(this.shadowsRenderable.values.uFar,t.far),this.shadowsRenderable.values.dOrthographic.ref.value!==p&&(O.update(this.shadowsRenderable.values.dOrthographic,p),a=!0),O.updateIfChanged(this.shadowsRenderable.values.uMaxDistance,i.shadow.params.maxDistance),O.updateIfChanged(this.shadowsRenderable.values.uTolerance,i.shadow.params.tolerance),O.updateIfChanged(this.shadowsRenderable.values.uBias,i.shadow.params.bias),this.shadowsRenderable.values.dSteps.ref.value!==i.shadow.params.steps&&(O.update(this.shadowsRenderable.values.dSteps,i.shadow.params.steps),a=!0),O.update(this.shadowsRenderable.values.uLightDirection,o.direction),O.update(this.shadowsRenderable.values.uLightColor,o.color),this.shadowsRenderable.values.dLightCount.ref.value!==o.count&&(O.update(this.shadowsRenderable.values.dLightCount,o.count),a=!0)),"on"===i.outline.name){const M=null===(s=i.outline.params.includeTransparent)||void 0===s||s,E=Math.max(1,Math.round(i.outline.params.scale*this.webgl.pixelRatio))-1,D=50*i.outline.params.threshold*this.webgl.pixelRatio;O.updateIfChanged(this.outlinesRenderable.values.uNear,t.near),O.updateIfChanged(this.outlinesRenderable.values.uFar,t.far),O.update(this.outlinesRenderable.values.uInvProjection,y),this.outlinesRenderable.values.dTransparentOutline.ref.value!==M&&(f=!0,O.update(this.outlinesRenderable.values.dTransparentOutline,M)),this.outlinesRenderable.values.dOrthographic.ref.value!==p&&(f=!0,O.update(this.outlinesRenderable.values.dOrthographic,p)),O.updateIfChanged(this.outlinesRenderable.values.uOutlineThreshold,D),O.update(this.renderable.values.uOutlineColor,st.toVec3Normalized(this.renderable.values.uOutlineColor.ref.value,i.outline.params.color)),this.renderable.values.dOutlineScale.ref.value!==E&&(l=!0,O.update(this.renderable.values.dOutlineScale,E)),this.renderable.values.dTransparentOutline.ref.value!==M&&(l=!0,O.update(this.renderable.values.dTransparentOutline,M))}O.updateIfChanged(this.renderable.values.uFar,t.far),O.updateIfChanged(this.renderable.values.uNear,t.near),O.updateIfChanged(this.renderable.values.uFogFar,t.fogFar),O.updateIfChanged(this.renderable.values.uFogNear,t.fogNear),O.update(this.renderable.values.uFogColor,st.toVec3Normalized(this.renderable.values.uFogColor.ref.value,r)),O.updateIfChanged(this.renderable.values.uTransparentBackground,n),this.renderable.values.dOrthographic.ref.value!==p&&(l=!0,O.update(this.renderable.values.dOrthographic,p)),this.renderable.values.dOutlineEnable.ref.value!==m&&(l=!0,O.update(this.renderable.values.dOutlineEnable,m)),this.renderable.values.dShadowEnable.ref.value!==h&&(l=!0,O.update(this.renderable.values.dShadowEnable,h)),this.renderable.values.dOcclusionEnable.ref.value!==g&&(l=!0,O.update(this.renderable.values.dOcclusionEnable,g)),f&&this.outlinesRenderable.update(),a&&this.shadowsRenderable.update(),c&&this.ssaoRenderable.update(),u&&(this.ssaoBlurFirstPassRenderable.update(),this.ssaoBlurSecondPassRenderable.update()),d&&this.depthHalfRenderable.update(),l&&this.renderable.update();const{gl:w,state:A}=this.webgl;A.enable(w.SCISSOR_TEST),A.disable(w.BLEND),A.disable(w.DEPTH_TEST),A.depthMask(!1)}setOcclusionOffset(t,n){this.occlusionOffset[0]=t,this.occlusionOffset[1]=n,O.update(this.renderable.values.uOcclusionOffset,Ue.set(this.renderable.values.uOcclusionOffset.ref.value,t,n))}setTransparentBackground(t){this.transparentBackground=t}render(t,n,r,i,o,s){It&&this.webgl.timer.mark("PostprocessingPass.render"),this.updateState(t,r,i,o,s);const{gl:a,state:l}=this.webgl,{x:c,y:u,width:d,height:f}=t.viewport;if("on"===o.occlusion.name&&0===this.occlusionOffset[0]&&0===this.occlusionOffset[1]){It&&this.webgl.timer.mark("SSAO.render");const p=Math.floor(c*this.ssaoScale),m=Math.floor(u*this.ssaoScale),h=Math.ceil(d*this.ssaoScale),g=Math.ceil(f*this.ssaoScale);l.viewport(p,m,h,g),l.scissor(p,m,h,g),this.ssaoScale<1&&(It&&this.webgl.timer.mark("SSAO.downsample"),this.downsampledDepthTarget.bind(),this.downsampleDepthRenderable.render(),It&&this.webgl.timer.markEnd("SSAO.downsample")),It&&this.webgl.timer.mark("SSAO.half"),this.depthHalfTarget.bind(),this.depthHalfRenderable.render(),It&&this.webgl.timer.markEnd("SSAO.half"),It&&this.webgl.timer.mark("SSAO.quarter"),this.depthQuarterTarget.bind(),this.depthQuarterRenderable.render(),It&&this.webgl.timer.markEnd("SSAO.quarter"),this.ssaoFramebuffer.bind(),this.ssaoRenderable.render(),this.ssaoBlurFirstPassFramebuffer.bind(),this.ssaoBlurFirstPassRenderable.render(),this.ssaoBlurSecondPassFramebuffer.bind(),this.ssaoBlurSecondPassRenderable.render(),It&&this.webgl.timer.markEnd("SSAO.render")}l.viewport(c,u,d,f),l.scissor(c,u,d,f),"on"===o.outline.name&&(this.outlinesTarget.bind(),this.outlinesRenderable.render()),"on"===o.shadow.name&&(this.shadowsTarget.bind(),this.shadowsRenderable.render()),n?this.webgl.unbindFramebuffer():this.target.bind(),this.background.update(t,o.background),this.background.isEnabled(o.background)?(this.transparentBackground?l.clearColor(0,0,0,0):(st.toVec3Normalized(this.bgColor,i),l.clearColor(this.bgColor[0],this.bgColor[1],this.bgColor[2],1)),a.clear(a.COLOR_BUFFER_BIT),l.enable(a.BLEND),l.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA),this.background.render()):(l.clearColor(0,0,0,1),a.clear(a.COLOR_BUFFER_BIT)),this.renderable.render(),It&&this.webgl.timer.markEnd("PostprocessingPass.render")}}class Dq{static isEnabled(t){return"off"!==t.antialiasing.name}constructor(t,n){this.drawPass=n;const{colorTarget:r}=n,i=r.getWidth(),o=r.getHeight();this.target=t.createRenderTarget(i,o,!1),this.internalTarget=t.createRenderTarget(i,o,!1),this.fxaa=new yut(t,this.target.texture),this.smaa=new Tut(t,this.target.texture),this.cas=new sdt(t,this.target.texture)}setSize(t,n){const r=this.target.texture.getWidth(),i=this.target.texture.getHeight();(t!==r||n!==i)&&(this.target.setSize(t,n),this.internalTarget.setSize(t,n),this.fxaa.setSize(t,n),this.smaa.supported&&this.smaa.setSize(t,n),this.cas.setSize(t,n))}_renderFxaa(t,n,r){if("fxaa"!==r.antialiasing.name)return;const i=Zu.isEnabled(r)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.fxaa.update(i,r.antialiasing.params),this.fxaa.render(t.viewport,n)}_renderSmaa(t,n,r){if("smaa"!==r.antialiasing.name)return;const i=Zu.isEnabled(r)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.smaa.update(i,r.antialiasing.params),this.smaa.render(t.viewport,n)}_renderAntialiasing(t,n,r){"fxaa"===r.antialiasing.name?this._renderFxaa(t,n,r):"smaa"===r.antialiasing.name&&this._renderSmaa(t,n,r)}_renderCas(t,n,r){if("on"!==r.sharpening.name)return;const i="off"!==r.antialiasing.name?this.internalTarget.texture:Zu.isEnabled(r)?this.drawPass.postprocessing.target.texture:this.drawPass.colorTarget.texture;this.cas.update(i,r.sharpening.params),this.cas.render(t.viewport,n)}render(t,n,r){if("off"===r.antialiasing.name&&"off"===r.sharpening.name)return;if("smaa"===r.antialiasing.name&&!this.smaa.supported)return void console.error('SMAA not supported, missing "HTMLImageElement"');const i=n?void 0:this.target;"off"===r.sharpening.name?this._renderAntialiasing(t,i,r):("off"===r.antialiasing.name||this._renderAntialiasing(t,this.internalTarget,r),this._renderCas(t,i,r))}}const _dt={...ca,tColor:xn("texture","rgba","ubyte","nearest"),uTexSize:Ne("v2"),uWeight:Ne("f")},Sdt=Wi("compose",hl,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tColor;\nuniform vec2 uTexSize;\nuniform float uWeight;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tColor, coords) * uWeight;\n}\n"),y0e={mode:I.Select("temporal",[["off","Off"],["on","On"],["temporal","Temporal"]]),sampleLevel:I.Numeric(2,{min:0,max:5,step:1},{description:"Take level^2 samples."}),reduceFlicker:I.Boolean(!0,{description:'Reduce flicker in "temporal" mode.'})};class PF{static isEnabled(t){return"off"!==t.mode}constructor(t,n){this.webgl=t,this.drawPass=n;const{colorBufferFloat:r,textureFloat:i,colorBufferHalfFloat:o,textureHalfFloat:s}=t.extensions,a=n.colorTarget.getWidth(),l=n.colorTarget.getHeight();this.colorTarget=t.createRenderTarget(a,l,!1),this.composeTarget=t.createRenderTarget(a,l,!1,o&&s?"fp16":r&&i?"float32":"uint8"),this.holdTarget=t.createRenderTarget(a,l,!1),this.compose=function Cdt(e,t){const n={...ua,tColor:O.create(t),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight())),uWeight:O.create(1)},r={..._dt};return ys(ms(e,"triangles",Sdt,r,n),n)}(t,n.colorTarget.texture)}syncSize(){const t=this.drawPass.colorTarget.getWidth(),n=this.drawPass.colorTarget.getHeight(),[r,i]=this.compose.values.uTexSize.ref.value;(t!==r||n!==i)&&(this.colorTarget.setSize(t,n),this.composeTarget.setSize(t,n),this.holdTarget.setSize(t,n),O.update(this.compose.values.uTexSize,Ue.set(this.compose.values.uTexSize.ref.value,t,n)))}render(t,n,r,i,o){return"temporal"!==r.multiSample.mode||o?(this.renderMultiSample(n,i,r),-2):this.renderTemporalMultiSample(t,n,r,i)}bindOutputTarget(t){t?this.webgl.unbindFramebuffer():this.colorTarget.bind()}renderMultiSample(t,n,r){const{camera:i}=t,{compose:o,composeTarget:s,drawPass:a,webgl:l}=this,{gl:c,state:u}=l;It&&l.timer.mark("MultiSamplePass.renderMultiSample");const d=Pq[Math.max(0,Math.min(r.multiSample.sampleLevel,5))],{x:f,y:p,width:m,height:h}=i.viewport,g=1/d.length;i.viewOffset.enabled=!0,O.update(o.values.tColor,a.getColorTarget(r.postprocessing).texture),o.update();for(let v=0;v<d.length;++v){const x=d[v];Si.setViewOffset(i.viewOffset,m,h,x[0],x[1],m,h),i.update(),O.update(o.values.uWeight,g+.03125*((v+.5)/d.length-.5)),0===v?a.postprocessing.setOcclusionOffset(0,0):a.postprocessing.setOcclusionOffset(x[0]/m,x[1]/h),a.render(t,r,!1),s.bind(),u.enable(c.BLEND),u.blendEquationSeparate(c.FUNC_ADD,c.FUNC_ADD),u.blendFuncSeparate(c.ONE,c.ONE,c.ONE,c.ONE),u.disable(c.DEPTH_TEST),u.depthMask(!1),u.viewport(f,p,m,h),u.scissor(f,p,m,h),0===v&&(u.clearColor(0,0,0,0),c.clear(c.COLOR_BUFFER_BIT)),o.render()}a.postprocessing.setOcclusionOffset(0,0),O.update(o.values.uWeight,1),O.update(o.values.tColor,s.texture),o.update(),this.bindOutputTarget(n),u.viewport(f,p,m,h),u.scissor(f,p,m,h),u.disable(c.BLEND),o.render(),i.viewOffset.enabled=!1,i.update(),It&&l.timer.markEnd("MultiSamplePass.renderMultiSample")}renderTemporalMultiSample(t,n,r,i){const{camera:o}=n,{compose:s,composeTarget:a,holdTarget:l,drawPass:c,webgl:u}=this,{gl:d,state:f}=u;It&&u.timer.mark("MultiSamplePass.renderTemporalMultiSample");const p=Pq[Math.max(0,Math.min(r.multiSample.sampleLevel,5))];if(-2===t||t>=p.length)return-2;const{x:m,y:h,width:g,height:y}=o.viewport,v=1/p.length;if(-1===t)c.render(n,r,!1),O.update(s.values.uWeight,1),O.update(s.values.tColor,c.getColorTarget(r.postprocessing).texture),s.update(),l.bind(),f.disable(d.BLEND),f.disable(d.DEPTH_TEST),f.depthMask(!1),f.viewport(m,h,g,y),f.scissor(m,h,g,y),s.render(),t+=1;else{o.viewOffset.enabled=!0,O.update(s.values.tColor,c.getColorTarget(r.postprocessing).texture),O.update(s.values.uWeight,v),s.update();const _=Math.pow(2,Math.max(0,r.multiSample.sampleLevel-2));for(let w=0;w<_;++w){const A=p[t];if(Si.setViewOffset(o.viewOffset,g,y,A[0],A[1],g,y),o.update(),0===t?c.postprocessing.setOcclusionOffset(0,0):c.postprocessing.setOcclusionOffset(A[0]/g,A[1]/y),c.render(n,r,!1),a.bind(),f.enable(d.BLEND),f.blendEquationSeparate(d.FUNC_ADD,d.FUNC_ADD),f.blendFuncSeparate(d.ONE,d.ONE,d.ONE,d.ONE),f.disable(d.DEPTH_TEST),f.depthMask(!1),f.viewport(m,h,g,y),f.scissor(m,h,g,y),0===t&&(f.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT)),s.render(),(t+=1)>=p.length)break}}c.postprocessing.setOcclusionOffset(0,0),this.bindOutputTarget(i),f.viewport(m,h,g,y),f.scissor(m,h,g,y);const x=t*v;return x>0&&(O.update(s.values.uWeight,1),O.update(s.values.tColor,a.texture),s.update(),f.disable(d.BLEND),s.render()),x<1&&(O.update(s.values.uWeight,1-x),O.update(s.values.tColor,l.texture),s.update(),0===x?f.disable(d.BLEND):f.enable(d.BLEND),s.render()),o.viewOffset.enabled=!1,o.update(),It&&u.timer.markEnd("MultiSamplePass.renderTemporalMultiSample"),t>=p.length?-2:t}}const Pq=[[[0,0]],[[0,0],[-4,-4]],[[0,0],[6,-2],[-6,2],[2,6]],[[0,0],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[0,0],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[0,0],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];Pq.forEach(e=>{e.forEach(t=>{t[0]*=.0625,t[1]*=.0625})});class b0e{update(t,n){return t&&(this.sampleIndex=-1),"temporal"===n.mode&&-2!==this.sampleIndex}render(t,n,r,i){return this.sampleIndex=this.multiSamplePass.render(this.sampleIndex,t,n,r,!!i),this.sampleIndex<0}constructor(t){this.multiSamplePass=t,this.sampleIndex=-2}}const v0e={eyeSeparation:I.Numeric(.062,{min:.02,max:.1,step:.001},{description:"Distance between left and right camera."}),focus:I.Numeric(10,{min:1,max:20,step:.1},{description:"Apparent object distance."})},wdt=I.getDefaultValues(v0e);class CA{get viewport(){return this.parent.viewport}get viewOffset(){return this.parent.viewOffset}constructor(t,n={}){this.parent=t,this.left=new x0e,this.right=new x0e,this.props={...wdt,...n}}setProps(t){Object.assign(this.props,t)}update(){this.parent.update(),function Adt(e,t,n,r){Da.copy(n.viewport,e.viewport),fe.copy(n.view,e.view),fe.copy(n.projection,e.projection),Si.copySnapshot(n.state,e.state),Si.copyViewOffset(n.viewOffset,e.viewOffset),n.far=e.far,n.near=e.near,n.fogFar=e.fogFar,n.fogNear=e.fogNear,Da.copy(r.viewport,e.viewport),fe.copy(r.view,e.view),fe.copy(r.projection,e.projection),Si.copySnapshot(r.state,e.state),Si.copyViewOffset(r.viewOffset,e.viewOffset),r.far=e.far,r.near=e.near,r.fogFar=e.fogFar,r.fogNear=e.fogNear;const i=Math.floor(e.viewport.width/2),o=i/e.viewport.height;n.viewport.width=i,r.viewport.x+=i,r.viewport.width-=i;const s=t.eyeSeparation/2,a=s*e.near/t.focus,l=e.near*Math.tan(.5*e.state.fov);let c,u;_0e[12]=-s,S0e[12]=s,c=-l*o+a,u=l*o+a,n.projection[0]=2*e.near/(u-c),n.projection[8]=(u+c)/(u-c),fe.mul(n.view,n.view,_0e),fe.mul(n.projectionView,n.projection,n.view),fe.invert(n.inverseProjectionView,n.projectionView),c=-l*o-a,u=l*o-a,r.projection[0]=2*e.near/(u-c),r.projection[8]=(u+c)/(u-c),fe.mul(r.view,r.view,S0e),fe.mul(r.projectionView,r.projection,r.view),fe.invert(r.inverseProjectionView,r.projectionView)}(this.parent,this.props,this.left,this.right)}}!function(e){e.is=function t(n){return"left"in n&&"right"in n}}(CA||(CA={}));class x0e{constructor(){this.viewport=Da.create(0,0,0,0),this.view=fe(),this.projection=fe(),this.projectionView=fe(),this.inverseProjectionView=fe(),this.state=Si.createDefaultSnapshot(),this.viewOffset=Si.ViewOffset(),this.far=0,this.near=0,this.fogFar=0,this.fogNear=0}}const _0e=fe.identity(),S0e=fe.identity(),kq=Math.pow(2,24)-2;class Idt{constructor(t,n,r){this.webgl=t,this.drawPass=n,this.pickScale=r;const i=r/t.pixelRatio;this.pickWidth=Math.ceil(n.colorTarget.getWidth()*i),this.pickHeight=Math.ceil(n.colorTarget.getHeight()*i);const{resources:o,extensions:{drawBuffers:s},gl:a}=t;s?(this.objectPickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture=o.texture("image-uint8","rgba","ubyte","nearest"),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.framebuffer=o.framebuffer(),this.objectPickFramebuffer=o.framebuffer(),this.instancePickFramebuffer=o.framebuffer(),this.groupPickFramebuffer=o.framebuffer(),this.depthPickFramebuffer=o.framebuffer(),this.framebuffer.bind(),s.drawBuffers([s.COLOR_ATTACHMENT0,s.COLOR_ATTACHMENT1,s.COLOR_ATTACHMENT2,s.COLOR_ATTACHMENT3]),this.objectPickTexture.attachFramebuffer(this.framebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.framebuffer,"color1"),this.groupPickTexture.attachFramebuffer(this.framebuffer,"color2"),this.depthPickTexture.attachFramebuffer(this.framebuffer,"color3"),this.depthRenderbuffer=Cn(a)?o.renderbuffer("depth32f","depth",this.pickWidth,this.pickHeight):o.renderbuffer("depth16","depth",this.pickWidth,this.pickHeight),this.depthRenderbuffer.attachFramebuffer(this.framebuffer),this.objectPickTexture.attachFramebuffer(this.objectPickFramebuffer,"color0"),this.instancePickTexture.attachFramebuffer(this.instancePickFramebuffer,"color0"),this.groupPickTexture.attachFramebuffer(this.groupPickFramebuffer,"color0"),this.depthPickTexture.attachFramebuffer(this.depthPickFramebuffer,"color0")):(this.objectPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.instancePickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.groupPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight),this.depthPickTarget=t.createRenderTarget(this.pickWidth,this.pickHeight))}get pickRatio(){return this.pickScale/this.webgl.pixelRatio}setPickScale(t){this.pickScale=t,this.syncSize()}bindObject(){this.webgl.extensions.drawBuffers?this.objectPickFramebuffer.bind():this.objectPickTarget.bind()}bindInstance(){this.webgl.extensions.drawBuffers?this.instancePickFramebuffer.bind():this.instancePickTarget.bind()}bindGroup(){this.webgl.extensions.drawBuffers?this.groupPickFramebuffer.bind():this.groupPickTarget.bind()}bindDepth(){this.webgl.extensions.drawBuffers?this.depthPickFramebuffer.bind():this.depthPickTarget.bind()}get drawingBufferHeight(){return this.drawPass.colorTarget.getHeight()}syncSize(){const t=this.pickScale/this.webgl.pixelRatio,n=Math.ceil(this.drawPass.colorTarget.getWidth()*t),r=Math.ceil(this.drawPass.colorTarget.getHeight()*t);(n!==this.pickWidth||r!==this.pickHeight)&&(this.pickWidth=n,this.pickHeight=r,this.webgl.extensions.drawBuffers?(this.objectPickTexture.define(this.pickWidth,this.pickHeight),this.instancePickTexture.define(this.pickWidth,this.pickHeight),this.groupPickTexture.define(this.pickWidth,this.pickHeight),this.depthPickTexture.define(this.pickWidth,this.pickHeight),this.depthRenderbuffer.setSize(this.pickWidth,this.pickHeight)):(this.objectPickTarget.setSize(this.pickWidth,this.pickHeight),this.instancePickTarget.setSize(this.pickWidth,this.pickHeight),this.groupPickTarget.setSize(this.pickWidth,this.pickHeight),this.depthPickTarget.setSize(this.pickWidth,this.pickHeight)))}renderVariant(t,n,r,i,o,s){t.clear(!1),t.update(n,r),t.renderPick(r.primitives,n,o,null,s),i.handle.isEnabled&&t.renderPick(i.handle.scene,n,o,null,s),i.camera.isEnabled&&(i.camera.update(n),t.update(i.camera.camera,i.camera.scene),t.renderPick(i.camera.scene,i.camera.camera,o,null,s))}render(t,n,r,i){this.webgl.extensions.drawBuffers?(this.framebuffer.bind(),this.renderVariant(t,n,r,i,"pick",$_.None)):(this.objectPickTarget.bind(),this.renderVariant(t,n,r,i,"pick",$_.Object),this.instancePickTarget.bind(),this.renderVariant(t,n,r,i,"pick",$_.Instance),this.groupPickTarget.bind(),this.renderVariant(t,n,r,i,"pick",$_.Group),this.depthPickTarget.bind(),this.renderVariant(t,n,r,i,"depth",$_.None))}}class Edt{setupBuffers(){const t=this.pickWidth*this.pickHeight*4;(!this.objectBuffer||this.objectBuffer.length!==t)&&(this.objectBuffer=new Uint8Array(t),this.instanceBuffer=new Uint8Array(t),this.groupBuffer=new Uint8Array(t),this.depthBuffer=new Uint8Array(t))}setViewport(t,n,r,i){Da.set(this.viewport,t,n,r,i),this.pickRatio=this.pickPass.pickRatio,this.pickX=Math.ceil(t*this.pickRatio),this.pickY=Math.ceil(n*this.pickRatio);const o=Math.floor(r*this.pickRatio),s=Math.floor(i*this.pickRatio);(o!==this.pickWidth||s!==this.pickHeight)&&(this.pickWidth=o,this.pickHeight=s,this.halfPickWidth=Math.floor(this.pickWidth/2),this.setupBuffers()),this.spiral=function CFe(e){let t=0,n=0;const r=[0,-1],i=2*e+1,o=i/2,s=[];for(let a=Math.pow(i,2);a>0;--a)-o<t&&t<=o&&-o<n&&n<=o&&s.push([t,n]),(t===n||t<0&&t===-n||t>0&&t===1-n)&&([r[0],r[1]]=[-r[1],r[0]]),t+=r[0],n+=r[1];return s}(Math.round(this.pickRatio*this.pickPadding))}syncBuffers(){It&&this.webgl.timer.mark("PickHelper.syncBuffers");const{pickX:t,pickY:n,pickWidth:r,pickHeight:i}=this;this.pickPass.bindObject(),this.webgl.readPixels(t,n,r,i,this.objectBuffer),this.pickPass.bindInstance(),this.webgl.readPixels(t,n,r,i,this.instanceBuffer),this.pickPass.bindGroup(),this.webgl.readPixels(t,n,r,i,this.groupBuffer),this.pickPass.bindDepth(),this.webgl.readPixels(t,n,r,i,this.depthBuffer),It&&this.webgl.timer.markEnd("PickHelper.syncBuffers")}getBufferIdx(t,n){return 4*(n*this.pickWidth+t)}getDepth(t,n){const r=this.getBufferIdx(t,n),i=this.depthBuffer;return function HKe(e,t,n,r){return Bn.set(nfe,e/255,t/255,n/255,r/255),Bn.dot(nfe,VKe)}(i[r],i[r+1],i[r+2],i[r+3])}getId(t,n,r){const i=this.getBufferIdx(t,n);return H9(r[i],r[i+1],r[i+2])}render(t){It&&this.webgl.timer.mark("PickHelper.render",!0);const{pickX:n,pickY:r,pickWidth:i,pickHeight:o,halfPickWidth:s}=this,{renderer:a,scene:l,helper:c}=this;a.setTransparentBackground(!1),a.setDrawingBufferSize(i,o),a.setPixelRatio(this.pickRatio),CA.is(t)?(a.setViewport(n,r,s,o),this.pickPass.render(a,t.left,l,c),a.setViewport(n+s,r,i-s,o),this.pickPass.render(a,t.right,l,c)):(a.setViewport(n,r,i,o),this.pickPass.render(a,t,l,c)),this.dirty=!1,It&&this.webgl.timer.markEnd("PickHelper.render")}identifyInternal(t,n,r){const{webgl:i,pickRatio:o}=this;if(i.isContextLost)return;t*=i.pixelRatio,n=this.pickPass.drawingBufferHeight-(n*=i.pixelRatio);const{viewport:s}=this;if(t<s.x||n<s.y||t>s.x+s.width||n>s.y+s.height)return;this.dirty&&(It&&this.webgl.timer.mark("PickHelper.identify"),this.render(r),this.syncBuffers(),It&&this.webgl.timer.markEnd("PickHelper.identify"));const a=t-s.x,l=n-s.y,c=Math.floor(a*o),u=Math.floor(l*o),d=this.getId(c,u,this.objectBuffer);if(-1===d||d===kq)return;const f=this.getId(c,u,this.instanceBuffer);if(-1===f||f===kq)return;const p=this.getId(c,u,this.groupBuffer);if(-1===p||p===kq)return;const m=this.getDepth(c,u),h=C.create(t,n,m);if(CA.is(r)){const g=Math.floor(s.width/2);t>s.x+g?(h[0]=s.x+2*(a-g),CF(h,h,s,r.right.inverseProjectionView)):(h[0]=s.x+2*a,CF(h,h,s,r.left.inverseProjectionView))}else CF(h,h,s,r.inverseProjectionView);return{id:{objectId:d,instanceId:f,groupId:p},position:h}}identify(t,n,r){for(const i of this.spiral){const o=this.identifyInternal(t+i[0],n+i[1],r);if(o)return o}}constructor(t,n,r,i,o,s,a=1){this.webgl=t,this.renderer=n,this.scene=r,this.helper=i,this.pickPass=o,this.pickPadding=a,this.dirty=!0,this.viewport=Da(),this.setViewport(s.x,s.y,s.width,s.height)}}const Ddt={...ca,tWboitA:xn("texture","rgba","float","nearest"),tWboitB:xn("texture","rgba","float","nearest"),uTexSize:Ne("v2")},Pdt=Wi("evaluate-wboit",hl,"\nprecision highp float;\n\nuniform sampler2D tWboitA;\nuniform sampler2D tWboitB;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n\n    vec4 accum = texture2D(tWboitA, coords);\n    float r = 1.0 - accum.a;\n\n    accum.a = texture2D(tWboitB, coords).r;\n    // divisor needs to allow very small values for nice fading\n    gl_FragColor = vec4(accum.rgb / clamp(accum.a, 0.00000001, 50000.0), r);\n}\n");class Mq{get supported(){return this._supported}bind(){const{state:t,gl:n}=this.webgl;this.framebuffer.bind(),t.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT),t.disable(n.DEPTH_TEST),t.blendFuncSeparate(n.ONE,n.ONE,n.ZERO,n.ONE_MINUS_SRC_ALPHA),t.enable(n.BLEND)}render(){It&&this.webgl.timer.mark("WboitPass.render");const{state:t,gl:n}=this.webgl;t.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),t.enable(n.BLEND),this.renderable.update(),this.renderable.render(),It&&this.webgl.timer.markEnd("WboitPass.render")}setSize(t,n){const[r,i]=this.renderable.values.uTexSize.ref.value;(t!==r||n!==i)&&(this.textureA.define(t,n),this.textureB.define(t,n),this.depthRenderbuffer.setSize(t,n),O.update(this.renderable.values.uTexSize,Ue.set(this.renderable.values.uTexSize.ref.value,t,n)))}reset(){this._supported&&this._init()}_init(){const{extensions:{drawBuffers:t}}=this.webgl;this.framebuffer.bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.textureA.attachFramebuffer(this.framebuffer,"color0"),this.textureB.attachFramebuffer(this.framebuffer,"color1"),this.depthRenderbuffer.attachFramebuffer(this.framebuffer)}static isSupported(t){const{extensions:{drawBuffers:n,textureFloat:r,colorBufferFloat:i,depthTexture:o}}=t;if(r&&i&&o&&n)return!0;if($n){const s=[];r||s.push("textureFloat"),i||s.push("colorBufferFloat"),o||s.push("depthTexture"),n||s.push("drawBuffers"),console.log(`Missing "${s.join('", "')}" extensions required for "wboit"`)}return!1}constructor(t,n,r){if(this.webgl=t,this._supported=!1,!Mq.isSupported(t))return;const{resources:i,gl:o}=t;this.textureA=i.texture("image-float32","rgba","float","nearest"),this.textureA.define(n,r),this.textureB=i.texture("image-float32","rgba","float","nearest"),this.textureB.define(n,r),this.depthRenderbuffer=Cn(o)?i.renderbuffer("depth32f","depth",n,r):i.renderbuffer("depth16","depth",n,r),this.renderable=function kdt(e,t,n){const r={...ua,tWboitA:O.create(t),tWboitB:O.create(n),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight()))},i={...Ddt};return ys(ms(e,"triangles",Pdt,i,r),r)}(t,this.textureA,this.textureB),this.framebuffer=i.framebuffer(),this._supported=!0,this._init()}}const Ndt={...ca,tDpoitBackColor:xn("texture","rgba","float","nearest"),uTexSize:Ne("v2")},Fdt=Wi("blend-back-dpoit",hl,"\n    precision highp float;\n\n    uniform sampler2D tDpoitBackColor;\n    uniform vec2 uTexSize;\n\n    void main() {\n        vec2 coords = gl_FragCoord.xy / uTexSize;\n        gl_FragColor = texture2D(tDpoitBackColor, coords);\n        if (gl_FragColor.a == 0.0) {\n            discard;\n        }\n    }\n"),Bdt={...ca,tDpoitFrontColor:xn("texture","rgba","float","nearest"),uTexSize:Ne("v2")},Ldt=Wi("evaluate-dpoit",hl,"\nprecision highp float;\n\nuniform sampler2D tDpoitFrontColor;\nuniform vec2 uTexSize;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy / uTexSize;\n    gl_FragColor = texture2D(tDpoitFrontColor, coords);\n}\n");class Rq{get supported(){return this._supported}bind(){const{state:t,gl:n,extensions:{blendMinMax:r}}=this.webgl;return this.passCount=0,this.depthFramebuffers[0].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[1].bind(),t.clearColor(-this.MIN_DEPTH,this.MAX_DEPTH,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[0].bind(),t.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[1].bind(),t.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[0].bind(),t.blendEquation(r.MAX),t.depthMask(!1),{depth:this.depthTextures[1],frontColor:this.colorFrontTextures[1],backColor:this.colorBackTextures[1]}}bindDualDepthPeeling(){const{state:t,gl:n,extensions:{blendMinMax:r}}=this.webgl;return this.readId=this.passCount%2,this.writeId=1-this.readId,this.passCount+=1,this.depthFramebuffers[this.writeId].bind(),t.clearColor(this.DEPTH_CLEAR_VALUE,this.DEPTH_CLEAR_VALUE,0,0),n.clear(n.COLOR_BUFFER_BIT),this.colorFramebuffers[this.writeId].bind(),t.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),this.depthFramebuffers[this.writeId].bind(),t.blendEquation(r.MAX),t.depthMask(!1),{depth:this.depthTextures[this.readId],frontColor:this.colorFrontTextures[this.readId],backColor:this.colorBackTextures[this.readId]}}renderBlendBack(){It&&this.webgl.timer.mark("DpoitPass.renderBlendBack");const{state:t,gl:n}=this.webgl;t.blendEquation(n.FUNC_ADD),t.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA),O.update(this.blendBackRenderable.values.tDpoitBackColor,this.colorBackTextures[this.writeId]),this.blendBackRenderable.update(),this.blendBackRenderable.render(),It&&this.webgl.timer.markEnd("DpoitPass.renderBlendBack")}render(){It&&this.webgl.timer.mark("DpoitPass.render");const{state:t,gl:n}=this.webgl;t.blendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA),O.update(this.renderable.values.tDpoitFrontColor,this.colorFrontTextures[this.writeId]),this.renderable.update(),this.renderable.render(),It&&this.webgl.timer.markEnd("DpoitPass.render")}setSize(t,n){const[r,i]=this.renderable.values.uTexSize.ref.value;if(t!==r||n!==i){for(let o=0;o<2;o++)this.depthTextures[o].define(t,n),this.colorFrontTextures[o].define(t,n),this.colorBackTextures[o].define(t,n);O.update(this.renderable.values.uTexSize,Ue.set(this.renderable.values.uTexSize.ref.value,t,n)),O.update(this.blendBackRenderable.values.uTexSize,Ue.set(this.blendBackRenderable.values.uTexSize.ref.value,t,n))}}reset(){this._supported&&this._init()}_init(){const{extensions:{drawBuffers:t}}=this.webgl;for(let n=0;n<2;n++)this.depthFramebuffers[n].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1,t.COLOR_ATTACHMENT2]),this.colorFrontTextures[n].attachFramebuffer(this.depthFramebuffers[n],"color0"),this.colorBackTextures[n].attachFramebuffer(this.depthFramebuffers[n],"color1"),this.depthTextures[n].attachFramebuffer(this.depthFramebuffers[n],"color2"),this.colorFramebuffers[n].bind(),t.drawBuffers([t.COLOR_ATTACHMENT0,t.COLOR_ATTACHMENT1]),this.colorFrontTextures[n].attachFramebuffer(this.colorFramebuffers[n],"color0"),this.colorBackTextures[n].attachFramebuffer(this.colorFramebuffers[n],"color1")}static isSupported(t){const{extensions:{drawBuffers:n,textureFloat:r,colorBufferFloat:i,blendMinMax:o}}=t;if(r&&i&&n&&o)return!0;if($n){const s=[];r||s.push("textureFloat"),i||s.push("colorBufferFloat"),n||s.push("drawBuffers"),o||s.push("blendMinMax"),console.log(`Missing "${s.join('", "')}" extensions required for "dpoit"`)}return!1}constructor(t,n,r){if(this.webgl=t,this.DEPTH_CLEAR_VALUE=-99999,this.MAX_DEPTH=1,this.MIN_DEPTH=0,this.passCount=0,this._supported=!1,!Rq.isSupported(t))return;const{resources:i,extensions:{colorBufferHalfFloat:o,textureHalfFloat:s}}=t;Cn(t.gl)?(this.depthTextures=[i.texture("image-float32","rg","float","nearest"),i.texture("image-float32","rg","float","nearest")],this.colorFrontTextures=o&&s?[i.texture("image-float16","rgba","fp16","nearest"),i.texture("image-float16","rgba","fp16","nearest")]:[i.texture("image-float32","rgba","float","nearest"),i.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=o&&s?[i.texture("image-float16","rgba","fp16","nearest"),i.texture("image-float16","rgba","fp16","nearest")]:[i.texture("image-float32","rgba","float","nearest"),i.texture("image-float32","rgba","float","nearest")]):(this.depthTextures=[i.texture("image-float32","rgba","float","nearest"),i.texture("image-float32","rgba","float","nearest")],this.colorFrontTextures=[i.texture("image-float32","rgba","float","nearest"),i.texture("image-float32","rgba","float","nearest")],this.colorBackTextures=[i.texture("image-float32","rgba","float","nearest"),i.texture("image-float32","rgba","float","nearest")]),this.depthTextures[0].define(n,r),this.depthTextures[1].define(n,r),this.colorFrontTextures[0].define(n,r),this.colorFrontTextures[1].define(n,r),this.colorBackTextures[0].define(n,r),this.colorBackTextures[1].define(n,r),this.depthFramebuffers=[i.framebuffer(),i.framebuffer()],this.colorFramebuffers=[i.framebuffer(),i.framebuffer()],this.blendBackRenderable=function Odt(e,t){const n={...ua,tDpoitBackColor:O.create(t),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight()))},r={...Ndt};return ys(ms(e,"triangles",Fdt,r,n),n)}(t,this.colorBackTextures[0]),this.renderable=function jdt(e,t){const n={...ua,tDpoitFrontColor:O.create(t),uTexSize:O.create(Ue.create(t.getWidth(),t.getHeight()))},r={...Bdt};return ys(ms(e,"triangles",Ldt,r,n),n)}(t,this.colorFrontTextures[0]),this._supported=!0,this._init()}}const C0e={enabled:I.Boolean(!0),highlightEdgeColor:I.Color(st.darken(st.fromNormalizedRgb(1,.4,.6),1)),selectEdgeColor:I.Color(st.darken(st.fromNormalizedRgb(.2,1,.1),1)),edgeScale:I.Numeric(1,{min:1,max:3,step:1},{description:"Thickness of the edge."}),highlightEdgeStrength:I.Numeric(1,{min:0,max:1,step:.1}),selectEdgeStrength:I.Numeric(1,{min:0,max:1,step:.1}),ghostEdgeStrength:I.Numeric(.3,{min:0,max:1,step:.1},{description:"Opacity of the hidden edges that are covered by other geometry. When set to 1, one less geometry render pass is done."}),innerEdgeFactor:I.Numeric(1.5,{min:0,max:3,step:.1},{description:"Factor to multiply the inner edge color with - for added contrast."})};class w0e{static isEnabled(t){return t.enabled}constructor(t,n,r){this.webgl=t,this.depthTarget=t.createRenderTarget(n,r),this.maskTarget=t.createRenderTarget(n,r),this.edgesTarget=t.createRenderTarget(n,r),this.edge=function Gdt(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ua,tMaskTexture:O.create(t),uTexSizeInv:O.create(Ue.create(1/n,1/r)),dEdgeScale:O.create(1)},o={...Vdt};return ys(ms(e,"triangles",Hdt,o,i),i)}(t,this.maskTarget.texture),this.overlay=function $dt(e,t){const n=t.getWidth(),r=t.getHeight(),i={...ua,tEdgeTexture:O.create(t),uTexSizeInv:O.create(Ue.create(1/n,1/r)),uHighlightEdgeColor:O.create(C()),uSelectEdgeColor:O.create(C()),uHighlightEdgeStrength:O.create(1),uSelectEdgeStrength:O.create(1),uGhostEdgeStrength:O.create(0),uInnerEdgeFactor:O.create(0)},o={...qdt};return ys(ms(e,"triangles",Wdt,o,i),i)}(t,this.edgesTarget.texture)}setEdgeState(t){const{gl:n,state:r}=this.webgl;r.enable(n.SCISSOR_TEST),r.enable(n.BLEND),r.blendFunc(n.ONE,n.ONE),r.blendEquation(n.FUNC_ADD),r.disable(n.DEPTH_TEST),r.depthMask(!1);const{x:i,y:o,width:s,height:a}=t;r.viewport(i,o,s,a),r.scissor(i,o,s,a),r.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT)}setOverlayState(t){const{gl:n,state:r}=this.webgl;r.enable(n.SCISSOR_TEST),r.enable(n.BLEND),r.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),r.blendEquation(n.FUNC_ADD),r.disable(n.DEPTH_TEST),r.depthMask(!1);const{x:i,y:o,width:s,height:a}=t;r.viewport(i,o,s,a),r.scissor(i,o,s,a)}setSize(t,n){const r=this.depthTarget.getWidth(),i=this.depthTarget.getHeight();(t!==r||n!==i)&&(this.depthTarget.setSize(t,n),this.maskTarget.setSize(t,n),this.edgesTarget.setSize(t,n),O.update(this.edge.values.uTexSizeInv,Ue.set(this.edge.values.uTexSizeInv.ref.value,1/t,1/n)),O.update(this.overlay.values.uTexSizeInv,Ue.set(this.overlay.values.uTexSizeInv.ref.value,1/t,1/n)))}update(t){const{highlightEdgeColor:n,selectEdgeColor:r,edgeScale:i,innerEdgeFactor:o,ghostEdgeStrength:s,highlightEdgeStrength:a,selectEdgeStrength:l}=t,{values:c}=this.edge,u=Math.max(1,Math.round(i*this.webgl.pixelRatio));c.dEdgeScale.ref.value!==u&&(O.update(c.dEdgeScale,u),this.edge.update());const{values:d}=this.overlay;O.update(d.uHighlightEdgeColor,st.toVec3Normalized(d.uHighlightEdgeColor.ref.value,n)),O.update(d.uSelectEdgeColor,st.toVec3Normalized(d.uSelectEdgeColor.ref.value,r)),O.updateIfChanged(d.uInnerEdgeFactor,o),O.updateIfChanged(d.uGhostEdgeStrength,s),O.updateIfChanged(d.uHighlightEdgeStrength,a),O.updateIfChanged(d.uSelectEdgeStrength,l)}render(t,n){It&&this.webgl.timer.mark("MarkingPass.render"),this.edgesTarget.bind(),this.setEdgeState(t),this.edge.render(),n?n.bind():this.webgl.unbindFramebuffer(),this.setOverlayState(t),this.overlay.render(),It&&this.webgl.timer.markEnd("MarkingPass.render")}}const Vdt={...ca,tMaskTexture:xn("texture","rgba","ubyte","linear"),uTexSizeInv:Ne("v2"),dEdgeScale:cn("number")},Hdt=Wi("edge",hl,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tMaskTexture;\nuniform vec2 uTexSizeInv;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 offset = vec4(float(dEdgeScale), 0.0, 0.0, float(dEdgeScale)) * vec4(uTexSizeInv, uTexSizeInv);\n    vec4 c0 = texture2D(tMaskTexture, coords);\n    vec4 c1 = texture2D(tMaskTexture, coords + offset.xy);\n    vec4 c2 = texture2D(tMaskTexture, coords - offset.xy);\n    vec4 c3 = texture2D(tMaskTexture, coords + offset.yw);\n    vec4 c4 = texture2D(tMaskTexture, coords - offset.yw);\n    float diff1 = (c1.r - c2.r) * 0.5;\n    float diff2 = (c3.r - c4.r) * 0.5;\n    float d = length(vec2(diff1, diff2));\n    if (d <= 0.0)\n        discard;\n    float a1 = min(c1.g, c2.g);\n    float a2 = min(c3.g, c4.g);\n    float visibility = min(a1, a2) > 0.001 ? 1.0 : 0.0;\n    float mask = c0.r;\n    float marker = min(c1.b, min(c2.b, min(c3.b, c4.b)));\n    float fogAlpha = min(c1.a, min(c2.a, min(c3.a, c4.a)));\n    gl_FragColor = vec4(visibility, mask, marker, fogAlpha);\n}\n"),qdt={...ca,tEdgeTexture:xn("texture","rgba","ubyte","linear"),uTexSizeInv:Ne("v2"),uHighlightEdgeColor:Ne("v3"),uSelectEdgeColor:Ne("v3"),uHighlightEdgeStrength:Ne("f"),uSelectEdgeStrength:Ne("f"),uGhostEdgeStrength:Ne("f"),uInnerEdgeFactor:Ne("f")},Wdt=Wi("overlay",hl,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform vec2 uTexSizeInv;\nuniform sampler2D tEdgeTexture;\nuniform vec3 uHighlightEdgeColor;\nuniform vec3 uSelectEdgeColor;\nuniform float uHighlightEdgeStrength;\nuniform float uSelectEdgeStrength;\nuniform float uGhostEdgeStrength;\nuniform float uInnerEdgeFactor;\n\nvoid main() {\n    vec2 coords = gl_FragCoord.xy * uTexSizeInv;\n    vec4 edgeValue = texture2D(tEdgeTexture, coords);\n    if (edgeValue.a > 0.0) {\n        vec3 edgeColor = edgeValue.b == 1.0 ? uHighlightEdgeColor : uSelectEdgeColor;\n        gl_FragColor.rgb = edgeValue.g > 0.0 ? edgeColor : edgeColor * uInnerEdgeFactor;\n        gl_FragColor.a = (edgeValue.r == 1.0 ? uGhostEdgeStrength : 1.0) * edgeValue.a;\n        float edgeStrength = edgeValue.b == 1.0 ? uHighlightEdgeStrength : uSelectEdgeStrength;\n        gl_FragColor.a *= edgeStrength;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}\n");class A0e{setTransparency(t){this.transparencyMode="wboit"===t?this.wboit.supported?"wboit":"blended":"dpoit"===t&&this.dpoit.supported?"dpoit":"blended",this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth")}get transparency(){return this.transparencyMode}constructor(t,n,r,i,o){this.webgl=t,this.transparencyMode="blended";const{extensions:s,resources:a,isWebGL2:l}=t;this.drawTarget=function UYe(e){return{id:rde(),texture:lc(e),framebuffer:{id:Vue(),bind:()=>{},reset:()=>{},destroy:()=>{}},depthRenderbuffer:null,getWidth:()=>0,getHeight:()=>0,bind:()=>{e.bindFramebuffer(e.FRAMEBUFFER,null)},setSize:()=>{},reset:()=>{},destroy:()=>{}}}(t.gl),this.colorTarget=t.createRenderTarget(r,i,!0,"uint8","linear"),this.packedDepth=!s.depthTexture,this.depthTargetTransparent=t.createRenderTarget(r,i),this.depthTextureTransparent=this.depthTargetTransparent.texture,this.depthTargetOpaque=this.packedDepth?t.createRenderTarget(r,i):null,this.depthTextureOpaque=this.depthTargetOpaque?this.depthTargetOpaque.texture:a.texture("image-depth","depth",l?"float":"ushort","nearest"),this.packedDepth||this.depthTextureOpaque.define(r,i),this.wboit=new Mq(t,r,i),this.dpoit=new Rq(t,r,i),this.marking=new w0e(t,r,i),this.postprocessing=new Zu(t,n,this),this.antialiasing=new Dq(t,this),this.copyFboTarget=Zw(t,this.colorTarget.texture),this.copyFboPostprocessing=Zw(t,this.postprocessing.target.texture),this.setTransparency(o)}reset(){this.wboit.reset(),this.dpoit.reset()}setSize(t,n){const r=this.colorTarget.getWidth(),i=this.colorTarget.getHeight();(t!==r||n!==i)&&(this.colorTarget.setSize(t,n),this.depthTargetTransparent.setSize(t,n),this.depthTargetOpaque?this.depthTargetOpaque.setSize(t,n):this.depthTextureOpaque.define(t,n),O.update(this.copyFboTarget.values.uTexSize,Ue.set(this.copyFboTarget.values.uTexSize.ref.value,t,n)),O.update(this.copyFboPostprocessing.values.uTexSize,Ue.set(this.copyFboPostprocessing.values.uTexSize.ref.value,t,n))),this.wboit.supported&&this.wboit.setSize(t,n),this.dpoit.supported&&this.dpoit.setSize(t,n),this.marking.setSize(t,n),this.postprocessing.setSize(t,n),this.antialiasing.setSize(t,n)}_renderDpoit(t,n,r,i,o,s){if(!this.dpoit.supported)throw new Error("expected dpoit to be supported");if(this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),r.hasOpaque&&t.renderDpoitOpaque(r.primitives,n,null),Zu.isEnabled(s)&&(Zu.isTransparentOutlineEnabled(s)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),r.opacityAverage<1&&t.renderDepthTransparent(r.primitives,n,this.depthTextureOpaque)),this.postprocessing.render(n,!1,o,t.props.backgroundColor,s,t.light)),this.depthTextureOpaque.detachFramebuffer(this.colorTarget.framebuffer,"depth"),r.opacityAverage<1){const a=Zu.isEnabled(s)?this.postprocessing.target:this.colorTarget,l=this.dpoit.bind();t.renderDpoitTransparent(r.primitives,n,this.depthTextureOpaque,l);for(let c=0;c<i;c++){It&&this.webgl.timer.mark("DpoitPass.layer");const u=this.dpoit.bindDualDepthPeeling();t.renderDpoitTransparent(r.primitives,n,this.depthTextureOpaque,u),a.bind(),this.dpoit.renderBlendBack(),It&&this.webgl.timer.markEnd("DpoitPass.layer")}a.bind(),this.dpoit.render()}r.volumes.renderables.length>0&&t.renderDpoitVolume(r.volumes,n,this.depthTextureOpaque)}_renderWboit(t,n,r,i,o){if(!this.wboit.supported)throw new Error("expected wboit to be supported");this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),r.hasOpaque&&t.renderWboitOpaque(r.primitives,n,null),Zu.isEnabled(o)&&(Zu.isTransparentOutlineEnabled(o)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),r.opacityAverage<1&&t.renderDepthTransparent(r.primitives,n,this.depthTextureOpaque)),this.postprocessing.render(n,!1,i,t.props.backgroundColor,o,t.light)),(r.opacityAverage<1||r.volumes.renderables.length>0)&&(this.wboit.bind(),r.opacityAverage<1&&t.renderWboitTransparent(r.primitives,n,this.depthTextureOpaque),r.volumes.renderables.length>0&&t.renderWboitTransparent(r.volumes,n,this.depthTextureOpaque),Zu.isEnabled(o)?this.postprocessing.target.bind():this.colorTarget.bind(),this.wboit.render())}_renderBlended(t,n,r,i,o,s){var a,l,c,u;if(i?this.drawTarget.bind():this.packedDepth?this.colorTarget.bind():this.depthTextureOpaque.attachFramebuffer(this.colorTarget.framebuffer,"depth"),t.clear(!0),r.hasOpaque&&t.renderBlendedOpaque(r.primitives,n,null),!i&&(this.depthTargetOpaque&&(this.depthTargetOpaque.bind(),t.clearDepth(!0),t.renderDepthOpaque(r.primitives,n,null),this.colorTarget.bind()),Zu.isEnabled(s)&&(this.packedDepth?null===(a=this.colorTarget.depthRenderbuffer)||void 0===a||a.detachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.detachFramebuffer(this.postprocessing.target.framebuffer,"depth"),Zu.isTransparentOutlineEnabled(s)&&(this.depthTargetTransparent.bind(),t.clearDepth(!0),r.opacityAverage<1&&t.renderDepthTransparent(r.primitives,n,this.depthTextureOpaque)),this.postprocessing.render(n,!1,o,t.props.backgroundColor,s,t.light),this.packedDepth?null===(l=this.colorTarget.depthRenderbuffer)||void 0===l||l.attachFramebuffer(this.postprocessing.target.framebuffer):this.depthTextureOpaque.attachFramebuffer(this.postprocessing.target.framebuffer,"depth")),r.volumes.renderables.length>0)){const d=Zu.isEnabled(s)?this.postprocessing.target:this.colorTarget;this.packedDepth?null===(c=this.colorTarget.depthRenderbuffer)||void 0===c||c.detachFramebuffer(d.framebuffer):this.depthTextureOpaque.detachFramebuffer(d.framebuffer,"depth"),d.bind(),t.renderBlendedVolume(r.volumes,n,this.depthTextureOpaque),this.packedDepth?null===(u=this.colorTarget.depthRenderbuffer)||void 0===u||u.attachFramebuffer(d.framebuffer):this.depthTextureOpaque.attachFramebuffer(d.framebuffer,"depth"),d.bind()}r.opacityAverage<1&&t.renderBlendedTransparent(r.primitives,n,null)}_render(t,n,r,i,o,s,a){const l=r.volumes.renderables.length>0,c=Zu.isEnabled(a.postprocessing),u=Dq.isEnabled(a.postprocessing),d=w0e.isEnabled(a.marking),{x:f,y:p,width:m,height:h}=n.viewport;t.setViewport(f,p,m,h),t.update(n,r),s&&!u&&o&&(this.drawTarget.bind(),t.clear(!1));let g=!1;"wboit"===this.transparencyMode&&this.wboit.supported?(this._renderWboit(t,n,r,s,a.postprocessing),g=!0):"dpoit"===this.transparencyMode&&this.dpoit.supported?(this._renderDpoit(t,n,r,a.dpoitIterations,s,a.postprocessing),g=!0):this._renderBlended(t,n,r,!l&&!c&&!u&&o,s,a.postprocessing);const y=c?this.postprocessing.target:!o||l||g?this.colorTarget:this.drawTarget;if(d&&r.markerAverage>0){const v=a.marking.ghostEdgeStrength<1;v&&1!==r.markerAverage&&(this.marking.depthTarget.bind(),t.clear(!1,!0),t.renderMarkingDepth(r.primitives,n,null)),this.marking.maskTarget.bind(),t.clear(!1,!0),t.renderMarkingMask(r.primitives,n,v?this.marking.depthTarget.texture:null),this.marking.update(a.marking),this.marking.render(n.viewport,y)}else y.bind();i.debug.isEnabled&&(i.debug.syncVisibility(),t.renderBlended(i.debug.scene,n)),i.handle.isEnabled&&t.renderBlended(i.handle.scene,n),i.camera.isEnabled&&(i.camera.update(n),t.update(i.camera.camera,i.camera.scene),t.renderBlended(i.camera.scene,i.camera.camera)),u?this.antialiasing.render(n,o,a.postprocessing):o&&(this.drawTarget.bind(),this.webgl.state.disable(this.webgl.gl.DEPTH_TEST),c?this.copyFboPostprocessing.render():(l||g)&&this.copyFboTarget.render()),this.webgl.gl.flush()}render(t,n,r){It&&this.webgl.timer.mark("DrawPass.render");const{renderer:i,camera:o,scene:s,helper:a}=t;this.postprocessing.setTransparentBackground(n.transparentBackground);const l=n.transparentBackground||this.postprocessing.background.isEnabled(n.postprocessing.background);i.setTransparentBackground(l),i.setDrawingBufferSize(this.colorTarget.getWidth(),this.colorTarget.getHeight()),i.setPixelRatio(this.webgl.pixelRatio),CA.is(o)?(It&&this.webgl.timer.mark("StereoCamera.left"),this._render(i,o.left,s,a,r,l,n),It&&this.webgl.timer.markEnd("StereoCamera.left"),It&&this.webgl.timer.mark("StereoCamera.right"),this._render(i,o.right,s,a,r,l,n),It&&this.webgl.timer.markEnd("StereoCamera.right")):this._render(i,o,s,a,r,l,n),It&&this.webgl.timer.markEnd("DrawPass.render")}getColorTarget(t){return Dq.isEnabled(t)?this.antialiasing.target:Zu.isEnabled(t)?this.postprocessing.target:this.colorTarget}}const Ydt={alpha:I.Numeric(.51,{min:0,max:1,step:.01},{isEssential:!0,label:"Opacity"}),colorX:I.Color(qn.red,{isEssential:!0}),colorY:I.Color(qn.green,{isEssential:!0}),colorZ:I.Color(qn.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0}),location:I.Select("bottom-left",I.arrayToOptions(["bottom-left","bottom-right","top-left","top-right"])),locationOffsetX:I.Numeric(0),locationOffsetY:I.Numeric(0),originColor:I.Color(qn.grey),radiusScale:I.Numeric(.075,{min:.01,max:.3,step:.001}),showPlanes:I.Boolean(!0),planeColorXY:I.Color(qn.grey,{label:"Plane Color XY"}),planeColorXZ:I.Color(qn.grey,{label:"Plane Color XZ"}),planeColorYZ:I.Color(qn.grey,{label:"Plane Color YZ"}),showLabels:I.Boolean(!1),labelX:I.Text("X"),labelY:I.Text("Y"),labelZ:I.Text("Z"),labelColorX:I.Color(qn.grey),labelColorY:I.Color(qn.grey),labelColorZ:I.Color(qn.grey),labelOpacity:I.Numeric(1,{min:0,max:1,step:.01}),labelScale:I.Numeric(.25,{min:.1,max:1,step:.01})},kF={axes:I.MappedStatic("on",{on:I.Group(Ydt),off:I.Group({})},{cycle:!0,description:"Show camera orientation axes"})};class I0e{constructor(t,n={}){this.webgl=t,this.props={axes:{name:"off",params:{}}},this.pixelRatio=1,this.eachGroup=(r,i)=>{if(!Nq(r))return!1;let o=!1;if(this.meshRenderObject){const s=this.meshRenderObject.values.uGroupCount.ref.value;for(const{groupId:a,instanceId:l}of r.elements)i(Pe.ofSingleton(l*s+a))&&(o=!0)}if(this.textRenderObject){const s=this.textRenderObject.values.uGroupCount.ref.value;for(const{groupId:a,instanceId:l}of r.elements)i(Pe.ofSingleton(l*s+a))&&(o=!0)}return o},this.scene=_A.create(t,"blended"),this.camera=new Si,C.set(this.camera.up,0,1,0),C.set(this.camera.target,0,0,0),this.setProps(n)}setProps(t){this.props=fy(this.props,n=>{if(void 0!==t.axes&&(n.axes.name=t.axes.name,"on"===t.axes.name)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;const r={...t.axes.params,scale:t.axes.params.scale*this.pixelRatio,labelScale:t.axes.params.labelScale*this.pixelRatio};this.meshRenderObject=function eft(e){const t=function Jdt(e,t){const n=100*e.scale,r=function Qdt(e,t){const n=Ct.createState(512,256,t),r=100*e.scale,i=e.radiusScale*r,o=e.showLabels?100*e.labelScale/3:0,s=C.scale(C(),C.unitX,r-o),a=C.scale(C(),C.unitY,r-o),l=C.scale(C(),C.unitZ,r-o),c={radiusTop:i,radiusBottom:i,radialSegments:32};if(n.currentGroup=Ei.Origin,Jr(n,C.origin,i,2),n.currentGroup=Ei.X,Jr(n,s,i,2),Ur(n,C.origin,s,1,c),n.currentGroup=Ei.Y,Jr(n,a,i,2),Ur(n,C.origin,a,1,c),n.currentGroup=Ei.Z,Jr(n,l,i,2),Ur(n,C.origin,l,1,c),e.showPlanes){C.scale(s,s,.5),C.scale(a,a,.5),C.scale(l,l,.5),n.currentGroup=Ei.XY,Ct.addTriangle(n,C.origin,s,a),Ct.addTriangle(n,C.origin,a,s);const u=C.add(C(),s,a);Ct.addTriangle(n,u,s,a),Ct.addTriangle(n,u,a,s),n.currentGroup=Ei.XZ,Ct.addTriangle(n,C.origin,s,l),Ct.addTriangle(n,C.origin,l,s);const d=C.add(C(),s,l);Ct.addTriangle(n,d,s,l),Ct.addTriangle(n,d,l,s),n.currentGroup=Ei.YZ,Ct.addTriangle(n,C.origin,a,l),Ct.addTriangle(n,C.origin,l,a);const f=C.add(C(),a,l);Ct.addTriangle(n,f,a,l),Ct.addTriangle(n,f,l,a)}return Ct.getMesh(n)}(e,t?.geometry);r.setBoundingSphere(ke.create(C.create(n/2,n/2,n/2),n+n/4));return zr.create("axes-mesh",{},r,o=>{switch(o){case Ei.X:return e.colorX;case Ei.Y:return e.colorY;case Ei.Z:return e.colorZ;case Ei.XY:return e.planeColorXY;case Ei.XZ:return e.planeColorXZ;case Ei.YZ:return e.planeColorYZ;case Ei.Origin:return e.originColor;default:return qn.grey}},()=>1,()=>"")}(e);return zr.createRenderObject(t,{...I.getDefaultValues(on.Params),...e,ignoreLight:!0,cellSize:0})}(r),this.scene.add(this.meshRenderObject),t.axes.params.showLabels?(this.textRenderObject=function rft(e){const t=function nft(e,t){const n=100*e.scale,r=function tft(e,t){const n=Ig.create(e,8,8,t),r=100*e.scale,i=C.scale(C(),C.unitX,r),o=C.scale(C(),C.unitY,r),s=C.scale(C(),C.unitZ,r),a=100*e.labelScale;return n.add(e.labelX,i[0],i[1],i[2],0,a,Ei.X),n.add(e.labelY,o[0],o[1],o[2],0,a,Ei.Y),n.add(e.labelZ,s[0],s[1],s[2],0,a,Ei.Z),n.getText()}(e,t?.geometry);r.setBoundingSphere(ke.create(C.create(n/2,n/2,n/2),n));return zr.create("axes-text",{},r,o=>{switch(o){case Ei.X:return e.labelColorX;case Ei.Y:return e.labelColorY;case Ei.Z:return e.labelColorZ;default:return qn.grey}},()=>1,()=>"")}(e);return zr.createRenderObject(t,{...I.getDefaultValues(Tf.Params),...e,alpha:e.labelOpacity,cellSize:0})}(r),this.scene.add(this.textRenderObject)):this.textRenderObject=void 0,this.scene.commit(),C.set(this.camera.position,0,0,200*r.scale),fe.lookAt(this.camera.view,this.camera.position,this.camera.target,this.camera.up),n.axes.params={...t.axes.params}}})}get isEnabled(){return"on"===this.props.axes.name}getLoci(t){const{objectId:n,groupId:r,instanceId:i}=t;return(this.meshRenderObject&&n===this.meshRenderObject.id||this.textRenderObject&&n===this.textRenderObject.id)&&r!==Ei.None?function Kdt(e,t,n){return ZN("camera-axes",e,[{groupId:t,instanceId:n}],void 0,()=>function Xdt(e,t){const n=t.props.axes,r="on"===n.name?n.params.labelX:"X",i="on"===n.name?n.params.labelY:"Y",o="on"===n.name?n.params.labelZ:"Z";switch(e){case Ei.X:return`${r} Axis`;case Ei.Y:return`${i} Axis`;case Ei.Z:return`${o} Axis`;case Ei.XY:return`${r}${i} Plane`;case Ei.XZ:return`${r}${o} Plane`;case Ei.YZ:return`${i}${o} Plane`;case Ei.Origin:return"Origin";default:return"Axes"}}(t,e))}(this,r,i):qr}mark(t,n){return!(!uc.is(uc.Highlighting,n)||!(Xu(t)||Nq(t)&&t.data===this))&&(pr.mark(this.meshRenderObject,t,n,this.eachGroup)||pr.mark(this.textRenderObject,t,n,this.eachGroup))}update(t){if(!this.meshRenderObject||"off"===this.props.axes.name)return;this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),function Zdt(e,t,n){const{near:r,far:i}=e,o=-t.width/2,s=t.width/2,a=t.height/2,l=-t.height/2,c=(s-o)/2,u=(a-l)/2,d=(s+o)/2,f=(a+l)/2;let p=d-c,m=d+c,h=f+u,g=f-u;if(n.enabled){const y=(s-o)/n.width,v=(a-l)/n.height;p+=y*n.offsetX,m=p+y*n.width,h-=v*n.offsetY,g=h-v*n.height}fe.ortho(e.projection,p,m,h,g,r,i)}(this.camera,t.viewport,t.viewOffset),fe.extractRotation(this.scene.view,t.view);const n=this.textRenderObject?this.textRenderObject.values.boundingSphere.ref.value.radius:this.meshRenderObject.values.boundingSphere.ref.value.radius,r=this.props.axes.params.location,i=this.props.axes.params.locationOffsetX*this.pixelRatio,o=this.props.axes.params.locationOffsetY*this.pixelRatio;"bottom-left"===r?fe.setTranslation(this.scene.view,C.create(-t.viewport.width/2+n+i,-t.viewport.height/2+n+o,0)):"bottom-right"===r?fe.setTranslation(this.scene.view,C.create(t.viewport.width/2-n-i,-t.viewport.height/2+n+o,0)):"top-left"===r?fe.setTranslation(this.scene.view,C.create(-t.viewport.width/2+n+i,t.viewport.height/2-n-o,0)):"top-right"===r?fe.setTranslation(this.scene.view,C.create(t.viewport.width/2-n-i,t.viewport.height/2-n-o,0)):Hi()}}var Ei=function(e){return e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=3]="Z",e[e.XY=4]="XY",e[e.XZ=5]="XZ",e[e.YZ=6]="YZ",e[e.Origin=7]="Origin",e}(Ei||{});function Nq(e){return"data-loci"===e.kind&&"camera-axes"===e.tag}const ift={transparentBackground:I.Boolean(!1),dpoitIterations:I.Numeric(2,{min:1,max:10,step:1}),multiSample:I.Group(y0e),postprocessing:I.Group(Tq),marking:I.Group(C0e),cameraHelper:I.Group(kF)};class oft{get colorTarget(){return this._colorTarget}get width(){return this._width}get height(){return this._height}constructor(t,n,r,i,o,s,a,l){this.webgl=t,this.renderer=r,this.scene=i,this.camera=o,this._width=0,this._height=0,this._camera=new Si,this.props={...I.getDefaultValues(ift),...l},this.drawPass=new A0e(t,n,128,128,a),this.multiSamplePass=new PF(t,this.drawPass),this.multiSampleHelper=new b0e(this.multiSamplePass),this.helper={camera:new I0e(t,this.props.cameraHelper),debug:s.debug,handle:s.handle},this.setSize(1024,768)}updateBackground(){return new Promise(t=>{this.drawPass.postprocessing.background.update(this.camera,this.props.postprocessing.background,()=>{t()})})}setSize(t,n){t===this._width&&n===this._height||(this._width=t,this._height=n,this.drawPass.setSize(t,n),this.multiSamplePass.syncSize())}setProps(t={}){Object.assign(this.props,t),t.cameraHelper&&this.helper.camera.setProps(t.cameraHelper)}render(){Si.copySnapshot(this._camera.state,this.camera.state),Da.set(this._camera.viewport,0,0,this._width,this._height),this._camera.update();const t={renderer:this.renderer,camera:this._camera,scene:this.scene,helper:this.helper};PF.isEnabled(this.props.multiSample)?(this.multiSampleHelper.render(t,this.props,!1),this._colorTarget=this.multiSamplePass.colorTarget):(this.drawPass.render(t,this.props,!1),this._colorTarget=this.drawPass.getColorTarget(this.props.postprocessing))}getImageData(t,n,r){var i,o;this.setSize(t,n),this.render(),this.colorTarget.bind();const s=null!==(i=r?.width)&&void 0!==i?i:t,a=null!==(o=r?.height)&&void 0!==o?o:n,l=new Uint8Array(s*a*4);r?this.webgl.readPixels(r.x,n-r.y-r.height,s,a,l):this.webgl.readPixels(0,0,s,a,l);const c=A_.create(l,s,a);return A_.flipY(c),A_.divideByAlpha(c),new ImageData(new Uint8ClampedArray(l),s,a)}}const sft={...on.Params,alpha:{...on.Params.alpha,defaultValue:1},ignoreLight:{...on.Params.ignoreLight,defaultValue:!0},colorX:I.Color(qn.red,{isEssential:!0}),colorY:I.Color(qn.green,{isEssential:!0}),colorZ:I.Color(qn.blue,{isEssential:!0}),scale:I.Numeric(.33,{min:.1,max:2,step:.1},{isEssential:!0})},E0e={handle:I.MappedStatic("off",{on:I.Group(sft),off:I.Group({})},{cycle:!0,description:"Show handle tool"})};class aft{getBoundingSphere(t,n){return this.renderObject&&(ke.copy(t,this.renderObject.values.invariantBoundingSphere.ref.value),fe.fromArray(this._transform,this.renderObject.values.aTransform.ref.value,16*n),ke.transform(t,t,this._transform)),t}setProps(t){this.props=fy(this.props,n=>{if(void 0!==t.handle&&(n.handle.name=t.handle.name,"on"===t.handle.name)){this.scene.clear(),this.pixelRatio=this.webgl.pixelRatio;const r={...t.handle.params,scale:t.handle.params.scale*this.webgl.pixelRatio,cellSize:0};this.renderObject=function dft(e){const t=function uft(e,t){const n=10*e.scale,r=function lft(e,t){const n=Ct.createState(512,256,t),r=.05*e,i=C.scale(C(),C.unitX,e),o=C.scale(C(),C.unitY,e),s=C.scale(C(),C.unitZ,e),a={radiusTop:r,radiusBottom:r,radialSegments:32};return n.currentGroup=X_.TranslateScreenXY,Jr(n,C.origin,3*r,2),n.currentGroup=X_.TranslateObjectX,Jr(n,i,r,2),Ur(n,C.origin,i,1,a),n.currentGroup=X_.TranslateObjectY,Jr(n,o,r,2),Ur(n,C.origin,o,1,a),n.currentGroup=X_.TranslateObjectZ,Jr(n,s,r,2),Ur(n,C.origin,s,1,a),Ct.getMesh(n)}(n,t?.geometry);r.setBoundingSphere(ke.create(C.create(n/2,n/2,n/2),n+n/4));return zr.create("handle",{},r,o=>{switch(o){case X_.TranslateObjectX:return e.colorX;case X_.TranslateObjectY:return e.colorY;case X_.TranslateObjectZ:return e.colorZ;default:return qn.grey}},()=>1,()=>"")}(e);return zr.createRenderObject(t,e)}(r),this.scene.add(this.renderObject),this.scene.commit(),n.handle.params={...t.handle.params}}})}get isEnabled(){return"on"===this.props.handle.name}update(t,n,r){this.renderObject&&(this.pixelRatio!==this.webgl.pixelRatio&&this.setProps(this.props),fe.setTranslation(this.renderObject.values.aTransform.ref.value,n),fe.fromMat3(this.renderObject.values.aTransform.ref.value,r),O.update(this.renderObject.values.aTransform,this.renderObject.values.aTransform.ref.value),this.scene.update([this.renderObject],!0))}getLoci(t){const{objectId:n,groupId:r,instanceId:i}=t;return this.renderObject&&n===this.renderObject.id?function cft(e,t,n){return ZN("handle",e,[{groupId:t,instanceId:n}],r=>e.getBoundingSphere(r,n),()=>`Handle Helper | Group Id ${t} | Instance Id ${n}`)}(this,r,i):qr}mark(t,n){return!(!uc.is(uc.Highlighting,n)||!(Xu(t)||T0e(t)&&t.data===this))&&pr.mark(this.renderObject,t,n,this.eachGroup)}constructor(t,n={}){this.webgl=t,this.props={handle:{name:"off",params:{}}},this.pixelRatio=1,this._transform=fe(),this.eachGroup=(r,i)=>{if(!this.renderObject||!T0e(r))return!1;let o=!1;const s=this.renderObject.values.uGroupCount.ref.value,{elements:a}=r;for(const{groupId:l,instanceId:c}of a)i(Pe.ofSingleton(c*s+l))&&(o=!0);return o},this.scene=_A.create(t,"blended"),this.setProps(n)}}const X_={None:0,TranslateScreenXY:1,TranslateObjectX:3,TranslateObjectY:4,TranslateObjectZ:5};function T0e(e){return"data-loci"===e.kind&&"handle"===e.tag}const fft={debug:I.Group(Aq),camera:I.Group({helper:I.Group(kF)}),handle:I.Group(E0e)},pft=I.getDefaultValues(fft);class hft{constructor(t,n,r={}){const i={...pft,...r};this.debug=new rut(t,n,i.debug),this.camera=new I0e(t,i.camera.helper),this.handle=new aft(t,i.handle)}}class mft{constructor(t,n,r={}){this.webgl=t;const{gl:i}=t;this.draw=new A0e(t,n,i.drawingBufferWidth,i.drawingBufferHeight,r.transparency||"blended"),this.pick=new Idt(t,this.draw,r.pickScale||.25),this.multiSample=new PF(t,this.draw)}setPickScale(t){this.pick.setPickScale(t)}setTransparency(t){this.draw.setTransparency(t)}updateSize(){const{gl:t}=this.webgl,n=Math.max(t.drawingBufferWidth,2),r=Math.max(t.drawingBufferHeight,2);this.draw.setSize(n,r),this.pick.syncSize(),this.multiSample.syncSize()}}const yft={...ca,tPreviousLevel:xn("texture","alpha","float","nearest"),uInvSize:Ne("v2"),uOffset:Ne("v2")},bft=Wi("hi-z",hl,"\nprecision highp float;\nprecision highp sampler2D;\n\nuniform sampler2D tPreviousLevel;\nuniform vec2 uInvSize;\nuniform vec2 uOffset;\n\nvoid main(void) {\n    vec2 position = gl_FragCoord.xy * uInvSize + uOffset;\n\n    float x = texture(tPreviousLevel, position).r;\n    float y = textureOffset(tPreviousLevel, position, ivec2(-1, 0)).r;\n    float z = textureOffset(tPreviousLevel, position, ivec2(-1, -1)).r;\n    float w = textureOffset(tPreviousLevel, position, ivec2(0, -1)).r;\n\n    gl_FragColor = vec4(max(max(x, y), max(z, w)));\n}\n"),D0e=new ArrayBuffer(4);new Int32Array(D0e),new Float32Array(D0e);const P0e=new ArrayBuffer(4),Cft=new Int32Array(P0e),wft=new Float32Array(P0e);function wA(e){return function Aft(e){return Cft[0]=(1<<23)*((e<-126?-126:e)+126.94269504),wft[0]}(1.44269504*e)}const k0e=new ArrayBuffer(8);new Int32Array(k0e),new Float32Array(k0e);const R0e=new ArrayBuffer(4),Ift=new Int32Array(R0e),Eft=new Float32Array(R0e);Math,Math,Math,Math,Math,Math,Math,Math,Math;const O0e=new ArrayBuffer(16);new Int32Array(O0e),new Float32Array(O0e);const B0e=new ArrayBuffer(8);new Int32Array(B0e),new Float32Array(B0e);const j0e=new ArrayBuffer(4);new Int32Array(j0e),new Float32Array(j0e),Math;const Uft=C.transformMat4,z0e=Bn.set,zft=function Bq(e){return Eft[0]=e,1.1920928955078125e-7*Ift[0]-126.94269504};function FF(e,t,n,r){return-1===r[11]?function Vft(e,t,n){return t*n/((n-t)*e-n)}(e,t,n):function Hft(e,t,n){return e*(t-n)-t}(e,t,n)}const V0e={enabled:I.Boolean(!1,{description:"Hierarchical Z-buffer occlusion culling. Only available for WebGL2."}),maxFrameLag:I.Numeric(10,{min:1,max:30,step:1},{description:"Maximum number of frames to wait for Z-buffer data."}),minLevel:I.Numeric(3,{min:1,max:10,step:1})};class $ft{clear(){if(!this.supported)return;const{gl:t}=this.webgl;Cn(t)&&(null!==this.sync&&(t.deleteSync(this.sync),this.sync=null),this.frameLag=0,this.ready=!1,this.debug&&(this.debug.rect.style.display="none",this.debug.container.style.display="none"))}render(t){if(!this.supported||!this.props.enabled)return;const{gl:n,state:r}=this.webgl;if(!Cn(n)||null!==this.sync)return;this.nextNear=t.near,this.nextFar=t.far,fe.copy(this.nextView,t.view),fe.copy(this.nextProjection,t.projection),It&&this.webgl.timer.mark("hi-Z"),r.disable(n.CULL_FACE),r.disable(n.BLEND),r.disable(n.DEPTH_TEST),r.disable(n.SCISSOR_TEST),r.depthMask(!1),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0);const i=this.renderable.values,o=Math.pow(2,Math.ceil(Math.log(Math.max(n.drawingBufferWidth,n.drawingBufferHeight))/Math.log(2))-1);for(let l=0,c=this.levelData.length;l<c;++l){const u=this.levelData[l];u.framebuffer.bind(),l>0?(O.update(i.uInvSize,u.invSize),O.update(i.uOffset,Ue.set(i.uOffset.ref.value,0,0)),O.update(i.tPreviousLevel,this.levelData[l-1].texture)):(O.update(i.uInvSize,Ue.set(i.uInvSize.ref.value,1/o,1/o)),O.update(i.uOffset,Ue.set(i.uOffset.ref.value,this.viewport.x/n.drawingBufferWidth,this.viewport.y/n.drawingBufferHeight)),O.update(i.tPreviousLevel,this.drawPass.depthTextureOpaque)),r.currentRenderItemId=-1,r.viewport(0,0,u.size[0],u.size[1]),n.clear(n.COLOR_BUFFER_BIT),this.renderable.update(),this.renderable.render(),l>=this.props.minLevel&&(this.tex.bind(0),n.copyTexSubImage2D(n.TEXTURE_2D,0,u.offset,0,0,0,u.size[0],u.size[1]),this.tex.unbind(0))}this.tex.attachFramebuffer(this.fb,0);const s=this.tex.getWidth(),a=this.tex.getHeight();n.bindBuffer(n.PIXEL_PACK_BUFFER,this.buf),n.bufferData(n.PIXEL_PACK_BUFFER,this.buffer.byteLength,n.STREAM_READ),n.readPixels(0,0,s,a,n.RED,n.FLOAT,0),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),this.sync=n.fenceSync(n.SYNC_GPU_COMMANDS_COMPLETE,0),n.flush(),It&&this.webgl.timer.markEnd("hi-Z")}tick(){if(!this.supported||!this.props.enabled||null===this.sync)return;const{gl:t}=this.webgl;if(!Cn(t))return;const n=t.clientWaitSync(this.sync,0,0);n===t.WAIT_FAILED||this.frameLag>=this.props.maxFrameLag?(t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!1):n===t.TIMEOUT_EXPIRED?this.frameLag+=1:(t.bindBuffer(t.PIXEL_PACK_BUFFER,this.buf),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this.buffer),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),t.deleteSync(this.sync),this.sync=null,this.frameLag=0,this.ready=!0,this.near=this.nextNear,this.far=this.nextFar,fe.copy(this.view,this.nextView),fe.copy(this.projection,this.nextProjection))}transform(t){const{view:n,vp:r}=this;return Uft(r,t.center,n),{vp:r,r:1.2*t.radius+1.52}}project(t,n){const{projection:r,aabb:i,viewport:o}=this;!function Wft(e,t,n,r){return-1===r[11]?function Gft(e,t,n,r){const i=t[0]*n,o=t[1]*n,s=t[2]*n,a=t[2]*t[2]-n*n,l=Math.sqrt(t[0]*t[0]+a),c=(l*t[0]-s)/(l*t[2]+i)*r[0],u=(l*t[0]+s)/(l*t[2]-i)*r[0],d=Math.sqrt(t[1]*t[1]+a);return z0e(e,-.5*u+.5,(d*t[1]-s)/(d*t[2]+o)*r[5]*.5+.5,-.5*c+.5,(d*t[1]+s)/(d*t[2]-o)*r[5]*.5+.5)}(e,t,n,r):function qft(e,t,n,r){const i=r[0],o=r[5];return z0e(e,(t[0]-n)*i*.5+.5,(t[1]+n)*o*-.5+.5,(t[0]+n)*i*.5+.5,(t[1]-n)*o*-.5+.5)}(e,t,n,r)}(i,t,n,r);const s=i[2]-i[0],a=i[3]-i[1],l=Math.max(s*o.width,a*o.height);return{aabb:i,w:s,h:a,pr:l,lod:Math.ceil(zft(l/2))}}setViewport(t,n,r,i){if(!this.supported)return;r=Math.max(r,2),i=Math.max(i,2),Da.set(this.viewport,t,n,r,i);const o=Math.ceil(Math.log(Math.max(r,i))/Math.log(2));if(o===this.levelData.length)return;const{minLevel:s}=this.props;this.buffer=new Float32Array(Math.pow(2,o-s)*Math.pow(2,o-1-s)),this.tex.define(Math.pow(2,o-s),Math.pow(2,o-1-s));for(const l of this.levelData)l.framebuffer.destroy(),l.texture.destroy();this.levelData.length=0;for(let l=0;l<o;++l){const c=this.webgl.resources.framebuffer(),u=Math.pow(2,o-l-1),d=Ue.create(u,u),f=Ue.create(1/u,1/u),p=this.webgl.resources.texture("image-float32","alpha","float","nearest");p.define(u,u),p.attachFramebuffer(c,0),this.levelData.push({texture:p,framebuffer:c,size:d,invSize:f,offset:0})}let a=0;for(let l=0,c=o;l<c;++l){const u=this.levelData[l];l>=s&&(this.levelData[l].offset=a,a+=u.size[0])}this.clear()}setProps(t){if(this.supported)if(this.props.minLevel!==t.minLevel){Object.assign(this.props,t);const{x:n,y:r,width:i,height:o}=this.viewport;this.setViewport(n,r,i,o)}else Object.assign(this.props,t),this.props.enabled||this.clear()}initDebug(t){if(!t.parentElement)return;const n=document.createElement("div");Object.assign(n.style,{display:"block",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(n);const r=document.createElement("canvas"),i=r.getContext("2d");if(!i)throw new Error("Could not create canvas 2d context");Object.assign(r.style,{width:"100%",height:"100%",imageRendering:"pixelated",position:"relative",pointerEvents:"none"}),n.appendChild(r);const o=document.createElement("div");Object.assign(o.style,{display:"none",position:"absolute",pointerEvents:"none"}),t.parentElement.appendChild(o),this.debug={container:n,canvas:r,ctx:i,rect:o}}canDebug(t){return this.supported&&this.props.enabled&&this.ready&&!!this.debug}showRect(t,n){if(!this.canDebug(this.debug))return;const{gl:{drawingBufferHeight:r},pixelRatio:i}=this.webgl,{viewport:{x:o,y:s,width:a,height:l}}=this,c=(t[0]*a+o)/i,u=(t[1]*l-s)/i;Object.assign(this.debug.rect.style,{border:n?"solid red":"solid green",display:"block",left:`${c}px`,top:`${u+(r-l)/i}px`,width:(t[2]*a+o)/i-c+"px",height:(t[3]*l-s)/i-u+"px"})}showBuffer(t){if(!this.canDebug(this.debug))return;if(t>=this.levelData.length||t<this.props.minLevel)return void(this.debug.container.style.display="none");const{offset:n,size:[r,i]}=this.levelData[t],o=this.tex.getWidth(),s=new Uint8ClampedArray(r*i*4);s.fill(255);for(let p=0;p<i;++p)for(let m=0;m<r;++m){const h=(i-p-1)*r+m,g=255*this.buffer[p*o+m+n];s[4*h+0]=g,s[4*h+3]=255-g}const a=new ImageData(s,r,i);this.debug.canvas.width=a.width,this.debug.canvas.height=a.height,this.debug.ctx.putImageData(a,0,0);const{viewport:{x:l,y:c,width:u,height:d},webgl:{pixelRatio:f}}=this;Object.assign(this.debug.container.style,{display:"block",bottom:c/f+"px",left:l/f+"px",width:u/f+"px",height:d/f+"px"})}debugOcclusion(t){if(!this.canDebug(this.debug))return;if(!t)return this.debug.rect.style.display="none",void(this.debug.container.style.display="none");const n=this.isOccluded(t),{vp:r,r:i}=this.transform(t),{aabb:o,lod:s}=this.project(r,i);this.showRect(o,n),this.showBuffer(s)}dispose(){if(this.supported){this.clear(),this.fb.destroy(),this.tex.destroy(),this.webgl.gl.deleteBuffer(this.buf),this.renderable.dispose();for(const t of this.levelData)t.framebuffer.destroy(),t.texture.destroy()}}constructor(t,n,r,i){this.webgl=t,this.drawPass=n,this.viewport=Da(),this.near=0,this.far=0,this.view=fe(),this.projection=fe(),this.nextNear=0,this.nextFar=0,this.nextView=fe(),this.nextProjection=fe(),this.aabb=Bn(),this.vp=C(),this.levelData=[],this.sync=null,this.buffer=new Float32Array(0),this.frameLag=0,this.ready=!1,this.isOccluded=c=>{if(!this.supported||!this.props.enabled||!this.ready)return!1;const{vp:u,r:d}=this.transform(c),{near:f,far:p,projection:m}=this,h=u[2]+d;if(-h<f)return!1;const{aabb:g,w:y,h:v,lod:x}=this.project(u,d);if(x>=this.levelData.length||x<this.props.minLevel)return!1;const{offset:_,size:w}=this.levelData[x],E=w[0],T=(g[1]+v/2)*E,F=Math.floor((g[0]+y/2)*E),R=Math.ceil(T),N=this.tex.getWidth();if(F+1>=E||R+1>=E)return!1;const j=(E-R-1)*N+F+_;if(h>FF(this.buffer[j],f,p,m)||h>FF(this.buffer[j+1],f,p,m))return!1;const W=(E-R+1-1)*N+F+_;return!(h>FF(this.buffer[W],f,p,m)||h>FF(this.buffer[W+1],f,p,m))};const{gl:o,extensions:s}=t;if(!Cn(o)||!s.colorBufferFloat)return $n&&console.log('Missing webgl2 and/or colorBufferFloat support required for "Hi-Z"'),void(this.supported=!1);this.fb=t.resources.framebuffer(),this.tex=t.resources.texture("image-float32","alpha","float","nearest"),this.tex.attachFramebuffer(this.fb,0);const a=o.getParameter(o.IMPLEMENTATION_COLOR_READ_FORMAT),l=o.getParameter(o.IMPLEMENTATION_COLOR_READ_TYPE);if(a!==o.RED||l!==o.FLOAT)return $n&&console.log('Missing red/float reading support required for "Hi-Z"'),void(this.supported=!1);this.supported=!0,this.props={...I.getDefaultValues(V0e),...i},this.buf=x9(o),this.renderable=function vft(e,t){const n={...ua,tPreviousLevel:O.create(t),uInvSize:O.create(Ue()),uOffset:O.create(Ue())},r={...yft};return ys(ms(e,"triangles",bft,r,n),n)}(t,this.drawPass.depthTextureOpaque),$n&&r&&this.initDebug(r)}}const Fd={camera:I.Group({mode:I.Select("perspective",I.arrayToOptions(["perspective","orthographic"]),{label:"Camera"}),helper:I.Group(kF,{isFlat:!0}),stereo:I.MappedStatic("off",{on:I.Group(v0e),off:I.Group({})},{cycle:!0,hideIf:e=>"perspective"!==e?.mode}),fov:I.Numeric(45,{min:10,max:130,step:1},{label:"Field of View"}),manualReset:I.Boolean(!1,{isHidden:!0})},{pivot:"mode"}),cameraFog:I.MappedStatic("on",{on:I.Group({intensity:I.Numeric(15,{min:1,max:100,step:1})}),off:I.Group({})},{cycle:!0,description:"Show fog in the distance"}),cameraClipping:I.Group({radius:I.Numeric(100,{min:0,max:99,step:1},{label:"Clipping",description:"How much of the scene to show."}),far:I.Boolean(!0,{description:"Hide scene in the distance"}),minNear:I.Numeric(5,{min:.1,max:100,step:.1},{description:"Note, may cause performance issues rendering impostors when set too small and cause issues with outline rendering when too close to 0."})},{pivot:"radius"}),viewport:I.MappedStatic("canvas",{canvas:I.Group({}),"static-frame":I.Group({x:I.Numeric(0),y:I.Numeric(0),width:I.Numeric(128),height:I.Numeric(128)}),"relative-frame":I.Group({x:I.Numeric(.33,{min:0,max:1,step:.01}),y:I.Numeric(.33,{min:0,max:1,step:.01}),width:I.Numeric(.5,{min:.01,max:1,step:.01}),height:I.Numeric(.5,{min:.01,max:1,step:.01})})}),cameraResetDurationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"The time it takes to reset the camera."}),sceneRadiusFactor:I.Numeric(1,{min:1,max:10,step:.1}),transparentBackground:I.Boolean(!1),dpoitIterations:I.Numeric(2,{min:1,max:10,step:1}),pickPadding:I.Numeric(3,{min:0,max:10,step:1},{description:"extra pixels to around target to check in case target is empty"}),multiSample:I.Group(y0e),postprocessing:I.Group(Tq),marking:I.Group(C0e),hiZ:I.Group(V0e),renderer:I.Group(_q),trackball:I.Group(r0e),interaction:I.Group(l0e),debug:I.Group(Aq),handle:I.Group(E0e)},Uq=I.getDefaultValues(Fd);var K_;!function(e){e.DefaultAttribs={powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,antialias:!0,preserveDrawingBuffer:!0,preferWebGl1:!1,handleResize:()=>{}},e.Params={pixelScale:I.Numeric(1,{min:.1,max:2,step:.05}),pickScale:I.Numeric(.25,{min:.1,max:1,step:.05}),transparency:I.Select("wboit",[["blended","Blended"],["wboit","Weighted, Blended"],["dpoit","Depth Peeling"]])},e.DefaultProps=I.getDefaultValues(e.Params),e.fromCanvas=function t(n,r,i={},o={}){const s={...e.DefaultAttribs,...i},a={...e.DefaultProps,...o},{powerPreference:l,failIfMajorPerformanceCaveat:c,antialias:u,preserveDrawingBuffer:d,preferWebGl1:f}=s,p=function WYe(e,t){function n(i){try{return e.getContext(i,t)}catch{return null}}const r=(t?.preferWebGl1?null:n("webgl2"))||n("webgl")||n("experimental-webgl");return $n&&console.log(`isWebgl2: ${Cn(r)}`),r}(n,{powerPreference:l,failIfMajorPerformanceCaveat:c,antialias:u,preserveDrawingBuffer:d,alpha:!0,depth:!0,premultipliedAlpha:!0,preferWebGl1:f});if(null===p)throw new Error("Could not create a WebGL rendering context");const{pixelScale:m,pickScale:h,transparency:g}=a,y=xq.fromElement(n,{pixelScale:m,preventGestures:!0}),v=function ZYe(e,t={}){const n=Gue(e),r=function PWe(e,t){let n={},r=e.getParameter(e.FRONT_FACE),i=e.getParameter(e.CULL_FACE_MODE),o=e.getParameter(e.DEPTH_WRITEMASK),s=e.getParameter(e.DEPTH_CLEAR_VALUE),a=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),m=e.getParameter(e.BLEND_COLOR),h=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),y=e.getParameter(e.STENCIL_FUNC),v=e.getParameter(e.STENCIL_VALUE_MASK),x=e.getParameter(e.STENCIL_REF),_=e.getParameter(e.STENCIL_BACK_FUNC),w=e.getParameter(e.STENCIL_BACK_VALUE_MASK),A=e.getParameter(e.STENCIL_BACK_REF),M=e.getParameter(e.STENCIL_WRITEMASK),E=e.getParameter(e.STENCIL_BACK_WRITEMASK),D=e.getParameter(e.STENCIL_FAIL),T=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),F=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),R=e.getParameter(e.STENCIL_BACK_FAIL),N=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),j=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),W=e.getParameter(e.MAX_VERTEX_ATTRIBS);const z=[];let $=e.getParameter(e.VIEWPORT),V=e.getParameter(e.SCISSOR_BOX),X=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,H=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1;const oe=()=>{for(let te=0;te<W;++te)z[te]=0};return oe(),{currentProgramId:-1,currentMaterialId:-1,currentRenderItemId:-1,enable:te=>{!0!==n[te]&&(e.enable(te),n[te]=!0)},disable:te=>{!1!==n[te]&&(e.disable(te),n[te]=!1)},frontFace:te=>{te!==r&&(e.frontFace(te),r=te)},cullFace:te=>{te!==i&&(e.cullFace(te),i=te)},depthMask:te=>{te!==o&&(e.depthMask(te),o=te)},clearDepth:te=>{te!==s&&(e.clearDepth(te),s=te)},depthFunc:te=>{te!==a&&(e.depthFunc(te),a=te)},colorMask:(te,K,Q,G)=>{(te!==l[0]||K!==l[1]||Q!==l[2]||G!==l[3])&&(e.colorMask(te,K,Q,G),l[0]=te,l[1]=K,l[2]=Q,l[3]=G)},clearColor:(te,K,Q,G)=>{(te!==c[0]||K!==c[1]||Q!==c[2]||G!==c[3])&&(e.clearColor(te,K,Q,G),c[0]=te,c[1]=K,c[2]=Q,c[3]=G)},blendFunc:(te,K)=>{(te!==u||K!==d||te!==f||K!==p)&&(e.blendFunc(te,K),u=te,d=K,f=te,p=K)},blendFuncSeparate:(te,K,Q,G)=>{(te!==u||K!==d||Q!==f||G!==p)&&(e.blendFuncSeparate(te,K,Q,G),u=te,d=K,f=Q,p=G)},blendEquation:te=>{(te!==h||te!==g)&&(e.blendEquation(te),h=te,g=te)},blendEquationSeparate:(te,K)=>{(te!==h||K!==g)&&(e.blendEquationSeparate(te,K),h=te,g=K)},blendColor:(te,K,Q,G)=>{(te!==m[0]||K!==m[1]||Q!==m[2]||G!==m[3])&&(e.blendColor(te,K,Q,G),m[0]=te,m[1]=K,m[2]=Q,m[3]=G)},stencilFunc:(te,K,Q)=>{(te!==y||K!==x||Q!==v||te!==_||K!==A||Q!==w)&&(e.stencilFunc(te,K,Q),y=te,x=K,v=Q,_=te,A=K,w=Q)},stencilFuncSeparate:(te,K,Q,G)=>{te===e.FRONT?(K!==y||Q!==x||G!==v)&&(e.stencilFuncSeparate(te,K,Q,G),y=K,x=Q,v=G):te===e.BACK?(K!==_||Q!==A||G!==w)&&(e.stencilFuncSeparate(te,K,Q,G),_=K,A=Q,w=G):te===e.FRONT_AND_BACK&&(K!==y||Q!==x||G!==v||K!==_||Q!==A||G!==w)&&(e.stencilFuncSeparate(te,K,Q,G),y=K,x=Q,v=G,_=K,A=Q,w=G)},stencilMask:te=>{(te!==M||te!==E)&&(e.stencilMask(te),M=te,E=te)},stencilMaskSeparate:(te,K)=>{te===e.FRONT?K!==M&&(e.stencilMaskSeparate(te,K),M=K):te===e.BACK?K!==E&&(e.stencilMaskSeparate(te,K),E=K):te===e.FRONT_AND_BACK&&(K!==M||K!==E)&&(e.stencilMaskSeparate(te,K),M=K,E=K)},stencilOp:(te,K,Q)=>{(te!==D||K!==F||Q!==T||te!==R||K!==j||Q!==N)&&(e.stencilOp(te,K,Q),D=te,F=K,T=Q,R=te,j=K,N=Q)},stencilOpSeparate:(te,K,Q,G)=>{te===e.FRONT?(K!==D||Q!==F||G!==T)&&(e.stencilOpSeparate(te,K,Q,G),D=K,F=Q,T=G):te===e.BACK?(K!==R||Q!==j||G!==N)&&(e.stencilOpSeparate(te,K,Q,G),R=K,j=Q,N=G):te===e.FRONT_AND_BACK&&(K!==D||Q!==F||G!==T||K!==R||Q!==j||G!==N)&&(e.stencilOpSeparate(te,K,Q,G),D=K,F=Q,T=G,R=K,j=Q,N=G)},enableVertexAttrib:te=>{e.enableVertexAttribArray(te),z[te]=1},clearVertexAttribsState:oe,disableUnusedVertexAttribs:()=>{for(let te=0;te<W;++te)0===z[te]&&e.disableVertexAttribArray(te)},viewport:(te,K,Q,G)=>{(te!==$[0]||K!==$[1]||Q!==$[2]||G!==$[3])&&(e.viewport(te,K,Q,G),$[0]=te,$[1]=K,$[2]=Q,$[3]=G)},scissor:(te,K,Q,G)=>{(te!==V[0]||K!==V[1]||Q!==V[2]||G!==V[3])&&(e.scissor(te,K,Q,G),V[0]=te,V[1]=K,V[2]=Q,V[3]=G)},clipControl:t.clipControl?(te,K)=>{(te!==X||K!==H)&&(t.clipControl.clipControl(te,K),X=te,H=K)}:void 0,reset:()=>{n={},r=e.getParameter(e.FRONT_FACE),i=e.getParameter(e.CULL_FACE_MODE),o=e.getParameter(e.DEPTH_WRITEMASK),s=e.getParameter(e.DEPTH_CLEAR_VALUE),a=e.getParameter(e.DEPTH_FUNC),l=e.getParameter(e.COLOR_WRITEMASK),c=e.getParameter(e.COLOR_CLEAR_VALUE),u=e.getParameter(e.BLEND_SRC_RGB),d=e.getParameter(e.BLEND_DST_RGB),f=e.getParameter(e.BLEND_SRC_ALPHA),p=e.getParameter(e.BLEND_DST_ALPHA),m=e.getParameter(e.BLEND_COLOR),h=e.getParameter(e.BLEND_EQUATION_RGB),g=e.getParameter(e.BLEND_EQUATION_ALPHA),y=e.getParameter(e.STENCIL_FUNC),v=e.getParameter(e.STENCIL_VALUE_MASK),x=e.getParameter(e.STENCIL_REF),_=e.getParameter(e.STENCIL_BACK_FUNC),w=e.getParameter(e.STENCIL_BACK_VALUE_MASK),A=e.getParameter(e.STENCIL_BACK_REF),M=e.getParameter(e.STENCIL_WRITEMASK),E=e.getParameter(e.STENCIL_BACK_WRITEMASK),D=e.getParameter(e.STENCIL_FAIL),T=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),F=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),R=e.getParameter(e.STENCIL_BACK_FAIL),N=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),j=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),W=e.getParameter(e.MAX_VERTEX_ATTRIBS),z.length=0;for(let te=0;te<W;++te)z[te]=0;$=e.getParameter(e.VIEWPORT),V=e.getParameter(e.SCISSOR_BOX),X=t.clipControl?e.getParameter(t.clipControl.CLIP_ORIGIN):-1,H=t.clipControl?e.getParameter(t.clipControl.CLIP_DEPTH_MODE):-1}}}(e,n),i={resourceCounts:{attribute:0,elements:0,framebuffer:0,program:0,renderbuffer:0,shader:0,texture:0,cubeTexture:0,vertexArray:0},drawCount:0,instanceCount:0,instancedDrawCount:0,calls:{drawInstanced:0,drawInstancedBase:0,multiDrawInstancedBase:0,counts:0},culled:{lod:0,frustum:0,occlusion:0}},o=LYe(e,r,i,n),s=function GYe(e,t,n,r){var i;const o=t.disjointTimerQuery,s=null!==(i=r?.avgCount)&&void 0!==i?i:30,a=new Map,l=new Map,c=[],u=new ide(s),d=new ide(s);let f=[],p=null,m=!1;const h=()=>{o&&(a.forEach((y,v)=>{o.deleteQuery(v)}),l.clear(),f=[],p=null)},g=()=>{if(!o)return;const y=function HYe(e){return e.disjointTimerQuery?e.disjointTimerQuery.createQuery():null}(t);y&&(o.beginQuery(o.TIME_ELAPSED,y),l.forEach((v,x)=>{v.queries.push(y)}),a.set(y,{refCount:l.size}),p=y)};return{resolve:()=>{const y=[];if(!o||!f.length)return y;a.forEach((x,_)=>{if(void 0!==x.timeElapsed)return;const w=o.getQueryParameter(_,o.QUERY_RESULT_AVAILABLE),A=e.getParameter(o.GPU_DISJOINT);if(w&&!A){const M=o.getQueryParameter(_,o.QUERY_RESULT);x.timeElapsed=M}(w||A)&&o.deleteQuery(_)});const v=[];for(const x of f)if(x.queries.every(_=>{var w;return void 0!==(null===(w=a.get(_))||void 0===w?void 0:w.timeElapsed)})){let _=0;for(const w of x.queries){const A=a.get(w);_+=A.timeElapsed,A.refCount-=1}if(x.timeElapsed=_,x.root){const w=[],A=(E,D)=>{for(const T of E){const F=T.timeElapsed,R=T.cpu.end-T.cpu.start,N={label:T.label,gpuElapsed:F,gpuAvg:u.add(T.label,F),cpuElapsed:R,cpuAvg:d.add(T.label,R),children:[],calls:T.calls};D.push(N),A(T.children,N.children)}};A(x.children,w);const M=x.cpu.end-x.cpu.start;y.push({label:x.label,gpuElapsed:_,gpuAvg:u.add(x.label,_),cpuElapsed:M,cpuAvg:d.add(x.label,M),children:w,calls:x.calls})}}else v.push(x);return f=v,a.forEach((x,_)=>{0===x.refCount&&a.delete(_)}),y},mark:(y,v=!1)=>{if(!o)return;if(l.has(y))throw new Error(`Timer mark for '${y}' already exists`);null!==p&&o.endQuery(o.TIME_ELAPSED);const x={label:y,queries:[],children:[],root:null===p,cpu:{start:Bo(),end:-1},captureStats:v};if(l.set(y,x),c.length&&c[c.length-1].children.push(x),c.push(x),v){if(m)throw new Error("Already capturing stats");(function VYe(e){e.calls.drawInstanced=0,e.calls.drawInstancedBase=0,e.calls.multiDrawInstancedBase=0,e.calls.counts=0,e.culled.lod=0,e.culled.frustum=0,e.culled.occlusion=0})(n),m=!0}g()},markEnd:y=>{var v;if(!o)return;const x=l.get(y);if(!x)throw new Error(`Timer mark for '${y}' does not exist`);if((null===(v=c.pop())||void 0===v?void 0:v.label)!==y)throw new Error(`Timer mark for '${y}' has pending nested mark`);o.endQuery(o.TIME_ELAPSED),l.delete(y),x.cpu.end=Bo(),x.captureStats&&(x.calls={...n.calls},m=!1),f.push(x),l.size>0?g():p=null},stats:()=>({gpu:u.stats(),cpu:d.stats()}),formatedStats:()=>{const y={},v=u.stats(),x=d.stats();for(const _ of Object.keys(v)){const w=`${(v[_]/1e3/1e3).toFixed(2)}`,A=`${x[_].toFixed(2)}`;y[_]=`${w} ms | CPU: ${A} ms`}return y},clear:h,destroy:()=>{h()}}}(e,n,i),a={maxTextureSize:e.getParameter(e.MAX_TEXTURE_SIZE),max3dTextureSize:Cn(e)?e.getParameter(e.MAX_3D_TEXTURE_SIZE):0,maxRenderbufferSize:e.getParameter(e.MAX_RENDERBUFFER_SIZE),maxDrawBuffers:n.drawBuffers?e.getParameter(n.drawBuffers.MAX_DRAW_BUFFERS):0,maxTextureImageUnits:e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS)};if(a.maxVertexTextureImageUnits<8)throw new Error('Need "MAX_VERTEX_TEXTURE_IMAGE_UNITS" >= 8');const l=n.provokingVertex;l?.provokingVertex(l.FIRST_VERTEX_CONVENTION);let c=!1;const u=new Ao(0);let f,d=t.pixelScale||1;if(Cn(e)){const m=e.createBuffer();let h,g,y=!1;const v=()=>{e.bindBuffer(e.PIXEL_PACK_BUFFER,m),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,h),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),y=!1,g(),g=void 0,h=void 0};f=(x,_,w,A,M)=>new Promise((E,D)=>{y?D("Can not call multiple readPixelsAsync at the same time"):(y=!0,e.bindBuffer(e.PIXEL_PACK_BUFFER,m),e.bufferData(e.PIXEL_PACK_BUFFER,w*A*4,e.STREAM_READ),e.readPixels(x,_,w,A,e.RGBA,e.UNSIGNED_BYTE,0),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),g=E,h=M,ude(e,v))})}else f=function(){var m=le(function*(h,g,y,v,x){S9(e,h,g,y,v,x)});return function(g,y,v,x,_){return m.apply(this,arguments)}}();const p=new Set;return{gl:e,isWebGL2:Cn(e),get pixelRatio(){return(typeof window<"u"&&window.devicePixelRatio||1)*(d||1)},extensions:n,state:r,stats:i,resources:o,timer:s,get maxTextureSize(){return a.maxTextureSize},get max3dTextureSize(){return a.max3dTextureSize},get maxRenderbufferSize(){return a.maxRenderbufferSize},get maxDrawBuffers(){return a.maxDrawBuffers},get maxTextureImageUnits(){return a.maxTextureImageUnits},namedComputeRenderables:Object.create(null),namedFramebuffers:Object.create(null),namedTextures:Object.create(null),get isContextLost(){return c||e.isContextLost()},contextRestored:u,setContextLost:()=>{c=!0},handleContextRestored:m=>{Object.assign(n,Gue(e)),r.reset(),r.currentMaterialId=-1,r.currentProgramId=-1,r.currentRenderItemId=-1,o.reset(),p.forEach(h=>h.reset()),m?.(),c=!1,u.next(Bo())},setPixelScale:m=>{d=m},createRenderTarget:(m,h,g,y,v,x)=>{const _=function jYe(e,t,n,r,i=!0,o="uint8",s="nearest",a="rgba"){if("alpha"===a&&!Cn(e))throw new Error("cannot render to alpha format in webgl1");const l=t.framebuffer(),c="fp16"===o?t.texture("image-float16",a,"fp16",s):"float32"===o?t.texture("image-float32",a,"float",s):t.texture("image-uint8",a,"ubyte",s),u=i?Cn(e)?t.renderbuffer("depth32f","depth",n,r):t.renderbuffer("depth16","depth",n,r):null;function d(){c.define(n,r),c.attachFramebuffer(l,"color0"),u&&u.attachFramebuffer(l)}d();let f=!1;return{id:rde(),texture:c,framebuffer:l,depthRenderbuffer:u,getWidth:()=>n,getHeight:()=>r,bind:()=>{l.bind()},setSize:(p,m)=>{n===p&&r===m||(c.define(n=p,r=m),u&&u.setSize(n,r))},reset:()=>{d()},destroy:()=>{f||(c.destroy(),l.destroy(),u&&u.destroy(),f=!0)}}}(e,o,m,h,g,y,v,x);return p.add(_),{..._,destroy:()=>{_.destroy(),p.delete(_)}}},unbindFramebuffer:()=>hN(e),readPixels:(m,h,g,y,v)=>{S9(e,m,h,g,y,v)},readPixelsAsync:f,waitForGpuCommandsComplete:()=>function YYe(e){return new Promise(t=>{Cn(e)?ude(e,t):(dde||(console.info("Sync object not supported in WebGL"),dde=!0),fde(e),t())})}(e),waitForGpuCommandsCompleteSync:()=>fde(e),getDrawingBufferPixelData:()=>function XYe(e,t){const n=e.drawingBufferWidth,r=e.drawingBufferHeight,i=new Uint8Array(n*r*4);return hN(e),t.viewport(0,0,n,r),S9(e,0,0,n,r,i),A_.flipY(A_.create(i,n,r))}(e,r),clear:(m,h,g,y)=>{hN(e),r.enable(e.SCISSOR_TEST),r.depthMask(!0),r.colorMask(!0,!0,!0,!0),r.clearColor(m,h,g,y),r.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),r.scissor(0,0,e.drawingBufferWidth,e.drawingBufferHeight),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)},destroy:m=>{var h,g;o.destroy(),function $Ye(e){const t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);for(let i=0;i<t;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_2D,null),e.bindTexture(e.TEXTURE_CUBE_MAP,null),Cn(e)&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null));const n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);const r=e.getParameter(e.MAX_VERTEX_ATTRIBS);for(let i=0;i<r;++i)e.vertexAttribPointer(i,1,e.FLOAT,!1,0,0);e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),hN(e)}(e),m?.doNotForceWebGLContextLoss||(null===(h=e.getExtension("WEBGL_lose_context"))||void 0===h||h.loseContext(),null===(g=e.getExtension("STACKGL_destroy_context"))||void 0===g||g.destroy())}}}(p,{pixelScale:m}),x=new mft(v,r,{pickScale:h,transparency:g});if($n){const E=p.getExtension("WEBGL_lose_context");E&&n.addEventListener("mousedown",D=>{v.isContextLost||!D.shiftKey||!D.ctrlKey||!D.altKey||($n&&console.log("lose context"),E.loseContext(),setTimeout(()=>{v.isContextLost&&($n&&console.log("restore context"),E.restoreContext())},1e3))},!1)}const _=new Ao(0),w=E=>{v.setContextLost(),E.preventDefault(),$n&&console.log("context lost"),_.next(Bo())},A=()=>{v.isContextLost&&(v.handleContextRestored(()=>{x.draw.reset()}),$n&&console.log("context restored"))};n.addEventListener("webglcontextlost",w,!1),n.addEventListener("webglcontextrestored",A,!1);const M=new Ao(void 0);return{canvas:n,webgl:v,input:y,passes:x,attribs:s,get props(){return{...a}},contextLost:_,contextRestored:v.contextRestored,assetManager:r,changed:M,setProps:E=>{if(!E)return;let D=!1;void 0!==E.pixelScale&&E.pixelScale!==a.pixelScale&&(a.pixelScale=E.pixelScale,y.setPixelScale(E.pixelScale),v.setPixelScale(E.pixelScale),s.handleResize(),D=!0),void 0!==E.pickScale&&E.pickScale!==a.pickScale&&(a.pickScale=E.pickScale,x.setPickScale(E.pickScale),D=!0),void 0!==E.transparency&&E.transparency!==a.transparency&&(a.transparency=E.transparency,x.setTransparency(E.transparency),D=!0),D&&M.next(void 0)},dispose:E=>{y.dispose(),n.removeEventListener("webglcontextlost",w,!1),n.removeEventListener("webglcontextrestored",A,!1),v.destroy(E)}}}}(K_||(K_={}));const Yft=typeof window<"u"?window.requestAnimationFrame:e=>setImmediate(()=>e(Date.now())),H0e=typeof window<"u"?window.cancelAnimationFrame:e=>clearImmediate(e);var zq;function Xft(e){G0e(e)}function G0e(e){jt.Canvas3D.ResetSettings.subscribe(e,()=>{var t;null===(t=e.canvas3d)||void 0===t||t.setProps(Uq),e.events.canvas3d.settingsUpdated.next(void 0)}),jt.Canvas3D.SetSettings.subscribe(e,t=>{var n;e.canvas3d&&(null===(n=e.canvas3d)||void 0===n||n.setProps(t.settings),e.events.canvas3d.settingsUpdated.next(void 0))})}!function(e){e.create=function t(n,r={}){var i;const{webgl:o,input:s,passes:a,assetManager:l,canvas:c}=n,u={...op(Uq),...op(r)},d=new Map,f=new Map,p=new Ao(0);let m=Bo();const h=new Ao(0),g=new Ao(0),y=new Ao(0),{gl:v,contextRestored:x}=o;let _=0,w=0,A=128,M=128,E=!1,D=0;Kn();const T=_A.create(o,n.props.transparency);function F(){return T.boundingSphere.radius*u.sceneRadiusFactor}const R=new Si({position:C.create(0,0,100),mode:u.camera.mode,fog:"on"===u.cameraFog.name?u.cameraFog.params.intensity:0,clipFar:u.cameraClipping.far,minNear:u.cameraClipping.minNear,fov:Xr(u.camera.fov)},{x:_,y:w,width:A,height:M}),N=new CA(R,u.camera.stereo.params),j=wq.create(s,R,T,u.trackball),W=new hft(o,T,u),z=new $ft(o,a.draw,c,u.hiZ),$=Cq.create(o,u.renderer);$.setOcclusionTest(z.isOccluded);const V=new Edt(o,$,T,W,a.pick,{x:_,y:w,width:A,height:M},u.pickPadding),X=new uut(ct,Z,s,R,j,u.interaction),H=new b0e(a.multiSample);a.draw.postprocessing.background.update(R,u.postprocessing.background,ut=>{ut&&Ae()});let te,K,oe=!1,Q=!1,G=!0;function Z(ut){let Et=qr,Nt=Xn.Empty;if(ut){const ye=W.camera.getLoci(ut);if(ye!==qr)return{loci:ye,repr:Nt};Et=W.handle.getLoci(ut),d.forEach((we,Te)=>{const je=Te.getLoci(ut);uu(je)||(uu(Et)||console.warn("found another loci, this should not happen"),Et=je,Nt=Te)})}return{loci:Et,repr:Nt}}let ee=[];function re(ut,Et){const{repr:Nt,loci:ye}=ut;let we=!1;return Nt?we=Nt.mark(ye,Et)||we:d.forEach((Te,je)=>{we=je.mark(ye,Et)||we}),we=W.handle.mark(ye,Et)||we,we=W.camera.mark(ye,Et)||we,we}let ge=!1,Ie=!1;function me(ut){Ie||function ae(ut){if(o.isContextLost)return!1;let Et=!1;if(Q&&(Qt(!1),Q=!1,Et=!0),_>v.drawingBufferWidth||_+A<0||w>v.drawingBufferHeight||w+M<0)return!1;const Nt=function xe(){let ut=!1;for(const[Et,Nt]of ee)ut=re(Et,Nt)||ut;return ee=[],ut&&(T.update(void 0,!0),W.handle.scene.update(void 0,!0),W.camera.scene.update(void 0,!0)),ut}()&&($.props.colorMarker||u.marking.enabled);let ye=!1;j.update(D);const we=R.update(),Te=ut||we||Et||E;E=!1;const je=H.update(Nt||Te,u.multiSample);if(Te||je||Nt){let Ft=R;"on"===u.camera.stereo.name&&(N.update(),Ft=N),It&&o.timer.mark("Canvas3D.render",!0);const Vt={renderer:$,camera:Ft,scene:T,helper:W};PF.isEnabled(u.multiSample)?H.render(Vt,u,!0,u.multiSample.reduceFlicker&&!we&&Nt&&!j.isAnimating):a.draw.render(Vt,u,!0),z.render(R),It&&o.timer.markEnd("Canvas3D.render"),V.dirty=V.dirty||Te,ye=!0}return ye}(!!ut?.force)&&G&&h.next(Bo()-m)}function Ae(){E=!0}let he=0;function ie(ut,Et){D=ut,q(Et?.isSynchronous),R.transition.tick(D),z.tick(),!Et?.manualDraw&&(me(),!R.transition.inTransition&&!o.isContextLost&&X.tick(D))}function ue(){ie(Bo()),he=Yft(ue)}function ct(ut,Et){return o.isContextLost?void 0:V.identify(ut,Et,"on"===u.camera.stereo.name?N:R)}function q(ut=!1){(function $e(ut){return!T.needsCommit||(ke.copy(be,T.boundingSphereVisible),z.clear(),T.commit(ut?void 0:Be)?(y.next(0),W.debug.isEnabled&&W.debug.update(),!u.camera.manualReset&&(0===p.value||function Re(){if(0===R.state.radiusMax)return!0;if(R.transition.inTransition||K)return!1;let ut=!0,Et=!0;ke.set(Ce,R.state.target,R.state.radius);for(const Nt of T.renderables){if(!Nt.state.visible)continue;const ye=Nt.values.boundingSphere.ref.value;if(!ye.radius)continue;Et=!1;const we=C.distance(Ce.center,ye.center);if((we>Ce.radius||we>ye.radius||ye.radius>R.state.radiusMax)&&!ke.includes(be,ye))return!0;ke.overlaps(Ce,ye)&&(ut=!1)}return ut||!Et&&Ce.radius<=.1}())&&(oe=!0),0===be.radius&&(te=0),u.camera.manualReset||R.setState({radiusMax:F()},0),p.next(d.size),$n&&nt(),!0):(y.next(T.commitQueueSize),!1))})(ut)&&(function ne(){if(!oe)return;const ut=T.boundingSphereVisible,{center:Et,radius:Nt}=ut,ye=j.props.autoAdjustMinMaxDistance;if("on"===ye.name){const we=ye.params.minDistanceFactor*Nt+ye.params.minDistancePadding,Te=Math.max(ye.params.maxDistanceFactor*Nt,ye.params.maxDistanceMin);j.setProps({minDistance:we,maxDistance:Te})}if(Nt>0){const we=void 0===te?u.cameraResetDurationMs:te,Te=R.getFocus(Et,Nt),je="function"==typeof K?K(T,R):K,Ft=je?{...Te,...je}:Te;R.setState({...Ft,radiusMax:F()},we)}te=void 0,K=void 0,oe=!1}(),ge&&(W.debug.isEnabled&&W.debug.update(),me({force:!0}),ge=!1),g.next(Bo()))}const be=ke(),Ce=ke(),Be=250;function nt(){const ut=T.renderables.map(we=>({drawCount:we.values.drawCount.ref.value,instanceCount:we.values.instanceCount.ref.value,materialId:we.materialId,renderItemId:we.id}));console.groupCollapsed(`${ut.length} RenderItems`),ut.length<50?console.table(ut):console.log(ut),console.log(JSON.stringify(o.stats,void 0,4));const{texture:Et,attribute:Nt,elements:ye}=o.resources.getByteCounts();console.log(JSON.stringify({texture:`${(Et/1024/1024).toFixed(3)} MiB`,attribute:`${(Nt/1024/1024).toFixed(3)} MiB`,elements:`${(ye/1024/1024).toFixed(3)} MiB`},void 0,4)),console.log(JSON.stringify(o.timer.formatedStats(),void 0,4)),console.groupEnd()}function Pt(){const ut=T.boundingSphere.radius>0?100-Math.round(R.transition.target.radius/F()*100):0;return{camera:{mode:R.state.mode,helper:{...W.camera.props},stereo:{...u.camera.stereo},fov:Math.round(pf(R.state.fov)),manualReset:!!u.camera.manualReset},cameraFog:R.state.fog>0?{name:"on",params:{intensity:R.state.fog}}:{name:"off",params:{}},cameraClipping:{far:R.state.clipFar,radius:ut,minNear:R.state.minNear},cameraResetDurationMs:u.cameraResetDurationMs,sceneRadiusFactor:u.sceneRadiusFactor,transparentBackground:u.transparentBackground,dpoitIterations:u.dpoitIterations,pickPadding:u.pickPadding,viewport:u.viewport,postprocessing:{...u.postprocessing},marking:{...u.marking},multiSample:{...u.multiSample},hiZ:{...z.props},renderer:{...$.props},trackball:{...j.props},interaction:{...X.props},debug:{...W.debug.props},handle:{...W.handle.props}}}const St=x.subscribe(()=>{V.dirty=!0,me({force:!0}),me({force:!0})}),Mt=new Ao(0);function Qt(ut=!0){a.updateSize(),Kn(),ti(),ut&&Ae(),Mt.next(+new Date)}!function tOe(e){y3.includes(e)||y3.push(e)}(nt);const An=null===(i=n.changed)||void 0===i?void 0:i.subscribe(()=>{T.setTransparency(n.props.transparency),Ae()});if($n&&c){let ut;const Et=Nt=>{const ye=Nt&&Yn.getBoundingSphere(Yn.normalize(Nt,"residue"));z.debugOcclusion(ye)};s.click.subscribe(Nt=>{if(!Nt.modifiers.control||2!==Nt.button)return;const ye=ct(Nt.x,Nt.y);if(!ye)return ut=void 0,void Et(ut);ut=Z(ye.id).loci,Et(ut)}),h.subscribe(()=>{setTimeout(()=>{Et(ut)},100)})}return{webgl:o,add:function ht(ut){!function ft(ut){f.has(ut)||f.set(ut,ut.updated.subscribe(Et=>{ut.state.syncManually||ht(ut)}))}(ut);const Et=d.get(ut),Nt=new Set;ut.renderObjects.forEach(ye=>Nt.add(ye)),Et?Lo.areEqual(Nt,Et)||(Nt.forEach(ye=>{Et.has(ye)||T.add(ye)}),Et.forEach(ye=>{Nt.has(ye)||T.remove(ye)})):ut.renderObjects.forEach(ye=>T.add(ye)),d.set(ut,Nt),T.update(ut.renderObjects,!1),ge=!0,$n&&nt()},remove:function Ge(ut){!function vt(ut){const Et=f.get(ut);Et&&(Et.unsubscribe(),f.delete(ut))}(ut);const Et=d.get(ut);Et&&(Et.forEach(Nt=>T.remove(Nt)),d.delete(ut),ge=!0,$n&&nt())},commit:q,update:(ut,Et)=>{if(ut){if(!d.has(ut))return;T.update(ut.renderObjects,!!Et)}else T.update(void 0,!!Et);ge=!0},clear:()=>{f.forEach(ut=>ut.unsubscribe()),f.clear(),d.clear(),T.clear(),W.debug.clear(),Ae(),p.next(d.size)},syncVisibility:()=>{0===R.state.radiusMax&&(oe=!0,te=0),T.syncVisibility()&&W.debug.isEnabled&&W.debug.update(),Ae()},requestDraw:Ae,tick:ie,animate:function Fe(){Ie=!1,j.start(Bo()),0===he&&ue()},resetTime:function _e(ut){m=ut,j.start(ut)},pause:function Ze(ut=!1){Ie=ut,H0e(he),he=0},resume:()=>{Ie=!1},identify:ct,mark:function se(ut,Et){ee.push([ut,Et])},getLoci:Z,handleResize:Qt,requestResize:()=>{Q=!0},requestCameraReset:ut=>{te=ut?.durationMs,K=ut?.snapshot,oe=!0},camera:R,boundingSphere:T.boundingSphere,boundingSphereVisible:T.boundingSphereVisible,get notifyDidDraw(){return G},set notifyDidDraw(ut){G=ut},didDraw:h,commited:g,commitQueueSize:y,reprCount:p,resized:Mt,setProps:(ut,Et=!1)=>{var Nt,ye,we,Te;const je="function"==typeof ut?fy(Pt(),ut):ut;void 0!==je.sceneRadiusFactor&&(u.sceneRadiusFactor=je.sceneRadiusFactor,R.setState({radiusMax:F()},0));const Ft=Object.create(null);je.camera&&void 0!==je.camera.mode&&je.camera.mode!==R.state.mode&&(Ft.mode=je.camera.mode);const Vt=Math.round(pf(R.state.fov));if(je.camera&&void 0!==je.camera.fov&&je.camera.fov!==Vt&&(Ft.fov=Xr(je.camera.fov)),void 0!==je.cameraFog&&je.cameraFog.params){const pn="on"===je.cameraFog.name?je.cameraFog.params.intensity:0;pn!==R.state.fog&&(Ft.fog=pn)}if(void 0!==je.cameraClipping&&(void 0!==je.cameraClipping.far&&je.cameraClipping.far!==R.state.clipFar&&(Ft.clipFar=je.cameraClipping.far),void 0!==je.cameraClipping.minNear&&je.cameraClipping.minNear!==R.state.minNear&&(Ft.minNear=je.cameraClipping.minNear),void 0!==je.cameraClipping.radius)){const pn=F()/100*(100-je.cameraClipping.radius);pn>0&&pn!==Ft.radius&&(Ft.radius=Math.max(pn,.01))}Object.keys(Ft).length>0&&R.setState(Ft),!(null===(Nt=je.camera)||void 0===Nt)&&Nt.helper&&W.camera.setProps(je.camera.helper),void 0!==(null===(ye=je.camera)||void 0===ye?void 0:ye.manualReset)&&(u.camera.manualReset=je.camera.manualReset),void 0!==(null===(we=je.camera)||void 0===we?void 0:we.stereo)&&(Object.assign(u.camera.stereo,je.camera.stereo),N.setProps(u.camera.stereo.params)),void 0!==je.cameraResetDurationMs&&(u.cameraResetDurationMs=je.cameraResetDurationMs),void 0!==je.transparentBackground&&(u.transparentBackground=je.transparentBackground),void 0!==je.dpoitIterations&&(u.dpoitIterations=je.dpoitIterations),void 0!==je.pickPadding&&(u.pickPadding=je.pickPadding),void 0!==je.viewport&&(u.viewport===je.viewport||u.viewport.name===je.viewport.name&&l3(u.viewport.params,je.viewport.params)||(u.viewport=je.viewport,Kn(),ti())),!(null===(Te=je.postprocessing)||void 0===Te)&&Te.background&&(Object.assign(u.postprocessing.background,je.postprocessing.background),a.draw.postprocessing.background.update(R,u.postprocessing.background,pn=>{pn&&!Et&&Ae()})),je.postprocessing&&Object.assign(u.postprocessing,je.postprocessing),je.marking&&Object.assign(u.marking,je.marking),je.multiSample&&Object.assign(u.multiSample,je.multiSample),je.hiZ&&z.setProps(je.hiZ),je.renderer&&$.setProps(je.renderer),je.trackball&&j.setProps(je.trackball),je.interaction&&X.setProps(je.interaction),je.debug&&W.debug.setProps(je.debug),je.handle&&W.handle.setProps(je.handle),"orthographic"===Ft.mode&&(u.camera.stereo.name="off"),Et||Ae()},getImagePass:(ut={})=>new oft(o,l,$,T,R,W,a.draw.transparency,ut),getRenderObjects(){const ut=[];return T.forEach((Et,Nt)=>ut.push(Nt)),ut},get props(){return Pt()},get input(){return s},get stats(){return $.stats},get interaction(){return X.events},dispose:()=>{St.unsubscribe(),An?.unsubscribe(),H0e(he),ee=[],T.clear(),W.debug.clear(),j.dispose(),$.dispose(),X.dispose(),z.dispose(),function nOe(e){const t=y3.indexOf(e);-1!==t&&y3.splice(t,1)}(nt)}};function Kn(){const ut=_,Et=w,Nt=A,ye=M;"canvas"===u.viewport.name?(_=0,w=0,A=v.drawingBufferWidth,M=v.drawingBufferHeight):"static-frame"===u.viewport.name?(_=u.viewport.params.x*o.pixelRatio,M=u.viewport.params.height*o.pixelRatio,w=v.drawingBufferHeight-M-u.viewport.params.y*o.pixelRatio,A=u.viewport.params.width*o.pixelRatio):"relative-frame"===u.viewport.name&&(_=Math.round(u.viewport.params.x*v.drawingBufferWidth),M=Math.round(u.viewport.params.height*v.drawingBufferHeight),w=Math.round(v.drawingBufferHeight-M-u.viewport.params.y*v.drawingBufferHeight),A=Math.round(u.viewport.params.width*v.drawingBufferWidth)),(ut!==_||Et!==w||Nt!==A||ye!==M)&&(E=!0)}function ti(){V.setViewport(_,w,A,M),$.setViewport(_,w,A,M),Da.set(R.viewport,_,w,A,M),Da.set(j.viewport,_,w,A,M),z.setViewport(_,w,A,M)}}}(zq||(zq={}));const Z_=es,rv=Rf,Q_=Ut.Trigger,Kft={hoverHighlightOnly:Ut([Q_(Z_.Flag.None)],"Highlight","Hover element using ${triggers}"),hoverHighlightOnlyExtend:Ut([Q_(Z_.Flag.None,rv.create({shift:!0}))],"Extend highlight","From selected to hovered element along polymer using ${triggers}")},Zft={bindings:I.Value(Kft,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),preferAtoms:I.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:I.Boolean(!0)},Qft=ii.create({name:"representation-highlight-loci",category:"interaction",ctor:class extends ii.Handler{constructor(){super(...arguments),this.lociMarkProvider=(e,t)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark(e,t)}}getLoci(e){return this.params.preferAtoms&&fn.isLoci(e)&&2===e.bonds.length?fn.toFirstStructureElementLoci(e):e}register(){this.subscribeObservable(this.ctx.behaviors.interaction.hover,({current:e,buttons:t,modifiers:n})=>{if(!this.ctx.canvas3d||this.ctx.isBusy)return;const r=this.getLoci(e.loci);if(this.params.ignore.includes(r.kind))return void this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:qr});let i=!1;Ut.match(this.params.bindings.hoverHighlightOnly,t,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnly({loci:r}),i=!0),Ut.match(this.params.bindings.hoverHighlightOnlyExtend,t,n)&&(this.ctx.managers.interactivity.lociHighlights.highlightOnlyExtend({loci:r}),i=!0),i||this.ctx.managers.interactivity.lociHighlights.highlightOnly({repr:e.repr,loci:qr})}),this.ctx.managers.interactivity.lociHighlights.addProvider(this.lociMarkProvider)}unregister(){this.ctx.managers.interactivity.lociHighlights.removeProvider(this.lociMarkProvider)}},params:()=>Zft,display:{name:"Highlight Loci on Canvas"}}),q0e={clickSelect:Ut.Empty,clickToggleExtend:Ut([Q_(Z_.Flag.Primary,rv.create({shift:!0}))],"Toggle extended selection","Click on element using ${triggers} to extend selection along polymer"),clickSelectOnly:Ut.Empty,clickToggle:Ut([Q_(Z_.Flag.Primary,rv.create())],"Toggle selection","Click on element using ${triggers}"),clickDeselect:Ut.Empty,clickDeselectAllOnEmpty:Ut([Q_(Z_.Flag.Primary,rv.create())],"Deselect all","Click on nothing using ${triggers}")},Jft={bindings:I.Value(q0e,{isHidden:!0}),ignore:I.Value([],{isHidden:!0}),preferAtoms:I.Boolean(!1,{description:"Always prefer atoms over bonds"}),mark:I.Boolean(!0)},W0e=ii.create({name:"representation-select-loci",category:"interaction",ctor:class extends ii.Handler{getLoci(e){return this.params.preferAtoms&&fn.isLoci(e)&&2===e.bonds.length?fn.toFirstStructureElementLoci(e):e}applySelectMark(e,t){const n=this.ctx.state.data.cells.get(e);if(n&&Se.isRepresentation3D(n.obj)){this.spine.current=n;const r=this.spine.getRootOfType(Se.Molecule.Structure);if(r){t&&this.lociMarkProvider({loci:Xe.Loci(r.data)},un.Deselect);const i=this.ctx.managers.structure.selection.getLoci(r.data);this.lociMarkProvider({loci:i},un.Select)}}}register(){const t=r=>!Yn.isEmpty(r),n=[["clickSelect",r=>this.ctx.managers.interactivity.lociSelects.select(r),t],["clickToggle",r=>this.ctx.managers.interactivity.lociSelects.toggle(r),t],["clickToggleExtend",r=>this.ctx.managers.interactivity.lociSelects.toggleExtend(r),t],["clickSelectOnly",r=>this.ctx.managers.interactivity.lociSelects.selectOnly(r),t],["clickDeselect",r=>this.ctx.managers.interactivity.lociSelects.deselect(r),t],["clickDeselectAllOnEmpty",()=>this.ctx.managers.interactivity.lociSelects.deselectAll(),r=>Yn.isEmpty(r)]];n.sort((r,i)=>{const o=this.params.bindings[r[0]],s=this.params.bindings[i[0]],a=0===o.triggers.length?0:Bh(o.triggers.map(c=>rv.size(c.modifiers)));return(0===s.triggers.length?0:Bh(s.triggers.map(c=>rv.size(c.modifiers))))-a}),this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:r,button:i,modifiers:o})=>{if(!this.ctx.canvas3d||this.ctx.isBusy||!this.ctx.selectionMode)return;const s=this.getLoci(r.loci);if(!this.params.ignore.includes(s.kind))for(const[a,l,c]of n)if(Ut.match(this.params.bindings[a],i,o)&&(!c||c(s))){l({repr:r.repr,loci:s});break}}),this.ctx.managers.interactivity.lociSelects.addProvider(this.lociMarkProvider),this.subscribeObservable(this.ctx.state.events.object.created,({ref:r})=>this.applySelectMark(r)),this.subscribeObservable(this.ctx.state.events.object.updated,({ref:r,obj:i,oldObj:o,oldData:s,action:a})=>{const l=this.ctx.state.data.cells.get(r);if(l&&Se.Molecule.Structure.is(l.obj)){const c=i.data,u="recreate"===a?o?.data:"in-place"===a?s:void 0;if(u&&Xe.areEquivalent(c,u)&&Xe.areHierarchiesEqual(c,u))return;const d=this.ctx.state.data.select(Qn.children(r).ofType(Se.Molecule.Structure.Representation3D));for(const f of d)this.applySelectMark(f.transform.ref,!0)}})}unregister(){this.ctx.managers.interactivity.lociSelects.removeProvider(this.lociMarkProvider)}constructor(e,t){super(e,t),this.lociMarkProvider=(n,r)=>{!this.ctx.canvas3d||!this.params.mark||this.ctx.canvas3d.mark({loci:n.loci},r)},this.spine=new TD.Impl(e.state.data.cells)}},params:()=>Jft,display:{name:"Select Loci on Canvas"}}),ept=ii.create({name:"default-loci-label-provider",category:"interaction",ctor:class{register(){this.ctx.managers.lociLabels.addProvider(this.f)}unregister(){this.ctx.managers.lociLabels.removeProvider(this.f)}constructor(e){this.ctx=e,this.f={label:t=>{const n=[];if(Me.is(t)){const r=new Set;for(const{unit:i}of t.elements){const o=dt.create(t.structure,i,i.elements[0]),s=Je.entity.pdbx_description(o).join(", ");r.add(s)}1===r.size&&r.forEach(i=>n.push(i))}return n.push(L_(t)),n.filter(r=>!!r).join("</br>")},group:t=>t.toString().replace(/Model [0-9]+/g,"Models"),priority:100}}},display:{name:"Provide Default Loci Label"}}),$0e={clickFocus:Ut([Q_(Z_.Flag.Primary,rv.create())],"Representation Focus","Click element using ${triggers}"),clickFocusAdd:Ut([Q_(Z_.Flag.Primary,rv.create({shift:!0}))],"Representation Focus Add","Click element using ${triggers}"),clickFocusSelectMode:Ut([],"Representation Focus","Click element using ${triggers}"),clickFocusAddSelectMode:Ut([],"Representation Focus Add","Click element using ${triggers}")},tpt={bindings:I.Value($0e,{isHidden:!0})},OF=ii.create({name:"representation-focus-loci",category:"interaction",ctor:class extends ii.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:n})=>{var r,i,o,s,a;const{clickFocus:l,clickFocusAdd:c,clickFocusSelectMode:u,clickFocusAddSelectMode:d}=this.params.bindings,p=Ut.match(this.ctx.selectionMode?u:l,t,n),m=null!==(s=null===(o=null===(i=null===(r=e.repr)||void 0===r?void 0:r.props)||void 0===i?void 0:i.snapshotKey)||void 0===o?void 0:o.trim())&&void 0!==s?s:"";if(!this.ctx.selectionMode&&p&&m)return void this.ctx.managers.snapshot.applyKey(m);const{granularity:h}=this.ctx.managers.interactivity.props;if("residue"!==h&&"element"!==h)return;const y=Ut.match(this.ctx.selectionMode?d:c,t,n);if(!p&&!y)return;const v=Yn.normalize(e.loci,"residue"),x=this.ctx.managers.structure.focus.current;if(x&&Yn.areEqual(x.loci,v))this.ctx.managers.structure.focus.clear();else if(p)this.ctx.managers.structure.focus.setFromLoci(v);else{this.ctx.managers.structure.focus.addFromLoci(v);const _=null===(a=this.ctx.managers.structure.focus.current)||void 0===a?void 0:a.loci;_&&this.ctx.managers.camera.focusLoci(_)}})}},params:()=>tpt,display:{name:"Representation Focus Loci on Canvas"}}),Dg=es,nm=Rf,Pg=Ut.Trigger,BF=Ut.TriggerKey,Vq=Ut([Pg(Dg.Flag.Primary,nm.create()),Pg(Dg.Flag.Secondary,nm.create()),Pg(Dg.Flag.Primary,nm.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),Hq=Ut([Pg(Dg.Flag.Secondary,nm.create()),Pg(Dg.Flag.Primary,nm.create({control:!0}))],"Reset camera focus","Click on nothing using ${triggers}"),Y0e={clickCenterFocus:Ut([Pg(Dg.Flag.Primary,nm.create()),Pg(Dg.Flag.Secondary,nm.create()),Pg(Dg.Flag.Primary,nm.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickCenterFocusSelectMode:Ut([Pg(Dg.Flag.Secondary,nm.create()),Pg(Dg.Flag.Primary,nm.create({control:!0}))],"Camera center and focus","Click element using ${triggers}"),clickResetCameraOnEmpty:Vq,clickResetCameraOnEmptySelectMode:Hq},npt={minRadius:I.Numeric(8,{min:1,max:50,step:1}),extraRadius:I.Numeric(4,{min:1,max:50,step:1},{description:"Value added to the bounding-sphere radius of the Loci"}),durationMs:I.Numeric(250,{min:0,max:1e3,step:1},{description:"Camera transition duration"}),bindings:I.Value(Y0e,{isHidden:!0})},rpt=ii.create({name:"camera-focus-loci",category:"interaction",ctor:class extends ii.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:e,button:t,modifiers:n})=>{var r,i;if(!this.ctx.canvas3d)return;const o=this.ctx.selectionMode?this.params.bindings.clickCenterFocusSelectMode:this.params.bindings.clickCenterFocus,s=this.ctx.selectionMode?null!==(r=this.params.bindings.clickResetCameraOnEmptySelectMode)&&void 0!==r?r:Hq:null!==(i=this.params.bindings.clickResetCameraOnEmpty)&&void 0!==i?i:Vq;if(Yn.isEmpty(e.loci)&&Ut.match(s,t,n))jt.Camera.Reset(this.ctx,{});else if(Ut.match(o,t,n)){const a=Yn.normalize(e.loci,this.ctx.managers.interactivity.props.granularity);this.ctx.managers.camera.focusLoci(a,this.params)}})}},params:()=>npt,display:{name:"Camera Focus Loci on Canvas"}}),ipt=ii.create({name:"camera-axis-helper",category:"interaction",ctor:class extends ii.Handler{register(){let e=Ei.None,t=0;this.subscribeObservable(this.ctx.behaviors.interaction.click,({current:n})=>{if(!this.ctx.canvas3d||!Nq(n.loci))return;const r=n.loci.elements[0].groupId;if(r===Ei.None)return e=Ei.None,void(t=0);const{camera:i}=this.ctx.canvas3d;let o,s;if(r>=Ei.X&&r<=Ei.Z){e=Ei.None,t=0;const a=C.sub(C(),i.target,i.position),l=C.cross(C(),a,i.up);s=C(),s[r-1]=1,o=C.cross(C(),s,l),0===C.magnitude(o)&&(o=a)}else e===r?t=(t+1)%2:(e=r,t=0),r===Ei.XY?(s=t?C.unitX:C.unitY,o=C.negUnitZ):r===Ei.XZ?(s=t?C.unitX:C.unitZ,o=C.negUnitY):(s=t?C.unitY:C.unitZ,o=C.negUnitX);this.ctx.canvas3d.requestCameraReset({snapshot:(a,l)=>l.getInvariantFocus(a.boundingSphereVisible.center,a.boundingSphereVisible.radius,s,o)})})}},params:()=>({}),display:{name:"Camera Axis Helper"}}),X0e={keySpinAnimation:Ut([BF("I")],"Spin Animation","Press ${triggers}"),keyRockAnimation:Ut([BF("O")],"Rock Animation","Press ${triggers}"),keyToggleFlyMode:Ut([BF("Space",nm.create({shift:!0}))],"Toggle Fly Mode","Press ${triggers}"),keyResetView:Ut([BF("T")],"Reset View","Press ${triggers}")},opt={bindings:I.Value(X0e,{isHidden:!0})},spt=ii.create({name:"camera-controls",category:"interaction",ctor:class extends ii.Handler{register(){this.subscribeObservable(this.ctx.behaviors.interaction.key,({code:e,key:t,modifiers:n})=>{var r;if(!this.ctx.canvas3d)return;const i={...X0e,...this.params.bindings},o=this.ctx.canvas3d.props.trackball;if(Ut.matchKey(i.keySpinAnimation,e,n,t)){const s="spin"!==o.animate.name?"spin":"off";this.ctx.canvas3d.setProps("off"===s?{trackball:{animate:{name:s,params:{}}}}:{trackball:{animate:{name:s,params:{speed:1}}}})}if(Ut.matchKey(i.keyRockAnimation,e,n,t)){const s="rock"!==o.animate.name?"rock":"off";this.ctx.canvas3d.setProps("off"===s?{trackball:{animate:{name:s,params:{}}}}:{trackball:{animate:{name:s,params:{speed:.3,angle:10}}}})}if(Ut.matchKey(i.keyToggleFlyMode,e,n,t)){const s=!o.flyMode;this.ctx.canvas3d.setProps({trackball:{flyMode:s}}),null!==(r=this.ctx.canvas3dContext)&&void 0!==r&&r.canvas&&(this.ctx.canvas3dContext.canvas.style.cursor=s?"crosshair":"unset")}Ut.matchKey(i.keyResetView,e,n,t)&&jt.Camera.Reset(this.ctx,{})})}},params:()=>opt,display:{name:"Camera Controls on Canvas"}}),apt=ii.create({name:"structure-info-prop",category:"custom-props",display:{name:"Structure Info"},ctor:class extends ii.Handler{get maxModelIndex(){var e,t;let n=-1;const r=this.ctx.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Model));for(const i of r){const o=(null===(e=i.obj)||void 0===e?void 0:e.data)&&Sn.Index.get(null===(t=i.obj)||void 0===t?void 0:t.data).value;void 0!==o&&o>n&&(n=o)}return n}get maxStructureIndex(){var e,t;let n=-1;const r=this.ctx.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Structure));for(const i of r){const o=(null===(e=i.obj)||void 0===e?void 0:e.data)&&Xe.Index.get(null===(t=i.obj)||void 0===t?void 0:t.data).value;void 0!==o&&o>n&&(n=o)}return n}get asymIdOffset(){var e;let t=0,n=0;const r=this.ctx.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Model));for(const i of r){const o=null===(e=i.obj)||void 0===e?void 0:e.data;if(o){const s=Sn.AsymIdCount.get(o),a=Sn.AsymIdOffset.get(o).value;void 0!==s&&void 0!==a&&(t=Math.max(t,a.auth+s.auth),n=Math.max(n,a.label+s.label))}}return{auth:t,label:n}}setModelMaxIndex(){var e;const t=this.maxModelIndex,n=this.ctx.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Model));for(const r of n){const i=null===(e=r.obj)||void 0===e?void 0:e.data;i&&Sn.MaxIndex.get(i).value!==t&&Sn.MaxIndex.set(i,{value:t},t)}}setStructureMaxIndex(){var e;const t=this.maxModelIndex,n=this.ctx.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Structure));for(const r of n){const i=null===(e=r.obj)||void 0===e?void 0:e.data;i&&Xe.MaxIndex.get(i).value!==t&&Xe.MaxIndex.set(i,{value:t},t)}}handleModel(e,t){if(void 0===Sn.Index.get(e).value){const r=(t&&Sn.Index.get(t).value)??this.maxModelIndex+1;Sn.Index.set(e,{value:r},r)}if(void 0===Sn.AsymIdOffset.get(e).value){const r=(t&&Sn.AsymIdOffset.get(t).value)??{...this.asymIdOffset};Sn.AsymIdOffset.set(e,{value:r},r)}}handleStructure(e,t){if(void 0!==e.parent||void 0!==Xe.Index.get(e).value)return;const r=(t&&Xe.Index.get(t).value)??this.maxStructureIndex+1;Xe.Index.set(e,{value:r},r)}handle(e,t,n){Se.Molecule.Structure.is(t)?!this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator&&void 0===t.data.parent&&this.handleStructure(t.data,n?.data):Se.Molecule.Model.is(t)&&(this.ctx.state.data.tree.transforms.get(e).transformer.definition.isDecorator||this.handleModel(t.data,n?.data))}register(){this.ctx.customModelProperties.register(Sn.AsymIdOffset,!0),this.ctx.customModelProperties.register(Sn.Index,!0),this.ctx.customModelProperties.register(Sn.MaxIndex,!0),this.ctx.customStructureProperties.register(Xe.Index,!0),this.ctx.customStructureProperties.register(Xe.MaxIndex,!0),this.subscribeObservable(this.ctx.state.data.events.object.created,e=>{this.handle(e.ref,e.obj),this.setModelMaxIndex(),this.setStructureMaxIndex()}),this.subscribeObservable(this.ctx.state.data.events.object.updated,e=>{this.handle(e.ref,e.obj,e.oldObj)})}unregister(){this.ctx.customModelProperties.unregister(Sn.AsymIdOffset.descriptor.name),this.ctx.customModelProperties.unregister(Sn.Index.descriptor.name),this.ctx.customModelProperties.unregister(Sn.MaxIndex.descriptor.name),this.ctx.customStructureProperties.unregister(Xe.Index.descriptor.name),this.ctx.customStructureProperties.unregister(Xe.MaxIndex.descriptor.name)}}}),iv=[-1,1.76,1.87,1.65,1.5,1.4,1.85,1.8,1.6,1.4],K0e={ALA:121,ARG:265,ASN:187,ASP:187,CYS:148,GLU:214,GLN:214,GLY:97,HIS:216,ILE:195,LEU:191,LYS:230,MET:203,PHE:228,PRO:154,SER:143,THR:163,TRP:264,TYR:255,VAL:165};function upt(e,t,n){switch(t){case"O":return 5;case"S":return 6;case"N":return"NZ"===e?4:3;case"C":switch(e){case"C":case"CE1":case"CE2":case"CE3":case"CH2":case"CZ":case"CZ2":case"CZ3":return 1;case"CA":case"CB":case"CE":case"CG1":case"CG2":return 2;default:switch(n){case"PHE":case"TRP":case"TYR":case"HIS":case"ASP":case"ASN":return 1;case"PRO":case"LYS":case"ARG":case"MET":case"ILE":case"LEU":return 2;case"GLU":case"GLN":return"CD"===e?1:2}}}return Gq(t)}function dpt(e,t,n){switch(t){case"C":return 7;case"N":return 8;case"P":return 9;case"O":return 5}return Gq(t)}function Gq(e){const t=B3(e);let n=iv.indexOf(t);return-1===n&&(n=iv.length,iv[n]=t),n}function qq(){return qq=le(function*(e,t){const{atomRadiusType:n}=t;for(let r=0;r<n.length;r+=5e3)e.shouldUpdate&&(yield e.update({message:"Computing per residue surface accessibility...",current:r,max:n.length})),ppt(t,r,Math.min(r+5e3,n.length))}),qq.apply(this,arguments)}function ppt(e,t,n){const{structure:r,atomRadiusType:i,serialResidueIndex:o,area:s,spherePoints:a,scalingConstant:l,maxLookupRadius:c,probeSize:u}=e,{lookup3d:d,serialMapping:f,unitIndexMap:p,units:m}=r,{cumulativeUnitElementCount:h,elementIndices:g,unitIndices:y}=f;for(let v=t;v<n;++v){const x=iv[i[v]];if(x===iv[0])continue;const _=m[y[v]],w=g[v],A=_.conformation.x(w),M=_.conformation.y(w),E=_.conformation.z(w),{count:D,units:T,indices:F,squaredDistances:R}=d.find(A,M,E,c),N=u+x,j=u+N,W=[];for(let $=0;$<D;++$){const V=T[$],X=h[p.get(V.id)]+F[$],oe=iv[i[X]];if(_===V&&w===g[X]||oe===iv[0])continue;const te=u+oe;if(R[$]<(j+oe)*(j+oe)){const K=g[X];W[W.length]=[R[$],(R[$]+N*N-te*te)/(2*N),V.conformation.x(K)-A,V.conformation.y(K)-M,V.conformation.z(K)-E]}}W.sort(($,V)=>$[0]-V[0]);let z=0;e:for(let $=0;$<a.length;++$){const[V,X,H]=a[$];for(let oe=0;oe<W.length;++oe){const[,te,K,Q,G]=W[oe];if(V*K+X*Q+H*G>te)continue e}++z}s[o[v]]+=l*z*N*N}}const Q0e={numberOfSpherePoints:I.Numeric(92,{min:12,max:360,step:1},{description:"Number of sphere points to sample per atom: 92 (original paper), 960 (BioJava), 3000 (EPPIC) - see Shrake A, Rupley JA: Environment and exposure to solvent of protein atoms. Lysozyme and insulin. J Mol Biol 1973."}),probeSize:I.Numeric(1.4,{min:.1,max:4,step:.01},{description:"Corresponds to the size of a water molecule: 1.4 (original paper), 1.5 (occassionally used)"}),nonPolymer:I.Boolean(!1,{description:"Include non-polymer atoms as occluders."}),traceOnly:I.Boolean(!1,{description:"Compute only using alpha-carbons, if true increase probeSize accordingly (e.g., 4 A). Considers only canonical amino acids."})};var IA;!function(e){function r(){return r=le(function*(u,d,f){const p=function i(u,d){const{elementCount:f,atomicResidueCount:p}=u,{probeSize:m,nonPolymer:h,traceOnly:g,numberOfSpherePoints:y}=d;return{structure:u,probeSize:m,nonPolymer:h,traceOnly:g,spherePoints:o(y),scalingConstant:4*Math.PI/y,maxLookupRadius:2*d.probeSize+2*iv[2],atomRadiusType:new Int8Array(f),serialResidueIndex:new Int32Array(f),area:new Float32Array(p)}}(d,f);(function cpt(e){const{key:t}=Je.residue,{type_symbol:n,label_atom_id:r,label_comp_id:i}=Je.atom,{structure:o,atomRadiusType:s,serialResidueIndex:a}=e,l=dt.create(o);let c=0,u=0,d=-1;l.structure=o;for(let f=0,p=0,m=o.units.length;f<m;++f){const h=o.units[f],{elements:g}=h;l.unit=h,c=-1;for(let y=0,v=g.length;y<v;++y){const x=g[y],_=p+y;l.element=x,u=t(l),c!==u&&++d,c=u;const w=n(l);if(K0(ig(w))){s[_]=0,a[_]=-1;continue}const M=r(l),E=gz(h,x);if(2===E||!e.nonPolymer&&!QR(E)){s[_]=0,a[_]=-1;continue}const D=i(l);!e.traceOnly||("CA"===M||"BB"===M)&&K0e[D]?(s[_]=Fu(E)?dpt(0,w):5===E?upt(M,w,D):Gq(w),a[_]=d):(s[_]=0,a[_]=d)}p+=g.length}})(p),yield function fpt(e,t){return qq.apply(this,arguments)}(u,p);const{area:m,serialResidueIndex:h}=p;return{area:m,serialResidueIndex:h}}),r.apply(this,arguments)}function o(u){const d=[],f=Math.PI*(3-Math.sqrt(5)),p=2/u;for(let m=0;m<u;++m){const h=m*p-1+p/2,g=Math.sqrt(1-h*h),y=m*f;d[d.length]=C.create(Math.cos(y)*g,h,Math.sin(y)*g)}return d}function s(u,d){return d/(K0e[u]||121)}function a(u,d){const{area:f,serialResidueIndex:p}=d,m=p[rt.indexOf(rt.ofSortedArray(u.structure.root.serialMapping.elementIndices),u.element)];return-1===m?-1:f[m]}function l(u,d){const f=a(u,d);return-1===f?-1:s(Je.atom.label_comp_id(u),f)}e.compute=function t(u,d={}){const f={...I.getDefaultValues(Q0e),...d};return Ke.create("Compute Accessible Surface Area",function(){var p=le(function*(m){return yield function n(u,d,f){return r.apply(this,arguments)}(m,u,f)});return function(m){return p.apply(this,arguments)}}())},e.Flag={NA:0,Buried:1,Accessible:2},e.normalize=s,e.getValue=a,e.getNormalizedValue=l,e.getFlag=function c(u,d){const f=l(u,d);return-1===f?0:f<.16?1:2}}(IA||(IA={}));const Wq={...Q0e},$q={isBuried:iA.Dynamic(ese("computed","accessible-surface-area.is-buried",Oe.Bool),e=>{if(!ze.isAtomic(e.element.unit))return!1;const t=Vp.get(e.element.structure).value;return!!t&&1===IA.getFlag(e.element,t)}),isAccessible:iA.Dynamic(ese("computed","accessible-surface-area.is-accessible",Oe.Bool),e=>{if(!ze.isAtomic(e.element.unit))return!1;const t=Vp.get(e.element.structure).value;return!!t&&2===IA.getFlag(e.element,t)})},Vp=iy.createProvider({label:"Accessible Surface Area",descriptor:hf({name:"molstar_accessible_surface_area",symbols:$q}),type:"root",defaultParams:Wq,getParams:e=>Wq,isApplicable:e=>!0,obtain:function(){var e=le(function*(t,n,r){const i={...I.getDefaultValues(Wq),...r};return{value:yield IA.compute(n,i).runInContext(t.runtime)}});return function(n,r,i){return e.apply(this,arguments)}}()}),Yq=st(16448250),J0e={list:I.ColorList("rainbow",{presetKind:"scale"})},tye={name:"accessible-surface-area",label:"Accessible Surface Area",category:Rd.Category.Residue,factory:function eye(e,t){let n;const r=up.create({listOrName:t.list.colors,minLabel:"buried",maxLabel:"exposed",domain:[0,1]}),i=e.structure&&Vp.get(e.structure),o=i?Yx(i.id,i.version):-1;if(i?.value&&e.structure){const s=dt.create(e.structure),a=i.value,l=c=>{const u=IA.getNormalizedValue(c,a);return-1===u?Yq:r.color(u)};n=c=>dt.is(c)&&ze.isAtomic(c.unit)?l(c):fn.isLocation(c)?(s.unit=c.aUnit,s.element=c.aUnit.elements[c.aIndex],l(s)):Yq}else n=()=>Yq;return{factory:eye,granularity:"group",preferSmoothing:!0,color:n,props:t,contextHash:o,description:"Assigns a color based on the relative accessible surface area of a residue.",legend:r?r.legend:void 0}},getParams:function mpt(e){return J0e},defaultValues:I.getDefaultValues(J0e),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?Vp.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Vp.ref(e.structure,!1)}},gpt=ii.create({name:"computed-accessible-surface-area-prop",category:"custom-props",display:{name:"Accessible Surface Area"},ctor:class extends ii.Handler{constructor(){super(...arguments),this.provider=Vp,this.labelProvider={label:e=>{if(this.params.showTooltip)return function ypt(e){if("element-loci"===e.kind){if(0===e.elements.length)return;const t=Vp.get(e.structure).value;if(!t||e.structure.customPropertyDescriptors.hasReference(Vp.descriptor))return;const{getSerialIndex:n}=e.structure.root.serialMapping,{area:r,serialResidueIndex:i}=t,o=new Set;let s=0;for(const{indices:l,unit:c}of e.elements){const{elements:u}=c;Ve.forEach(l,d=>{const f=i[n(c,u[d])];-1!==f&&!o.has(f)&&(s+=r[f],o.add(f))})}return 0===o.size?void 0:`Accessible Surface Area <small>(${o.size} ${o.size>1?"Residues sum":"Residue"})</small>: ${s.toFixed(2)} \u212b<sup>2</sup>`}if("structure-loci"===e.kind){const t=Vp.get(e.structure).value;return!t||e.structure.customPropertyDescriptors.hasReference(Vp.descriptor)?void 0:`Accessible Surface Area <small>(Whole Structure)</small>: ${foe(t.area).toFixed(2)} \u212b<sup>2</sup>`}}(e)}}}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){UN.addCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(tye),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.query.structure.registry.add(nye),this.ctx.query.structure.registry.add(rye)}unregister(){UN.removeCustomProp(this.provider.descriptor),this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(tye),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.query.structure.registry.remove(nye),this.ctx.query.structure.registry.remove(rye)}},params:()=>({autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)})}),nye=hi("Buried Protein Residues",pe.struct.modifier.union([pe.struct.modifier.wholeResidues([pe.struct.modifier.union([pe.struct.generator.atomGroups({"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":$q.isBuried.symbol()})])])]),{description:"Select buried protein residues.",category:yi.Residue,ensureCustomProperties:(e,t)=>Vp.attach(e,t)}),rye=hi("Accessible Protein Residues",pe.struct.modifier.union([pe.struct.modifier.wholeResidues([pe.struct.modifier.union([pe.struct.generator.atomGroups({"chain-test":pe.core.rel.eq([pe.ammp("objectPrimitive"),"atomistic"]),"residue-test":$q.isAccessible.symbol()})])])]),{description:"Select accessible protein residues.",category:yi.Residue,ensureCustomProperties:(e,t)=>Vp.attach(e,t)});function ui(e,t){return e.model.atomicHierarchy.atoms.type_symbol.value(e.elements[t])}function iye(e,t){return e.model.atomicHierarchy.atoms.pdbx_formal_charge.value(e.elements[t])}function TP(e,t){return e.model.atomicHierarchy.atoms.label_atom_id.value(e.elements[t])}function LF(e,t){return e.model.atomicHierarchy.atoms.label_alt_id.value(e.elements[t])}function Xq(e,t){return e.model.atomicHierarchy.atoms.label_comp_id.value(e.elements[t])}function kg(e,t,n){return function bpt(e,t,n){let r=0;const i=e.interUnitBonds.getEdgeIndices(n,t.id);for(let o=0,s=i.length;o<s;++o)Lr.isCovalent(e.interUnitBonds.edges[i[o]].props.flag)&&(r+=1);return r}(e,t,n)+function vpt(e,t){let n=0;const{offset:r,edgeProps:{flags:i}}=e.bonds;for(let o=r[t],s=r[t+1];o<s;++o)Lr.isCovalent(i[o])&&(n+=1);return n}(t,n)}function Qu(e,t,n,r){let i=0;return Ju(e,t,n,(o,s)=>{ui(o,s)===r&&(i+=1)}),i}function Kq(e,t,n){const{offset:r,b:i,edgeProps:{flags:o}}=e.bonds;for(let s=r[t],a=r[t+1];s<a;++s)Lr.isCovalent(o[s])&&n(e,i[s])}function Ju(e,t,n,r){(function Cpt(e,t,n,r){const i=e.interUnitBonds.getEdgeIndices(n,t.id);for(let o=0,s=i.length;o<s;++o){const a=e.interUnitBonds.edges[i[o]],l=e.unitMap.get(a.unitB);Lr.isCovalent(a.props.flag)&&r(l,a.indexB)}})(e,t,n,r),Kq(t,n,r)}var Wo=function(e){return e[e.Spherical=0]="Spherical",e[e.Terminal=1]="Terminal",e[e.Linear=2]="Linear",e[e.Trigonal=3]="Trigonal",e[e.Tetrahedral=4]="Tetrahedral",e[e.TrigonalBiPyramidal=5]="TrigonalBiPyramidal",e[e.Octahedral=6]="Octahedral",e[e.SquarePlanar=7]="SquarePlanar",e[e.Unknown=8]="Unknown",e}(Wo||{});function wpt(e){switch(e){case Wo.Spherical:return"Spherical";case Wo.Terminal:return"Terminal";case Wo.Linear:return"Linear";case Wo.Trigonal:return"Trigonal";case Wo.Tetrahedral:return"Tetrahedral";case Wo.TrigonalBiPyramidal:return"Trigonal Bi-Pyramidal";case Wo.Octahedral:return"Octahedral";case Wo.SquarePlanar:return"Square Planar";case Wo.Unknown:return"Unknown"}}function EA(e){switch(e){case 0:return Wo.Spherical;case 1:return Wo.Terminal;case 2:return Wo.Linear;case 3:return Wo.Trigonal;case 4:return Wo.Tetrahedral;default:return Wo.Unknown}}const oye=new Map([[Wo.Linear,Xr(180)],[Wo.Trigonal,Xr(120)],[Wo.Tetrahedral,Xr(109.4721)],[Wo.Octahedral,Xr(90)]]),jF=C(),UF=C(),J_=C(),zF=C(),TA=C();function VF(e,t,n,r,i){const o=[];return t.conformation.position(t.elements[n],J_),r.conformation.position(r.elements[i],zF),C.sub(jF,zF,J_),Ju(e,t,n,(s,a)=>{"H"!==ui(s,a)&&(s.conformation.position(s.elements[a],TA),C.sub(UF,TA,J_),o.push(C.angle(jF,UF)))}),o}function sye(e,t,n,r,i){t.conformation.position(t.elements[n],J_),r.conformation.position(r.elements[i],zF),C.sub(jF,zF,J_);const o=[C(),C()];let a,l,s=0;if(Ju(e,t,n,(c,u)=>{s>1||"H"!==ui(c,u)&&(a=c,l=u,c.conformation.position(c.elements[u],TA),C.sub(o[s++],TA,J_))}),1===s&&a&&l&&Ju(e,a,l,(c,u)=>{s>1||c===t&&u===n||"H"!==ui(c,u)&&(c.conformation.position(c.elements[u],TA),C.sub(o[s++],TA,J_))}),2===s)return C.cross(UF,o[0],o[1]),Math.abs(Math.PI/2-C.angle(UF,jF))}const Zq=new fn.ElementBondIterator,Qq=new fn.ElementBondIterator,DA=new fn.ElementBondIterator,Jq=new fn.ElementBondIterator;function Ept(e,t,n,r){const i=Qu(e,t,n,"H"),o=ui(t,n);let s=iye(t,n);const a="always"===r.assignCharge||"auto"===r.assignCharge&&0===s,l="always"===r.assignH||"auto"===r.assignH&&0===i,c=kg(e,t,n),u=function Ipt(e,t,n){let r=0;const{offset:i,edgeProps:{flags:o,order:s}}=t.bonds;for(let a=i[n],l=i[n+1];a<l;++a)Lr.isCovalent(o[a])&&(r+=s[a]);return e.interUnitBonds.getEdgeIndices(n,t.id).forEach(a=>{const l=e.interUnitBonds.edges[a];Lr.isCovalent(l.props.flag)&&(r+=l.props.order)}),r}(e,t,n),d=function Apt(e,t,n){const r=ui(t,n),i="O"===r||"N"===r;if(i&&4===kg(e,t,n))return!1;for(Zq.setElement(e,t,n);Zq.hasNext;){const o=Zq.move();if(o.order>1)return!0;if(i){const s=ui(o.otherUnit,o.otherIndex);for(Qq.setElement(e,o.otherUnit,o.otherIndex);Qq.hasNext;){const a=Qq.move();if(a.order>1){if(("P"===s||"S"===s)&&"O"===ui(a.otherUnit,a.otherIndex))continue;return!0}}}}return!1}(e,t,n),f=u-c>0;let p=0,m=Wo.Unknown;switch(o){case"H":a&&(0===c?(s=1,m=Wo.Spherical):1===c&&(s=0,m=Wo.Terminal));break;case"C":a&&(s=0),l&&(p=Math.max(0,4-u-Math.abs(s))),m=EA(c+p+Math.max(0,-s));break;case"N":if(a)if(l)if(d&&u<4)s=c-i==1&&u-i==2?1:0;else for(DA.setElement(e,t,n);DA.hasNext;){const h=DA.move(),g=ui(h.otherUnit,h.otherIndex);if("S"===g||qJe(g)){s=0;break}s=1}else s=u-3;l&&(p=Math.max(0,3-u+s)),m=EA(d&&!f?c+p-s:c+p+1-s);break;case"O":if(a&&(l||(s=u-2),1===u)){DA.setElement(e,t,n);e:for(;DA.hasNext;){const h=DA.move();for(Jq.setElement(e,h.otherUnit,h.otherIndex);Jq.hasNext;){const g=Jq.move();if((g.otherUnit!==t||g.otherIndex!==n)&&"O"===ui(g.otherUnit,g.otherIndex)&&2===g.order){s=-1;break e}}}}l&&(p=Math.max(0,2-u+s)),m=EA(d&&!f?c+p-s+1:c+p-s+2);break;case"S":a&&(l||(s=u<=3&&0===Qu(e,t,n,"O")?u-2:0)),l&&u<2&&(p=Math.max(0,2-u+s)),u<=3&&(m=EA(c+p-s+2));break;case"F":case"CL":case"BR":case"I":case"AT":a&&(s=u-1);break;case"LI":case"NA":case"K":case"RB":case"CS":case"FR":a&&(s=1-u);break;case"BE":case"MG":case"CA":case"SR":case"BA":case"RA":a&&(s=2-u);break;default:$n&&console.warn("Requested charge, protonation for an unhandled element",o)}return[s,p,p+i,m]}function Tpt(e,t,n){const r=t.elements.length,i=new Int8Array(r),o=new Int8Array(r),s=new Int8Array(r),a=new Int8Array(r),l=!!e.parent;let c;if(l){const u=e.root.unitMap.get(t.id);if(c=rt.indicesOf(u.elements,t.elements),c.length!==t.elements.length)throw new Error("expected to find an index for every element");t=u,e=e.root}for(let u=0;u<r;++u){const d=l?c[u]:u,[f,p,m,h]=Ept(e,t,d,n);i[u]=f,o[u]=p,s[u]=m,a[u]=h}return{charge:i,implicitH:o,totalH:s,idealGeometry:a}}const aye={assignCharge:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]]),assignH:I.Select("auto",[["always","always"],["auto","auto"],["never","never"]])};function Dpt(e,t,n){return eW.apply(this,arguments)}function eW(){return(eW=le(function*(e,t,n){const r={...I.getDefaultValues(aye),...n},i=new Map;for(let o=0,s=t.units.length;o<s;++o){const a=t.units[o];if(ze.isAtomic(a)){const l=Tpt(t,a,r);i.set(a.id,l)}}return i})).apply(this,arguments)}const tW={...aye},DP=iy.createProvider({label:"Valence Model",descriptor:hf({name:"molstar_computed_valence_model"}),type:"local",defaultParams:tW,getParams:e=>tW,isApplicable:e=>!0,obtain:function(){var e=le(function*(t,n,r){const i={...I.getDefaultValues(tW),...r};return{value:yield Dpt(t.runtime,n,i)}});return function(n,r,i){return e.apply(this,arguments)}}()});var $o,nW,rW;!function(e){function n(d,f){const p=new Int32Array(f+1),m=new Int32Array(f),h=new Int32Array(f),{members:g,count:y,offsets:v}=d;for(let w=0,A=v[y];w<A;++w)++h[g[w]];let x=0;for(let w=0;w<f;w++)p[w]=x,x+=h[w];p[f]=x;const _=new Int32Array(x);for(let w=0;w<y;++w)for(let A=v[w],M=v[w+1];A<M;++A){const E=g[A];_[p[E]+m[E]]=w,++m[E]}return{indices:_,offsets:p}}function i(d,f){let p;const{count:m,types:h}=d,g=[];for(let v=0;v<m;++v)f.has(h[v])&&g.push(v);const y=rt.ofSortedArray(g);return{indices:y,get lookup3d(){if(!p){const v={x:d.x,y:d.y,z:d.z,indices:y};p=zh(v,Q0(v))}return p}}}e.setPosition=function t(d,f,p,m){return C.set(d,m.x[p],m.y[p],m.z[p]),C.transformMat4(d,d,f.conformation.operator.matrix),d},e.createElementsIndex=n,e.create=function r(d,f){let p,m;return{...f,get lookup3d(){if(!p){const h={x:f.x,y:f.y,z:f.z,indices:Ve.ofBounds(0,f.count)};p=zh(h,Q0(h))}return p},get elementsIndex(){return m||(m=n(f,d))},subset:h=>i(f,h)}},e.createSubset=i,e.Info=function o(d,f,p){const m=DP.get(d).value;if(!m||!m.has(f.id))throw new Error("valence model required");return{unit:f,types:p.types,feature:-1,x:p.x,y:p.y,z:p.z,members:p.members,offsets:p.offsets,idealGeometry:m.get(f.id).idealGeometry}},e.position=function s(d,f){return C.set(d,f.x[f.feature],f.y[f.feature],f.z[f.feature]),C.transformMat4(d,d,f.unit.conformation.operator.matrix),d};const a=C(),l=C();e.distance=function c(d,f){const m=f.members[f.offsets[f.feature]];return d.unit.conformation.position(d.unit.elements[d.members[d.offsets[d.feature]]],a),f.unit.conformation.position(f.unit.elements[m],l),C.distance(a,l)},e.Provider=function u(d,f){return{types:new Set(d),add:f}}}($o||($o={})),function(e){e.create=function t(n=2048,r=1024,i){const o=tt.create(Float32Array,1,r,i?i.x:n),s=tt.create(Float32Array,1,r,i?i.y:n),a=tt.create(Float32Array,1,r,i?i.z:n),l=tt.create(Uint8Array,1,r,i?i.types:n),c=tt.create(Uint8Array,1,r,i?i.groups:n),u=tt.create(Uint32Array,1,r,i?i.offsets:n),d=tt.create(Uint32Array,1,r,i?i.members:n),f={x:0,y:0,z:0,offset:0,count:0};return{startState:()=>{f.x=0,f.y=0,f.z=0,f.offset=d.elementCount,f.count=0},pushMember:(p,m,h,g)=>{tt.add(d,g),f.x+=p,f.y+=m,f.z+=h,f.count+=1},finishState:(p,m)=>{const{count:h}=f;0!==h&&(tt.add(l,p),tt.add(c,m),tt.add(o,f.x/h),tt.add(s,f.y/h),tt.add(a,f.z/h),tt.add(u,f.offset))},add:(p,m,h,g,y,v)=>{tt.add(l,p),tt.add(c,m),tt.add(o,h),tt.add(s,g),tt.add(a,y),tt.add(u,d.elementCount),tt.add(d,v)},getFeatures:p=>{tt.add(u,d.elementCount);const m=tt.compact(o,!0),h=tt.compact(s,!0),g=tt.compact(a,!0);return $o.create(p,{x:m,y:h,z:g,count:o.elementCount,types:tt.compact(l,!0),groups:tt.compact(c,!0),offsets:tt.compact(u,!0),members:tt.compact(d,!0)})}}}}(nW||(nW={})),function(e){e.createElementsIndex=function t(n,r,i){const o=new Int32Array(i+1),s=new Int32Array(i),a=new Int32Array(i),{members:l,offsets:c}=r;for(let f=0,p=2*n.edgeCount;f<p;++f){const m=n.a[f],h=n.b[f];if(!(m>h)){for(let g=c[m],y=c[m+1];g<y;++g)++a[l[g]];for(let g=c[h],y=c[h+1];g<y;++g)++a[l[g]]}}let u=0;for(let f=0;f<i;f++)o[f]=u,u+=a[f];o[i]=u;const d=new Int32Array(u);for(let f=0,p=2*n.edgeCount;f<p;++f){const m=n.a[f],h=n.b[f];if(!(m>h)){for(let g=c[m],y=c[m+1];g<y;++g){const v=l[g];d[o[v]+s[v]]=f,++s[v]}for(let g=c[h],y=c[h+1];g<y;++g){const v=l[g];d[o[v]+s[v]]=f,++s[v]}}}return{indices:d,offsets:o}}}(rW||(rW={}));class Ppt extends dp{getContactIndicesForElement(t,n){return this.elementKeyIndex.get(this.getElementKey(t,n.id))||[]}getElementKey(t,n){return`${t}|${n}`}constructor(t,n){super(t),this.elementKeyIndex=new Map;for(let r=0,i=this.edges.length;r<i;++r){const{unitA:o,indexA:s}=this.edges[r],{offsets:a,members:l}=n.get(o);for(let c=a[s],u=a[s+1];c<u;++c){const d=this.getElementKey(l[c],o),f=this.elementKeyIndex.get(d);void 0===f?this.elementKeyIndex.set(d,[r]):f.push(r)}}}}var Mg=function(e){return e[e.None=0]="None",e[e.Filtered=1]="Filtered",e}(Mg||{}),Er=function(e){return e[e.Unknown=0]="Unknown",e[e.Ionic=1]="Ionic",e[e.CationPi=2]="CationPi",e[e.PiStacking=3]="PiStacking",e[e.HydrogenBond=4]="HydrogenBond",e[e.HalogenBond=5]="HalogenBond",e[e.Hydrophobic=6]="Hydrophobic",e[e.MetalCoordination=7]="MetalCoordination",e[e.WeakHydrogenBond=8]="WeakHydrogenBond",e}(Er||{});function lye(e){switch(e){case Er.HydrogenBond:return"Hydrogen Bond";case Er.Hydrophobic:return"Hydrophobic Contact";case Er.HalogenBond:return"Halogen Bond";case Er.Ionic:return"Ionic Interaction";case Er.MetalCoordination:return"Metal Coordination";case Er.CationPi:return"Cation-Pi Interaction";case Er.PiStacking:return"Pi Stacking";case Er.WeakHydrogenBond:return"Weak Hydrogen Bond";case Er.Unknown:return"Unknown Interaction"}}function Mpt(e){switch(e){case 0:return"None";case 1:return"Positive Charge";case 2:return"Negative Charge";case 3:return"Aromatic Ring";case 4:return"Hydrogen Donor";case 5:return"Hydrogen Acceptor";case 6:return"Halogen Donor";case 7:return"Halogen Acceptor";case 8:return"HydrophobicAtom";case 9:return"Weak Hydrogen Donor";case 10:return"Ionic Type Partner";case 11:return"Dative Bond Partner";case 12:return"Transition Metal";case 13:return"Ionic Type Metal"}}var iW,oW,ki=function(e){return e[e.None=0]="None",e[e.QuaternaryAmine=1]="QuaternaryAmine",e[e.TertiaryAmine=2]="TertiaryAmine",e[e.Sulfonium=3]="Sulfonium",e[e.SulfonicAcid=4]="SulfonicAcid",e[e.Sulfate=5]="Sulfate",e[e.Phosphate=6]="Phosphate",e[e.Halocarbon=7]="Halocarbon",e[e.Guanidine=8]="Guanidine",e[e.Acetamidine=9]="Acetamidine",e[e.Carboxylate=10]="Carboxylate",e}(ki||{});function Rpt(e){switch(e){case ki.None:return"None";case ki.QuaternaryAmine:return"Quaternary Amine";case ki.TertiaryAmine:return"Tertiary Amine";case ki.Sulfonium:return"Sulfonium";case ki.SulfonicAcid:return"Sulfonic Acid";case ki.Sulfate:return"Sulfate";case ki.Phosphate:return"Phosphate";case ki.Halocarbon:return"Halocarbon";case ki.Guanidine:return"Guanidine";case ki.Acetamidine:return"Acetamidine";case ki.Carboxylate:return"Carboxylate"}}!function(e){e.create=function t(n,r){const i=[],o=[],s=[];return{add(a,l,c){i[i.length]=a,o[o.length]=l,s[s.length]=c},getContacts(){const a=new Cd.EdgeBuilder(n.count,i,o),l=new Int8Array(a.slotCount),c=new Int8Array(a.slotCount);for(let p=0,m=a.edgeCount;p<m;p++)a.addNextEdge(),a.assignProperty(l,s[p]);const u=a.createGraph({type:l,flag:c});let d;return Object.defineProperty(u,"elementsIndex",{get:()=>d||(d=rW.createElementsIndex(u,n,r))})}}}}(iW||(iW={})),function(e){e.create=function t(){const n=new dp.Builder;return{startUnitPair(r,i){n.startUnitPair(r.id,i.id)},finishUnitPair(){n.finishUnitPair()},add(r,i,o){n.add(r,i,{type:o,flag:Mg.None})},getContacts:r=>new Ppt(n.getMap(),r)}}}(oW||(oW={}));const Npt={lineOfSightDistFactor:I.Numeric(1,{min:0,max:3,step:.1})},Fpt=3;function cye(e,t,n){const r=t.members[t.offsets[t.feature]],i=n.members[n.offsets[n.feature]];if(r===i&&t.unit===n.unit)return!1;const o=LF(t.unit,r),s=LF(n.unit,i);return!(o&&s&&o!==s||t.unit===n.unit&&t.unit.model.atomicHierarchy.residueAtomSegments.count>1&&t.unit.residueIndex[t.unit.elements[r]]===n.unit.residueIndex[n.unit.elements[i]]||function Spt(e,t,n,r,i){return t===r?function xpt(e,t,n){const{offset:r,b:i,edgeProps:{flags:o}}=e.bonds;for(let s=r[t],a=r[t+1];s<a;++s)if(i[s]===n&&Lr.isCovalent(o[s]))return!0;return!1}(t,n,i):function _pt(e,t,n,r,i){const o=e.interUnitBonds.getEdge(n,t.id,i,r.id);return o&&Lr.isCovalent(o.props.flag)}(e,t,n,r,i)}(e,t.unit,r,n.unit,i))}function uye(e,t,n,r){const i=LF(e,t),o=LF(n,r);return i&&o&&i!==o}function dye(e,t){const{feature:n,offsets:r,members:i}=t;for(let o=r[n],s=r[n+1];o<s;++o)if(i[o]===e)return!0;return!1}const ov=C(),sW=C(),aW=C(),Opt=oae();function fye(e,t,n,r){const s=t.members[t.offsets[t.feature]],a=n.members[n.offsets[n.feature]];$o.position(sW,t),$o.position(aW,n),C.scale(ov,C.add(ov,sW,aW),.5);const l=r*Fpt,{count:c,indices:u,units:d,squaredDistances:f}=e.lookup3d.find(ov[0],ov[1],ov[2],l,Opt);if(0===c)return!0;for(let p=0;p<c;++p){const m=u[p],h=d[p];if(!ze.isAtomic(h))continue;const g=ui(h,m);if("H"===g)continue;const y=B3(g);if(!(y*y*r*r<=f[p]||uye(h,m,t.unit,s)||uye(h,m,n.unit,a)||t.unit===h&&dye(m,t)||n.unit===h&&dye(m,n)||(h.conformation.position(h.elements[m],ov),C.squaredDistance(ov,sW)<1||C.squaredDistance(ov,aW)<1)))return!1}return!0}function Lpt(e,t,n,r,i,o){const{x:s,y:a,z:l}=n,{lookup3d:c,indices:u}=n.subset(i.requiredFeatures),d=$o.Info(e,t,n),f={...d},p=o.lineOfSightDistFactor;for(let m=0,h=Ve.size(u);m<h;++m){const g=Ve.getAt(u,m),{count:y,indices:v,squaredDistances:x}=c.find(s[g],a[g],l[g],i.maxDistance);if(0!==y){d.feature=g;for(let _=0;_<y;++_){const w=Ve.getAt(u,v[_]);if(w<=g||(f.feature=w,!cye(e,d,f)))continue;const A=i.getType(e,d,f,x[_]);A&&fye(e,d,f,p)&&r.add(g,w,A)}}}}const jpt=fe(),zpt={distanceMax:I.Numeric(4,{min:1,max:5,step:.1}),angleMax:I.Numeric(30,{min:0,max:60,step:1})},Vpt=["CL","BR","I","AT"],Gpt=["N","O","S"],qpt=["C","N","P","S"],Ypt=Xr(180),Xpt=Xr(120),Qpt=$o.Provider([6],function Hpt(e,t,n){const{elements:r}=t,{x:i,y:o,z:s}=t.model.atomicConformation;for(let a=0,l=r.length;a<l;++a){const c=ui(t,a);Vpt.includes(c)&&n.add(6,ki.None,i[r[a]],o[r[a]],s[r[a]],a)}}),Jpt=$o.Provider([7],function Wpt(e,t,n){const{elements:r}=t,{x:i,y:o,z:s}=t.model.atomicConformation;for(let a=0,l=r.length;a<l;++a){const c=ui(t,a);if(Gpt.includes(c)){let u=!1;Ju(e,t,a,(d,f)=>{qpt.includes(ui(d,f))&&(u=!0)}),u&&n.add(7,ki.None,i[r[a]],o[r[a]],s[r[a]],a)}}}),eht={name:"halogen-bonds",params:zpt,createTester:e=>{const t=function Kpt(e){return{angleMax:Xr(e.angleMax)}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([6,7]),getType:(n,r,i)=>function Zpt(e,t,n,r){const i=t.types[t.feature];if(!function $pt(e,t){return 7===e&&6===t||6===e&&7===t}(i,n.types[n.feature]))return;const[s,a]=6===i?[t,n]:[n,t],l=s.members[s.offsets[s.feature]],c=a.members[a.offsets[a.feature]],u=VF(e,s.unit,l,a.unit,c);if(1!==u.length||Ypt-u[0]>r.angleMax)return;const d=VF(e,a.unit,c,s.unit,l);return 0===d.length||d.some(f=>Xpt-f>r.angleMax)?void 0:Er.HalogenBond}(n,r,i,t)}}},pye={distanceMax:I.Numeric(3.5,{min:1,max:5,step:.1}),backbone:I.Boolean(!0,{description:"Include backbone-to-backbone hydrogen bonds"}),accAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal acceptor angle"}),donAngleDevMax:I.Numeric(45,{min:0,max:180,step:1},{description:"Max deviation from ideal donor angle"}),accOutOfPlaneAngleMax:I.Numeric(90,{min:0,max:180,step:1}),donOutOfPlaneAngleMax:I.Numeric(45,{min:0,max:180,step:1})},tht={...pye,water:I.Boolean(!1,{description:"Include water-to-water hydrogen bonds"}),sulfurDistanceMax:I.Numeric(4.1,{min:1,max:5,step:.1})},nht={...pye};function lW(e,t){const n=DP.get(e).value;if(!n)throw Error("expected valence model to be available");const r=n.get(t.id);if(!r)throw Error("expected valence model for unit to be available");return r}function oht(e,t){const{elementAromaticRingIndices:n,all:r}=e.rings,i=n.get(t);if(void 0===i)return!1;for(let o=0,s=i.length;o<s;++o){const a=r[i[o]];for(let l=0,c=a.length;l<c;++l){const u=ui(e,a[l]);if("N"===u||"O"===u)return!0}}return!1}function hye(e,t){return 2===e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[t]]]}function mye(e,t){return Y0.has(TP(e,t))}function gye(e,t){return"HIS"===Xq(e,t)&&"N"===ui(e,t)&&function aht(e,t){return e.rings.elementRingIndices.has(t)}(e,t)}function yye(e){return{includeBackbone:e.backbone,maxAccAngleDev:Xr(e.accAngleDevMax),maxDonAngleDev:Xr(e.donAngleDevMax),maxAccOutOfPlaneAngle:Xr(e.accOutOfPlaneAngleMax),maxDonOutOfPlaneAngle:Xr(e.donOutOfPlaneAngleMax)}}const bye=Xr(120);function vye(e,t,n,r){const i=t.members[t.offsets[t.feature]],o=n.members[n.offsets[n.feature]];if(!r.includeBackbone&&function lht(e,t,n,r){return mye(e,t)&&mye(n,r)}(t.unit,i,n.unit,o))return;const s=VF(e,t.unit,i,n.unit,o),a=oye.get(t.idealGeometry[i])||bye;if(s.some(u=>Math.abs(a-u)>r.maxDonAngleDev))return;if(t.idealGeometry[i]===Wo.Trigonal){const u=sye(e,t.unit,i,n.unit,o);if(void 0!==u&&u>r.maxDonOutOfPlaneAngle)return}const l=VF(e,n.unit,o,t.unit,i),c=oye.get(n.idealGeometry[o])||bye;if(!l.some(u=>c-u>r.maxAccAngleDev)){if(n.idealGeometry[o]===Wo.Trigonal){const u=sye(e,n.unit,o,t.unit,i);if(void 0!==u&&u>r.maxAccOutOfPlaneAngle)return}return!0}}const mht=$o.Provider([4],function rht(e,t,n){const{totalH:r}=lW(e,t),{elements:i}=t,{x:o,y:s,z:a}=t.model.atomicConformation;for(let l=0,c=i.length;l<c;++l){const u=ui(t,l);(gye(t,l)||r[l]>0&&("N"===u||"O"===u||"S"===u))&&n.add(4,ki.None,o[i[l]],s[i[l]],a[i[l]],l)}}),ght=$o.Provider([9],function iht(e,t,n){const{totalH:r}=lW(e,t),{elements:i}=t,{x:o,y:s,z:a}=t.model.atomicConformation;for(let l=0,c=i.length;l<c;++l)"C"===ui(t,l)&&r[l]>0&&(Qu(e,t,l,"N")>0||Qu(e,t,l,"O")>0||oht(t,l))&&n.add(9,ki.None,o[i[l]],s[i[l]],a[i[l]],l)}),yht=$o.Provider([5],function sht(e,t,n){const{charge:r,implicitH:i,idealGeometry:o}=lW(e,t),{elements:s}=t,{x:a,y:l,z:c}=t.model.atomicConformation,u=d=>{n.add(5,ki.None,a[s[d]],l[s[d]],c[s[d]],d)};for(let d=0,f=s.length;d<f;++d){const p=ui(t,d);if("O"===p)u(d);else if("N"===p){if(gye(t,d))u(d);else if(r[d]<1){const m=kg(e,t,d)+i[d],h=o[d];(h===Wo.Tetrahedral&&m<4||h===Wo.Trigonal&&m<3||h===Wo.Linear&&m<2)&&u(d)}}else if("S"===p){const m=Xq(t,d);("CYS"===m||"MET"===m||-1===iye(t,d))&&u(d)}}}),bht={name:"hydrogen-bonds",params:tht,createTester:e=>{const t=Math.max(e.distanceMax,e.sulfurDistanceMax),n=function fht(e){return{...yye(e),includeWater:e.water,maxSulfurDistSq:e.sulfurDistanceMax*e.sulfurDistanceMax,maxDistSq:e.distanceMax*e.distanceMax}}(e);return{maxDistance:t,requiredFeatures:new Set([4,5]),getType:(r,i,o,s)=>function pht(e,t,n,r,i){const s=n.types[n.feature];if(!function uht(e,t){return 5===e&&4===t||4===e&&5===t}(t.types[t.feature],s))return;const[a,l]=5===s?[t,n]:[n,t],c=a.members[a.offsets[a.feature]],u=l.members[l.offsets[l.feature]];return r>("S"===ui(a.unit,c)||"S"===ui(l.unit,u)?i.maxSulfurDistSq:i.maxDistSq)||!i.includeWater&&function cht(e,t,n,r){return hye(e,t)&&hye(n,r)}(a.unit,c,l.unit,u)||!vye(e,a,l,i)?void 0:Er.HydrogenBond}(r,i,o,s,n)}}},vht={name:"weak-hydrogen-bonds",params:nht,createTester:e=>{const t=yye(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([9,5]),getType:(n,r,i,o)=>function hht(e,t,n,r,i){const s=n.types[n.feature];if(!function dht(e,t){return 9===e&&5===t||5===e&&9===t}(t.types[t.feature],s))return;const[a,l]=5===s?[t,n]:[n,t];return vye(e,a,l,i)?Er.WeakHydrogenBond:void 0}(n,r,i,0,t)}}};function _ht(e,t,n){return"S"===ui(t,n)&&3===Qu(e,t,n,"O")}function Sht(e,t,n){return"S"===ui(t,n)&&4===Qu(e,t,n,"O")}function _ye(e,t,n){return"P"===ui(t,n)&&Qu(e,t,n,"O")===kg(e,t,n)}function wht(e,t,n){let r=0;return"C"===ui(t,n)&&2===Qu(e,t,n,"O")&&1===Qu(e,t,n,"C")&&Ju(e,t,n,(i,o)=>{"O"===ui(i,o)&&kg(e,i,o)-Qu(e,i,o,"H")==1&&(r+=1)}),2===r}function Aht(e,t,n){let r=0;return"C"===ui(t,n)&&3===kg(e,t,n)&&3===Qu(e,t,n,"N")&&Ju(e,t,n,(i,o)=>{kg(e,i,o)-Qu(e,i,o,"H")==1&&(r+=1)}),2===r}function Iht(e,t,n){let r=0;return"C"===ui(t,n)&&3===kg(e,t,n)&&2===Qu(e,t,n,"N")&&1===Qu(e,t,n,"C")&&Ju(e,t,n,(i,o)=>{kg(e,i,o)-Qu(e,i,o,"H")==1&&(r+=1)}),2===r}const Eht=new Set(["N","O","S","F","CL","BR","I"]);const Pht={distanceMax:I.Numeric(5,{min:0,max:8,step:.1})},kht={distanceMax:I.Numeric(5.5,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1}),angleDevMax:I.Numeric(30,{min:0,max:180,step:1})},Mht={distanceMax:I.Numeric(6,{min:1,max:8,step:.1}),offsetMax:I.Numeric(2,{min:0,max:4,step:.1})},Rht=["ARG","HIS","LYS"],Nht=["GLU","ASP"];function Sye(e,t){const n=DP.get(e).value;if(!n)throw Error("expected valence model to be available");const r=n.get(t.id);if(!r)throw Error("expected valence model for unit to be available");return r}const Cye=C(),wye=C(),HF=C(),PA=C(),GF=C(),qF=C();function cW(e,t){const{unit:n,feature:r,offsets:i,members:o}=t,{elements:s}=n,a=i[r];return t.unit.conformation.position(s[o[a]],HF),t.unit.conformation.position(s[o[a+1]],PA),t.unit.conformation.position(s[o[a+2]],GF),C.triangleNormal(e,HF,PA,GF)}const uW=function(e,t,n){return $o.position(HF,e),$o.position(PA,t),C.sub(GF,HF,PA),C.projectOnPlane(qF,GF,n),C.add(qF,qF,PA),C.distance(qF,PA)},qht=Xr(180),Aye=Xr(90),PP=C(),dW=C();const Xht=$o.Provider([2],function Oht(e,t,n){const{charge:r}=Sye(e,t),{elements:i}=t,{x:o,y:s,z:a}=t.model.atomicConformation,l=new Set,{label_comp_id:c}=t.model.atomicHierarchy.atoms,u=En.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);for(;u.hasNext;){const{index:d,start:f,end:p}=u.move(),m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[d]);if(Nht.includes(m)){n.startState();for(let h=f;h<p;++h)"O"===ui(t,h)&&!Y0.has(TP(t,h))&&n.pushMember(o[i[h]],s[i[h]],a[i[h]],h);n.finishState(2,ki.None)}else if(ZR.has(m))for(let h=f;h<p;++h)_ye(e,t,h)&&(n.startState(),Ju(e,t,h,(g,y)=>{"O"===ui(t,y)&&n.pushMember(o[i[y]],s[i[y]],a[i[y]],y)}),n.finishState(2,ki.Phosphate));else if(!yw.has(m)){for(let h=f;h<p;++h){n.startState(),"N"===ui(t,h)&&!Y0.has(TP(t,h))&&n.pushMember(o[i[h]],s[i[h]],a[i[h]],h),n.finishState(2,ki.None);let g=ki.None;_ht(e,t,h)?g=ki.SulfonicAcid:_ye(e,t,h)?g=ki.Phosphate:Sht(e,t,h)?g=ki.Sulfate:wht(e,t,h)&&(g=ki.Carboxylate),g&&(n.startState(),Ju(e,t,h,(y,v)=>{"O"===ui(t,v)&&(l.add(v),n.pushMember(o[i[v]],s[i[v]],a[i[v]],v))}),n.finishState(2,g))}for(let h=f;h<p;++h)r[h]<0&&!l.has(h)&&n.add(2,ki.None,o[i[h]],s[i[h]],a[i[h]],h)}}}),Kht=$o.Provider([1],function Fht(e,t,n){const{charge:r}=Sye(e,t),{elements:i}=t,{x:o,y:s,z:a}=t.model.atomicConformation,l=new Set,{label_comp_id:c}=t.model.atomicHierarchy.atoms,u=En.transientSegments(t.model.atomicHierarchy.residueAtomSegments,i);for(;u.hasNext;){const{index:d,start:f,end:p}=u.move(),m=c.value(t.model.atomicHierarchy.residueAtomSegments.offsets[d]);if(Rht.includes(m)){n.startState();for(let h=f;h<p;++h)"N"===ui(t,h)&&!Y0.has(TP(t,h))&&n.pushMember(o[i[h]],s[i[h]],a[i[h]],h);n.finishState(1,ki.None)}else if(!yw.has(m)){l.clear();for(let h=f;h<p;++h){let g=ki.None;Aht(e,t,h)?g=ki.Guanidine:Iht(e,t,h)&&(g=ki.Acetamidine),g&&(n.startState(),Ju(e,t,h,(y,v)=>{"N"===ui(t,v)&&(l.add(v),n.pushMember(o[i[v]],s[i[v]],a[i[v]],v))}),n.finishState(1,g))}for(let h=f;h<p;++h)r[h]>0&&!l.has(h)&&n.add(1,ki.None,o[i[h]],s[i[h]],a[i[h]],h)}}}),Zht=$o.Provider([3],function Bht(e,t,n){const{elements:r}=t,{x:i,y:o,z:s}=t.model.atomicConformation;for(const a of t.rings.aromaticRings){const l=t.rings.all[a];n.startState();for(let c=0,u=l.length;c<u;++c){const d=l[c];n.pushMember(i[r[d]],o[r[d]],s[r[d]],d)}n.finishState(3,ki.None)}}),Qht={name:"ionic",params:Pht,createTester:e=>{const t=function Vht(e){return{distanceMaxSq:e.distanceMax*e.distanceMax}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([2,1]),getType:(n,r,i,o)=>function Wht(e,t,n,r,i){if(function Lht(e,t){return 2===e&&1===t||1===e&&2===t}(t.types[t.feature],n.types[n.feature])&&function zht(e,t,n){const{feature:r,offsets:i,members:o}=e,{feature:s,offsets:a,members:l}=t;for(let c=i[r],u=i[r+1];c<u;++c){e.unit.conformation.position(e.unit.elements[o[c]],Cye);for(let f=a[s],p=a[s+1];f<p;++f)if(t.unit.conformation.position(t.unit.elements[l[f]],wye),C.squaredDistance(Cye,wye)<n)return!0}return!1}(t,n,i.distanceMaxSq))return Er.Ionic}(0,r,i,0,t)}}},Jht={name:"pi-stacking",params:kht,createTester:e=>{const t=function Hht(e){return{offsetMax:e.offsetMax,angleDevMax:Xr(e.angleDevMax)}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3]),getType:(n,r,i,o)=>function $ht(e,t,n,r,i){if(function jht(e,t){return 3===e&&3===t}(t.types[t.feature],n.types[n.feature])){cW(PP,t),cW(dW,n);const a=C.angle(PP,dW);if(Math.min(uW(t,n,dW),uW(n,t,PP))<=i.offsetMax){if(a<=i.angleDevMax||a>=qht-i.angleDevMax)return Er.PiStacking;if(a<=i.angleDevMax+Aye&&a>=Aye-i.angleDevMax)return Er.PiStacking}}}(0,r,i,0,t)}}},emt={name:"cation-pi",params:Mht,createTester:e=>{const t=function Ght(e){return{offsetMax:e.offsetMax}}(e);return{maxDistance:e.distanceMax,requiredFeatures:new Set([3,1]),getType:(n,r,i,o)=>function Yht(e,t,n,r,i){const o=t.types[t.feature];if(function Uht(e,t){return 3===e&&1===t||1===e&&3===t}(o,n.types[n.feature])){const[a,l]=3===o?[t,n]:[n,t];if(cW(PP,a),uW(l,a,PP)<=i.offsetMax)return Er.CationPi}}(0,r,i,0,t)}}},tmt={distanceMax:I.Numeric(4,{min:1,max:5,step:.1})},omt=$o.Provider([8],function nmt(e,t,n){const{elements:r}=t,{x:i,y:o,z:s}=t.model.atomicConformation;for(let a=0,l=r.length;a<l;++a){const c=ui(t,a);let u=!1;"C"===c?(u=!0,Ju(e,t,a,(d,f)=>{const p=ui(d,f);"C"!==p&&"H"!==p&&(u=!1)})):"F"===c&&(u=!0),u&&n.add(8,ki.None,i[r[a]],o[r[a]],s[r[a]],a)}}),smt={name:"hydrophobic",params:tmt,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([8]),getType:(t,n,r,i)=>function imt(e,t,n,r){if(!function rmt(e,t){return 8===e&&8===t}(t.types[t.feature],n.types[n.feature]))return;const a=n.members[n.offsets[n.feature]];return"F"!==ui(t.unit,t.members[t.offsets[t.feature]])||"F"!==ui(n.unit,a)?Er.Hydrophobic:void 0}(0,n,r)})},amt={distanceMax:I.Numeric(3,{min:1,max:5,step:.1})},lmt=["LI","NA","K","RB","CS","MG","CA","SR","BA","AL","GA","IN","TL","SC","SN","PB","BI","SB","HG"];function Iye(e){return!Y0.has(e)}function umt(e){return Y0.has(e)}function dmt(e){return XR.has(e)}function Eye(e,t){return 12===e?11===t||12===t:13===e?10===t:void 0}const hmt=$o.Provider([13,12],function cmt(e,t,n){const{elements:r}=t,{x:i,y:o,z:s}=t.model.atomicConformation;for(let a=0,l=r.length;a<l;++a){const c=ui(t,a);let u=0;lmt.includes(c)?u=13:(Zfe(c)||"ZN"===c||"CD"===c)&&(u=12),u&&n.add(u,ki.None,i[r[a]],o[r[a]],s[r[a]],a)}}),mmt=$o.Provider([10,11],function fmt(e,t,n){const{elements:r}=t,{x:i,y:o,z:s}=t.model.atomicConformation;for(let a=0,l=r.length;a<l;++a){const c=ui(t,a),u=Xq(t,a),d=TP(t,a);let f=!1,p=!1;const m=A3.has(u),h=ZR.has(u);m||h?m?"O"===c?(["ASP","GLU","SER","THR","TYR","ASN","GLN"].includes(u)&&Iye(d)||umt(d))&&(f=!0,p=!0):"S"!==c||"CYS"!==u&&"MET"!==u?"N"===c&&"HIS"===u&&Iye(d)&&(f=!0):(f=!0,p=!0):h&&("O"===c&&dmt(d)?(f=!0,p=!0):["N3","N4","N7"].includes(d)?f=!0:["O2","O4","O6"].includes(d)&&(f=!0,p=!0)):VJe(c)||"O"===c||"S"===c?(f=!0,p=!0):"N"===c&&(f=!0),f&&n.add(11,ki.None,i[r[a]],o[r[a]],s[r[a]],a),p&&n.add(10,ki.None,i[r[a]],o[r[a]],s[r[a]],a)}}),gmt={name:"metal-coordination",params:amt,createTester:e=>({maxDistance:e.distanceMax,requiredFeatures:new Set([13,12,10,11]),getType:(t,n,r,i)=>function pmt(e,t,n,r){const i=t.types[t.feature],o=n.types[n.feature];if(Eye(i,o)||Eye(o,i))return Er.MetalCoordination}(0,n,r)})};function bmt(e,t){const{contacts:n}=t,r=function(c,u,d,f,p){const[m,h]=f.get(d)||[1/0,-1];c<m?(-1!==h&&p(h),f.set(d,[c,u])):p(u)};function i(c,u,d,f,p){const m=u.members[u.offsets[u.feature]],h=d.members[d.offsets[d.feature]],g=u.unit.getResidueIndex(m),y=d.unit.getResidueIndex(h),v=`${m}|${u.unit.id}|${y}|${d.unit.id}|A`,x=`${h}|${d.unit.id}|${g}|${u.unit.id}|B`,_=$o.distance(u,d);r(_,c,v,f,p),r(_,c,x,f,p)}const o=new Map,s=c=>n.edges[c].props.flag=Mg.Filtered;let a,l;return{isApplicable:c=>c===Er.Hydrophobic,handleInterContact:(c,u,d)=>{i(c,u,d,o,s)},startUnit:(c,u,d)=>{a=new Map,l=f=>u.edgeProps.flag[f]=Mg.Filtered},handleIntraContact:(c,u,d)=>{i(c,u,d,a,l)}}}function vmt(e,t){const{contacts:n}=t,r=(i,o)=>{const s=9===i.types[i.feature]?o:i,a=s.members[s.offsets[s.feature]],{edgeProps:{type:l},elementsIndex:{offsets:c,indices:u}}=t.unitsContacts.get(s.unit.id);for(let f=c[a],p=c[a+1];f<p;++f)if(l[u[f]]===Er.HydrogenBond)return!0;const d=n.getEdgeIndices(s.feature,s.unit.id);for(let f=0,p=d.length;f<p;++f)if(n.edges[d[f]].props.type===Er.HydrogenBond)return!0;return!1};return{isApplicable:i=>i===Er.WeakHydrogenBond,handleInterContact:(i,o,s)=>{r(o,s)&&(n.edges[i].props.flag=Mg.Filtered)},startUnit:()=>{},handleIntraContact:(i,o,s)=>{if(r(o,s)){const{flag:a}=t.unitsContacts.get(o.unit.id).edgeProps;a[i]=Mg.Filtered}}}}function fW(e,t,n,r,i){const{offsets:o,feature:s}=n,{offsets:a,feature:l}=r;for(let c=o[s],u=o[s+1];c<u;++c){const f=i.getContactIndicesForElement(n.members[c],n.unit);for(let p=0,m=f.length;p<m;++p){const h=f[p];if(e.includes(i.edges[h].props.type))for(let g=a[l],y=a[l+1];g<y;++g)if(i.getContactIndicesForElement(r.members[g],r.unit).includes(h))return void(i.edges[t].props.flag=Mg.Filtered)}}}function pW(e,t,n,r,i){const{edgeProps:{type:o,flag:s},elementsIndex:{offsets:a,indices:l}}=i,{offsets:c,feature:u}=n,{offsets:d,feature:f}=r;for(let p=c[u],m=c[u+1];p<m;++p){const h=n.members[p];for(let g=a[h],y=a[h+1];g<y;++g){const v=l[g];if(e.includes(o[v]))for(let x=d[f],_=d[f+1];x<_;++x){const w=r.members[x];for(let A=a[w],M=a[w+1];A<M;++A)if(v===l[A])return void(s[t]=Mg.Filtered)}}}}function xmt(e,t){const{contacts:n}=t;return{isApplicable:r=>r===Er.Ionic,handleInterContact:(r,i,o)=>{fW([Er.HydrogenBond,Er.WeakHydrogenBond],r,i,o,n)},startUnit:()=>{},handleIntraContact:(r,i,o)=>{pW([Er.HydrogenBond,Er.WeakHydrogenBond],r,i,o,t.unitsContacts.get(i.unit.id))}}}function _mt(e,t){const{contacts:n}=t;return{isApplicable:r=>r===Er.Hydrophobic||r===Er.CationPi,handleInterContact:(r,i,o)=>{fW([Er.PiStacking],r,i,o,n)},startUnit:()=>{},handleIntraContact:(r,i,o)=>{pW([Er.PiStacking],r,i,o,t.unitsContacts.get(i.unit.id))}}}function Smt(e,t){const{contacts:n}=t;return{isApplicable:r=>r===Er.Ionic,handleInterContact:(r,i,o)=>{fW([Er.MetalCoordination],r,i,o,n)},startUnit:()=>{},handleIntraContact:(r,i,o)=>{pW([Er.MetalCoordination],r,i,o,t.unitsContacts.get(i.unit.id))}}}var Vy;!function(e){function i(u,d){const{unitA:f,indexA:p,unitB:m,indexB:h}=d,{contacts:g,unitsContacts:y}=u;if(f===m){const v=y.get(f.id),x=v.getDirectedEdgeIndex(p,h);return lye(v.edgeProps.type[x])}{const v=g.getEdgeIndex(p,f.id,h,m.id);return lye(g.edges[v].props.type)}}function l(u,d,f){const{unitsFeatures:p}=u;return X0.fromPairProvider(d.length,(m,h,g)=>{const y=d[m];$o.setPosition(h,y.unitA,y.indexA,p.get(y.unitA.id)),$o.setPosition(g,y.unitB,y.indexB,p.get(y.unitB.id))},f)}function c(u,d,f){const p=f[0];if(void 0===p)return"";const{unitA:m,indexA:h,unitB:g,indexB:y}=p,{unitsFeatures:v}=d,{members:x,offsets:_}=v.get(m.id),{members:w,offsets:A}=v.get(g.id),M={granularity:"element"};return(_[h+1]-_[h]>1||A[y+1]-A[y]>1)&&(M.granularity="residue"),[i(d,p),NG(fn.Location(u,m,x[_[h]],u,g,w[A[y]]),M)].join("</br>")}e.Location=function t(u,d,f,p,m,h){return zue("interactions",{structure:d,interactions:u},{unitA:f,indexA:p,unitB:m,indexB:h})},e.isLocation=function n(u){return!!u&&"data-location"===u.kind&&"interactions"===u.tag},e.areLocationsEqual=function r(u,d){return u.data.structure===d.data.structure&&u.data.interactions===d.data.interactions&&u.element.indexA===d.element.indexA&&u.element.indexB===d.element.indexB&&u.element.unitA===d.element.unitA&&u.element.unitB===d.element.unitB},e.locationLabel=function o(u){return i(u.data.interactions,u.element)},e.Loci=function s(u,d,f){return ZN("interactions",{structure:u,interactions:d},f,p=>l(d,f,p),()=>c(u,d,f))},e.isLoci=function a(u){return!!u&&"data-loci"===u.kind&&"interactions"===u.tag},e.getBoundingSphere=l,e.getLabel=c}(Vy||(Vy={}));const Cmt=[mht,ght,yht,Xht,Kht,Zht,Qpt,Jpt,omt,hmt,mmt],WF={ionic:Qht,"pi-stacking":Jht,"cation-pi":emt,"halogen-bonds":eht,"hydrogen-bonds":bht,"weak-hydrogen-bonds":vht,hydrophobic:smt,"metal-coordination":gmt},Amt=function wmt(e=[]){const t=Object.create(null);return Object.keys(WF).forEach(n=>{t[n]=I.MappedStatic(e.includes(n)?"on":"off",{on:I.Group(WF[n].params),off:I.Group({})},{cycle:!0})}),t}(["cation-pi","pi-stacking","hydrogen-bonds","halogen-bonds","metal-coordination"]),Tye={providers:I.Group(Amt,{isFlat:!0}),contacts:I.Group(Npt,{label:"Advanced Options"})};function Imt(e,t,n){return hW.apply(this,arguments)}function hW(){return hW=le(function*(e,t,n){const r={...I.getDefaultValues(Tye),...n};yield DP.attach(e,t);const i=[];DR(WF).forEach(d=>{const{name:f,params:p}=r.providers[d];"on"===f&&i.push(WF[d].createTester(p))});const o=new Set;i.forEach(d=>Lo.add(o,d.requiredFeatures));const s=Cmt.filter(d=>Lo.areIntersecting(o,d.types)),a=sp.Mutable(),l=sp.Mutable();for(let d=0,f=t.unitSymmetryGroups.length;d<f;++d){const p=t.unitSymmetryGroups[d];e.runtime.shouldUpdate&&(yield e.runtime.update({message:"computing interactions",current:d,max:f}));const m=Emt(t,p.units[0],s),h=Tmt(t,p.units[0],m,i,r.contacts);for(let g=0,y=p.units.length;g<y;++g){const v=p.units[g];a.set(v.id,m),l.set(v.id,h)}}const c=function Dmt(e,t,n,r){const i=oW.create();return Xe.eachUnitPair(e,(o,s)=>{const a=t.get(o.id),l=t.get(s.id);!function Upt(e,t,n,r,i,o,s,a){const{count:l,x:c,y:u,z:d}=n,{lookup3d:f}=i,p=fe.mul(jpt,r.conformation.operator.inverse,t.conformation.operator.matrix),m=!fe.isIdentity(p),h=C(),g=Math.max(...s.map(M=>M.maxDistance)),{center:y,radius:v}=f.boundary.sphere,x=(v+g)*(v+g),_=a.lineOfSightDistFactor,w=$o.Info(e,t,n),A=$o.Info(e,r,i);o.startUnitPair(t,r);for(let M=0;M<l;++M){if(C.set(h,c[M],u[M],d[M]),m&&C.transformMat4(h,h,p),C.squaredDistance(h,y)>x)continue;const{indices:E,count:D,squaredDistances:T}=f.find(h[0],h[1],h[2],g);if(0!==D){w.feature=M;for(let F=0;F<D;++F){const R=E[F];if(A.feature=R,!cye(e,w,A))continue;const N=T[F];for(const j of s)if(N<j.maxDistance*j.maxDistance){const W=j.getType(e,w,A,N);if(W&&fye(e,w,A,_)){o.add(M,R,W);break}}}}}o.finishUnitPair()}(e,o,a,s,l,i,n,r)},{maxRadius:Math.max(...n.map(o=>o.maxDistance)),validUnit:o=>ze.isAtomic(o),validUnitPair:(o,s)=>Xe.validUnitPair(e,o,s)}),i.getContacts(t)}(t,a,i,r.contacts),u={unitsFeatures:a,unitsContacts:l,contacts:c};return function ymt(e,t){const{contacts:n,unitsContacts:r,unitsFeatures:i}=t,o=[bmt(0,t),vmt(0,t),xmt(0,t),_mt(0,t),Smt(0,t)];for(let a=0,l=n.edgeCount;a<l;++a){const c=n.edges[a],u=e.unitMap.get(c.unitA),d=e.unitMap.get(c.unitB),f=$o.Info(e,u,i.get(c.unitA));f.feature=c.indexA;const p=$o.Info(e,d,i.get(c.unitB));p.feature=c.indexB;for(const m of o)m.isApplicable(c.props.type)&&m.handleInterContact(a,f,p)}const s=r.keys();for(;;){const{done:a,value:l}=s.next();if(a)break;const c=r.get(l),u=i.get(l),d=e.unitMap.get(l);if(!ze.isAtomic(d))continue;const f=$o.Info(e,d,u),p=$o.Info(e,d,u);for(const m of o)m.startUnit(d,c,u);for(let m=0,h=2*c.edgeCount;m<h;++m){f.feature=c.a[m],p.feature=c.b[m];for(const g of o)g.isApplicable(c.edgeProps.type[m])&&g.handleIntraContact(m,f,p)}}}(t,u),u}),hW.apply(this,arguments)}function Emt(e,t,n){const r=t.elements.length,i=nW.create(r,r/2);if(ze.isAtomic(t))for(const o of n)o.add(e,t,i);return i.getFeatures(r)}function Tmt(e,t,n,r,i){const o=iW.create(n,t.elements.length);return ze.isAtomic(t)&&function Bpt(e,t,n,r,i,o){for(const s of i)Lpt(e,t,n,r,s,o)}(e,t,n,o,r,i),o.getContacts()}const mW={...Tye},ks=iy.createProvider({label:"Interactions",descriptor:hf({name:"molstar_computed_interactions"}),type:"local",defaultParams:mW,getParams:e=>mW,isApplicable:e=>!e.isCoarseGrained,obtain:function(){var e=le(function*(t,n,r){const i={...I.getDefaultValues(mW),...r};return{value:yield Imt(t,n,i)}});return function(n,r,i){return e.apply(this,arguments)}}()}),gW=st(13421772),pu_HydrogenBond=2851770,pu_Hydrophobic=8421504,pu_HalogenBond=4259775,pu_Ionic=15779860,pu_MetalCoordination=9191577,pu_CationPi=16744448,pu_PiStacking=9220966,pu_WeakHydrogenBond=12967404,kmt=[["Hydrogen Bond",pu_HydrogenBond],["Hydrophobic",pu_Hydrophobic],["Halogen Bond",pu_HalogenBond],["Ionic",pu_Ionic],["Metal Coordination",pu_MetalCoordination],["Cation Pi",pu_CationPi],["Pi Stacking",pu_PiStacking],["Weak HydrogenBond",pu_WeakHydrogenBond]];function Dye(e){switch(e){case Er.HydrogenBond:return pu_HydrogenBond;case Er.Hydrophobic:return pu_Hydrophobic;case Er.HalogenBond:return pu_HalogenBond;case Er.Ionic:return pu_Ionic;case Er.MetalCoordination:return pu_MetalCoordination;case Er.CationPi:return pu_CationPi;case Er.PiStacking:return pu_PiStacking;case Er.WeakHydrogenBond:return pu_WeakHydrogenBond;case Er.Unknown:return gW}}const Pye={},yW={name:"interaction-type",label:"Interaction Type",category:Rd.Category.Misc,factory:function kye(e,t){let n;const r=e.structure?ks.get(e.structure):void 0,i=r?Yx(r.id,r.version):-1;return n=r&&r.value?o=>{if(Vy.isLocation(o)){const{unitsContacts:s,contacts:a}=o.data.interactions,{unitA:l,unitB:c,indexA:u,indexB:d}=o.element;if(l===c){const f=s.get(l.id),p=f.getDirectedEdgeIndex(u,d);return Dye(f.edgeProps.type[p])}{const f=a.getEdgeIndex(u,l.id,d,c.id);return Dye(a.edges[f].props.type)}}return gW}:()=>gW,{factory:kye,granularity:"group",color:n,props:t,contextHash:i,description:"Assigns colors according the interaction type of a link.",legend:v1(kmt)}},getParams:function Mmt(e){return Pye},defaultValues:I.getDefaultValues(Pye),isApplicable:e=>!!e.structure,ensureCustomProperties:{attach:(e,t)=>t.structure?ks.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&ks.ref(e.structure,!1)}};function Ff(e,t,n,r){let i=0;const{webgl:o}=t,s=new si,a=new Xn.GeometryState,l=ky(),c=[],u=gl.create();let d,f,p,m,h=Ia.createEmpty();function w(E){if(gl.update(u,E),void 0!==E.visible&&d&&d.setVisibility(E.visible&&(null===u.unitTransforms||u.unitTransforms.isIdentity)),void 0!==E.alphaFactor&&d&&d.setAlphaFactor(E.alphaFactor),void 0!==E.pickable&&d&&d.setPickable(E.pickable),void 0!==E.overpaint&&d){const D=Ea.remap(E.overpaint,f);d.setOverpaint(D,o)}if(void 0!==E.transparency&&d){const D=dc.remap(E.transparency,f);d.setTransparency(D,o)}if(void 0!==E.substance&&d){const D=fc.remap(E.substance,f);d.setSubstance(D,o)}if(void 0!==E.clipping&&d){const D=co.remap(E.clipping,f);d.setClipping(D)}void 0!==E.themeStrength&&d&&d.setThemeStrength(E.themeStrength),void 0!==E.transform&&d&&d.setTransform(E.transform),void 0!==E.unitTransforms&&d&&d.setVisibility(u.visible&&(null===E.unitTransforms||E.unitTransforms.isIdentity))}return{label:e,get groupCount(){return d?d.groupCount:0},get props(){return m},get params(){return p},get state(){return u},get theme(){return h},get geometryVersion(){return a.version},renderObjects:c,updated:s,createOrUpdate:function g(E={},D){return D&&D!==f&&(p=n(t,D),f=D,m||(m=I.getDefaultValues(p))),m=Object.assign({},m,E),Ke.create("Creating or updating ComplexRepresentation",function(){var T=le(function*(F){var R;let N=!1;d?null!==(R=d.mustRecreate)&&void 0!==R&&R.call(d,f,m,o)&&(d.destroy(),d=r(l,f,m,o),N=!0):(d=r(l,f,m,o),N=!0);const j=d.createOrUpdate({webgl:o,runtime:F},h,m,D);j&&(yield j),N&&w(u),c.length=0,d&&d.renderObject&&(c.push(d.renderObject),a.add(d.renderObject.id,d.geometryVersion)),a.snapshot(),i+=1,s.next(i)});return function(F){return T.apply(this,arguments)}}())},setState:w,setTheme:function A(E){h=E},getLoci:function y(E){return d?d.getLoci(E):qr},getAllLoci:function v(){var E;return[Xe.Loci(null!==(E=f.child)&&void 0!==E?E:f)]},eachLocation:function x(E){d?.eachLocation(E)},mark:function _(E,D){if(!f||!uc.is(u.markerActions,D))return!1;if(Xe.isLoci(E)||Me.is(E)||fn.isLoci(E)){if(!Xe.areRootsEquivalent(E.structure,f))return!1;E=Yn.remap(E,f),(Xe.isLoci(E)||Me.is(E)&&Me.isWholeStructure(E))&&(E=KN)}else if(!Xu(E)&&!aP(E))return!1;return!Yn.isEmpty(E)&&!!d&&d.mark(E,D)},destroy:function M(){d&&d.destroy()}}}const Rmt=fe.toArray;function Mye(e,t,n){const{elements:r,model:i}=t;if(-1!==Ve.indexOf(r,n)){const{index:o,offsets:s}=i.atomicHierarchy.residueAtomSegments,a=o[n],l=[];for(let u=s[a],d=s[a+1];u<d;++u){const f=Ve.indexOf(r,u);-1!==f&&l.push(f)}return Me(e,[{unit:t,indices:Ve.ofSortedArray(rt.ofSortedArray(l))}])}return qr}function kP(e,t,n,r){const{elements:i,model:o}=t,{label_alt_id:s}=o.atomicHierarchy.atoms,{offsets:a}=o.atomicHierarchy.residueAtomSegments,l=[];for(let u=a[n],d=a[n+1];u<d;++u){const f=Ve.indexOf(i,u);if(-1!==f){const p=s.value(u);(r===p||""===p)&&l.push(f)}}return Me(e,[{unit:t,indices:Ve.ofSortedArray(rt.ofSortedArray(l))}])}function Rye(e,t,n,r,i,o){const{child:s}=e.structure,a=t&&s?e.group.units.filter(d=>s.unitMap.has(d.id)):e.group.units,l=a.length,c=16*l,u=o&&o.aTransform.ref.value.length>=c?o.aTransform.ref.value:new Float32Array(c);for(let d=0;d<l;d++)Rmt(a[d].conformation.operator.matrix,u,16*d);return A9(u,l,n,r,i,o)}const Omt=I.objectToOptions({atomic:{},spheres:{},gaussians:{}}),Nye=5e8;function Fye(e,t,n=Nye){const r=Gt.size(C(),e);C.ceil(r,r),r.sort((a,l)=>l-a);const i=Math.floor(Math.cbrt(n)*Math.cbrt(n)),o=r[0]*r[1];return{area:o,areaCells:Math.ceil(o/(t*t)),maxAreaCells:i}}function sv(e,t,n=Nye){const{area:r,areaCells:i,maxAreaCells:o}=Fye(e,t.resolution,n),s=i>o?Math.sqrt(r/o):t.resolution;return{...t,resolution:s}}const $F={ignoreHydrogens:I.Boolean(!1,{description:"Whether or not to include hydrogen atoms in the surface calculation."}),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),traceOnly:I.Boolean(!1,{description:"Whether or not to only use trace atoms in the surface calculation."}),includeParent:I.Boolean(!1,{description:"Include elements of the parent structure in surface calculation to get a surface patch of the current structure."})},jmt=(I.getDefaultValues($F),C());function Oye(e,t,n,r){return C.squaredDistance(C.set(jmt,e,t,n),r)}function YF(e,t,n,r){const{ignoreHydrogens:i,ignoreHydrogensVariant:o,traceOnly:s,includeParent:a}=r,l=a?e.root.unitMap.get(t.id):t,c=a&&l!==t,{x:u,y:d,z:f}=function Lmt(e){switch(e.kind){case 0:return e.model.atomicConformation;case 1:return e.model.coarseConformation.spheres;case 2:return e.model.coarseConformation.gaussians}}(l),{elements:p}=l,{center:m,radius:h}=t.boundary.sphere,y=(h+11)*(h+11);let v,x;if(i||s||c){const E=[],D=[];for(let T=0,F=p.length;T<F;++T){const R=p[T];i&&rm(e,l,R,o)||s&&!bW(l,R)||c&&Oye(u[R],d[R],f[R],m)>y||(E.push(R),D.push(T))}v=rt.ofSortedArray(E),x=D}else v=p,x=Sd(new Int32Array(v.length));a&&l!==t&&function Umt(e,t,n){let r=0;const i=t.length;for(let o=0,s=n.length;o<s;++o){const a=rt.indexOfInRange(t,n[o],r,i);-1===a?e[o]=-2:(e[o]=a,r=a)}}(x,t.elements,v);const _={indices:v,x:u,y:d,z:f,id:x},w=c?Q0(_):t.boundary,A=dt.create(e,l);return{position:_,boundary:w,radius:E=>(A.element=E,n.size(A))}}function XF(e,t,n){const{ignoreHydrogens:r,ignoreHydrogensVariant:i,traceOnly:o,includeParent:s}=n,a=s&&!!e.parent,l=dt.create(e.root),{center:c,radius:u}=e.boundary.sphere,f=(u+11)*(u+11);let p,m,h,g,y,v;if(r||o||a){const{getSerialIndex:A}=e.serialMapping,M=a?e.root.units:e.units,E=[],D=[],T=[],F=[],R=[];for(let N=0,j=M.length;N<j;++N){const W=M[N],{elements:z,conformation:$}=W,V=e.unitMap.get(W.id);l.unit=W;for(let X=0,H=z.length;X<H;++X){const oe=z[X];if(r&&rm(e,W,oe,i)||o&&!bW(W,oe))continue;const te=$.x(oe),K=$.y(oe),Q=$.z(oe);a&&Oye(te,K,Q,c)>f||(E.push(te),D.push(K),T.push(Q),l.element=oe,F.push(t.size(l)),a?-1===(V?rt.indexOf(V.elements,oe):-1)?R.push(-2):R.push(A(V,oe)):R.push(A(W,oe)))}}p=E,m=D,h=T,g=F,y=R,v=Ve.ofRange(0,y.length)}else{const{elementCount:A}=e,M=new Float32Array(A),E=new Float32Array(A),D=new Float32Array(A),T=new Float32Array(A);for(let F=0,R=0,N=e.units.length;F<N;++F){const j=e.units[F],{elements:W,conformation:z}=j;l.unit=j;for(let $=0,V=W.length;$<V;++$){const X=W[$],H=R+$;M[H]=z.x(X),E[H]=z.y(X),D[H]=z.z(X),l.element=X,T[H]=t.size(l)}R+=W.length}p=M,m=E,h=D,g=T,y=Sd(new Uint32Array(A)),v=Ve.ofRange(0,y.length)}const x={indices:v,x:p,y:m,z:h,id:y};return{position:x,boundary:a?Q0(x):e.boundary,radius:A=>g[A]}}const Bye=v5.H;function rm(e,t,n,r){if(ze.isCoarse(t)||t.model.atomicHierarchy.derived.atom.atomicNumber[n]!==Bye)return!1;if("all"===r)return!0;const i=function Dht(e,t,n){let r=!1;return Ju(e,t,n,(i,o)=>{(function Tht(e){return Eht.has(e)})(ui(i,o))&&(r=!0)}),r}(e,t,rt.indexOf(t.elements,n));return!!(i&&"polar"===r||!i&&"non-polar"===r)}function zmt(e,t){return e[t]===Bye}function bW(e,t){if(ze.isCoarse(e))return!0;const n=e.model.atomicHierarchy.atoms.label_atom_id.value(t);return"CA"===n||"BB"===n||"P"===n}function MP(e){return I.MultiSelect(e,Omt,{description:"For which kinds of units/chains to show the representation visuals."})}const ed={unitKinds:MP(["atomic","spheres"]),includeParent:I.Boolean(!1,{isHidden:!0})},Lye={...on.Params},jye={...Rp.Params},Uye={...Wu.Params},Vmt={...G1.Params},zye={...Mo.Params},Vye={...Tf.Params},Hye={...Df.Params},Gye={...iu.Params};function e2(e,t){const{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:o,eachLocation:s,setUpdateState:a,mustRecreate:l,processValues:c,dispose:u}=e,{updateValues:d,updateBoundingSphere:f,updateRenderableState:p,createPositionIterator:m}=e.geometryUtils,h=Ag.create(),g={loci:qr,action:un.None,status:-1};let y,v,x,_,M,E,T,F,w=Object.assign({},n),A=Ia.createEmpty(),D=-1;function N(V){if(h.createNew){if(T=i(_,v),!V)throw new Error("expected geometry to be given");y=function Hmt(e,t,n,r,i,o){const{createValues:s,createRenderableState:a}=$a.getUtils(t),c=s(t,E9(),n,r,i),u=a(i);return Jw(t.kind,c,u,o)}(0,V,T,x,v,t),F=m(V,y.values)}else{if(!y)throw new Error("expected renderObject to be available");if(h.updateTransform){T=i(_,v);const{instanceCount:X,groupCount:H}=T;v.instanceGranularity?hs(X,"instance",y.values):hs(X*H,"groupInstance",y.values)}if(h.createGeometry){if(!V)throw new Error("expected geometry to be given");O.updateIfChanged(y.values.drawCount,$a.getDrawCount(V)),O.updateIfChanged(y.values.uVertexCount,$a.getVertexCount(V)),O.updateIfChanged(y.values.uGroupCount,$a.getGroupCount(V))}(h.updateTransform||h.createGeometry)&&(f(y.values,V||E),F=m(E,y.values)),h.updateSize&&"uSize"in y.values&&xy(T,x.size,y.values),h.updateColor&&Ef(T,F,x.color,y.values),d(y.values,v),p(y.state,v)}w=v,A=x,M=_,V&&(E=V,D+=1)}function z(V,X,H){return function j(V){return!!(Xu(V)||Xe.isLoci(V)&&Xe.areRootsEquivalent(V.structure,M)||Me.is(V)&&Xe.areRootsEquivalent(V.structure,M)&&Me.isWholeStructure(V))}(V)?X(Pe.ofBounds(0,w.instanceGranularity?T.instanceCount:T.groupCount*T.instanceCount)):w.instanceGranularity?function W(V,X,H){let oe=!1;return!(!Me.is(V)&&!fn.isLoci(V)||!Xe.areEquivalent(V.structure,X))&&(H(Pe.ofSingleton(0))&&(oe=!0),oe)}(V,M,X):s(V,M,X,H)}function $(V){y&&c?.(y.values,E,w,A,V.webgl)}return{get groupCount(){return T?T.count:0},get renderObject(){return T&&T.count?y:void 0},get geometryVersion(){return D},createOrUpdate(V,X,H={},oe){if(function R(V,X,H){if(!H&&!M)throw new Error("missing structure");if(v=Object.assign({},w,X),x=V,_=H,Ag.reset(h),!y||!M)return h.createNew=!0,void(h.createGeometry=!0);a(h,v,w,x,A,_,M),Xe.areEquivalent(_,M)||(h.createGeometry=!0),Xe.areHierarchiesEqual(_,M)||(h.updateTransform=!0,h.createGeometry=!0),Rd.areEqual(V.color,A.color)||(h.updateColor=!0),tg(v.unitKinds,w.unitKinds)||(h.createGeometry=!0),M.child!==_.child&&(h.createGeometry=!0),v.instanceGranularity!==w.instanceGranularity&&(h.updateTransform=!0),h.updateSize&&!("uSize"in y.values)&&(h.createGeometry=!0),h.createGeometry&&(h.updateColor=!0,h.updateSize=!0)}(X,H,oe||M),h.createGeometry){const te=r(V,_,x,v,E);if(PR(te))return te.then(K=>{N(K),$(V)});N(te)}else N();$(V)},getLoci:V=>y?o(V,M,y.id):qr,eachLocation(V){for(T.reset();T.hasNext;){const{location:X,isSecondary:H}=T.move();V(X,H)}},mark:(V,X)=>pr.mark(y,V,X,z,g),setVisibility(V){pr.setVisibility(y,V)},setAlphaFactor(V){pr.setAlphaFactor(y,V)},setPickable(V){pr.setPickable(y,V)},setColorOnly(V){pr.setColorOnly(y,V)},setTransform(V,X){pr.setTransform(y,V,X)},setOverpaint(V,X){pr.setOverpaint(y,V,z,!0,{geometry:E,props:w,webgl:X})},setTransparency(V,X){pr.setTransparency(y,V,z,!0,{geometry:E,props:w,webgl:X})},setSubstance(V,X){pr.setSubstance(y,V,z,!0,{geometry:E,props:w,webgl:X})},setClipping(V){pr.setClipping(y,V,z,!0)},setThemeStrength(V){pr.setThemeStrength(y,V)},destroy(){u?.(E),y&&(y.state.disposed=!0,y=void 0)},mustRecreate:l}}const kA={...Lye,...ed};function Hy(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.createGeometry=!0)},geometryUtils:on.Utils},t)}const Gmt={...jye,...ed},Wmt={...Uye,...ed},Ymt={...zye,...ed},Kmt={...Vye,...ed},Qmt={...Hye,...ed},egt={...Gye,...ed};function Uo(e,t,n,r){let i=0;const{webgl:o}=t,s=new si,a=ky(),l=[],c=new Xn.GeometryState,u=gl.create();let f,p,m,h,d=new Map,g=Ia.createEmpty();function A(T,F,R){const{visible:N,alphaFactor:j,pickable:W,overpaint:z,transparency:$,substance:V,clipping:X,themeStrength:H,transform:oe,unitTransforms:te}=R;void 0!==N&&T.setVisibility(N),void 0!==j&&T.setAlphaFactor(j),void 0!==W&&T.setPickable(W),void 0!==z&&T.setOverpaint(z,o),void 0!==$&&T.setTransparency($,o),void 0!==V&&T.setSubstance(V,o),void 0!==X&&T.setClipping(X),void 0!==H&&T.setThemeStrength(H),void 0!==oe&&(oe!==u.transform||!fe.areEqual(oe,u.transform,wi))&&T.setTransform(oe),void 0!==te&&(te?T.setTransform(void 0,te.getSymmetryGroupTransforms(F)):te!==u.unitTransforms&&T.setTransform(void 0,null))}return{label:e,get groupCount(){let T=0;return d.forEach(({visual:F})=>{F.renderObject&&(T+=F.groupCount)}),T},get geometryVersion(){return c.version},get props(){return h},get params(){return m},get state(){return u},get theme(){return g},renderObjects:l,updated:s,createOrUpdate:function y(T={},F){return F&&F!==f&&(m=n(t,F),h||(h=I.getDefaultValues(m))),h=Object.assign({},h,T),Ke.create("Creating or updating UnitsRepresentation",function(){var R=le(function*(N){var j,W,z;if(!f&&!F)throw new Error("missing structure");if(F&&!f){p=F.unitSymmetryGroups;for(let $=0;$<p.length;$++){const V=p[$],X=r(a,F,h,o),H=X.createOrUpdate({webgl:o,runtime:N},g,h,{group:V,structure:F});H&&(yield H),A(X,V,u),d.set(V.hashCode,{visual:X,group:V}),N.shouldUpdate&&(yield N.update({message:"Creating or updating UnitsVisual",current:$,max:p.length}))}}else if(!F||Xe.areUnitIdsAndIndicesEqual(F,f)&&F.child===f.child)if(F&&F!==f&&Xe.areUnitIdsAndIndicesEqual(F,f)){p=F.unitSymmetryGroups;for(let $=0;$<p.length;$++){const V=p[$],X=d.get(V.hashCode);if(!X)throw new Error(`expected to find visual for hashCode ${V.hashCode}`);{let{visual:H}=X;if(null!==(W=H.mustRecreate)&&void 0!==W&&W.call(H,{group:V,structure:F},h,t.webgl)){H.destroy(),H=r(a,F,h,t.webgl),X.visual=H;const oe=H.createOrUpdate({webgl:o,runtime:N},g,h,{group:V,structure:F});oe&&(yield oe),A(H,V,u)}else{const oe=H.createOrUpdate({webgl:o,runtime:N},g,h,{group:V,structure:F});oe&&(yield oe)}X.group=V}N.shouldUpdate&&(yield N.update({message:"Creating or updating UnitsVisual",current:$,max:p.length}))}}else{const $=[];d.forEach(V=>$.push(V));for(let V=0,X=$.length;V<X;++V){let{visual:H,group:oe}=$[V];if(null!==(z=H.mustRecreate)&&void 0!==z&&z.call(H,{group:oe,structure:f},h,t.webgl)){H.destroy(),H=r(a,f,h,o),$[V].visual=H;const te=H.createOrUpdate({webgl:o,runtime:N},g,h,{group:oe,structure:f});te&&(yield te),A(H,oe,u)}else{const te=H.createOrUpdate({webgl:o,runtime:N},g,h);te&&(yield te)}N.shouldUpdate&&(yield N.update({message:"Creating or updating UnitsVisual",current:V,max:X}))}}else{p=F.unitSymmetryGroups;const $=d;d=new Map;for(let V=0;V<p.length;V++){const X=p[V],H=$.get(X.hashCode);if(H){let{visual:oe}=H;if(null!==(j=oe.mustRecreate)&&void 0!==j&&j.call(oe,{group:X,structure:F},h,o)){oe.destroy(),oe=r(a,F,h,o);const te=oe.createOrUpdate({webgl:o,runtime:N},g,h,{group:X,structure:F});te&&(yield te),A(oe,X,u)}else{const te=oe.createOrUpdate({webgl:o,runtime:N},g,h,{group:X,structure:F});te&&(yield te)}if(d.set(X.hashCode,{visual:oe,group:X}),$.delete(X.hashCode),oe.renderObject){const te=oe.renderObject.values.tMarker.ref.value.array;Qh(te,Pe.ofBounds(0,te.length),un.RemoveHighlight)}}else{const oe=r(a,F,h,o),te=oe.createOrUpdate({webgl:o,runtime:N},g,h,{group:X,structure:F});te&&(yield te),A(oe,X,u),d.set(X.hashCode,{visual:oe,group:X})}N.shouldUpdate&&(yield N.update({message:"Creating or updating UnitsVisual",current:V,max:p.length}))}$.forEach(({visual:V})=>{V.destroy()})}l.length=0,d.forEach(({visual:$})=>{$.renderObject&&(l.push($.renderObject),c.add($.renderObject.id,$.geometryVersion))}),c.snapshot(),F&&(f=F),s.next(i++)});return function(N){return R.apply(this,arguments)}}())},setState:function M(T){const{visible:F,alphaFactor:R,pickable:N,overpaint:j,transparency:W,substance:z,clipping:$,themeStrength:V,transform:X,unitTransforms:H,syncManually:oe,markerActions:te}=T,K={};void 0!==F&&(K.visible=F),void 0!==R&&(K.alphaFactor=R),void 0!==N&&(K.pickable=N),void 0!==j&&f&&(K.overpaint=Ea.remap(j,f)),void 0!==W&&f&&(K.transparency=dc.remap(W,f)),void 0!==z&&f&&(K.substance=fc.remap(z,f)),void 0!==$&&f&&(K.clipping=co.remap($,f)),void 0!==V&&(K.themeStrength=V),void 0!==X&&!fe.areEqual(X,u.transform,wi)&&(K.transform=X),(H!==u.unitTransforms||H?.version!==u.unitTransformsVersion)&&(K.unitTransforms=H,u.unitTransformsVersion=H?H?.version:-1),void 0!==oe&&(K.syncManually=oe),void 0!==te&&(K.markerActions=te),d.forEach(({visual:Q,group:G})=>A(Q,G,K)),gl.update(u,K)},setTheme:function E(T){g=T},getLoci:function v(T){let F=qr;return d.forEach(({visual:R})=>{const N=R.getLoci(T);uu(N)||(F=N)}),F},getAllLoci:function _(){var T;return[Xe.Loci(null!==(T=f.child)&&void 0!==T?T:f)]},eachLocation:function x(T){d.forEach(({visual:F})=>{F.eachLocation(T)})},mark:function w(T,F){if(!f||!uc.is(u.markerActions,F))return!1;if(Xe.isLoci(T)||Me.is(T)||fn.isLoci(T)){if(!Xe.areRootsEquivalent(T.structure,f))return!1;T=Yn.remap(T,f),(Xe.isLoci(T)||Me.is(T)&&Me.isWholeStructure(T))&&(T=KN)}else if(!Xu(T)&&!aP(T))return!1;if(Yn.isEmpty(T))return!1;let R=!1;return d.forEach(({visual:N})=>{R=N.mark(T,F)||R}),R},destroy:function D(){d.forEach(({visual:T})=>T.destroy()),d.clear()}}}function av(e,t){const{defaultProps:n,createGeometry:r,createLocationIterator:i,getLoci:o,eachLocation:s,setUpdateState:a,mustRecreate:l,processValues:c,dispose:u}=e,{createEmpty:d,updateValues:f,updateBoundingSphere:p,updateRenderableState:m,createPositionIterator:h}=e.geometryUtils,g=Ag.create(),y={loci:qr,action:un.None,status:-1};let v,w,A,M,E,D,F,R,x=Object.assign({},n),_=Ia.createEmpty(),T=-1;function j(H){if(g.createNew){if(F=i(w,x),!H)throw new Error("expected geometry to be given");v=function ngt(e,t,n,r,i,o){const{createValues:s,createRenderableState:a}=$a.getUtils(t),c=s(t,Rye(e,i.includeParent,t.boundingSphere,i.cellSize,i.batchSize),n,r,i),u=a(i);return Jw(t.kind,c,u,o)}(w,H,F,_,x,t),R=h(H,v.values)}else{if(!v)throw new Error("expected renderObject to be available");if(g.updateTransform){F=i(w,x);const{instanceCount:oe,groupCount:te}=F;x.instanceGranularity?hs(oe,"instance",v.values):hs(oe*te,"groupInstance",v.values)}if(g.updateMatrix&&(Rye(w,x.includeParent,v.values.invariantBoundingSphere.ref.value,x.cellSize,x.batchSize,v.values),"lodLevels"in v.values&&O.update(v.values.lodLevels,v.values.lodLevels.ref.value)),g.createGeometry){if(!H)throw new Error("expected geometry to be given");O.updateIfChanged(v.values.drawCount,$a.getDrawCount(H)),O.updateIfChanged(v.values.uVertexCount,$a.getVertexCount(H)),O.updateIfChanged(v.values.uGroupCount,$a.getGroupCount(H))}(g.updateTransform||g.createGeometry)&&(p(v.values,H||D),R=h(H||D,v.values)),g.updateSize&&"uSize"in v.values&&xy(F,_.size,v.values),g.updateColor&&Ef(F,R,_.color,v.values),f(v.values,x),m(v.state,x)}A=x,M=_,E=w,H&&(D=H,T+=1)}function V(H,oe,te){return function z(H){return!!(Xu(H)||Xe.isLoci(H)&&Xe.areRootsEquivalent(H.structure,E.structure)||Me.is(H)&&Xe.areRootsEquivalent(H.structure,E.structure)&&Me.isWholeStructure(H))}(H)?oe(Pe.ofBounds(0,A.instanceGranularity?F.instanceCount:F.groupCount*F.instanceCount)):A.instanceGranularity?function $(H,oe,te){let K=!1;if(fn.isLoci(H)){const{structure:Q,group:G}=oe;if(!Xe.areEquivalent(H.structure,Q))return!1;for(const Z of H.bonds){if(Z.aUnit!==Z.bUnit)continue;const ee=G.unitIndexMap.get(Z.aUnit.id);void 0!==ee&&te(Pe.ofSingleton(ee))&&(K=!0)}}else if(Me.is(H)){const{structure:Q,group:G}=oe;if(!Xe.areEquivalent(H.structure,Q))return!1;for(const Z of H.elements){const ee=G.unitIndexMap.get(Z.unit.id);void 0!==ee&&te(Pe.ofSingleton(ee))&&(K=!0)}}return K}(H,E,oe):s(H,E,oe,te)}function X(H){v&&c?.(v.values,D,A,M,H.webgl)}return{get groupCount(){return F?F.count:0},get renderObject(){return F&&F.count?v:void 0},get geometryVersion(){return T},createOrUpdate(H,oe,te,K){if(function N(H,oe,te){if(!te&&!E)throw new Error("missing structureGroup");if(x=oe,_=H,w=te,Ag.reset(g),!v||!E)return g.createNew=!0,void(g.createGeometry=!0);a(g,x,A,_,M,w,E),Xe.areHierarchiesEqual(E.structure,w.structure)||(g.updateTransform=!0,g.updateColor=!0,g.updateSize=!0),Rd.areEqual(_.color,M.color)||(g.updateColor=!0),E.structure.child!==w.structure.child&&(g.createGeometry=!0),(x.instanceGranularity!==A.instanceGranularity||x.cellSize!==A.cellSize||x.batchSize!==A.batchSize)&&(g.updateTransform=!0),tg(x.unitKinds,A.unitKinds)||(g.createGeometry=!0),w.group.transformHash!==E.group.transformHash&&(w.group.units.length!==E.group.units.length||g.updateColor?g.updateTransform=!0:g.updateMatrix=!0);const K=w.group.units[0],Q=E.group.units[0];ze.areOperatorsEqual(K,Q)||(g.updateTransform=!0),ze.areConformationsEqual(K,Q)||(g.createGeometry=!0),g.updateTransform&&(g.updateMatrix=!0),g.updateSize&&!("uSize"in v.values)&&(g.createGeometry=!0),(g.createGeometry||g.updateTransform)&&(E.structure.hashCode!==w.structure.hashCode&&(g.updateColor=!0,g.updateSize=!0),(_.color.granularity.startsWith("vertex")||v.values.dColorType.ref.value.startsWith("vertex")||_.color.granularity.startsWith("volume")||v.values.dColorType.ref.value.startsWith("volume"))&&(g.updateColor=!0))}(oe,te,K||E),g.createGeometry){const Q=function W(H,oe,te,K,Q,G){return function Bmt(e,t){for(let n=0,r=e.length;n<r;++n)if(ze.isAtomic(t)&&"atomic"===e[n]||ze.isSpheres(t)&&"spheres"===e[n]||ze.isGaussians(t)&&"gaussians"===e[n])return!0;return!1}(Q.unitKinds,oe)?r(H,oe,te,K,Q,G):d(G)}(H,w.group.units[0],w.structure,_,x,D);if(PR(Q))return Q.then(G=>{j(G),X(H)});j(Q)}else j();X(H)},getLoci:H=>v?o(H,E,v.id):qr,eachLocation(H){for(F.reset();F.hasNext;){const{location:oe,isSecondary:te}=F.move();H(oe,te)}},mark(H,oe){let te=!0;if(Me.is(H)){te=!1;const{invariantId:K}=E.group.units[0];for(const Q of H.elements)if(Q.unit.invariantId===K){te=!0;break}}return!!te&&pr.mark(v,H,oe,V,y)},setVisibility(H){pr.setVisibility(v,H)},setAlphaFactor(H){pr.setAlphaFactor(v,H)},setPickable(H){pr.setPickable(v,H)},setColorOnly(H){pr.setColorOnly(v,H)},setTransform(H,oe){pr.setTransform(v,H,oe)},setOverpaint(H,oe){pr.setOverpaint(v,H,V,!0,{geometry:D,props:A,webgl:oe})},setTransparency(H,oe){pr.setTransparency(v,H,V,!0,{geometry:D,props:A,webgl:oe})},setSubstance(H,oe){pr.setSubstance(v,H,V,!0,{geometry:D,props:A,webgl:oe})},setClipping(H){pr.setClipping(v,H,V,!0)},setThemeStrength(H){pr.setThemeStrength(v,H)},destroy(){u?.(D),v&&(v.state.disposed=!0,v=void 0)},mustRecreate:l}}const ml={...Lye,...ed};function mc(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.createGeometry=!0)},geometryUtils:on.Utils},t)}const vW={...jye,...ed};function xW(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:Rp.Utils},t)}const _W={...Uye,...ed};function SW(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:Wu.Utils},t)}const rgt={...Vmt,...ed},KF={...zye,...ed};function ZF(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:Mo.Utils},t)}const ogt={...Hye,...ed},agt={...Gye,...ed},gl={create:()=>({...Xn.createState(),unitTransforms:null,unitTransformsVersion:-1}),update:(e,t)=>{Xn.updateState(e,t),void 0!==t.unitTransforms&&(e.unitTransforms=t.unitTransforms)}},Gy=C(),MA=C(),RP=C(),QF=tt.add,qye=tt.add3;var NP;!function(e){e.create=function t(n=2048,r=1024,i){const o=tt.create(Float32Array,1,r,i?i.groupBuffer.ref.value:n),s=tt.create(Float32Array,3,r,i?i.startBuffer.ref.value:n),a=tt.create(Float32Array,3,r,i?i.endBuffer.ref.value:n),l=tt.create(Float32Array,1,r,i?i.scaleBuffer.ref.value:n),c=tt.create(Float32Array,1,r,i?i.capBuffer.ref.value:n),u=tt.create(Float32Array,1,r,i?i.colorModeBuffer.ref.value:n),d=(p,m,h,g,y,v,x,_,w,A,M)=>{for(let E=0;E<6;++E)qye(s,p,m,h),qye(a,g,y,v),QF(o,M),QF(l,x),QF(c,(_?1:0)+(w?2:0)),QF(u,A)},f=(p,m,h,g,y,v,x,_,w)=>{const A=C.distance(p,m),M=h%2!=0,E=Math.floor((h+1)/2),D=A/(h+.5);let T=2;C.setMagnitude(RP,C.sub(RP,m,p),D),C.copy(Gy,p);for(let F=0;F<E;++F)C.add(Gy,Gy,RP),M&&F===E-1?(C.copy(MA,m),x||(v=!1)):C.add(MA,Gy,RP),_&&(T=C.distance(p,MA)/(2*A)),d(Gy[0],Gy[1],Gy[2],MA[0],MA[1],MA[2],g,y,v,T,w),C.add(Gy,Gy,RP)};return{add:d,addFixedCountDashes:f,addFixedLengthDashes:(p,m,h,g,y,v,x,_)=>{const w=C.distance(p,m);f(p,m,w/h,g,y,v,!0,x,_)},getCylinders:()=>{const p=o.elementCount/6,m=tt.compact(o,!0),h=tt.compact(s,!0),g=tt.compact(a,!0),y=tt.compact(l,!0),v=tt.compact(c,!0),x=tt.compact(u,!0),_=i&&p<=i.cylinderCount?i.mappingBuffer.ref.value:new Float32Array(18*p),w=i&&p<=i.cylinderCount?i.indexBuffer.ref.value:new Uint32Array(12*p);return(!i||p>i.cylinderCount)&&function cgt(e,t,n){for(let r=0;r<e;++r){const i=18*r;t[i]=-1,t[i+1]=1,t[i+2]=-1,t[i+3]=-1,t[i+4]=-1,t[i+5]=-1,t[i+6]=1,t[i+7]=1,t[i+8]=-1,t[i+9]=1,t[i+10]=1,t[i+11]=1,t[i+12]=1,t[i+13]=-1,t[i+14]=-1,t[i+15]=1,t[i+16]=-1,t[i+17]=1}for(let r=0;r<e;++r){const i=6*r,o=12*r;n[o]=i,n[o+1]=i+1,n[o+2]=i+2,n[o+3]=i+1,n[o+4]=i+4,n[o+5]=i+2,n[o+6]=i+2,n[o+7]=i+4,n[o+8]=i+3,n[o+9]=i+4,n[o+10]=i+5,n[o+11]=i+3}}(p,_,w),Wu.create(_,w,m,h,g,y,v,x,p,i)}}}}(NP||(NP={}));const t2={linkScale:I.Numeric(.45,{min:0,max:1,step:.01}),linkSpacing:I.Numeric(1,{min:0,max:2,step:.01}),linkCap:I.Boolean(!1),aromaticScale:I.Numeric(.3,{min:0,max:1,step:.01}),aromaticSpacing:I.Numeric(1.5,{min:0,max:3,step:.01}),aromaticDashCount:I.Numeric(2,{min:1,max:6,step:1}),dashCount:I.Numeric(4,{min:0,max:10,step:1}),dashScale:I.Numeric(.8,{min:0,max:2,step:.1}),dashCap:I.Boolean(!0),stubCap:I.Boolean(!0),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo),colorMode:I.Select("default",I.arrayToOptions(["default","interpolate"]),xt.ShadingCategory)},Wye=(I.getDefaultValues(t2),{linkScale:I.Numeric(.5,{min:0,max:1,step:.1}),linkSpacing:I.Numeric(.1,{min:0,max:2,step:.01}),aromaticDashCount:I.Numeric(2,{min:1,max:6,step:1}),dashCount:I.Numeric(4,{min:0,max:10,step:1})}),$i=(I.getDefaultValues(Wye),C()),lv=C(),Hp=C(),ugt=C.create(0,1,0);function CW(e,t,n,r){C.normalize(lv,C.sub(lv,t,n)),null!==r?C.sub(Hp,t,r):C.copy(Hp,t),C.normalize(Hp,Hp);let i=C.dot(lv,Hp);return 1-Math.abs(i)<1e-5&&(C.set(Hp,1,0,0),i=C.dot(lv,Hp),1-Math.abs(i)<1e-5&&(C.set(Hp,0,1,0),i=C.dot(lv,Hp))),C.setMagnitude(lv,lv,i),C.sub(Hp,Hp,lv),C.normalize(e,Hp)}const im=C.scale,ts=C.add,ha=C.sub,gc=C.setMagnitude,dgt=C.dot;function n2(e,t,n,r){const{linkCount:i,referencePosition:o,position:s,style:a,radius:l,ignore:c,stub:u}=t;if(!i)return{mesh:on.createEmpty(r)};const{linkScale:d,linkSpacing:f,radialSegments:p,linkCap:m,aromaticScale:h,aromaticSpacing:g,aromaticDashCount:y,dashCount:v,dashScale:x,dashCap:_,stubCap:w}=n,A=2*p*i*2,M=Ct.createState(A,A/4,r),E=C(),D=C(),T=C(),F=C();let R=0;const N={radiusTop:1,radiusBottom:1,radialSegments:p,topCap:m,bottomCap:m};for(let z=0,$=i;z<$;++z){if(c&&c(z))continue;s(E,D,z),ts(F,F,E),ts(F,F,D),R+=2,ha($i,D,E);const V=dgt($i,ugt)>0,X=l(z),H=a?a(z):0,oe=w&&!!u&&u(z),[te,K]=V?[oe,m]:[m,oe];if(M.currentGroup=z,0===H)N.radiusTop=N.radiusBottom=X,N.topCap=te,N.bottomCap=K,Ur(M,E,D,.5,N);else if(1===H)N.radiusTop=N.radiusBottom=X*x,N.topCap=N.bottomCap=_,Yw(M,E,D,.5,v,oe,N);else if(2===H||3===H||4===H||5===H||7===H||8===H){const Q=2===H||3===H?2:4===H||5===H?3:1.5,G=X*(d/(.5*Q)),Z=(X-G)*f;if(CW(T,E,D,o?o(z):null),N.topCap=te,N.bottomCap=K,7===H||8===H){N.radiusTop=N.radiusBottom=X,Ur(M,E,D,.5,N);const ee=X+h*X+h*X*g;gc($i,ha($i,D,E),.5*X),ts(E,E,$i),ha(D,D,$i),N.radiusTop=N.radiusBottom=X*h,N.topCap=N.bottomCap=_,gc(T,T,ee),ha(E,E,T),ha(D,D,T),Yw(M,E,D,.5,y,oe,N),8===H&&(gc(T,T,2*ee),ts(E,E,T),ts(D,D,T),Yw(M,E,D,.5,y,oe,N))}else if(3===H||5===H){const ee=X+G+d*X*f;gc(T,T,ee),N.radiusTop=N.radiusBottom=X,Ur(M,E,D,.5,N),im($i,$i,f*d*.2),ts(E,E,$i),ha(D,D,$i),N.radiusTop=N.radiusBottom=G,N.topCap=V?oe:_,N.bottomCap=V?_:oe,gc(T,T,ee),ha(E,E,T),ha(D,D,T),Ur(M,E,D,.5,N),3===Q&&(gc(T,T,2*ee),ts(E,E,T),ts(D,D,T),Ur(M,E,D,.5,N))}else gc(T,T,Z),N.radiusTop=N.radiusBottom=G,3===Q&&Ur(M,E,D,.5,N),UKe(M,E,D,.5,T,N)}else 6===H&&(im($i,$i,.475),ts(E,E,$i),ha(D,D,$i),N.radiusTop=N.radiusBottom=X,N.topCap=te,N.bottomCap=K,Ur(M,E,D,.5,N))}const j=r?ke.clone(r.boundingSphere):void 0,W=Ct.getMesh(M);return 0===R?{mesh:W}:(C.scale(F,F,1/R),j&&C.distance(F,j.center)/j.radius<.1?{mesh:W,boundingSphere:j}:{mesh:W})}function $ye(e,t,n,r){const{linkCount:i,referencePosition:o,position:s,style:a,radius:l,ignore:c,stub:u}=t;if(!i)return{cylinders:Wu.createEmpty(r)};const{linkScale:d,linkSpacing:f,linkCap:p,aromaticScale:m,aromaticSpacing:h,aromaticDashCount:g,dashCount:y,dashScale:v,dashCap:x,stubCap:_,colorMode:w}=n,A="interpolate"===w,M=!0===A?3:2,E=2*i,D=NP.create(E,E/4,r),T=C(),F=C(),R=C(),N=C(),j=C();let W=0;for(let V=0,X=i;V<X;++V){if(c&&c(V))continue;s(T,F,V),ts(j,j,T),ts(j,j,F),W+=2;const H=l(V),oe=a?a(V):0,te=_&&!!u&&u(V);if(0===oe)im(R,ts(R,T,F),.5),D.add(T[0],T[1],T[2],R[0],R[1],R[2],1,p,te,M,V);else if(1===oe)im(R,ts(R,T,F),.5),D.addFixedCountDashes(T,R,y,v,x,x,te,A,V);else if(2===oe||3===oe||4===oe||5===oe||7===oe||8===oe){const K=2===oe||3===oe?2:4===oe||5===oe?3:1.5,Q=d/(.5*K),G=(H-Q*H)*f;if(im(R,ts(R,T,F),.5),CW(N,T,F,o?o(V):null),7===oe||8===oe){D.add(T[0],T[1],T[2],R[0],R[1],R[2],1,p,te,M,V);const Z=H+m*H+m*H*h;gc($i,ha($i,F,T),.5*H),ts(T,T,$i),gc(N,N,Z),ha(T,T,N),ha(R,R,N),D.addFixedCountDashes(T,R,g,m,x,x,te,A,V),8===oe&&(gc(N,N,2*Z),ts(T,T,N),ts(R,R,N),D.addFixedCountDashes(T,R,g,m,x,x,te,A,V))}else 3===oe||5===oe?(gc(N,N,H+Q*H+d*H*f),D.add(T[0],T[1],T[2],R[0],R[1],R[2],1,p,te,M,V),gc($i,ha($i,T,R),H/1.5),ha(T,T,$i),3===K&&D.add(T[0]+N[0],T[1]+N[1],T[2]+N[2],R[0]+N[0],R[1]+N[1],R[2]+N[2],Q,p,te,M,V),D.add(T[0]-N[0],T[1]-N[1],T[2]-N[2],R[0]-N[0],R[1]-N[1],R[2]-N[2],Q,x,te,M,V)):(gc(N,N,G),3===K&&D.add(T[0],T[1],T[2],R[0],R[1],R[2],Q,p,te,M,V),D.add(T[0]+N[0],T[1]+N[1],T[2]+N[2],R[0]+N[0],R[1]+N[1],R[2]+N[2],Q,p,te,M,V),D.add(T[0]-N[0],T[1]-N[1],T[2]-N[2],R[0]-N[0],R[1]-N[1],R[2]-N[2],Q,p,te,M,V))}else 6===oe&&(im($i,ha($i,R,T),.475),ts(T,T,$i),ha(R,R,$i),D.add(T[0],T[1],T[2],R[0],R[1],R[2],1,p,te,M,V))}const z=r?ke.clone(r.boundingSphere):void 0,$=D.getCylinders();return 0===W?{cylinders:$}:(C.scale(j,j,1/W),z&&C.distance(j,z.center)/z.radius<.1?{cylinders:$,boundingSphere:z}:{cylinders:$})}function Yye(e,t,n,r){const{linkCount:i,referencePosition:o,position:s,style:a,ignore:l}=t;if(!i)return{lines:Mo.createEmpty(r)};const{linkScale:c,linkSpacing:u,aromaticDashCount:d,dashCount:f}=n,p=2*i,m=Pd.create(p,p/4,r),h=C(),g=C(),y=C(),v=C(),x=C();let _=0;for(let D=0,T=i;D<T;++D){if(l&&l(D))continue;s(h,g,D),ts(x,x,h),ts(x,x,g),_+=2;const F=a?a(D):0;if(0===F)im(y,ts(y,h,g),.5),m.add(h[0],h[1],h[2],y[0],y[1],y[2],D);else if(1===F)im(y,ts(y,h,g),.5),m.addFixedCountDashes(h,y,f,D);else if(2===F||3===F||4===F||5===F||7===F||8===F){const R=2===F||3===F?2:4===F||5===F?3:1.5,j=(1-c/(.5*R)*1)*u;if(im(y,ts(y,h,g),.5),CW(v,h,g,o?o(D):null),7===F||8===F){m.add(h[0],h[1],h[2],y[0],y[1],y[2],D);const W=4.5*j;gc($i,ha($i,g,h),.5*W),ts(h,h,$i),gc(v,v,W),ha(h,h,v),ha(y,y,v),m.addFixedCountDashes(h,y,d,D),8===F&&(gc(v,v,2*W),ts(h,h,v),ts(y,y,v),m.addFixedCountDashes(h,y,d,D))}else 3===F||5===F?(gc(v,v,3*j),m.add(h[0],h[1],h[2],y[0],y[1],y[2],D),im($i,ha($i,h,y),u*c),ha(h,h,$i),3===R&&m.add(h[0]+v[0],h[1]+v[1],h[2]+v[2],y[0]+v[0],y[1]+v[1],y[2]+v[2],D),m.add(h[0]-v[0],h[1]-v[1],h[2]-v[2],y[0]-v[0],y[1]-v[1],y[2]-v[2],D)):(gc(v,v,1.5*j),3===R&&m.add(h[0],h[1],h[2],y[0],y[1],y[2],D),m.add(h[0]+v[0],h[1]+v[1],h[2]+v[2],y[0]+v[0],y[1]+v[1],y[2]+v[2],D),m.add(h[0]-v[0],h[1]-v[1],h[2]-v[2],y[0]-v[0],y[1]-v[1],y[2]-v[2],D))}else 6===F&&(im($i,ha($i,y,h),.475),ts(h,h,$i),ha(y,y,$i),m.add(h[0],h[1],h[2],y[0],y[1],y[2],D))}const M=r?ke.clone(r.boundingSphere):void 0,E=m.getLines();return 0===_?{lines:E}:(C.scale(x,x,1/_),M&&C.distance(x,M.center)/M.radius<.1?{lines:E,boundingSphere:M}:{lines:E})}const Xye={sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),dashCount:I.Numeric(6,{min:1,max:10,step:1}),dashScale:I.Numeric(.4,{min:0,max:2,step:.1}),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),includeParent:I.Boolean(!1),parentDisplay:I.Select("stub",I.arrayToOptions(["stub","full","between"]),{description:'Only has an effect when "includeParent" is enabled. "Stub" shows just the child side of interactions to the parent. "Full" shows both sides of interactions to the parent. "Between" shows only interactions to the parent.'})};function fgt(e,t,n,r,i,o){return wW.apply(this,arguments)}function wW(){return(wW=le(function*(e,t,n,r,i,o){if(!ze.isAtomic(t))return on.createEmpty(o);const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return on.createEmpty(o);const l=dt.create(n,t),c=ks.get(n).value,u=c.unitsFeatures.get(t.id),d=c.unitsContacts.get(t.id),{x:f,y:p,z:m,members:h,offsets:g}=u,{edgeCount:y,a:v,b:x,edgeProps:{flag:_,type:w}}=d,{sizeFactor:A,ignoreHydrogens:M,ignoreHydrogensVariant:E,parentDisplay:D}=i;if(!y)return on.createEmpty(o);const{elements:T,conformation:F}=t,R=C(),N=C(),j=C(),W={linkCount:2*y,position:(V,X,H)=>{const oe=w[H];if(M&&"all"===E||oe!==Er.HydrogenBond&&oe!==Er.WeakHydrogenBond)C.set(V,f[v[H]],p[v[H]],m[v[H]]),C.set(X,f[x[H]],p[x[H]],m[x[H]]);else{const te=h[g[v[H]]],K=h[g[x[H]]];F.invariantPosition(T[te],N),F.invariantPosition(T[K],j);let Q=C.distance(N,j),G=Q;C.copy(V,N),C.copy(X,j),Kq(t,te,(Z,ee)=>{if(rm(n,t,T[ee],"polar")){F.invariantPosition(T[ee],R);const se=C.distance(R,j);se<Q&&(Q=se,C.copy(V,R))}}),Kq(t,K,(Z,ee)=>{if(rm(n,t,T[ee],"polar")){F.invariantPosition(T[ee],R);const se=C.distance(R,N);se<G&&(G=se,C.copy(X,R))}})}},style:V=>1,radius:V=>{l.element=T[h[g[v[V]]]];const X=r.size.size(l);l.element=T[h[g[x[V]]]];const H=r.size.size(l);return Math.min(X,H)*A},ignore:V=>{if(_[V]===Mg.Filtered)return!0;if(a)if("stub"===D){const X=v[V];for(let H=g[X],oe=g[X+1];H<oe;++H)if(!rt.has(a.elements,T[h[g[H]]]))return!0}else{if("full"===D||"between"===D){let X=!1,H=!1;const oe=v[V];for(let K=g[oe],Q=g[oe+1];K<Q;++K)rt.has(a.elements,T[h[g[K]]])||(X=!0);const te=x[V];for(let K=g[te],Q=g[te+1];K<Q;++K)rt.has(a.elements,T[h[g[K]]])||(H=!0);return"full"===D?X&&H:X===H}Hi()}return!1}},{mesh:z,boundingSphere:$}=n2(0,W,i,o);if($)z.setBoundingSphere($);else if(z.triangleCount>0){const V=ke.expand(ke(),(a??t).boundary.sphere,1*A);z.setBoundingSphere(V)}return z})).apply(this,arguments)}const Kye={...ml,...t2,...Xye};function pgt(e){return mc({defaultProps:I.getDefaultValues(Kye),createGeometry:fgt,createLocationIterator:ggt,getLoci:hgt,eachLocation:mgt,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.dashCount!==r.dashCount||n.dashScale!==r.dashScale||n.dashCap!==r.dashCap||n.radialSegments!==r.radialSegments||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.parentDisplay!==r.parentDisplay;const l=ks.get(s.structure).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function hgt(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e;if(n===r){const{structure:s,group:a}=t,l=s.unitMap.get(a.units[i].id),c=ks.get(s).value,{a:u,b:d}=c.unitsContacts.get(l.id);return Vy.Loci(s,c,[{unitA:l,indexA:u[o],unitB:l,indexB:d[o]},{unitA:l,indexA:d[o],unitB:l,indexB:u[o]}])}return qr}const AW=new Set;function mgt(e,t,n,r){let i=!1;if(Vy.isLoci(e)){const{structure:o,group:s}=t;if(!Xe.areEquivalent(e.data.structure,o))return!1;const a=ks.get(o).value;if(e.data.interactions!==a)return!1;const c=a.unitsContacts.get(s.units[0].id),u=2*c.edgeCount;for(const d of e.elements){if(d.unitA!==d.unitB)continue;const f=s.unitIndexMap.get(d.unitA.id);if(void 0!==f){const p=c.getDirectedEdgeIndex(d.indexA,d.indexB);-1!==p&&n(Pe.ofSingleton(f*u+p))&&(i=!0)}}}else if(Me.is(e)){const{structure:o,group:s}=t;if(!Xe.areEquivalent(e.structure,o))return!1;const a=ks.get(o).value;if(!a)return!1;const l=s.units[0],c=a.unitsContacts.get(l.id),u=a.unitsFeatures.get(l.id),d=2*c.edgeCount,{offset:f}=c,{offsets:p,indices:m}=u.elementsIndex,{members:h,offsets:g}=u;for(const y of e.elements){const v=s.unitIndexMap.get(y.unit.id);void 0!==v&&(Ve.forEach(y.indices,x=>{for(let _=p[x],w=p[x+1];_<w;++_){const A=m[_];for(let M=f[A],E=f[A+1];M<E;++M)AW.add(M)}}),AW.forEach(x=>{if(r){const _=c.a[x];for(let A=g[_],M=g[_+1];A<M;++A)if(!Ve.has(y.indices,h[A]))return;const w=c.b[x];for(let A=g[w],M=g[w+1];A<M;++A)if(!Ve.has(y.indices,h[A]))return}n(Pe.ofSingleton(v*d+x))&&(i=!0)}),AW.clear())}}return i}function ggt(e){const{structure:t,group:n}=e,r=n.units[0],i=ks.get(t).value,o=i.unitsContacts.get(r.id),s=2*o.edgeCount,a=n.units.length,l=Vy.Location(i,t),{element:c}=l;return Vi(s,a,1,(d,f)=>{const p=n.units[f];return c.unitA=p,c.indexA=o.a[d],c.unitB=p,c.indexB=o.b[d],l})}function ygt(e,t,n,r,i){if(!t.hasAtomic)return on.createEmpty(i);const o=dt.create(t),s=ks.get(t).value,{contacts:a,unitsFeatures:l}=s,{edgeCount:c,edges:u}=a,{sizeFactor:d,ignoreHydrogens:f,ignoreHydrogensVariant:p,parentDisplay:m}=r;if(!c)return on.createEmpty(i);const{child:h}=t,g=C(),y=C(),v=C(),x={linkCount:c,position:(A,M,E)=>{const{unitA:D,indexA:T,unitB:F,indexB:R,props:{type:N}}=u[E],j=l.get(D),W=l.get(F),z=t.unitMap.get(D),$=t.unitMap.get(F);if(f&&"all"===p||N!==Er.HydrogenBond&&N!==Er.WeakHydrogenBond)C.set(A,j.x[T],j.y[T],j.z[T]),C.transformMat4(A,A,z.conformation.operator.matrix),C.set(M,W.x[R],W.y[R],W.z[R]),C.transformMat4(M,M,$.conformation.operator.matrix);else{const V=j.members[j.offsets[T]],X=W.members[W.offsets[R]];z.conformation.position(z.elements[V],y),$.conformation.position($.elements[X],v);let H=C.distance(y,v),oe=H;C.copy(A,y),C.copy(M,v),Ju(t,z,V,(te,K)=>{const Q=te.elements[K];if(rm(t,te,Q,"polar")){te.conformation.position(Q,g);const G=C.distance(g,v);G<H&&(H=G,C.copy(A,g))}}),Ju(t,$,X,(te,K)=>{const Q=te.elements[K];if(rm(t,te,Q,"polar")){te.conformation.position(Q,g);const G=C.distance(g,y);G<oe&&(oe=G,C.copy(M,g))}})}},style:A=>1,radius:A=>{const M=u[A],E=l.get(M.unitA);o.unit=t.unitMap.get(M.unitA),o.element=o.unit.elements[E.members[E.offsets[M.indexA]]];const D=n.size.size(o),T=l.get(M.unitB);o.unit=t.unitMap.get(M.unitB),o.element=o.unit.elements[T.members[T.offsets[M.indexB]]];const F=n.size.size(o);return Math.min(D,F)*d},ignore:A=>{if(u[A].props.flag===Mg.Filtered)return!0;if(h){const M=u[A];if("stub"===m){const E=h.unitMap.get(M.unitA);if(!E)return!0;const D=t.unitMap.get(M.unitA),{offsets:T,members:F}=l.get(M.unitA);for(let R=T[M.indexA],N=T[M.indexA+1];R<N;++R)if(!rt.has(E.elements,D.elements[F[R]]))return!0}else{if("full"===m||"between"===m){let E=!1,D=!1;const T=h.unitMap.get(M.unitA);if(T){const R=t.unitMap.get(M.unitA),{offsets:N,members:j}=l.get(M.unitA);for(let W=N[M.indexA],z=N[M.indexA+1];W<z;++W)rt.has(T.elements,R.elements[j[W]])||(E=!0)}else E=!0;const F=h.unitMap.get(M.unitB);if(F){const R=t.unitMap.get(M.unitB),{offsets:N,members:j}=l.get(M.unitB);for(let W=N[M.indexB],z=N[M.indexB+1];W<z;++W)rt.has(F.elements,R.elements[j[W]])||(D=!0)}else D=!0;return"full"===m?E&&D:E===D}Hi()}}return!1}},{mesh:_,boundingSphere:w}=n2(0,x,r,i);if(w)_.setBoundingSphere(w);else if(_.triangleCount>0){const{child:A}=t,M=ke.expand(ke(),(A??t).boundary.sphere,1*d);_.setBoundingSphere(M)}return _}const Zye={...kA,...t2,...Xye};function bgt(e){return Hy({defaultProps:I.getDefaultValues(Zye),createGeometry:ygt,createLocationIterator:_gt,getLoci:vgt,eachLocation:xgt,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.dashCount!==r.dashCount||n.dashScale!==r.dashScale||n.dashCap!==r.dashCap||n.radialSegments!==r.radialSegments||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.parentDisplay!==r.parentDisplay;const l=ks.get(s).version;t.info.interactionsHash!==l&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.info.interactionsHash=l)}},e)}function vgt(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const o=ks.get(t).value,s=o.contacts.edges[i],a=t.unitMap.get(s.unitA),l=t.unitMap.get(s.unitB);return Vy.Loci(t,o,[{unitA:a,indexA:s.indexA,unitB:l,indexB:s.indexB},{unitA:l,indexA:s.indexB,unitB:a,indexB:s.indexA}])}return qr}const JF=new Map,IW=new Set;function xgt(e,t,n,r){let i=!1;if(Vy.isLoci(e)){if(!Xe.areEquivalent(e.data.structure,t))return!1;const o=ks.get(t).value;if(e.data.interactions!==o)return!1;const{contacts:s}=o;for(const a of e.elements){const l=s.getEdgeIndex(a.indexA,a.unitA.id,a.indexB,a.unitB.id);-1!==l&&n(Pe.ofSingleton(l))&&(i=!0)}}else if(Me.is(e)){if(!Xe.areEquivalent(e.structure,t)||r&&1===e.elements.length)return!1;const o=ks.get(t).value;if(!o)return!1;const{contacts:s,unitsFeatures:a}=o;for(const l of e.elements)JF.set(l.unit.id,l.indices);for(const l of e.elements){const{unit:c}=l;ze.isAtomic(c)&&Ve.forEach(l.indices,u=>{for(const d of s.getContactIndicesForElement(u,c))IW.add(d)})}IW.forEach(l=>{if(r){const{indexA:c,unitA:u,indexB:d,unitB:f}=s.edges[l],p=JF.get(u),m=JF.get(f);if(!p||!m)return;const{offsets:h,members:g}=a.get(u);for(let x=h[c],_=h[c+1];x<_;++x)if(!Ve.has(p,g[x]))return;const{offsets:y,members:v}=a.get(f);for(let x=y[d],_=y[d+1];x<_;++x)if(!Ve.has(m,v[x]))return}n(Pe.ofSingleton(l))&&(i=!0)}),JF.clear(),IW.clear()}return i}function _gt(e){const t=ks.get(e).value,{contacts:n}=t,r=n.edgeCount,o=Vy.Location(t,e),{element:s}=o;return Vi(r,1,1,l=>{const c=n.edges[l];return s.unitA=e.unitMap.get(c.unitA),s.indexA=c.indexA,s.unitB=e.unitMap.get(c.unitB),s.indexB=c.indexB,o},!0)}const Qye={"intra-unit":(e,t)=>Uo("Intra-unit interactions cylinder",e,t,pgt),"inter-unit":(e,t)=>Ff("Inter-unit interactions cylinder",e,t,bgt)},Jye={...Kye,...Zye,unitKinds:MP(["atomic"]),sizeFactor:I.Numeric(.2,{min:.01,max:1,step:.01}),visuals:I.MultiSelect(["intra-unit","inter-unit"],I.objectToOptions(Qye))},eO={name:"interactions",label:"Non-covalent Interactions",description:"Displays non-covalent interactions as dashed cylinders.",factory:function Cgt(e,t){return Xn.createMulti("Interactions",e,t,gl,Qye)},getParams:function Sgt(e,t){return I.clone(Jye)},defaultValues:I.getDefaultValues(Jye),defaultColorTheme:{name:"interaction-type"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&ks.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>ks.attach(e,t,void 0,!0),detach:e=>ks.ref(e,!1)},getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent},wgt=ii.create({name:"computed-interactions-prop",category:"custom-props",display:{name:"Interactions"},ctor:class extends ii.Handler{constructor(){super(...arguments),this.provider=ks,this.labelProvider={label:e=>{if(this.params.showTooltip&&"element-loci"===e.kind){if(0===e.elements.length)return;const t=[],n=this.getStructures(e.structure);for(const r of n){const i=this.provider.get(r).value;if(!i)continue;const o=Me.remap(e,r);if(1!==o.elements.length)continue;const s=o.elements[0];if(1!==Ve.size(s.indices))continue;const a=i.unitsFeatures.get(s.unit.id);if(!a)continue;const l=[],c=[],u=[],d=Ve.start(s.indices),{types:f,groups:p,elementsIndex:{indices:m,offsets:h}}=a;for(let g=h[d],y=h[d+1];g<y;++g){const v=m[g],x=f[v],_=p[v];x&&l.push(Mpt(x)),_&&c.push(Rpt(_))}l.length&&u.push(`<small>Types</small> ${l.join(", ")}`),c.length&&u.push(`<small>Groups</small> ${c.join(", ")}`),u.length&&t.push(`Interaction Feature: ${u.join(" | ")}`)}return t.length?t.join("<br/>"):void 0}}}}getStructures(e){const t=[],n=this.ctx.helpers.substructureParent.get(e);if(n){const i=this.ctx.state.data.select(Qn.Generators.ofType(Se.Molecule.Structure,n.transform.ref));for(const o of i)o.obj&&Us(t,o.obj.data)}return t}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(yW),this.ctx.managers.lociLabels.addProvider(this.labelProvider),this.ctx.representation.structure.registry.add(eO)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(yW),this.ctx.managers.lociLabels.removeProvider(this.labelProvider),this.ctx.representation.structure.registry.remove(eO)}},params:()=>({autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)})}),Agt=ii.create({name:"computed-secondary-structure-prop",category:"custom-props",display:{name:"Secondary Structure"},ctor:class extends ii.Handler{constructor(){super(...arguments),this.provider=gp}update(e){const t=this.params.autoAttach!==e.autoAttach;return this.params.autoAttach=e.autoAttach,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name)}},params:()=>({autoAttach:I.Boolean(!1)})}),Igt=ii.create({name:"computed-valence-model-prop",category:"custom-props",display:{name:"Valence Model"},ctor:class extends ii.Handler{constructor(){super(...arguments),this.provider=DP,this.labelProvider={label:e=>{if(this.params.showTooltip&&"element-loci"===e.kind){if(0===e.elements.length)return;const t=[],n=this.getStructures(e.structure);for(const r of n){const i=this.provider.get(r).value;if(!i)continue;const o=Me.remap(e,r);if(1!==o.elements.length)continue;const s=o.elements[0];if(1!==Ve.size(s.indices))continue;const a=i.get(s.unit.id);if(!a)continue;const l=Ve.start(s.indices),d=a.implicitH[l],f=a.totalH[l];t.push(`Valence Model: <small>Charge</small> ${a.charge[l]} | <small>Ideal Geometry</small> ${wpt(a.idealGeometry[l])} | <small>Implicit H</small> ${d} | <small>Total H</small> ${f}`)}return t.length?t.join("<br/>"):void 0}}}}getStructures(e){const t=[],n=this.ctx.helpers.substructureParent.get(e);if(n){const i=this.ctx.state.data.select(Qn.Generators.ofType(Se.Molecule.Structure,n.transform.ref));for(const o of i)o.obj&&Us(t,o.obj.data)}return t}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customStructureProperties.register(this.provider,this.params.autoAttach),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customStructureProperties.unregister(this.provider.descriptor.name),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:I.Boolean(!1),showTooltip:I.Boolean(!0)})}),EW=st(16448250),FP=new Map,ebe={...cu({type:"colors",colorList:"set-1"})},nbe={name:"sifts-mapping",label:"SIFTS Mapping",category:Rd.Category.Residue,factory:function tbe(e,t){let n;if(e.structure){for(const a of e.structure.models){const l=yp.Provider.get(a).value;if(l)for(const c of l.accession)!c||FP.has(c)||FP.set(c,FP.size)}const r=dt.create(e.structure),i=Yu(FP.size+1,t,{valueLabel:a=>`${a}`}),o=new Map,s=a=>{const l=yp.getKey(a);if(!l)return EW;if(o.has(l))return o.get(l);const c=i.color(FP.get(l));return o.set(l,c),c};n=a=>dt.is(a)&&ze.isAtomic(a.unit)?s(a):fn.isLocation(a)?(r.unit=a.aUnit,r.element=a.aUnit.elements[a.aIndex],s(r)):EW}else n=()=>EW;return{factory:tbe,granularity:"group",preferSmoothing:!0,color:n,props:t,description:"Assigns a color based on SIFTS mapping."}},getParams:function Tgt(e){return ebe},defaultValues:I.getDefaultValues(ebe),isApplicable:e=>{var t;return!(null===(t=e.structure)||void 0===t||!t.models.some(n=>yp.Provider.isApplicable(n)))},ensureCustomProperties:{attach:function(){var e=le(function*(t,n){if(n.structure)for(const r of n.structure.models)yield yp.Provider.attach(t,r,void 0,!0)});return function(n,r){return e.apply(this,arguments)}}(),detach:e=>{if(e.structure)for(const t of e.structure.models)yp.Provider.ref(t,!1)}}},Dgt=ii.create({name:"sifts-mapping-prop",category:"custom-props",display:{name:"SIFTS Mapping"},ctor:class extends ii.Handler{constructor(){super(...arguments),this.provider=yp.Provider,this.labelProvider={label:e=>{if(this.params.showTooltip)return function Pgt(e){if("element-loci"===e.kind){if(0===e.elements.length)return;const t=e.elements[0],n=t.unit,r=dt.create(e.structure,n,n.elements[Ve.getAt(t.indices,0)]);return yp.getLabel(r)}}(e)}}}update(e){const t=this.params.autoAttach!==e.autoAttach||this.params.showTooltip!==e.showTooltip;return this.params.autoAttach=e.autoAttach,this.params.showTooltip=e.showTooltip,this.ctx.customStructureProperties.setDefaultAutoAttach(this.provider.descriptor.name,this.params.autoAttach),t}register(){this.ctx.customModelProperties.register(this.provider,this.params.autoAttach),this.ctx.representation.structure.themes.colorThemeRegistry.add(nbe),this.ctx.managers.lociLabels.addProvider(this.labelProvider)}unregister(){this.ctx.customModelProperties.unregister(this.provider.descriptor.name),this.ctx.representation.structure.themes.colorThemeRegistry.remove(nbe),this.ctx.managers.lociLabels.removeProvider(this.labelProvider)}},params:()=>({autoAttach:I.Boolean(!0),showTooltip:I.Boolean(!0)})});var qy;!function(e){e.Descriptor={name:"ihm_cross_link_restraint"},e.Provider=jh.create(e.Descriptor),e.fromTable=function t(n,r){const i={entity_id:n.entity_id_1,asym_id:n.asym_id_1,seq_id:n.seq_id_1,atom_id:n.atom_id_1},o={entity_id:n.entity_id_2,asym_id:n.asym_id_2,seq_id:n.seq_id_2,atom_id:n.atom_id_2};function s(p,m,h){const g=p.get(m);g?g.push(h):p.set(m,[h])}function a(p,m){const h=m.entity_id.value(p),g=m.asym_id.value(p),y=m.seq_id.value(p);if("by-atom"===n.model_granularity.value(p)){const v=r.atomicHierarchy.index.findAtom({auth_seq_id:y,label_asym_id:g,label_atom_id:m.atom_id.value(p),label_entity_id:h});v>=0&&s(c,v,p)}else if(r.coarseHierarchy.isDefined){const v=r.coarseHierarchy.spheres.findSequenceKey(h,g,y);if(v>=0)s(u,v,p);else{const x=r.coarseHierarchy.gaussians.findSequenceKey(h,g,y);x>=0&&s(d,x,p)}}}const c=new Map,u=new Map,d=new Map,f=[];for(let p=0;p<n._rowCount;++p)a(p,i),a(p,o);return{getIndicesByElement:(p,m)=>{const g=function l(p){switch(p){case 0:return c;case 1:return u;case 2:return d}}(m).get(p);return void 0!==g?g:f},data:n}}}(qy||(qy={}));const kgt=[];function rbe(e,t,n,r){return`${e}|${t.id}|${n}|${r.id}`}class ibe{getPairIndices(t,n,r,i){const o=rbe(t,n,r,i);return this.pairKeyIndices.get(o)||kgt}getPairs(t,n,r,i){return this.getPairIndices(t,n,r,i).map(s=>this.pairs[s])}constructor(t){this.pairs=t;const n=new Map;this.pairs.forEach((r,i)=>{const o=rbe(r.indexA,r.unitA,r.indexB,r.unitB),s=n.get(o);s?s.push(i):n.set(o,[i])}),this.count=t.length,this.pairKeyIndices=n}}const Wy=iy.createProvider({label:"Cross Link Restraint",descriptor:hf({name:"integrative-cross-link-restraint"}),type:"local",defaultParams:{},getParams:e=>({}),isApplicable:e=>e.models.some(t=>!!qy.Provider.get(t)),obtain:function(){var e=le(function*(t,n,r){return{value:Ngt(n)}});return function(n,r,i){return e.apply(this,arguments)}}()});var om;function obe(e,t,n){const{elements:r}=t,i=r.length,o=t.kind;for(let s=0;s<i;s++)n.getIndicesByElement(r[s],o).forEach(l=>e.set(l,s))}function Mgt(e,t,n){if(t.model!==n.model||"mmCIF"!==t.model.sourceData.kind)return;const r=qy.Provider.get(t.model);if(!r)return;const i=new Map,o=new Map;obe(i,t,r),obe(o,n,r),i.forEach((s,a)=>{const l=o.get(a);void 0!==l&&e.push(tO(t,s,n,l,r,a),tO(n,l,t,s,r,a))})}function Rgt(e,t){if("mmCIF"!==t.model.sourceData.kind)return;const n=qy.Provider.get(t.model);if(!n)return;const{elements:r}=t,i=r.length,o=t.kind,s=new Map;for(let a=0;a<i;a++)n.getIndicesByElement(r[a],o).forEach(c=>{const u=s.get(c);u?u.push(a):s.set(c,[a])});s.forEach((a,l)=>{if(a.length<2)return;const[c,u]=a;e.push(tO(t,c,t,u,n,l),tO(t,u,t,c,n,l))})}function tO(e,t,n,r,i,o){return{unitA:e,indexA:t,unitB:n,indexB:r,restraintType:i.data.restraint_type.value(o),distanceThreshold:i.data.distance_threshold.value(o),psi:i.data.psi.value(o),sigma1:i.data.sigma_1.value(o),sigma2:i.data.sigma_2.value(o)}}function Ngt(e){const t=[];if(!e.models.some(r=>qy.Provider.get(r)))return new ibe(t);const n=e.units.length;for(let r=0;r<n;++r){const i=e.units[r];Rgt(t,i);for(let o=r+1;o<n;++o){const s=e.units[o];i.model===s.model&&Mgt(t,i,s)}}return new ibe(t)}function Fgt(e,t,n,r,i){const o=Wy.get(t).value;if(!o.count)return on.createEmpty(i);const{sizeFactor:s}=r,a=dt.create(t),l={linkCount:o.count,position:(d,f,p)=>{const m=o.pairs[p],h=m.unitA,g=m.unitB;h.conformation.position(h.elements[m.indexA],d),g.conformation.position(g.elements[m.indexB],f)},radius:d=>{const f=o.pairs[d];return a.unit=f.unitA,a.element=f.unitA.elements[f.indexA],n.size.size(a)*s}},{mesh:c,boundingSphere:u}=n2(0,l,r,i);if(u)c.setBoundingSphere(u);else if(c.triangleCount>0){const d=ke.expand(ke(),t.boundary.sphere,1*s);c.setBoundingSphere(d)}return c}!function(e){let t;(t=e.Tag||(e.Tag={})).CrossLinkRestraint="cross-link-restraint",e.isApplicable=function n(h){return h.models.some(g=>!!qy.Provider.get(g))};const r=C(),i=C();function o(h){return h.unitA.conformation.position(h.unitA.elements[h.indexA],r),h.unitB.conformation.position(h.unitB.elements[h.indexB],i),C.distance(r,i)}function c(h,g){const y=h.pairs[g];return`Cross Link Restraint | Type: ${y.restraintType} | Threshold: ${y.distanceThreshold} \u212b | Psi: ${y.psi} | Sigma 1: ${y.sigma1} | Sigma 2: ${y.sigma2} | Distance: ${o(y).toFixed(2)} \u212b`}function p(h,g,y){return X0.fromPairProvider(g.length,(v,x,_)=>{const w=h.pairs[g[v]];w.unitA.conformation.position(w.unitA.elements[w.indexA],x),w.unitB.conformation.position(w.unitB.elements[w.indexB],_)},y)}function m(h,g,y){const v=y[0];if(void 0===v)return"";const x=g.pairs[v];return[c(g,v),NG(fn.Location(h,x.unitA,x.indexA,h,x.unitB,x.indexB))].join("</br>")}e.distance=o,e.Location=function s(h,g,y){return zue("cross-link-restraints",{structure:g,crossLinkRestraints:h},y)},e.isLocation=function a(h){return!!h&&"data-location"===h.kind&&"cross-link-restraints"===h.tag},e.areLocationsEqual=function l(h,g){return h.data.structure===g.data.structure&&h.data.crossLinkRestraints===g.data.crossLinkRestraints&&h.element===g.element},e.locationLabel=function u(h){return c(h.data.crossLinkRestraints,h.element)},e.Loci=function d(h,g,y){return ZN("cross-link-restraints",{structure:h,crossLinkRestraints:g},y,v=>p(g,y,v),()=>m(h,g,y))},e.isLoci=function f(h){return!!h&&"data-loci"===h.kind&&"interactions"===h.tag},e.getBoundingSphere=p,e.getLabel=m}(om||(om={}));const sbe={...kA,...t2,sizeFactor:I.Numeric(.5,{min:0,max:10,step:.1})};function Ogt(e){return Hy({defaultProps:I.getDefaultValues(sbe),createGeometry:Fgt,createLocationIterator:Bgt,getLoci:Lgt,eachLocation:jgt,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.radialSegments!==r.radialSegments||n.linkCap!==r.linkCap}},e)}function Bgt(e){const t=Wy.get(e).value,{pairs:n}=t,r=n.length,o=om.Location(t,e);return Vi(r,1,1,a=>(o.element=a,o),!0)}function Lgt(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const o=Wy.get(t).value;if(o.pairs[i])return om.Loci(t,o,[i])}return qr}function jgt(e,t,n){let r=!1;if(om.isLoci(e)){if(!Xe.areEquivalent(e.data.structure,t))return!1;const i=Wy.get(t).value;if(e.data.crossLinkRestraints!==i)return!1;for(const o of e.elements)n(Pe.ofSingleton(o))&&(r=!0)}return r}const Ugt={"cross-link-restraint":(e,t)=>Ff("Cross-link restraint",e,t,Ogt)},abe={...sbe},lbe={name:om.Tag.CrossLinkRestraint,label:"Cross Link Restraint",description:"Displays cross-link restraints.",factory:function Vgt(e,t){return Xn.createMulti("CrossLinkRestraint",e,t,gl,Ugt)},getParams:function zgt(e,t){return I.clone(abe)},defaultValues:I.getDefaultValues(abe),defaultColorTheme:{name:om.Tag.CrossLinkRestraint},defaultSizeTheme:{name:"uniform"},isApplicable:e=>om.isApplicable(e),ensureCustomProperties:{attach:(e,t)=>Wy.attach(e,t,void 0,!0),detach:e=>Wy.ref(e,!1)}},cbe=st(13421772),ube={domain:I.Interval([.5,1.5],{step:.01}),list:I.ColorList("red-grey",{presetKind:"scale"})},fbe={name:"cross-link",label:"Cross Link",category:Rd.Category.Misc,factory:function dbe(e,t){let n,r;const i=e.structure&&Wy.get(e.structure).value;if(i){r=up.create({domain:t.domain,listOrName:t.list.colors});const o=r.color;n=s=>{if(om.isLocation(s)){const a=i.pairs[s.element];if(a)return o(om.distance(a)/a.distanceThreshold)}return cbe}}else n=()=>cbe;return{factory:dbe,granularity:"group",color:n,props:t,description:"Colors cross-links by the deviation of the observed distance versus the modeled distance (e.g. modeled / `ihm_cross_link_restraint.distance_threshold`).",legend:r?r.legend:void 0}},getParams:function Ggt(e){return ube},defaultValues:I.getDefaultValues(ube),isApplicable:e=>!!e.structure&&om.isApplicable(e.structure),ensureCustomProperties:{attach:(e,t)=>t.structure?Wy.attach(e,t.structure,void 0,!0):Promise.resolve(),detach:e=>e.structure&&Wy.ref(e.structure,!1)}},qgt=ii.create({name:"integrative-cross-link-restraint",category:"custom-props",display:{name:"Cross Link Restraint"},ctor:class extends ii.Handler{constructor(){super(...arguments),this.provider=qy.Provider}register(){this.provider.formatRegistry.add("mmCIF",Wgt),this.ctx.representation.structure.themes.colorThemeRegistry.add(fbe),this.ctx.representation.structure.registry.add(lbe)}unregister(){this.provider.formatRegistry.remove("mmCIF"),this.ctx.representation.structure.themes.colorThemeRegistry.remove(fbe),this.ctx.representation.structure.registry.remove(lbe)}}});function Wgt(e){if(!Ui.is(e.sourceData))return;const{ihm_cross_link_restraint:t}=e.sourceData.data.db;return 0!==t._rowCount?qy.fromTable(t,e):void 0}const nO={State:zo,Representation:xr,Camera:ea,Misc:ta},Od={Representation:vi,Camera:to,CustomProps:Ul};function rO(e,t,n={}){return"string"==typeof n.type||"string"==typeof n.color||"string"==typeof n.size?function Ygt(e,t,n){const r=n.type&&e.representation.structure.registry.get(n.type)||e.representation.structure.registry.default.provider,i=n.color&&e.representation.structure.themes.colorThemeRegistry.get(n.color)||e.representation.structure.themes.colorThemeRegistry.get(r.defaultColorTheme.name),o=n.size&&e.representation.structure.themes.sizeThemeRegistry.get(n.size)||e.representation.structure.themes.sizeThemeRegistry.get(r.defaultSizeTheme.name);return hbe(e,t,{type:r,typeParams:n.typeParams,color:i,colorParams:n.colorParams,size:o,sizeParams:n.sizeParams})}(e,t||Xe.Empty,n):hbe(e,t||Xe.Empty,n)}function TW(e,t,n,r,i){const{registry:o,themes:s}=e.representation.structure,a=o.get(n||o.default.name),l=s.colorThemeRegistry.get(r||a.defaultColorTheme.name),c=I.getDefaultValues(l.getParams({structure:t||Xe.Empty}));return l.name===a.defaultColorTheme.name&&Object.assign(c,a.defaultColorTheme.props),{name:l.name,params:Object.assign(c,i)}}function pbe(e,t,n,r,i){const{registry:o,themes:s}=e.representation.structure,a=o.get(n||o.default.name),l=s.sizeThemeRegistry.get(r||a.defaultSizeTheme.name),c=I.getDefaultValues(l.getParams({structure:t||Xe.Empty}));return l.name===a.defaultSizeTheme.name&&Object.assign(c,a.defaultSizeTheme.props),{name:l.name,params:Object.assign(c,i)}}function hbe(e,t,n={}){const{themes:r}=e.representation.structure,i={structure:t},o=n.type||e.representation.structure.registry.default.provider,s=I.getDefaultValues(o.getParams(r,t)),a=Object.assign(s,n.typeParams),l=n.color||r.colorThemeRegistry.get(o.defaultColorTheme.name),c=I.getDefaultValues(l.getParams(i));l.name===o.defaultColorTheme.name&&Object.assign(c,o.defaultColorTheme.props);const u=Object.assign(c,n.colorParams),d=n.size||r.sizeThemeRegistry.get(o.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===o.defaultSizeTheme.name&&Object.assign(f,o.defaultSizeTheme.props);const p=Object.assign(f,n.sizeParams);return{type:{name:o.name,params:a},colorTheme:{name:l.name,params:u},sizeTheme:{name:d.name,params:p}}}const mbe=["target","surroundings","interactions"];var Co=function(e){return e.TargetSel="structure-focus-target-sel",e.TargetRepr="structure-focus-target-repr",e.SurrSel="structure-focus-surr-sel",e.SurrRepr="structure-focus-surr-repr",e.SurrNciRepr="structure-focus-surr-nci-repr",e}(Co||{});const Kgt=new Set([Co.TargetSel,Co.TargetRepr,Co.SurrSel,Co.SurrRepr,Co.SurrNciRepr]),iO=ii.create({name:"create-structure-focus-representation",display:{name:"Structure Focus Representation"},category:"interaction",ctor:class Zgt extends ii.WithSubscribers{constructor(){super(...arguments),this.currentSource=void 0}get surrLabel(){return`[Focus] Surroundings (${this.params.expandRadius} \xc5)`}getReprParams(t){return{...t,type:{name:t.type.name,params:{...t.type.params,ignoreHydrogens:this.params.ignoreHydrogens,ignoreHydrogensVariant:this.params.ignoreHydrogensVariant,ignoreLight:this.params.ignoreLight,material:this.params.material,clip:this.params.clip}}}}ensureShape(t){var n;const r=this.plugin.state.data,i=r.tree,o=r.build(),s=Qn.findUniqueTagsInSubtree(i,t.transform.ref,Kgt);s[Co.TargetSel]||(s[Co.TargetSel]=o.to(t).apply(at.Model.StructureSelectionFromBundle,{bundle:Qr.Empty,label:"[Focus] Target"},{tags:Co.TargetSel}).ref),s[Co.SurrSel]||(s[Co.SurrSel]=o.to(t).apply(at.Model.StructureSelectionFromExpression,{expression:pe.struct.generator.empty(),label:this.surrLabel},{tags:Co.SurrSel}).ref);const a=this.params.components;return a.indexOf("target")>=0&&!s[Co.TargetRepr]&&(s[Co.TargetRepr]=o.to(s[Co.TargetSel]).apply(at.Representation.StructureRepresentation3D,this.getReprParams(this.params.targetParams),{tags:Co.TargetRepr}).ref),a.indexOf("surroundings")>=0&&!s[Co.SurrRepr]&&(s[Co.SurrRepr]=o.to(s[Co.SurrSel]).apply(at.Representation.StructureRepresentation3D,this.getReprParams(this.params.surroundingsParams),{tags:Co.SurrRepr}).ref),a.indexOf("interactions")>=0&&!s[Co.SurrNciRepr]&&t.obj&&eO.isApplicable(null===(n=t.obj)||void 0===n?void 0:n.data)&&(s[Co.SurrNciRepr]=o.to(s[Co.SurrSel]).apply(at.Representation.StructureRepresentation3D,this.getReprParams(this.params.nciParams),{tags:Co.SurrNciRepr}).ref),{state:r,builder:o,refs:s}}clear(t){const n=this.plugin.state.data;this.currentSource=void 0;const r=n.select(Qn.Generators.byRef(t).subtree().withTag(Co.TargetSel)),i=n.select(Qn.Generators.byRef(t).subtree().withTag(Co.SurrSel));if(0===r.length&&0===i.length)return;const o=n.build(),s=Qr.Empty;for(const l of r)o.to(l).update(at.Model.StructureSelectionFromBundle,c=>({...c,bundle:s}));const a=pe.struct.generator.empty();for(const l of i)o.to(l).update(at.Model.StructureSelectionFromExpression,c=>({...c,expression:a}));return jt.State.Update(this.plugin,{state:n,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})}focus(t){var n=this;return le(function*(){const r=n.plugin.helpers.substructureParent.get(t.structure);if(!r||!r.obj)return;n.currentSource=t;const i=Me.remap(t,r.obj.data),o=Me.extendToWholeResidues(i),s=Qr.fromLoci(o),a=Qr.toExpression(s);let l=pe.struct.modifier.includeSurroundings({0:a,radius:n.params.expandRadius,"as-whole-residues":!0});n.params.excludeTargetFromSurroundings&&(l=pe.struct.modifier.exceptBy({0:l,by:a}));const{state:c,builder:u,refs:d}=n.ensureShape(r);u.to(d[Co.TargetSel]).update(at.Model.StructureSelectionFromBundle,f=>({...f,bundle:s})),u.to(d[Co.SurrSel]).update(at.Model.StructureSelectionFromExpression,f=>({...f,expression:l,label:n.surrLabel})),yield jt.State.Update(n.plugin,{state:c,tree:u,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}})})()}register(t){this.subscribeObservable(this.plugin.managers.structure.focus.behaviors.current,n=>{n?this.focus(n.loci):this.clear(vr.RootRef)})}update(t){var n=this;return le(function*(){const r=n.params;if(n.params=t,r.excludeTargetFromSurroundings!==t.excludeTargetFromSurroundings)return n.currentSource&&n.focus(n.currentSource),!0;const i=n.plugin.state.data,o=i.build(),s=Qn.Generators.root.subtree(),a=n.params.components;let l=a.indexOf("target")>=0;for(const c of i.select(s.withTag(Co.TargetRepr)))l?o.to(c).update(n.getReprParams(n.params.targetParams)):o.delete(c.transform.ref);l=a.indexOf("surroundings")>=0;for(const c of i.select(s.withTag(Co.SurrRepr)))l?o.to(c).update(n.getReprParams(n.params.surroundingsParams)):o.delete(c.transform.ref);l=a.indexOf("interactions")>=0;for(const c of i.select(s.withTag(Co.SurrNciRepr)))l?o.to(c).update(n.getReprParams(n.params.nciParams)):o.delete(c.transform.ref);return yield jt.State.Update(n.plugin,{state:i,tree:o,options:{doNotLogTiming:!0,doNotUpdateCurrent:!0}}),t.expandRadius!==r.expandRadius&&n.currentSource&&n.focus(n.currentSource),!0})()}},params:(e,t)=>(e=>{const t=at.Representation.StructureRepresentation3D.definition.params(void 0,e);return{expandRadius:I.Numeric(5,{min:1,max:10,step:1}),targetParams:I.Group(t,{label:"Target",customDefault:rO(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.22,sizeAspectRatio:.73,adjustCylinderLength:!0,xrayShaded:!0,aromaticBonds:!1,multipleBonds:"off",excludeTypes:["hydrogen-bond","metal-coordination"]}})}),surroundingsParams:I.Group(t,{label:"Surroundings",customDefault:rO(e,void 0,{type:"ball-and-stick",size:"physical",typeParams:{sizeFactor:.16,excludeTypes:["hydrogen-bond","metal-coordination"]}})}),nciParams:I.Group(t,{label:"Non-covalent Int.",customDefault:rO(e,void 0,{type:eO,color:yW,size:Ya.BuiltIn.uniform})}),components:I.MultiSelect(mbe,I.arrayToOptions(mbe)),excludeTargetFromSurroundings:I.Boolean(!1,{label:"Exclude Target",description:'Exclude the focus "target" from the surroudings component.'}),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),ignoreLight:I.Boolean(!1),material:tu.getParam(),clip:I.Group(H1.Params)}})(t)});function jc(e){return e}!function(e){function t(o){return"chain-id"===o?{name:o,params:Rpe.defaultValues}:"operator-name"===o?{name:o,params:lG.defaultValues}:{name:o,params:{}}}e.CommonParams={ignoreHydrogens:I.Optional(I.Boolean(!1)),ignoreHydrogensVariant:I.Optional(I.Select("all",I.arrayToOptions(["all","non-polar"]))),ignoreLight:I.Optional(I.Boolean(!1)),quality:I.Optional(I.Select("auto",D9)),theme:I.Optional(I.Group({globalName:I.Optional(I.Text("")),globalColorParams:I.Optional(I.Value({},{isHidden:!0})),carbonColor:I.Optional(I.Select("chain-id",I.arrayToOptions(["chain-id","operator-name","element-symbol"]))),symmetryColor:I.Optional(I.Text("")),symmetryColorParams:I.Optional(I.Value({},{isHidden:!0})),focus:I.Optional(I.Group({name:I.Optional(I.Text("")),params:I.Optional(I.Value({}))}))}))},e.reprBuilder=function r(o,s,a){var l,c,u,d,f,p,m,h,g,y,v,x,_,w;const A=o.state.data.build(),M=o.builders.structure.representation,E=o.managers.structure.component.state.options.hydrogens,D={quality:o.managers.structure.component.state.options.visualQuality,ignoreHydrogens:"all"!==E,ignoreHydrogensVariant:"only-polar"===E?"non-polar":"all",ignoreLight:o.managers.structure.component.state.options.ignoreLight};s.quality&&"auto"!==s.quality&&(D.quality=s.quality),void 0!==s.ignoreHydrogens&&(D.ignoreHydrogens=!!s.ignoreHydrogens),void 0!==s.ignoreHydrogensVariant&&(D.ignoreHydrogensVariant=s.ignoreHydrogensVariant),void 0!==s.ignoreLight&&(D.ignoreLight=!!s.ignoreLight);const T=null!==(l=s.theme)&&void 0!==l&&l.globalName?null===(c=s.theme)||void 0===c?void 0:c.globalName:void 0,F=void 0!==(null===(u=s.theme)||void 0===u?void 0:u.carbonColor)?{carbonColor:t(null===(d=s.theme)||void 0===d?void 0:d.carbonColor),...null===(f=s.theme)||void 0===f?void 0:f.globalColorParams}:{...null===(p=s.theme)||void 0===p?void 0:p.globalColorParams},R=a&&null!==(m=s.theme)&&void 0!==m&&m.symmetryColor&&function n(o){return o.units.some(s=>!s.conformation.operator.assembly&&s.conformation.operator.spgrOp>=0)}(a)?null===(h=s.theme)||void 0===h?void 0:h.symmetryColor:T;return{update:A,builder:M,color:T,symmetryColor:R,symmetryColorParams:null!==(g=s.theme)&&void 0!==g&&g.symmetryColorParams?{...null===(y=s.theme)||void 0===y?void 0:y.globalColorParams,...null===(v=s.theme)||void 0===v?void 0:v.symmetryColorParams}:{...null===(x=s.theme)||void 0===x?void 0:x.globalColorParams},globalColorParams:null!==(_=s.theme)&&void 0!==_&&_.globalColorParams?{...null===(w=s.theme)||void 0===w?void 0:w.globalColorParams}:void 0,typeParams:D,ballAndStickColor:F}},e.updateFocusRepr=function i(o,s,a,l){if(o.state.hasBehavior(iO))return o.state.updateBehavior(iO,c=>{const u=TW(o,s,"ball-and-stick",a||"element-symbol",l);c.surroundingsParams.colorTheme=u,c.targetParams.colorTheme=u})}}(jc||(jc={}));const cv=jc.CommonParams,r2=jc.reprBuilder,i2=jc.updateFocusRepr,Qgt=jc({id:"preset-structure-representation-auto",display:{name:"Automatic",description:"Show representations based on the size of the structure. Smaller structures are shown with more detail than larger ones, ranging from atomistic display to coarse surfaces."},params:()=>cv,apply(e,t,n){var r,i;const o=null===(i=null===(r=_a.resolveAndCheck(n.state.data,e))||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data;if(!o)return{};const s=n.config.get(ei.Structure.SizeThresholds)||Xe.DefaultSizeThresholds,a=Xe.getSize(o,s),l=o.polymerResidueCount/o.polymerGapCount;switch(a){case Xe.Size.Gigantic:case Xe.Size.Huge:return ybe.apply(e,t,n);case Xe.Size.Large:return bbe.apply(e,t,n);case Xe.Size.Medium:if(l>3)return gbe.apply(e,t,n);case Xe.Size.Small:return vbe.apply(e,{...t,showCarbohydrateSymbol:!0},n);default:Hi()}}}),Jgt=jc({id:"preset-structure-representation-empty",display:{name:"Empty",description:"Removes all existing representations."},apply:(e,t,n)=>le(function*(){return{}})()}),OP="Basic",gbe=jc({id:"preset-structure-representation-polymer-and-ligand",display:{name:"Polymer & Ligand",group:OP,description:"Shows polymers as Cartoon, ligands as Ball & Stick, carbohydrates as 3D-SNFG and water molecules semi-transparent."},params:()=>cv,apply:(e,t,n)=>le(function*(){var r,i,o,s,a,l,c,u,d,f;const p=_a.resolveAndCheck(n.state.data,e);if(!p)return{};const m={polymer:yield td(n,p,"polymer"),ligand:yield td(n,p,"ligand"),nonStandard:yield td(n,p,"non-standard"),branched:yield td(n,p,"branched",{label:"Carbohydrate"}),water:yield td(n,p,"water"),ion:yield td(n,p,"ion"),lipid:yield td(n,p,"lipid"),coarse:yield td(n,p,"coarse")},h=p.obj.data,g={sizeFactor:h.isCoarseGrained?.8:.2},y=((null===(o=null===(i=null===(r=m.water)||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data)||void 0===o?void 0:o.elementCount)||0)>5e4?"line":"ball-and-stick",v=((null===(l=null===(a=null===(s=m.lipid)||void 0===s?void 0:s.obj)||void 0===a?void 0:a.data)||void 0===l?void 0:l.elementCount)||0)>2e4?"line":"ball-and-stick",{update:x,builder:_,typeParams:w,color:A,symmetryColor:M,symmetryColorParams:E,globalColorParams:D,ballAndStickColor:T}=r2(n,t,h),F={polymer:_.buildRepresentation(x,m.polymer,{type:"cartoon",typeParams:{...w,...g},color:M,colorParams:E},{tag:"polymer"}),ligand:_.buildRepresentation(x,m.ligand,{type:"ball-and-stick",typeParams:w,color:A,colorParams:T},{tag:"ligand"}),nonStandard:_.buildRepresentation(x,m.nonStandard,{type:"ball-and-stick",typeParams:w,color:A,colorParams:T},{tag:"non-standard"}),branchedBallAndStick:_.buildRepresentation(x,m.branched,{type:"ball-and-stick",typeParams:{...w,alpha:.3},color:A,colorParams:T},{tag:"branched-ball-and-stick"}),branchedSnfg3d:_.buildRepresentation(x,m.branched,{type:"carbohydrate",typeParams:w,color:A,colorParams:D},{tag:"branched-snfg-3d"}),water:_.buildRepresentation(x,m.water,{type:y,typeParams:{...w,alpha:.6,visuals:"line"===y?["intra-bond","element-point"]:void 0},color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}},...D}},{tag:"water"}),ion:_.buildRepresentation(x,m.ion,{type:"ball-and-stick",typeParams:w,color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}},...D}},{tag:"ion"}),lipid:_.buildRepresentation(x,m.lipid,{type:v,typeParams:{...w,alpha:.6,visuals:"line"===v?["intra-bond"]:void 0},color:A,colorParams:{carbonColor:{name:"element-symbol",params:{}},...D}},{tag:"lipid"}),coarse:_.buildRepresentation(x,m.coarse,{type:"spacefill",typeParams:w,color:A||"chain-id",colorParams:D},{tag:"coarse"})};return yield x.commit({revertOnError:!1}),yield i2(n,h,null===(u=null===(c=t.theme)||void 0===c?void 0:c.focus)||void 0===u?void 0:u.name,null===(f=null===(d=t.theme)||void 0===d?void 0:d.focus)||void 0===f?void 0:f.params),{components:m,representations:F}})()}),e0t=jc({id:"preset-structure-representation-protein-and-nucleic",display:{name:"Protein & Nucleic",group:OP,description:"Shows proteins as Cartoon and RNA/DNA as Gaussian Surface."},params:()=>cv,apply:(e,t,n)=>le(function*(){var r,i,o,s;const a=_a.resolveAndCheck(n.state.data,e);if(!a)return{};const l={protein:yield xbe(n,a,"protein"),nucleic:yield xbe(n,a,"nucleic")},c=a.obj.data,u={sizeFactor:c.isCoarseGrained?.8:.2},d={radiusOffset:c.isCoarseGrained?2:0,smoothness:c.isCoarseGrained?1:1.5},{update:f,builder:p,typeParams:m,symmetryColor:h,symmetryColorParams:g}=r2(n,t,c),y={protein:p.buildRepresentation(f,l.protein,{type:"cartoon",typeParams:{...m,...u},color:h,colorParams:g},{tag:"protein"}),nucleic:p.buildRepresentation(f,l.nucleic,{type:"gaussian-surface",typeParams:{...m,...d},color:h,colorParams:g},{tag:"nucleic"})};return yield f.commit({revertOnError:!0}),yield i2(n,c,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:l,representations:y}})()}),ybe=jc({id:"preset-structure-representation-coarse-surface",display:{name:"Coarse Surface",group:OP,description:"Shows polymers and lipids as coarse Gaussian Surface."},params:()=>cv,apply:(e,t,n)=>le(function*(){var r,i,o,s;const a=_a.resolveAndCheck(n.state.data,e);if(!a)return{};const l={polymer:yield td(n,a,"polymer"),lipid:yield td(n,a,"lipid")},c=a.obj.data,u=n.config.get(ei.Structure.SizeThresholds)||Xe.DefaultSizeThresholds,d=Xe.getSize(c,u),f=Object.create(null);d===Xe.Size.Gigantic?Object.assign(f,{traceOnly:!c.isCoarseGrained,radiusOffset:2,smoothness:1,visuals:["structure-gaussian-surface-mesh"]}):d===Xe.Size.Huge?Object.assign(f,{radiusOffset:c.isCoarseGrained?2:0,smoothness:1}):c.isCoarseGrained&&Object.assign(f,{radiusOffset:2,smoothness:1});const{update:p,builder:m,typeParams:h,symmetryColor:g,symmetryColorParams:y}=r2(n,t,c),v={polymer:m.buildRepresentation(p,l.polymer,{type:"gaussian-surface",typeParams:{...h,...f},color:g,colorParams:y},{tag:"polymer"}),lipid:m.buildRepresentation(p,l.lipid,{type:"gaussian-surface",typeParams:{...h,...f},color:g,colorParams:y},{tag:"lipid"})};return yield p.commit({revertOnError:!0}),yield i2(n,c,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:l,representations:v}})()}),bbe=jc({id:"preset-structure-representation-polymer-cartoon",display:{name:"Polymer Cartoon",group:OP,description:"Shows polymers as Cartoon."},params:()=>cv,apply:(e,t,n)=>le(function*(){var r,i,o,s;const a=_a.resolveAndCheck(n.state.data,e);if(!a)return{};const l={polymer:yield td(n,a,"polymer")},c=a.obj.data,u={sizeFactor:c.isCoarseGrained?.8:.2},{update:d,builder:f,typeParams:p,symmetryColor:m,symmetryColorParams:h}=r2(n,t,c),g={polymer:f.buildRepresentation(d,l.polymer,{type:"cartoon",typeParams:{...p,...u},color:m,colorParams:h},{tag:"polymer"})};return yield d.commit({revertOnError:!0}),yield i2(n,c,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:l,representations:g}})()}),vbe=jc({id:"preset-structure-representation-atomic-detail",display:{name:"Atomic Detail",group:OP,description:"Shows everything in atomic detail with Ball & Stick."},params:()=>({...cv,showCarbohydrateSymbol:I.Boolean(!1)}),apply:(e,t,n)=>le(function*(){var r,i,o,s,a,l;const c=_a.resolveAndCheck(n.state.data,e);if(!c)return{};const u={all:yield td(n,c,"all"),branched:void 0},d=c.obj.data,f=d.elementCount>1e5,p=d.atomicResidueCount&&d.elementCount>1e3&&d.atomicResidueCount/d.elementCount<3,m=d.models[0],h=!!nc.Provider.get(m)||vf.isExhaustive(m);let g="ball-and-stick";d.isCoarseGrained?g=d.elementCount>1e6?"point":"spacefill":p&&!h?g="spacefill":f&&(g="line");const y=t.showCarbohydrateSymbol&&!f&&!p;y&&Object.assign(u,{branched:yield td(n,c,"branched",{label:"Carbohydrate"})});const{update:v,builder:x,typeParams:_,color:w,ballAndStickColor:A,globalColorParams:M}=r2(n,t,d),E=p&&!h?{carbonColor:{name:"element-symbol",params:{}},...M}:A,D={all:x.buildRepresentation(v,u.all,{type:g,typeParams:_,color:w,colorParams:E},{tag:"all"})};return y&&Object.assign(D,{snfg3d:x.buildRepresentation(v,u.branched,{type:"carbohydrate",typeParams:{..._,alpha:.4,visuals:["carbohydrate-symbol"]},color:w,colorParams:M},{tag:"snfg-3d"})}),yield v.commit({revertOnError:!0}),yield i2(n,d,null!==(o=null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name)&&void 0!==o?o:w,null!==(l=null===(a=null===(s=t.theme)||void 0===s?void 0:s.focus)||void 0===a?void 0:a.params)&&void 0!==l?l:E),{components:u,representations:D}})()}),t0t=jc({id:"preset-structure-representation-illustrative",display:{name:"Illustrative",group:"Miscellaneous",description:"..."},params:()=>({...cv,showCarbohydrateSymbol:I.Boolean(!1)}),apply:(e,t,n)=>le(function*(){var r,i,o,s,a;const l=_a.resolveAndCheck(n.state.data,e);if(!l)return{};const c={all:yield td(n,l,"all"),branched:void 0},u=l.obj.data,{update:d,builder:f,typeParams:p,color:m}=r2(n,t,u),h={all:f.buildRepresentation(d,c.all,{type:"spacefill",typeParams:{...p,ignoreLight:!0},color:"illustrative"},{tag:"all"})};return yield d.commit({revertOnError:!0}),yield i2(n,u,null!==(o=null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name)&&void 0!==o?o:m,null===(a=null===(s=t.theme)||void 0===s?void 0:s.focus)||void 0===a?void 0:a.params),{components:c,representations:h}})()}),n0t=jc({id:"preset-structure-representation-auto-lod",display:{name:"Automatic Detail",group:"Miscellaneous",description:"Shows more (or less) detailed representations automatically based on camera distance."},params:()=>cv,apply:(e,t,n)=>le(function*(){var r,i,o,s;const a=_a.resolveAndCheck(n.state.data,e);if(!a)return{};const l={all:yield td(n,a,"all")},c=a.obj.data,u={sizeFactor:c.isCoarseGrained?.8:.2},{update:d,builder:f,typeParams:p,color:m,symmetryColor:h,symmetryColorParams:g,ballAndStickColor:y}=r2(n,t,c),v={gaussianSurface:f.buildRepresentation(d,l.all,{type:"gaussian-surface",typeParams:{...p,lod:C.create(30,1e7,100)},color:h,colorParams:g},{tag:"gaussian-surface"}),cartoon:f.buildRepresentation(d,l.all,{type:"cartoon",typeParams:{...p,...u,lod:C.create(-20,300,100)},color:h,colorParams:g},{tag:"cartoon"}),ballAndStick:f.buildRepresentation(d,l.all,{type:"ball-and-stick",typeParams:{...p,lod:C.create(-20,40,20)},color:m,colorParams:y},{tag:"ball-and-stick"})};return yield d.commit({revertOnError:!1}),yield i2(n,c,null===(i=null===(r=t.theme)||void 0===r?void 0:r.focus)||void 0===i?void 0:i.name,null===(s=null===(o=t.theme)||void 0===o?void 0:o.focus)||void 0===s?void 0:s.params),{components:l,representations:v}})()});function td(e,t,n,r){return e.builders.structure.tryCreateComponentStatic(t,n,r)}function xbe(e,t,n,r){return e.builders.structure.tryCreateComponentFromSelection(t,Ps[n],`selection-${n}`,r)}const Gp={empty:Jgt,auto:Qgt,"atomic-detail":vbe,"polymer-cartoon":bbe,"polymer-and-ligand":gbe,"protein-and-nucleic":e0t,"coarse-surface":ybe,illustrative:t0t,"auto-lod":n0t};function oO(e,t){if("bcif"===e.ext)try{const{encoder:n}=bae(t);if(n.startsWith("VolumeServer"))return"dscif";if(n.startsWith("volseg-volume-server"))return"segcif"}catch(n){console.error(n)}else if("cif"===e.ext){const n=t;if(n.startsWith("data_SERVER\n#\n_density_server_result"))return"dscif";if(n.startsWith("data_SERVER\n#\ndata_SEGMENTATION_DATA"))return"segcif";if(n.includes("atom_site_fract_x")||n.includes("atom_site.fract_x"))return"coreCif"}return-1}const sm="Trajectory";function $y(e,t){return e.builders.structure.hierarchy.applyPreset(t.trajectory,"default")}const r0t={label:"mmCIF",description:"mmCIF",category:sm,stringExtensions:["cif","mmcif","mcif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>"mmcif"===e.ext||"mcif"===e.ext||("cif"===e.ext||"bcif"===e.ext)&&-1===oO(e,t),parse:function(){var e=le(function*(t,n,r){var i,o;const a=t.state.data.build().to(n).apply(at.Data.ParseCif,void 0,{state:{isGhost:!0}}),l=yield a.apply(at.Model.TrajectoryFromMmCif,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return((null===(o=null===(i=a.selector.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.blocks.length)||0)>1&&t.state.data.updateCellState(a.ref,{isGhost:!1}),{trajectory:l}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:$y},i0t={label:"cifCore",description:"CIF Core",category:sm,stringExtensions:["cif"],isApplicable:(e,t)=>"cif"===e.ext&&"coreCif"===oO(e,t),parse:function(){var e=le(function*(t,n,r){var i,o;const a=t.state.data.build().to(n).apply(at.Data.ParseCif,void 0,{state:{isGhost:!0}}),l=yield a.apply(at.Model.TrajectoryFromCifCore,void 0,{tags:r?.trajectoryTags}).commit({revertOnError:!0});return((null===(o=null===(i=a.selector.cell)||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data.blocks.length)||0)>1&&t.state.data.updateCellState(a.ref,{isGhost:!1}),{trajectory:l}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:$y};function o2(e,t){return function(){var n=le(function*(r,i,o){return{trajectory:yield r.state.data.build().to(i).apply(e,t,{tags:o?.trajectoryTags}).commit({revertOnError:!0})}});return function(r,i,o){return n.apply(this,arguments)}}()}const o0t={label:"PDB",description:"PDB",category:sm,stringExtensions:["pdb","ent"],parse:o2(at.Model.TrajectoryFromPDB),visuals:$y},s0t={label:"PDBQT",description:"PDBQT",category:sm,stringExtensions:["pdbqt"],parse:o2(at.Model.TrajectoryFromPDB,{isPdbqt:!0}),visuals:$y},a0t={label:"XYZ",description:"XYZ",category:sm,stringExtensions:["xyz"],parse:o2(at.Model.TrajectoryFromXYZ),visuals:$y},_be=[["mmcif",r0t],["cifCore",i0t],["pdb",o0t],["pdbqt",s0t],["gro",{label:"GRO",description:"GRO",category:sm,stringExtensions:["gro"],binaryExtensions:[],parse:o2(at.Model.TrajectoryFromGRO),visuals:$y}],["xyz",a0t],["mol",{label:"MOL",description:"MOL",category:sm,stringExtensions:["mol"],parse:o2(at.Model.TrajectoryFromMOL),visuals:$y}],["sdf",{label:"SDF",description:"SDF",category:sm,stringExtensions:["sdf","sd"],parse:o2(at.Model.TrajectoryFromSDF),visuals:$y}],["mol2",{label:"MOL2",description:"MOL2",category:sm,stringExtensions:["mol2"],parse:o2(at.Model.TrajectoryFromMOL2),visuals:$y}]],f0t=["gz","zip"];function RA(e){let t=e,n="";const r=t.lastIndexOf("?"),i=-1!==r?t.substring(r):"";t=t.substring(0,-1===r?t.length:r);const o=t.replace(/^.*[\\/]/,"");let s=o.substring(0,o.lastIndexOf("."));const a=o.split(".");let l=a.length>1?(a.pop()||"").toLowerCase():"";const c=t.match(/^(.+):\/\/(.+)$/);c&&(n=c[1].toLowerCase(),t=c[2]||"");const u=t.substring(0,t.lastIndexOf("/")+1);return f0t.includes(l)&&(l=(t.substr(0,t.length-l.length-1).split(".").pop()||"").toLowerCase(),s=s.substr(0,s.length-l.length-1)),{path:t,name:o,ext:l,base:s,dir:u,protocol:n,query:i}}const BP="Topology",p0t={label:"PSF",description:"PSF",category:BP,stringExtensions:["psf"],parse:function(){var e=le(function*(t,n){const r=t.state.data.build().to(n).apply(at.Data.ParsePsf,{},{state:{isGhost:!0}}),i=r.apply(at.Model.TopologyFromPsf);return yield r.commit(),{format:r.selector,topology:i.selector}});return function(n,r){return e.apply(this,arguments)}}()},h0t={label:"PRMTOP",description:"PRMTOP",category:BP,stringExtensions:["prmtop","parm7"],parse:function(){var e=le(function*(t,n){const r=t.state.data.build().to(n).apply(at.Data.ParsePrmtop,{},{state:{isGhost:!0}}),i=r.apply(at.Model.TopologyFromPrmtop);return yield r.commit(),{format:r.selector,topology:i.selector}});return function(n,r){return e.apply(this,arguments)}}()},m0t={label:"TOP",description:"TOP",category:BP,stringExtensions:["top"],parse:function(){var e=le(function*(t,n){const r=t.state.data.build().to(n).apply(at.Data.ParseTop,{},{state:{isGhost:!0}}),i=r.apply(at.Model.TopologyFromTop);return yield r.commit(),{format:r.selector,topology:i.selector}});return function(n,r){return e.apply(this,arguments)}}()},g0t=[["psf",p0t],["prmtop",h0t],["top",m0t]],NA="Coordinates",y0t={label:"DCD",description:"DCD",category:NA,binaryExtensions:["dcd"],parse:(e,t)=>e.state.data.build().to(t).apply(at.Model.CoordinatesFromDcd).commit()},b0t={label:"XTC",description:"XTC",category:NA,binaryExtensions:["xtc"],parse:(e,t)=>e.state.data.build().to(t).apply(at.Model.CoordinatesFromXtc).commit()},v0t={label:"TRR",description:"TRR",category:NA,binaryExtensions:["trr"],parse:(e,t)=>e.state.data.build().to(t).apply(at.Model.CoordinatesFromTrr).commit()},x0t={label:"NCTRAJ",description:"NCTRAJ",category:NA,binaryExtensions:["nc","nctraj"],parse:(e,t)=>e.state.data.build().to(t).apply(at.Model.CoordinatesFromNctraj).commit()},_0t=[["dcd",y0t],["xtc",b0t],["trr",v0t],["nctraj",x0t]],Sbe={rcsb:I.Group({encoding:I.Select("bcif",I.arrayToOptions(["cif","bcif"]))},{label:"RCSB PDB",isFlat:!0}),pdbe:I.Group({variant:I.Select("updated-bcif",[["updated-bcif","Updated (bcif)"],["updated","Updated"],["archival","Archival"]])},{label:"PDBe",isFlat:!0}),pdbj:I.EmptyGroup({label:"PDBj"})},C0t=Hu.build({from:Se.Root,display:{name:"Download Structure",description:"Load a structure from the provided source and create its representation."},params:(e,t)=>{const n=(e=>{const t=e.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id;return I.Group({type:R_.getParams(void 0,"auto").type,representation:I.Select(t,e.builders.structure.representation.getPresets().map(n=>[n.id,n.display.name,n.display.group]),{description:"Which representation preset to use."}),representationParams:I.Group(jc.CommonParams,{isHidden:!0}),asTrajectory:I.Optional(I.Boolean(!1,{description:"Load all entries into a single trajectory."}))},{isExpanded:!1})})(t),r=t.config.get(ei.Download.DefaultPdbProvider)||"pdbe";return{source:I.MappedStatic("pdb",{pdb:I.Group({provider:I.Group({id:I.Text("1tqn",{label:"PDB Id(s)",description:"One or more comma/space separated PDB ids."}),server:I.MappedStatic(r,Sbe)},{pivot:"id"}),options:n},{isFlat:!0,label:"PDB"}),"pdb-dev":I.Group({provider:I.Group({id:I.Text("PDBDEV_00000001",{label:"PDB-Dev Id(s)",description:"One or more comma/space separated ids."}),encoding:I.Select("bcif",I.arrayToOptions(["cif","bcif"]))},{pivot:"id"}),options:n},{isFlat:!0,label:"PDB-Dev"}),swissmodel:I.Group({id:I.Text("Q9Y2I8",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:n},{isFlat:!0,label:"SWISS-MODEL",description:"Loads the best homology model or experimental structure"}),alphafolddb:I.Group({id:I.Text("Q8W3K0",{label:"UniProtKB AC(s)",description:"One or more comma/space separated ACs."}),options:n},{isFlat:!0,label:"AlphaFold DB",description:"Loads the predicted model if available"}),modelarchive:I.Group({id:I.Text("ma-bak-cepc-0003",{label:"Accession Code(s)",description:"One or more comma/space separated ACs."}),options:n},{isFlat:!0,label:"Model Archive"}),pubchem:I.Group({id:I.Text("2244,2245",{label:"PubChem ID",description:"One or more comma/space separated IDs."}),options:n},{isFlat:!0,label:"PubChem",description:"Loads 3D conformer from PubChem."}),url:I.Group({url:I.Url(""),format:I.Select("mmcif",I.arrayToOptions(_be.map(i=>i[0]),i=>i)),isBinary:I.Boolean(!1),label:I.Optional(I.Text("")),options:n},{isFlat:!0,label:"URL"})})}}})(({params:e,state:t},n)=>Ke.create("Download Structure",function(){var r=le(function*(i){n.behaviors.layout.leftPanelTabName.next("data");const o=e.source;let s,a=!1,l="mmcif";switch(o.name){case"url":s=[{url:o.params.url,isBinary:o.params.isBinary,label:o.params.label||void 0}],l=o.params.format;break;case"pdb":s=yield"pdbe"===o.params.provider.server.name?function w0t(e){return PW.apply(this,arguments)}(o):"pdbj"===o.params.provider.server.name?function A0t(e){return kW.apply(this,arguments)}(o):"rcsb"===o.params.provider.server.name?function I0t(e){return MW.apply(this,arguments)}(o):Hi(),a=!!o.params.options.asTrajectory;break;case"pdb-dev":s=yield am(o.params.provider.id,f=>{const p=f.toUpperCase().startsWith("PDBDEV_")?f:`PDBDEV_${f.padStart(8,"0")}`;return"bcif"===o.params.provider.encoding?`https://pdb-dev.wwpdb.org/bcif/${p.toUpperCase()}.bcif`:`https://pdb-dev.wwpdb.org/cif/${p.toUpperCase()}.cif`},f=>f.toUpperCase().startsWith("PDBDEV_")?f:`PDBDEV_${f.padStart(8,"0")}`,"bcif"===o.params.provider.encoding),a=!!o.params.options.asTrajectory;break;case"swissmodel":s=yield am(o.params.id,f=>`https://swissmodel.expasy.org/repository/uniprot/${f.toUpperCase()}.pdb`,f=>`SWISS-MODEL: ${f}`,!1),a=!!o.params.options.asTrajectory,l="pdb";break;case"alphafolddb":s=yield am(o.params.id,function(){var f=le(function*(p){const m=`https://www.alphafold.ebi.ac.uk/api/prediction/${p.toUpperCase()}`,h=yield n.runTask(n.fetch({url:m,type:"json"}));if(Array.isArray(h)&&h.length>0)return h[0].cifUrl;throw new Error(`No AlphaFold DB entry for '${p}'`)});return function(p){return f.apply(this,arguments)}}(),f=>`AlphaFold DB: ${f}`,!1),a=!!o.params.options.asTrajectory,l="mmcif";break;case"modelarchive":s=yield am(o.params.id,f=>`https://www.modelarchive.org/doi/10.5452/${f.toLowerCase()}.cif`,f=>`Model Archive: ${f}`,!1),a=!!o.params.options.asTrajectory,l="mmcif";break;case"pubchem":s=yield am(o.params.id,f=>`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/CID/${f.trim()}/record/SDF/?record_type=3d`,f=>`PubChem: ${f}`,!1),a=!!o.params.options.asTrajectory,l="mol";break;default:Hi()}const c=e.source.params.options.representation||n.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id,u=c!==Gp.empty.id,d="auto"===o.params.options.type.name?void 0:o.params.options.type;yield t.transaction(le(function*(){var f;if(s.length>0&&a){const p=yield n.builders.data.downloadBlob({sources:s.map((h,g)=>({id:""+g,url:h.url,isBinary:h.isBinary})),maxConcurrency:6},{state:{isGhost:!0}}),m=yield n.builders.structure.parseTrajectory(p,{formats:s.map((h,g)=>({id:""+g,format:"cif"}))});yield n.builders.structure.hierarchy.applyPreset(m,"default",{structure:d,showUnitcell:u,representationPreset:c,representationPresetParams:e.source.params.options.representationParams})}else for(const p of s){const m=yield n.builders.data.download(p,{state:{isGhost:!0}}),h="auto"===l?n.dataFormats.auto(RA(jr.getUrl(p.url)),null===(f=m.cell)||void 0===f?void 0:f.obj):n.dataFormats.get(l);if(!h)throw new Error("unknown file format");const g=yield n.builders.structure.parseTrajectory(m,h);yield n.builders.structure.hierarchy.applyPreset(g,"default",{structure:d,showUnitcell:u,representationPreset:c,representationPresetParams:e.source.params.options.representationParams})}})).runInContext(i)});return function(i){return r.apply(this,arguments)}}()));function am(e,t,n,r){return DW.apply(this,arguments)}function DW(){return DW=le(function*(e,t,n,r){const i=e.split(/[,\s]/).map(s=>s.trim()).filter(s=>!!s&&(s.length>=4||/^[1-9][0-9]*$/.test(s))),o=[];for(const s of i)o.push({url:jr.Url(yield t(s)),isBinary:r,label:n(s)});return o}),DW.apply(this,arguments)}function PW(){return PW=le(function*(e){if("pdb"!==e.name||"pdbe"!==e.params.provider.server.name)throw new Error("expected pdbe");return"updated"===e.params.provider.server.params.variant?am(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}_updated.cif`,t=>`PDBe: ${t} (updated cif)`,!1):"updated-bcif"===e.params.provider.server.params.variant?am(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/entry-files/download/${t.toLowerCase()}.bcif`,t=>`PDBe: ${t} (updated cif)`,!0):am(e.params.provider.id,t=>`https://www.ebi.ac.uk/pdbe/static/entry/${t.toLowerCase()}.cif`,t=>`PDBe: ${t} (cif)`,!1)}),PW.apply(this,arguments)}function kW(){return kW=le(function*(e){if("pdb"!==e.name||"pdbj"!==e.params.provider.server.name)throw new Error("expected pdbj");return am(e.params.provider.id,t=>`https://data.pdbjbk1.pdbj.org/pub/pdb/data/structures/divided/mmCIF/${t.toLowerCase().substring(1,3)}/${t.toLowerCase()}.cif`,t=>`PDBj: ${t} (cif)`,!1)}),kW.apply(this,arguments)}function MW(){return MW=le(function*(e){if("pdb"!==e.name||"rcsb"!==e.params.provider.server.name)throw new Error("expected rcsb");return"cif"===e.params.provider.server.params.encoding?am(e.params.provider.id,t=>`https://files.rcsb.org/download/${t.toUpperCase()}.cif`,t=>`RCSB PDB: ${t} (cif)`,!1):am(e.params.provider.id,t=>`https://models.rcsb.org/${t.toUpperCase()}.bcif`,t=>`RCSB PDB: ${t} (bcif)`,!0)}),MW.apply(this,arguments)}const sO=Hu.build({display:{name:"Update Trajectory"},params:{action:I.Select("advance",I.arrayToOptions(["advance","reset"])),by:I.Optional(I.Numeric(1,{min:-1,max:1,step:1}))}})(({params:e,state:t})=>{const n=t.selectQ(i=>i.ofTransformer(at.Model.ModelFromTrajectory)),r=t.build();if("reset"===e.action)for(const i of n)r.to(i).update({modelIndex:0});else for(const i of n){const o=Qn.findAncestorOfType(t.tree,t.cells,i.transform.ref,Se.Molecule.Trajectory);if(!o||!o.obj)continue;const s=o.obj;r.to(i).update(a=>{let l=(a.modelIndex+e.by)%s.data.frameCount;return l<0&&(l+=s.data.frameCount),{modelIndex:l}})}return t.updateTree(r)}),E0t=Hu.build({display:{name:"Custom Model Properties",description:"Enable parameters for custom properties of the model."},from:Se.Molecule.Model,params:(e,t)=>t.customModelProperties.getParams(e?.data),isApplicable:(e,t,n)=>t.transformer!==xpe})(({ref:e,params:t},n)=>n.builders.structure.insertModelProperties(e,t)),T0t=Hu.build({display:{name:"Custom Structure Properties",description:"Enable parameters for custom properties of the structure."},from:Se.Molecule.Structure,params:(e,t)=>t.customStructureProperties.getParams(e?.data),isApplicable:(e,t,n)=>t.transformer!==Spe})(({ref:e,params:t},n)=>n.builders.structure.insertStructureProperties(e,t)),D0t=Hu.build({display:{name:"Add Trajectory",description:"Add trajectory from existing model/topology and coordinates."},from:Se.Root,params(e,t){const n=t.state.data,i=[...n.selectQ(a=>a.rootsOfType(Se.Molecule.Model)),...n.selectQ(a=>a.rootsOfType(Se.Molecule.Topology))].map(a=>[a.transform.ref,a.obj.label]),s=n.selectQ(a=>a.rootsOfType(Se.Molecule.Coordinates)).map(a=>[a.transform.ref,a.obj.label]);return{model:I.Select(i.length?i[0][0]:"",i),coordinates:I.Select(s.length?s[0][0]:"",s)}}})(({params:e,state:t},n)=>Ke.create("Add Trajectory",r=>t.transaction(le(function*(){const i=[e.model,e.coordinates],o=t.build().toRoot().apply(JH,{modelRef:e.model,coordinatesRef:e.coordinates},{dependsOn:i}).apply(at.Model.ModelFromTrajectory,{modelIndex:0});yield t.updateTree(o).runInContext(r);const s=yield n.builders.structure.createStructure(o.selector);yield n.builders.structure.representation.applyPreset(s,"auto")})).runInContext(r))),P0t=Hu.build({display:{name:"Load Trajectory",description:"Load trajectory of model/topology and coordinates from URL or file."},from:Se.Root,params(e,t){const{options:n}=t.dataFormats,r=n.filter(a=>a[2]===sm||a[2]===BP),i=n.filter(a=>a[2]===NA),o=[],s=[];for(const{provider:a}of t.dataFormats.list)a.category===sm||a.category===BP?(a.binaryExtensions&&o.push(...a.binaryExtensions),a.stringExtensions&&o.push(...a.stringExtensions)):a.category===NA&&(a.binaryExtensions&&s.push(...a.binaryExtensions),a.stringExtensions&&s.push(...a.stringExtensions));return{source:I.MappedStatic("file",{url:I.Group({model:I.Group({url:I.Url(""),format:I.Select(r[0][0],r),isBinary:I.Boolean(!1)},{isExpanded:!0}),coordinates:I.Group({url:I.Url(""),format:I.Select(i[0][0],i)},{isExpanded:!0})},{isFlat:!0}),file:I.Group({model:I.File({accept:o.map(a=>`.${a}`).join(","),label:"Model"}),coordinates:I.File({accept:s.map(a=>`.${a}`).join(","),label:"Coordinates"})},{isFlat:!0})},{options:[["url","URL"],["file","File"]]})}}})(({params:e,state:t},n)=>Ke.create("Load Trajectory",r=>t.transaction(le(function*(){const i=e.source;if("file"===i.name&&(null===i.params.model||null===i.params.coordinates))return void n.log.error("No file(s) selected");if(!("url"!==i.name||i.params.model&&i.params.coordinates))return void n.log.error("No URL(s) given");const o=function(){var a=le(function*(l,c,u){const d=yield n.builders.data.download({url:l,isBinary:u}),f=n.dataFormats.get(c);if(f)return f.parse(n,d);n.log.warn(`LoadTrajectory: could not find data provider for '${c}'`)});return function(c,u,d){return a.apply(this,arguments)}}(),s=function(){var a=le(function*(l){var c,u,d;if(!l)throw new Error("No file selected");const f=RA(null!==(u=null===(c=l.file)||void 0===c?void 0:c.name)&&void 0!==u?u:""),p=n.dataFormats.binaryExtensions.has(f.ext),{data:m}=yield n.builders.data.readFile({file:l,isBinary:p}),h=n.dataFormats.auto(f,null===(d=m.cell)||void 0===d?void 0:d.obj);return h?h.parse(n,m):(n.log.warn(`LoadTrajectory: could not find data provider for '${f.ext}'`),void(yield n.state.data.build().delete(m).commit()))});return function(c){return a.apply(this,arguments)}}();try{const a="url"===i.name?yield o(i.params.model.url,i.params.model.format,i.params.model.isBinary):yield s(i.params.model);let l;l="trajectory"in a?yield t.build().to(a.trajectory).apply(mpe,{modelIndex:0}).commit():a.topology;const c="url"===i.name?yield o(i.params.coordinates.url,i.params.coordinates.format,!0):yield s(i.params.coordinates),u=[l.ref,c.ref],d=t.build().toRoot().apply(JH,{modelRef:l.ref,coordinatesRef:c.ref},{dependsOn:u}).apply(at.Model.ModelFromTrajectory,{modelIndex:0});yield t.updateTree(d).runInContext(r);const f=yield n.builders.structure.createStructure(d.selector);yield n.builders.structure.representation.applyPreset(f,"auto")}catch(a){console.error(a),n.log.error("Error loading trajectory")}})).runInContext(r))),k0t=Hu.build({from:Se.Root,display:{name:"Download Density",description:"Load a density from the provided source and create its default visual."},params:(e,t)=>{const{options:n}=t.dataFormats;return{source:I.MappedStatic("pdb-xray",{"pdb-xray":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("rcsb",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),type:I.Select("2fofc",[["2fofc","2Fo-Fc"],["fofc","Fo-Fc"]])},{isFlat:!0}),"pdb-xray-ds":I.Group({provider:I.Group({id:I.Text("1tqn",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),"pdb-emd-ds":I.Group({provider:I.Group({id:I.Text("emd-8004",{label:"Id"}),server:I.Select("pdbe",[["pdbe","PDBe"],["rcsb","RCSB PDB"]])},{pivot:"id"}),detail:I.Numeric(3,{min:0,max:6,step:1},{label:"Detail"})},{isFlat:!0}),url:I.Group({url:I.Url(""),isBinary:I.Boolean(!1),format:I.Select("auto",n)},{isFlat:!0})},{options:[["pdb-xray","PDB X-ray maps"],["pdb-emd-ds","PDB EMD Density Server"],["pdb-xray-ds","PDB X-ray Density Server"],["url","URL"]]})}}})(({params:e},t)=>Ke.create("Download Density",function(){var n=le(function*(r){var i,o;const s=e.source;let a,l;switch(s.name){case"url":a=s.params;break;case"pdb-xray":a="pdbe"===s.params.provider.server?{url:jr.Url("2fofc"===s.params.type?`https://www.ebi.ac.uk/pdbe/coordinates/files/${s.params.provider.id.toLowerCase()}.ccp4`:`https://www.ebi.ac.uk/pdbe/coordinates/files/${s.params.provider.id.toLowerCase()}_diff.ccp4`),isBinary:!0,label:`PDBe X-ray map: ${s.params.provider.id}`}:{url:jr.Url("2fofc"===s.params.type?`https://edmaps.rcsb.org/maps/${s.params.provider.id.toLowerCase()}_2fofc.dsn6`:`https://edmaps.rcsb.org/maps/${s.params.provider.id.toLowerCase()}_fofc.dsn6`),isBinary:!0,label:`RCSB X-ray map: ${s.params.provider.id}`};break;case"pdb-emd-ds":a="pdbe"===s.params.provider.server?{url:jr.Url(`https://www.ebi.ac.uk/pdbe/densities/emd/${s.params.provider.id.toLowerCase()}/cell?detail=${s.params.detail}`),isBinary:!0,label:`PDBe EMD Density Server: ${s.params.provider.id}`}:{url:jr.Url(`https://maps.rcsb.org/em/${s.params.provider.id.toLowerCase()}/cell?detail=${s.params.detail}`),isBinary:!0,label:`RCSB PDB EMD Density Server: ${s.params.provider.id}`};break;case"pdb-xray-ds":a="pdbe"===s.params.provider.server?{url:jr.Url(`https://www.ebi.ac.uk/pdbe/densities/x-ray/${s.params.provider.id.toLowerCase()}/cell?detail=${s.params.detail}`),isBinary:!0,label:`PDBe X-ray Density Server: ${s.params.provider.id}`}:{url:jr.Url(`https://maps.rcsb.org/x-ray/${s.params.provider.id.toLowerCase()}/cell?detail=${s.params.detail}`),isBinary:!0,label:`RCSB PDB X-ray Density Server: ${s.params.provider.id}`};break;default:Hi()}const c=yield t.builders.data.download(a);let u;switch(s.name){case"url":a=s.params,l="auto"===s.params.format?t.dataFormats.auto(RA(jr.getUrl(a.url)),null===(i=c.cell)||void 0===i?void 0:i.obj):t.dataFormats.get(s.params.format);break;case"pdb-xray":u=s.params.provider.id,l=t.dataFormats.get("pdbe"===s.params.provider.server?"ccp4":"dsn6");break;case"pdb-emd-ds":case"pdb-xray-ds":u=s.params.provider.id,l=t.dataFormats.get("dscif");break;default:Hi()}if(!l)return void t.log.warn("DownloadDensity: Format provider not found.");const d=yield l.parse(t,c,{entryId:u});yield null===(o=l.visuals)||void 0===o?void 0:o.call(l,t,d)});return function(r){return n.apply(this,arguments)}}())),Cbe=Hu.build({display:{name:"Assign Volume Colors",description:"Assigns another volume to be available for coloring."},from:Se.Volume.Data,isApplicable:e=>!e.data.colorVolume,params(e,t){const n=t.state.data.select(Qn.Generators.root.subtree().ofType(Se.Volume.Data).filter(r=>{var i;return!(!r.obj||null!==(i=r.obj)&&void 0!==i&&i.data.colorVolume||r.obj===e)}));return 0===n.length?{ref:I.Text("",{isHidden:!0,label:"Volume"})}:{ref:I.Select(n[0].transform.ref,n.map(r=>[r.transform.ref,r.obj.label]),{label:"Volume"})}}})(({ref:e,params:t},r)=>r.build().to(e).apply(at.Volume.AssignColorVolume,{ref:t.ref},{dependsOn:[t.ref]}).commit());function aO(e,t,n,r){return RW.apply(this,arguments)}function RW(){return RW=le(function*(e,t,n,r){var i,o,s,a;const l=RA(null!==(o=null===(i=e.file)||void 0===i?void 0:i.name)&&void 0!==o?o:""),c=t.dataFormats.binaryExtensions.has(l.ext),{data:u}=yield t.builders.data.readFile({file:e,isBinary:c}),d="auto"===n?t.dataFormats.auto(l,null===(s=u.cell)||void 0===s?void 0:s.obj):t.dataFormats.get(n);if(!d)return t.log.warn(`OpenFiles: could not find data provider for '${l.ext}'`),void(yield t.state.data.build().delete(u).commit());const f=yield d.parse(t,u);r&&(yield null===(a=d.visuals)||void 0===a?void 0:a.call(d,t,f))}),RW.apply(this,arguments)}const NW=Hu.build({display:{name:"Open Files",description:"Load one or more files and optionally create default visuals"},from:Se.Root,params:(e,t)=>{const{extensions:n,options:r}=t.dataFormats;return{files:I.FileList({accept:Array.from(n.values()).map(i=>`.${i}`).join(",")+",.gz,.zip",multiple:!0}),format:I.MappedStatic("auto",{auto:I.EmptyGroup(),specific:I.Select(r[0][0],r)}),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},n)=>Ke.create("Open Files",function(){var r=le(function*(i){n.behaviors.layout.leftPanelTabName.next("data"),yield t.transaction(le(function*(){if(null!==e.files)for(const o of e.files)try{if(o.file&&o.name.toLowerCase().endsWith(".zip")){const s=yield q3(i,yield o.file.arrayBuffer());for(const[a,l]of Object.entries(s)){if(!(l instanceof Uint8Array)||0===l.length)continue;const c=jr.File(new File([l],a));yield aO(c,n,"auto",e.visuals)}}else{const s="auto"===e.format.name?"auto":e.format.params;yield aO(o,n,s,e.visuals)}}catch(s){console.error(s),n.log.error(`Error opening file '${o.name}'`)}else n.log.error("No file(s) selected")})).runInContext(i)});return function(i){return r.apply(this,arguments)}}())),M0t=Hu.build({display:{name:"Download File",description:"Load one or more file from an URL"},from:Se.Root,params:(e,t)=>{const n=[...t.dataFormats.options,["zip","Zip"],["gzip","Gzip"]];return{url:I.Url(""),format:I.Select(n[0][0],n),isBinary:I.Boolean(!1),visuals:I.Boolean(!0,{description:"Add default visuals"})}}})(({params:e,state:t},n)=>Ke.create("Open Files",function(){var r=le(function*(i){n.behaviors.layout.leftPanelTabName.next("data"),yield t.transaction(le(function*(){var o,s,a;try{if("zip"===e.format||"gzip"===e.format){const l=yield n.builders.data.download({url:e.url,isBinary:!0});if("zip"===e.format){const c=yield q3(i,(null===(o=l.obj)||void 0===o?void 0:o.data).buffer);for(const[u,d]of Object.entries(c)){if(!(d instanceof Uint8Array)||0===d.length)continue;const f=jr.File(new File([d],u));yield aO(f,n,"auto",e.visuals)}}else{const u=RA(jr.getUrl(e.url)).name;yield aO(jr.File(new File([null===(s=l.obj)||void 0===s?void 0:s.data],u)),n,"auto",e.visuals)}}else{const l=n.dataFormats.get(e.format);if(!l)return void n.log.warn(`DownloadFile: could not find data provider for '${e.format}'`);const c=yield n.builders.data.download({url:e.url,isBinary:e.isBinary}),u=yield l.parse(n,c);e.visuals&&(yield null===(a=l.visuals)||void 0===a?void 0:a.call(l,n,u))}}catch(l){console.error(l),n.log.error(`Error downloading '${"string"==typeof e.url?e.url:e.url.url}'`)}})).runInContext(i)});return function(i){return r.apply(this,arguments)}}())),s2={Structure:Cc,Volume:wc,DataFormat:Ss},R0t=Uy.create({name:"built-in.animate-state-interpolation",display:{name:"Animate State (experimental)"},params:()=>({transtionDurationInMs:I.Numeric(2e3,{min:100,max:3e4,step:10})}),canApply:e=>({canApply:e.managers.snapshot.state.entries.size>1}),initialState:()=>({}),apply:(e,t,n)=>le(function*(){const r=n.plugin.managers.snapshot.state.entries;if(r.size<2)return{kind:"finished"};const i=t.current%n.params.transtionDurationInMs/n.params.transtionDurationInMs,o=Math.floor(t.current/n.params.transtionDurationInMs)%r.size;let s=Math.ceil(t.current/n.params.transtionDurationInMs);s===o&&s++,s%=r.size;const a=r.get(o).snapshot,l=r.get(s).snapshot;if(!a.data||!l.data)return{kind:"skip"};const c=a.data.tree.transforms,u=l.data.tree.transforms,d=n.plugin.state.data,f=d.build();for(const p of c)for(const m of u){if(m.ref!==p.ref||m.version===p.version)continue;const h=vr.fromJSON(p),g=vr.fromJSON(m),y=d.cells.get(p.ref);if(!y)continue;let v;v=h.transformer.definition.interpolate?h.transformer.definition.interpolate(h.params,g.params,i,n.plugin):i<=.5?h.params:g.params,l3(y,v)||f.to(p.ref).update(v)}return yield jt.State.Update(n.plugin,{state:d,tree:f,options:{doNotLogTiming:!0}}),{kind:"next",state:{}}})()}),N0t=Uy.create({name:"built-in.animate-structure-spin",display:{name:"Spin Structure"},isExportable:!0,params:()=>({durationInMs:I.Numeric(3e3,{min:100,max:1e4,step:100})}),initialState:()=>({t:0}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),setup:(e,t,n)=>le(function*(){const r=n.state.data,i=r.select(Qn.Generators.ofType(Se.Molecule.Structure.Representation3D)),o=r.build();let s=!1;for(const a of i)r.select(Qn.Generators.ofTransformer(at.Representation.SpinStructureRepresentation3D,a.transform.ref)).length>0||(s=!0,o.to(a.transform.ref).apply(at.Representation.SpinStructureRepresentation3D,{t:0},{tags:"animate-structure-spin"}));if(s)return o.commit({doNotUpdateCurrent:!0})})(),teardown(e,t,n){const r=n.state.data,i=r.select(Qn.Generators.ofType(Se.Molecule.Structure.Representation3DState).withTag("animate-structure-spin"));if(0===i.length)return;const o=r.build();for(const s of i)o.delete(s.transform.ref);return o.commit()},apply:(e,t,n)=>le(function*(){var r;const i=n.plugin.state.data,o=i.select(Qn.Generators.ofTransformer(at.Representation.SpinStructureRepresentation3D));if(0===o.length)return{kind:"finished"};const s=i.build(),l=(e.t+(t.current-t.lastApplied)/n.params.durationInMs)%1;for(const c of o)s.to(c).update({...null===(r=c.params)||void 0===r?void 0:r.values,t:l});return yield jt.State.Update(n.plugin,{state:i,tree:s,options:{doNotLogTiming:!0}}),{kind:"next",state:{t:l}}})()}),lO=C(),wbe=C(),Abe=Ai(),F0t=Uy.create({name:"built-in.animate-camera-rock",display:{name:"Camera Rock",description:"Rock the 3D scene around the x-axis in view space"},isExportable:!0,params:()=>({durationInMs:I.Numeric(4e3,{min:100,max:2e4,step:100}),speed:I.Numeric(1,{min:1,max:10,step:1},{description:"How many times to rock from side to side."}),angle:I.Numeric(10,{min:0,max:180,step:1},{description:"How many degrees to rotate in each direction."})}),initialState:(e,t)=>({snapshot:t.canvas3d.camera.getSnapshot()}),getDuration:e=>({kind:"fixed",durationMs:e.durationInMs}),teardown:(e,t,n)=>{var r;null===(r=n.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t.snapshot,durationMs:0})},apply:(e,t,n)=>le(function*(){var r,i;if(0===t.current)return{kind:"next",state:e};const o=e.snapshot;if(o.radiusMax<1e-4)return{kind:"finished"};const s=t.animation?(null===(r=t.animation)||void 0===r?void 0:r.currentFrame)/(t.animation.frameCount+1):al(t.current/n.params.durationInMs,0,1),a=Math.sin(s*n.params.speed*Math.PI*2)*Xr(n.params.angle);C.sub(lO,o.position,o.target),C.normalize(wbe,o.up),Ai.setAxisAngle(Abe,wbe,a),C.transformQuat(lO,lO,Abe);const l=C.add(C(),o.target,lO);return null===(i=n.plugin.canvas3d)||void 0===i||i.requestCameraReset({snapshot:{...o,position:l},durationMs:0}),s>=.99999?{kind:"finished"}:{kind:"next",state:e}})()});var Vn;!function(e){e.Action=function t(r,i){return{action:r,customControl:i&&i.customControl,autoUpdate:i&&i.autoUpdate}},e.Behavior=function n(r,i={}){return{transformer:r,defaultParams:i}}}(Vn||(Vn={}));var L=ln(619),Yt=ln(395);function Mi(e){return e.svg?(0,L.jsx)("span",{className:"msp-icon msp-material-icon"+(e.inline?" msp-icon-inline":""),title:e.title,style:e.style,children:(0,L.jsx)(e.svg,{})}):null}const cO=(0,L.jsx)("circle",{r:"6px",id:"circle-left",cy:"12px",cx:"8px",strokeWidth:"1px"}),uO=(0,L.jsx)("circle",{r:"6px",id:"circle-right",cy:"12px",cx:"16px",strokeWidth:"1px"}),B0t=(0,L.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,L.jsxs)("defs",{children:[cO,uO]}),(0,L.jsxs)("g",{children:[(0,L.jsx)("use",{href:"#circle-left",className:"msp-shape-filled"}),(0,L.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"}),(0,L.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"})]})]});function FW(){return B0t}const L0t=(0,L.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,L.jsxs)("defs",{children:[cO,uO,(0,L.jsxs)("mask",{id:"mask-left",children:[(0,L.jsx)("use",{href:"#circle-left",fill:"white",stroke:"white"}),(0,L.jsx)("use",{href:"#circle-right",fill:"black",strokeWidth:"0px",stroke:"white"})]})]}),(0,L.jsxs)("g",{children:[(0,L.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",mask:"url(#mask-left)"}),(0,L.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function OW(){return L0t}const j0t=(0,L.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,L.jsxs)("defs",{children:[cO,uO,(0,L.jsx)("clipPath",{id:"clip-left",children:(0,L.jsx)("use",{href:"#circle-right"})})]}),(0,L.jsxs)("g",{children:[(0,L.jsx)("use",{href:"#circle-left",className:"msp-shape-filled",clipPath:"url(#clip-left)"}),(0,L.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,L.jsx)("use",{href:"#circle-right",className:"msp-shape-empty"})]})]});function BW(){return j0t}const U0t=(0,L.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,L.jsxs)("defs",{children:[cO,uO]}),(0,L.jsxs)("g",{children:[(0,L.jsx)("use",{href:"#circle-left",className:"msp-shape-empty"}),(0,L.jsx)("use",{href:"#circle-right",className:"msp-shape-filled"})]})]});function dO(){return U0t}const z0t=(0,L.jsx)("svg",{width:"17px",height:"17px",viewBox:"0 0 299.463 299.463",strokeWidth:"6px",children:(0,L.jsx)("g",{children:(0,L.jsx)("path",{d:"M256.851,173.832v-48.201c22.916-4.918,34.151-30.668,22.556-50.771c-11.547-20.004-39.486-23.251-55.242-5.844 l-41.746-24.106C189.618,22.603,172.861,0,149.734,0c-23.132,0-39.881,22.609-32.685,44.911L75.305,69.016 C59.522,51.586,31.597,54.88,20.061,74.863c-11.63,20.163-0.298,45.862,22.557,50.769v48.2 c-22.821,4.898-34.195,30.591-22.556,50.771c11.529,19.972,39.454,23.285,55.242,5.845l41.746,24.106 c-7.199,22.308,9.559,44.911,32.685,44.911c23.132,0,39.88-22.609,32.685-44.911l41.745-24.106 c15.817,17.469,43.73,14.099,55.242-5.844c0,0,0-0.001,0.001-0.002c4.587-7.953,5.805-17.213,3.431-26.076 C279.392,185.657,269.129,176.461,256.851,173.832z M249.62,72.088c20.568,0,27.428,27.191,10.008,37.239 c-0.003,0.002-0.006,0.003-0.009,0.005c-10.04,5.81-22.85,1.762-27.877-8.475C225.206,87.548,234.938,72.088,249.62,72.088z M149.734,14.4c11.005,0,19.958,8.954,19.958,19.959c0,11.127-9.077,19.958-19.958,19.958c-10.95,0-19.958-8.9-19.958-19.958 C129.776,23.354,138.729,14.4,149.734,14.4z M39.84,109.328c-17.451-10.067-10.534-37.24,10.01-37.24 c15.311,0,24.922,16.653,17.251,29.942C61.681,111.397,49.517,114.925,39.84,109.328z M59.802,224.702 c-9.535,5.503-21.768,2.229-27.268-7.298c-7.639-13.242,1.887-29.945,17.236-29.945c0.013,0,0.027,0,0.04,0 C70.07,187.48,77.49,214.469,59.802,224.702z M149.734,285.062c-11.005,0-19.958-8.954-19.958-19.958 c0-11.127,9.077-19.958,19.958-19.958c10.954,0,19.958,8.903,19.958,19.958C169.693,276.109,160.74,285.062,149.734,285.062z M216.953,217.982l-41.727,24.095c-13.778-15.22-37.459-14.94-50.983,0l-41.728-24.096c6.196-19.289-5.541-39.835-25.498-44.149 V125.63c19.752-4.268,31.762-24.65,25.498-44.149l41.727-24.095c13.629,15.055,37.32,15.093,50.983,0l41.728,24.096 c-6.196,19.29,5.534,39.835,25.498,44.149v48.202C222.61,178.123,210.721,198.581,216.953,217.982z M266.935,217.404 c-5.501,9.528-17.732,12.802-27.261,7.302c-17.682-10.23-10.301-37.247,10.032-37.247 C264.984,187.459,274.602,204.112,266.935,217.404z"})})});function V0t(){return z0t}const H0t=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{d:"M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15M5,15.91L11,19.29V12.58L5,9.21V15.91M19,15.91V9.21L13,12.58V19.29L19,15.91Z"})});function LW(){return H0t}(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{d:"M17,22V20H20V17H22V20.5C22,20.89 21.84,21.24 21.54,21.54C21.24,21.84 20.89,22 20.5,22H17M7,22H3.5C3.11,22 2.76,21.84 2.46,21.54C2.16,21.24 2,20.89 2,20.5V17H4V20H7V22M17,2H20.5C20.89,2 21.24,2.16 21.54,2.46C21.84,2.76 22,3.11 22,3.5V7H20V4H17V2M7,2V4H4V7H2V3.5C2,3.11 2.16,2.76 2.46,2.46C2.76,2.16 3.11,2 3.5,2H7M13,17.25L17,14.95V10.36L13,12.66V17.25M12,10.92L16,8.63L12,6.28L8,8.63L12,10.92M7,14.95L11,17.25V12.66L7,10.36V14.95M18.23,7.59C18.73,7.91 19,8.34 19,8.91V15.23C19,15.8 18.73,16.23 18.23,16.55L12.75,19.73C12.25,20.05 11.75,20.05 11.25,19.73L5.77,16.55C5.27,16.23 5,15.8 5,15.23V8.91C5,8.34 5.27,7.91 5.77,7.59L11.25,4.41C11.5,4.28 11.75,4.22 12,4.22C12.25,4.22 12.5,4.28 12.75,4.41L18.23,7.59Z"})}),(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{d:"M16,4L9,8.04V15.96L16,20L23,15.96V8.04M16,6.31L19.8,8.5L16,10.69L12.21,8.5M0,7V9H7V7M11,10.11L15,12.42V17.11L11,14.81M21,10.11V14.81L17,17.11V12.42M2,11V13H7V11M4,15V17H7V15"})});const W0t=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M10.07,14.27C10.57,14.03 11.16,14.25 11.4,14.75L13.7,19.74L15.5,18.89L13.19,13.91C12.95,13.41 13.17,12.81 13.67,12.58L13.95,12.5L16.25,12.05L8,5.12V15.9L9.82,14.43L10.07,14.27M13.64,21.97C13.14,22.21 12.54,22 12.31,21.5L10.13,16.76L7.62,18.78C7.45,18.92 7.24,19 7,19A1,1 0 0,1 6,18V3A1,1 0 0,1 7,2C7.24,2 7.47,2.09 7.64,2.23L7.65,2.22L19.14,11.86C19.57,12.22 19.62,12.85 19.27,13.27C19.12,13.45 18.91,13.57 18.7,13.61L15.54,14.23L17.74,18.96C18,19.46 17.76,20.05 17.26,20.28L13.64,21.97Z"})});(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{fill:"currentColor",d:"M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"})}),(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{fill:"currentColor",d:"M20,11H23V13H20V11M1,11H4V13H1V11M13,1V4H11V1H13M4.92,3.5L7.05,5.64L5.63,7.05L3.5,4.93L4.92,3.5M16.95,5.63L19.07,3.5L20.5,4.93L18.37,7.05L16.95,5.63M12,6A6,6 0 0,1 18,12C18,14.22 16.79,16.16 15,17.2V19A1,1 0 0,1 14,20H10A1,1 0 0,1 9,19V17.2C7.21,16.16 6,14.22 6,12A6,6 0 0,1 12,6M14,21V22A1,1 0 0,1 13,23H11A1,1 0 0,1 10,22V21H14M11,18H13V15.87C14.73,15.43 16,13.86 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13.86 9.27,15.43 11,15.87V18Z"})});const K0t=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{fill:"currentColor",d:"M7.5,5.6L5,7L6.4,4.5L5,2L7.5,3.4L10,2L8.6,4.5L10,7L7.5,5.6M19.5,15.4L22,14L20.6,16.5L22,19L19.5,17.6L17,19L18.4,16.5L17,14L19.5,15.4M22,2L20.6,4.5L22,7L19.5,5.6L17,7L18.4,4.5L17,2L19.5,3.4L22,2M13.34,12.78L15.78,10.34L13.66,8.22L11.22,10.66L13.34,12.78M14.37,7.29L16.71,9.63C17.1,10 17.1,10.65 16.71,11.04L5.04,22.71C4.65,23.1 4,23.1 3.63,22.71L1.29,20.37C0.9,20 0.9,19.35 1.29,18.96L12.96,7.29C13.35,6.9 14,6.9 14.37,7.29Z"})});function Z0t(){return K0t}const Q0t=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{d:"M3 17.25V21H6.75L17.81 9.93L14.06 6.18L3 17.25M22.61 18.36L18.36 22.61L13.16 17.41L14.93 15.64L15.93 16.64L18.4 14.16L19.82 15.58L18.36 17L19.42 18L20.84 16.6L22.61 18.36M6.61 10.83L1.39 5.64L5.64 1.39L7.4 3.16L4.93 5.64L6 6.7L8.46 4.22L9.88 5.64L8.46 7.05L9.46 8.05L6.61 10.83M20.71 7C21.1 6.61 21.1 6 20.71 5.59L18.37 3.29C18 2.9 17.35 2.9 16.96 3.29L15.12 5.12L18.87 8.87L20.71 7Z"})});function J0t(){return Q0t}const eyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3h7zM7 9H4V5h3v4zm10 6h3v4h-3v-4zm0-10h3v4h-3V5z"})});function Ibe(){return eyt}const tyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})});function FA(){return tyt}const nyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M20 12l-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8 8-8z"})});function fO(){return nyt}const ryt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M7 10l5 5 5-5z"})});function Yy(){return ryt}const iyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M10 17l5-5-5-5v10z"})});function Xy(){return iyt}const oyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M4 12l1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8-8 8z"})});function pO(){return oyt}const syt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"})});function ayt(){return syt}const lyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M6 13c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm-3 .5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM6 5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm15 5.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM14 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0-3.5c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zm-11 10c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm7 7c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm0-17c.28 0 .5-.22.5-.5s-.22-.5-.5-.5-.5.22-.5.5.22.5.5.5zM10 7c.55 0 1-.45 1-1s-.45-1-1-1-1 .45-1 1 .45 1 1 1zm0 5.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm8 .5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-8c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0-4c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm3 8.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zM14 17c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm0 3.5c-.28 0-.5.22-.5.5s.22.5.5.5.5-.22.5-.5-.22-.5-.5-.5zm-4-12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0 8.5c-.55 0-1 .45-1 1s.45 1 1 1 1-.45 1-1-.45-1-1-1zm4-4.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-4c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5z"})});function Ebe(){return lyt}const cyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M15 7v12.97l-4.21-1.81-.79-.34-.79.34L5 19.97V7h10m4-6H8.99C7.89 1 7 1.9 7 3h10c1.1 0 2 .9 2 2v13l2 1V3c0-1.1-.9-2-2-2zm-4 4H5c-1.1 0-2 .9-2 2v16l7-3 7 3V7c0-1.1-.9-2-2-2z"})});function OA(){return cyt}const uyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3zm13.71-9.37l-1.34-1.34a.9959.9959 0 00-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41z"})});function jW(){return uyt}const dyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M22.61 18.99l-9.08-9.08c.93-2.34.45-5.1-1.44-7C9.79.61 6.21.4 3.66 2.26L7.5 6.11 6.08 7.52 2.25 3.69C.39 6.23.6 9.82 2.9 12.11c1.86 1.86 4.57 2.35 6.89 1.48l9.11 9.11c.39.39 1.02.39 1.41 0l2.3-2.3c.4-.38.4-1.01 0-1.41zm-3 1.6l-9.46-9.46c-.61.45-1.29.72-2 .82-1.36.2-2.79-.21-3.83-1.25C3.37 9.76 2.93 8.5 3 7.26l3.09 3.09 4.24-4.24-3.09-3.09c1.24-.07 2.49.37 3.44 1.31 1.08 1.08 1.49 2.57 1.24 3.96-.12.71-.42 1.37-.88 1.96l9.45 9.45-.88.89z"})});function fyt(){return dyt}const pyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"})});function hyt(){return pyt}const myt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M14.25 2.26l-.08-.04-.01.02C13.46 2.09 12.74 2 12 2 6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10c0-4.75-3.31-8.72-7.75-9.74zM19.41 9h-7.99l2.71-4.7c2.4.66 4.35 2.42 5.28 4.7zM13.1 4.08L10.27 9l-1.15 2L6.4 6.3C7.84 4.88 9.82 4 12 4c.37 0 .74.03 1.1.08zM5.7 7.09L8.54 12l1.15 2H4.26C4.1 13.36 4 12.69 4 12c0-1.85.64-3.55 1.7-4.91zM4.59 15h7.98l-2.71 4.7c-2.4-.67-4.34-2.42-5.27-4.7zm6.31 4.91L14.89 13l2.72 4.7C16.16 19.12 14.18 20 12 20c-.38 0-.74-.04-1.1-.09zm7.4-3l-4-6.91h5.43c.17.64.27 1.31.27 2 0 1.85-.64 3.55-1.7 4.91z"})});function gyt(){return myt}const yyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M9.4 10.5l4.77-8.26C13.47 2.09 12.75 2 12 2c-2.4 0-4.6.85-6.32 2.25l3.66 6.35.06-.1zM21.54 9c-.92-2.92-3.15-5.26-6-6.34L11.88 9h9.66zm.26 1h-7.49l.29.5 4.76 8.25C21 16.97 22 14.61 22 12c0-.69-.07-1.35-.2-2zM8.54 12l-3.9-6.75C3.01 7.03 2 9.39 2 12c0 .69.07 1.35.2 2h7.49l-1.15-2zm-6.08 3c.92 2.92 3.15 5.26 6 6.34L12.12 15H2.46zm11.27 0l-3.9 6.76c.7.15 1.42.24 2.17.24 2.4 0 4.6-.85 6.32-2.25l-3.66-6.35-.93 1.6z"})});function byt(){return yyt}const vyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"})});function UW(){return vyt}const xyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"})});function Tbe(){return xyt}const _yt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm-7 7H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4z"})});function Syt(){return _yt}const Cyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})});function a2(){return Cyt}const wyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function Dbe(){return wyt}const Ayt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})});function Rg(){return Ayt}const Iyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"})});function Eyt(){return Iyt}const Tyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"})});function Dyt(){return Tyt}const Pyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm-1 4H8c-1.1 0-1.99.9-1.99 2L6 21c0 1.1.89 2 1.99 2H19c1.1 0 2-.9 2-2V11l-6-6zM8 21V7h6v5h5v9H8z"})});function kyt(){return Pyt}const Myt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M17 15h2V7c0-1.1-.9-2-2-2H9v2h8v8zM7 17V1H5v4H1v2h4v10c0 1.1.9 2 2 2h10v4h2v-4h4v-2H7z"})});function Ryt(){return Myt}const Nyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2zm2 10H3v4c0 1.1.9 2 2 2h4v-2H5v-4zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2z"})});function Fyt(){return Nyt}const Oyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5.04-6.71l-2.75 3.54-1.96-2.36L6.5 17h11l-3.54-4.71z"})});function Byt(){return Oyt}const Lyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"})});function qp(){return Lyt}(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})});const Uyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})});function Pbe(){return Uyt}(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"})});const Vyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{d:"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm2 4v-2H3c0 1.1.89 2 2 2zM3 9h2V7H3v2zm12 12h2v-2h-2v2zm4-18H9c-1.11 0-2 .9-2 2v10c0 1.1.89 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 12H9V5h10v10zm-8 6h2v-2h-2v2zm-4 0h2v-2H7v2z"})}),Gyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"})});function qyt(){return Gyt}const Wyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"})});function zW(){return Wyt}const $yt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"})});function Ng(){return $yt}const Yyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"})});function VW(){return Yyt}(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"})});const Kyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19.5 9.5c-1.03 0-1.9.62-2.29 1.5h-2.92c-.39-.88-1.26-1.5-2.29-1.5s-1.9.62-2.29 1.5H6.79c-.39-.88-1.26-1.5-2.29-1.5C3.12 9.5 2 10.62 2 12s1.12 2.5 2.5 2.5c1.03 0 1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5s1.9-.62 2.29-1.5h2.92c.39.88 1.26 1.5 2.29 1.5 1.38 0 2.5-1.12 2.5-2.5s-1.12-2.5-2.5-2.5z"})}),Qyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M6 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm12 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-6 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})});function l2(){return Qyt}const Jyt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})});function kbe(){return Jyt}const ebt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})});function Mbe(){return ebt}const tbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 4H5c-1.11 0-2 .9-2 2v12c0 1.1.89 2 2 2h4v-2H5V8h14v10h-4v2h4c1.1 0 2-.9 2-2V6c0-1.1-.89-2-2-2zm-7 6l-4 4h3v6h2v-6h3l-4-4z"})});function nbt(){return tbt}const rbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M8 5v14l11-7z"})});function Rbe(){return rbt}const ibt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})});function HW(){return ibt}const obt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M19 13H5v-2h14v2z"})});function GW(){return obt}const sbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})});function qW(){return sbt}const abt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",strokeWidth:"0.1px",children:(0,L.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"})});function Nbe(){return abt}const lbt=(0,L.jsxs)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:[(0,L.jsx)("circle",{cx:"7",cy:"14",r:"3"}),(0,L.jsx)("circle",{cx:"11",cy:"6",r:"3"}),(0,L.jsx)("circle",{cx:"16.6",cy:"17.6",r:"3"})]});(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})});const dbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})});function fbt(){return dbt}const pbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M6 6h12v12H6z"})});function Fbe(){return pbt}const hbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M4 6h16v2H4zm2-4h12v2H6zm14 8H4c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2v-8c0-1.1-.9-2-2-2zm0 10H4v-8h16v8zm-10-7.27v6.53L16 16z"})});function mbt(){return hbt}const gbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M6.99 11L3 15l3.99 4v-3H14v-2H6.99v-3zM21 9l-3.99-4v3H10v2h7.01v3L21 9z"})});function ybt(){return gbt}const bbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M3 17v2h6v-2H3zM3 5v2h10V5H3zm10 16v-2h8v-2h-8v-2h-2v6h2zM7 9v2H3v2h4v2h2V9H7zm14 4v-2H11v2h10zm-6-4h2V7h4V5h-4V3h-2v6z"})});function uv(){return bbt}const vbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5-.59 1.22-1.42 2.27-2.41 3.12l1.41 1.41c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l1.65 1.65C10.66 6.09 11.32 6 12 6zm-1.07 1.14L13 9.21c.57.25 1.03.71 1.28 1.28l2.07 2.07c.08-.34.14-.7.14-1.07C16.5 9.01 14.48 7 12 7c-.37 0-.72.05-1.07.14zM2.01 3.87l2.68 2.68C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.98-.29 4.32-.82l3.42 3.42 1.41-1.41L3.42 2.45 2.01 3.87zm7.5 7.5l2.61 2.61c-.04.01-.08.02-.12.02-1.38 0-2.5-1.12-2.5-2.5 0-.05.01-.08.01-.13zm-3.4-3.4l1.75 1.75c-.23.55-.36 1.15-.36 1.78 0 2.48 2.02 4.5 4.5 4.5.63 0 1.23-.13 1.77-.36l.98.98c-.88.24-1.8.38-2.75.38-3.79 0-7.17-2.13-8.82-5.5.7-1.43 1.72-2.61 2.93-3.53z"})});function c2(){return vbt}const xbt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M12 6c3.79 0 7.17 2.13 8.82 5.5C19.17 14.87 15.79 17 12 17s-7.17-2.13-8.82-5.5C4.83 8.13 8.21 6 12 6m0-2C7 4 2.73 7.11 1 11.5 2.73 15.89 7 19 12 19s9.27-3.11 11-7.5C21.27 7.11 17 4 12 4zm0 5c1.38 0 2.5 1.12 2.5 2.5S13.38 14 12 14s-2.5-1.12-2.5-2.5S10.62 9 12 9m0-2c-2.48 0-4.5 2.02-4.5 4.5S9.52 16 12 16s4.5-2.02 4.5-4.5S14.48 7 12 7z"})});function u2(){return xbt}const _bt=(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})});function Obe(){return _bt}(0,L.jsx)("svg",{width:"24px",height:"24px",viewBox:"0 0 24 24",children:(0,L.jsx)("path",{d:"M 9.64 7.64 c 0.23 -0.5 0.36 -1.05 0.36 -1.64 c 0 -2.21 -1.79 -4 -4 -4 S 2 3.79 2 6 s 1.79 4 4 4 c 0.59 0 1.14 -0.13 1.64 -0.36 L 10 12 l -2.36 2.36 C 7.14 14.13 6.59 14 6 14 c -2.21 0 -4 1.79 -4 4 s 1.79 4 4 4 s 4 -1.79 4 -4 c 0 -0.59 -0.13 -1.14 -0.36 -1.64 L 12 14 l 7 7 h 3 v -1 L 9.64 7.64 Z M 6 8 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 0 12 c -1.1 0 -2 -0.89 -2 -2 s 0.9 -2 2 -2 s 2 0.89 2 2 s -0.9 2 -2 2 Z m 6 -7.5 c -0.28 0 -0.5 -0.22 -0.5 -0.5 s 0.22 -0.5 0.5 -0.5 s 0.5 0.22 0.5 0.5 s -0.22 0.5 -0.5 0.5 Z M 19 3 l -6 6 l 2 2 l 7 -7 V 3 Z"})});const Cbt=function $0t(){return W0t},wbt=function cbt(){return lbt},Bbe=function Zyt(){return Kyt},Abt=function Hyt(){return Vyt};class Fg extends Yt.Component{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initialExpanded},this.headerClicked=()=>{this.props.onHeaderClick?this.props.onHeaderClick():this.setState({isExpanded:!this.state.isExpanded})}}render(){let t=this.props.hideOffset?"msp-control-group-children":"msp-control-group-children msp-control-offset";return this.props.childrenClassName&&(t+=" "+this.props.childrenClassName),(0,L.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative",marginTop:this.props.noTopMargin?0:void 0},children:[(0,L.jsx)("div",{className:"msp-control-group-header",style:{marginLeft:this.props.headerLeftMargin},title:this.props.title,children:(0,L.jsxs)(ir,{onClick:this.headerClicked,children:[!this.props.hideExpander&&(0,L.jsx)(Mi,{svg:this.state.isExpanded?Xy:Yy}),this.props.topRightIcon&&(0,L.jsx)(Mi,{svg:this.props.topRightIcon,style:{position:"absolute",right:"2px",top:0}}),(0,L.jsx)("b",{children:this.props.header})]})}),this.state.isExpanded&&(0,L.jsx)("div",{className:t,style:{display:this.state.isExpanded?"block":"none",maxHeight:this.props.maxHeight,overflow:"hidden",overflowY:"auto"},children:this.props.children})]})}}function Lbe(e){return e}class Ky extends Yt.PureComponent{constructor(){super(...arguments),this.input=Yt.createRef(),this.delayHandle=void 0,this.pendingValue=void 0,this.state={originalValue:"",value:""},this.onBlur=()=>{this.setState({value:""+this.state.originalValue}),this.props.onBlur&&this.props.onBlur()},this.raiseOnChange=()=>{void 0!==this.pendingValue&&(this.props.onChange(this.pendingValue),this.pendingValue=void 0)},this.onChange=t=>{const n=t.target.value;if(this.props.isValid&&!this.props.isValid(n)||this.props.numeric&&Number.isNaN(+n))return this.clearTimeout(),void this.setState({value:n});if(this.props.numeric)this.setState({value:n},()=>this.triggerChanged(n,+n));else{const i=(this.props.toValue||Lbe)(n),o=(this.props.fromValue||Lbe)(i);this.setState({value:o},()=>this.triggerChanged(o,i))}},this.onKeyUp=t=>{(27===t.charCode||27===t.keyCode||"Escape"===t.key)&&this.props.blurOnEscape&&this.input.current&&this.input.current.blur()},this.onKeyPress=t=>{(13===t.keyCode||13===t.charCode||"Enter"===t.key)&&(this.isPending&&(this.clearTimeout(),this.raiseOnChange()),this.props.blurOnEnter&&this.input.current&&this.input.current.blur(),this.props.onEnter&&this.props.onEnter()),t.stopPropagation()}}get isPending(){return typeof this.delayHandle<"u"}clearTimeout(){this.isPending&&(clearTimeout(this.delayHandle),this.delayHandle=void 0)}triggerChanged(t,n){this.clearTimeout(),t!==this.state.originalValue&&(this.props.delayMs?(this.pendingValue=n,this.delayHandle=setTimeout(this.raiseOnChange,this.props.delayMs)):this.props.onChange(n))}static getDerivedStateFromProps(t,n){const r=t.fromValue?t.fromValue(t.value):t.value;return r===n.originalValue?null:{originalValue:r,value:r}}render(){return(0,L.jsx)("input",{type:"text",className:this.props.className,style:this.props.style,ref:this.input,onBlur:this.onBlur,value:this.state.value,placeholder:this.props.placeholder,onChange:this.onChange,onKeyPress:this.props.onEnter||this.props.blurOnEnter||this.props.blurOnEscape?this.onKeyPress:void 0,onKeyDown:this.props.blurOnEscape?this.onKeyUp:void 0,disabled:!!this.props.isDisabled})}}class Ibt extends Yt.Component{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){const{label:t,pivot:n,controls:r}=this.props;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:(0,L.jsxs)(L.Fragment,{children:[t,(0,L.jsx)("button",{className:"msp-btn-link msp-btn-icon msp-control-group-expander",onClick:this.toggleExpanded,title:(this.state.isExpanded?"Less":"More")+" options",style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,L.jsx)(Mi,{svg:this.state.isExpanded?GW:FA,style:{display:"inline-block"}})})]}),control:n,children:this.props.colorStripe&&(0,L.jsx)("div",{className:"msp-expandable-group-color-stripe",style:{backgroundColor:st.toStyle(this.props.colorStripe)}})}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:r})]})}}function Zy(e){return(0,L.jsxs)("div",{className:"msp-section-header"+(e.accent?" msp-transform-header-brand-"+e.accent:""),children:[e.icon&&(0,L.jsx)(Mi,{svg:e.icon}),e.title," ",(0,L.jsx)("small",{children:e.desc})]})}function ir(e){let n,t="msp-btn";return e.inline||(t+=" msp-btn-block"),e.noOverflow&&(t+=" msp-no-overflow"),e.flex&&(t+=" msp-flex-item"),("on"===e.commit||e.commit)&&(t+=" msp-btn-commit msp-btn-commit-on"),"off"===e.commit&&(t+=" msp-btn-commit msp-btn-commit-off"),e.children||(t+=" msp-btn-childless"),e.className&&(t+=" "+e.className),e.flex&&("number"==typeof e.flex?n={flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:"string"==typeof e.flex&&(n={flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex})),e.style&&(n?Object.assign(n,e.style):n=e.style),(0,L.jsxs)("button",{onClick:e.onClick,title:e.title,disabled:e.disabled,style:n,className:t,"data-id":e["data-id"],"data-color":e["data-color"],onContextMenu:e.onContextMenu,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,children:[e.icon&&(0,L.jsx)(Mi,{svg:e.icon}),e.children]})}function kn(e){let n,t=`msp-btn msp-btn-icon${e.small?"-small":""}${e.className?" "+e.className:""}`;return typeof e.toggleState<"u"&&(t+=" msp-btn-link-toggle-"+(e.toggleState?"on":"off")),e.transparent&&(t+=" msp-transparent-bg"),e.flex&&(n="boolean"==typeof e.flex?{flex:"0 0 32px",padding:0}:"number"==typeof e.flex?{flex:`0 0 ${e.flex}px`,padding:0,maxWidth:`${e.flex}px`}:{flex:`0 0 ${e.flex}`,padding:0,maxWidth:e.flex}),e.style&&(n?Object.assign(n,e.style):n=e.style),(0,L.jsxs)("button",{className:t,onClick:e.onClick,title:e.title,disabled:e.disabled,"data-id":e["data-id"],style:n,children:[e.svg&&(0,L.jsx)(Mi,{svg:e.svg}),e.extraContent]})}class yl extends Yt.PureComponent{constructor(){super(...arguments),this.onClick=t=>{t.currentTarget.blur(),this.props.toggle()}}render(){const t=this.props,n=t.label;return(0,L.jsx)(ir,{icon:this.props.icon,onClick:this.onClick,title:this.props.title,inline:this.props.inline,disabled:t.disabled,style:t.style,className:t.isSelected?`${t.className||""} msp-control-current`:t.className,children:n&&this.props.isSelected?(0,L.jsx)("b",{children:n}):n})}}class lm extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:"msp-control-group-header",style:{marginTop:void 0!==this.props.marginTop?this.props.marginTop:"1px",marginLeft:this.props.headerLeftMargin},children:(0,L.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,style:this.props.headerStyle,children:[(0,L.jsx)(Mi,{svg:this.state.isExpanded?Yy:Xy}),this.props.header]})}),this.state.isExpanded&&(this.props.noOffset?this.props.children:(0,L.jsx)("div",{className:this.props.accent?"msp-accent-offset":"msp-control-offset",children:this.props.children}))]})}}function Bd(e){let t="msp-control-row";return e.className&&(t+=" "+e.className),(0,L.jsxs)("div",{className:t,children:[(0,L.jsx)("span",{className:"msp-control-row-label",title:e.title,children:e.label}),(0,L.jsx)("div",{className:"msp-control-row-ctrl",children:e.control}),e.children]})}const cm=Yt.createContext(void 0);let Vr=(()=>{class e extends Yt.Component{subscribe(n,r){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(n.subscribe(r))}componentWillUnmount(){if(this.subs){for(const n of this.subs)n.unsubscribe();this.subs=void 0}}constructor(n,r){super(n),this.subs=void 0,this.plugin=r,this.init&&this.init()}}return e.contextType=cm,e})(),bl=(()=>{class e extends Yt.PureComponent{subscribe(n,r){typeof this.subs>"u"&&(this.subs=[]),this.subs.push(n.subscribe(r))}componentWillUnmount(){if(this.subs){for(const n of this.subs)n.unsubscribe();this.subs=void 0}}constructor(n,r){super(n,r),this.subs=void 0,this.plugin=r,this.init&&this.init()}}return e.contextType=cm,e})();class d2 extends Vr{componentDidUpdate(t){void 0!==this.props.initiallyCollapsed&&t.initiallyCollapsed!==this.props.initiallyCollapsed&&this.setState({isCollapsed:this.props.initiallyCollapsed})}render(){var t;return this.state.isHidden?null:(0,L.jsxs)("div",{className:this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper",children:[(0,L.jsx)("div",{className:"msp-transform-header",children:(0,L.jsxs)(ir,{icon:this.state.brand?void 0:this.state.isCollapsed?Xy:Yy,noOverflow:!0,onClick:this.toggleCollapsed,className:this.state.brand?`msp-transform-header-brand msp-transform-header-brand-${this.state.brand.accent}`:void 0,title:"Click to "+(this.state.isCollapsed?"expand":"collapse"),children:[(0,L.jsx)(Mi,{svg:null===(t=this.state.brand)||void 0===t?void 0:t.svg,inline:!0}),this.state.header,(0,L.jsx)("small",{style:{margin:"0 6px"},children:this.state.isCollapsed?"":this.state.description})]})}),!this.state.isCollapsed&&this.renderControls()]})}constructor(t,n){super(t,n),this.toggleCollapsed=()=>{this.setState({isCollapsed:!this.state.isCollapsed})};const r=this.defaultState();void 0!==t.initiallyCollapsed&&(r.isCollapsed=t.initiallyCollapsed),void 0!==t.header&&(r.header=t.header),this.state=r}}class Hn extends Yt.PureComponent{constructor(){super(...arguments),this.hide=()=>this.props.onSelect(void 0)}render(){const t=this.props,n=(0,L.jsx)(LP,{items:t.items,onSelect:t.onSelect,current:t.current,multiselect:this.props.multiselect,noOffset:this.props.noOffset,noAccent:this.props.noAccent});return(0,L.jsxs)("div",{className:"msp-action-menu-options"+(t.header?"":" msp-action-menu-options-no-header"),children:[t.header&&(0,L.jsx)(Fg,{header:t.header,title:t.title,initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.hide,topRightIcon:Rg,children:n}),!t.header&&n]})}}!function(e){function r(c,u){const{label:d,value:f,category:p,selected:m,icon:h,addOn:g,description:y}=u||{};let v;const x=[];for(let _=0;_<c.length;_++){const w=c[_];if(u?.filter&&!u.filter(w))continue;const A=p?.(w),M=d?d(w):""+w,E=f?f(w):w,D=y?y(w):"string"==typeof w?w:void 0;let T;A?(v||(v=new Map),T=v.get(A),T||(T=[e.Header(A,{description:A})],v.set(A,T),x.push(T))):T=x;const F=g?.(w);T.push({kind:"item",label:M,value:E,icon:h?h(w):void 0,selected:m?m(w):void 0,addOn:F,description:D})}return x}e.Header=function t(c,u){return u?{kind:"header",label:c,...u}:{kind:"header",label:c}},e.Item=function n(c,u,d){return{kind:"item",label:c,value:u,...d}},e.createItems=r;const i={value:c=>c[0],label:c=>c[1],category:c=>c[2]};e.createItemsFromSelectOptions=function o(c,u){return r(c,u?{...i,...u}:i)},e.hasSelectedItem=function s(c){if(Qy(c))return!1;if(BA(c))return!!c.selected;for(const u of c)if(s(u))return!0;return!1},e.findItem=function a(c,u){if(!Qy(c)){if(BA(c))return c.value===u?c:void 0;for(const d of c){const f=a(d,u);if(f)return f}}},e.getFirstItem=function l(c){if(!Qy(c)){if(BA(c))return c;for(const u of c){const d=l(u);if(d)return d}}}}(Hn||(Hn={}));class LP extends Yt.PureComponent{constructor(){super(...arguments),this.state=LP.createState(this.props),this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()},this.selectAll=()=>{const t=$W(this.props.items,[]).filter(n=>!n.selected);this.props.onSelect(t)},this.selectNone=()=>{const t=$W(this.props.items,[]).filter(n=>!!n.selected);this.props.onSelect(t)}}static createState(t,n){const r=WW(t.items)&&Qy(t.items[0])?t.items[0]:void 0,i=!r?.isIndependent&&(t.multiselect?Hn.hasSelectedItem(t.items):!!t.current&&!!Hn.findItem(t.items,t.current.value)||Hn.hasSelectedItem(t.items));return{header:r,hasCurrent:i,isExpanded:i||(n??!!r?.initiallyExpanded)}}componentDidUpdate(t){if(this.props.items!==t.items||this.props.current!==t.current){const n=WW(this.props.items)&&WW(t.items)&&Qy(this.props.items[0])&&Qy(t.items[0])&&this.props.items[0].label===t.items[0].label?this.state.isExpanded:void 0;this.setState(LP.createState(this.props,n))}}get multiselectHeader(){const{header:t,hasCurrent:n}=this.state;return(0,L.jsxs)("div",{className:"msp-flex-row msp-control-group-header",children:[(0,L.jsx)(ir,{icon:this.state.isExpanded?Yy:Xy,flex:!0,noOverflow:!0,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}.${t?.description?` ${t?.description}`:""}`,children:n?(0,L.jsx)("b",{children:t?.label}):t?.label}),(0,L.jsx)(ir,{icon:a2,flex:!0,onClick:this.selectAll,style:{flex:"0 0 50px",textAlign:"right"},children:"All"}),(0,L.jsx)(ir,{icon:Rg,flex:!0,onClick:this.selectNone,style:{flex:"0 0 50px",textAlign:"right"},children:"None"})]})}get basicHeader(){const{header:t,hasCurrent:n}=this.state;return(0,L.jsx)("div",{className:"msp-control-group-header",style:{marginTop:"1px"},children:(0,L.jsx)(ir,{noOverflow:!0,icon:this.state.isExpanded?Yy:Xy,onClick:this.toggleExpanded,title:`Click to ${this.state.isExpanded?"collapse":"expand"}. ${t?.description?t?.description:""}`,children:n?(0,L.jsx)("b",{children:t?.label}):t?.label})})}render(){const{items:t,onSelect:n,current:r}=this.props;if(Qy(t))return null;if(BA(t))return(0,L.jsx)(jbe,{item:t,onSelect:n,current:r,multiselect:this.props.multiselect});const{header:i}=this.state;return(0,L.jsxs)(L.Fragment,{children:[i&&(this.props.multiselect&&this.state.isExpanded?this.multiselectHeader:this.basicHeader),(0,L.jsx)("div",{className:this.props.noOffset?void 0:this.props.noAccent?"msp-control-offset":"msp-accent-offset",children:(!i||this.state.isExpanded)&&t.map((o,s)=>Qy(o)?null:BA(o)?(0,L.jsx)(jbe,{item:o,onSelect:n,current:r,multiselect:this.props.multiselect},s):(0,L.jsx)(LP,{items:o,onSelect:n,current:r,multiselect:this.props.multiselect,noAccent:!0},s))})]})}}const jbe=({item:e,onSelect:t,current:n,multiselect:r})=>(0,L.jsxs)(ir,{icon:e.icon,noOverflow:!0,className:"msp-action-menu-button",onClick:s=>t(r?[e]:e,s),disabled:e.disabled,style:e.addOn?{position:"relative"}:void 0,title:e.description,children:[n===e||e.selected?(0,L.jsx)("b",{children:e.label}):e.label,e.addOn]});function WW(e){return!!e&&Array.isArray(e)}function BA(e){return e&&"item"===e.kind}function Qy(e){return e&&"header"===e.kind}function $W(e,t){if(Qy(e))return t;if(BA(e))return t.push(e),t;for(const n of e)$W(n,t);return t}const YW=[["black",0],["gray",8421504],["white",16777215],["red",13840661],["orange",14840576],["yellow",16565248],["green",6863872],["cyan",1484197],["blue",40160],["purple",8086783],["magenta",16394495],["violet",8200583]];class Ube extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded||!!this.props.hideNameRow,lightness:0},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()},this.onClickSwatch=t=>{const n=st.fromHexString(t.currentTarget.getAttribute("data-color")||"0");n!==this.props.value&&(this.props.param.isExpanded||this.setState({isExpanded:!1}),this.update(n))},this.onR=t=>{const[,n,r]=st.toRgb(this.props.value),i=st.fromRgb(t,n,r);i!==this.props.value&&this.update(i)},this.onG=t=>{const[n,,r]=st.toRgb(this.props.value),i=st.fromRgb(n,t,r);i!==this.props.value&&this.update(i)},this.onB=t=>{const[n,r]=st.toRgb(this.props.value),i=st.fromRgb(n,r,t);i!==this.props.value&&this.update(i)},this.onRGB=t=>{const n=st.fromHexStyle(t.currentTarget.value||"0");n!==this.props.value&&this.update(n)},this.onLighten=()=>{this.update(st.lighten(this.props.value,.1))},this.onDarken=()=>{this.update(st.darken(this.props.value,.1))}}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}swatch(){return(0,L.jsx)("div",{className:"msp-combined-color-swatch",children:YW.map(t=>(0,L.jsx)(ir,{inline:!0,"data-color":t[1],onClick:this.onClickSwatch,style:{background:st.toStyle(t[1])}},t[1]))})}render(){const t=this.props.param.label||Rc(this.props.name),[n,r,i]=st.toRgb(this.props.value),o=(0,L.jsxs)(L.Fragment,{children:[this.swatch(),(0,L.jsx)(Bd,{label:"RGB",className:"msp-control-label-short",control:(0,L.jsxs)("div",{style:{display:"flex",textAlignLast:"center",left:"80px"},children:[(0,L.jsx)(Ky,{onChange:this.onR,numeric:!0,value:n,delayMs:250,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,L.jsx)(Ky,{onChange:this.onG,numeric:!0,value:r,delayMs:250,style:{order:2,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,L.jsx)(Ky,{onChange:this.onB,numeric:!0,value:i,delayMs:250,style:{order:3,flex:"1 1 auto",minWidth:0},className:"msp-form-control",onEnter:this.props.onEnter,blurOnEnter:!0,blurOnEscape:!0}),(0,L.jsx)("input",{onInput:this.onRGB,type:"color",value:st.toHexStyle(this.props.value),style:{order:4,flex:"1 1 auto",minWidth:"32px",width:"32px",height:"32px",padding:"0 2px 0 2px",background:"none",border:"none",cursor:"pointer"}})]})}),(0,L.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,L.jsx)(ir,{onClick:this.onLighten,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Lighten"}),(0,L.jsx)(ir,{onClick:this.onDarken,style:{order:1,flex:"1 1 auto",minWidth:0},className:"msp-form-control",children:"Darken"})]})]});return this.props.hideNameRow?o:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{title:this.props.param.description,label:t,control:(0,L.jsx)(ir,{onClick:this.toggleExpanded,inline:!0,className:"msp-combined-color-button",style:{background:st.toStyle(this.props.value)}})}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:o})]})}}!function(){const e=new Map;for(const t of YW)e.set(t[1],t[0])}();class kbt extends Yt.PureComponent{render(){const{legend:t}=this.props,n=t.colors.map(r=>Array.isArray(r)?`${st.toStyle(r[0])} ${100*r[1]}%`:st.toStyle(r)).join(", ");return(0,L.jsx)("div",{className:"msp-scale-legend",children:(0,L.jsxs)("div",{style:{background:`linear-gradient(to right, ${n})`},children:[(0,L.jsx)("span",{style:{float:"left"},children:t.minLabel}),(0,L.jsx)("span",{style:{float:"right"},children:t.maxLabel})]})})}}class Mbt extends Yt.PureComponent{render(){const{legend:t}=this.props;return(0,L.jsx)("div",{className:"msp-table-legend",children:t.table.map((n,r)=>{const[i,o]=n;return(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"msp-table-legend-color",style:{backgroundColor:st.toStyle(o)}}),(0,L.jsx)("div",{className:"msp-table-legend-text",children:i})]},r)})})}}class Rbt extends Yt.Component{constructor(t){super(t),this.state={show:!1},this.handleHover=this.handleHover.bind(this),this.handleHoverOff=this.handleHoverOff.bind(this),this.deletePoint=this.deletePoint.bind(this)}handleHover(){this.setState({show:!0});const t=Ue.create(this.props.nX,this.props.nY);this.props.onmouseover(t)}handleHoverOff(){this.setState({show:!1}),this.props.onmouseover(void 0)}deletePoint(){this.props.delete(this.props.id)}render(){return[(0,L.jsx)("circle",{r:"10",id:`${this.props.id}`,cx:this.props.x,cy:this.props.y,onClick:this.props.onclick,onDoubleClick:this.props.delete(this.props.id),onMouseEnter:this.handleHover,onMouseLeave:this.handleHoverOff,onMouseDown:this.props.onmousedown,fill:"black"},`${this.props.id}circle`)]}}class Nbt extends Yt.Component{constructor(t){super(t),this.handleKeyDown=n=>{},this.handleKeyUp=n=>{},this.handleClick=n=>r=>{},this.handleMouseDown=n=>r=>{if(0===n||n===this.state.points.length-1||this.state.canSelectMultiple)return;const i=this.normalizePoint(Ue.create(this.state.points[n][0],this.state.points[n][1]));this.ghostPoints.push(document.createElementNS(this.namespace,"circle")),this.ghostPoints[0].setAttribute("r","10"),this.ghostPoints[0].setAttribute("fill","orange"),this.ghostPoints[0].setAttribute("cx",`${i[0]}`),this.ghostPoints[0].setAttribute("cy",`${i[1]}`),this.ghostPoints[0].setAttribute("style","display: none"),this.gElement.appendChild(this.ghostPoints[0]),this.updatedX=i[0],this.updatedY=i[1],this.selected=[n]},this.deletePoint=n=>r=>{if(0===n||n===this.state.points.length-1)return;const i=this.state.points.filter((o,s)=>s!==n);i.sort((o,s)=>o[0]===s[0]?0===o[0]?o[1]-s[1]:1===o[1]?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]),this.setState({points:i}),this.change(i),r.stopPropagation()},this.myRef=Yt.createRef(),this.state={points:[Ue.create(0,0),Ue.create(1,0)],copyPoint:void 0,canSelectMultiple:!1},this.height=400,this.width=600,this.padding=70,this.selected=void 0,this.ghostPoints=[],this.namespace="http://www.w3.org/2000/svg";for(const n of this.props.data)this.state.points.push(n);this.state.points.sort((n,r)=>n[0]===r[0]?0===n[0]?n[1]-r[1]:1===n[1]?r[1]-n[1]:n[1]-r[1]:n[0]-r[0]),this.handleDrag=this.handleDrag.bind(this),this.handleMultipleDrag=this.handleMultipleDrag.bind(this),this.handleDoubleClick=this.handleDoubleClick.bind(this),this.refCallBack=this.refCallBack.bind(this),this.handlePointUpdate=this.handlePointUpdate.bind(this),this.change=this.change.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleEnter=this.handleEnter.bind(this)}render(){const t=this.renderPoints(),n=this.renderLines(),r=this.renderHistogram();return[(0,L.jsx)("div",{children:(0,L.jsxs)("svg",{className:"msp-canvas",ref:this.refCallBack,viewBox:`0 0 ${this.width+this.padding} ${this.height+this.padding}`,onMouseMove:this.handleDrag,onMouseUp:this.handlePointUpdate,onMouseLeave:this.handleLeave,onMouseEnter:this.handleEnter,tabIndex:0,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onDoubleClick:this.handleDoubleClick,children:[(0,L.jsxs)("g",{stroke:"black",fill:"black",children:[r,n,t]}),(0,L.jsx)("g",{className:"ghost-points",stroke:"black",fill:"black"})]})},"LineGraph"),(0,L.jsx)("div",{id:"modal-root"},"modal")]}componentDidMount(){this.gElement=document.getElementsByClassName("ghost-points")[0]}change(t){const n=t.slice();n.shift(),n.pop(),this.props.onChange(n)}handleDrag(t){if(void 0===this.selected)return;const n=this.myRef.createSVGPoint();let r;const i=this.padding/2;n.x=t.clientX,n.y=t.clientY;const o=n.matrixTransform(this.myRef.getScreenCTM().inverse());r=Ue.create(o.x,o.y),r=(o.x<i||o.x>this.width+i)&&(o.y>this.height+i||o.y<i)?Ue.create(this.updatedX,this.updatedY):o.x<i?Ue.create(i,o.y):o.x>this.width+i?Ue.create(this.width+i,o.y):Ue.create(o.x,o.y>this.height+i?this.height+i:o.y<i?i:o.y),this.updatedX=r[0],this.updatedY=r[1];const s=this.unNormalizePoint(r);this.ghostPoints[0].setAttribute("style","display: visible"),this.ghostPoints[0].setAttribute("cx",`${r[0]}`),this.ghostPoints[0].setAttribute("cy",`${r[1]}`),this.props.onDrag(s)}handleMultipleDrag(){}handlePointUpdate(t){const n=this.selected;if(this.state.canSelectMultiple)return;if(void 0===n||0===n[0]||n[0]===this.state.points.length-1)return void this.setState({copyPoint:void 0});this.selected=void 0;const r=this.unNormalizePoint(Ue.create(this.updatedX,this.updatedY)),i=this.state.points.filter((o,s)=>s!==n[0]);i.push(r),i.sort((o,s)=>o[0]===s[0]?0===o[0]?o[1]-s[1]:1===o[1]?s[1]-o[1]:o[1]-s[1]:o[0]-s[0]),this.setState({points:i}),this.change(i),this.gElement.innerHTML="",this.ghostPoints=[],document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}handleDoubleClick(t){const n=this.myRef.createSVGPoint();n.x=t.clientX,n.y=t.clientY;const r=n.matrixTransform(this.myRef.getScreenCTM().inverse()),i=this.state.points,o=this.padding/2;if(r.x<o||r.x>this.width+o||r.y>this.height+o||r.y<this.padding/2)return;const s=this.unNormalizePoint(Ue.create(r.x,r.y));i.push(s),i.sort((a,l)=>a[0]===l[0]?0===a[0]?a[1]-l[1]:1===a[1]?l[1]-a[1]:a[1]-l[1]:a[0]-l[0]),this.setState({points:i}),this.change(i)}handleLeave(){void 0!==this.selected&&(document.addEventListener("mousemove",this.handleDrag,!0),document.addEventListener("mouseup",this.handlePointUpdate,!0))}handleEnter(){document.removeEventListener("mousemove",this.handleDrag,!0),document.removeEventListener("mouseup",this.handlePointUpdate,!0)}normalizePoint(t){const n=this.padding/2;return Ue.create(t[0]*(this.width+n-n)+n,this.height+this.padding-(t[1]*(this.height+n-n)+n))}unNormalizePoint(t){const n=this.padding/2;return Ue.create((t[0]-n)/(this.width+n-n),(this.height+this.padding-t[1]-n)/(this.height+n-n))}refCallBack(t){t&&(this.myRef=t)}renderHistogram(){if(!this.props.volume)return null;const t=Ca.getHistogram(this.props.volume.grid,40),n=[],r=t.counts.length,i=this.width/r,o=this.padding/2,s=Bh(t.counts)||1;for(let a=0;a<r;a++){const l=this.width*a/(r-1)+o;n.push((0,L.jsx)("line",{x1:l,x2:l,y1:this.height+o,y2:this.height*(1-t.counts[a]/s)+o,stroke:"#ded9ca",strokeWidth:i},`histogram${a}`))}return n}renderPoints(){const t=[];let n;for(let r=0;r<this.state.points.length;r++)0!==r&&r!==this.state.points.length-1&&(n=this.normalizePoint(this.state.points[r]),t.push((0,L.jsx)(Rbt,{id:r,x:n[0],y:n[1],nX:this.state.points[r][0],nY:this.state.points[r][1],selected:!1,delete:this.deletePoint,onmouseover:this.props.onHover,onmousedown:this.handleMouseDown(r),onclick:this.handleClick(r)},r)));return t}renderLines(){const t=[],n=[];let r,i,o,s,a;const l=this.padding/2;for(const d of this.state.points)r=this.width+l,i=this.height+this.padding,o=d[0]*(r-l)+l,s=d[1]*(i-l)+l,a=this.height+this.padding-s,t.push(Ue.create(o,a));const c=t,u=c.length;for(let d=0;d<u-1;d++)n.push((0,L.jsx)("line",{x1:c[d][0],x2:c[d+1][0],y1:c[d][1],y2:c[d+1][1],stroke:"#cec9ba",strokeWidth:"5"},`lineOf${d}`));return n}}class zbe extends Yt.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:0},this.begin=()=>{this.setState({isChanging:!0})},this.end=t=>{this.setState({isChanging:!1}),this.props.onChange(t)},this.updateCurrent=t=>{var n,r;this.setState({current:t}),null===(r=(n=this.props).onChangeImmediate)||void 0===r||r.call(n,t)},this.updateManually=t=>{this.setState({isChanging:!0});let n=t;1===this.props.step&&(n=Math.round(n)),n<this.props.min&&(n=this.props.min),n>this.props.max&&(n=this.props.max),this.setState({current:n,isChanging:!0})},this.onManualBlur=()=>{this.setState({isChanging:!1}),this.props.onChange(this.state.current)}}static getDerivedStateFromProps(t,n){return n.isChanging||t.value===n.current?null:{current:t.value}}render(){let t=this.props.step;return void 0===t&&(t=1),(0,L.jsxs)("div",{className:"msp-slider",children:[(0,L.jsx)("div",{children:(0,L.jsx)(ZW,{min:this.props.min,max:this.props.max,step:t,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end})}),(0,L.jsx)("div",{children:(0,L.jsx)(Ky,{numeric:!0,delayMs:50,value:this.state.current,blurOnEnter:!0,onBlur:this.onManualBlur,isDisabled:this.props.disabled,onChange:this.updateManually})})]})}}class Fbt extends Yt.Component{constructor(){super(...arguments),this.state={isChanging:!1,current:[0,1]},this.begin=()=>{this.setState({isChanging:!0})},this.end=t=>{this.setState({isChanging:!1}),this.props.onChange(t)},this.updateCurrent=t=>{this.setState({current:t})},this.updateMax=t=>{let n=t;1===this.props.step&&(n=Math.round(n)),n<this.state.current[0]?n=this.state.current[0]:n<this.props.min&&(n=this.props.min),n>this.props.max&&(n=this.props.max),this.props.onChange([this.state.current[0],n])},this.updateMin=t=>{let n=t;1===this.props.step&&(n=Math.round(n)),n<this.props.min&&(n=this.props.min),n>this.state.current[1]?n=this.state.current[1]:n>this.props.max&&(n=this.props.max),this.props.onChange([n,this.state.current[1]])}}static getDerivedStateFromProps(t,n){return n.isChanging||t.value[0]===n.current[0]&&t.value[1]===n.current[1]?null:{current:t.value}}render(){let t=this.props.step;return void 0===t&&(t=1),(0,L.jsxs)("div",{className:"msp-slider2",children:[(0,L.jsx)("div",{children:(0,L.jsx)(Ky,{numeric:!0,delayMs:50,value:this.state.current[0],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMin})}),(0,L.jsx)("div",{children:(0,L.jsx)(ZW,{min:this.props.min,max:this.props.max,step:t,value:this.state.current,disabled:this.props.disabled,onBeforeChange:this.begin,onChange:this.updateCurrent,onAfterChange:this.end,range:!0,allowCross:!0})}),(0,L.jsx)("div",{children:(0,L.jsx)(Ky,{numeric:!0,delayMs:50,value:this.state.current[1],onEnter:this.props.onEnter,blurOnEnter:!0,isDisabled:this.props.disabled,onChange:this.updateMax})})]})}}function XW(e){const t=[],n={}.hasOwnProperty;for(let r=0;r<arguments.length;r++){const i=arguments[r];if(!i)continue;const o=typeof i;if("string"===o||"number"===o)t.push(i);else if(Array.isArray(i))t.push(XW.apply(null,i));else if("object"===o)for(const s in i)n.call(i,s)&&i[s]&&t.push(s)}return t.join(" ")}function Vbe(e){return e.touches.length>1||"touchend"===e.type.toLowerCase()&&e.touches.length>0}function Hbe(e,t){return e?t.touches[0].clientY:t.touches[0].pageX}function Gbe(e,t){return e?t.clientY:t.pageX}function qbe(e,t){const n=t.getBoundingClientRect();return e?n.top+.5*n.height:n.left+.5*n.width}function KW(e){e.stopPropagation(),e.preventDefault()}class ZW extends Yt.Component{constructor(t){super(t),this.sliderElement=Yt.createRef(),this.handleElements=[],this.dragOffset=0,this.startPosition=0,this.startValue=0,this._getPointsCache=void 0,this.onMouseDown=u=>{if(0!==u.button)return;let d=Gbe(this.props.vertical,u);if(this.isEventFromHandle(u)){const f=qbe(this.props.vertical,u.target);this.dragOffset=d-f,d=f}else this.dragOffset=0;this.onStart(d),this.addDocumentEvents("mouse"),KW(u)},this.onTouchMove=u=>{if(Vbe(u))return void this.end("touch");const d=Hbe(this.props.vertical,u);this.onMove(u,d-this.dragOffset)},this.onTouchStart=u=>{if(Vbe(u))return;let d=Hbe(this.props.vertical,u);if(this.isEventFromHandle(u)){const f=qbe(this.props.vertical,u.target);this.dragOffset=d-f,d=f}else this.dragOffset=0;this.onStart(d),this.addDocumentEvents("touch"),KW(u)},this.eventHandlers={touchmove:u=>this.onTouchMove(u),touchend:u=>this.end("touch"),mousemove:u=>this.onMouseMove(u),mouseup:u=>this.end("mouse")},this.calcOffset=u=>{const{min:d,max:f}=this.props;return(u-d)/(f-d)*100};const{range:n,min:r,max:i}=t,o=n?Array.apply(null,Array(+n+1)).map(()=>r):r,a=void 0!==t.value?t.value:"defaultValue"in t?t.defaultValue:o,l=(n?a:[r,a]).map(u=>this.trimAlignValue(u));let c;c=n&&l[0]===l[l.length-1]&&l[0]===i?0:l.length-1,this.state={handle:null,recent:c,bounds:l}}componentDidUpdate(t){if(!("value"in this.props||"min"in this.props||"max"in this.props))return;const{bounds:n}=this.state;if(t.range){const i=(this.props.value||n).map(o=>this.trimAlignValue(o,this.props));if(i.every((o,s)=>o===n[s]))return;this.setState({bounds:i}),n.some(o=>this.isValueOutOfBounds(o,this.props))&&this.props.onChange(i)}else{const i=this.trimAlignValue(void 0!==this.props.value?this.props.value:n[1],this.props);if(i===n[1]&&n[0]===t.min)return;this.setState({bounds:[t.min,i]}),this.isValueOutOfBounds(n[1],this.props)&&this.props.onChange(i)}}onChange(t){const n=this.props;"value"in n?void 0!==t.handle&&this.setState({handle:t.handle}):this.setState(t);const i={...this.state,...t};n.onChange(n.range?i.bounds:i.bounds[1])}onMouseMove(t){const n=Gbe(this.props.vertical,t);this.onMove(t,n-this.dragOffset)}onMove(t,n){KW(t);const r=this.props,i=this.state;let o=n-this.startPosition;o=this.props.vertical?-o:o;const s=o/this.getSliderLength()*(r.max-r.min),a=this.trimAlignValue(this.startValue+s);if(a===i.bounds[i.handle])return;const c=[...i.bounds];c[i.handle]=a;let u=i.handle;r.pushable?this.pushSurroundingHandles(c,u,i.bounds[u]):r.allowCross&&(c.sort((d,f)=>d-f),u=c.indexOf(a)),this.onChange({handle:u,bounds:c})}onStart(t){this.props.onBeforeChange(this.getValue());const r=this.calcValueByPos(t);this.startValue=r,this.startPosition=t;const i=this.state,{bounds:o}=i;let s=1;if(this.props.range){let c=0;for(let d=1;d<o.length-1;++d)r>o[d]&&(c=d);Math.abs(o[c+1]-r)<Math.abs(o[c]-r)&&(c+=1),s=c;const u=o[c+1]===o[c];u&&(s=i.recent),u&&r!==o[c+1]&&(s=r<o[c+1]?c:c+1)}if(this.setState({handle:s,recent:s}),r===i.bounds[s])return;const l=[...i.bounds];l[s]=r,this.onChange({bounds:l})}getPoints(){const{marks:t,step:n,min:r,max:i}=this.props,o=this._getPointsCache;if(!o||o.marks!==t||o.step!==n){const s={...t};if(null!==n)for(let l=r;l<=i;l+=n)s[l]=l;const a=Object.keys(s).map(parseFloat);a.sort((l,c)=>l-c),this._getPointsCache={marks:t,step:n,points:a}}return this._getPointsCache.points}getPrecision(t){const n=t.toString();let r=0;return n.indexOf(".")>=0&&(r=n.length-n.indexOf(".")-1),r}getSliderLength(){const t=this.sliderElement.current;return t?this.props.vertical?t.clientHeight:t.clientWidth:0}getSliderStart(){const n=this.sliderElement.current.getBoundingClientRect();return this.props.vertical?n.top:n.left}getValue(){const{bounds:t}=this.state;return this.props.range?t:t[1]}addDocumentEvents(t){"touch"===t?(document.addEventListener("touchmove",this.eventHandlers.touchmove),document.addEventListener("touchend",this.eventHandlers.touchend)):"mouse"===t&&(document.addEventListener("mousemove",this.eventHandlers.mousemove),document.addEventListener("mouseup",this.eventHandlers.mouseup))}calcValue(t){const{vertical:n,min:r,max:i}=this.props,o=Math.abs(t/this.getSliderLength());return n?(1-o)*(i-r)+r:o*(i-r)+r}calcValueByPos(t){const n=t-this.getSliderStart();return this.trimAlignValue(this.calcValue(n))}end(t){this.removeEvents(t),this.props.onAfterChange(this.getValue()),this.setState({handle:null})}isEventFromHandle(t){for(const n of this.handleElements)if(n.current===t.target)return!0;return!1}isValueOutOfBounds(t,n){return t<n.min||t>n.max}pushHandle(t,n,r,i){const o=t[n];let s=t[n];for(;r*(s-o)<i;){if(!this.pushHandleOnePoint(t,n,r))return t[n]=o,!1;s=t[n]}return!0}pushHandleOnePoint(t,n,r){const i=this.getPoints(),s=i.indexOf(t[n])+r;if(s>=i.length||s<0)return!1;const a=n+r,l=i[s],{pushable:c}=this.props;return!!this.pushHandle(t,a,r,+c-r*(t[a]-l))&&(t[n]=l,!0)}pushSurroundingHandles(t,n,r){const{pushable:i}=this.props,o=t[n];let s=0;if(t[n+1]-o<+i?s=1:o-t[n-1]<+i&&(s=-1),0===s)return;const a=n+s;this.pushHandle(t,a,s,+i-s*(t[a]-o))||(t[n]=r)}removeEvents(t){"touch"===t?(document.removeEventListener("touchmove",this.eventHandlers.touchmove),document.removeEventListener("touchend",this.eventHandlers.touchend)):"mouse"===t&&(document.removeEventListener("mousemove",this.eventHandlers.mousemove),document.removeEventListener("mouseup",this.eventHandlers.mouseup))}trimAlignValue(t,n){const{handle:r,bounds:i}=this.state||{},{marks:o,step:s,min:a,max:l,allowCross:c}={...this.props,...n||{}};let u=t;u<=a&&(u=a),u>=l&&(u=l),!c&&null!=r&&r>0&&u<=i[r-1]&&(u=i[r-1]),!c&&null!=r&&r<i.length-1&&u>=i[r+1]&&(u=i[r+1]);const d=Object.keys(o).map(parseFloat);if(null!==s){const m=Math.round((u-a)/s)*s+a;d.push(m)}const f=d.map(m=>Math.abs(u-m)),p=d[f.indexOf(Math.min.apply(Math,f))];return null!==s?parseFloat(p.toFixed(this.getPrecision(s))):p}render(){const{handle:t,bounds:n}=this.state,{className:r,prefixCls:i,disabled:o,vertical:s,range:a,step:l,marks:c,tipFormatter:u}=this.props,d=this.props.handle,f=n.map(this.calcOffset),p=`${i}-handle`,m=n.map((x,_)=>XW({[p]:!0,[`${p}-${_+1}`]:!0,[`${p}-lower`]:0===_,[`${p}-upper`]:_===n.length-1})),g={prefixCls:i,noTip:null===l||null===u,tipFormatter:u,vertical:s};if(this.handleElements.length!==n.length){this.handleElements=[];for(let x=0;x<n.length;x++)this.handleElements.push(Yt.createRef())}const y=n.map((x,_)=>Yt.cloneElement(d,{...g,className:m[_],value:x,offset:f[_],dragging:t===_,index:_,key:_,ref:this.handleElements[_]}));a||y.shift();const v=XW({[i]:!0,[`${i}-with-marks`]:Object.keys(c).length,[`${i}-disabled`]:o,[`${i}-vertical`]:this.props.vertical,[r]:!!r});return(0,L.jsxs)("div",{ref:this.sliderElement,className:v,onTouchStart:o?rp:this.onTouchStart,onMouseDown:o?rp:this.onMouseDown,children:[(0,L.jsx)("div",{className:`${i}-rail`}),y]})}}ZW.defaultProps={prefixCls:"msp-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:(0,L.jsx)(class Obt extends Yt.Component{render(){const{className:t,tipFormatter:n,vertical:r,offset:i,value:o,index:s}=this.props;return(0,L.jsx)("div",{className:t,style:r?{bottom:`${i}%`}:{left:`${i}%`},title:n(o,s)})}},{className:"",vertical:!1,offset:0,tipFormatter:e=>e,value:0,index:0}),onBeforeChange:rp,onChange:rp,onAfterChange:rp,tipFormatter:(e,t)=>e,disabled:!1,range:!1,vertical:!1,allowCross:!0,pushable:!1};class vs extends Yt.PureComponent{constructor(){super(...arguments),this.onChange=t=>{var n,r;if(null===(r=(n=this.props).onChange)||void 0===r||r.call(n,t,this.props.values),this.props.onChangeValues){const i={...this.props.values,[t.name]:t.value};this.props.onChangeValues(i,this.props.values)}},this.paramGroups=sy(t=>function Lbt(e){function t(s,a,l){const c=jP(a);if(c)if(a.category){l.map||(l.map=new Map);let u=l.map.get(a.category);u||(u=[],l.map.set(a.category,u),l.params.push(u)),u.push([s,a,c])}else l.params[0].push([s,a,c])}function n(s,a){const l=s[0],c=a[0];return l&&l[1].category?c&&c[1].category&&l[1].category<c[1].category?-1:1:-1}const r=Object.keys(e),i={params:[[]],map:void 0},o={params:[[]],map:void 0};for(const s of r){const a=e[s];a.isHidden||t(s,a,a.isEssential?i:o)}return i.params.sort(n),o.params.sort(n),{essentials:i.params,advanced:o.params}}(t))}renderGroup(t){var n;if(0===t.length)return null;const r=this.props.values;let o,i=null;for(const[s,a,l]of t)null!==(n=a.hideIf)&&void 0!==n&&n.call(a,r)||(i||(i=[]),o=a.category,i.push((0,L.jsx)(l,{param:a,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled,name:s,value:r[s]},s)));return i?o?[(0,L.jsx)(lm,{header:o,children:i},o)]:i:null}renderPart(t){let n=null;for(const r of t){const i=this.renderGroup(r);if(i){n||(n=[]);for(const o of i)n.push(o)}}return n}render(){const t=this.paramGroups(this.props.params),n=this.renderPart(t.essentials),r=this.renderPart(t.advanced);return n&&r?(0,L.jsxs)(L.Fragment,{children:[n,(0,L.jsx)(lm,{header:"Advanced Options",children:r})]}):n||r}}class Bbt extends Vr{constructor(){super(...arguments),this.state={isDisabled:!1},this.setSettings=(t,n)=>{const r={...n,[t.name]:t.value},i=this.props.mapping.update(r,this.plugin);this.props.mapping.apply(i,this.plugin)}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,t=>{this.setState({isDisabled:t})})}render(){const t=this.props.mapping.getTarget(this.plugin),n=this.props.mapping.getValues(t,this.plugin),r=this.props.mapping.params(this.plugin);return(0,L.jsx)(vs,{params:r,values:n,onChange:this.setSettings,isDisabled:this.state.isDisabled})}}function jP(e){switch(e.type){case"value":case"data-ref":return;case"boolean":return QW;case"number":return typeof e.min<"u"&&typeof e.max<"u"?zbt:Ubt;case"converted":return a1t;case"conditioned":return s1t;case"multi-select":return r1t;case"color":return Ube;case"color-list":return e.offsets?Zbt:Kbt;case"vec3":return Qbt;case"mat4":return Jbt;case"url":return e1t;case"file":return t1t;case"file-list":return n1t;case"select":return mO;case"value-ref":return Hbt;case"text":return Ybe;case"interval":return typeof e.min<"u"&&typeof e.max<"u"?qbt:Gbt;case"group":return Kbe;case"mapped":return i1t;case"line-graph":return jbt;case"script":return l1t;case"object-list":return e$;default:return void console.warn(`${e} has no associated UI component`)}}class Wbe extends Yt.PureComponent{render(){const{legend:t,description:n}=this.props,r=t&&function Pbt(e){switch(e.kind){case"scale-legend":return kbt;case"table-legend":return Mbt;default:return void console.warn(`${e} has no associated UI component`)}}(t);return(0,L.jsx)("div",{className:"msp-help-text",children:(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{className:"msp-help-description",children:[(0,L.jsx)(Mi,{svg:Ng,inline:!0}),n]}),r&&(0,L.jsx)("div",{className:"msp-help-legend",children:(0,L.jsx)(r,{legend:t})})]})})}}function f2(e){const{props:t,state:n,control:r,toggleHelp:i,addOn:o}=e,s=[];t.param.shortLabel&&s.push("msp-control-label-short"),t.param.twoColumns&&s.push("msp-control-col-2"),t.param.multiline&&s.push("msp-control-twoline");const a=s.join(" "),l=t.param.label||Rc(t.name),c=t.param.help?t.param.help(t.value):{description:t.param.description,legend:t.param.legend},u=c.description||c.legend,d=l+(u?". Click for help.":"");return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{className:a,title:d,label:(0,L.jsxs)(L.Fragment,{children:[l,u&&(0,L.jsx)($be,{show:n.showHelp,toggle:i,title:d})]}),control:r}),u&&n.showHelp&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(Wbe,{legend:c.legend,description:c.description})}),o]})}function $be({show:e,toggle:t,title:n}){return(0,L.jsx)("button",{className:"msp-help msp-btn-link msp-btn-icon msp-control-group-expander",onClick:t,title:n||(e?"Hide":"Show")+" help",style:{background:"transparent",textAlign:"left",padding:"0"},children:(0,L.jsx)(Mi,{svg:Ng})})}class LA extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}renderAddOn(){return null}render(){return f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}class QW extends LA{constructor(){super(...arguments),this.onClick=t=>{this.update(!this.props.value),t.currentTarget.blur()}}renderControl(){return(0,L.jsxs)("button",{onClick:this.onClick,disabled:this.props.isDisabled,children:[(0,L.jsx)(Mi,{svg:this.props.value?a2:Dbe}),this.props.value?"On":"Off"]})}}class jbt extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1,isOverPoint:!1,message:`${this.props.param.defaultValue.length} points`},this.onHover=t=>{this.setState({isOverPoint:!this.state.isOverPoint}),this.setState(t?{message:this.pointToLabel(t)}:{message:`${this.props.value.length} points`})},this.onDrag=t=>{this.setState({message:this.pointToLabel(t)})},this.onChange=t=>{this.props.onChange({name:this.props.name,param:this.props.param,value:t})},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}pointToLabel(t){var n,r;if(!t)return"";const i=null===(r=(n=this.props.param).getVolume)||void 0===r?void 0:r.call(n);if(i){const{min:o,max:s,mean:a,sigma:l}=i.grid.stats,c=o+(s-o)*t[0],u=(c-a)/l;return`(${c.toFixed(2)} | ${u.toFixed(2)}\u03c3, ${t[1].toFixed(2)})`}return`(${t[0].toFixed(2)}, ${t[1].toFixed(2)})`}render(){var t,n;const r=this.props.param.label||Rc(this.props.name);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:r,control:(0,L.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${this.state.message}`})}),(0,L.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none",marginTop:1},children:(0,L.jsx)(Nbt,{data:this.props.value,volume:null===(n=(t=this.props.param).getVolume)||void 0===n?void 0:n.call(t),onChange:this.onChange,onHover:this.onHover,onDrag:this.onDrag})})]})}}class Ubt extends Yt.PureComponent{constructor(){super(...arguments),this.state={value:"0"},this.update=t=>{const n=n5(this.props.param.step||.01);t=parseFloat(t.toFixed(n)),this.props.onChange({param:this.props.param,name:this.props.name,value:t})}}render(){const t=this.props.param.label||Rc(this.props.name),n=this.props.param.label||Rc(this.props.name),r=n5(this.props.param.step||.01);return(0,L.jsx)(Bd,{title:this.props.param.description,label:n,control:(0,L.jsx)(Ky,{numeric:!0,value:parseFloat(this.props.value.toFixed(r)),onEnter:this.props.onEnter,placeholder:t,isDisabled:this.props.isDisabled,onChange:this.update})})}}class zbt extends LA{constructor(){super(...arguments),this.onChange=t=>{this.update(t)}}renderControl(){return(0,L.jsx)(zbe,{value:typeof this.props.value>"u"?this.props.param.defaultValue:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,onChangeImmediate:this.props.param.immediateUpdate?this.onChange:void 0,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}}class Ybe extends LA{constructor(){super(...arguments),this.updateValue=t=>{t!==this.props.value&&this.update(t)}}renderControl(){const t=this.props.param.placeholder||this.props.param.label||Rc(this.props.name);return(0,L.jsx)(Vbt,{props:this.props,placeholder:t,update:this.updateValue})}}function Vbt({props:e,placeholder:t,update:n}){const[r,i]=Yt.useState(e.value);return Yt.useEffect(()=>i(e.value),[e.value]),e.param.multiline?(0,L.jsx)("div",{className:"msp-control-text-area-wrapper",children:(0,L.jsx)("textarea",{value:e.param.disableInteractiveUpdates?r||"":e.value,placeholder:t,onChange:o=>{e.param.disableInteractiveUpdates?i(o.target.value):n(o.target.value)},onBlur:o=>{e.param.disableInteractiveUpdates&&n(o.target.value)},onKeyDown:o=>{"Enter"===o.key&&(o.shiftKey||o.ctrlKey||o.metaKey)&&o.currentTarget.blur()},disabled:e.isDisabled})}):(0,L.jsx)("input",{type:"text",value:e.param.disableInteractiveUpdates?r||"":e.value,placeholder:t,onChange:o=>{e.param.disableInteractiveUpdates?i(o.target.value):n(o.target.value)},onBlur:o=>{e.param.disableInteractiveUpdates&&n(o.target.value)},disabled:e.isDisabled,onKeyDown:o=>{"Enter"===o.key&&(e.onEnter?(o.stopPropagation(),e.onEnter()):"Enter"===o.key&&(o.shiftKey||o.ctrlKey||o.metaKey)?o.currentTarget.blur():e.param.disableInteractiveUpdates&&n(r))}})}class jA extends Yt.PureComponent{constructor(){super(...arguments),this.onChange=t=>{this.update("number"==typeof this.props.param.defaultValue?parseInt(t.target.value,10):t.target.value)}}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}render(){const t=void 0!==this.props.value&&!this.props.param.options.some(n=>n[0]===this.props.value);return(0,L.jsxs)("select",{className:"msp-form-control",title:this.props.title,value:void 0!==this.props.value?this.props.value:this.props.param.defaultValue,onChange:this.onChange,disabled:this.props.isDisabled,children:[t&&(0,L.jsx)("option",{value:this.props.value,children:`[Invalid] ${this.props.value}`},this.props.value),this.props.param.options.map(([n,r])=>(0,L.jsx)("option",{value:n,children:r},n))]})}}class mO extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=t=>{t&&t.value!==this.props.value?this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:t.value})}):this.setState({showOptions:!1})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.cycle=()=>{const{options:t}=this.props.param,n=t.findIndex(i=>i[0]===this.props.value);this.props.onChange({param:this.props.param,name:this.props.name,value:t[n===t.length-1?0:n+1][0]})},this.items=sy(t=>Hn.createItemsFromSelectOptions(t.options)),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}renderControl(){var t;const n=this.items(this.props.param),r=void 0!==this.props.value?Hn.findItem(n,this.props.value):void 0,i=r?r.label:typeof this.props.value>"u"?`${(null===(t=Hn.getFirstItem(n))||void 0===t?void 0:t.label)||""} [Default]`:`[Invalid] ${this.props.value}`;return(0,L.jsx)(yl,{disabled:this.props.isDisabled,style:{textAlign:this.props.param.cycle?"center":"left",overflow:"hidden",textOverflow:"ellipsis"},label:i,title:i,icon:this.props.param.cycle?"on"===this.props.value?a2:"off"===this.props.value?Dbe:void 0:void 0,toggle:this.props.param.cycle?this.cycle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;const t=this.items(this.props.param),n=Hn.findItem(t,this.props.value);return(0,L.jsx)(Hn,{items:t,current:n,onSelect:this.onSelect})}render(){return f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}let Hbt=(()=>{class e extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,showOptions:!1},this.onSelect=n=>{n&&n.value!==this.props.value?this.setState({showOptions:!1},()=>{this.props.onChange({param:this.props.param,name:this.props.name,value:{ref:n.value}})}):this.setState({showOptions:!1})},this.toggle=()=>this.setState({showOptions:!this.state.showOptions}),this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}get items(){return Hn.createItemsFromSelectOptions(this.props.param.getOptions(this.context))}renderControl(){var n;const i=this.props.value.ref?Hn.findItem(this.items,this.props.value.ref):void 0,o=i?i.label:`[Ref] ${null!==(n=this.props.value.ref)&&void 0!==n?n:""}`;return(0,L.jsx)(yl,{disabled:this.props.isDisabled,style:{textAlign:"left",overflow:"hidden",textOverflow:"ellipsis"},label:o,title:o,toggle:this.toggle,isSelected:this.state.showOptions})}renderAddOn(){if(!this.state.showOptions)return null;const n=this.items,r=Hn.findItem(n,this.props.value.ref);return(0,L.jsx)(Hn,{items:n,current:r,onSelect:this.onSelect})}render(){return f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderAddOn()})}}return e.contextType=cm,e})();class Gbt extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:I.Numeric(0,{step:this.props.param.step},{label:"Min"}),1:I.Numeric(0,{step:this.props.param.step},{label:"Max"})},this.componentChange=({name:t,value:n})=>{const r=[...this.props.value];r[+t]=n,this.change(r)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){const t=this.props.value,n=this.props.param.label||Rc(this.props.name),r=n5(this.props.param.step||.01),i=`[${t[0].toFixed(r)}, ${t[1].toFixed(r)}]`;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:n,control:(0,L.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:i})}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(vs,{params:this.components,values:t,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}}class qbt extends LA{constructor(){super(...arguments),this.onChange=t=>{this.update(t)}}renderControl(){return(0,L.jsx)(Fbt,{value:this.props.value,min:this.props.param.min,max:this.props.param.max,step:this.props.param.step,onChange:this.onChange,disabled:this.props.isDisabled,onEnter:this.props.onEnter})}}function UP(e,t=!1){return Array.isArray(e)?t?`${st.toStyle(e[0])} ${(100*e[1]).toFixed(2)}%`:st.toStyle(e[0]):st.toStyle(e)}const Wbt=k5(e=>`linear-gradient(to right, ${e.map(n=>UP(n,!0)).join(", ")})`),$bt=k5(e=>{const t=e.length,n=[`${UP(e[0])} ${1/t*100}%`];for(let r=1,i=t-1;r<i;++r)n.push(`${UP(e[r])} ${r/t*100}%`,`${UP(e[r])} ${(r+1)/t*100}%`);return n.push(`${UP(e[t-1])} ${(t-1)/t*100}%`),`linear-gradient(to right, ${n.join(", ")})`});function JW(e,t="0"){return{background:Ybt(e.colors,"set"===e.kind),position:"absolute",bottom:"0",height:"4px",right:t,left:"0"}}function Ybt(e,t){return t?$bt(e):Wbt(e)}let gO;function Xbe(){return gO||(gO=function Xbt(){const e=t=>{const n=cp(t[0]);return(0,L.jsx)("div",{style:JW({kind:"qualitative"!==n.type?"interpolate":"set",colors:n.list})})};return{ColorPresets:{all:Hn.createItemsFromSelectOptions(QU,{addOn:e}),scale:Hn.createItemsFromSelectOptions(QLe,{addOn:e}),set:Hn.createItemsFromSelectOptions(JLe,{addOn:e})},ColorsParam:I.ObjectList({color:I.Color(0)},({color:t})=>st.toHexString(t).toUpperCase()),OffsetColorsParam:I.ObjectList({color:I.Color(0),offset:I.Numeric(0,{min:0,max:1,step:.01})},({color:t,offset:n})=>`${st.toHexString(t).toUpperCase()} [${n.toFixed(2)}]`),IsInterpolatedParam:I.Boolean(!1,{label:"Interpolated"})}}(),gO)}class Kbt extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:"edit"===this.state.show?void 0:"edit"}),this.togglePresets=()=>this.setState({show:"presets"===this.state.show?void 0:"presets"}),this.selectPreset=t=>{if(!t)return;this.setState({show:void 0});const n=cp(t.value);this.update({kind:"qualitative"!==n.type?"interpolate":"set",colors:n.list})},this.colorsChanged=({value:t})=>{this.update({kind:this.props.value.kind,colors:t.map(n=>n.color)})},this.isInterpolatedChanged=({value:t})=>{this.update({kind:t?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}renderControl(){const{value:t}=this.props;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[1===t.colors.length?"1 color":`${t.colors.length} colors`,(0,L.jsx)("div",{style:JW(t,"33px")})]}),(0,L.jsx)(kn,{svg:OA,onClick:this.togglePresets,toggleState:"presets"===this.state.show,title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;const{ColorPresets:t,ColorsParam:n,IsInterpolatedParam:r}=Xbe();if("presets"===this.state.show)return(0,L.jsx)(Hn,{items:t[this.props.param.presetKind],onSelect:this.selectPreset});const o=this.props.value.colors.map(s=>({color:s}));return(0,L.jsxs)("div",{className:"msp-control-offset",children:[(0,L.jsx)(e$,{name:"colors",param:n,value:o,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,L.jsx)(QW,{name:"isInterpolated",param:r,value:"interpolate"===this.props.value.kind,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}}class Zbt extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1,show:void 0},this.toggleEdit=()=>this.setState({show:"edit"===this.state.show?void 0:"edit"}),this.togglePresets=()=>this.setState({show:"presets"===this.state.show?void 0:"presets"}),this.selectPreset=t=>{if(!t)return;this.setState({show:void 0});const n=cp(t.value);this.update({kind:"qualitative"!==n.type?"interpolate":"set",colors:n.list})},this.colorsChanged=({value:t})=>{const n=t.map(r=>[r.color,r.offset]);n.sort((r,i)=>r[1]-i[1]),this.update({kind:this.props.value.kind,colors:n})},this.isInterpolatedChanged=({value:t})=>{this.update({kind:t?"interpolate":"set",colors:this.props.value.colors})},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}update(t){this.props.onChange({param:this.props.param,name:this.props.name,value:t})}renderControl(){const{value:t}=this.props;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("button",{onClick:this.toggleEdit,style:{position:"relative",paddingRight:"33px"},children:[1===t.colors.length?"1 color":`${t.colors.length} colors`,(0,L.jsx)("div",{style:JW(t,"33px")})]}),(0,L.jsx)(kn,{svg:OA,onClick:this.togglePresets,toggleState:"presets"===this.state.show,title:"Color Presets",style:{padding:0,position:"absolute",right:0,top:0,width:"32px"}})]})}renderColors(){if(!this.state.show)return null;const{ColorPresets:t,OffsetColorsParam:n,IsInterpolatedParam:r}=Xbe();if("presets"===this.state.show)return(0,L.jsx)(Hn,{items:t[this.props.param.presetKind],onSelect:this.selectPreset});const o=this.props.value.colors,s=o.map((a,l)=>Array.isArray(a)?{color:a[0],offset:a[1]}:{color:a,offset:l/o.length});return s.sort((a,l)=>a.offset-l.offset),(0,L.jsxs)("div",{className:"msp-control-offset",children:[(0,L.jsx)(e$,{name:"colors",param:n,value:s,onChange:this.colorsChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter}),(0,L.jsx)(QW,{name:"isInterpolated",param:r,value:"interpolate"===this.props.value.kind,onChange:this.isInterpolatedChanged,isDisabled:this.props.isDisabled,onEnter:this.props.onEnter})]})}render(){return f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:this.renderColors()})}}class Qbt extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={0:I.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.x||"X"}),1:I.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.y||"Y"}),2:I.Numeric(0,{step:this.props.param.step},{label:this.props.param.fieldLabels&&this.props.param.fieldLabels.z||"Z"})},this.componentChange=({name:t,value:n})=>{const r=C.copy(C.zero(),this.props.value);r[+t]=n,this.change(r)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){const t=this.props.value,n=this.props.param.label||Rc(this.props.name),r=n5(this.props.param.step||.01),i=`[${t[0].toFixed(r)}, ${t[1].toFixed(r)}, ${t[2].toFixed(r)}]`;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:n,control:(0,L.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:i})}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(vs,{params:this.components,values:t,onChange:this.componentChange,onEnter:this.props.onEnter})})]})}}class Jbt extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.components={json:I.Text(JSON.stringify(fe()),{description:"JSON array with 4x4 matrix in a column major (j * 4 + i indexing) format"})},this.componentChange=({name:t,value:n})=>{const r=fe.copy(fe(),this.props.value);"json"===t?fe.copy(r,JSON.parse(n)):r[+t]=n,this.change(r)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}changeValue(t){return n=>{const r=fe.copy(fe(),this.props.value);r[t]=n,this.change(r)}}get grid(){const t=this.props.value,n=[];for(let r=0;r<4;r++){const i=[];for(let o=0;o<4;o++)i.push((0,L.jsx)(Ky,{numeric:!0,delayMs:50,value:fe.getValue(t,r,o),onChange:this.changeValue(4*o+r),className:"msp-form-control",blurOnEnter:!0,isDisabled:this.props.isDisabled},o));n.push((0,L.jsx)("div",{className:"msp-flex-row",children:i},r))}return(0,L.jsx)("div",{className:"msp-parameter-matrix",children:n})}render(){const t={json:JSON.stringify(this.props.value)},n=this.props.param.label||Rc(this.props.name);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:n,control:(0,L.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:"4\xd74 Matrix"})}),this.state.isExpanded&&(0,L.jsxs)("div",{className:"msp-control-offset",children:[this.grid,(0,L.jsx)(vs,{params:this.components,values:t,onChange:this.componentChange,onEnter:this.props.onEnter})]})]})}}class e1t extends LA{constructor(){super(...arguments),this.onChange=t=>{const n=t.target.value;n!==jr.getUrl(this.props.value||"")&&this.update(jr.Url(n))},this.onKeyPress=t=>{(13===t.keyCode||13===t.charCode||"Enter"===t.key)&&this.props.onEnter&&this.props.onEnter(),t.stopPropagation()}}renderControl(){const t=this.props.param.label||Rc(this.props.name);return(0,L.jsx)("input",{type:"text",value:jr.getUrl(this.props.value||""),placeholder:t,onChange:this.onChange,onKeyPress:this.props.onEnter?this.onKeyPress:void 0,disabled:this.props.isDisabled})}}class t1t extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFile=t=>{this.change(t.target.files[0])},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:jr.File(t)})}renderControl(){const t=this.props.value;return(0,L.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[t?t.name:"Select a file..."," ",(0,L.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFile,type:"file",multiple:!1,accept:this.props.param.accept})]})}render(){return this.props.param.label?f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}}class n1t extends Yt.PureComponent{constructor(){super(...arguments),this.state={showHelp:!1},this.onChangeFileList=t=>{this.change(t.target.files)},this.toggleHelp=()=>this.setState({showHelp:!this.state.showHelp})}change(t){const n=[];if(t)for(let r=0,i=t.length;r<i;++r)n.push(jr.File(t[r]));this.props.onChange({name:this.props.name,param:this.props.param,value:n})}renderControl(){const t=this.props.value,n=[];if(t)for(const i of t)n.push(i.name);return(0,L.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",style:{marginTop:"1px"},children:[0===n.length?"Select files...":1===n.length?n[0]:`${n.length} files selected`," ",(0,L.jsx)("input",{disabled:this.props.isDisabled,onChange:this.onChangeFileList,type:"file",multiple:!0,accept:this.props.param.accept})]})}render(){return this.props.param.label?f2({props:this.props,state:this.state,control:this.renderControl(),toggleHelp:this.toggleHelp,addOn:null}):this.renderControl()}}class r1t extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}toggle(t){return n=>{this.props.value.indexOf(t)<0?this.change(this.props.value.concat(t)):this.change(this.props.value.filter(r=>r!==t)),n.currentTarget.blur()}}render(){const t=this.props.value,n=this.props.param.emptyValue,r=this.props.param.label||Rc(this.props.name);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:r,control:(0,L.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:0===t.length&&n?n:`${t.length} of ${this.props.param.options.length}`})}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:this.props.param.options.map(([i,o])=>{const s=t.indexOf(i)>=0;return(0,L.jsx)(ir,{onClick:this.toggle(i),disabled:this.props.isDisabled,style:{marginTop:"1px"},children:(0,L.jsx)("span",{style:{float:s?"left":"right"},children:s?`\u2713 ${o}`:`${o} \u2717`})},i)})})]})}}class Kbe extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!!this.props.param.isExpanded,showPresets:!1,showHelp:!1},this.onChangeParam=t=>{this.change({...this.props.value,[t.name]:t.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.toggleShowPresets=()=>this.setState({showPresets:!this.state.showPresets}),this.presetItems=sy(t=>{var n;return Hn.createItemsFromSelectOptions(null!==(n=t.presets)&&void 0!==n?n:[])}),this.onSelectPreset=t=>{this.setState({showPresets:!1}),this.change(t?.value)}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}pivotedPresets(){if(!this.props.param.presets)return null;const t=this.props.param.label||Rc(this.props.name);return(0,L.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,L.jsx)("div",{className:"msp-control-group-header",children:(0,L.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,L.jsx)(Mi,{svg:OA}),t," Presets"]})}),this.state.showPresets&&(0,L.jsx)(Hn,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]})}presets(){return this.props.param.presets?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{className:"msp-control-group-presets-wrapper",children:(0,L.jsx)("div",{className:"msp-control-group-header",children:(0,L.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleShowPresets,children:[(0,L.jsx)(Mi,{svg:OA}),"Presets"]})})}),this.state.showPresets&&(0,L.jsx)(Hn,{items:this.presetItems(this.props.param),onSelect:this.onSelectPreset})]}):null}pivoted(){const t=this.props.param.pivot,n=this.props.param.params,r=n[t],i=jP(r),o=(0,L.jsx)(i,{name:t,param:r,value:this.props.value[t],onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});if(!this.state.isExpanded)return(0,L.jsxs)("div",{className:"msp-mapped-parameter-group",children:[o,(0,L.jsx)(kn,{svg:l2,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"})]});const s=Object.create(null);for(const a of Object.keys(n))a!==t&&(s[a]=n[a]);return(0,L.jsxs)("div",{className:"msp-mapped-parameter-group",children:[o,(0,L.jsx)(kn,{svg:l2,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:"More Options"}),(0,L.jsxs)("div",{className:"msp-control-offset",children:[this.pivotedPresets(),(0,L.jsx)(vs,{params:s,onEnter:this.props.onEnter,values:this.props.value,onChange:this.onChangeParam,isDisabled:this.props.isDisabled})]})]})}render(){const t=this.props.param.params;if(0===Object.keys(t).length)return null;if(this.props.param.pivot)return this.pivoted();const n=this.props.param.label||Rc(this.props.name),r=(0,L.jsx)(vs,{params:t,onChange:this.onChangeParam,values:this.props.value,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled});return this.props.inMapped?(0,L.jsx)("div",{className:"msp-control-offset",children:r}):this.props.param.isFlat?r:(0,L.jsxs)("div",{className:"msp-control-group-wrapper",style:{position:"relative"},children:[(0,L.jsx)("div",{className:"msp-control-group-header",children:(0,L.jsxs)("button",{className:"msp-btn msp-form-control msp-btn-block",onClick:this.toggleExpanded,children:[(0,L.jsx)(Mi,{svg:this.state.isExpanded?Yy:Xy}),n]})}),this.presets(),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:r})]})}}class i1t extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.valuesCache={},this.onChangeName=t=>{this.change({name:t.value,params:this.getValues(t.value)})},this.onChangeParam=t=>{this.setValues(this.props.value.name,t.value),this.change({name:this.props.value.name,params:t.value})},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}setValues(t,n){this.valuesCache[t]=n}getValues(t){return t in this.valuesCache?this.valuesCache[t]:this.props.param.map(t).defaultValue}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}areParamsEmpty(t){for(const n of Object.keys(t))if(!t[n].isHidden)return!1;return!0}render(){const t=this.props.value||this.props.param.defaultValue,n=this.props.param.map(t.name),r=this.props.param.label||Rc(this.props.name),i=jP(n),o=this.props.param.help,s=o?{...this.props.param.select,help:l=>o({name:l,params:this.getValues(l)})}:this.props.param.select,a=(0,L.jsx)(mO,{param:s,isDisabled:this.props.isDisabled,onChange:this.onChangeName,onEnter:this.props.onEnter,name:r,value:t.name});return i?"group"!==n.type||n.isFlat?(0,L.jsxs)(L.Fragment,{children:[a,(0,L.jsx)(i,{param:n,value:t.params,name:t.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):this.areParamsEmpty(n.params)?a:(0,L.jsxs)("div",{className:"msp-mapped-parameter-group",children:[a,(0,L.jsx)(kn,{svg:l2,onClick:this.toggleExpanded,toggleState:this.state.isExpanded,title:`${r} Properties`}),this.state.isExpanded&&(0,L.jsx)(Kbe,{inMapped:!0,param:n,value:t.params,name:t.name,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):a}}class Zbe extends Yt.PureComponent{constructor(){super(...arguments),this.state={current:this.props.value},this.onChangeParam=t=>{this.setState({current:{...this.state.current,[t.name]:t.value}})},this.apply=()=>{this.props.apply(this.state.current)}}componentDidUpdate(t){(this.props.params!==t.params||this.props.value!==t.value)&&this.setState({current:this.props.value})}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(vs,{params:this.props.params,onChange:this.onChangeParam,values:this.state.current,onEnter:this.apply,isDisabled:this.props.isDisabled}),(0,L.jsx)("button",{className:"msp-btn msp-btn-block msp-form-control msp-control-top-offset",onClick:this.apply,disabled:this.props.isDisabled,children:this.props.isUpdate?"Update":"Add"})]})}}class o1t extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.update=t=>{this.props.actions.update(t,this.props.index)},this.moveUp=()=>{this.props.actions.move(this.props.index,-1)},this.moveDown=()=>{this.props.actions.move(this.props.index,1)},this.remove=()=>{this.setState({isExpanded:!1}),this.props.actions.remove(this.props.index)},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-param-object-list-item",children:[(0,L.jsxs)("button",{className:"msp-btn msp-btn-block msp-form-control",onClick:this.toggleExpanded,children:[(0,L.jsx)("span",{children:`${this.props.index+1}: `}),this.props.param.getLabel(this.props.value)]}),(0,L.jsxs)("div",{children:[(0,L.jsx)(kn,{svg:fO,title:"Move Up",onClick:this.moveUp,small:!0}),(0,L.jsx)(kn,{svg:pO,title:"Move Down",onClick:this.moveDown,small:!0}),(0,L.jsx)(kn,{svg:qp,title:"Remove",onClick:this.remove,small:!0})]})]}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(Zbe,{params:this.props.param.element,apply:this.update,value:this.props.value,isUpdate:!0,isDisabled:this.props.isDisabled})})]})}}class e$ extends Yt.PureComponent{constructor(){super(...arguments),this.state={isExpanded:!1},this.add=t=>{this.change([...this.props.value,t])},this.actions={update:(t,n)=>{const r=this.props.value.slice(0);r[n]=t,this.change(r)},move:(t,n)=>{let r=this.props.value;if(1===r.length)return;let i=(t+n)%r.length;i<0&&(i+=r.length),r=r.slice(0);const o=r[t];r[t]=r[i],r[i]=o,this.change(r)},remove:t=>{const n=this.props.value,r=[];for(let i=0;i<n.length;i++)t!==i&&r.push(n[i]);this.change(r)}},this.toggleExpanded=t=>{this.setState({isExpanded:!this.state.isExpanded}),t.currentTarget.blur()}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){const t=this.props.value,n=this.props.param.label||Rc(this.props.name);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:n,control:(0,L.jsx)("button",{onClick:this.toggleExpanded,disabled:this.props.isDisabled,children:`${t.length} item${1!==t.length?"s":""}`})}),this.state.isExpanded&&(0,L.jsxs)("div",{className:"msp-control-offset",children:[this.props.value.map((i,o)=>(0,L.jsx)(o1t,{param:this.props.param,value:i,index:o,actions:this.actions,isDisabled:this.props.isDisabled},o)),(0,L.jsx)(Fg,{header:"New Item",children:(0,L.jsx)(Zbe,{params:this.props.param.element,apply:this.add,value:this.props.param.ctor(),isDisabled:this.props.isDisabled})})]})]})}}class s1t extends Yt.PureComponent{constructor(){super(...arguments),this.onChangeCondition=t=>{this.change(this.props.param.conditionedValue(this.props.value,t.value))},this.onChangeParam=t=>{this.change(t.value)}}change(t){this.props.onChange({name:this.props.name,param:this.props.param,value:t})}render(){const t=this.props.value,n=this.props.param.conditionForValue(t),r=this.props.param.conditionParams[n],i=this.props.param.label||Rc(this.props.name),o=jP(r),s=(0,L.jsx)(mO,{param:this.props.param.select,isDisabled:this.props.isDisabled,onChange:this.onChangeCondition,onEnter:this.props.onEnter,name:`${i} Kind`,value:n});return o?(0,L.jsxs)(L.Fragment,{children:[s,(0,L.jsx)(o,{param:r,value:t,name:i,onChange:this.onChangeParam,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled})]}):s}}class a1t extends Yt.PureComponent{constructor(){super(...arguments),this.onChange=t=>{this.props.onChange({name:this.props.name,param:this.props.param,value:this.props.param.toValue(t.value)})}}render(){const t=this.props.param.fromValue(this.props.value),n=jP(this.props.param.converted);return n?(0,L.jsx)(n,{param:this.props.param.converted,value:t,name:this.props.name,onChange:this.onChange,onEnter:this.props.onEnter,isDisabled:this.props.isDisabled}):null}}class l1t extends Yt.PureComponent{constructor(){super(...arguments),this.onChange=({name:t,value:n})=>{n!==this.props.value[t]&&this.props.onChange({param:this.props.param,name:this.props.name,value:{...this.props.value,[t]:n}})}}render(){const t={defaultValue:this.props.value.language,options:I.objectToOptions(pa.Info),type:"select"},n=(0,L.jsx)(mO,{param:t,isDisabled:this.props.isDisabled,onChange:this.onChange,onEnter:this.props.onEnter,name:"language",value:this.props.value.language}),i=(0,L.jsx)(Ybe,{param:{defaultValue:this.props.value.language,type:"text"},isDisabled:this.props.isDisabled,onChange:this.onChange,name:"expression",value:this.props.value.expression});return(0,L.jsxs)(L.Fragment,{children:[n,"mol-script"!==this.props.value.language&&(0,L.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,L.jsx)(Mi,{svg:Obe})," Support for PyMOL, VMD, and Jmol selections is an experimental feature and may not always work as intended."]}),i]})}}const c1t={color:I.Color(qn.black,{description:"Display color of the volume."}),wireframe:I.Boolean(!1,{description:"Control display of the volume as a wireframe."}),opacity:I.Numeric(.3,{min:0,max:1,step:.01},{description:"Opacity of the volume."})},u1t=new Map([["em",[-5,5]],["2fo-fc",[0,3]],["fo-fc(+ve)",[1,5]],["fo-fc(-ve)",[-5,-1]]]);class yO extends Vr{constructor(){super(...arguments),this.ref=Qn.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name),this.getVisible=()=>{const n=this.ref;return!!n&&!this.plugin.state.data.cells.get(n).state.isHidden},this.toggleVisible=()=>{const t=this.plugin.state.data,n=this.ref;n&&G_(t,n,!t.cells.get(n).state.isHidden)}}componentDidUpdate(){this.ref=Qn.findTagInSubtree(this.plugin.state.data.tree,this.props.bCell.transform.ref,this.props.name)}componentDidMount(){this.subscribe(this.plugin.state.data.events.cell.stateUpdated,t=>{this.ref===t.ref&&this.forceUpdate()})}render(){const t=this.props,{isRelative:n,stats:r}=t,i=t.channels[t.name],{min:o,max:s,mean:a,sigma:l}=r,c=Math.round(100*("relative"===i.isoValue.kind?i.isoValue.relativeValue:i.isoValue.absoluteValue))/100;let u=(o-a)/l,d=(s-a)/l;if(!this.props.isUnbounded){const y=u1t.get(this.props.name);"em"===this.props.name?(u=Math.max(y[0],u),d=Math.min(y[1],d)):(u=y[0],d=y[1])}const f=a+l*u,p=a+l*d,m=az(n?Math.round((p-f)/l)/100:l/100,2);return(0,L.jsx)(Ibt,{label:t.label+(t.isRelative?" \u03c3":""),colorStripe:i.color,pivot:(0,L.jsxs)("div",{className:"msp-volume-channel-inline-controls",children:[(0,L.jsx)(zbe,{value:c,min:n?u:f,max:n?d:p,step:m,onChange:y=>t.changeIso(t.name,y,n),onChangeImmediate:y=>t.changeIso(t.name,y,n),disabled:t.params.isDisabled,onEnter:t.params.events.onEnter}),(0,L.jsx)(kn,{svg:this.getVisible()?u2:c2,onClick:this.toggleVisible,toggleState:!1,disabled:t.params.isDisabled})]}),controls:(0,L.jsx)(vs,{onChange:({name:y,value:v})=>t.changeParams(t.name,y,v),params:c1t,values:i,onEnter:t.params.events.onEnter,isDisabled:t.params.isDisabled})})}}class d1t extends Vr{constructor(){super(...arguments),this.changeIso=(t,n,r)=>{const i=this.props.params;this.newParams({...i,entry:{name:i.entry.name,params:{...i.entry.params,channels:{...i.entry.params.channels,[t]:{...i.entry.params.channels[t],isoValue:r?mt.IsoValue.relative(n):mt.IsoValue.absolute(n)}}}}})},this.changeParams=(t,n,r)=>{const i=this.props.params;this.newParams({...i,entry:{name:i.entry.name,params:{...i.entry.params,channels:{...i.entry.params.channels,[t]:{...i.entry.params.channels[t],[n]:r}}}}})},this.changeOption=({name:t,value:n})=>{const r=this.props.params;if("entry"===t)this.newParams({...r,entry:{name:n,params:r.entry.params}});else{const i=this.props.b.data,o="em"===i.info.kind,s=n.params.isRelative,a=i.info.header.sampling[0],l=r.entry.params.channels,u={...r.entry.params.view.name===n.name?r.entry.params.view.params:this.props.info.params.entry.map(r.entry.name).params.view.map(n.name).defaultValue};"selection-box"===n.name?u.radius=n.params.radius:"camera-target"===n.name?(u.radius=n.params.radius,u.dynamicDetailLevel=n.params.dynamicDetailLevel):"box"===n.name?(u.bottomLeft=n.params.bottomLeft,u.topRight=n.params.topRight):"auto"===n.name&&(u.radius=n.params.radius,u.selectionDetailLevel=n.params.selectionDetailLevel),u.isUnbounded=!!n.params.isUnbounded,this.newParams({...r,entry:{name:r.entry.name,params:{...r.entry.params,view:{name:n.name,params:u},detailLevel:n.params.detailLevel,channels:o?{em:this.convert(l.em,a.valuesInfo[0],s)}:{"2fo-fc":this.convert(l["2fo-fc"],a.valuesInfo[0],s),"fo-fc(+ve)":this.convert(l["fo-fc(+ve)"],a.valuesInfo[1],s),"fo-fc(-ve)":this.convert(l["fo-fc(-ve)"],a.valuesInfo[1],s)}}}})}}}areInitial(t){return I.areEqual(this.props.info.params,t,this.props.info.initialValues)}newParams(t){this.props.events.onChange(t,this.areInitial(t))}convert(t,n,r){return{...t,isoValue:r?mt.IsoValue.toRelative(t.isoValue,n):mt.IsoValue.toAbsolute(t.isoValue,n)}}render(){if(!this.props.b)return null;const t=this.props.b.data,n="em"===t.info.kind,r=n?"em":"2fo-fc",i=this.props.params,o=this.props.info.params.entry.map(i.entry.name),s=o.params.detailLevel,a={...s,label:"Dynamic Detail",defaultValue:o.params.view.map("camera-target").params.dynamicDetailLevel.defaultValue},l={...s,label:"Selection Detail",defaultValue:o.params.view.map("auto").params.selectionDetailLevel.defaultValue},c=t.info.header.sampling[0],u="relative"===i.entry.params.channels[r].isoValue.kind,d=I.Boolean(u,{description:"Use normalized or absolute isocontour scale.",label:"Normalized"}),f=!!i.entry.params.view.params.isUnbounded,p=I.Boolean(f,{description:"Show full/limited range of iso-values for more fine-grained control.",label:"Unbounded"}),m="off"===i.entry.params.view.name,h={entry:I.Select(i.entry.name,t.data.entries.map(y=>[y.dataId,y.dataId]),{isHidden:m,description:"Which entry with volume data to display."}),view:I.MappedStatic(i.entry.params.view.name,{off:I.Group({isRelative:I.Boolean(u,{isHidden:!0}),isUnbounded:I.Boolean(f,{isHidden:!0})},{description:"Display off."}),box:I.Group({bottomLeft:I.Vec3(C.zero()),topRight:I.Vec3(C.zero()),detailLevel:s,isRelative:d,isUnbounded:p},{description:"Static box defined by cartesian coords."}),"selection-box":I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),detailLevel:s,isRelative:d,isUnbounded:p},{description:"Box around focused element."}),"camera-target":I.Group({radius:I.Numeric(.5,{min:0,max:1,step:.05},{description:"Radius within which the volume is shown (relative to the field of view)."}),detailLevel:{...s,isHidden:!0},dynamicDetailLevel:a,isRelative:d,isUnbounded:p},{description:"Box around camera target."}),cell:I.Group({detailLevel:s,isRelative:d,isUnbounded:p},{description:"Box around the structure's bounding box."}),auto:I.Group({radius:I.Numeric(5,{min:0,max:50,step:.5},{description:"Radius in \u212b within which the volume is shown."}),detailLevel:s,selectionDetailLevel:l,isRelative:d,isUnbounded:p},{description:"Box around focused element."})},{options:fu.ViewTypeOptions,description:'Controls what of the volume is displayed. "Off" hides the volume alltogether. "Bounded box" shows the volume inside the given box. "Around Focus" shows the volume around the element/atom last interacted with. "Around Camera" shows the volume around the point the camera is targeting. "Whole Structure" shows the volume for the whole structure.'})},g={entry:i.entry.name,view:{name:i.entry.params.view.name,params:{detailLevel:i.entry.params.detailLevel,radius:i.entry.params.view.params.radius,bottomLeft:i.entry.params.view.params.bottomLeft,topRight:i.entry.params.view.params.topRight,selectionDetailLevel:i.entry.params.view.params.selectionDetailLevel,dynamicDetailLevel:i.entry.params.view.params.dynamicDetailLevel,isRelative:u,isUnbounded:f}}};return m?(0,L.jsx)(vs,{onChange:this.changeOption,params:h,values:g,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled}):(0,L.jsxs)(L.Fragment,{children:[!n&&(0,L.jsx)(yO,{label:"2Fo-Fc",name:"2fo-fc",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[0],isUnbounded:f}),!n&&(0,L.jsx)(yO,{label:"Fo-Fc(+ve)",name:"fo-fc(+ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[1],isUnbounded:f}),!n&&(0,L.jsx)(yO,{label:"Fo-Fc(-ve)",name:"fo-fc(-ve)",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[1],isUnbounded:f}),n&&(0,L.jsx)(yO,{label:"EM",name:"em",bCell:this.props.bCell,channels:i.entry.params.channels,changeIso:this.changeIso,changeParams:this.changeParams,isRelative:u,params:this.props,stats:c.valuesInfo[0],isUnbounded:f}),(0,L.jsx)(vs,{onChange:this.changeOption,params:h,values:g,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})]})}}function Jy(...e){const t=$C(e),n=Wre(e,1/0),r=e;return r.length?1===r.length?vd(r[0]):Ux(n)(Is(r,t)):Mh}function Qbe(e,t=yF){return is((n,r)=>{let i=null,o=null,s=null;const a=()=>{if(i){i.unsubscribe(),i=null;const c=o;o=null,r.next(c)}};function l(){const c=s+e,u=t.now();if(u<c)return i=this.schedule(void 0,c-u),void r.add(i);a()}n.subscribe(Xo(r,c=>{o=c,s=t.now(),i||(i=t.schedule(l,e),r.add(i))},()=>{a(),r.complete()},void 0,()=>{o=i=null}))})}var bO;!function(e){e.Registry=class t{constructor(){this.providers=Nc().asMutable(),this.defaultAutoAttachValues=new Map}getParams(r){const i={},o=[],s=[];if(r){const a=this.providers.values();for(;;){const l=a.next();if(l.done)break;const c=l.value;c.isApplicable(r)&&(c.isHidden||(o.push([c.descriptor.name,c.label]),this.defaultAutoAttachValues.get(c.descriptor.name)&&s.push(c.descriptor.name)),i[c.descriptor.name]=I.Group({...c.getParams(r)},{label:c.label,isHidden:c.isHidden}))}}return{autoAttach:I.MultiSelect(s,o),properties:I.Group(i,{isFlat:!0})}}setDefaultAutoAttach(r,i){this.defaultAutoAttachValues.set(r,i)}get(r){if(!this.providers.get(r))throw new Error(`Custom property '${r}' is not registered.`);return this.providers.get(r)}register(r,i){this.providers.set(r.descriptor.name,r),this.defaultAutoAttachValues.set(r.descriptor.name,i)}unregister(r){this.providers.delete(r),this.defaultAutoAttachValues.delete(r)}}}(bO||(bO={}));class p1t{get dataState(){return this.plugin.state.data}rawData(t,n){return this.dataState.build().toRoot().apply(Mue,t,n).commit({revertOnError:!0})}download(t,n){return this.dataState.build().toRoot().apply(Pue,t,n).commit({revertOnError:!0})}downloadBlob(t,n){return this.dataState.build().toRoot().apply(kue,t,n).commit({revertOnError:!0})}readFile(t,n){var r=this;return le(function*(){var i,o,s;return{data:yield r.dataState.build().toRoot().apply(Rue,t,n).commit({revertOnError:!0}),fileInfo:RA(null!==(s=null===(o=null===(i=t.file)||void 0===i?void 0:i.file)||void 0===o?void 0:o.name)&&void 0!==s?s:"")}})()}constructor(t){this.plugin=t}}class h1t{get dataState(){return this.plugin.state.data}resolveProvider(t){var n;return"string"==typeof t?null!==(n=Gp[t])&&void 0!==n?n:NU(this._providers,r=>r.id===t):t}hasPreset(t){for(const n of this._providers)if(!n.isApplicable||n.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;const n=[];for(const r of this._providers)r.isApplicable&&!r.isApplicable(t,this.plugin)||n.push(r);return n}getPresetSelect(t){const n=[];for(const r of this._providers)t&&r.isApplicable&&!r.isApplicable(t,this.plugin)||n.push([r.id,r.display.name,r.display.group]);return I.Select("auto",n)}getPresetsWithOptions(t){const n=[],r=Object.create(null);for(const i of this._providers)i.isApplicable&&!i.isApplicable(t,this.plugin)||(n.push([i.id,i.display.name]),r[i.id]=i.params?I.Group(i.params(t,this.plugin)):I.EmptyGroup());return 0===n.length?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(n[0][0],r,{options:n})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Representation provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),p3(this._providers,t)}applyPreset(t,n,r){var i;const o=this.resolveProvider(n);if(!o)return;const a=_a.resolveAndCheck(this.plugin.state.data,t);if(!a)return void(g3||console.warn("Applying structure repr. provider to bad cell."));const l=(null===(i=o.params)||void 0===i?void 0:i.call(o,a.obj,this.plugin))||{};let c=r||(o.params?I.getDefaultValues(l):{});const u=this.plugin.config.get(ei.Structure.DefaultRepresentationPresetParams);c=I.merge(l,u,c);const d=Ke.create(`${o.display.name}`,()=>o.apply(a,c,this.plugin));return this.plugin.runTask(d)}addRepresentation(t,n,r){var i=this;return le(function*(){const o=i.dataState.build(),s=i.buildRepresentation(o,t,n,r);if(s)return yield o.commit(),s})()}buildRepresentation(t,n,r,i){var o,s;if(!n)return;const a=null===(s=null===(o=_a.resolveAndCheck(this.dataState,n))||void 0===o?void 0:o.obj)||void 0===s?void 0:s.data;if(!a)return;const l=rO(this.plugin,a,r);return i?.tag?t.to(n).applyOrUpdateTagged(i.tag,hF,l,{state:i?.initialState}).selector:t.to(n).apply(hF,l,{state:i?.initialState}).selector}constructor(t){this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=Gp.auto,Nu(Gp,n=>this.registerPreset(n))}}function dv(e){return e}!function(e){e.CommonParams=(t,n)=>({modelProperties:I.Optional(I.Group(yt.getParamDefinition(at.Model.CustomModelProperties,void 0,n))),structureProperties:I.Optional(I.Group(yt.getParamDefinition(at.Model.CustomStructureProperties,void 0,n))),representationPreset:I.Optional(I.Text("auto"))})}(dv||(dv={}));const vO=dv.CommonParams,Jbe=dv({id:"preset-trajectory-default",display:{name:"Default (Assembly)",group:"Preset",description:"Shows the first assembly or, if that is unavailable, the first model."},isApplicable:e=>!0,params:(e,t)=>({model:I.Optional(I.Group(yt.getParamDefinition(at.Model.ModelFromTrajectory,e,t))),showUnitcell:I.Optional(I.Boolean(!1)),structure:I.Optional(R_.getParams(void 0,"assembly").type),representationPresetParams:I.Optional(I.Group(jc.CommonParams)),...vO(e,t)}),apply:(e,t,n)=>le(function*(){const r=n.builders.structure,i=yield r.createModel(e,t.model),o=yield r.insertModelProperties(i,t.modelProperties),s=yield r.createStructure(o||i,t.structure),a=yield r.insertStructureProperties(s,t.structureProperties),l=void 0===t.showUnitcell||t.showUnitcell?yield r.tryCreateUnitcell(o,void 0,{isHidden:!0}):void 0,c=t.representationPreset||n.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id;return{model:i,modelProperties:o,unitcell:l,structure:s,structureProperties:a,representation:yield n.builders.structure.representation.applyPreset(a,c,t.representationPresetParams)}})()}),m1t=dv({id:"preset-trajectory-all-models",display:{name:"All Models",group:"Preset",description:"Shows all models; colored by trajectory-index."},isApplicable:e=>e.data.frameCount>1,params:(e,t)=>({useDefaultIfSingleModel:I.Optional(I.Boolean(!1)),representationPresetParams:I.Optional(I.Group(jc.CommonParams)),...vO(e,t)}),apply:(e,t,n)=>le(function*(){var r,i;const o=null===(i=null===(r=_a.resolveAndCheck(n.state.data,e))||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data;if(!o)return{};if(1===o.frameCount&&t.useDefaultIfSingleModel)return Jbe.apply(e,t,n);const s=n.builders.structure,a=[],l=[];for(let c=0;c<o.frameCount;c++){const u=yield s.createModel(e,{modelIndex:c}),d=yield s.insertModelProperties(u,t.modelProperties,{isCollapsed:!0}),f=yield s.createStructure(d||u,{name:"model",params:{}}),p=yield s.insertStructureProperties(f,t.structureProperties);a.push(u),l.push(f);const m=f.obj?eme(f.obj.data,{elementCountFactor:o.frameCount}):"medium",h=t.representationPreset||n.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id;yield s.representation.applyPreset(p,h,{theme:{globalName:"trajectory-index"},quality:m})}return{models:a,structures:l}})()}),e1e=(e,t)=>({model:I.Optional(I.Group(yt.getParamDefinition(at.Model.ModelFromTrajectory,e,t))),...vO(e,t)});function t1e(e,t,n,r){return t$.apply(this,arguments)}function t$(){return t$=le(function*(e,t,n,r){const i=r.builders.structure,o=yield i.createModel(t,n.model),s=yield i.insertModelProperties(o,n.modelProperties),a=yield i.createStructure(s||o,{name:"symmetry",params:e}),l=yield i.insertStructureProperties(a,n.structureProperties),c=yield i.tryCreateUnitcell(s,void 0,{isHidden:!1}),u=n.representationPreset||r.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id;return{model:o,modelProperties:s,unitcell:c,structure:a,structureProperties:l,representation:yield r.builders.structure.representation.applyPreset(l,u,{theme:{globalName:e.theme}})}}),t$.apply(this,arguments)}const g1t=dv({id:"preset-trajectory-unitcell",display:{name:"Unit Cell",group:"Preset",description:"Shows the fully populated unit cell."},isApplicable:e=>Sn.hasCrystalSymmetry(e.data.representative),params:e1e,apply:(e,t,n)=>le(function*(){return yield t1e({ijkMin:C.create(0,0,0),ijkMax:C.create(0,0,0)},e,t,n)})()}),y1t=dv({id:"preset-trajectory-supercell",display:{name:"Super Cell",group:"Preset",description:"Shows the super cell, i.e. the central unit cell and all adjacent unit cells."},isApplicable:e=>Sn.hasCrystalSymmetry(e.data.representative),params:e1e,apply:(e,t,n)=>le(function*(){return yield t1e({ijkMin:C.create(-1,-1,-1),ijkMax:C.create(1,1,1),theme:"operator-hkl"},e,t,n)})()}),b1t=dv({id:"preset-trajectory-crystal-contacts",display:{name:"Crystal Contacts",group:"Preset",description:"Showsasymetric unit and chains from neighbours within 5 \u212b, i.e., symmetry mates."},isApplicable:e=>Sn.hasCrystalSymmetry(e.data.representative),params:(e,t)=>({model:I.Optional(I.Group(yt.getParamDefinition(at.Model.ModelFromTrajectory,e,t))),...vO(e,t)}),apply:(e,t,n)=>le(function*(){const r=n.builders.structure,i=yield r.createModel(e,t.model),o=yield r.insertModelProperties(i,t.modelProperties),s=yield r.createStructure(o||i,{name:"symmetry-mates",params:{radius:5}}),a=yield r.insertStructureProperties(s,t.structureProperties),l=yield r.tryCreateUnitcell(o,void 0,{isHidden:!0}),c=t.representationPreset||n.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id;return{model:i,modelProperties:o,unitcell:l,structure:s,structureProperties:a,representation:yield n.builders.structure.representation.applyPreset(a,c,{theme:{globalName:"operator-name",carbonColor:"operator-name",focus:{name:"element-symbol",params:{carbonColor:{name:"operator-name",params:lG.defaultValues}}}}})}})()}),n$={default:Jbe,"all-models":m1t,unitcell:g1t,supercell:y1t,crystalContacts:b1t};class v1t{resolveProvider(t){var n;return"string"==typeof t?null!==(n=n$[t])&&void 0!==n?n:NU(this._providers,r=>r.id===t):t}hasPreset(t){for(const n of this._providers)if(!n.isApplicable||n.isApplicable(t,this.plugin))return!0;return!1}get providers(){return this._providers}getPresets(t){if(!t)return this.providers;const n=[];for(const r of this._providers)r.isApplicable&&!r.isApplicable(t,this.plugin)||n.push(r);return n}getPresetSelect(t){const n=[];for(const r of this._providers)t&&r.isApplicable&&!r.isApplicable(t,this.plugin)||n.push([r.id,r.display.name]);return I.Select("auto",n)}getPresetsWithOptions(t){const n=[],r=Object.create(null);for(const i of this._providers)i.isApplicable&&!i.isApplicable(t,this.plugin)||(n.push([i.id,i.display.name]),r[i.id]=i.params?I.Group(i.params(t,this.plugin)):I.EmptyGroup());return 0===n.length?I.MappedStatic("",{"":I.EmptyGroup()}):I.MappedStatic(n[0][0],r,{options:n})}registerPreset(t){if(this.providerMap.has(t.id))throw new Error(`Hierarchy provider with id '${t.id}' already registered.`);this._providers.push(t),this.providerMap.set(t.id,t)}unregisterPreset(t){this.providerMap.delete(t.id),p3(this._providers,t)}applyPreset(t,n,r){const i=this.resolveProvider(n);if(!i)return;const s=_a.resolveAndCheck(this.plugin.state.data,t);if(!s)return void(g3||console.warn("Applying hierarchy preset provider to bad cell."));const a=r||(i.params?I.getDefaultValues(i.params(s.obj,this.plugin)):{}),l=Ke.create(`${i.display.name}`,()=>i.apply(s,a,this.plugin));return this.plugin.runTask(l)}constructor(t){this.plugin=t,this._providers=[],this.providerMap=new Map,this.defaultProvider=n$.default,Nu(n$,n=>this.registerPreset(n))}}class x1t{get dataState(){return this.plugin.state.data}parseTrajectoryData(t,n){var r=this;return le(function*(){const i="string"==typeof n?r.plugin.dataFormats.get(n):n;if(!i)throw new Error(`'${n}' is not a supported data format.`);const{trajectory:o}=yield i.parse(r.plugin,t);return o})()}parseTrajectoryBlob(t,n){return this.dataState.build().to(t).apply(at.Data.ParseBlob,n,{state:{isGhost:!0}}).apply(at.Model.TrajectoryFromBlob,void 0).commit({revertOnError:!0})}parseTrajectory(t,n){const r=_a.resolveAndCheck(this.dataState,t);if(!r)throw new Error("Invalid data cell.");return Se.Data.Blob.is(r.obj)?this.parseTrajectoryBlob(t,n):this.parseTrajectoryData(t,n)}createModel(t,n,r){return this.dataState.build().to(t).apply(at.Model.ModelFromTrajectory,n||{modelIndex:0},{state:r}).commit({revertOnError:!0})}insertModelProperties(t,n,r){return this.dataState.build().to(t).apply(at.Model.CustomModelProperties,n,{state:r}).commit({revertOnError:!0})}tryCreateUnitcell(t,n,r){var i,o,s;const a=this.dataState,l=null===(o=null===(i=_a.resolveAndCheck(a,t))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data;if(!l)return;const c=null===(s=Vs.Provider.get(l))||void 0===s?void 0:s.spacegroup.cell;return Qc.isZero(c)?void 0:a.build().to(t).apply(at.Representation.ModelUnitcell3D,n,{state:r}).commit({revertOnError:!0})}createStructure(t,n,r,i){var o;const s=this.dataState;if(!n){const l=_a.resolveAndCheck(s,t);if(l){const c=Vs.Provider.get(null===(o=l.obj)||void 0===o?void 0:o.data);(!c||0===c?.assemblies.length)&&(n={name:"model",params:{}})}}return s.build().to(t).apply(at.Model.StructureFromModel,{type:n||{name:"assembly",params:{}}},{state:r,tags:i}).commit({revertOnError:!0})}insertStructureProperties(t,n){return this.dataState.build().to(t).apply(at.Model.CustomStructureProperties,n).commit({revertOnError:!0})}isComponentTransform(t){return t.transform.transformer===at.Model.StructureComponent}tryCreateComponent(t,n,r,i){var o=this;return le(function*(){var s,a;const l=o.dataState,c=l.build().to(t),u=`structure-component-${r}`,d=c.applyOrUpdateTagged(u,at.Model.StructureComponent,n,{tags:i?[...i,u]:[u]});yield d.commit();const f=d.selector;if(f.isOk&&0!==(null===(a=null===(s=f.cell)||void 0===s?void 0:s.obj)||void 0===a?void 0:a.data.elementCount))return f;yield l.build().delete(f.ref).commit()})()}tryCreateComponentFromExpression(t,n,r,i){return this.tryCreateComponent(t,{type:{name:"expression",params:n},nullIfEmpty:!0,label:(i?.label||"").trim()},r,i?.tags)}tryCreateComponentStatic(t,n,r){return this.tryCreateComponent(t,{type:{name:"static",params:n},nullIfEmpty:!0,label:(r?.label||"").trim()},`static-${n}`,r?.tags)}tryCreateComponentFromSelection(t,n,r,i){var o=this;return this.plugin.runTask(Ke.create("Query Component",function(){var s=le(function*(a){var l,c;let{label:u,tags:d}=i||{};u=(u||"").trim();const f=null===(c=null===(l=_a.resolveAndCheck(o.dataState,t))||void 0===l?void 0:l.obj)||void 0===c?void 0:c.data;if(!f)return;const p=n.referencesCurrent?{type:{name:"bundle",params:Qr.fromSelection(yield n.getSelection(o.plugin,a,f))},nullIfEmpty:!0,label:u||n.label}:{type:{name:"expression",params:n.expression},nullIfEmpty:!0,label:u||n.label};return n.ensureCustomProperties&&(yield n.ensureCustomProperties({runtime:a,assetManager:o.plugin.managers.asset},f)),o.tryCreateComponent(t,p,r,d)});return function(a){return s.apply(this,arguments)}}()))}constructor(t){this.plugin=t,this.hierarchy=new v1t(this.plugin),this.representation=new h1t(this.plugin)}}function UA(e,t,n={}){return"string"==typeof n.type||"string"==typeof n.color||"string"==typeof n.size?function _1t(e,t,n){const r=n.type&&e.representation.volume.registry.get(n.type)||e.representation.volume.registry.default.provider,i=n.color&&e.representation.volume.themes.colorThemeRegistry.get(n.color)||e.representation.volume.themes.colorThemeRegistry.get(r.defaultColorTheme.name),o=n.size&&e.representation.volume.themes.sizeThemeRegistry.get(n.size)||e.representation.volume.themes.sizeThemeRegistry.get(r.defaultSizeTheme.name);return n1e(e,t,{type:r,typeParams:n.typeParams,color:i,colorParams:n.colorParams,size:o,sizeParams:n.sizeParams})}(e,t||mt.One,n):n1e(e,t||mt.One,n)}function n1e(e,t,n={}){const{themes:r}=e.representation.volume,i={volume:t},o=n.type||e.representation.volume.registry.default.provider,s=I.getDefaultValues(o.getParams(r,t)),a=Object.assign(s,n.typeParams),l=n.color||r.colorThemeRegistry.get(o.defaultColorTheme.name),c=I.getDefaultValues(l.getParams(i));l.name===o.defaultColorTheme.name&&Object.assign(c,o.defaultColorTheme.props);const u=Object.assign(c,n.colorParams),d=n.size||r.sizeThemeRegistry.get(o.defaultSizeTheme.name),f=I.getDefaultValues(d.getParams(i));d.name===o.defaultSizeTheme.name&&Object.assign(f,o.defaultSizeTheme.props);const p=Object.assign(f,n.sizeParams);return{type:{name:o.name,params:a},colorTheme:{name:l.name,params:u},sizeTheme:{name:d.name,params:p}}}var r$,xO;!function(e){e.create=function t(n){const{name:r}=n;return{descriptor:n,get:i=>i._propertyData[r],set(i,o){i.customProperties.add(n),i._propertyData[r]=o}}}}(r$||(r$={})),function(e){e.Descriptor={name:"recommended_iso_value"},e.Provider=r$.create(e.Descriptor)}(xO||(xO={}));const zA="Volume";function zP(e,t){return i$.apply(this,arguments)}function i$(){return i$=le(function*(e,t){if(!t)return;const{entryId:n}=t;return n&&n.toLowerCase().startsWith("emd")?e.runTask(Ke.create("Try Set Recommended IsoValue",function(){var r=le(function*(i){try{const o=yield ige(e,i,n);xO.Provider.set(t,mt.IsoValue.absolute(o))}catch(o){console.warn(o)}});return function(i){return r.apply(this,arguments)}}())):void 0}),i$.apply(this,arguments)}function r1e(e){const t=xO.Provider.get(e);if(t)return"relative"===t.kind?t:mt.adjustedIsoValue(e,t.absoluteValue,"absolute")}function o$(e,t){return s$.apply(this,arguments)}function s$(){return s$=le(function*(e,t){const n={},r=t.volume.data&&r1e(t.volume.data);return r&&(n.isoValue=r),[yield e.build().to(t.volume).apply(at.Representation.VolumeRepresentation3D,UA(e,t.volume.data,{type:"isosurface",typeParams:n})).commit()]}),s$.apply(this,arguments)}const S1t={label:"CCP4/MRC/MAP",description:"CCP4/MRC/MAP",category:zA,binaryExtensions:["ccp4","mrc","map"],parse:function(){var e=le(function*(t,n,r){const i=t.build().to(n).apply(at.Data.ParseCcp4,{},{state:{isGhost:!0}}),o=i.apply(at.Volume.VolumeFromCcp4,{entryId:r?.entryId});return yield i.commit({revertOnError:!0}),yield zP(t,o.selector.data),{format:i.selector,volume:o.selector}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:o$},C1t={label:"DSN6/BRIX",description:"DSN6/BRIX",category:zA,binaryExtensions:["dsn6","brix"],parse:function(){var e=le(function*(t,n,r){const i=t.build().to(n).apply(at.Data.ParseDsn6,{},{state:{isGhost:!0}}),o=i.apply(at.Volume.VolumeFromDsn6,{entryId:r?.entryId});return yield i.commit({revertOnError:!0}),yield zP(t,o.selector.data),{format:i.selector,volume:o.selector}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:o$},w1t={label:"DX",description:"DX",category:zA,stringExtensions:["dx"],binaryExtensions:["dxbin"],parse:function(){var e=le(function*(t,n,r){const o=t.build().to(n).apply(at.Data.ParseDx,{},{state:{isGhost:!0}}).apply(at.Volume.VolumeFromDx,{entryId:r?.entryId});return yield o.commit({revertOnError:!0}),yield zP(t,o.selector.data),{volume:o.selector}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:o$},A1t={label:"Cube",description:"Cube",category:zA,stringExtensions:["cub","cube"],parse:function(){var e=le(function*(t,n,r){const i=t.build().to(n).apply(at.Data.ParseCube,{},{state:{isGhost:!0}}),o=i.apply(at.Volume.VolumeFromCube,{entryId:r?.entryId}),s=i.apply(at.Model.TrajectoryFromCube,void 0,{state:{isGhost:!0}}).apply(at.Model.ModelFromTrajectory).apply(at.Model.StructureFromModel);return yield i.commit({revertOnError:!0}),yield zP(t,o.selector.data),{format:i.selector,volume:o.selector,structure:s.selector}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:function(){var e=le(function*(t,n){var r,i;const o=t.build(),s=[],a=null===(i=null===(r=n.volume.cell)||void 0===r?void 0:r.obj)||void 0===i?void 0:i.data;if(a&&mt.isOrbitals(a)){const u=o.to(n.volume).apply(at.Representation.VolumeRepresentation3D,UA(t,a,{type:"isosurface",typeParams:{isoValue:mt.IsoValue.relative(1),alpha:.4},color:"uniform",colorParams:{value:qn.blue}})),d=o.to(n.volume).apply(at.Representation.VolumeRepresentation3D,UA(t,a,{type:"isosurface",typeParams:{isoValue:mt.IsoValue.relative(-1),alpha:.4},color:"uniform",colorParams:{value:qn.red}}));s.push(u.selector,d.selector)}else{const u=o.to(n.volume).apply(at.Representation.VolumeRepresentation3D,UA(t,a,{type:"isosurface",typeParams:{isoValue:mt.IsoValue.relative(2),alpha:.4},color:"uniform",colorParams:{value:qn.grey}}));s.push(u.selector)}const l=yield t.builders.structure.representation.applyPreset(n.structure,"auto");yield o.commit();const c=[];return Nu(l?.representations,u=>{u&&c.push(u)}),[...s,...c]});return function(n,r){return e.apply(this,arguments)}}()},I1t={label:"DensityServer CIF",description:"DensityServer CIF",category:zA,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>"dscif"===oO(e,t),parse:function(){var e=le(function*(t,n,r){var i;const o=yield t.build().to(n).apply(at.Data.ParseCif).commit(),s=t.build().to(o),a=o.obj.data.blocks;if(0===a.length)throw new Error("no data blocks");const l=[];let c=0;for(const u of a){if("SERVER"===u.header.toUpperCase())continue;const d=Array.isArray(r?.entryId)?r?.entryId[c]:r?.entryId;(null===(i=u.categories.volume_data_3d_info)||void 0===i?void 0:i.rowCount)>0&&(l.push(s.apply(at.Volume.VolumeFromDensityServerCif,{blockHeader:u.header,entryId:d}).selector),c++)}yield s.commit();for(const u of l)yield zP(t,u.data);return{volumes:l}});return function(n,r,i){return e.apply(this,arguments)}}(),visuals:function(){var e=le(function*(t,n){const{volumes:r}=n,i=t.build(),o=[];if(r.length>0){const s=r[0].data&&r1e(r[0].data)||mt.IsoValue.relative(1.5);o[0]=i.to(r[0]).apply(at.Representation.VolumeRepresentation3D,Eg.getDefaultParamsStatic(t,"isosurface",{isoValue:s,alpha:1},"uniform",{value:qn.teal})).selector}if(r.length>1){const s=Eg.getDefaultParamsStatic(t,"isosurface",{isoValue:mt.IsoValue.relative(3),alpha:.3},"uniform",{value:qn.green}),a=Eg.getDefaultParamsStatic(t,"isosurface",{isoValue:mt.IsoValue.relative(-3),alpha:.3},"uniform",{value:qn.red});o[o.length]=i.to(r[1]).apply(at.Representation.VolumeRepresentation3D,s).selector,o[o.length]=i.to(r[1]).apply(at.Representation.VolumeRepresentation3D,a).selector}return yield i.commit(),o});return function(n,r){return e.apply(this,arguments)}}()},E1t={label:"Segmentation CIF",description:"Segmentation CIF",category:zA,stringExtensions:["cif"],binaryExtensions:["bcif"],isApplicable:(e,t)=>"segcif"===oO(e,t),parse:function(){var e=le(function*(t,n){var r;const i=yield t.build().to(n).apply(at.Data.ParseCif).commit(),o=t.build().to(i),s=i.obj.data.blocks;if(0===s.length)throw new Error("no data blocks");const a=[];for(const l of s)"SERVER"!==l.header.toUpperCase()&&(null===(r=l.categories.volume_data_3d_info)||void 0===r?void 0:r.rowCount)>0&&a.push(o.apply(at.Volume.VolumeFromSegmentationCif,{blockHeader:l.header}).selector);return yield o.commit(),{volumes:a}});return function(n,r){return e.apply(this,arguments)}}(),visuals:function(){var e=le(function*(t,n){const{volumes:r}=n,i=t.build(),o=[];return r.length>0&&mt.Segmentation.get(r[0].data)&&(o[o.length]=i.to(r[0]).apply(at.Representation.VolumeRepresentation3D,Eg.getDefaultParams(t,"segment",r[0].data,{alpha:1,instanceGranularity:!0},"volume-segment",{})).selector),yield i.commit(),o});return function(n,r){return e.apply(this,arguments)}}()},T1t=[["ccp4",S1t],["dsn6",C1t],["cube",A1t],["dx",w1t],["dscif",I1t],["segcif",E1t]],D1t=[["ply",{label:"PLY",description:"PLY",category:"Shape",stringExtensions:["ply"],parse:function(){var e=le(function*(t,n){const r=t.state.data.build().to(n).apply(at.Data.ParsePly,{},{state:{isGhost:!0}}),i=r.apply(at.Model.ShapeFromPly);return yield r.commit(),{format:r.selector,shape:i.selector}});return function(n,r){return e.apply(this,arguments)}}(),visuals:(e,t)=>e.state.data.build().to(t.shape).apply(at.Representation.ShapeRepresentation3D).commit()}]];class P1t{get types(){return this._list.map(t=>[t.name,t.provider.label])}get extensions(){if(this._extensions)return this._extensions;const t=new Set;return this._list.forEach(({provider:n})=>{var r,i;null===(r=n.stringExtensions)||void 0===r||r.forEach(o=>t.add(o)),null===(i=n.binaryExtensions)||void 0===i||i.forEach(o=>t.add(o))}),this._extensions=t,t}get binaryExtensions(){if(this._binaryExtensions)return this._binaryExtensions;const t=new Set;return this._list.forEach(({provider:n})=>{var r;return null===(r=n.binaryExtensions)||void 0===r?void 0:r.forEach(i=>t.add(i))}),this._binaryExtensions=t,t}get options(){if(this._options)return this._options;const t=[];return this._list.forEach(({name:n,provider:r})=>t.push([n,r.label,r.category||""])),this._options=t,t}constructor(){this._list=[],this._map=new Map,this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0;for(const[t,n]of T1t)this.add(t,n);for(const[t,n]of g0t)this.add(t,n);for(const[t,n]of _0t)this.add(t,n);for(const[t,n]of D1t)this.add(t,n);for(const[t,n]of _be)this.add(t,n)}_clear(){this._extensions=void 0,this._binaryExtensions=void 0,this._options=void 0}add(t,n){this._clear(),this._list.push({name:t,provider:n}),this._map.set(t,n)}remove(t){this._clear(),this._list.splice(this._list.findIndex(n=>n.name===t),1),this._map.delete(t)}auto(t,n){var r,i;for(let o=0,s=this.list.length;o<s;++o){const a=this._list[o].provider;let l=!1;if((!(null===(r=a.binaryExtensions)||void 0===r)&&r.includes(t.ext)||!(null===(i=a.stringExtensions)||void 0===i)&&i.includes(t.ext))&&(l=!0),l&&(!a.isApplicable||a.isApplicable(t,n.data)))return a}}get(t){if(this._map.has(t))return this._map.get(t);throw new Error(`unknown data format name '${t}'`)}get list(){return this._list}}class k1t extends zy{get isEmpty(){return 0===this._animations.length}get current(){return this._current}get animations(){return this._animations}triggerUpdate(){this.events.updated.next(void 0)}triggerApply(){this.events.applied.next(void 0)}getParams(){return this._params||(this._params={current:I.Select(this._animations[0]&&this._animations[0].name,this._animations.map(t=>[t.name,t.display.name]),{label:"Animation"})}),this._params}updateParams(t){if(this.isEmpty)return;this.updateState({params:{...this.state.params,...t}});const n=this.map.get(this.state.params.current),r=n.params(this.context);this._current={anim:n,params:r,paramValues:I.getDefaultValues(r),state:{},startedTime:-1,lastTime:0},this.triggerUpdate()}updateCurrentParams(t){this.isEmpty||(this._current.paramValues={...this._current.paramValues,...t},this.triggerUpdate())}register(t){this.map.has(t.name)?this.context.log.error(`Animation '${t.name}' is already registered.`):(this._params=void 0,this.map.set(t.name,t),this._animations.push(t),1===this._animations.length?this.updateParams({current:t.name}):this.triggerUpdate())}play(t,n){var r=this;return le(function*(){yield r.stop(),r.map.has(t.name)||r.register(t),r.updateParams({current:t.name}),r.updateCurrentParams(n),yield r.start()})()}tick(t,n,r){var i=this;return le(function*(){i.currentTime=t,!i.isStopped&&(n||r?yield i.applyFrame(r):i.applyAsync())})()}start(){var t=this;return le(function*(){t.updateState({animationState:"playing"}),t.context.behaviors.state.isAnimating.value||t.context.behaviors.state.isAnimating.next(!0),t.triggerUpdate();const n=t._current.anim;let r=t._current.anim.initialState(t._current.paramValues,t.context);if(n.setup){const i=yield n.setup(t._current.paramValues,r,t.context);i&&(r=i)}t._current.lastTime=0,t._current.startedTime=-1,t._current.state=r,t.isStopped=!1})()}stop(){var t=this;return le(function*(){if(t.isStopped=!0,"stopped"!==t.state.animationState){const n=t._current.anim;n.teardown&&(yield n.teardown(t._current.paramValues,t._current.state,t.context)),t.updateState({animationState:"stopped"}),t.triggerUpdate()}t.context.behaviors.state.isAnimating.value&&t.context.behaviors.state.isAnimating.next(!1)})()}get isAnimating(){return"playing"===this.state.animationState}applyAsync(){var t=this;return le(function*(){if(!t.isApplying){t.isApplying=!0;try{yield t.applyFrame()}finally{t.isApplying=!1}}})()}applyFrame(t){var n=this;return le(function*(){const r=n.currentTime;n._current.startedTime<0&&(n._current.startedTime=r);const i=yield n._current.anim.apply(n._current.state,{lastApplied:n._current.lastTime,current:r-n._current.startedTime,animation:t},{params:n._current.paramValues,plugin:n.context});"finished"===i.kind?n.stop():"next"===i.kind&&(n._current.state=i.state,n._current.lastTime=r-n._current.startedTime),n.triggerApply()})()}getSnapshot(){return this.current?{state:this.state,current:{paramValues:this._current.paramValues,state:this._current.anim.stateSerialization?this._current.anim.stateSerialization.toJSON(this._current.state):this._current.state}}:{state:this.state}}setSnapshot(t){this.isEmpty||(this.updateState({animationState:t.state.animationState}),this.updateParams(t.state.params),t.current&&(this.current.paramValues=t.current.paramValues,this.current.state=this._current.anim.stateSerialization?this._current.anim.stateSerialization.fromJSON(t.current.state):t.current.state,this.triggerUpdate(),"playing"===this.state.animationState&&this.resume()))}resume(){var t=this;return le(function*(){t._current.lastTime=0,t._current.startedTime=-1;const n=t._current.anim;t.context.behaviors.state.isAnimating.value||t.context.behaviors.state.isAnimating.next(!0),n.setup&&(yield n.setup(t._current.paramValues,t._current.state,t.context)),t.isStopped=!1})()}constructor(t){super({params:{current:""},animationState:"stopped"}),this.context=t,this.map=new Map,this._animations=[],this.currentTime=0,this._params=void 0,this.events={updated:this.ev(),applied:this.ev()},this.isStopped=!0,this.isApplying=!1}}function i1e(e,t,n){const r=n[0],i=n[1],o=n[2];return(r*e[0]+i*e[1]+o*e[2]+(-r*t[0]-i*t[1]-o*t[2]))/Math.sqrt(r*r+i*i+o*o)}const Og={identity:In.create(1,0,0,0,1,0,0,0,1),rotX90:In.create(1,0,0,0,0,1,0,-1,0),rotY90:In.create(0,0,-1,0,1,0,1,0,0),rotZ90:In.create(0,1,0,-1,0,0,0,0,1),rotX270:In.create(1,0,0,0,0,-1,0,1,0),rotY270:In.create(0,0,1,0,1,0,-1,0,0),rotZ270:In.create(0,-1,0,1,0,0,0,0,1),rotX180:In.create(1,0,0,0,-1,0,0,0,-1),rotY180:In.create(-1,0,0,0,1,0,0,0,-1),rotZ180:In.create(-1,0,0,0,-1,0,0,0,1)};function a$(e,t){const{onlyTrace:n,skipHydrogens:r,skipWater:i}=t,{x:o,y:s,z:a,type_symbol:l,label_comp_id:c}=Je.atom,u=[];for(const d of e){const f=dt.create(d);for(const p of d.units){f.unit=p;const m=n?p.polymerElements:p.elements;for(let h=0;h<m.length;h++)f.element=m[h],(!r||"H"!==l(f))&&(i&&"HOH"===c(f)||u.push(o(f),s(f),a(f)))}}return u}function V1t(e,t){const n=Math.floor(t/2);return e<n?t%2?n-e:n-e-1:e-n}function o1e(e,t){const n=In.invert(In(),t),r=C.distance(e.position,e.target),i=C.transformMat3(C(),C.create(0,0,r),n),o=C.transformMat3(C(),C.create(0,1,0),n),s=C.add(C(),e.target,i);return{...e,position:s,up:o}}const q1t={minRadius:5,extraRadius:4,durationMs:250};class W1t{transformedLoci(t){var n,r;if(Me.is(t)){const i=null===(r=null===(n=this.plugin.helpers.substructureParent.get(t.structure))||void 0===n?void 0:n.obj)||void 0===r?void 0:r.data;i&&(t=Me.remap(t,i))}return t}focusRenderObjects(t,n){if(!t)return;const r=[];for(const i of t){const o=i.values.boundingSphere.ref.value;0!==o.radius&&r.push(o)}this.focusSpheres(r,i=>i,n)}focusLoci(t,n){let r;if(Array.isArray(t)&&t.length>1){const i=[];for(const o of t){const s=Yn.getBoundingSphere(this.transformedLoci(o));s&&i.push(s)}if(0===i.length)return;this.boundaryHelper.reset();for(const o of i)this.boundaryHelper.includeSphere(o);this.boundaryHelper.finishedIncludeStep();for(const o of i)this.boundaryHelper.radiusSphere(o);r=this.boundaryHelper.getSphere()}else if(Array.isArray(t)){if(0===t.length)return;r=Yn.getBoundingSphere(this.transformedLoci(t[0]))}else r=Yn.getBoundingSphere(this.transformedLoci(t));r&&this.focusSphere(r,n)}focusSpheres(t,n,r){const i=[];for(const o of t){const s=n(o);s&&i.push(s)}if(0!==i.length){if(1===i.length)return this.focusSphere(i[0],r);this.boundaryHelper.reset();for(const o of i)this.boundaryHelper.includeSphere(o);this.boundaryHelper.finishedIncludeStep();for(const o of i)this.boundaryHelper.radiusSphere(o);this.focusSphere(this.boundaryHelper.getSphere(),r)}}focusSphere(t,n){var r;const{canvas3d:i}=this.plugin;if(!i)return;const{extraRadius:o,minRadius:s,durationMs:a}={...q1t,...n},l=Math.max(t.radius+o,s);if(n?.principalAxes){const c=function F1t(e,t,n){if(!e.canvas3d)return;const{origin:r,dirA:i,dirB:o,dirC:s}=n.principalAxes.boxAxes,a=C.clone(i),l=C.clone(s);if(n.positionToFlip){const{aroundX:u,aroundY:d}=function R1t(e,t,n,r){const i=i1e(e,t,r);return{aroundX:i1e(e,t,n)<0,aroundY:i<0}}(n.positionToFlip,r,a,o);u&&(C.negate(l,l),C.negate(a,a)),d&&C.negate(l,l)}const c=C.scale(C(),r,-100);return C.dot(c,a)<=0&&C.negate(l,l),C.dot(C.unitY,l)<=0&&C.negate(a,a),e.canvas3d.camera.getFocus(r,t,a,l,Si.createDefaultSnapshot())}(this.plugin,l,n);null===(r=this.plugin.canvas3d)||void 0===r||r.requestCameraReset({durationMs:a,snapshot:c})}else{const c=i.camera.getFocus(t.center,l);i.requestCameraReset({durationMs:a,snapshot:c})}}orientAxes(t,n){if(!this.plugin.canvas3d)return;t||(t=this.plugin.state.data.selectQ(a=>a.ofType(Se.Molecule.Structure)).filter(a=>a.obj&&!a.transform.transformer.definition.isDecorator&&!a.obj.data.parent).map(a=>{var l;return null===(l=a.obj)||void 0===l?void 0:l.data}).filter(a=>!!a));const{rotation:r}=function B1t(e,t){const n=function j1t(e,t){let n;return n=a$(e,{onlyTrace:!0}),n.length>=3*t||(n=a$(e,{skipHydrogens:!0,skipWater:!0}),n.length>=3*t)||(n=a$(e,{})),n}(e,3);return function L1t(e,t){if(0===e.length)return console.warn("Skipping PCA, no atoms"),{rotation:Og.identity,origin:C.zero()};const n=Uh.calculateMomentsAxes(e),r=Uh.calculateNormalizedAxes(n),i=function H1t(e,t,n){const r=In();return In.setValue(r,0,0,e[0]),In.setValue(r,0,1,e[1]),In.setValue(r,0,2,e[2]),In.setValue(r,1,0,t[0]),In.setValue(r,1,1,t[1]),In.setValue(r,1,2,t[2]),In.setValue(r,2,0,n[0]),In.setValue(r,2,1,n[1]),In.setValue(r,2,2,n[2]),r}(r.dirA,r.dirB,r.dirC);!function G1t(e){In.determinant(e)<0&&(In.setValue(e,2,0,-In.getValue(e,2,0)),In.setValue(e,2,1,-In.getValue(e,2,1)),In.setValue(e,2,2,-In.getValue(e,2,2)))}(i);const o=t?function U1t(e,t){let n=Og.identity,r=0;const i=In();for(const o of[Og.identity,Og.rotX180,Og.rotY180,Og.rotZ180]){const s=In.innerProduct(In.mul(i,o,e),t);s>r&&(n=o,r=s)}return n}(i,t):function z1t(e,t,n){const r=C.create(In.getValue(t,0,0),In.getValue(t,0,1),In.getValue(t,0,2)),i=C.create(In.getValue(t,1,0),In.getValue(t,1,1),In.getValue(t,1,2)),o=C.create(In.getValue(t,2,0),In.getValue(t,2,1),In.getValue(t,2,2)),s=Math.floor(e.length/3),a=C();let l=0,c=0,u=0;for(let p=0;p<s;p++)C.fromArray(a,e,3*p),C.sub(a,a,n),l+=p*C.dot(a,r),c+=p*C.dot(a,i),u+=V1t(p,s)*C.dot(a,o);const d=u<0,f=d?l+c<0:l-c<0;return f&&d?Og.rotY180:d?Og.rotX180:f?Og.rotZ180:Og.identity}(e,i,n.origin);return In.mul(i,o,i),{rotation:i,origin:r.origin}}(n,t)}(t),i=o1e(this.plugin.canvas3d.camera.getSnapshot(),r);this.setSnapshot(i,n)}resetAxes(t){if(!this.plugin.canvas3d)return;const n=o1e(this.plugin.canvas3d.camera.getSnapshot(),In.Identity);this.setSnapshot(n,t)}setSnapshot(t,n){var r;null===(r=this.plugin.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t,durationMs:n})}reset(t,n){var r;null===(r=this.plugin.canvas3d)||void 0===r||r.requestCameraReset({snapshot:t,durationMs:n})}constructor(t){this.plugin=t,this.boundaryHelper=new xf("98")}}class eb extends zy{get props(){return{...this.state.props}}setProps(t){const r={...this.state.props,...t};FR(this.props,r)||(this.updateState({props:r}),this.lociSelects.setProps(r),this.lociHighlights.setProps(r),this.events.propsUpdated.next(void 0))}dispose(){super.dispose(),this.lociSelects.dispose(),this.lociHighlights.dispose()}constructor(t,n={}){super({props:{...I.getDefaultValues(eb.Params),...n}}),this.plugin=t,this._props=I.getDefaultValues(eb.Params),this.events={propsUpdated:this.ev()},this.lociSelects=new eb.LociSelectManager(t,this._props),this.lociHighlights=new eb.LociHighlightManager(t,this._props)}}!function(e){e.Params={granularity:I.Select("residue",Yn.GranularityOptions,{label:"Picking Level",description:"Controls if selections are expanded upon picking to whole residues, chains, structures, instances, or left as atoms and coarse elements"})};class t{setProps(o){Object.assign(this.props,o)}addProvider(o){this.providers.push(o)}removeProvider(o){this.providers=this.providers.filter(s=>s!==o)}normalizedLoci(o,s,a=!1){const{loci:l,repr:c}=o;return{loci:Yn.normalize(l,s?this.props.granularity:void 0,a),repr:c}}mark(o,s,a=!1){if(!Yn.isEmpty(o.loci))for(const l of this.providers)l(o,s,a)}dispose(){this.providers.length=0,this.sel.dispose()}constructor(o,s={}){this.ctx=o,this.providers=[],this.props=I.getDefaultValues(e.Params),this.sel=o.managers.structure.selection,this.setProps(s)}}e.LociMarkManager=t,e.LociHighlightManager=class n extends t{constructor(){super(...arguments),this.prev=[],this.clearHighlights=(o=!1)=>{for(const s of this.prev)this.mark(s,un.RemoveHighlight,o);this.prev.length=0}}isHighlighted(o){for(const s of this.prev)if(Xn.Loci.areEqual(s,o))return!0;return!1}addHighlight(o){this.mark(o,un.Highlight),this.prev.push(o)}highlight(o,s=!0){const a=this.normalizedLoci(o,s);this.isHighlighted(a)||this.addHighlight(a)}highlightOnly(o,s=!0){const a=this.normalizedLoci(o,s);this.isHighlighted(a)||(Yn.isEmpty(a.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(a)))}highlightOnlyExtend(o,s=!0){const a=this.normalizedLoci(o,s);if(Me.is(a.loci)){const l={loci:this.sel.tryGetRange(a.loci)||a.loci,repr:a.repr};this.isHighlighted(l)||(Yn.isEmpty(l.loci)?this.clearHighlights():(this.clearHighlights(!0),this.addHighlight(l)))}}dispose(){super.dispose(),this.prev.length=0}},e.LociSelectManager=class r extends t{toggle(o,s=!0){if(Yn.isEmpty(o.loci))return;const a=this.normalizedLoci(o,s,!0);Me.is(a.loci)?this.toggleSel(a):super.mark(a,un.Toggle)}toggleExtend(o,s=!0){if(Yn.isEmpty(o.loci))return;const a=this.normalizedLoci(o,s,!0);if(Me.is(a.loci)){const l=this.sel.tryGetRange(a.loci)||a.loci;this.toggleSel({loci:l,repr:a.repr})}}select(o,s=!0){const a=this.normalizedLoci(o,s,!0);Me.is(a.loci)&&this.sel.modify("add",a.loci),this.mark(a,un.Select)}selectJoin(o,s=!0){const a=this.normalizedLoci(o,s,!0);Me.is(a.loci)&&this.sel.modify("intersect",a.loci),this.mark(a,un.Select)}selectOnly(o,s=!0){const a=this.normalizedLoci(o,s,!0);Me.is(a.loci)&&(this.mark({loci:Xe.Loci(a.loci.structure),repr:a.repr},un.Deselect),this.sel.modify("set",a.loci)),this.mark(a,un.Select)}deselect(o,s=!0){const a=this.normalizedLoci(o,s,!0);Me.is(a.loci)&&this.sel.modify("remove",a.loci),this.mark(a,un.Deselect)}deselectAll(){this.sel.clear(),this.mark({loci:KN},un.Deselect)}deselectAllOnEmpty(o){uu(o.loci)&&this.deselectAll()}mark(o,s){const{loci:a}=o;if(!Yn.isEmpty(a))if(Me.is(a)){const l=this.sel.getLoci(a.structure);super.mark({loci:Xe.Loci(a.structure)},un.Deselect,!Yn.isEmpty(l)),super.mark({loci:l},un.Select)}else super.mark(o,s)}toggleSel(o){this.sel.has(o.loci)?(this.sel.modify("remove",o.loci),this.mark(o,un.Deselect)):(this.sel.modify("add",o.loci),this.mark(o,un.Select))}}}(eb||(eb={}));class $1t{clearProviders(){this.providers=[],this.isDirty=!0,this.showLabels()}addProvider(t){this.providers.push(t),this.providers.sort((n,r)=>(r.priority||0)-(n.priority||0)),this.isDirty=!0,this.showLabels()}removeProvider(t){this.providers=this.providers.filter(n=>n!==t),this.isDirty=!0,this.showLabels()}mark(t,n){const r=this.locis.findIndex(i=>Xn.Loci.areEqual(t,i));-1===r&&n===un.Highlight?(this.locis.push(t),this.isDirty=!0):-1!==r&&n===un.RemoveHighlight&&(h3(this.locis,r),this.isDirty=!0)}showLabels(){this.ctx.behaviors.labels.highlight.next({labels:this.getLabels()})}getLabels(){if(this.isDirty){this.groupedLabels.clear(),this.labels.length=0;for(const t of this.providers)for(const n of this.locis){if(Yn.isEmpty(n.loci))continue;const r=t.label(n.loci,n.repr);if(r){const i=t.group?t.group(r):r.toString(),o=this.groupedLabels.get(i);o?o.push(r):this.groupedLabels.set(i,[r])}}this.labels.length=0,this.groupedLabels.forEach((t,n)=>{const r=t.length,i=r>1&&t[0]!==t[1]?n:t[0];this.labels.push(1===r?i:`${i} <small>|| \xd7 ${r}</small>`)}),this.isDirty=!1}return this.labels}constructor(t){this.ctx=t,this.providers=[],this.locis=[],this.isDirty=!1,this.labels=[],this.groupedLabels=new Map,t.managers.interactivity.lociHighlights.addProvider((n,r,i)=>{0!==this.providers.length&&(this.mark(n,r),i||this.showLabels())})}}const s1e="overpaint-controls";function a1e(e,t,n,r,i){return l$.apply(this,arguments)}function l$(){return l$=le(function*(e,t,n,r,i){yield function l1e(e,t,n){return u$.apply(this,arguments)}(e,t,function(){var o=le(function*(s,a,l){if(i&&i.length>0&&!i.includes(a.params.values.type.name))return;const c=a.obj.data.sourceData,u=yield r(c.root);if(Yn.isEmpty(u)||uu(u))return;const d={bundle:Qr.fromLoci(u),color:-1===n?st(0):n,clear:-1===n};if(l){const p=c1e([...l.params.values.layers,d],c);s.to(l).update(Ea.toBundle(p))}else{const f=c1e([d],c);s.to(a.transform.ref).apply(at.Representation.OverpaintStructureRepresentation3DFromBundle,Ea.toBundle(f),{tags:s1e})}});return function(s,a,l){return o.apply(this,arguments)}}())}),l$.apply(this,arguments)}function u$(){return u$=le(function*(e,t,n){const r=e.state.data,i=r.build();for(const o of t)for(const s of o.representations){const a=r.select(Qn.Generators.ofTransformer(at.Representation.OverpaintStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(s1e));yield n(i,s.cell,a[0])}return i.commit({doNotUpdateCurrent:!0})}),u$.apply(this,arguments)}function c1e(e,t){const n=Ea.ofBundle(e,t.root),r=Ea.merge(n);return Ea.filter(r,t)}const u1e="clipping-controls";function Y1t(e,t,n,r,i){return d$.apply(this,arguments)}function d$(){return d$=le(function*(e,t,n,r,i){yield function X1t(e,t,n){return f$.apply(this,arguments)}(e,t,function(){var o=le(function*(s,a,l){if(i&&i.length>0&&!i.includes(a.params.values.type.name))return;const c=a.obj.data.sourceData,u=yield r(c.root);if(Yn.isEmpty(u)||uu(u))return;const d={bundle:Qr.fromLoci(u),groups:n};if(l){const p=d1e([...l.params.values.layers,d],c);s.to(l).update(co.toBundle(p))}else{const f=d1e([d],c);s.to(a.transform.ref).apply(at.Representation.ClippingStructureRepresentation3DFromBundle,co.toBundle(f),{tags:u1e})}});return function(s,a,l){return o.apply(this,arguments)}}())}),d$.apply(this,arguments)}function f$(){return f$=le(function*(e,t,n){const r=e.state.data,i=r.build();for(const o of t)for(const s of o.representations){const a=r.select(Qn.Generators.ofTransformer(at.Representation.ClippingStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(u1e));yield n(i,s.cell,a[0])}return i.commit({doNotUpdateCurrent:!0})}),f$.apply(this,arguments)}function d1e(e,t){const n=co.ofBundle(e,t.root),r=co.merge(n);return co.filter(r,t)}const f1e="transparency-controls";function K1t(e,t,n,r,i){return p$.apply(this,arguments)}function p$(){return p$=le(function*(e,t,n,r,i){yield function p1e(e,t,n){return m$.apply(this,arguments)}(e,t,function(){var o=le(function*(s,a,l){if(i&&i.length>0&&!i.includes(a.params.values.type.name))return;const c=a.obj.data.sourceData,u=yield r(c.root);if(Yn.isEmpty(u)||uu(u))return;const d={bundle:Qr.fromLoci(u),value:n};if(l){const p=h1e([...l.params.values.layers,d],c);s.to(l).update(dc.toBundle(p))}else{const f=h1e([d],c);s.to(a.transform.ref).apply(at.Representation.TransparencyStructureRepresentation3DFromBundle,dc.toBundle(f),{tags:f1e})}});return function(s,a,l){return o.apply(this,arguments)}}())}),p$.apply(this,arguments)}function m$(){return m$=le(function*(e,t,n){const r=e.state.data,i=r.build();for(const o of t)for(const s of o.representations){const a=r.select(Qn.Generators.ofTransformer(at.Representation.TransparencyStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(f1e));yield n(i,s.cell,a[0])}return i.commit({doNotUpdateCurrent:!0})}),m$.apply(this,arguments)}function h1e(e,t){const n=dc.ofBundle(e,t.root),r=dc.merge(n);return dc.filter(r,t)}const m1e="substance-controls";function g1e(e,t,n,r,i){return g$.apply(this,arguments)}function g$(){return g$=le(function*(e,t,n,r,i){yield function y1e(e,t,n){return b$.apply(this,arguments)}(e,t,function(){var o=le(function*(s,a,l){if(i&&i.length>0&&!i.includes(a.params.values.type.name))return;const c=a.obj.data.sourceData,u=yield r(c.root);if(Yn.isEmpty(u)||uu(u))return;const d={bundle:Qr.fromLoci(u),material:n??tu(),clear:!n};if(l){const p=b1e([...l.params.values.layers,d],c);s.to(l).update(fc.toBundle(p))}else{const f=b1e([d],c);s.to(a.transform.ref).apply(at.Representation.SubstanceStructureRepresentation3DFromBundle,fc.toBundle(f),{tags:m1e})}});return function(s,a,l){return o.apply(this,arguments)}}())}),g$.apply(this,arguments)}function b$(){return b$=le(function*(e,t,n){const r=e.state.data,i=r.build();for(const o of t)for(const s of o.representations){const a=r.select(Qn.Generators.ofTransformer(at.Representation.SubstanceStructureRepresentation3DFromBundle,s.cell.transform.ref).withTag(m1e));yield n(i,s.cell,a[0])}return i.commit({doNotUpdateCurrent:!0})}),b$.apply(this,arguments)}function b1e(e,t){const n=fc.ofBundle(e,t.root),r=fc.merge(n);return fc.filter(r,t)}class Bg extends zy{get currentStructures(){return this.plugin.managers.structure.hierarchy.selection.structures}get pivotStructure(){return this.currentStructures[0]}_setSnapshotState(t){this.updateState({options:t}),this.events.optionsUpdated.next(void 0)}setOptions(t){var n=this;return le(function*(){const r=t.interactions!==n.state.options.interactions;n.updateState({options:t}),n.events.optionsUpdated.next(void 0);const i=n.dataState.build();for(const o of n.currentStructures)for(const s of o.components)n.updateReprParams(i,s);return n.plugin.dataTransaction(le(function*(){yield i.commit(),yield n.plugin.state.updateBehavior(iO,o=>{o.ignoreHydrogens="all"!==t.hydrogens,o.ignoreHydrogensVariant="only-polar"===t.hydrogens?"non-polar":"all",o.ignoreLight=t.ignoreLight,o.material=t.materialStyle,o.clip=t.clipObjects}),r&&(yield n.updateInterationProps())}))})()}updateReprParams(t,n){const{hydrogens:r,visualQuality:i,ignoreLight:o,materialStyle:s,clipObjects:a}=this.state.options,l="all"!==r,c="only-polar"===r?"non-polar":"all";for(const u of n.representations){if(u.cell.transform.transformer!==hF)continue;const d=u.cell.transform.params;(!!d.type.params.ignoreHydrogens!==l||d.type.params.ignoreHydrogensVariant!==c||d.type.params.quality!==i||d.type.params.ignoreLight!==o||!l3(d.type.params.material,s)||!I.areEqual(H1.Params,d.type.params.clip,a))&&t.to(u.cell).update(f=>{f.type.params.ignoreHydrogens=l,f.type.params.ignoreHydrogensVariant=c,f.type.params.quality=i,f.type.params.ignoreLight=o,f.type.params.material=s,f.type.params.clip=a})}}updateInterationProps(){var t=this;return le(function*(){var n,r,i;for(const o of t.currentStructures){const s=ks.getParams(null===(n=o.cell.obj)||void 0===n?void 0:n.data);if(o.properties){const a=null===(r=o.properties.cell.transform.params)||void 0===r?void 0:r.properties[ks.descriptor.name];if(I.areEqual(s,a,t.state.options.interactions))continue;yield t.dataState.build().to(o.properties.cell).update(l=>{l.properties[ks.descriptor.name]=t.state.options.interactions}).commit()}else{const a=t.plugin.customStructureProperties.getParams(null===(i=o.cell.obj)||void 0===i?void 0:i.data),l=I.getDefaultValues(a);if(I.areEqual(s,l.properties[ks.descriptor.name],t.state.options.interactions))continue;l.properties[ks.descriptor.name]=t.state.options.interactions,yield t.plugin.builders.structure.insertStructureProperties(o.cell,l)}}})()}applyPreset(t,n,r){var i=this;return this.plugin.dataTransaction(le(function*(){for(const o of t){const s=yield i.plugin.builders.structure.representation.applyPreset(o.cell,n,r);yield i.syncPreset(o,s)}}),{canUndo:"Preset"})}syncPreset(t,n){if(!n||!n.components)return this.clearComponents([t]);const r=new Set;if(Nu(n.components,a=>{a&&r.add(a.ref)}),n.representations&&Nu(n.representations,a=>{a&&r.add(a.ref)}),0===r.size)return this.clearComponents([t]);let i=!1;const o=this.dataState.build(),s=a=>{r.has(a.cell.transform.ref)||(i=!0,o.delete(a.cell))};for(const a of t.components){s(a);for(const l of a.representations)s(l);if(a.genericRepresentations)for(const l of a.genericRepresentations)s(l)}if(t.genericRepresentations)for(const a of t.genericRepresentations)s(a);return i?o.commit():void 0}clear(t){return this.clearComponents(t)}selectThis(t){var n;const r=this.plugin.managers.structure.selection;r.clear();for(const i of t){const o=Xe.toSubStructureElementLoci(i.structure.cell.obj.data,null===(n=i.cell.obj)||void 0===n?void 0:n.data);r.fromLoci("set",o)}}canBeModified(t){return this.plugin.builders.structure.isComponentTransform(t.cell)}modifyByCurrentSelection(t,n){var r=this;return this.plugin.runTask(Ke.create("Modify Component",function(){var i=le(function*(o){const s=r.dataState.build();for(const a of t){if(!r.canBeModified(a))continue;const l=r.plugin.managers.structure.selection.getStructure(a.structure.cell.obj.data);!l||0===l.elementCount||r.modifyComponent(s,a,l,n)}yield r.dataState.updateTree(s,{canUndo:"Modify Selection"}).runInContext(o)});return function(o){return i.apply(this,arguments)}}()))}toggleVisibility(t,n){if(0!==t.length)if(n){const r=t[0].representations.indexOf(n),i=!n.cell.state.isHidden;for(const o of t){const s=o.representations[r];s&&G_(this.dataState,s.cell.transform.ref,i)}}else{const r=!t[0].cell.state.isHidden;for(const i of t)G_(this.dataState,i.cell.transform.ref,r)}}removeRepresentations(t,n){if(0===t.length)return;const r=[];if(n){const i=t[0].representations.indexOf(n);if(i<0)return;for(const o of t)o.representations[i]&&r.push(o.representations[i])}else for(const i of t)for(const o of i.representations)r.push(o);return this.plugin.managers.structure.hierarchy.remove(r,!0)}updateRepresentations(t,n,r){if(0===t.length)return Promise.resolve();const i=t[0].representations.indexOf(n);if(i<0)return Promise.resolve();const o=this.dataState.build();for(const s of t){const a=s.representations[i];a&&a.cell.transform.transformer===n.cell.transform.transformer&&o.to(a.cell).update(r)}return o.commit({canUndo:"Update Representation"})}updateRepresentationsTheme(t,n){var r,i,o,s;if(0===t.length)return;const a=this.dataState.build();for(const l of t)for(const c of l.representations){const u=c.cell.transform.params,d="function"==typeof n?n(l,c):n,f="default"===d.color?TW(this.plugin,null===(r=l.structure.cell.obj)||void 0===r?void 0:r.data,u?.type.name):d.color?TW(this.plugin,null===(i=l.structure.cell.obj)||void 0===i?void 0:i.data,u?.type.name,d.color,d.colorParams):void 0,p="default"===d.size?pbe(this.plugin,null===(o=l.structure.cell.obj)||void 0===o?void 0:o.data,u?.type.name):d.color?pbe(this.plugin,null===(s=l.structure.cell.obj)||void 0===s?void 0:s.data,u?.type.name,d.size,d.sizeParams):void 0;(f||p)&&a.to(c.cell).update(m=>{f&&(m.colorTheme=f),p&&(m.sizeTheme=p)})}return a.commit({canUndo:"Update Theme"})}addRepresentation(t,n){var r=this;if(0===t.length)return;const{hydrogens:i,visualQuality:o,ignoreLight:s,materialStyle:a,clipObjects:l}=this.state.options,d={ignoreHydrogens:"all"!==i,ignoreHydrogensVariant:"only-polar"===i?"non-polar":"all",quality:o,ignoreLight:s,material:a,clip:l};return this.plugin.dataTransaction(le(function*(){for(const f of t)yield r.plugin.builders.structure.representation.addRepresentation(f.cell,{type:r.plugin.representation.structure.registry.get(n),typeParams:d})}),{canUndo:"Add Representation"})}tryFindComponent(t,n){var r=this;if(0!==t.components.length)return this.plugin.runTask(Ke.create("Find Component",function(){var i=le(function*(o){var s,a;const l=null===(s=t.cell.obj)||void 0===s?void 0:s.data;if(!l)return;const c=Dt.unionStructure(yield n.getSelection(r.plugin,o,l));for(const u of t.components){const d=null===(a=u.cell.obj)||void 0===a?void 0:a.data;if(d&&u.cell.parent&&Uje(c,d))return u.cell}});return function(o){return i.apply(this,arguments)}}()))}add(t,n){var r=this;return le(function*(){return r.plugin.dataTransaction(le(function*(){const i=n||r.currentStructures;if(0===i.length)return;const{hydrogens:o,visualQuality:s,ignoreLight:a,materialStyle:l,clipObjects:c}=r.state.options,f={ignoreHydrogens:"all"!==o,ignoreHydrogensVariant:"only-polar"===o?"non-polar":"all",quality:s,ignoreLight:a,material:l,clip:c},p=oo.create22();for(const m of i){let h;t.options.checkExisting&&(h=yield r.tryFindComponent(m,t.selection)),h||(h=yield r.plugin.builders.structure.tryCreateComponentFromSelection(m.cell,t.selection,p,{label:t.options.label||(t.selection===Ps.current?"Custom Selection":"")})),"none"!==t.representation&&h&&(yield r.plugin.builders.structure.representation.addRepresentation(h,{type:r.plugin.representation.structure.registry.get(t.representation),typeParams:f}))}}),{canUndo:"Add Selection"})})()}applyTheme(t,n){var r=this;return le(function*(){return r.plugin.dataTransaction(function(){var i=le(function*(o){const s=n||r.currentStructures;if(0===s.length)return;const a=function(){var l=le(function*(c){return Dt.toLociWithSourceUnits(yield t.selection.getSelection(r.plugin,o,c))});return function(u){return l.apply(this,arguments)}}();for(const l of s)if("color"===t.action.name){const c=t.action.params;yield a1e(r.plugin,l.components,c.color,a,t.representations)}else if("resetColor"===t.action.name)yield a1e(r.plugin,l.components,-1,a,t.representations);else if("transparency"===t.action.name){const c=t.action.params;yield K1t(r.plugin,l.components,c.value,a,t.representations)}else if("material"===t.action.name){const c=t.action.params;yield g1e(r.plugin,l.components,c.material,a,t.representations)}else if("resetMaterial"===t.action.name)yield g1e(r.plugin,l.components,void 0,a,t.representations);else if("clipping"===t.action.name){const c=t.action.params;yield Y1t(r.plugin,l.components,co.Groups.fromNames(c.excludeGroups),a,t.representations)}});return function(o){return i.apply(this,arguments)}}(),{canUndo:"Apply Theme"})})()}modifyComponent(t,n,r,i){var o,s,a;const l=null===(o=n.cell.obj)||void 0===o?void 0:o.data;if(!l||("subtract"===i||"intersect"===i)&&!d5(l,r))return;const c=null===(s=n.structure.cell.obj)||void 0===s?void 0:s.data,u="union"===i?R3(c,[l,r]):"intersect"===i?sae(l,r):_z(l,r);if(0===u.elementCount)t.delete(n.cell.transform.ref);else{const f={type:{name:"bundle",params:Qr.fromSubStructure(c,u)},nullIfEmpty:!0,label:null===(a=n.cell.obj)||void 0===a?void 0:a.label};t.to(n.cell).update(f)}}updateLabel(t,n){var r,i;const o={type:null===(r=t.cell.params)||void 0===r?void 0:r.values.type,nullIfEmpty:null===(i=t.cell.params)||void 0===i?void 0:i.values.nullIfEmpty,label:n};this.dataState.build().to(t.cell).update(o).commit()}get dataState(){return this.plugin.state.data}clearComponents(t){const n=this.dataState.build();for(const r of t)for(const i of r.components)n.delete(i.cell.transform.ref);return n.commit({canUndo:"Clear Selections"})}constructor(t){super({options:I.getDefaultValues(Bg.OptionsParams)}),this.plugin=t,this.events={optionsUpdated:this.ev()}}}!function(e){function r(o,s){var a,l;return null!==(a=s?.cell.obj)&&void 0!==a&&a.data?o.representation.structure.registry.getApplicableTypes(null===(l=s.cell.obj)||void 0===l?void 0:l.data):o.representation.structure.registry.types}function i(o,s,a,l){const c=[...a,...r(o,s)];return I.Select(c[0][0],c,{label:l})}e.OptionsParams={hydrogens:I.Select("all",[["all","Show All"],["hide-all","Hide All"],["only-polar","Only Polar"]],{description:"Determine display of hydrogen atoms in representations"}),visualQuality:I.Select("auto",D9,{description:"Control the visual/rendering quality of representations"}),ignoreLight:I.Boolean(!1,{description:"Ignore light for stylized rendering of representations"}),materialStyle:tu.getParam(),clipObjects:I.Group(H1.Params),interactions:I.Group(ks.defaultParams,{label:"Non-covalent Interactions"})},e.getAddParams=function t(o,s){const{options:a}=o.query.structure.registry;return s={pivot:o.managers.structure.component.pivotStructure,allowNone:!0,hideSelection:!1,checkExisting:!1,...s},{selection:I.Select(a[1][0],a,{isHidden:s?.hideSelection}),representation:i(o,s?.pivot,s?.allowNone?[["none","< Create Later >"]]:[]),options:I.Group({label:I.Text(""),checkExisting:I.Boolean(!!s?.checkExisting,{help:()=>({description:"Checks if a selection with the specifield elements already exists to avoid creating duplicate components."})})})}},e.getThemeParams=function n(o,s){const{options:a}=o.query.structure.registry;return{selection:I.Select(a[1][0],a,{isHidden:!1}),action:I.MappedStatic("color",{color:I.Group({color:I.Color(qn.blue,{isExpanded:!0})},{isFlat:!0}),resetColor:I.EmptyGroup({label:"Reset Color"}),transparency:I.Group({value:I.Numeric(.5,{min:0,max:1,step:.01})},{isFlat:!0}),material:I.Group({material:tu.getParam({isFlat:!0})},{isFlat:!0}),resetMaterial:I.EmptyGroup({label:"Reset Material"}),clipping:I.Group({excludeGroups:I.MultiSelect([],I.objectToOptions(co.Groups.Names))},{isFlat:!0})}),representations:I.MultiSelect([],r(o,s),{emptyValue:"All"})}},e.getRepresentationTypes=r}(Bg||(Bg={}));class Q1t extends zy{get current(){return this.state.current}get history(){return this.state.history}tryAddHistory(t){if(Me.isEmpty(t.loci))return;let r,n=0;for(const i of this.state.history){if(Me.areEqual(i.loci,t.loci)){r=i;break}n++}if(r)return h3(this.state.history,n),this.state.history.unshift(t),void this.events.historyUpdated.next(void 0);this.state.history.unshift(t),this.state.history.length>8&&this.state.history.pop(),this.events.historyUpdated.next(void 0)}set(t){this.tryAddHistory(t),(!this.state.current||!Me.areEqual(this.state.current.loci,t.loci))&&(this.state.current=t,this.behaviors.current.next(t))}setFromLoci(t){const n=Yn.normalize(t);Me.is(n)&&!Me.isEmpty(n)?this.set({loci:n,label:L_(n,{reverse:!0,hidePrefix:!0,htmlStyling:!1})}):this.clear()}addFromLoci(t){const n=this.state.current&&Me.is(t)&&t.structure===this.state.current.loci.structure?Me.union(t,this.state.current.loci):t;this.setFromLoci(n)}clear(){this.state.current&&(this.state.current=void 0,this.behaviors.current.next(void 0))}getSnapshot(){if(!this.current)return{};const t=this.plugin.helpers.substructureParent.get(this.current.loci.structure),n=t?.transform.ref;return n?{current:{label:this.current.label,ref:n,bundle:Qr.fromLoci(this.current.loci),category:this.current.category}}:{}}setSnapshot(t){var n,r;if(!t.current)return void this.clear();const{label:i,ref:o,bundle:s,category:a}=t.current,l=null===(r=null===(n=this.plugin.state.data.select(Qn.Generators.byRef(o))[0])||void 0===n?void 0:n.obj)||void 0===r?void 0:r.data;if(!l)return;const c=Qr.toLoci(s,l);this.set({label:i,loci:c,category:a})}constructor(t){super({history:[]}),this.plugin=t,this.events={historyUpdated:this.ev()},this.behaviors={current:this.ev.behavior(void 0)},t.state.data.events.object.removed.subscribe(({obj:r})=>{var i;if(!Se.Molecule.Structure.is(r))return;(null===(i=this.current)||void 0===i?void 0:i.loci.structure)===r.data&&this.clear();const o=[];for(const s of this.history)s.loci.structure===r.data&&o.push(s);o.length!==this.history.length&&(this.history.length=0,this.history.push(...o),this.events.historyUpdated.next(void 0))});const n=ke();t.state.data.events.object.updated.subscribe(({oldData:r,obj:i,action:o})=>{var s;if(Se.Molecule.Structure.is(i)&&r!==i.data&&"in-place"===o){const a=this.state.current;if(a&&a.loci.structure===r){const c=Me.remap(a.loci,i.data);this.state.current={...a,loci:c},this.behaviors.current.next(this.state.current),Yn.getBoundingSphere(c,n);const u=null===(s=this.plugin.canvas3d)||void 0===s?void 0:s.camera,d=u.getTargetDistance(n.radius+4);(C.distance(u.target,n.center)>n.radius||d>u.viewport.height/u.zoom)&&this.plugin.managers.camera.focusSphere(n,{durationMs:0})}}})}}function v$(){return{trajectories:[],models:[],structures:[],refs:new Map}}function evt(e){return{kind:"trajectory",cell:e,version:e.transform.version,models:[]}}function v1e(e,t){return{kind:"model",cell:e,version:e.transform.version,trajectory:t,structures:[]}}function tvt(e,t){return{kind:"model-properties",cell:e,version:e.transform.version,model:t}}function nvt(e,t){return{kind:"model-unitcell",cell:e,version:e.transform.version,model:t}}function x1e(e,t){return{kind:"structure",cell:e,version:e.transform.version,model:t,components:[]}}function rvt(e,t){return{kind:"structure-properties",cell:e,version:e.transform.version,structure:t}}function ivt(e,t){return{kind:"structure-transform",cell:e,version:e.transform.version,structure:t}}function ovt(e,t){return{kind:"structure-volume-streaming",cell:e,version:e.transform.version,structure:t}}function svt(e){return e.transform.tags?[...e.transform.tags].sort().join():e.transform.ref}function avt(e,t){return{kind:"structure-component",cell:e,version:e.transform.version,structure:t,key:svt(e),representations:[]}}function lvt(e,t){return{kind:"structure-representation",cell:e,version:e.transform.version,component:t}}function cvt(e,t){return{kind:"generic-representation",cell:e,version:e.transform.version,parent:t}}function VA(e,t,n,r,...i){const o=r(...i);n.push(o),e.hierarchy.refs.set(t.transform.ref,o);const s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function p2(e,t,n,...r){const i=n(...r);e.hierarchy.refs.set(t.transform.ref,i);const o=e.oldHierarchy.refs.get(t.transform.ref);return o?o.version!==t.transform.version&&(e.changed=!0):(e.added.add(i.cell.transform.ref),e.changed=!0),i}function _1e(e){return t=>e.is(t.obj)}function S1e(e,t){return(n,r)=>!t(r)&&e.is(n.obj)}function _O(e){return t=>t.transform.transformer===e}function h2(){}const dvt=[[_1e(Se.Molecule.Trajectory),(e,t)=>{e.currentTrajectory=VA(e,t,e.hierarchy.trajectories,evt,t)},e=>e.currentTrajectory=void 0],[S1e(Se.Molecule.Model,e=>e.currentModel),(e,t)=>{e.currentModel=e.currentTrajectory?VA(e,t,e.currentTrajectory.models,v1e,t,e.currentTrajectory):p2(e,t,v1e,t),e.hierarchy.models.push(e.currentModel)},e=>e.currentModel=void 0],[_O(at.Model.CustomModelProperties),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.properties=p2(e,t,tvt,t,e.currentModel)},h2],[_O(at.Representation.ModelUnitcell3D),(e,t)=>{if(!e.currentModel)return!1;e.currentModel.unitcell=p2(e,t,nvt,t,e.currentModel)},h2],[S1e(Se.Molecule.Structure,e=>e.currentStructure),(e,t)=>{e.currentStructure=e.currentModel?VA(e,t,e.currentModel.structures,x1e,t,e.currentModel):p2(e,t,x1e,t),e.hierarchy.structures.push(e.currentStructure)},e=>e.currentStructure=void 0],[_O(at.Model.CustomStructureProperties),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.properties=p2(e,t,rvt,t,e.currentStructure)},h2],[_O(at.Model.TransformStructureConformation),(e,t)=>{if(!e.currentStructure)return!1;e.currentStructure.transform=p2(e,t,ivt,t,e.currentStructure)},h2],[_1e(fu),(e,t)=>(e.currentStructure&&(e.currentStructure.volumeStreaming=p2(e,t,ovt,t,e.currentStructure)),!1),h2],[(e,t)=>!(t.currentComponent||!t.currentStructure||e.transform.transformer.definition.isDecorator)&&Se.Molecule.Structure.is(e.obj),(e,t)=>{e.currentStructure&&(e.currentComponent=VA(e,t,e.currentStructure.components,avt,t,e.currentStructure))},e=>e.currentComponent=void 0],[(e,t)=>!e.state.isGhost&&!!t.currentComponent&&Se.Molecule.Structure.Representation3D.is(e.obj),(e,t)=>(e.currentComponent&&VA(e,t,e.currentComponent.representations,lvt,t,e.currentComponent),!1),h2],[e=>!e.state.isGhost&&Se.isRepresentation3D(e.obj),(e,t)=>{const n=e.currentComponent||e.currentStructure||e.currentModel;n&&(n.genericRepresentations||(n.genericRepresentations=[]),VA(e,t,n.genericRepresentations,cvt,t,n))},h2]];function C1e(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;const{obj:t}=e;return!(!t||t===vo.Null||"ok"!==e.status&&"error"!==e.status)}function fvt(e){const{cell:t}=e;C1e(t)||(this.changed=!0)}function pvt(e){w1e(this,this.tree.transforms.get(e))}function w1e(e,t){const{state:n}=e,r=n.state.cells.get(t.ref);if(!C1e(r))return;let i,o=!1;for(const[a,l,c]of dvt)if(a(r,n)){if(!1===l(n,r)){o=!0;break}i=c;break}if(o)return;const s=e.tree.children.get(t.ref);s&&s.size&&s.forEach(pvt,e),i&&i(n)}class m2 extends wP{get dataState(){return this.plugin.state.data}get currentComponentGroups(){return this._currentComponentGroups||(this._currentComponentGroups=m2.getComponentGroups(this.selection.structures)),this._currentComponentGroups}get seletionSet(){if(this._currentSelectionSet)return this._currentSelectionSet;this._currentSelectionSet=new Set;for(const t of this.selection.trajectories)this._currentSelectionSet.add(t.cell.transform.ref);for(const t of this.selection.models)this._currentSelectionSet.add(t.cell.transform.ref);for(const t of this.selection.structures)this._currentSelectionSet.add(t.cell.transform.ref);return this._currentSelectionSet}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}getStructuresWithSelection(){const t=this.plugin.managers.structure.hierarchy.current.structures,n=[];for(const r of t)this.plugin.managers.structure.selection.structureHasSelection(r)&&n.push(r);return n}findStructure(t){if(!t)return;const n=this.plugin.helpers.substructureParent.get(t);if(!n)return;const r=this.plugin.state.data.selectQ(i=>i.byValue(n).rootOfType(Se.Molecule.Structure))[0];return r?this.behaviors.selection.value.structures.find(i=>i.cell===r):void 0}syncCurrent(t,n){const r=this.seletionSet,i=[];for(const o of t){const s=o.cell.transform.ref;(r.has(s)||n.has(s))&&i.push(o)}return 0===i.length?t.length>0?[t[0]]:[]:i}sync(t){if(!t&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree)return void(t&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,...this.state.selection})));this.state.syncedTree=this.dataState.tree;const n=function J1t(e,t){const n=function uvt(e,t){return{state:e,oldHierarchy:t,hierarchy:v$(),changed:!1,added:new Set}}(e,t||v$());return function hvt(e,t){w1e({tree:e,state:t},e.root)}(e.tree,n),t&&t.refs.forEach(fvt,n),{hierarchy:n.hierarchy,added:n.added,changed:n.changed}}(this.plugin.state.data,this.current);if(!n.changed)return;const{hierarchy:r}=n,i=this.syncCurrent(r.trajectories,n.added),o=this.syncCurrent(r.models,n.added),s=this.syncCurrent(r.structures,n.added);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.hierarchy=r,this.state.selection.trajectories=i,this.state.selection.models=o,this.state.selection.structures=s,t?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:r,trajectories:i,models:o,structures:s})):this.state.notified=!1}updateCurrent(t,n){const r=this.current,i="add"===n?Lo.union(this.seletionSet,new Set(t.map(l=>l.cell.transform.ref))):Lo.difference(this.seletionSet,new Set(t.map(l=>l.cell.transform.ref))),o=[],s=[],a=[];for(const l of r.trajectories)i.has(l.cell.transform.ref)&&o.push(l);for(const l of r.models)i.has(l.cell.transform.ref)&&s.push(l);for(const l of r.structures)i.has(l.cell.transform.ref)&&a.push(l);this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.state.selection.trajectories=o,this.state.selection.models=s,this.state.selection.structures=a,this.behaviors.selection.next({hierarchy:r,trajectories:o,models:s,structures:a})}remove(t,n){if(0===t.length)return;const r=this.plugin.state.data.build();for(const i of t)r.delete("string"==typeof i?i:i.cell.transform.ref);return r.commit({canUndo:!!n&&"Remove"})}toggleVisibility(t,n){if(0===t.length)return;const r=void 0!==n?"show"!==n:!t[0].cell.state.isHidden;for(const i of t)G_(this.dataState,i.cell.transform.ref,r)}applyPreset(t,n,r){var i=this;return this.plugin.dataTransaction(le(function*(){for(const o of t)o.models.length>0&&(yield i.clearTrajectory(o)),yield i.plugin.builders.structure.hierarchy.applyPreset(o.cell,n,r)}))}updateStructure(t,n){var r=this;return le(function*(){yield r.plugin.dataTransaction(le(function*(){const i=la.getDecoratorRoot(r.dataState.tree,t.cell.transform.ref),o=r.dataState.tree.children.get(i).toArray();yield r.remove(o,!1),yield r.plugin.state.updateTransform(r.plugin.state.data,t.cell.transform.ref,n,"Structure Type"),yield r.plugin.builders.structure.representation.applyPreset(t.cell.transform.ref,"auto")}),{canUndo:"Structure Type"}),jt.Camera.Reset(r.plugin)})()}clearTrajectory(t){const n=this.dataState.build();for(const r of t.models)n.delete(r.cell);return n.commit()}constructor(t){super(),this.plugin=t,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:v$(),selection:{trajectories:[],models:[],structures:[]}},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,trajectories:this.selection.trajectories,models:this.selection.models,structures:this.selection.structures})},this._currentComponentGroups=void 0,this._currentSelectionSet=void 0,this.subscribe(t.state.data.events.changed,n=>{n.inTransaction||t.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(t.behaviors.state.isAnimating,n=>{!n&&!t.behaviors.state.isUpdating.value&&this.sync(!0)})}}!function(e){e.getComponentGroups=function t(r){if(!r.length)return[];if(1===r.length)return r[0].components.map(s=>[s]);const i=[],o=new Map;for(const s of r)for(const a of s.components){const l=a.key;if(!l)continue;let c=o.get(l);c||(c=[],o.set(l,c),i.push(c)),c.push(a)}return i},e.getSelectedStructuresDescription=function n(r){var i,o,s,a,l,c,u,d,f;const{structures:p}=r.managers.structure.hierarchy.selection;if(0===p.length)return"";if(1===p.length){const y=p[0],v=null===(i=y.cell.obj)||void 0===i?void 0:i.data;if(!v)return(null===(o=y.cell.obj)||void 0===o?void 0:o.label)||"Structure";const x=v.models[0]||v.representativeModel||v.masterModel;if(!x)return(null===(s=y.cell.obj)||void 0===s?void 0:s.label)||"Structure";const _=x.entryId;return null!==(l=null===(a=y.model)||void 0===a?void 0:a.trajectory)&&void 0!==l&&l.models&&1===y.model.trajectory.models.length?_:y.model?`${null===(c=y.model.cell.obj)||void 0===c?void 0:c.label} | ${_}`:_}const m=p[0],h=null===(u=m?.model)||void 0===u?void 0:u.trajectory;let g=!0;for(const y of p)if((null===(d=y?.model)||void 0===d?void 0:d.trajectory)!==h){g=!1;break}return g&&h?`${null===(f=h.cell.obj)||void 0===f?void 0:f.label} | ${p.length} structures`:`${p.length} structures`}}(m2||(m2={}));const x$="measurement-group",SO="measurement-order-label",A1e={distanceUnitLabel:I.Text("\u212b",{isEssential:!0}),textColor:Ame.textColor},mvt=I.getDefaultValues(A1e);class gvt extends zy{stateUpdated(){this.behaviors.state.next(this.state)}getGroup(){const n=Qn.findTagInSubtree(this.plugin.state.data.tree,vr.RootRef,x$),r=this.plugin.state.data.build();return n?r.to(n):r.toRoot().group(at.Misc.CreateGroup,{label:"Measurements"},{tags:x$})}setOptions(t){var n=this;return le(function*(){n.updateState({options:t})&&n.stateUpdated();const r=n.plugin.state.data.build();for(const i of n.state.distances)r.to(i).update(o=>{o.unitLabel=t.distanceUnitLabel,o.textColor=t.textColor});for(const i of n.state.labels)r.to(i).update(o=>{o.textColor=t.textColor});for(const i of n.state.angles)r.to(i).update(o=>{o.textColor=t.textColor});for(const i of n.state.dihedrals)r.to(i).update(o=>{o.textColor=t.textColor});0!==r.editInfo.count&&(yield jt.State.Update(n.plugin,{state:n.plugin.state.data,tree:r,options:{doNotLogTiming:!0}}))})()}addDistance(t,n,r){var i=this;return le(function*(){const o=i.plugin.helpers.substructureParent.get(t.structure),s=i.plugin.helpers.substructureParent.get(n.structure);if(!o||!s)return;const a=[o.transform.ref];Us(a,s.transform.ref);const l=i.getGroup();l.apply(at.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",groupId:"a",ref:o.transform.ref,expression:Me.toExpression(t)},{key:"b",groupId:"b",ref:s.transform.ref,expression:Me.toExpression(n)}],isTransitive:!0,label:"Distance"},{dependsOn:a,tags:r?.selectionTags}).apply(at.Representation.StructureSelectionsDistance3D,{customText:r?.customText||"",unitLabel:i.state.options.distanceUnitLabel,textColor:i.state.options.textColor,...r?.lineParams,...r?.labelParams,...r?.visualParams},{tags:r?.reprTags});const c=i.plugin.state.data;yield jt.State.Update(i.plugin,{state:c,tree:l,options:{doNotLogTiming:!0}})})()}addAngle(t,n,r,i){var o=this;return le(function*(){const s=o.plugin.helpers.substructureParent.get(t.structure),a=o.plugin.helpers.substructureParent.get(n.structure),l=o.plugin.helpers.substructureParent.get(r.structure);if(!s||!a||!l)return;const c=[s.transform.ref];Us(c,a.transform.ref),Us(c,l.transform.ref);const u=o.getGroup();u.apply(at.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:s.transform.ref,expression:Me.toExpression(t)},{key:"b",ref:a.transform.ref,expression:Me.toExpression(n)},{key:"c",ref:l.transform.ref,expression:Me.toExpression(r)}],isTransitive:!0,label:"Angle"},{dependsOn:c,tags:i?.selectionTags}).apply(at.Representation.StructureSelectionsAngle3D,{customText:i?.customText||"",textColor:o.state.options.textColor,...i?.lineParams,...i?.labelParams,...i?.visualParams},{tags:i?.reprTags});const d=o.plugin.state.data;yield jt.State.Update(o.plugin,{state:d,tree:u,options:{doNotLogTiming:!0}})})()}addDihedral(t,n,r,i,o){var s=this;return le(function*(){const a=s.plugin.helpers.substructureParent.get(t.structure),l=s.plugin.helpers.substructureParent.get(n.structure),c=s.plugin.helpers.substructureParent.get(r.structure),u=s.plugin.helpers.substructureParent.get(i.structure);if(!(a&&l&&c&&u))return;const d=[a.transform.ref];Us(d,l.transform.ref),Us(d,c.transform.ref),Us(d,u.transform.ref);const f=s.getGroup();f.apply(at.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:a.transform.ref,expression:Me.toExpression(t)},{key:"b",ref:l.transform.ref,expression:Me.toExpression(n)},{key:"c",ref:c.transform.ref,expression:Me.toExpression(r)},{key:"d",ref:u.transform.ref,expression:Me.toExpression(i)}],isTransitive:!0,label:"Dihedral"},{dependsOn:d,tags:o?.selectionTags}).apply(at.Representation.StructureSelectionsDihedral3D,{customText:o?.customText||"",textColor:s.state.options.textColor,...o?.lineParams,...o?.labelParams,...o?.visualParams},{tags:o?.reprTags});const p=s.plugin.state.data;yield jt.State.Update(s.plugin,{state:p,tree:f,options:{doNotLogTiming:!0}})})()}addLabel(t,n){var r=this;return le(function*(){const i=r.plugin.helpers.substructureParent.get(t.structure);if(!i)return;const o=[i.transform.ref],s=r.getGroup();s.apply(at.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:i.transform.ref,expression:Me.toExpression(t)}],isTransitive:!0,label:"Label"},{dependsOn:o,tags:n?.selectionTags}).apply(at.Representation.StructureSelectionsLabel3D,{textColor:r.state.options.textColor,...n?.labelParams,...n?.visualParams},{tags:n?.reprTags});const a=r.plugin.state.data;yield jt.State.Update(r.plugin,{state:a,tree:s,options:{doNotLogTiming:!0}})})()}addOrientation(t){var n=this;return le(function*(){const r=[],i=[];for(let a=0,l=t.length;a<l;++a){const c=t[a],u=n.plugin.helpers.substructureParent.get(c.structure);u&&(Us(i,u.transform.ref),r.push({key:`l${a}`,ref:u.transform.ref,expression:Me.toExpression(c)}))}if(0===r.length)return;const o=n.getGroup();o.apply(at.Model.MultiStructureSelectionFromExpression,{selections:r,isTransitive:!0,label:"Orientation"},{dependsOn:i}).apply(at.Representation.StructureSelectionsOrientation3D);const s=n.plugin.state.data;yield jt.State.Update(n.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})})()}addPlane(t){var n=this;return le(function*(){const r=[],i=[];for(let a=0,l=t.length;a<l;++a){const c=t[a],u=n.plugin.helpers.substructureParent.get(c.structure);u&&(Us(i,u.transform.ref),r.push({key:`l${a}`,ref:u.transform.ref,expression:Me.toExpression(c)}))}if(0===r.length)return;const o=n.getGroup();o.apply(at.Model.MultiStructureSelectionFromExpression,{selections:r,isTransitive:!0,label:"Plane"},{dependsOn:i}).apply(at.Representation.StructureSelectionsPlane3D);const s=n.plugin.state.data;yield jt.State.Update(n.plugin,{state:s,tree:o,options:{doNotLogTiming:!0}})})()}addOrderLabels(t){var n=this;return le(function*(){const r=n.getGroup(),i=n.plugin.state.data.select(Qn.Generators.ofType(Se.Molecule.Structure.Selections).withTag(SO));for(const a of i)r.delete(a);let o=1;for(const a of t){const l=n.plugin.helpers.substructureParent.get(a.structure);if(!l)continue;const c=[l.transform.ref];r.apply(at.Model.MultiStructureSelectionFromExpression,{selections:[{key:"a",ref:l.transform.ref,expression:Me.toExpression(a)}],isTransitive:!0,label:"Order"},{dependsOn:c,tags:SO}).apply(at.Representation.StructureSelectionsLabel3D,{textColor:st.fromRgb(255,255,255),borderColor:st.fromRgb(0,0,0),textSize:.33,borderWidth:.3,offsetZ:.75,customText:""+o++},{tags:SO})}const s=n.plugin.state.data;yield jt.State.Update(n.plugin,{state:s,tree:r,options:{doNotLogTiming:!0}})})()}getTransforms(t){const n=this.plugin.state.data,r=Qn.findTagInSubtree(n.tree,vr.RootRef,x$),i=r?n.select(Qn.Generators.ofTransformer(t,r)):this._empty;return 0===i.length?this._empty:i}sync(){const t=[];for(const r of this.getTransforms(at.Representation.StructureSelectionsLabel3D)){const i=r.obj.tags;(!i||!i.includes(SO))&&t.push(r)}this.updateState({labels:t,distances:this.getTransforms(at.Representation.StructureSelectionsDistance3D),angles:this.getTransforms(at.Representation.StructureSelectionsAngle3D),dihedrals:this.getTransforms(at.Representation.StructureSelectionsDihedral3D),orientations:this.getTransforms(at.Representation.StructureSelectionsOrientation3D),planes:this.getTransforms(at.Representation.StructureSelectionsPlane3D)})&&this.stateUpdated()}constructor(t){super({labels:[],distances:[],angles:[],dihedrals:[],orientations:[],planes:[],options:mvt}),this.plugin=t,this.behaviors={state:this.ev.behavior(this.state)},this._empty=[],t.state.data.events.changed.subscribe(n=>{n.inTransaction||t.behaviors.state.isAnimating.value||this.sync()}),t.behaviors.state.isAnimating.subscribe(n=>{!n&&!t.behaviors.state.isUpdating.value&&this.sync()})}}const VP=new xf("98");class bvt extends zy{get entries(){return this.state.entries}get additionsHistory(){return this.state.additionsHistory}get stats(){return this.state.stats||(this.state.stats=this.calcStats()),this.state.stats}getEntry(t){const n=this.plugin.helpers.substructureParent.get(t,!0);if(!n)return;const r=n.transform.ref;if(!this.entries.has(r)){const i=new _$(Me(t,[]));return this.entries.set(r,i),i}return this.entries.get(r)}calcStats(){let t=0,n=0;const r=Wh.create();this.entries.forEach(o=>{const{elements:s}=o.selection;if(s.length){t+=1;for(let a=0,l=s.length;a<l;++a)n+=Ve.size(s[a].indices);Wh.add(r,r,Wh.ofLoci(o.selection))}});const i=dP(r,{countsOnly:!0});return{structureCount:t,elementCount:n,label:i}}add(t){if(!Me.is(t))return!1;const n=this.getEntry(t.structure);if(!n)return!1;const r=n.selection;return n.selection=Me.union(n.selection,t),this.tryAddHistory(t),this.referenceLoci=t,this.events.loci.add.next(t),!Me.areEqual(r,n.selection)}remove(t){if(!Me.is(t))return!1;const n=this.getEntry(t.structure);if(!n)return!1;const r=n.selection;return n.selection=Me.subtract(n.selection,t),this.referenceLoci=t,this.events.loci.remove.next(t),!Me.areEqual(r,n.selection)}intersect(t){if(!Me.is(t))return!1;const n=this.getEntry(t.structure);if(!n)return!1;const r=n.selection;return n.selection=Me.intersect(n.selection,t),this.referenceLoci=t,!Me.areEqual(r,n.selection)}set(t){if(!Me.is(t))return!1;const n=this.getEntry(t.structure);if(!n)return!1;const r=n.selection;return n.selection=t,this.tryAddHistory(t),this.referenceLoci=void 0,!Me.areEqual(r,n.selection)}modifyHistory(t,n,r,i=!1){const o=this.additionsHistory,s=o.indexOf(t);if(s<0)return;let a;switch(n){case"remove":h3(o,s);break;case"up":a=s-1;break;case"down":a=s+1}if(void 0!==a){const l=r?Math.min(o.length,r):o.length;for(;;){if(a%=l,a<0&&(a+=l),!i||o[s].loci.structure===o[a].loci.structure){const c=o[s];o[s]=o[a],o[a]=c;break}a+="up"===n?-1:1}}this.events.additionsHistoryUpdated.next(void 0)}tryAddHistory(t){if(Yn.isEmpty(t))return;let r,n=0;for(const s of this.additionsHistory){if(Yn.areEqual(s.loci,t)){r=s;break}n++}if(r)return h3(this.additionsHistory,n),this.additionsHistory.unshift(r),void this.events.additionsHistoryUpdated.next(void 0);const o=dP(Wh.ofLoci(t),{reverse:!0});this.additionsHistory.unshift({id:oo.create22(),loci:t,label:o}),this.additionsHistory.length>24&&this.additionsHistory.pop(),this.events.additionsHistoryUpdated.next(void 0)}clearHistory(){0!==this.state.additionsHistory.length&&(this.state.additionsHistory=[],this.events.additionsHistoryUpdated.next(void 0))}clearHistoryForStructure(t){const n=[];for(const r of this.state.additionsHistory)r.loci.structure.root===t.root&&n.push(r);for(const r of n)this.modifyHistory(r,"remove");0!==n.length&&this.events.additionsHistoryUpdated.next(void 0)}onRemove(t,n){var r;this.entries.has(t)&&(this.entries.delete(t),n?.data&&this.clearHistoryForStructure(n.data),(null===(r=this.referenceLoci)||void 0===r?void 0:r.structure)===n?.data&&(this.referenceLoci=void 0),this.state.stats=void 0,this.events.changed.next(void 0))}onUpdate(t,n,r){var i,o,s,a;if(n===r||n?.data===r.data)return;const l=this.plugin.helpers.substructureParent.get(r.data,!0);if(!l||t!==l.transform.ref||!this.entries.has(t))return;const c=null===(o=null===(i=this.plugin.helpers.substructureParent.get(r.data))||void 0===i?void 0:i.obj)||void 0===o?void 0:o.data;if(c)if(!n?.data||Xe.areUnitIdsAndIndicesEqual(n.data,r.data)){this.entries.set(t,function xvt(e,t){return new _$(Me.remap(e.selection,t))}(this.entries.get(t),c)),(null===(s=this.referenceLoci)||void 0===s?void 0:s.structure.root)===c.root&&(this.referenceLoci=Me.remap(this.referenceLoci,c));let u=!1;for(const d of this.state.additionsHistory)d.loci.structure.root===c.root&&(d.loci=Me.remap(d.loci,c),u=!0);u&&this.events.additionsHistoryUpdated.next(void 0)}else this.entries.set(t,new _$(Me(c,[]))),(null===(a=this.referenceLoci)||void 0===a?void 0:a.structure.root)===c.root&&(this.referenceLoci=void 0),this.clearHistoryForStructure(c),this.state.stats=void 0,this.events.changed.next(void 0)}clear(){const t=this.entries.keys(),n=[];for(;;){const r=t.next();if(r.done)break;const i=this.entries.get(r.value);Me.isEmpty(i.selection)||n.push(i.selection),i.selection=Me(i.selection.structure,[])}return this.referenceLoci=void 0,this.state.stats=void 0,this.events.changed.next(void 0),this.events.loci.clear.next(void 0),this.clearHistory(),n}getLoci(t){const n=this.getEntry(t);return n?n.selection:qr}getStructure(t){const n=this.getEntry(t);if(n)return n.structure}structureHasSelection(t){var n,r;const i=null===(r=null===(n=t.cell)||void 0===n?void 0:n.obj)||void 0===r?void 0:r.data;if(!i)return!1;const o=this.getEntry(i);return!!o&&!Me.isEmpty(o.selection)}has(t){if(Me.is(t)){const n=this.getEntry(t.structure);if(n)return Me.isSubset(n.selection,t)}return!1}tryGetRange(t){if(!Me.is(t)||1!==t.elements.length||!this.getEntry(t.structure))return;const r=t.elements[0];if(!r)return;const i=this.referenceLoci;if(!i||!Me.is(i)||i.structure!==t.structure)return;let o;for(const s of i.elements)if(r.unit===s.unit){o=s;break}return o&&r.unit===o.unit?function _vt(e,t,n){const r=Math.min(Ve.min(t.indices),Ve.min(n.indices)),i=Math.max(Ve.max(t.indices),Ve.max(n.indices));return Me(e,[{unit:t.unit,indices:Ve.ofRange(r,i)}])}(t.structure,o,r):void 0}elementCount(){let t=0;return this.entries.forEach(n=>{t+=Me.size(n.selection)}),t}getBoundary(){const t=C.create(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=C.create(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);VP.reset();const r=[];this.entries.forEach(i=>{const o=i.selection;Me.isEmpty(o)||r.push(Me.getBoundary(o))});for(let i=0,o=r.length;i<o;++i){const{box:s,sphere:a}=r[i];C.min(t,t,s.min),C.max(n,n,s.max),VP.includePositionRadius(a.center,a.radius)}VP.finishedIncludeStep();for(let i=0,o=r.length;i<o;++i){const{sphere:s}=r[i];VP.radiusPositionRadius(s.center,s.radius)}return{box:{min:t,max:n},sphere:VP.getSphere()}}getPrincipalAxes(){const t=FU(this.entries.values());return Me.getPrincipalAxesMany(t.map(n=>n.selection))}modify(t,n){let r=!1;switch(t){case"add":r=this.add(n);break;case"remove":r=this.remove(n);break;case"intersect":r=this.intersect(n);break;case"set":r=this.set(n)}r&&(this.state.stats=void 0,this.events.changed.next(void 0))}get applicableStructures(){return this.plugin.managers.structure.hierarchy.selection.structures.filter(t=>!!t.cell.obj).map(t=>t.cell.obj.data)}triggerInteraction(t,n,r=!0){switch(t){case"add":this.plugin.managers.interactivity.lociSelects.select({loci:n},r);break;case"remove":this.plugin.managers.interactivity.lociSelects.deselect({loci:n},r);break;case"intersect":this.plugin.managers.interactivity.lociSelects.selectJoin({loci:n},r);break;case"set":this.plugin.managers.interactivity.lociSelects.selectOnly({loci:n},r)}}fromLoci(t,n,r=!0){this.triggerInteraction(t,n,r)}fromCompiledQuery(t,n,r=!0){for(const i of this.applicableStructures){const o=n(new _f(i));this.triggerInteraction(t,Dt.toLociWithSourceUnits(o),r)}}fromSelectionQuery(t,n,r=!0){var i=this;this.plugin.runTask(Ke.create("Structure Selection",function(){var o=le(function*(s){for(const a of i.applicableStructures){const l=yield n.getSelection(i.plugin,s,a);i.triggerInteraction(t,Dt.toLociWithSourceUnits(l),r)}});return function(s){return o.apply(this,arguments)}}()))}fromSelections(t){var n;const r=_a.resolveAndCheck(this.plugin.state.data,t);if(r&&r.obj){if(!Se.Molecule.Structure.Selections.is(r.obj))return void console.warn("fromSelections applied to wrong object type.",r.obj);this.clear();for(const i of null===(n=r.obj)||void 0===n?void 0:n.data)this.fromLoci("set",i.loci)}}getSnapshot(){const t=[];return this.entries.forEach((n,r)=>{t.push({ref:r,bundle:Qr.fromLoci(n.selection)})}),{entries:t}}setSnapshot(t){var n,r;this.entries.clear();for(const{ref:i,bundle:o}of t.entries){const s=null===(r=null===(n=this.plugin.state.data.select(Qn.Generators.byRef(i))[0])||void 0===n?void 0:n.obj)||void 0===r?void 0:r.data;if(!s)continue;const a=Qr.toLoci(o,s);this.fromLoci("set",a,!1)}}constructor(t){super({entries:new Map,additionsHistory:[],stats:{structureCount:0,elementCount:0,label:"Nothing Selected"}}),this.plugin=t,this.events={changed:this.ev(),additionsHistoryUpdated:this.ev(),loci:{add:this.ev(),remove:this.ev(),clear:this.ev()}},t.helpers.substructureParent.events.removed.subscribe(n=>this.onRemove(n.ref,n.obj)),t.helpers.substructureParent.events.updated.subscribe(n=>this.onUpdate(n.ref,n.oldObj,n.obj))}}class _${get selection(){return this._selection}set selection(t){this._selection=t,this._structure=void 0}get structure(){return this._structure||(this._structure=Yn.isEmpty(this._selection)?void 0:Me.toStructure(this._selection)),this._structure}constructor(t){this._structure=void 0,this._selection=t}}function S$(){return{volumes:[],lazyVolumes:[],refs:new Map}}function Cvt(e){return{kind:"volume",cell:e,version:e.transform.version,representations:[]}}function wvt(e){return{kind:"lazy-volume",cell:e,version:e.transform.version}}function Avt(e,t){return{kind:"volume-representation",cell:e,version:e.transform.version,volume:t}}function C$(e,t,n,r,...i){const o=r(...i);n.push(o),e.hierarchy.refs.set(t.transform.ref,o);const s=e.oldHierarchy.refs.get(t.transform.ref);return s?s.version!==t.transform.version&&(e.changed=!0):(e.added.add(o.cell.transform.ref),e.changed=!0),o}function I1e(){}const Tvt=[[function Evt(e,t){return(n,r)=>!t(r)&&e.is(n.obj)}(Se.Volume.Data,e=>e.currentVolume),(e,t)=>{e.currentVolume=C$(e,t,e.hierarchy.volumes,Cvt,t)},e=>e.currentVolume=void 0],[e=>Se.Volume.Lazy.is(e.obj),(e,t)=>{C$(e,t,e.hierarchy.lazyVolumes,wvt,t)},I1e],[(e,t)=>!e.state.isGhost&&!!t.currentVolume&&Se.Volume.Representation3D.is(e.obj),(e,t)=>(e.currentVolume&&C$(e,t,e.currentVolume.representations,Avt,t,e.currentVolume),!1),I1e]];function E1e(e){if(!e||!e?.parent||!e.parent.cells.has(e.transform.ref))return!1;const{obj:t}=e;return!(!t||t===vo.Null||"ok"!==e.status&&"error"!==e.status)}function Dvt(e){const{cell:t}=e;E1e(t)||(this.changed=!0)}function Pvt(e){T1e(this,this.tree.transforms.get(e))}function T1e(e,t){const{state:n}=e,r=n.state.cells.get(t.ref);if(!E1e(r))return;let i,o=!1;for(const[a,l,c]of Tvt)if(a(r,n)){if(!1===l(n,r)){o=!0;break}i=c;break}if(o)return;const s=e.tree.children.get(t.ref);s&&s.size&&s.forEach(Pvt,e),i&&i(n)}class CO extends wP{get dataState(){return this.plugin.state.data}get current(){return this.sync(!1),this.state.hierarchy}get selection(){return this.sync(!1),this.state.selection}sync(t){if(!t&&this.dataState.inUpdate)return;if(this.state.syncedTree===this.dataState.tree)return void(t&&!this.state.notified&&(this.state.notified=!0,this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:this.state.selection})));this.state.syncedTree=this.dataState.tree;const n=function Svt(e,t){const n=function Ivt(e,t){return{state:e,oldHierarchy:t,hierarchy:S$(),changed:!1,added:new Set}}(e,t||S$());return function kvt(e,t){T1e({tree:e,state:t},e.root)}(e.tree,n),t&&t.refs.forEach(Dvt,n),{hierarchy:n.hierarchy,added:n.added,changed:n.changed}}(this.plugin.state.data,this.current);if(!n.changed)return;const{hierarchy:r}=n;this.state.hierarchy=r,this.state.selection=this.state.selection&&r.refs.has(this.state.selection.cell.transform.ref)?r.refs.get(this.state.selection.cell.transform.ref):r.volumes[0],t?(this.state.notified=!0,this.behaviors.selection.next({hierarchy:r,volume:this.state.selection})):this.state.notified=!1}setCurrent(t){this.state.selection=t||this.state.hierarchy.volumes[0],this.behaviors.selection.next({hierarchy:this.state.hierarchy,volume:t||this.state.hierarchy.volumes[0]})}remove(t,n){if(0===t.length)return;const r=this.plugin.state.data.build();for(const i of t)r.delete("string"==typeof i?i:i.cell.transform.ref);return r.commit({canUndo:!!n&&"Remove"})}toggleVisibility(t,n){if(0===t.length)return;const r=void 0!==n?"show"!==n:!t[0].cell.state.isHidden;for(const i of t)G_(this.dataState,i.cell.transform.ref,r)}addRepresentation(t,n){var r;return this.dataState.build().to(t.cell).apply(at.Representation.VolumeRepresentation3D,UA(this.plugin,null===(r=t.cell.obj)||void 0===r?void 0:r.data,{type:n})).commit({canUndo:"Add Representation"})}constructor(t){super(),this.plugin=t,this.state={syncedTree:this.dataState.tree,notified:!1,hierarchy:S$(),selection:void 0},this.behaviors={selection:this.ev.behavior({hierarchy:this.current,volume:this.selection})},this.subscribe(t.state.data.events.changed,n=>{n.inTransaction||t.behaviors.state.isAnimating.value||this.sync(!0)}),this.subscribe(t.behaviors.state.isAnimating,n=>{!n&&!t.behaviors.state.isUpdating.value&&this.sync(!0)})}}!function(e){e.getRepresentationTypes=function t(n,r){var i,o;return null!==(i=r?.cell.obj)&&void 0!==i&&i.data?n.representation.volume.registry.getApplicableTypes(null===(o=r.cell.obj)||void 0===o?void 0:o.data):n.representation.volume.registry.types}}(CO||(CO={}));const w$=[["full","Full"],["hidden","Hidden"]],Rvt={isExpanded:I.Boolean(!1),showControls:I.Boolean(!0),regionState:I.Group({left:I.Select("full",[["full","Full"],["collapsed","Collapsed"],["hidden","Hidden"]]),top:I.Select("full",w$),right:I.Select("full",w$),bottom:I.Select("full",w$)}),controlsDisplay:I.Value("outside",{isHidden:!0})};class Nvt extends zy{updateProps(t){const n=!!this.state.isExpanded;this.updateState(t),this.root&&"boolean"==typeof t.isExpanded&&t.isExpanded!==n&&this.handleExpand(),this.events.updated.next(void 0)}setProps(t){this.updateState(t)}setRoot(t){this.root=t,this.state.isExpanded&&this.handleExpand()}getScrollElement(){return document.scrollingElement?document.scrollingElement:document.documentElement?document.documentElement:document.body}handleExpand(){try{const t=document.getElementsByTagName("body")[0],n=document.getElementsByTagName("head")[0];if(!t||!n||!this.root)return;if(this.state.isExpanded){const r=n.children,i=[];let o=!1;for(let u=0;u<r.length;u++)r[u]===this.expandedViewport?o=!0:"viewport"===(r[u].name||"").toLowerCase()&&i.push(r[u]);for(const u of i)n.removeChild(u);o||n.appendChild(this.expandedViewport);const s=t.style,a=this.getScrollElement();this.rootState={top:s.top,bottom:s.bottom,right:s.right,left:s.left,scrollTop:a.scrollTop,scrollLeft:a.scrollLeft,position:s.position,overflow:s.overflow,viewports:i,zIndex:this.root.style.zIndex,width:s.width,height:s.height,maxWidth:s.maxWidth,maxHeight:s.maxHeight,margin:s.margin,marginLeft:s.marginLeft,marginRight:s.marginRight,marginTop:s.marginTop,marginBottom:s.marginBottom},s.overflow="hidden",s.position="fixed",s.top="0",s.bottom="0",s.right="0",s.left="0",s.width="100%",s.height="100%",s.maxWidth="100%",s.maxHeight="100%",s.margin="0",s.marginLeft="0",s.marginRight="0",s.marginTop="0",s.marginBottom="0"}else{const r=n.children;for(let i=0;i<r.length;i++)if(r[i]===this.expandedViewport){n.removeChild(this.expandedViewport);break}if(this.rootState){const i=this.rootState;for(const a of i.viewports)n.appendChild(a);const o=t.style;o.top=i.top,o.bottom=i.bottom,o.left=i.left,o.right=i.right,o.width=i.width,o.height=i.height,o.maxWidth=i.maxWidth,o.maxHeight=i.maxHeight,o.margin=i.margin,o.marginLeft=i.marginLeft,o.marginRight=i.marginRight,o.marginTop=i.marginTop,o.marginBottom=i.marginBottom,o.position=i.position,o.overflow=i.overflow||"";const s=this.getScrollElement();s.scrollTop=i.scrollTop,s.scrollLeft=i.scrollLeft,this.rootState=void 0,this.root.style.zIndex=i.zIndex}}}catch(t){const n="Layout change error, you might have to reload the page.";this.context.log.error(n),console.error(n,t)}}constructor(t){super({...I.getDefaultValues(Rvt),...t.spec.layout&&t.spec.layout.initial}),this.context=t,this.events={updated:this.ev()},this.rootState=void 0,jt.Layout.Update.subscribe(t,n=>this.updateProps(n.state)),typeof document<"u"&&(this.expandedViewport=document.createElement("meta"),this.expandedViewport.name="viewport",this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0")}}const A$={includeTypes:I.MultiSelect(DR(Lr.Names),I.objectToOptions(Lr.Names)),excludeTypes:I.MultiSelect([],I.objectToOptions(Lr.Names)),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),aromaticBonds:I.Boolean(!0,{description:"Display aromatic bonds with dashes"}),multipleBonds:I.Select("symmetric",I.arrayToOptions(["off","symmetric","offset"]))},I$=(I.getDefaultValues(A$),{...t2,...A$,adjustCylinderLength:I.Boolean(!1,{description:"Shorten cylinders to reduce overlap with spheres. Useful for for transparent bonds. Not working well with aromatic bonds."})}),E$=(I.getDefaultValues(I$),{...Wye,...A$});function wO(e,t,n){return!Lr.is(e,n)||Lr.is(t,n)}function D1e(e,t,n){const r=t.elements,i=t.bonds,{a:o,b:s,edgeProps:a}=i,{flags:l}=a,{ignoreHydrogens:c,ignoreHydrogensVariant:u,includeTypes:d,excludeTypes:f}=n,p=Lr.fromNames(d),m=Lr.fromNames(f),h=Lr.isAll(p)&&0===m,{child:g}=e,y=g?.unitMap.get(t.id);if(g&&!y)throw new Error("expected childUnit to exist if child exists");if(!h||c||g)return v=>{const x=o[v],_=s[v];return!!(y&&!rt.has(y.elements,r[x])||!h&&wO(p,m,l[v]))||!!c&&!(!rm(e,t,r[x],u)&&!rm(e,t,r[_],u))}}function P1e(e,t){const n=e.interUnitBonds,{edges:r}=n,{ignoreHydrogens:i,ignoreHydrogensVariant:o,includeTypes:s,excludeTypes:a}=t,l=Lr.fromNames(s),c=Lr.fromNames(a),u=Lr.isAll(l)&&0===c,{child:d}=e;if(!u||i||d)return f=>{if(d){const p=r[f],m=d.unitMap.get(p.unitA);if(!m)return!0;const g=e.unitMap.get(p.unitA).elements[p.indexA];if(!rt.has(m.elements,g))return!0}if(i){const p=r[f],m=e.unitMap.get(p.unitA),h=e.unitMap.get(p.unitB);if(rm(e,m,m.elements[p.indexA],o)||rm(e,h,h.elements[p.indexB],o))return!0}return!(u||!wO(l,c,r[f].props.flag))}}var fv;function T$(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e;if(n===r){const{structure:s,group:a}=t,l=a.units[i];if(ze.isAtomic(l)){const{target:c}=s,u=l.bonds.a[o],d=l.bonds.b[o];return fn.Loci(c,[fn.Location(c,l,u,c,l,d),fn.Location(c,l,d,c,l,u)])}}return qr}function D$(e,t,n,r){let i=!1;if(fn.isLoci(e)){const{structure:o,group:s}=t;if(!Xe.areEquivalent(e.structure,o))return!1;const a=s.units[0];if(!ze.isAtomic(a))return!1;const l=2*a.bonds.edgeCount;for(const c of e.bonds){if(c.aUnit!==c.bUnit)continue;const u=s.unitIndexMap.get(c.aUnit.id);if(void 0!==u){const d=a.bonds.getDirectedEdgeIndex(c.aIndex,c.bIndex);-1!==d&&n(Pe.ofSingleton(u*l+d))&&(i=!0)}}}else if(Me.is(e)){const{structure:o,group:s}=t;if(!Xe.areEquivalent(e.structure,o))return!1;const a=s.units[0];if(!ze.isAtomic(a))return!1;const l=2*a.bonds.edgeCount;for(const c of e.elements){const u=s.unitIndexMap.get(c.unit.id);if(void 0!==u){const{offset:d,b:f}=a.bonds;Ve.forEach(c.indices,p=>{for(let m=d[p],h=d[p+1];m<h;m++)(!r||Ve.has(c.indices,f[m]))&&n(Pe.ofSingleton(u*l+m))&&(i=!0)})}}}return i}function P$(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const{target:o}=t,s=t.interUnitBonds.edges[i],a=t.unitMap.get(s.unitA),l=t.unitMap.get(s.unitB);return fn.Loci(o,[fn.Location(o,a,s.indexA,o,l,s.indexB),fn.Location(o,l,s.indexB,o,a,s.indexA)])}return qr}I.getDefaultValues(E$),function(e){e.fromGroup=function t(r,i){const{group:o,structure:s}=r,a=o.units[0],l=ze.isAtomic(a)?2*a.bonds.edgeCount:0,c=o.units.length,u=fn.Location(s,void 0,void 0,s,void 0,void 0),d=(f,p)=>{const m=o.units[p];return u.aUnit=m,u.bUnit=m,u.aIndex=m.bonds.a[f],u.bIndex=m.bonds.b[f],u};if(i?.includeLocation2){const f=fn.Location(s,void 0,void 0,s,void 0,void 0);return Vi(l,c,1,d,!1,()=>!1,(m,h)=>{const g=o.units[h];return f.aUnit=g,f.bUnit=g,f.aIndex=g.bonds.b[m],f.bIndex=g.bonds.a[m],f})}return Vi(l,c,1,d)},e.fromStructure=function n(r,i){const o=r.interUnitBonds.edgeCount,a=fn.Location(r,void 0,void 0,r,void 0,void 0),l=c=>{const u=r.interUnitBonds.edges[c];return a.aUnit=r.unitMap.get(u.unitA),a.aIndex=u.indexA,a.bUnit=r.unitMap.get(u.unitB),a.bIndex=u.indexB,a};if(i?.includeLocation2){const c=fn.Location(r,void 0,void 0,r,void 0,void 0);return Vi(o,1,1,l,!0,()=>!1,d=>{const f=r.interUnitBonds.edges[d];return c.aUnit=r.unitMap.get(f.unitB),c.aIndex=f.indexB,c.bUnit=r.unitMap.get(f.unitA),c.bIndex=f.indexA,c})}return Vi(o,1,1,l,!0)}}(fv||(fv={}));const k$=new Map;function M$(e,t,n,r){let i=!1;if(fn.isLoci(e)){if(!Xe.areEquivalent(e.structure,t))return!1;for(const o of e.bonds){const s=t.interUnitBonds.getBondIndexFromLocation(o);-1!==s&&n(Pe.ofSingleton(s))&&(i=!0)}}else if(Me.is(e)){if(!Xe.areEquivalent(e.structure,t)||r&&1===e.elements.length)return!1;for(const o of e.elements)k$.set(o.unit.id,o.indices);for(const o of e.elements){const{unit:s}=o;ze.isAtomic(s)&&t.interUnitBonds.getConnectedUnits(s.id).forEach(a=>{const l=k$.get(a.unitB);(!r||l)&&Ve.forEach(o.indices,c=>{a.connectedIndices.includes(c)&&a.getEdges(c).forEach(u=>{if(!r||l&&Ve.has(l,u.indexB)){const d=t.interUnitBonds.getEdgeIndex(c,s.id,u.indexB,a.unitB);n(Pe.ofSingleton(d))&&(i=!0)}})})})}k$.clear()}return i}const R$=Lr.is;function k1e(e,t,n,r){const i=e.elements,o=e.bonds,{edgeCount:s,a,b:l,edgeProps:c,offset:u}=o,{order:d,flags:f}=c,{sizeFactor:p,sizeAspectRatio:m,adjustCylinderLength:h,aromaticBonds:g,includeTypes:y,excludeTypes:v,multipleBonds:x}=r,_="off"===x,w="symmetric"===x,E=wO(Lr.fromNames(y),Lr.fromNames(v),32),D=C(),T=C(),F=e.conformation;let R;const N=dt.create(t,e),j=fn.Location(t,e,void 0,t,e,void 0),{child:W}=t;if(r.includeParent&&W){const te=W.unitMap.get(e.id);if(!te)throw new Error("expected childUnit to exist");R=K=>{const G=i[l[K]];return rt.has(te.elements,i[a[K]])&&!rt.has(te.elements,G)}}const{elementRingIndices:X,elementAromaticRingIndices:H}=e.rings,oe=g?e.resonance.delocalizedTriplets:void 0;return{linkCount:2*s,referencePosition:te=>{let K=a[te],Q=l[te];const G=oe?.getThirdElement(K,Q);if(void 0!==G)return F.invariantPosition(i[G],D);K>Q&&([K,Q]=[Q,K]),u[K+1]-u[K]==1&&([K,Q]=[Q,K]);const Z=H.get(K)||X.get(K);let ee=0;for(let se=u[K],xe=u[K+1];se<xe;++se){const re=l[se];if(re!==Q&&re!==K){if(!Z)return F.invariantPosition(i[re],D);{const ae=H.get(re)||X.get(re);if(!ae)continue;const ge=jR(Z,ae);ge>ee&&(ee=ge,F.invariantPosition(i[re],D))}}}return ee>0?D:null},position:(te,K,Q)=>{if(F.invariantPosition(i[a[Q]],te),F.invariantPosition(i[l[Q]],K),h){const G=(te=>(N.element=i[a[te]],n.size.size(N)*p))(Q),Z=(te=>(N.element=i[l[te]],n.size.size(N)*p))(Q),ee=Math.min(G,Z)*m,se=Math.sqrt(Math.max(0,G*G-ee*ee))-.05,xe=Math.sqrt(Math.max(0,Z*Z-ee*ee))-.05;if(se<=.01&&xe<=.01)return;C.normalize(T,C.sub(T,K,te)),C.scaleAndAdd(te,te,T,se),C.scaleAndAdd(K,K,T,-xe)}},style:te=>{const K=d[te],Q=f[te];if(R$(Q,2)||R$(Q,4))return 1;if(3===K)return _?0:w?4:5;if(g){const Z=l[te],ee=H.get(a[te]),se=H.get(Z),xe=ee&&se?jR(ee,se):0;if(R$(Q,16)||xe&&!E)return 2===xe?8:7}return 2!==K||_?0:w?2:3},radius:te=>(te=>(j.aIndex=a[te],j.bIndex=l[te],n.size.size(j)*p))(te)*m,ignore:D1e(t,e,r),stub:R}}function Fvt(e,t,n,r,i,o){if(!ze.isAtomic(t)||!t.bonds.edgeCount)return Wu.createEmpty(o);const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return Wu.createEmpty(o);const l=k1e(t,n,r,i),{cylinders:c,boundingSphere:u}=$ye(0,l,i,o);if(u)c.setBoundingSphere(u);else if(c.cylinderCount>0){const d=ke.expand(ke(),(a??t).boundary.sphere,1*i.sizeFactor);c.setBoundingSphere(d)}return c}function Ovt(e,t,n,r,i,o){if(!ze.isAtomic(t)||!t.bonds.edgeCount)return on.createEmpty(o);const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return on.createEmpty(o);const l=k1e(t,n,r,i),{mesh:c,boundingSphere:u}=n2(0,l,i,o);if(u)c.setBoundingSphere(u);else if(c.triangleCount>0){const d=ke.expand(ke(),(a??t).boundary.sphere,1*i.sizeFactor);c.setBoundingSphere(d)}return c}const AO={...ml,..._W,...I$,sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)};function M1e(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?function Bvt(e){return SW({defaultProps:I.getDefaultValues(AO),createGeometry:Fvt,createLocationIterator:(t,n)=>fv.fromGroup(t,{includeLocation2:"interpolate"===n.colorMode}),getLoci:T$,eachLocation:D$,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.sizeAspectRatio!==r.sizeAspectRatio||n.linkScale!==r.linkScale||n.linkSpacing!==r.linkSpacing||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.linkCap!==r.linkCap||n.aromaticScale!==r.aromaticScale||n.aromaticSpacing!==r.aromaticSpacing||n.aromaticDashCount!==r.aromaticDashCount||n.dashCount!==r.dashCount||n.dashScale!==r.dashScale||n.dashCap!==r.dashCap||n.stubCap!==r.stubCap||!Ru(n.includeTypes,r.includeTypes)||!Ru(n.excludeTypes,r.excludeTypes)||n.adjustCylinderLength!==r.adjustCylinderLength||n.aromaticBonds!==r.aromaticBonds||n.multipleBonds!==r.multipleBonds,n.colorMode!==r.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0);const l=s.group.units[0],c=a.group.units[0];ze.isAtomic(l)&&ze.isAtomic(c)&&(Cd.areEqual(l.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function Lvt(e){return mc({defaultProps:I.getDefaultValues(AO),createGeometry:Ovt,createLocationIterator:t=>fv.fromGroup(t),getLoci:T$,eachLocation:D$,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.sizeAspectRatio!==r.sizeAspectRatio||n.radialSegments!==r.radialSegments||n.linkScale!==r.linkScale||n.linkSpacing!==r.linkSpacing||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.linkCap!==r.linkCap||n.aromaticScale!==r.aromaticScale||n.aromaticSpacing!==r.aromaticSpacing||n.aromaticDashCount!==r.aromaticDashCount||n.dashCount!==r.dashCount||n.dashScale!==r.dashScale||n.dashCap!==r.dashCap||n.stubCap!==r.stubCap||!Ru(n.includeTypes,r.includeTypes)||!Ru(n.excludeTypes,r.excludeTypes)||n.adjustCylinderLength!==r.adjustCylinderLength||n.aromaticBonds!==r.aromaticBonds||n.multipleBonds!==r.multipleBonds;const l=s.group.units[0],c=a.group.units[0];ze.isAtomic(l)&&ze.isAtomic(c)&&(Cd.areEqual(l.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}const N$=new fn.ElementBondIterator;function R1e(e,t,n,r){for(N$.setElement(t,n,r);N$.hasNext;){const i=N$.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}const N1e=C();function F1e(e,t,n){const r=dt.create(e),i=fn.Location(e,void 0,void 0,e,void 0,void 0),o=e.interUnitBonds,{edgeCount:s,edges:a}=o,{sizeFactor:l,sizeAspectRatio:c,adjustCylinderLength:u,aromaticBonds:d,multipleBonds:f}=n,p="off"===f,m="symmetric"===f,h=C();let g;const{child:y}=e;return n.includeParent&&y&&(g=w=>{const A=a[w],M=y.unitMap.get(A.unitA),E=y.unitMap.get(A.unitB),T=e.unitMap.get(A.unitA).elements[A.indexA],R=e.unitMap.get(A.unitB).elements[A.indexB];return M&&rt.has(M.elements,T)&&(!E||!rt.has(E.elements,R))}),{linkCount:s,referencePosition:w=>{const A=a[w];let M,E,D,T;if(A.unitA<A.unitB)M=e.unitMap.get(A.unitA),E=e.unitMap.get(A.unitB),D=A.indexA,T=A.indexB;else{if(!(A.unitA>A.unitB))throw new Error("same units in createInterUnitBondCylinderMesh");M=e.unitMap.get(A.unitB),E=e.unitMap.get(A.unitA),D=A.indexB,T=A.indexA}return R1e(N1e,e,M,D)||R1e(N1e,e,E,T)},position:(w,A,M)=>{const E=a[M],D=e.unitMap.get(E.unitA),T=e.unitMap.get(E.unitB);if(D.conformation.position(D.elements[E.indexA],w),T.conformation.position(T.elements[E.indexB],A),u){const F=(w=>{const A=a[w];return r.unit=e.unitMap.get(A.unitA),r.element=r.unit.elements[A.indexA],t.size.size(r)*l})(M),R=(w=>{const A=a[w];return r.unit=e.unitMap.get(A.unitB),r.element=r.unit.elements[A.indexB],t.size.size(r)*l})(M),N=Math.min(F,R)*c,j=Math.sqrt(Math.max(0,F*F-N*N))-.05,W=Math.sqrt(Math.max(0,R*R-N*N))-.05;if(j<=.01&&W<=.01)return;C.normalize(h,C.sub(h,A,w)),C.scaleAndAdd(w,w,h,j),C.scaleAndAdd(A,A,h,-W)}},style:w=>{const A=a[w].props.order,M=Mc.create(a[w].props.flag);return Lr.is(M,2)||Lr.is(M,4)?1:3===A?p?0:m?4:5:d&&Lr.is(M,16)?7:2!==A||p?0:m?2:3},radius:w=>(w=>{const A=a[w];return i.aUnit=e.unitMap.get(A.unitA),i.aIndex=A.indexA,i.bUnit=e.unitMap.get(A.unitB),i.bIndex=A.indexB,t.size.size(i)*l})(w)*c,ignore:P1e(e,n),stub:g}}function jvt(e,t,n,r,i){if(!t.interUnitBonds.edgeCount)return Wu.createEmpty(i);const o=F1e(t,n,r),{cylinders:s,boundingSphere:a}=$ye(0,o,r,i);if(a)s.setBoundingSphere(a);else if(s.cylinderCount>0){const{child:l}=t,c=ke.expand(ke(),(l??t).boundary.sphere,1*r.sizeFactor);s.setBoundingSphere(c)}return s}function Uvt(e,t,n,r,i){if(!t.interUnitBonds.edgeCount)return on.createEmpty(i);const o=F1e(t,n,r),{mesh:s,boundingSphere:a}=n2(0,o,r,i);if(a)s.setBoundingSphere(a);else if(s.triangleCount>0){const{child:l}=t,c=ke.expand(ke(),(l??t).boundary.sphere,1*r.sizeFactor);s.setBoundingSphere(c)}return s}const IO={...kA,...Wmt,...I$,sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:0,max:3,step:.01}),tryUseImpostor:I.Boolean(!0),includeParent:I.Boolean(!1)};function O1e(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?function zvt(e){return function $mt(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:Wu.Utils},t)}({defaultProps:I.getDefaultValues(IO),createGeometry:jvt,createLocationIterator:(t,n)=>fv.fromStructure(t,{includeLocation2:"interpolate"===n.colorMode}),getLoci:P$,eachLocation:M$,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.sizeAspectRatio!==r.sizeAspectRatio||n.linkScale!==r.linkScale||n.linkSpacing!==r.linkSpacing||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.linkCap!==r.linkCap||n.aromaticScale!==r.aromaticScale||n.aromaticSpacing!==r.aromaticSpacing||n.aromaticDashCount!==r.aromaticDashCount||n.dashCount!==r.dashCount||n.dashScale!==r.dashScale||n.dashCap!==r.dashCap||n.stubCap!==r.stubCap||!Ru(n.includeTypes,r.includeTypes)||!Ru(n.excludeTypes,r.excludeTypes)||n.adjustCylinderLength!==r.adjustCylinderLength||n.multipleBonds!==r.multipleBonds,n.colorMode!==r.colorMode&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0),s.interUnitBonds!==a.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function Vvt(e){return Hy({defaultProps:I.getDefaultValues(IO),createGeometry:Uvt,createLocationIterator:t=>fv.fromStructure(t),getLoci:P$,eachLocation:M$,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.sizeAspectRatio!==r.sizeAspectRatio||n.radialSegments!==r.radialSegments||n.linkScale!==r.linkScale||n.linkSpacing!==r.linkSpacing||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.linkCap!==r.linkCap||n.aromaticScale!==r.aromaticScale||n.aromaticSpacing!==r.aromaticSpacing||n.aromaticDashCount!==r.aromaticDashCount||n.dashCount!==r.dashCount||n.dashScale!==r.dashScale||n.dashCap!==r.dashCap||n.stubCap!==r.stubCap||!Ru(n.includeTypes,r.includeTypes)||!Ru(n.excludeTypes,r.excludeTypes)||n.adjustCylinderLength!==r.adjustCylinderLength||n.multipleBonds!==r.multipleBonds,s.interUnitBonds!==a.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}const Hvt=tt.add3,Gvt=tt.add;var HA;!function(e){e.create=function t(n=2048,r=1024,i){const o=tt.create(Float32Array,3,r,i?i.centerBuffer.ref.value:n),s=tt.create(Float32Array,1,r,i?i.groupBuffer.ref.value:n);return{add:(a,l,c,u)=>{Hvt(o,a,l,c),Gvt(s,u)},getSpheres:()=>{const a=tt.compact(o,!0),l=tt.compact(s,!0);return Rp.create(a,l,o.elementCount,i)}}}}(HA||(HA={}));const GA=C.add;function g2(e,t,n){const{ignoreHydrogens:r,ignoreHydrogensVariant:i,traceOnly:o}=n,s=ze.isCoarse(t),{child:a}=e,l=a?.unitMap.get(t.id);if(a&&!l)throw new Error("expected childUnit to exist if child exists");if(a||r||o)return c=>!!l&&!rt.has(l.elements,c)||!s&&r&&rm(e,t,c,i)||o&&!bW(t,c)}function qvt(e,t,n,r,i,o){const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return on.createEmpty(o);const{detail:l,sizeFactor:c,stride:u}=i,{elements:d,conformation:f}=t,p=d.length,m=p*qw(l),h=Ct.createState(m,m/2,o),g=C(),y=g2(n,t,i),v=dt.create(n,t),x=r.size.size,_=C();let w=0,A=0;for(let T=0;T<p;T++){if(u&&T%u!=0||y&&y(d[T]))continue;f.invariantPosition(d[T],g),GA(_,_,g),A+=1,v.element=d[T];const F=x(v);F>w&&(w=F),h.currentGroup=T,Jr(h,g,F*c,l)}const M=o?ke.clone(o.boundingSphere):void 0,E=Ct.getMesh(h);if(0===A)return E;let D;return C.scale(_,_,1/A),D=M&&C.distance(_,M.center)/M.radius<.1?M:ke.expand(ke(),(a??t).boundary.sphere,w*c+.05),E.setBoundingSphere(D),E}function Wvt(e,t,n,r,i,o){const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return Rp.createEmpty(o);const{sizeFactor:l,stride:c}=i,{elements:u,conformation:d}=t,f=u.length,p=HA.create(f,f/2,o),m=C(),h=g2(n,t,i),g=dt.create(n,t),y=r.size.size,v=C();let x=0,_=0;if(c&&c>1||h||"uniform"!==r.size.granularity)for(let E=0;E<f;E++){if(c&&E%c!=0||h&&h(u[E]))continue;d.invariantPosition(u[E],m),p.add(m[0],m[1],m[2],E),GA(v,v,m),_+=1,g.element=u[E];const D=y(g);D>x&&(x=D)}else{for(let E=0;E<f;E++)d.invariantPosition(u[E],m),p.add(m[0],m[1],m[2],E),GA(v,v,m);_=f,x=y(g)}const w=o?ke.clone(o.boundingSphere):void 0,A=p.getSpheres();if(0===_)return A;let M;return C.scale(v,v,1/_),M=w&&C.distance(v,w.center)/w.radius<.1?w:ke.expand(ke(),(a??t).boundary.sphere,x*l+.05),A.setBoundingSphere(M),A}function um(e,t,n){let r=!1;if(!Me.is(e))return!1;const{structure:i,group:o}=t;if(!Xe.areEquivalent(e.structure,i))return!1;const s=o.elements.length,{unitIndexMap:a}=o;for(const l of e.elements){const c=a.get(l.unit.id);if(void 0!==c){const u=c*s;if(Pe.is(l.indices)){const d=u+Pe.start(l.indices),f=u+Pe.end(l.indices);n(Pe.ofBounds(d,f))&&(r=!0)}else for(let d=0,f=l.indices.length;d<f;d++){const p=l.indices[d];let m=d+1;for(;m<f&&l.indices[m]===p;)m++;d=m-1,r=n(Pe.ofRange(u+p,u+l.indices[d]))||r}}}return r}function dm(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e;if(n===r){const{structure:s,group:a}=t,l=a.units[i],c=Ve.ofSingleton(o);return Me(s.target,[{unit:l,indices:c}])}return qr}function $vt(e,t,n,r,i){const{child:o}=t,{detail:s,sizeFactor:a,stride:l}=r,{getSerialIndex:c}=t.serialMapping,d=t.elementCount*qw(s),f=Ct.createState(d,d/2,i),p=n.size.size,m=C();let h=0,g=0;for(const _ of t.units){const w=o?.unitMap.get(_.id);if(o&&!w)continue;const{elements:A,conformation:M}=_,E=A.length,D=C(),T=g2(t,_,r),F=dt.create(t,_);for(let R=0;R<E;R++){const N=A[R];if(l&&R%l!=0||T&&T(N))continue;M.position(N,D),GA(m,m,D),g+=1,F.element=N;const j=p(F);j>h&&(h=j),f.currentGroup=c(_,N),Jr(f,D,j*a,s)}}const y=i?ke.clone(i.boundingSphere):void 0,v=Ct.getMesh(f);if(0===g)return v;let x;return C.scale(m,m,1/g),x=y&&C.distance(m,y.center)/y.radius<1?y:ke.expand(ke(),(o??t).boundary.sphere,h*a+.05),v.setBoundingSphere(x),v}function Yvt(e,t,n,r,i){const{child:o}=t,{sizeFactor:s,stride:a}=r,{getSerialIndex:l}=t.serialMapping,c=t.elementCount,u=HA.create(c,c/2,i),d=n.size.size,f=C();let p=0,m=0;for(const v of t.units){const x=o?.unitMap.get(v.id);if(o&&!x)return Rp.createEmpty(i);const{elements:_,conformation:w}=v,A=_.length,M=C(),E=g2(t,v,r),D=dt.create(t,v);if(a&&a>1||E||"uniform"!==n.size.granularity)for(let T=0;T<A;T++){const F=_[T];if(a&&T%a!=0||E&&E(F))continue;w.position(F,M),u.add(M[0],M[1],M[2],l(v,F)),GA(f,f,M),m+=1,D.element=F;const R=d(D);R>p&&(p=R)}else{for(let T=0;T<A;T++){const F=_[T];w.position(F,M),u.add(M[0],M[1],M[2],l(v,F)),GA(f,f,M)}m+=A,p=d(D)}}const h=i?ke.clone(i.boundingSphere):void 0,g=u.getSpheres();if(0===m)return g;let y;return C.scale(f,f,1/m),y=h&&C.distance(f,h.center)/h.radius<1?h:ke.expand(ke(),(o??t).boundary.sphere,p*s+.05),g.setBoundingSphere(y),g}function y2(e,t,n){let r=!1;if(!Me.is(e)||!Xe.areEquivalent(e.structure,t))return!1;const{cumulativeUnitElementCount:i}=t.serialMapping;for(const o of e.elements){const s=t.unitIndexMap.get(o.unit.id);if(void 0!==s)if(Pe.is(o.indices)){const a=i[s]+Pe.start(o.indices),l=i[s]+Pe.end(o.indices);n(Pe.ofBounds(a,l))&&(r=!0)}else for(let a=0,l=o.indices.length;a<l;a++)n(Pe.ofSingleton(i[s]+o.indices[a]))&&(r=!0)}return r}function b2(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const{unitIndices:o,cumulativeUnitElementCount:s}=t.serialMapping,a=o[i];return Me(t,[{unit:t.units[a],indices:Ve.ofSingleton(i-s[a])}])}return qr}var vl;!function(e){e.fromGroup=function t(r){const{group:i,structure:o}=r,s=i.elements.length,a=i.units.length,l=dt.create(o);return Vi(s,a,1,(u,d)=>{const f=i.units[d];return l.unit=f,l.element=f.elements[u],l})},e.fromStructure=function n(r){const{units:i,elementCount:o}=r,s=o,{unitIndices:l,elementIndices:c}=r.serialMapping,u=dt.create(r);return Vi(s,1,1,f=>(u.unit=i[l[f]],u.element=c[f],u),!0)}}(vl||(vl={}));const B1e={sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),traceOnly:I.Boolean(!1),tryUseImpostor:I.Boolean(!0),stride:I.Numeric(1,{min:1,max:100,step:1})},EO={...ml,...vW,...B1e};function L1e(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth&&r.extensions.textureFloat?function Xvt(e){return xW({defaultProps:I.getDefaultValues(EO),createGeometry:Wvt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{t.createGeometry=n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.traceOnly!==r.traceOnly||n.stride!==r.stride},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function Kvt(e){return mc({defaultProps:I.getDefaultValues(EO),createGeometry:qvt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.traceOnly!==r.traceOnly||n.stride!==r.stride},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}const j1e={...kA,...Gmt,...B1e};function Zvt(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth&&r.extensions.textureFloat?function Qvt(e){return function qmt(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:Rp.Utils},t)}({defaultProps:I.getDefaultValues(j1e),createGeometry:Yvt,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{t.createGeometry=n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.traceOnly!==r.traceOnly||n.stride!==r.stride},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function Jvt(e){return Hy({defaultProps:I.getDefaultValues(j1e),createGeometry:$vt,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.traceOnly!==r.traceOnly||n.stride!==r.stride},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}const U1e={"element-sphere":(e,t)=>Uo("Element sphere",e,t,L1e),"intra-bond":(e,t)=>Uo("Intra-unit bond cylinder",e,t,M1e),"inter-bond":(e,t)=>Ff("Inter-unit bond cylinder",e,t,O1e)},F$={...EO,traceOnly:I.Boolean(!1,{isHidden:!0}),...AO,...IO,includeParent:I.Boolean(!1),unitKinds:MP(["atomic"]),sizeFactor:I.Numeric(.15,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(2/3,{min:.01,max:3,step:.01}),visuals:I.MultiSelect(["element-sphere","intra-bond","inter-bond"],I.objectToOptions(U1e)),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory)},nxt={name:"ball-and-stick",label:"Ball & Stick",description:"Displays atoms as spheres and bonds as cylinders.",factory:function txt(e,t){return Xn.createMulti("Ball & Stick",e,t,gl,U1e)},getParams:function ext(e,t){if(Xe.getSize(t)>=Xe.Size.Huge){const r=I.clone(F$);return r.visuals.defaultValue=["element-sphere","intra-bond"],r}return F$},defaultValues:I.getDefaultValues(F$),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function rxt(e,t,n,r,i){const{links:o,elements:s}=t.carbohydrates,{linkSizeFactor:a}=r,l=dt.create(t),c={linkCount:o.length,position:(f,p,m)=>{const h=o[m];C.copy(f,s[h.carbohydrateIndexA].geometry.center),C.copy(p,s[h.carbohydrateIndexB].geometry.center)},radius:f=>{const m=s[o[f].carbohydrateIndexA],h=m.unit.rings.all[m.ringIndex];return l.unit=m.unit,l.element=m.unit.elements[h[0]],n.size.size(l)*a}},{mesh:u,boundingSphere:d}=n2(0,c,r,i);if(d)u.setBoundingSphere(d);else if(u.triangleCount>0){const f=ke.expand(ke(),t.boundary.sphere,1*a);u.setBoundingSphere(f)}return u}const z1e={...ml,...t2,linkSizeFactor:I.Numeric(.3,{min:0,max:3,step:.01})};function ixt(e){return Hy({defaultProps:I.getDefaultValues(z1e),createGeometry:rxt,createLocationIterator:oxt,getLoci:sxt,eachLocation:axt,setUpdateState:(t,n,r)=>{t.createGeometry=n.linkSizeFactor!==r.linkSizeFactor||n.radialSegments!==r.radialSegments||n.linkCap!==r.linkCap}},e)}function oxt(e){const{elements:t,links:n}=e.carbohydrates,r=n.length,o=dt.create(e);return Vi(r,1,1,a=>{const c=t[n[a].carbohydrateIndexA],u=c.unit.rings.all[c.ringIndex];return o.unit=c.unit,o.element=c.unit.elements[u[0]],o},!0)}function sxt(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const{links:o,elements:s}=t.carbohydrates,a=o[i],l=s[a.carbohydrateIndexA],c=s[a.carbohydrateIndexB];return Me.union(kP(t,l.unit,l.residueIndex,l.altId),kP(t,c.unit,c.residueIndex,c.altId))}return qr}const O$=new Set;function axt(e,t,n){let r=!1;if(!Me.is(e)||!Xe.areEquivalent(e.structure,t))return!1;const{getLinkIndices:i}=t.carbohydrates;for(const{unit:o,indices:s}of e.elements)ze.isAtomic(o)&&(O$.clear(),Ve.forEach(s,a=>{const l=i(o,o.elements[a]);for(let c=0,u=l.length;c<u;++c)O$.has(l[c])||(O$.add(l[c]),n(Pe.ofSingleton(l[c]))&&(r=!0))}));return r}const lxt=C.create(0,0,-.5),TO=C.create(0,0,.5),pv=C(),hv=C(),DO=C(),V1e=C();let L$,j$;const fxt={pointCount:5,outerRadius:1,innerRadius:.5,thickness:.3},z$=C.zero(),V$=C.zero(),H$=C.zero(),HP=C.zero(),G$=C.zero(),q$=[.5,0,0,-.5,0,0,0,.5,0,0,-.5,0,0,0,.5,0,0,-.5],hxt=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],mxt=[0,2,4,0,4,3,1,2,5,1,5,3];let W$,$$;MD(q$,[0,2,1,3,2,1,3,0,0,4,1,4,2,4,3,4,0,5,1,5,2,5,3,5]);const bn=fe.identity(),tb=C(),G1e=C(),xxt=1.612,q1e=X9(),W1e=function nZe(){return K9||(K9=lfe(!0)),K9}(),_xt=function cxt(){return L$||(L$=function H1e(e){const t=e.length/3,r=(3===t?1:4===t?2:t)+t,o=Hw(r,4===t?3*t+4:3*r);for(let s=0;s<t;++s){const a=(s+1)%t;C.set(pv,e[3*s],e[3*s+1],-.5),C.set(hv,e[3*a],e[3*a+1],-.5),o.add(pv,hv,TO)}if(3===t)C.set(pv,e[0],e[1],-.5),C.set(hv,e[3],e[4],-.5),C.set(DO,e[6],e[7],-.5),o.add(DO,hv,pv);else if(4===t)C.set(pv,e[0],e[1],-.5),C.set(hv,e[3],e[4],-.5),C.set(DO,e[6],e[7],-.5),C.set(V1e,e[9],e[10],-.5),o.addQuad(V1e,DO,hv,pv);else for(let s=0;s<t;++s){const a=(s+1)%t;C.set(pv,e[3*s],e[3*s+1],-.5),C.set(hv,e[3*a],e[3*a+1],-.5),o.add(lxt,hv,pv)}return o.getPrimitive()}(gg(8,!0))),L$}(),$1e=function uxt(){if(!j$){const e=gg(8,!0),t=new Float32Array(30);for(let r=0;r<8;++r)t[3*r]=e[3*r],t[3*r+1]=e[3*r+1],t[3*r+2]=-.5;t[24]=0,t[25]=0,t[26]=-.5,t[27]=0,t[28]=0,t[29]=.5,j$=bN(t,[0,1,8,1,2,8,4,5,8,5,6,8,2,3,9,3,4,9,6,7,9,7,0,9])}return j$}(),Sxt=function pxt(e){const{outerRadius:t,innerRadius:n,thickness:r,pointCount:i}={...fxt,...e},s=Hw(2*i*2),a=new Float32Array(2*i),l=new Float32Array(2*i);for(let c=0;c<i;++c){const u=2*c,d=2*c+1,f=(u+1)/i*Math.PI,p=(d+1)/i*Math.PI;l[u]=Math.cos(f)*t,l[d]=Math.sin(f)*t,a[u]=Math.cos(p)*n,a[d]=Math.sin(p)*n}C.set(z$,0,0,r/2),C.set(V$,0,0,-r/2);for(let c=0;c<i;++c){const u=(c+1)%i;C.set(H$,l[2*c],l[2*c+1],0),C.set(HP,a[2*c],a[2*c+1],0),C.set(G$,l[2*u],l[2*u+1],0),s.add(z$,H$,HP),s.add(HP,H$,V$),s.add(z$,HP,G$),s.add(G$,HP,V$)}return s.getPrimitive()}({outerRadius:1,innerRadius:.5,thickness:.5,pointCount:5}),Cxt=function yxt(){return W$||(W$=bN(q$,hxt)),W$}(),Y1e=function bxt(){return $$||($$=bN(q$,mxt)),$$}(),X1e=function NKe(){return R9||(R9=$w(gg(4,!1))),R9}(),wxt=function FKe(){return N9||(N9=$w(gg(5,!1))),N9}(),Axt=function OKe(){return F9||(F9=$w(gg(6,!1))),F9}(),Ixt=function BKe(){return O9||(O9=$w(gg(6,!0))),O9}(),Ext=function LKe(){return B9||(B9=$w(gg(7,!1))),B9}();function Txt(e,t,n,r,i){const o=Ct.createState(256,128,i),{detail:s,sizeFactor:a}=r,l=t.carbohydrates,c=l.elements.length,u=dt.create(t);for(let d=0;d<c;++d){const f=l.elements[d],p=f.unit.rings.all[f.ringIndex],m=i6e(f.component.type,p.length);u.unit=f.unit,u.element=f.unit.elements[p[0]];const h=n.size.size(u),g=h*a,y=h*a*xxt,{center:v,normal:x,direction:_}=f.geometry;switch(C.add(G1e,v,_),fe.targetTo(bn,v,G1e,x),fe.setTranslation(bn,v),o.currentGroup=2*d,m){case Gi.FilledSphere:Jr(o,v,g,s);break;case Gi.FilledCube:fe.scaleUniformly(bn,bn,y),Ct.addPrimitive(o,bn,q1e);break;case Gi.CrossedCube:fe.scaleUniformly(bn,bn,y),Ct.addPrimitive(o,bn,W1e),fe.mul(bn,bn,fe.rotZ90X180),o.currentGroup+=1,Ct.addPrimitive(o,bn,W1e);break;case Gi.FilledCone:fe.scaleUniformly(bn,bn,1.2*y),Ct.addPrimitive(o,bn,_xt);break;case Gi.DevidedCone:fe.scaleUniformly(bn,bn,1.2*y),Ct.addPrimitive(o,bn,$1e),fe.mul(bn,bn,fe.rotZ90),o.currentGroup+=1,Ct.addPrimitive(o,bn,$1e);break;case Gi.FlatBox:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,y,y,y/2)),Ct.addPrimitive(o,bn,q1e);break;case Gi.FilledStar:fe.scaleUniformly(bn,bn,y),fe.mul(bn,bn,fe.rotZY90),Ct.addPrimitive(o,bn,Sxt);break;case Gi.FilledDiamond:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,1.4*y,1.4*y,1.4*y)),Ct.addPrimitive(o,bn,Cxt);break;case Gi.DividedDiamond:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,1.4*y,1.4*y,1.4*y)),Ct.addPrimitive(o,bn,Y1e),fe.mul(bn,bn,fe.rotY90),o.currentGroup+=1,Ct.addPrimitive(o,bn,Y1e);break;case Gi.FlatDiamond:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,y,y/2,y/2)),Ct.addPrimitive(o,bn,X1e);break;case Gi.DiamondPrism:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,y,y,y/2)),Ct.addPrimitive(o,bn,X1e);break;case Gi.PentagonalPrism:case Gi.Pentagon:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,y,y,y/2)),Ct.addPrimitive(o,bn,wxt);break;case Gi.HexagonalPrism:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,y,y,y/2)),Ct.addPrimitive(o,bn,Axt);break;case Gi.HeptagonalPrism:fe.mul(bn,bn,fe.rotZY90),fe.scale(bn,bn,C.set(tb,y,y,y/2)),Ct.addPrimitive(o,bn,Ext);break;default:fe.mul(bn,bn,fe.rotZYZ90),fe.scale(bn,bn,C.set(tb,y/1.5,y,y/2)),Ct.addPrimitive(o,bn,Ixt)}}return Ct.getMesh(o)}const K1e={...kA,detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),sizeFactor:I.Numeric(1.75,{min:0,max:10,step:.01})};function Dxt(e){return Hy({defaultProps:I.getDefaultValues(K1e),createGeometry:Txt,createLocationIterator:Pxt,getLoci:kxt,eachLocation:Mxt,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail}},e)}function Pxt(e){const t=e.carbohydrates.elements,n=2*t.length,i=dt.create(e);return Vi(n,1,1,function o(a,l){const c=t[Math.floor(a/2)],u=c.unit.rings.all[c.ringIndex];return i.unit=c.unit,i.element=c.unit.elements[u[0]],i},!0,function s(a,l){return a%2==1})}function kxt(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const o=t.carbohydrates.elements[Math.floor(i/2)];return kP(t,o.unit,o.residueIndex,o.altId)}return qr}const Y$=new Set;function Mxt(e,t,n){const{getElementIndices:r}=t.carbohydrates;let i=!1;if(!Me.is(e)||!Xe.areEquivalent(e.structure,t))return!1;for(const{unit:o,indices:s}of e.elements)ze.isAtomic(o)&&(Y$.clear(),Ve.forEach(s,a=>{const l=r(o,o.elements[a]);for(let c=0,u=l.length;c<u;++c)Y$.has(l[c])||(Y$.add(l[c]),n(Pe.ofSingleton(2*l[c]))&&(i=!0))}));return i}function Rxt(e,t,n,r,i){const{terminalLinks:o,elements:s}=t.carbohydrates,{terminalLinkSizeFactor:a}=r,l=dt.create(t),c={linkCount:o.length,position:(f,p,m)=>{const h=o[m];h.fromCarbohydrate?(C.copy(f,s[h.carbohydrateIndex].geometry.center),h.elementUnit.conformation.position(h.elementUnit.elements[h.elementIndex],p)):(h.elementUnit.conformation.position(h.elementUnit.elements[h.elementIndex],f),C.copy(p,s[h.carbohydrateIndex].geometry.center))},radius:f=>{const p=o[f];if(p.fromCarbohydrate){const m=s[p.carbohydrateIndex],h=m.unit.rings.all[m.ringIndex];l.unit=m.unit,l.element=m.unit.elements[h[0]]}else l.unit=p.elementUnit,l.element=p.elementUnit.elements[p.elementIndex];return n.size.size(l)*a},style:f=>{const p=o[f],h=ig(p.elementUnit.model.atomicHierarchy.atoms.type_symbol.value(p.elementUnit.elements[p.elementIndex]));return D3.has(h)?1:0}},{mesh:u,boundingSphere:d}=n2(0,c,r,i);if(d)u.setBoundingSphere(d);else if(u.triangleCount>0){const f=ke.expand(ke(),t.boundary.sphere,1*a);u.setBoundingSphere(f)}return u}const Z1e={...ml,...t2,terminalLinkSizeFactor:I.Numeric(.2,{min:0,max:3,step:.01})};function Nxt(e){return Hy({defaultProps:I.getDefaultValues(Z1e),createGeometry:Rxt,createLocationIterator:Fxt,getLoci:Oxt,eachLocation:Bxt,setUpdateState:(t,n,r)=>{t.createGeometry=n.terminalLinkSizeFactor!==r.terminalLinkSizeFactor||n.radialSegments!==r.radialSegments||n.linkCap!==r.linkCap}},e)}function Fxt(e){const{elements:t,terminalLinks:n}=e.carbohydrates,r=n.length,o=dt.create(e);return Vi(r,1,1,a=>{const l=n[a];if(l.fromCarbohydrate){const c=t[l.carbohydrateIndex],u=c.unit.rings.all[c.ringIndex];o.unit=c.unit,o.element=c.unit.elements[u[0]]}else o.unit=l.elementUnit,o.element=l.elementUnit.elements[l.elementIndex];return o},!0)}function Oxt(e,t,n){const{objectId:r,groupId:i}=e;if(n===r){const{terminalLinks:o,elements:s}=t.carbohydrates,a=o[i],l=s[a.carbohydrateIndex];return Me.union(kP(t,l.unit,l.residueIndex,l.altId),function Nmt(e,t,n){const{elements:r,model:i}=t,{label_alt_id:o}=i.atomicHierarchy.atoms,s=o.value(n);if(-1!==Ve.indexOf(r,n)){const{index:a}=i.atomicHierarchy.residueAtomSegments;return kP(e,t,a[n],s)}return Me(e,[])}(t,a.elementUnit,a.elementUnit.elements[a.elementIndex]))}return qr}const X$=new Set;function Bxt(e,t,n){let r=!1;if(!Me.is(e)||!Xe.areEquivalent(e.structure,t))return!1;const{getTerminalLinkIndices:i}=t.carbohydrates;for(const{unit:o,indices:s}of e.elements)ze.isAtomic(o)&&(X$.clear(),Ve.forEach(s,a=>{const l=i(o,o.elements[a]);for(let c=0,u=l.length;c<u;++c)X$.has(l[c])||(X$.add(l[c]),n(Pe.ofSingleton(l[c]))&&(r=!0))}));return r}const Q1e={"carbohydrate-symbol":(e,t)=>Ff("Carbohydrate symbol mesh",e,t,Dxt),"carbohydrate-link":(e,t)=>Ff("Carbohydrate link cylinder",e,t,ixt),"carbohydrate-terminal-link":(e,t)=>Ff("Carbohydrate terminal link cylinder",e,t,Nxt)},J1e={...K1e,...z1e,...Z1e,visuals:I.MultiSelect(["carbohydrate-symbol","carbohydrate-link","carbohydrate-terminal-link"],I.objectToOptions(Q1e)),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory)},Uxt={name:"carbohydrate",label:"Carbohydrate",description:"Displays carbohydrate symbols (3D SNFG).",factory:function jxt(e,t){return Xn.createMulti("Carbohydrate",e,t,gl,Q1e)},getParams:function Lxt(e,t){return J1e},defaultValues:I.getDefaultValues(J1e),defaultColorTheme:{name:"carbohydrate-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.models.some(t=>Sn.hasCarbohydrate(t))};function eve(e,t){switch(e.kind){case 0:return function zxt(e,t){const n=e.model.atomicRanges.cyclicPolymerMap,r=Di.transientSegments(qP(e),e.elements),i=En.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),o=e.model.atomicHierarchy.derived.residue.traceElementIndex,{moleculeType:s}=e.model.atomicHierarchy.derived.residue;let a=-1,l=-1,c=!0,u=-1,d=0;for(;r.hasNext;){for(c=!0,u=d,i.setSegment(r.move());i.hasNext;){if(c){const p=i.move().index;if(++d,!i.hasNext)continue;c=!1,l=p}a=l,l=i.move().index,t(o[a],o[l],d-1,d,s[a]),++d}n.has(l)&&(a=l,l=n.get(a),t(o[a],o[l],d-1,u,s[a]))}}(e,t);case 1:case 2:return function Vxt(e,t){const n=Di.transientSegments(qP(e),e.elements),{elements:r}=e;let i=!0,o=0;for(;n.hasNext;){i=!0;const s=n.move();for(let c=s.start,u=s.end;c<u;++c){if(i){if(++c,++o,c>u)continue;i=!1}t(r[c-1],r[c],o-1,o,0),++o}}}(e,t)}}function tve(e,t){switch(e.kind){case 0:return function Hxt(e,t){const n=Di.transientSegments(qP(e),e.elements),r=En.transientSegments(e.model.atomicHierarchy.residueAtomSegments,e.elements),i=e.model.atomicHierarchy.derived.residue.traceElementIndex;let o=0;for(;n.hasNext;)for(r.setSegment(n.move());r.hasNext;)t(i[r.move().index],o),++o}(e,t);case 1:case 2:return function Gxt(e,t){const n=Di.transientSegments(qP(e),e.elements),{elements:r}=e;let i=0;for(;n.hasNext;){const o=n.move();for(let l=o.start,c=o.end;l<c;++l)t(r[l],i),++i}}(e,t)}}function nve(e,t){return{centerA:dt.create(e,t),centerB:dt.create(e,t)}}class Wxt{move(){const{elements:t,residueIndex:n}=this.unit,r=this.gapIt.move();return this.value.centerA.element=this.traceElementIndex[n[t[r.start]]],this.value.centerB.element=this.traceElementIndex[n[t[r.end-1]]],this.hasNext=this.gapIt.hasNext,this.value}constructor(t,n){this.unit=n,this.hasNext=!1,this.traceElementIndex=n.model.atomicHierarchy.derived.residue.traceElementIndex,this.gapIt=Di.transientSegments(dve(n),n.elements),this.value=nve(t,n),this.hasNext=this.gapIt.hasNext}}class $xt{move(){const t=this.gapIt.move();return this.value.centerA.element=this.unit.elements[t.start],this.value.centerB.element=this.unit.elements[t.end-1],this.hasNext=this.gapIt.hasNext,this.value}constructor(t,n){this.unit=n,this.hasNext=!1,this.gapIt=Di.transientSegments(dve(n),n.elements),this.value=nve(t,n),this.hasNext=this.gapIt.hasNext}}function Yxt(e){const{x:t,y:n,z:r}=e.atomicConformation,{polymerType:i,traceElementIndex:o}=e.atomicHierarchy.derived.residue,s=i.length,a=Ve.ofBounds(0,e.atomicConformation.atomId.rowCount),l=Di.transientSegments(e.atomicRanges.polymerRanges,a),c=En.transientSegments(e.atomicHierarchy.residueAtomSegments,a),u=new Float32Array(3*s),d=new Float32Array(3*s);let f=0,p=-1,m=-1;const h=C(),g=C(),y=C(),v=C(),x=C(),_=C(),w=C(),A=C(),M=C(),E=C(),D=C(),T=C(),F=C(),R=C();for(;l.hasNext;){const N=l.move();for(c.setSegment(N),f=-1,m=-1;c.hasNext;){f+=1;const{index:X}=c.move();0===f&&(m=X),p=X-2;const H=3*p;C.copy(h,g),C.copy(g,y),C.copy(y,v);const oe=o[X];if(C.set(v,t[oe],n[oe],r[oe]),f<3)continue;C.sub(x,g,h),C.sub(_,y,g),C.sub(w,v,y),C.sub(D,x,_),C.sub(T,_,w),C.cross(F,D,T),C.normalize(F,F),C.toArray(F,d,H);const te=Math.cos(C.angle(D,T)),K=C.magnitude(D),Q=C.magnitude(T),G=Math.sqrt(Q*K)/Math.max(2,2*(1-te));C.scale(A,D,G/K),C.sub(A,g,A),C.toArray(A,u,H),C.scale(M,T,G/Q),C.sub(M,y,M),C.toArray(M,u,H+3),C.copy(R,F)}const j=3*m;C.fromArray(A,u,j+3),C.fromArray(M,u,j+6),C.normalize(F,C.sub(F,A,M));const W=o[m];C.set(h,t[W],n[W],r[W]),C.copy(E,h),C.projectPointOnVector(E,E,F,A),C.toArray(E,u,j);const z=p+2,$=3*z;C.fromArray(A,u,$-3),C.fromArray(M,u,$-6),C.normalize(F,C.sub(F,A,M));const V=o[z];C.set(h,t[V],n[V],r[V]),C.copy(E,h),C.projectPointOnVector(E,E,F,A),C.toArray(E,u,$)}return{centers:u}}const K$=f_.createProvider({label:"Helix Orientation",descriptor:hf({name:"molstar_helix_orientation"}),type:"dynamic",defaultParams:{},getParams:()=>({}),isApplicable:e=>!0,obtain:function(){var e=le(function*(t,n){return{value:Yxt(n)}});return function(n,r){return e.apply(this,arguments)}}()});function fm(e){return pi.is(e,2)}function Z$(e,t,n={}){switch(e.kind){case 0:return new Kxt(e,t,n);case 1:case 2:return new Zxt(e,t)}}const PO=pi.create(536870912);function rve(e,t){return{center:dt.create(e,t),centerPrev:dt.create(e,t),centerNext:dt.create(e,t),first:!1,last:!1,initial:!1,final:!1,secStrucFirst:!1,secStrucLast:!1,secStrucType:PO,moleculeType:0,coarseBackboneFirst:!1,coarseBackboneLast:!1,isCoarseBackbone:!1,p0:C(),p1:C(),p2:C(),p3:C(),p4:C(),d12:C(),d23:C()}}const Un=C(),kO=C(),MO=C();class Kxt{atomicPos(t,n){-1!==n&&(t[0]=this.atomicConformation.x[n],t[1]=this.atomicConformation.y[n],t[2]=this.atomicConformation.z[n])}pos(t,n,r){const i=this.traceElementIndex[n];this.helixOrientationCenters&&fm(r)?C.fromArray(t,this.helixOrientationCenters,3*n):this.atomicPos(t,i)}updateResidueSegmentRange(t){const{index:n}=this.residueAtomSegments;this.residueSegmentMin=n[this.polymerRanges[2*t.index]],this.residueSegmentMax=n[this.polymerRanges[2*t.index+1]]}getResidueIndex(t){if(t<this.residueSegmentMin){const n=this.cyclicPolymerMap.get(this.residueSegmentMin);t=void 0!==n?n-(this.residueSegmentMin-t-1):this.residueSegmentMin}else if(t>this.residueSegmentMax){const n=this.cyclicPolymerMap.get(this.residueSegmentMax);t=void 0!==n?n+(t-this.residueSegmentMax-1):this.residueSegmentMax}return t}getSecStruc(t){if(this.secondaryStructure){const{type:n,getIndex:r}=this.secondaryStructure,i=n[r(t)];return fm(i)?2:i}return PO}setControlPoint(t,n,r,i,o){(function Xxt(e){return pi.is(e,4)})(o)||this.helixOrientationCenters&&fm(o)?C.scale(t,C.add(t,n,C.add(t,i,C.add(t,r,r))),1/4):C.copy(t,r)}setFromToVector(t,n,r){this.value.isCoarseBackbone||this.helixOrientationCenters&&fm(r)?C.set(t,1,0,0):(this.atomicPos(kO,this.directionFromElementIndex[n]),this.atomicPos(MO,this.directionToElementIndex[n]),C.sub(t,MO,kO))}setDirection(t,n,r,i){C.matchDirection(kO,n,r),C.matchDirection(MO,i,r),C.scale(t,C.add(t,kO,C.add(t,MO,C.add(t,r,r))),1/4)}move(){const{residueIt:t,polymerIt:n,value:r}=this;if(0===this.state)for(;n.hasNext;)if(this.polymerSegment=n.move(),t.setSegment(this.polymerSegment),this.updateResidueSegmentRange(this.polymerSegment),t.hasNext){this.state=1;const i=this.residueAtomSegments.index[this.unit.elements[this.polymerSegment.start]],o=this.getResidueIndex(i-1);this.currSecStrucType=i===o?PO:this.getSecStruc(o),this.nextSecStrucType=this.getSecStruc(i),this.currCoarseBackbone=-1===this.directionFromElementIndex[o]||-1===this.directionToElementIndex[o],this.nextCoarseBackbone=-1===this.directionFromElementIndex[i]||-1===this.directionToElementIndex[i];break}if(1===this.state){const{index:i}=t.move(),o=this.getResidueIndex(i-3),s=this.getResidueIndex(i-2),a=this.getResidueIndex(i-1),l=this.getResidueIndex(i+1),c=this.getResidueIndex(i+2),u=this.getResidueIndex(i+3);this.prevSecStrucType=this.getSecStruc(a),this.currSecStrucType=this.getSecStruc(i),this.nextSecStrucType=i===l?PO:this.getSecStruc(l),this.prevCoarseBackbone=this.currCoarseBackbone,this.currCoarseBackbone=this.nextCoarseBackbone,this.nextCoarseBackbone=-1===this.directionFromElementIndex[l]||-1===this.directionToElementIndex[l],r.secStrucType=this.currSecStrucType,r.secStrucFirst=this.prevSecStrucType!==this.currSecStrucType,r.secStrucLast=this.currSecStrucType!==this.nextSecStrucType,r.isCoarseBackbone=this.currCoarseBackbone,r.coarseBackboneFirst=this.prevCoarseBackbone!==this.currCoarseBackbone,r.coarseBackboneLast=this.currCoarseBackbone!==this.nextCoarseBackbone,r.first=i===this.residueSegmentMin,r.last=i===this.residueSegmentMax,r.moleculeType=this.moleculeType[i],r.initial=i===a,r.final=i===l,r.centerPrev.element=this.traceElementIndex[a],r.center.element=this.traceElementIndex[i],r.centerNext.element=this.traceElementIndex[l];const d=this.getSecStruc(o),f=this.getSecStruc(s),p=this.getSecStruc(a),m=this.getSecStruc(i),h=this.getSecStruc(l),g=this.getSecStruc(c),y=this.getSecStruc(u);this.pos(this.p0,o,d),this.pos(this.p1,s,f),this.pos(this.p2,a,p),this.pos(this.p3,i,m),this.pos(this.p4,l,h),this.pos(this.p5,c,g),this.pos(this.p6,u,y);const v=fm(d),x=fm(f),_=fm(p),w=fm(m),A=fm(h),M=fm(g),E=fm(y);this.helixOrientationCenters&&(w!==_?w?(C.copy(this.p0,this.p3),C.copy(this.p1,this.p3),C.copy(this.p2,this.p3)):_&&(C.scale(Un,C.sub(Un,this.p2,this.p3),2),C.add(this.p2,this.p3,Un),C.add(this.p1,this.p2,Un),C.add(this.p0,this.p1,Un)):w!==x?w?(C.copy(this.p0,this.p2),C.copy(this.p1,this.p2)):x&&(C.scale(Un,C.sub(Un,this.p1,this.p2),2),C.add(this.p1,this.p2,Un),C.add(this.p0,this.p1,Un)):w!==v&&(w?C.copy(this.p0,this.p1):v&&(C.scale(Un,C.sub(Un,this.p0,this.p1),2),C.add(this.p0,this.p1,Un))),w!==A?w?(C.copy(this.p4,this.p3),C.copy(this.p5,this.p3),C.copy(this.p6,this.p3)):A&&(C.scale(Un,C.sub(Un,this.p4,this.p3),2),C.add(this.p4,this.p3,Un),C.add(this.p5,this.p4,Un),C.add(this.p6,this.p5,Un)):w!==M?w?(C.copy(this.p5,this.p4),C.copy(this.p6,this.p4)):M&&(C.scale(Un,C.sub(Un,this.p5,this.p4),2),C.add(this.p5,this.p4,Un),C.add(this.p6,this.p5,Un)):w!==E&&(w?C.copy(this.p6,this.p5):E&&(C.scale(Un,C.sub(Un,this.p6,this.p5),2),C.add(this.p6,this.p5,Un)))),this.setFromToVector(this.d01,a,p),this.setFromToVector(this.d12,i,m),this.setFromToVector(this.d23,l,h),this.setFromToVector(this.d34,c,g);const D=w&&this.helixOrientationCenters,T=1.5;i===a||m!==p&&D?(C.setMagnitude(Un,C.sub(Un,this.p3,this.p4),T),C.add(this.p2,this.p3,Un),C.add(this.p1,this.p2,Un),C.add(this.p0,this.p1,Un)):a===s||m!==f&&D?(C.setMagnitude(Un,C.sub(Un,this.p2,this.p3),T),C.add(this.p1,this.p2,Un),C.add(this.p0,this.p1,Un)):(s===o||m!==d&&D)&&(C.setMagnitude(Un,C.sub(Un,this.p1,this.p2),T),C.add(this.p0,this.p1,Un)),i===l||m!==h&&D?(C.setMagnitude(Un,C.sub(Un,this.p3,this.p2),T),C.add(this.p4,this.p3,Un),C.add(this.p5,this.p4,Un),C.add(this.p6,this.p5,Un)):l===c||m!==g&&D?(C.setMagnitude(Un,C.sub(Un,this.p4,this.p3),T),C.add(this.p5,this.p4,Un),C.add(this.p6,this.p5,Un)):(c===u||m!==y&&D)&&(C.setMagnitude(Un,C.sub(Un,this.p5,this.p4),T),C.add(this.p6,this.p5,Un)),this.setControlPoint(r.p0,this.p0,this.p1,this.p2,f),this.setControlPoint(r.p1,this.p1,this.p2,this.p3,p),this.setControlPoint(r.p2,this.p2,this.p3,this.p4,m),this.setControlPoint(r.p3,this.p3,this.p4,this.p5,h),this.setControlPoint(r.p4,this.p4,this.p5,this.p6,g),this.setDirection(r.d12,this.d01,this.d12,this.d23),this.setDirection(r.d23,this.d12,this.d23,this.d34),t.hasNext||(this.state=0)}return this.hasNext=t.hasNext||n.hasNext,this.value}constructor(t,n,r={}){var i;if(this.unit=t,this.state=0,this.p0=C(),this.p1=C(),this.p2=C(),this.p3=C(),this.p4=C(),this.p5=C(),this.p6=C(),this.d01=C(),this.d12=C(),this.d23=C(),this.d34=C(),this.hasNext=!1,this.atomicConformation=t.model.atomicConformation,this.residueAtomSegments=t.model.atomicHierarchy.residueAtomSegments,this.polymerRanges=t.model.atomicRanges.polymerRanges,this.traceElementIndex=t.model.atomicHierarchy.derived.residue.traceElementIndex,this.directionFromElementIndex=t.model.atomicHierarchy.derived.residue.directionFromElementIndex,this.directionToElementIndex=t.model.atomicHierarchy.derived.residue.directionToElementIndex,this.moleculeType=t.model.atomicHierarchy.derived.residue.moleculeType,this.cyclicPolymerMap=t.model.atomicRanges.cyclicPolymerMap,this.polymerIt=Di.transientSegments(this.polymerRanges,t.elements),this.residueIt=En.transientSegments(this.residueAtomSegments,t.elements),this.value=rve(n,t),this.hasNext=this.residueIt.hasNext&&this.polymerIt.hasNext,r.ignoreSecondaryStructure||(this.secondaryStructure=null===(i=gp.get(n).value)||void 0===i?void 0:i.get(t.invariantId)),r.useHelixOrientation){const o=K$.get(t.model).value;if(!o)throw new Error("missing helix-orientation");this.helixOrientationCenters=o.centers}}}class Zxt{getElementIndex(t){return Math.min(Math.max(this.polymerSegment.start,t),this.polymerSegment.end-1)}pos(t,n){const r=this.unit.elements[n];t[0]=this.conformation.x[r],t[1]=this.conformation.y[r],t[2]=this.conformation.z[r]}move(){if(0===this.state)for(;this.polymerIt.hasNext;)if(this.polymerSegment=this.polymerIt.move(),this.elementIndex=this.polymerSegment.start,this.elementIndex<this.polymerSegment.end){this.state=1;break}if(1===this.state){const t=this.getElementIndex(this.elementIndex-2),n=this.getElementIndex(this.elementIndex-1),r=this.getElementIndex(this.elementIndex+1),i=this.getElementIndex(this.elementIndex+2);this.value.centerPrev.element=this.value.center.unit.elements[n],this.value.center.element=this.value.center.unit.elements[this.elementIndex],this.value.centerNext.element=this.value.center.unit.elements[r],this.pos(this.value.p0,t),this.pos(this.value.p1,n),this.pos(this.value.p2,this.elementIndex),this.pos(this.value.p3,r),this.pos(this.value.p4,i);const o=.5;this.elementIndex===n?(C.scale(Un,C.sub(Un,this.value.p2,this.value.p3),o),C.add(this.value.p1,this.value.p2,Un),C.add(this.value.p0,this.value.p1,Un)):n===t&&(C.scale(Un,C.sub(Un,this.value.p1,this.value.p2),o),C.add(this.value.p0,this.value.p1,Un)),this.elementIndex===r?(C.scale(Un,C.sub(Un,this.value.p2,this.value.p1),o),C.add(this.value.p3,this.value.p2,Un),C.add(this.value.p4,this.value.p3,Un)):r===i&&(C.scale(Un,C.sub(Un,this.value.p3,this.value.p2),o),C.add(this.value.p4,this.value.p3,Un)),this.value.first=this.elementIndex===this.polymerSegment.start,this.value.last=this.elementIndex===this.polymerSegment.end-1,this.elementIndex+1>=this.polymerSegment.end&&(this.state=0)}return this.hasNext=this.elementIndex+1<this.polymerSegment.end||this.polymerIt.hasNext,this.elementIndex+=1,this.value}constructor(t,n){switch(this.unit=t,this.state=0,this.hasNext=!1,this.polymerIt=Di.transientSegments(qP(t),t.elements),this.value=rve(n,t),C.set(this.value.d12,1,0,0),C.set(this.value.d23,1,0,0),t.kind){case 1:this.conformation=t.model.coarseConformation.spheres;break;case 2:this.conformation=t.model.coarseConformation.gaussians}this.hasNext=this.polymerIt.hasNext}}const v2=C.fromArray,qA=C.toArray,Q$=C.normalize,Qxt=C.sub,WA=C.spline,Jxt=C.slerp,ive=C.copy,ove=C.cross,J$=C.orthogonalize,e_t=C.matchDirection,t_t=C.scale,sve=C.add;function eY(e){const t=e+1,n=3*t;return{curvePoints:new Float32Array(n),tangentVectors:new Float32Array(n),normalVectors:new Float32Array(n),binormalVectors:new Float32Array(n),widthValues:new Float32Array(t),heightValues:new Float32Array(t),linearSegments:e}}function tY(e,t,n,r){(function n_t(e,t,n,r){const{curvePoints:i,tangentVectors:o,linearSegments:s}=e,{p0:a,p1:l,p2:c,p3:u,p4:d,secStrucFirst:f,secStrucLast:p}=t,m=1-r,h=f?.5:n,g=p?.5:n;for(let y=0;y<=s;++y){const v=1*y/s;if(v<m){const x=Po(h,n,v);WA(iY,a,l,c,u,v+r,x),WA(nY,a,l,c,u,v+r+.01,h),WA(rY,a,l,c,u,v+r-.01,h)}else{const x=Po(n,g,v);WA(iY,l,c,u,d,v-m,x),WA(nY,l,c,u,d,v-m+.01,x),WA(rY,l,c,u,d,v-m-.01,x)}qA(iY,i,3*y),Q$(mv,Qxt(mv,nY,rY)),qA(mv,o,3*y)}})(e,t,n,r),function i_t(e,t){const{curvePoints:n,tangentVectors:r,normalVectors:i,binormalVectors:o}=e,{d12:s,d23:a}=t,l=n.length/3;v2(lve,r,0),v2(cve,r,3*(l-1)),J$(oY,lve,s),J$(RO,cve,a),e_t(RO,RO,oY),ive(GP,oY);const c=l-1;for(let u=0;u<l;++u){const d=roe(0,c,u)*c,f=0===u?0:1/(l-d);v2(mv,r,3*u),J$(pm,mv,Jxt(r_t,GP,RO,f)),qA(pm,i,3*u),ive(GP,pm),Q$($A,ove($A,mv,pm)),qA($A,o,3*u)}for(let u=1;u<c;++u)v2(GP,i,3*(u-1)),v2(pm,i,3*u),v2(ave,i,3*(u+1)),t_t(pm,sve(pm,GP,sve(pm,ave,pm)),1/3),qA(pm,i,3*u),v2(mv,r,3*u),Q$($A,ove($A,mv,pm)),qA($A,o,3*u)}(e,t)}const nY=C(),rY=C(),iY=C(),r_t=C(),mv=C(),pm=C(),$A=C(),GP=C(),ave=C(),lve=C(),cve=C(),oY=C(),RO=C();function sY(e,t,n,r,i,o,s,a){const{widthValues:l,heightValues:c,linearSegments:u}=e,d=1-a;for(let f=0;f<=u;++f){const p=1*f/u;p<d?(l[f]=Po(t,n,p+a),c[f]=Po(i,o,p+a)):(l[f]=Po(n,r,p-d),c[f]=Po(o,s,p-d))}}const uve=.5,o_t=.9,NO=.5,FO=.3,OO=2;function qP(e){switch(e.kind){case 0:return e.model.atomicRanges.polymerRanges;case 1:return e.model.coarseHierarchy.spheres.polymerRanges;case 2:return e.model.coarseHierarchy.gaussians.polymerRanges}}function dve(e){switch(e.kind){case 0:return e.model.atomicRanges.gapRanges;case 1:return e.model.coarseHierarchy.spheres.gapRanges;case 2:return e.model.coarseHierarchy.gaussians.gapRanges}}var nb,aY,rb;function x2(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e;if(n===r){const{structure:s,group:a}=t,l=a.units[i];if(ze.isAtomic(l))return Mye(s,l,l.polymerElements[o]);{const{elements:c}=l,d=Ve.indexOf(c,l.polymerElements[o]);if(-1!==d)return Me(s,[{unit:l,indices:Ve.ofSingleton(d)}])}}return qr}function fve(e,t,n,r,i,o){let s=-1,a=-1;for(let c=i;c<=o;c++){const u=n[c];if(!(u<0)&&(s=Ve.indexOf(t,u),s>=0)){a=c;break}}if(s<0)return!1;let l=s;for(let c=o;c>a;c--){const u=n[c];if(u<0)continue;const d=Ve.indexOf(t,u);if(d>=0){l=d;break}}return r(Pe.ofRange(e+s,e+l))}function pve(e,t,n,r,i){let o=!1;const{elements:s}=i.unit,{traceElementIndex:a}=i.unit.model.atomicHierarchy.derived.residue,{index:l}=i.unit.model.atomicHierarchy.residueAtomSegments,c=n(i.unit);if(Pe.is(i.indices))o=0===Pe.start(i.indices)&&Pe.end(i.indices)===i.unit.elements.length?r(Pe.ofBounds(e,e+t))||o:fve(e,c,a,r,l[s[Pe.min(i.indices)]],l[s[Pe.max(i.indices)]])||o;else{const{indices:u}=i;for(let d=0,f=u.length;d<f;d++){const p=l[s[u[d]]];let m=p,h=d+1;for(;h<f;){const g=l[s[u[h]]];if(g-m>1)break;m=g,h++}d=h-1,o=fve(e,c,a,r,p,m)||o}}return o}function s_t(e){return e.polymerElements}function _2(e,t,n){let r=!1;if(!Me.is(e))return!1;const{structure:i,group:o}=t;if(!Xe.areEquivalent(e.structure,i))return!1;const s=o.units[0].polymerElements.length;for(const a of e.elements){if(!o.unitIndexMap.has(a.unit.id))continue;const l=o.unitIndexMap.get(a.unit.id)*s;if(ze.isAtomic(a.unit))r=pve(l,s,s_t,n,a)||r;else if(Pe.is(a.indices)){const c=l+Pe.start(a.indices),u=l+Pe.end(a.indices);r=n(Pe.ofBounds(c,u))||r}else for(let c=0,u=a.indices.length;c<u;c++){const d=a.indices[c];let f=c+1;for(;f<u&&a.indices[f]===d;)f++;c=f-1,r=n(Pe.ofRange(l+d,l+a.indices[c]))||r}}return r}function a_t(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e;if(n===r){const{structure:s,group:a}=t,l=a.units[i],c=Ve.indexOf(l.elements,l.gapElements[o]),u=Ve.indexOf(l.elements,l.gapElements[o%2?o-1:o+1]);if(-1!==c&&-1!==u)return fn.Loci(s,[fn.Location(s,l,c,s,l,u),fn.Location(s,l,u,s,l,c)])}return qr}function l_t(e,t,n){let r=!1;if(fn.isLoci(e)){const{structure:i,group:o}=t;if(!Xe.areRootsEquivalent(e.structure,i))return!1;e=fn.remapLoci(e,i);const s=o.units[0].gapElements.length;for(const a of e.bonds){const l=o.unitIndexMap.get(a.aUnit.id);if(void 0!==l){const c=Ve.indexOf(a.aUnit.gapElements,a.aUnit.elements[a.aIndex]),u=Ve.indexOf(a.bUnit.gapElements,a.bUnit.elements[a.bIndex]);-1!==c&&-1!==u&&n(Pe.ofSingleton(l*s+c))&&(r=!0)}}}else if(Me.is(e)){const{structure:i,group:o}=t;if(!Xe.areRootsEquivalent(e.structure,i))return!1;e=Me.remap(e,i);const s=o.units[0].gapElements.length;for(const a of e.elements){const l=o.unitIndexMap.get(a.unit.id);void 0!==l&&Ve.forEach(a.indices,c=>{const u=Ve.indexOf(a.unit.gapElements,a.unit.elements[c]);-1!==u&&n(Pe.ofSingleton(l*s+u))&&(r=!0)})}}return r}function S2(e,t,n){const{objectId:r,instanceId:i,groupId:o}=e;if(n===r){const{structure:s,group:a}=t,l=a.units[i];if(ze.isAtomic(l))return Mye(s,l,l.nucleotideElements[o])}return qr}function c_t(e){return e.nucleotideElements}function C2(e,t,n){let r=!1;if(!Me.is(e))return!1;const{structure:i,group:o}=t;if(!Xe.areEquivalent(e.structure,i))return!1;const s=o.units[0];if(!ze.isAtomic(s))return!1;const{nucleotideElements:a}=s,l=a.length;for(const c of e.elements){if(!ze.isAtomic(c.unit)||!o.unitIndexMap.has(c.unit.id))continue;const u=o.unitIndexMap.get(c.unit.id)*l;ze.isAtomic(c.unit)&&(r=pve(u,l,c_t,n,c)||r)}return r}!function(e){e.fromGroup=function t(n,r){const{group:i,structure:o}=n,s=i.units[0].polymerElements,a=s.length,l=i.units.length,c=dt.create(o),d=!!r?.asSecondary;return Vi(a,l,1,(p,m)=>(c.unit=i.units[m],c.element=s[p],c),!1,function f(p,m){return d})}}(nb||(nb={})),function(e){e.fromGroup=function t(n){const{group:r,structure:i}=n,o=r.units[0].gapElements,s=o.length,a=r.units.length,l=dt.create(i);return Vi(s,a,1,(u,d)=>(l.unit=r.units[d],l.element=o[u],l))}}(aY||(aY={})),function(e){e.fromGroup=function t(n){const{group:r,structure:i}=n,o=r.units[0],s=ze.isAtomic(o)?o.nucleotideElements:[],a=s.length,l=r.units.length,c=dt.create(i);return Vi(a,l,1,(d,f)=>(c.unit=r.units[f],c.element=s[d],c))}}(rb||(rb={}));const u_t=C(),d_t=C();function w2(e,t){const{model:n,conformation:r}=e,{residueAtomSegments:i,atoms:o,index:s}=n.atomicHierarchy,{label_comp_id:a}=o,l=a.value(i.offsets[t]);let c=w6e(l),u=A6e(l);if(!c&&!u){const d=s.findAtomOnResidue(t,"C4"),f=s.findAtomOnResidue(t,"N9");-1!==d&&-1!==f&&C.distance(r.invariantPosition(d,u_t),r.invariantPosition(f,d_t))<1.6?c=!0:u=!0}return{isPurine:c,isPyrimidine:u}}function I2(e,t,n){const r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue;return e.trace=i[n],e.N1=r.findAtomOnResidue(n,"N1"),e.C2=r.findAtomOnResidue(n,"C2"),e.N3=r.findAtomOnResidue(n,"N3"),e.C4=r.findAtomOnResidue(n,"C4"),e.C5=r.findAtomOnResidue(n,"C5"),-1===e.C5&&(e.C5=r.findAtomOnResidue(n,"N5")),e.C6=r.findAtomOnResidue(n,"C6"),e.N7=r.findAtomOnResidue(n,"N7"),-1===e.N7&&(e.N7=r.findAtomOnResidue(n,"C7")),e.C8=r.findAtomOnResidue(n,"C8"),e.N9=r.findAtomOnResidue(n,"N9"),e}function YA(e){return-1!==e.trace&&-1!==e.N1&&-1!==e.C2&&-1!==e.N3&&-1!==e.C4&&-1!==e.C5&&-1!==e.C6&&-1!==e.N7&&-1!==e.C8&&-1!==e.N9}function E2(e,t,n){const r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue;return e.trace=i[n],e.N1=r.findAtomOnResidue(n,"N1"),-1===e.N1&&(e.N1=r.findAtomOnResidue(n,"C1")),e.C2=r.findAtomOnResidue(n,"C2"),e.N3=r.findAtomOnResidue(n,"N3"),e.C4=r.findAtomOnResidue(n,"C4"),e.C5=r.findAtomOnResidue(n,"C5"),e.C6=r.findAtomOnResidue(n,"C6"),e}function XA(e){return-1!==e.trace&&-1!==e.N1&&-1!==e.C2&&-1!==e.N3&&-1!==e.C4&&-1!==e.C5&&-1!==e.C6}function WP(e,t,n){const r=t.model.atomicHierarchy.index,{traceElementIndex:i}=t.model.atomicHierarchy.derived.residue;return e.trace=i[n],e.C1_1=r.findAtomOnResidue(n,"C1'"),e.C2_1=r.findAtomOnResidue(n,"C2'"),e.C3_1=r.findAtomOnResidue(n,"C3'"),e.C4_1=r.findAtomOnResidue(n,"C4'"),e.O4_1=r.findAtomOnResidue(n,"O4'"),e}function $P(e){return-1!==e.trace&&-1!==e.C1_1&&-1!==e.C2_1&&-1!==e.C3_1&&-1!==e.C4_1&&-1!==e.O4_1}const BO=C(),lY=C(),hve=C(),mve=C(),gve=C(),yve=C(),LO=C(),cY=C(),uY=C(),bve=C(),YP=fe.identity(),f_t=C(),vve=X9(),xve={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:I.Numeric(1,{min:0,max:2,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo)};function p_t(e,t,n,r,i,o){if(!ze.isAtomic(t))return on.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,thicknessFactor:l,radialSegments:c}=i,u=s*(vve.vertices.length/3+2*c),d=Ct.createState(u,u/4,o),{elements:f,model:p,conformation:m}=t,{chainAtomSegments:h,residueAtomSegments:g}=p.atomicHierarchy,{moleculeType:y}=p.atomicHierarchy.derived.residue,v=En.transientSegments(h,f),x=En.transientSegments(g,f),_=1*a,A=l*a*2,M={radiusTop:_,radiusBottom:_,radialSegments:c,bottomCap:!0};let E=0;for(;v.hasNext;)for(x.setSegment(v.move());x.hasNext;){const{index:F}=x.move();if(Fu(y[F])){const R={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};let N=-1,j=-1,W=-1,z=-1,$=-1,V=4.5;const{isPurine:X,isPyrimidine:H}=w2(t,F);X?(V=4.5,I2(R,t,F),N=R.N1,j=R.C4,W=R.C6,z=R.C2,$=R.N9):H&&(V=3,E2(R,t,F),N=R.N3,j=R.C6,W=R.C4,z=R.C2,$=R.N1),-1!==$&&-1!==R.trace&&(m.invariantPosition($,gve),m.invariantPosition(R.trace,yve),d.currentGroup=E,Ur(d,gve,yve,1,M),-1!==N&&-1!==j&&-1!==W&&-1!==z&&(m.invariantPosition(N,BO),m.invariantPosition(j,lY),m.invariantPosition(W,hve),m.invariantPosition(z,mve),C.normalize(LO,C.sub(LO,lY,BO)),C.normalize(cY,C.sub(cY,mve,hve)),C.normalize(uY,C.cross(uY,LO,cY)),fe.targetTo(YP,BO,lY,uY),C.scaleAndAdd(bve,BO,LO,V/2-.2),fe.scale(YP,YP,C.set(f_t,4.5,A,V)),fe.setTranslation(YP,bve),Ct.addPrimitive(d,YP,vve))),++E}}const D=Ct.getMesh(d),T=ke.expand(ke(),t.boundary.sphere,_);return D.setBoundingSphere(T),D}I.getDefaultValues(xve);const _ve={...ml,...xve};function h_t(e){return mc({defaultProps:I.getDefaultValues(_ve),createGeometry:p_t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.thicknessFactor!==r.thicknessFactor||n.radialSegments!==r.radialSegments}},e)}const jO=C(),gv=C(),UO=C(),zO=C(),KA=C(),ZA=C(),VO=C(),Sve=C(),Cve=C(),HO=C(),yv=C(),wve={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:I.Numeric(1,{min:0,max:2,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo)},GO=(I.getDefaultValues(wve),new Float32Array(54)),m_t=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),g_t=new Uint32Array([8,12,14,16,6,4,2,0,10]),y_t=new Uint32Array([9,11,1,3,5,7,17,15,13]),qO=new Float32Array(36),b_t=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),v_t=new Uint32Array([0,10,8,6,4,2]),x_t=new Uint32Array([1,3,5,7,9,11]),Ave=C();function Ive(e,t,...n){for(let r=0,i=n.length;r<i;++r){const o=n[r];C.toArray(C.add(Ave,o,t),e,2*r*3),C.toArray(C.sub(Ave,o,t),e,3*(2*r+1))}}function __t(e,t,n,r,i,o){if(!ze.isAtomic(t))return on.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,thicknessFactor:l,radialSegments:c,detail:u}=i,d=s*(26+2*c),f=Ct.createState(d,d/4,o),{elements:p,model:m,conformation:h}=t,{chainAtomSegments:g,residueAtomSegments:y}=m.atomicHierarchy,{moleculeType:v}=m.atomicHierarchy.derived.residue,x=En.transientSegments(g,p),_=En.transientSegments(y,p),w=1*a,A=l*a,M={radiusTop:w,radiusBottom:w,radialSegments:c};let E=0;for(;x.hasNext;)for(_.setSegment(x.move());_.hasNext;){const{index:F}=_.move();if(Fu(v[F])){const R={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};f.currentGroup=E;const{isPurine:N,isPyrimidine:j}=w2(t,F);N?(I2(R,t,F),-1!==R.N9&&-1!==R.trace&&(h.invariantPosition(R.N9,HO),h.invariantPosition(R.trace,jO),f.currentGroup=E,Ur(f,HO,jO,1,M),Jr(f,HO,w,u)),YA(R)&&(h.invariantPosition(R.N1,gv),h.invariantPosition(R.C2,UO),h.invariantPosition(R.N3,zO),h.invariantPosition(R.C4,KA),h.invariantPosition(R.C5,ZA),h.invariantPosition(R.C6,VO),h.invariantPosition(R.N7,Sve),h.invariantPosition(R.C8,Cve),C.triangleNormal(yv,gv,KA,ZA),C.scale(yv,yv,A),Ive(GO,yv,gv,UO,zO,KA,ZA,VO,Sve,Cve,HO),Ct.addTriangleStrip(f,GO,m_t),Ct.addTriangleFan(f,GO,g_t),Ct.addTriangleFan(f,GO,y_t))):j&&(E2(R,t,F),-1!==R.N1&&-1!==R.trace&&(h.invariantPosition(R.N1,gv),h.invariantPosition(R.trace,jO),f.currentGroup=E,Ur(f,gv,jO,1,M),Jr(f,gv,w,u)),XA(R)&&(h.invariantPosition(R.C2,UO),h.invariantPosition(R.N3,zO),h.invariantPosition(R.C4,KA),h.invariantPosition(R.C5,ZA),h.invariantPosition(R.C6,VO),C.triangleNormal(yv,gv,KA,ZA),C.scale(yv,yv,A),Ive(qO,yv,gv,UO,zO,KA,ZA,VO),Ct.addTriangleStrip(f,qO,b_t),Ct.addTriangleFan(f,qO,v_t),Ct.addTriangleFan(f,qO,x_t))),++E}}const D=Ct.getMesh(f),T=ke.expand(ke(),t.boundary.sphere,w);return D.setBoundingSphere(T),D}const Eve={...ml,...wve};function S_t(e){return mc({defaultProps:I.getDefaultValues(Eve),createGeometry:__t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.thicknessFactor!==r.thicknessFactor||n.radialSegments!==r.radialSegments}},e)}const QA=C(),WO=C(),$O=C(),JA=C(),eI=C(),YO=C(),Tve=C(),Dve=C(),Pve=C(),XO=C(),dY=C(),KO=C(),ZO=C(),fY=C(),tI=C(),yc=C(),nI=C(),kve={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),thicknessFactor:I.Numeric(1,{min:0,max:2,step:.01})},QO=(I.getDefaultValues(kve),new Float32Array(54)),C_t=new Uint32Array([0,1,2,3,4,5,6,7,16,17,14,15,12,13,8,9,10,11,0,1]),w_t=new Uint32Array([8,12,14,16,6,4,2,0,10]),A_t=new Uint32Array([9,11,1,3,5,7,17,15,13]),JO=new Float32Array(36),I_t=new Uint32Array([2,3,4,5,6,7,8,9,10,11,2,3]),E_t=new Uint32Array([0,10,8,6,4,2,10]),T_t=new Uint32Array([1,3,5,7,9,11,3]),eB=new Float32Array(36),D_t=new Uint32Array([0,1,2,3,4,5,6,7,8,9,10,11,0,1]),P_t=new Uint32Array([0,10,8,6,4,2]),k_t=new Uint32Array([1,3,5,7,9,11]),Mve=C();function pY(e,t,...n){for(let r=0,i=n.length;r<i;++r){const o=n[r];C.toArray(C.add(Mve,o,t),e,2*r*3),C.toArray(C.sub(Mve,o,t),e,3*(2*r+1))}}function M_t(e,t,n,r,i,o){if(!ze.isAtomic(t))return on.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,thicknessFactor:l}=i,c=25*s,u=Ct.createState(c,c/4,o),{elements:d,model:f,conformation:p}=t,{chainAtomSegments:m,residueAtomSegments:h}=f.atomicHierarchy,{moleculeType:g}=f.atomicHierarchy.derived.residue,y=En.transientSegments(m,d),v=En.transientSegments(h,d),x=a*l;let _=0;for(;y.hasNext;)for(v.setSegment(y.move());v.hasNext;){const{index:M}=v.move();if(Fu(g[M])){const E={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};u.currentGroup=_,WP(E,t,M),$P(E)&&(p.invariantPosition(E.C1_1,XO),p.invariantPosition(E.C2_1,dY),p.invariantPosition(E.C3_1,KO),p.invariantPosition(E.C4_1,ZO),p.invariantPosition(E.O4_1,fY),C.triangleNormal(yc,KO,ZO,XO),C.scale(tI,C.add(tI,fY,C.add(tI,ZO,C.add(tI,KO,C.add(tI,XO,dY)))),.2),C.scale(nI,yc,x),pY(JO,nI,tI,KO,ZO,fY,XO,dY),Ct.addTriangleStrip(u,JO,I_t),Ct.addTriangleFanWithNormal(u,JO,E_t,yc),C.negate(yc,yc),Ct.addTriangleFanWithNormal(u,JO,T_t,yc));const{isPurine:D,isPyrimidine:T}=w2(t,M);D?(I2(E,t,M),YA(E)&&(p.invariantPosition(E.N1,QA),p.invariantPosition(E.C2,WO),p.invariantPosition(E.N3,$O),p.invariantPosition(E.C4,JA),p.invariantPosition(E.C5,eI),p.invariantPosition(E.C6,YO),p.invariantPosition(E.N7,Tve),p.invariantPosition(E.C8,Dve),p.invariantPosition(E.N9,Pve),C.triangleNormal(yc,QA,JA,eI),C.scale(nI,yc,x),pY(QO,nI,QA,WO,$O,JA,eI,YO,Tve,Dve,Pve),Ct.addTriangleStrip(u,QO,C_t),Ct.addTriangleFanWithNormal(u,QO,w_t,yc),C.negate(yc,yc),Ct.addTriangleFanWithNormal(u,QO,A_t,yc))):T&&(E2(E,t,M),XA(E)&&(p.invariantPosition(E.N1,QA),p.invariantPosition(E.C2,WO),p.invariantPosition(E.N3,$O),p.invariantPosition(E.C4,JA),p.invariantPosition(E.C5,eI),p.invariantPosition(E.C6,YO),C.triangleNormal(yc,QA,JA,eI),C.scale(nI,yc,x),pY(eB,nI,QA,WO,$O,JA,eI,YO),Ct.addTriangleStrip(u,eB,D_t),Ct.addTriangleFanWithNormal(u,eB,P_t,yc),C.negate(yc,yc),Ct.addTriangleFanWithNormal(u,eB,k_t,yc))),++_}}const w=Ct.getMesh(u),A=ke.expand(ke(),t.boundary.sphere,x);return w.setBoundingSphere(A),w}const Rve={...ml,...kve};function R_t(e){return mc({defaultProps:I.getDefaultValues(Rve),createGeometry:M_t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.thicknessFactor!==r.thicknessFactor}},e)}const bc=C(),fo=C(),xl=C(),_l=C(),Zs=C(),Qs=C(),Sl=C(),Lg=C(),jg=C(),Pa=C(),ka=C(),Ug=C(),Ld=C(),zg=C(),Vg=C(),hY={...ml,..._W,sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)};function N_t(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?function O_t(e){return SW({defaultProps:I.getDefaultValues(hY),createGeometry:F_t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function L_t(e){return mc({defaultProps:I.getDefaultValues(hY),createGeometry:B_t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.radialSegments!==r.radialSegments},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}function F_t(e,t,n,r,i,o){if(!ze.isAtomic(t))return Wu.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return Wu.createEmpty(o);const a=15*s,l=NP.create(a,a/4,o),{elements:c,model:u,conformation:d}=t,{chainAtomSegments:f,residueAtomSegments:p}=u.atomicHierarchy,{moleculeType:m}=u.atomicHierarchy.derived.residue,h=En.transientSegments(f,c),g=En.transientSegments(p,c);let y=0;for(;h.hasNext;)for(g.setSegment(h.move());g.hasNext;){const{index:w}=g.move();if(Fu(m[w])){const A={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};WP(A,t,w),$P(A)&&(d.invariantPosition(A.C1_1,ka),d.invariantPosition(A.C2_1,Ug),d.invariantPosition(A.C3_1,Ld),d.invariantPosition(A.C4_1,zg),d.invariantPosition(A.O4_1,Vg),d.invariantPosition(A.trace,bc),l.add(Ld[0],Ld[1],Ld[2],bc[0],bc[1],bc[2],1,!0,!0,2,y),l.add(Ld[0],Ld[1],Ld[2],zg[0],zg[1],zg[2],1,!0,!0,2,y),l.add(zg[0],zg[1],zg[2],Vg[0],Vg[1],Vg[2],1,!0,!0,2,y),l.add(Vg[0],Vg[1],Vg[2],ka[0],ka[1],ka[2],1,!0,!0,2,y),l.add(ka[0],ka[1],ka[2],Ug[0],Ug[1],Ug[2],1,!0,!0,2,y),l.add(Ug[0],Ug[1],Ug[2],Ld[0],Ld[1],Ld[2],1,!0,!0,2,y));const{isPurine:M,isPyrimidine:E}=w2(t,w);M?(I2(A,t,w),-1!==A.C1_1&&-1!==A.N9?(d.invariantPosition(A.C1_1,ka),d.invariantPosition(A.N9,Pa),l.add(Pa[0],Pa[1],Pa[2],ka[0],ka[1],ka[2],1,!0,!0,2,y)):-1!==A.N9&&-1!==A.trace&&(d.invariantPosition(A.N9,Pa),d.invariantPosition(A.trace,bc),l.add(Pa[0],Pa[1],Pa[2],bc[0],bc[1],bc[2],1,!0,!0,2,y)),YA(A)&&(d.invariantPosition(A.N1,fo),d.invariantPosition(A.C2,xl),d.invariantPosition(A.N3,_l),d.invariantPosition(A.C4,Zs),d.invariantPosition(A.C5,Qs),d.invariantPosition(A.C6,Sl),d.invariantPosition(A.N7,Lg),d.invariantPosition(A.C8,jg),d.invariantPosition(A.N9,Pa),l.add(Pa[0],Pa[1],Pa[2],jg[0],jg[1],jg[2],1,!0,!0,2,y),l.add(jg[0],jg[1],jg[2],Lg[0],Lg[1],Lg[2],1,!0,!0,2,y),l.add(Lg[0],Lg[1],Lg[2],Qs[0],Qs[1],Qs[2],1,!0,!0,2,y),l.add(Qs[0],Qs[1],Qs[2],Sl[0],Sl[1],Sl[2],1,!0,!0,2,y),l.add(Sl[0],Sl[1],Sl[2],fo[0],fo[1],fo[2],1,!0,!0,2,y),l.add(fo[0],fo[1],fo[2],xl[0],xl[1],xl[2],1,!0,!0,2,y),l.add(xl[0],xl[1],xl[2],_l[0],_l[1],_l[2],1,!0,!0,2,y),l.add(_l[0],_l[1],_l[2],Zs[0],Zs[1],Zs[2],1,!0,!0,2,y),l.add(Zs[0],Zs[1],Zs[2],Qs[0],Qs[1],Qs[2],1,!0,!0,2,y),l.add(Zs[0],Zs[1],Zs[2],Pa[0],Pa[1],Pa[2],1,!0,!0,2,y))):E&&(E2(A,t,w),-1!==A.C1_1&&-1!==A.N1?(d.invariantPosition(A.N1,fo),d.invariantPosition(A.C1_1,ka),l.add(fo[0],fo[1],fo[2],ka[0],ka[1],ka[2],1,!0,!0,2,y)):-1!==A.N1&&-1!==A.trace&&(d.invariantPosition(A.N1,fo),d.invariantPosition(A.trace,bc),l.add(fo[0],fo[1],fo[2],bc[0],bc[1],bc[2],1,!0,!0,2,y)),XA(A)&&(d.invariantPosition(A.N1,fo),d.invariantPosition(A.C2,xl),d.invariantPosition(A.N3,_l),d.invariantPosition(A.C4,Zs),d.invariantPosition(A.C5,Qs),d.invariantPosition(A.C6,Sl),l.add(fo[0],fo[1],fo[2],Sl[0],Sl[1],Sl[2],1,!0,!0,2,y),l.add(Sl[0],Sl[1],Sl[2],Qs[0],Qs[1],Qs[2],1,!0,!0,2,y),l.add(Qs[0],Qs[1],Qs[2],Zs[0],Zs[1],Zs[2],1,!0,!0,2,y),l.add(Zs[0],Zs[1],Zs[2],_l[0],_l[1],_l[2],1,!0,!0,2,y),l.add(_l[0],_l[1],_l[2],xl[0],xl[1],xl[2],1,!0,!0,2,y),l.add(xl[0],xl[1],xl[2],fo[0],fo[1],fo[2],1,!0,!0,2,y))),++y}}const x=l.getCylinders(),_=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return x.setBoundingSphere(_),x}function B_t(e,t,n,r,i,o){if(!ze.isAtomic(t))return on.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,radialSegments:l}=i,c=s*(15*l),u=Ct.createState(c,c/4,o),{elements:d,model:f,conformation:p}=t,{chainAtomSegments:m,residueAtomSegments:h}=f.atomicHierarchy,{moleculeType:g}=f.atomicHierarchy.derived.residue,y=En.transientSegments(m,d),v=En.transientSegments(h,d),x={radiusTop:1*a,radiusBottom:1*a,radialSegments:l};let _=0;for(;y.hasNext;)for(v.setSegment(y.move());v.hasNext;){const{index:M}=v.move();if(Fu(g[M])){const E={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};u.currentGroup=_,WP(E,t,M),$P(E)&&(p.invariantPosition(E.C1_1,ka),p.invariantPosition(E.C2_1,Ug),p.invariantPosition(E.C3_1,Ld),p.invariantPosition(E.C4_1,zg),p.invariantPosition(E.O4_1,Vg),p.invariantPosition(E.trace,bc),Ur(u,Ld,bc,1,x),Ur(u,Ld,zg,1,x),Ur(u,zg,Vg,1,x),Ur(u,Vg,ka,1,x),Ur(u,ka,Ug,1,x),Ur(u,Ug,Ld,1,x));const{isPurine:D,isPyrimidine:T}=w2(t,M);D?(I2(E,t,M),-1!==E.C1_1&&-1!==E.N9?(p.invariantPosition(E.C1_1,ka),p.invariantPosition(E.N9,Pa),Ur(u,Pa,ka,1,x)):-1!==E.N9&&-1!==E.trace&&(p.invariantPosition(E.N9,Pa),p.invariantPosition(E.trace,bc),Ur(u,Pa,bc,1,x)),YA(E)&&(p.invariantPosition(E.N1,fo),p.invariantPosition(E.C2,xl),p.invariantPosition(E.N3,_l),p.invariantPosition(E.C4,Zs),p.invariantPosition(E.C5,Qs),p.invariantPosition(E.C6,Sl),p.invariantPosition(E.N7,Lg),p.invariantPosition(E.C8,jg),p.invariantPosition(E.N9,Pa),Ur(u,Pa,jg,1,x),Ur(u,jg,Lg,1,x),Ur(u,Lg,Qs,1,x),Ur(u,Qs,Sl,1,x),Ur(u,Sl,fo,1,x),Ur(u,fo,xl,1,x),Ur(u,xl,_l,1,x),Ur(u,_l,Zs,1,x),Ur(u,Zs,Qs,1,x),Ur(u,Zs,Pa,1,x))):T&&(E2(E,t,M),-1!==E.C1_1&&-1!==E.N1?(p.invariantPosition(E.N1,fo),p.invariantPosition(E.C1_1,ka),Ur(u,fo,ka,1,x)):-1!==E.N1&&-1!==E.trace&&(p.invariantPosition(E.N1,fo),p.invariantPosition(E.trace,bc),Ur(u,fo,bc,1,x)),XA(E)&&(p.invariantPosition(E.N1,fo),p.invariantPosition(E.C2,xl),p.invariantPosition(E.N3,_l),p.invariantPosition(E.C4,Zs),p.invariantPosition(E.C5,Qs),p.invariantPosition(E.C6,Sl),Ur(u,fo,Sl,1,x),Ur(u,Sl,Qs,1,x),Ur(u,Qs,Zs,1,x),Ur(u,Zs,_l,1,x),Ur(u,_l,xl,1,x),Ur(u,xl,fo,1,x))),++_}}const w=Ct.getMesh(u),A=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return w.setBoundingSphere(A),w}const rI=C(),Wp=C(),$p=C(),Yp=C(),Xp=C(),Of=C(),Kp=C(),iI=C(),oI=C(),sI=C(),aI=C(),lI=C(),cI=C(),uI=C(),dI=C(),mY={...ml,...vW,sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)};function j_t(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?function z_t(e){return xW({defaultProps:I.getDefaultValues(mY),createGeometry:U_t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function H_t(e){return mc({defaultProps:I.getDefaultValues(mY),createGeometry:V_t,createLocationIterator:rb.fromGroup,getLoci:S2,eachLocation:C2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}function U_t(e,t,n,r,i,o){if(!ze.isAtomic(t))return Rp.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return Rp.createEmpty(o);const a=15*s,l=HA.create(a,a/4,o),{elements:c,model:u,conformation:d}=t,{chainAtomSegments:f,residueAtomSegments:p}=u.atomicHierarchy,{moleculeType:m}=u.atomicHierarchy.derived.residue,h=En.transientSegments(f,c),g=En.transientSegments(p,c);let y=0;for(;h.hasNext;)for(g.setSegment(h.move());g.hasNext;){const{index:_}=g.move();if(Fu(m[_])){const w={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};WP(w,t,_),$P(w)&&(d.invariantPosition(w.C1_1,aI),d.invariantPosition(w.C2_1,lI),d.invariantPosition(w.C3_1,cI),d.invariantPosition(w.C4_1,uI),d.invariantPosition(w.O4_1,dI),d.invariantPosition(w.trace,rI),l.add(rI[0],rI[1],rI[2],y),l.add(cI[0],cI[1],cI[2],y),l.add(uI[0],uI[1],uI[2],y),l.add(dI[0],dI[1],dI[2],y),l.add(aI[0],aI[1],aI[2],y),l.add(lI[0],lI[1],lI[2],y));const{isPurine:A,isPyrimidine:M}=w2(t,_);A?(I2(w,t,_),YA(w)&&(d.invariantPosition(w.N1,Wp),d.invariantPosition(w.C2,$p),d.invariantPosition(w.N3,Yp),d.invariantPosition(w.C4,Xp),d.invariantPosition(w.C5,Of),d.invariantPosition(w.C6,Kp),d.invariantPosition(w.N7,iI),d.invariantPosition(w.C8,oI),d.invariantPosition(w.N9,sI),l.add(sI[0],sI[1],sI[2],y),l.add(oI[0],oI[1],oI[2],y),l.add(iI[0],iI[1],iI[2],y),l.add(Of[0],Of[1],Of[2],y),l.add(Kp[0],Kp[1],Kp[2],y),l.add(Wp[0],Wp[1],Wp[2],y),l.add($p[0],$p[1],$p[2],y),l.add(Yp[0],Yp[1],Yp[2],y),l.add(Xp[0],Xp[1],Xp[2],y))):M&&(E2(w,t,_),XA(w)&&(d.invariantPosition(w.N1,Wp),d.invariantPosition(w.C2,$p),d.invariantPosition(w.N3,Yp),d.invariantPosition(w.C4,Xp),d.invariantPosition(w.C5,Of),d.invariantPosition(w.C6,Kp),l.add(Wp[0],Wp[1],Wp[2],y),l.add(Kp[0],Kp[1],Kp[2],y),l.add(Of[0],Of[1],Of[2],y),l.add(Xp[0],Xp[1],Xp[2],y),l.add(Yp[0],Yp[1],Yp[2],y),l.add($p[0],$p[1],$p[2],y))),++y}}const v=l.getSpheres(),x=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(x),v}function V_t(e,t,n,r,i,o){if(!ze.isAtomic(t))return on.createEmpty(o);const s=t.nucleotideElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,detail:l}=i,c=s*qw(l),u=Ct.createState(c,c/2,o),{elements:d,model:f,conformation:p}=t,{chainAtomSegments:m,residueAtomSegments:h}=f.atomicHierarchy,{moleculeType:g}=f.atomicHierarchy.derived.residue,y=En.transientSegments(m,d),v=En.transientSegments(h,d),x=1*a;let _=0;for(;y.hasNext;)for(v.setSegment(y.move());v.hasNext;){const{index:M}=v.move();if(Fu(g[M])){const E={trace:-1,N1:-1,C2:-1,N3:-1,C4:-1,C5:-1,C6:-1,N7:-1,C8:-1,N9:-1,C1_1:-1,C2_1:-1,C3_1:-1,C4_1:-1,O4_1:-1};u.currentGroup=_,WP(E,t,M),$P(E)&&(p.invariantPosition(E.C1_1,aI),p.invariantPosition(E.C2_1,lI),p.invariantPosition(E.C3_1,cI),p.invariantPosition(E.C4_1,uI),p.invariantPosition(E.O4_1,dI),p.invariantPosition(E.trace,rI),Jr(u,rI,x,l),Jr(u,uI,x,l),Jr(u,dI,x,l),Jr(u,aI,x,l),Jr(u,lI,x,l),Jr(u,cI,x,l));const{isPurine:D,isPyrimidine:T}=w2(t,M);D?(I2(E,t,M),YA(E)&&(p.invariantPosition(E.N1,Wp),p.invariantPosition(E.C2,$p),p.invariantPosition(E.N3,Yp),p.invariantPosition(E.C4,Xp),p.invariantPosition(E.C5,Of),p.invariantPosition(E.C6,Kp),p.invariantPosition(E.N7,iI),p.invariantPosition(E.C8,oI),p.invariantPosition(E.N9,sI),Jr(u,oI,x,l),Jr(u,iI,x,l),Jr(u,Of,x,l),Jr(u,Kp,x,l),Jr(u,Wp,x,l),Jr(u,$p,x,l),Jr(u,Yp,x,l),Jr(u,Xp,x,l),Jr(u,Of,x,l),Jr(u,sI,x,l))):T&&(E2(E,t,M),XA(E)&&(p.invariantPosition(E.N1,Wp),p.invariantPosition(E.C2,$p),p.invariantPosition(E.N3,Yp),p.invariantPosition(E.C4,Xp),p.invariantPosition(E.C5,Of),p.invariantPosition(E.C6,Kp),Jr(u,Kp,x,l),Jr(u,Of,x,l),Jr(u,Xp,x,l),Jr(u,Yp,x,l),Jr(u,$p,x,l),Jr(u,Wp,x,l))),++_}}const w=Ct.getMesh(u),A=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return w.setBoundingSphere(A),w}const T2=C.zero(),fI=C.zero(),D2=C.zero(),Nve=C.zero(),Ka=gg(3,!1);let gY;const P2=fe.identity(),W_t=C.zero(),Fve=C.zero(),Ove=C.zero(),bY=C.zero(),$_t=4,Y_t=4,X_t=6,K_t=function q_t(){return gY||(gY=function G_t(){const e=Hw(8);for(let t=0;t<3;++t){const n=(t+1)%3;C.set(T2,Ka[3*t],Ka[3*t+1],-.5),C.set(fI,Ka[3*n],Ka[3*n+1],-.5),C.set(D2,Ka[3*n],Ka[3*n+1],.5),C.set(Nve,Ka[3*t],Ka[3*t+1],.5),e.add(T2,fI,D2),e.add(D2,Nve,T2)}return C.set(T2,Ka[0],Ka[1],-.5),C.set(fI,Ka[3],Ka[4],-.5),C.set(D2,Ka[6],Ka[7],-.5),e.add(D2,fI,T2),C.set(T2,Ka[0],Ka[1],.5),C.set(fI,Ka[3],Ka[4],.5),C.set(D2,Ka[6],Ka[7],.5),e.add(T2,fI,D2),e.getPrimitive()}()),gY}(),Bve={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01})};function Z_t(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a}=i,l=24*s,c=Ct.createState(l,l/10,o),d=eY(1),{normalVectors:f,binormalVectors:p}=d;let m=0;const h=Z$(t,n);for(;h.hasNext;){const v=h.move();c.currentGroup=m;const x=Fu(v.moleculeType),_=pi.is(v.secStrucType,4);if(tY(d,v,x||_?.5:.9,x?.3:.5),_&&!v.secStrucLast||!_){const M=r.size.size(v.center)*a,E=$_t*M,D=Y_t*M,T=X_t*M,F=x?p:f;C.fromArray(Fve,F,0),C.fromArray(Ove,F,3),C.normalize(bY,C.add(bY,Fve,Ove)),fe.targetTo(P2,v.p3,v.p1,bY),fe.mul(P2,P2,fe.rotY90Z180),fe.scale(P2,P2,C.set(W_t,T,D,E)),fe.setTranslation(P2,v.p2),Ct.addPrimitive(c,P2,K_t)}++m}const g=Ct.getMesh(c),y=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return g.setBoundingSphere(y),g}I.getDefaultValues(Bve);const Lve={...ml,...Bve};function Q_t(e){return mc({defaultProps:I.getDefaultValues(Lve),createGeometry:Z_t,createLocationIterator:t=>nb.fromGroup(t),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor}},e)}const vY=10,jve={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo)};function J_t(e,t,n,r,i,o){const s=t.gapElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,radialSegments:l}=i,c=vY*l*2*s*2,u=Ct.createState(c,c/10,o),d=C(),f=C(),p={radiusTop:1,radiusBottom:1,topCap:!0,bottomCap:!0,radialSegments:l};let m=0;const h=function qxt(e,t){switch(t.kind){case 0:return new Wxt(e,t);case 1:case 2:return new $xt(e,t)}}(n,t);for(;h.hasNext;){const{centerA:v,centerB:x}=h.move();v.element===x.element||(t.conformation.invariantPosition(v.element,d),t.conformation.invariantPosition(x.element,f),p.radiusTop=p.radiusBottom=r.size.size(v)*a,u.currentGroup=m,Yw(u,d,f,.5,vY,!1,p),p.radiusTop=p.radiusBottom=r.size.size(x)*a,u.currentGroup=m+1,Yw(u,f,d,.5,vY,!1,p)),m+=2}const g=Ct.getMesh(u),y=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return g.setBoundingSphere(y),g}I.getDefaultValues(jve);const tB={...ml,...jve};function xY(e){return mc({defaultProps:I.getDefaultValues(tB),createGeometry:J_t,createLocationIterator:aY.fromGroup,getLoci:a_t,eachLocation:l_t,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.radialSegments!==r.radialSegments}},e)}const oi=C(),Ri=C(),e2t=C(),Bf=C(),Hg=C(),nB=C(),rB=C(),XP=C(),hm=C(),Gg=C(),_Y=C(),bv=C(),vv=C(),xv=C(),_v=C(),Zp=C.fromArray,pI=C.scale,Qp=C.add,ib=C.sub,t2t=C.magnitude,Uve=C.negate,SY=C.copy,zve=C.cross,n2t=C.set,Yi=tt.add3,r2t=tt.add;function iB(e,t,n,r,i,o,s,a,l){const{vertices:c,normals:u,indices:d}=t,f=c.elementCount;if(Zp(oi,r,e),pI(rB,oi,s),pI(nB,oi,a),Zp(Ri,i,e),pI(Bf,Ri,o),zve(Gg,Ri,oi),Zp(hm,n,e),Qp(bv,Qp(bv,hm,Bf),nB),ib(vv,Qp(vv,hm,Bf),rB),ib(xv,ib(xv,hm,Bf),rB),Qp(_v,ib(_v,hm,Bf),nB),s<a?(Yi(c,_v[0],_v[1],_v[2]),Yi(c,xv[0],xv[1],xv[2]),Yi(c,vv[0],vv[1],vv[2]),Yi(c,bv[0],bv[1],bv[2]),SY(Hg,nB)):(Yi(c,bv[0],bv[1],bv[2]),Yi(c,vv[0],vv[1],vv[2]),Yi(c,xv[0],xv[1],xv[2]),Yi(c,_v[0],_v[1],_v[2]),SY(Hg,rB)),l){for(let p=0;p<4;++p)Yi(u,-Gg[0],-Gg[1],-Gg[2]);Yi(d,f,f+1,f+2),Yi(d,f+2,f+3,f)}else{for(let p=0;p<4;++p)Yi(u,Gg[0],Gg[1],Gg[2]);Yi(d,f+2,f+1,f),Yi(d,f,f+3,f+2)}}function oB(e,t,n,r,i,o,s,a,l,c){const{currentGroup:u,vertices:d,normals:f,indices:p,groups:m}=e,h=d.elementCount;let g=0;a>0?(Zp(oi,t,0),Zp(Ri,t,3*i),g=a/t2t(ib(e2t,Ri,oi))):n2t(XP,0,0,0);for(let v=0;v<=i;++v){const x=o[v],w=0===a?s[v]:a*(1-v/i),A=3*v;Zp(Hg,n,A),pI(Hg,Hg,w),Zp(Bf,r,A),pI(Bf,Bf,x),a>0&&(Zp(oi,n,A),Zp(Ri,r,A),pI(XP,zve(XP,oi,Ri),g)),Zp(hm,t,A),Zp(Gg,n,A),Zp(_Y,r,A),Qp(oi,Qp(oi,hm,Bf),Hg),Qp(Ri,Gg,XP),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),Qp(oi,ib(oi,hm,Bf),Hg),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),Uve(Ri,_Y),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),ib(oi,ib(oi,hm,Bf),Hg),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),Qp(Ri,Uve(Ri,Gg),XP),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),ib(oi,Qp(oi,hm,Bf),Hg),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),SY(Ri,_Y),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2]),Qp(oi,Qp(oi,hm,Bf),Hg),Yi(d,oi[0],oi[1],oi[2]),Yi(f,Ri[0],Ri[1],Ri[2])}for(let v=0;v<i;++v){for(let x=0;x<2;x++)Yi(p,h+8*v+2*x,h+8*(v+1)+2*x+1,h+8*v+2*x+1),Yi(p,h+8*v+2*x,h+8*(v+1)+2*x,h+8*(v+1)+2*x+1);for(let x=2;x<4;x++)Yi(p,h+8*v+2*x,h+8*(v+1)+2*x,h+8*v+2*x+1),Yi(p,h+8*(v+1)+2*x,h+8*(v+1)+2*x+1,h+8*v+2*x+1)}if(l){const _=0===a?s[0]:a;iB(0,e,t,n,r,o[0],_,_,!1)}else if(a>0){const v=o[0],x=s[0];iB(0,e,t,n,r,v,a,-x,!1),iB(0,e,t,n,r,v,-a,x,!1)}if(c&&0===a){const x=s[i];iB(3*i,e,t,n,r,o[i],x,x,!0)}for(let v=0,x=8*(i+1)+(l?4:a>0?8:0)+(c&&0===a?4:0);v<x;++v)r2t(m,u)}const ma=C(),Za=C(),nd=C(),vc=C(),hu=C();function sB(e,t,n,r,i){e[0]=t[0]*r+n[0]*i,e[1]=t[1]*r+n[1]*i,e[2]=t[2]*r+n[2]*i}function hI(e,t,n,r,i,o){e[0]=t[0]*i+n[0]*o+r[0],e[1]=t[1]*i+n[1]*o+r[1],e[2]=t[2]*i+n[2]*o+r[2]}const ob=C.fromArray,i2t=C.normalize,CY=C.scaleAndAdd,Vve=C.cross,o2t=C.dot,s2t=C.unitX,mu=tt.add3,wY=new Map;function AY(e,t,n,r,i,o,s,a,l,c,u){const{currentGroup:d,vertices:f,normals:p,indices:m,groups:h}=e;let g=f.elementCount;const{cos:y,sin:v}=function a2t(e,t){const n=t?1:0,r=gf(e,n);if(!wY.has(r)){const i=[],o=[];for(let s=0;s<e;++s){const a=(2*s+n)/e*Math.PI;i[s]=Math.cos(a),o[s]=Math.sin(a)}wY.set(r,{cos:i,sin:o})}return wY.get(r)}(o,"rounded"===u),x=Math.round(o/4),_=3*x;for(let M=0;M<=i;++M){const E=3*M;ob(vc,n,E),ob(hu,r,E),ob(nd,t,E);const D=s[M],T=a[M],F="rounded"===u&&T>D;for(let R=0;R<o;++R){if(F){hI(Za,vc,hu,nd,D*y[R],D*v[R]);const N=o2t(hu,s2t)<0?R<x||R>=_?T-D:-T+D:R>=x&&R<_?-T+D:T-D;CY(Za,Za,vc,N),R===x||R===x-1?sB(ma,vc,hu,0,1):R===_||R===_-1?sB(ma,vc,hu,0,-1):sB(ma,vc,hu,y[R],v[R])}else hI(Za,vc,hu,nd,T*y[R],D*v[R]),sB(ma,vc,hu,D*y[R],T*v[R]);i2t(ma,ma),mu(f,Za[0],Za[1],Za[2]),mu(p,ma[0],ma[1],ma[2])}}const w=Math.round(o/2);for(let M=0;M<i;++M){for(let E=0;E<w;++E)mu(m,g+M*o+(E+1)%o,g+(M+1)*o+(E+1)%o,g+M*o+E),mu(m,g+(M+1)*o+(E+1)%o,g+(M+1)*o+E,g+M*o+E);for(let E=w;E<o;++E)mu(m,g+M*o+(E+1)%o,g+(M+1)*o+E,g+M*o+E),mu(m,g+(M+1)*o+(E+1)%o,g+(M+1)*o+E,g+M*o+(E+1)%o)}if(l){const E=f.elementCount;ob(vc,n,0),ob(hu,r,0),ob(nd,t,0),Vve(ma,hu,vc),mu(f,nd[0],nd[1],nd[2]),mu(p,ma[0],ma[1],ma[2]);const D=s[0];let T=a[0];const F="rounded"===u&&T>D;F&&(T-=D),g=f.elementCount;for(let R=0;R<o;++R)F?(hI(Za,vc,hu,nd,D*y[R],D*v[R]),CY(Za,Za,vc,R<x||R>=_?T:-T)):hI(Za,vc,hu,nd,T*y[R],D*v[R]),mu(f,Za[0],Za[1],Za[2]),mu(p,ma[0],ma[1],ma[2]),mu(m,g+(R+1)%o,g+R,E)}if(c){const M=3*i,E=f.elementCount;ob(vc,n,M),ob(hu,r,M),ob(nd,t,M),Vve(ma,vc,hu),mu(f,nd[0],nd[1],nd[2]),mu(p,ma[0],ma[1],ma[2]);const D=s[i];let T=a[i];const F="rounded"===u&&T>D;F&&(T-=D),g=f.elementCount;for(let R=0;R<o;++R)F?(hI(Za,vc,hu,nd,D*y[R],D*v[R]),CY(Za,Za,vc,R<x||R>=_?T:-T)):hI(Za,vc,hu,nd,T*y[R],D*v[R]),mu(f,Za[0],Za[1],Za[2]),mu(p,ma[0],ma[1],ma[2]),mu(m,g+R,g+(R+1)%o,E)}tt.addRepeat(h,(i+1)*o+(l?o+1:0)+(c?o+1:0),d)}const sb=C.fromArray,l2t=C.magnitude,IY=C.sub,Hve=C.add,EY=C.scale,c2t=C.negate,u2t=C.copy,d2t=C.cross,Jp=tt.add3,f2t=tt.add,Cl=C(),xc=C(),p2t=C(),TY=C(),k2=C(),Gve=C(),KP=C(),h2t=C(),DY=C();function aB(e,t,n,r,i,o,s,a){const{currentGroup:l,vertices:c,normals:u,indices:d,groups:f}=e,p=c.elementCount;let m=0;a>0&&(sb(Cl,t,0),sb(xc,t,3*i),m=a/l2t(IY(p2t,xc,Cl)));for(let g=0;g<=i;++g){const y=o[g],x=0===a?s[g]:a*(1-g/i),_=3*g;sb(k2,n,_),EY(k2,k2,x),sb(TY,r,_),EY(TY,TY,y),a>0&&(sb(Cl,n,_),sb(xc,r,_),EY(Gve,d2t(Gve,Cl,xc),m)),sb(KP,t,_),sb(h2t,n,_),sb(DY,r,_),Hve(Cl,KP,k2),c2t(xc,DY),Jp(c,Cl[0],Cl[1],Cl[2]),Jp(u,xc[0],xc[1],xc[2]),IY(Cl,KP,k2),Jp(c,Cl[0],Cl[1],Cl[2]),Jp(u,xc[0],xc[1],xc[2]),Hve(Cl,KP,k2),u2t(xc,DY),Jp(c,Cl[0],Cl[1],Cl[2]),Jp(u,xc[0],xc[1],xc[2]),IY(Cl,KP,k2),Jp(c,Cl[0],Cl[1],Cl[2]),Jp(u,xc[0],xc[1],xc[2])}for(let g=0;g<i;++g)Jp(d,p+4*g,p+4*(g+1)+1,p+4*g+1),Jp(d,p+4*g,p+4*(g+1),p+4*(g+1)+1),Jp(d,p+4*g+2+1,p+4*(g+1)+2+1,p+4*g+2),Jp(d,p+4*g+2,p+4*(g+1)+2+1,p+4*(g+1)+2);for(let g=0,y=4*(i+1);g<y;++g)f2t(f,l)}const qve={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),aspectRatio:I.Numeric(5,{min:.1,max:10,step:.1}),arrowFactor:I.Numeric(1.5,{min:0,max:3,step:.1},{description:"Size factor for sheet arrows"}),tubularHelices:I.Boolean(!1,{description:"Draw alpha helices as tubes"}),helixProfile:I.Select("elliptical",I.arrayToOptions(["elliptical","rounded","square"]),{description:"Protein helix trace profile"}),nucleicProfile:I.Select("square",I.arrayToOptions(["elliptical","rounded","square"]),{description:"Nucleic strand trace profile"}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},xt.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo)},jd=(I.getDefaultValues(qve),C());function m2t(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,detail:l,linearSegments:c,radialSegments:u,aspectRatio:d,arrowFactor:f,tubularHelices:p,helixProfile:m,nucleicProfile:h}=i,g=c*u*s+(u+1)*s*2,y=Ct.createState(g,g/10,o),v=ze.isCoarse(t),x=eY(c),{curvePoints:_,normalVectors:w,binormalVectors:A,widthValues:M,heightValues:E}=x;let D=0;const T=Z$(t,n,{ignoreSecondaryStructure:!1,useHelixOrientation:p});for(;T.hasNext;){const N=T.move();y.currentGroup=D;const j=Fu(N.moleculeType),W=pi.is(N.secStrucType,4),z=pi.is(N.secStrucType,2),V=j?FO:NO;tY(x,N,z&&!p?o_t:uve,V);let X=r.size.size(N.centerPrev)*a,H=r.size.size(N.center)*a,oe=r.size.size(N.centerNext)*a;v&&(X*=d/2,H*=d/2,oe*=d/2);const te=N.secStrucFirst||N.coarseBackboneFirst||N.first,K=N.secStrucLast||N.coarseBackboneLast||N.last;let Q=c;if(N.initial){Q=Math.max(Math.round(c*V),1);const G=c-Q;_.copyWithin(0,3*G),A.copyWithin(0,3*G),w.copyWithin(0,3*G),C.fromArray(jd,_,3),C.normalize(jd,C.sub(jd,N.p2,jd)),C.scaleAndAdd(jd,N.p2,jd,H*OO),C.toArray(jd,_,0)}else N.final&&(Q=Math.max(Math.round(c*(1-V)),1),C.fromArray(jd,_,3*Q-3),C.normalize(jd,C.sub(jd,N.p2,jd)),C.scaleAndAdd(jd,N.p2,jd,H*OO),C.toArray(jd,_,3*Q));if(!0===N.initial&&!0===N.final)Jr(y,N.p2,2*H,l);else if(W){const Z=H*d,se=N.secStrucLast?Z*f:0;sY(x,X,H,oe,X*d,Z,oe*d,V),2===u?aB(y,_,w,A,Q,M,E,se):oB(y,_,w,A,Q,M,E,se,te,K)}else{let G,Z,ee;z&&!N.isCoarseBackbone?p?(X*=1.5*d,H*=1.5*d,oe*=1.5*d,G=X,Z=H,ee=oe):(G=X*d,Z=H*d,ee=oe*d):j&&!N.isCoarseBackbone?(G=X*d,Z=H*d,ee=oe*d):(G=X,Z=H,ee=oe),sY(x,X,H,oe,G,Z,ee,V);const[se,xe]=j&&!N.isCoarseBackbone?[A,w]:[w,A];if(j&&!N.isCoarseBackbone)for(let ae=0,ge=se.length;ae<ge;ae++)se[ae]*=-1;const re=j?h:m;2===u?j&&!N.isCoarseBackbone?aB(y,_,se,xe,Q,E,M,0):aB(y,_,se,xe,Q,M,E,0):4===u?oB(y,_,se,xe,Q,M,E,0,te,K):Z===H?AY(y,_,se,xe,Q,u,M,E,te,K,"elliptical"):"square"===re?oB(y,_,se,xe,Q,M,E,0,te,K):AY(y,_,se,xe,Q,u,M,E,te,K,re)}++D}const F=Ct.getMesh(y),R=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return F.setBoundingSphere(R),F}const Wve={...ml,...qve};function g2t(e){return mc({defaultProps:I.getDefaultValues(Wve),createGeometry:m2t,createLocationIterator:t=>nb.fromGroup(t,{asSecondary:!0}),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.tubularHelices!==r.tubularHelices||n.detail!==r.detail||n.linearSegments!==r.linearSegments||n.radialSegments!==r.radialSegments||n.aspectRatio!==r.aspectRatio||n.arrowFactor!==r.arrowFactor||n.helixProfile!==r.helixProfile||n.nucleicProfile!==r.nucleicProfile;const l=gp.get(s.structure).version;t.info.secondaryStructureHash!==l&&(void 0!==t.info.secondaryStructureHash&&(t.createGeometry=!0),t.info.secondaryStructureHash=l)}},e)}const $ve={"polymer-trace":(e,t)=>Uo("Polymer trace mesh",e,t,g2t),"polymer-gap":(e,t)=>Uo("Polymer gap cylinder",e,t,xY),"nucleotide-block":(e,t)=>Uo("Nucleotide block mesh",e,t,h_t),"nucleotide-ring":(e,t)=>Uo("Nucleotide ring mesh",e,t,S_t),"nucleotide-atomic-ring-fill":(e,t)=>Uo("Nucleotide atomic ring fill",e,t,R_t),"nucleotide-atomic-bond":(e,t)=>Uo("Nucleotide atomic bond",e,t,N_t),"nucleotide-atomic-element":(e,t)=>Uo("Nucleotide atomic element",e,t,j_t),"direction-wedge":(e,t)=>Uo("Polymer direction wedge",e,t,Q_t)},Yve={...Wve,...tB,..._ve,...Eve,...hY,...mY,...Rve,...Lve,sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-trace","polymer-gap","nucleotide-ring","nucleotide-atomic-ring-fill","nucleotide-atomic-bond","nucleotide-atomic-element"],I.objectToOptions($ve)),bumpFrequency:I.Numeric(2,{min:0,max:10,step:.1},xt.ShadingCategory),colorMode:I.Select("default",I.arrayToOptions(["default","interpolate"]),{...xt.ShadingCategory,isHidden:!0})},v2t={name:"cartoon",label:"Cartoon",description:"Displays ribbons, planks, tubes smoothly following the trace atoms of polymers.",factory:function b2t(e,t){return Xn.createMulti("Cartoon",e,t,gl,$ve)},getParams:function y2t(e,t){const n=I.clone(Yve);let r=!1,i=!1;return t.units.forEach(o=>{!r&&ze.isAtomic(o)&&o.nucleotideElements.length&&(r=!0),!i&&o.gapElements.length&&(i=!0)}),n.visuals.defaultValue=["polymer-trace"],r&&n.visuals.defaultValue.push("nucleotide-ring"),i&&n.visuals.defaultValue.push("polymer-gap"),n},defaultValues:I.getDefaultValues(Yve),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0,ensureCustomProperties:{attach:function(){var e=le(function*(t,n){yield gp.attach(t,n,void 0,!0);for(const r of n.models)yield K$.attach(t,r,void 0,!0)});return function(n,r){return e.apply(this,arguments)}}(),detach:e=>{gp.ref(e,!1);for(const t of e.models)K$.ref(t,!1)}}},Xve={...ml,sizeFactor:I.Numeric(1,{min:0,max:10,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),ignoreHydrogens:I.Boolean(!1)};function x2t(e){return mc({defaultProps:I.getDefaultValues(Xve),createGeometry:_2t,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail||n.ignoreHydrogens!==r.ignoreHydrogens}},e)}function _2t(e,t,n,r,i,o){const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return on.createEmpty(o);const{detail:l,sizeFactor:c,ignoreHydrogens:u}=i,{elements:d,model:f}=t,{atomicNumber:p}=t.model.atomicHierarchy.derived.atom,m=d.length,h=m*qw(l),g=Ct.createState(h,h/2,o),y=ag.Provider.get(f);if(!y)return on.createEmpty(o);const v=C(),x=In(),_=C(),w=C(),A=C(),{elementToAnsiotrop:M,data:E}=y,{U:D}=E,T=E._schema.U.space,F=t.conformation,R=dt.create(n);R.unit=t;for(let W=0;W<m;W++){const z=d[W],$=M[z];if(-1!==$&&!(a&&!rt.has(a.elements,z)||u&&zmt(p,z))){R.element=z,F.invariantPosition(z,v),g.currentGroup=W,mr.toMat3(x,T,D.value($)),In.symmtricFromLower(x,x),In.symmetricEigenvalues(_,x),In.eigenvector(w,x,_[1]),In.eigenvector(A,x,_[2]);for(let V=0;V<3;++V)_[V]=1.5958*c*Math.sqrt(Math.abs(_[V]));Do(_[0],_[1],wi)&&Do(_[1],_[2],wi)?Jr(g,v,_[0],l):OG(g,v,A,w,_,l)}}const N=Ct.getMesh(g),j=ke.expand(ke(),(a||t).boundary.sphere,1*c);return N.setBoundingSphere(j),N}const Kve={"ellipsoid-mesh":(e,t)=>Uo("Ellipsoid Mesh",e,t,x2t),"intra-bond":(e,t)=>Uo("Intra-unit bond cylinder",e,t,M1e),"inter-bond":(e,t)=>Ff("Inter-unit bond cylinder",e,t,O1e)},Zve={...Xve,...AO,...IO,includeParent:I.Boolean(!1),adjustCylinderLength:I.Boolean(!1,{isHidden:!0}),unitKinds:MP(["atomic"]),sizeFactor:I.Numeric(1,{min:.01,max:10,step:.01}),sizeAspectRatio:I.Numeric(.1,{min:.01,max:3,step:.01}),linkCap:I.Boolean(!0),visuals:I.MultiSelect(["ellipsoid-mesh","intra-bond","inter-bond"],I.objectToOptions(Kve)),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory)},w2t={name:"ellipsoid",label:"Ellipsoid",description:"Displays anisotropic displacement ellipsoids of atomic elements plus bonds as cylinders.",factory:function C2t(e,t){return Xn.createMulti("Ellipsoid",e,t,gl,Kve)},getParams:function S2t(e,t){return Zve},defaultValues:I.getDefaultValues(Zve),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0&&e.models.some(t=>ag.Provider.isApplicable(t)),getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent},A2t="\nprecision highp float;\n\nattribute vec3 aPosition;\nattribute float aRadius;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n\n#if defined(dCalcType_groupId)\n    attribute float aGroup;\n    varying float vGroup;\n#endif\n\nuniform vec3 uBboxSize;\nuniform vec3 uBboxMin;\nuniform float uResolution;\n\nvoid main() {\n    vRadiusSqInv = 1.0 / (aRadius * aRadius);\n    #if defined(dCalcType_groupId)\n        vGroup = aGroup;\n    #endif\n    gl_PointSize = ceil(((aRadius * 3.0) / uResolution) + uResolution);\n    vPosition = (aPosition - uBboxMin) / uResolution;\n    gl_Position = vec4(((aPosition - uBboxMin) / uBboxSize) * 2.0 - 1.0, 1.0);\n}\n",I2t="\nprecision highp float;\n\nvarying vec3 vPosition;\nvarying float vRadiusSqInv;\n#if defined(dCalcType_groupId)\n    #if defined(dGridTexType_2d)\n        precision highp sampler2D;\n        uniform sampler2D tMinDistanceTex;\n        uniform vec3 uGridTexDim;\n    #elif defined(dGridTexType_3d)\n        precision highp sampler3D;\n        uniform sampler3D tMinDistanceTex;\n    #endif\n    varying float vGroup;\n#endif\n\n#include common\n\nuniform vec3 uGridDim;\nuniform vec2 uGridTexScale;\nuniform float uCurrentSlice;\nuniform float uCurrentX;\nuniform float uCurrentY;\nuniform float uAlpha;\nuniform float uResolution;\nuniform float uRadiusFactorInv;\n\nvoid main() {\n    vec2 v = gl_FragCoord.xy - vec2(uCurrentX, uCurrentY) - 0.5;\n    vec3 fragPos = vec3(v.x, v.y, uCurrentSlice);\n    float dist = distance(fragPos, vPosition) * uResolution;\n\n    #if defined(dCalcType_density)\n        float density = exp(-uAlpha * ((dist * dist) * vRadiusSqInv));\n        gl_FragColor.a = density * uRadiusFactorInv;\n    #elif defined(dCalcType_minDistance)\n        gl_FragColor.a = 1.0 - dist * uRadiusFactorInv;\n    #elif defined(dCalcType_groupId)\n        #if defined(dGridTexType_2d)\n            float minDistance = 1.0 - texture2D(tMinDistanceTex, (gl_FragCoord.xy) / (uGridTexDim.xy / uGridTexScale)).a;\n        #elif defined(dGridTexType_3d)\n            float minDistance = 1.0 - texelFetch(tMinDistanceTex, ivec3(gl_FragCoord.xy, uCurrentSlice), 0).a;\n        #endif\n        if (dist * uRadiusFactorInv > minDistance + uResolution * 0.05)\n            discard;\n        gl_FragColor.rgb = packIntToRGB(vGroup);\n    #endif\n}\n",E2t={drawCount:_o("number"),instanceCount:_o("number"),aRadius:Pi("float32",1,0),aPosition:Pi("float32",3,0),aGroup:Pi("float32",1,0),uCurrentSlice:Ne("f"),uCurrentX:Ne("f"),uCurrentY:Ne("f"),uBboxMin:Ne("v3","material"),uBboxSize:Ne("v3","material"),uGridDim:Ne("v3","material"),uGridTexDim:Ne("v3","material"),uGridTexScale:Ne("v2","material"),uAlpha:Ne("f","material"),uResolution:Ne("f","material"),uRadiusFactorInv:Ne("f","material"),tMinDistanceTex:xn("texture","rgba","float","nearest","material"),dGridTexType:cn("string",["2d","3d"]),dCalcType:cn("string",["density","minDistance","groupId"])},qg="gaussian-density";function PY(e){return e.namedFramebuffers[qg]||(e.namedFramebuffers[qg]=e.resources.framebuffer()),e.namedFramebuffers[qg]}function kY(e,t,n,r,i,o){const s=`${qg}-${e}`;return t.namedTextures[s]||(t.namedTextures[s]=t.resources.texture(n,r,i,o)),t.namedTextures[s]}function Qve(e,t,n,r,i,o){return e.isWebGL2?function T2t(e,t,n,r,i,o){It&&e.timer.mark("GaussianDensityTexture3d");const s=function D2t(e,t,n,r,i,o){const{gl:s,resources:a,state:l,extensions:{colorBufferFloat:c,textureFloat:u,colorBufferHalfFloat:d,textureHalfFloat:f}}=e,{smoothness:p,resolution:m}=i,{drawCount:h,positions:g,radii:y,groups:v,scale:x,expandedBox:_,dim:w,maxRadius:A}=nxe(t,n,r,i),[M,E,D]=w,T=kY("min-dist-3d",e,"volume-uint8","rgba","ubyte","nearest");T.define(M,E,D);const F=Ue.create(1,1),R=2*A,N=rxe(e,h,g,y,v,T,_,w,w,F,p,m,R),{uCurrentSlice:j}=N.values,W=PY(e);function z($,V){l.currentRenderItemId=-1;for(let X=0;X<D;++X)O.update(j,X),$.attachFramebuffer(W,0,X),V&&s.clear(s.COLOR_BUFFER_BIT),N.render();s.flush()}return W.bind(),ixe(e),l.viewport(0,0,M,E),l.scissor(0,0,M,E),o||(o=d&&f?a.texture("volume-float16","rgba","fp16","linear"):c&&u?a.texture("volume-float32","rgba","float","linear"):a.texture("volume-uint8","rgba","ubyte","linear")),o.define(M,E,D),sxe(e,N),z(o,!0),oxe(e,N),z(T,!0),axe(e,N),z(o,!1),{texture:o,scale:x,bbox:_,gridDim:w,gridTexDim:w,gridTexScale:F,radiusFactor:R,resolution:m,maxRadius:A}}(e,t,n,r,i,o);return It&&e.timer.markEnd("GaussianDensityTexture3d"),Jve(s)}(e,t,n,r,i,o):MY(e,t,n,r,!1,i,o)}function MY(e,t,n,r,i,o,s){It&&e.timer.mark("GaussianDensityTexture2d");const a=function txe(e,t,n,r,i,o,s){const{gl:a,resources:l,state:c,extensions:{colorBufferFloat:u,textureFloat:d,colorBufferHalfFloat:f,textureHalfFloat:p,blendMinMax:m}}=e,{smoothness:h,resolution:g}=o,{drawCount:y,positions:v,radii:x,groups:_,scale:w,expandedBox:A,dim:M,maxRadius:E}=nxe(t,n,r,o),[D,T,F]=M,{texDimX:R,texDimY:N,texCols:j,powerOfTwoSize:W}=function k2t(e){const n=Math.sqrt(e[0]*e[1]*e[2]),r=Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)));let i=0,o=e[1],s=1,a=e[2];return r<e[0]*e[2]?(a=Math.floor(r/e[0]),s=Math.ceil(e[2]/a),i=a*e[0],o*=s):i=e[0]*e[2],{texDimX:i,texDimY:o,texRows:s,texCols:a,powerOfTwoSize:o<r?r:2*r}}(M),z=C.create(R,N,0),$=Ue.create(R/W,N/W),V=2*E,X=i?W:R,H=i?W:N,oe=kY("min-dist-2d",e,"image-uint8","rgba","ubyte","nearest");oe.define(X,H);const te=rxe(e,y,v,x,_,oe,A,M,z,$,h,g,V),{uCurrentSlice:K,uCurrentX:Q,uCurrentY:G}=te.values,Z=PY(e);function ee(se,xe){c.currentRenderItemId=-1,se.attachFramebuffer(Z,0),xe&&(c.viewport(0,0,X,H),c.scissor(0,0,X,H),a.clear(a.COLOR_BUFFER_BIT)),O.update(G,0);let re=0,ae=0,ge=0;for(let Ie=0;Ie<F;++Ie)re>=j&&(re-=j,ae+=T,ge=0,O.update(G,ae)),O.update(Q,ge),O.update(K,Ie),c.viewport(ge,ae,D,T),c.scissor(ge,ae,D,T),te.render(),++re,ge+=D;a.flush()}return Z.bind(),ixe(e),s||(s=f&&p?l.texture("image-float16","rgba","fp16","linear"):u&&d?l.texture("image-float32","rgba","float","linear"):l.texture("image-uint8","rgba","ubyte","linear")),s.define(X,H),sxe(e,te),ee(s,!0),m&&(oxe(e,te),ee(oe,!0),axe(e,te),ee(s,!1)),{texture:s,scale:w,bbox:A,gridDim:M,gridTexDim:z,gridTexScale:$,radiusFactor:V,resolution:g,maxRadius:E}}(e,t,n,r,i,o,s);return It&&e.timer.markEnd("GaussianDensityTexture2d"),Jve(a)}function Jve({texture:e,scale:t,bbox:n,gridDim:r,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:a,maxRadius:l}){return{transform:exe(t,n),texture:e,bbox:n,gridDim:r,gridTexDim:i,gridTexScale:o,radiusFactor:s,resolution:a,maxRadius:l}}function exe(e,t){const n=fe.identity();return fe.fromScaling(n,e),fe.setTranslation(n,t.min),n}function nxe(e,t,n,r){const{resolution:i,radiusOffset:o}=r,s=1/i,{indices:a,x:l,y:c,z:u,id:d}=e,f=Ve.size(a),p=new Float32Array(3*f),m=new Float32Array(f),h=new Float32Array(f);let g=0;for(let A=0;A<f;++A){const M=Ve.getAt(a,A);p[3*A]=l[M],p[3*A+1]=c[M],p[3*A+2]=u[M];const E=n(M)+o;g<E&&(g=E),m[A]=E,h[A]=d?d[A]:A}const y=2*g+4*i,v=Gt.expand(Gt(),t,C.create(y,y,y)),x=Gt.scale(Gt(),v,s),_=Gt.size(C(),x);return C.ceil(_,_),{drawCount:f,positions:p,radii:m,groups:h,scale:C.create(i,i,i),expandedBox:v,dim:_,maxRadius:g}}function rxe(e,t,n,r,i,o,s,a,l,c,u,d,f){if(e.namedComputeRenderables[qg]){const p=C.sub(C(),s.max,s.min),m=e.namedComputeRenderables[qg].values;O.updateIfChanged(m.drawCount,t),O.updateIfChanged(m.instanceCount,1),O.update(m.aRadius,r),O.update(m.aPosition,n),O.update(m.aGroup,i),O.updateIfChanged(m.uCurrentSlice,0),O.updateIfChanged(m.uCurrentX,0),O.updateIfChanged(m.uCurrentY,0),O.update(m.uBboxMin,s.min),O.update(m.uBboxSize,p),O.update(m.uGridDim,a),O.update(m.uGridTexDim,l),O.update(m.uGridTexScale,c),O.updateIfChanged(m.uAlpha,u),O.updateIfChanged(m.uResolution,d),O.updateIfChanged(m.uRadiusFactorInv,1/f),O.update(m.tMinDistanceTex,o),O.updateIfChanged(m.dGridTexType,o.getDepth()>0?"3d":"2d"),O.updateIfChanged(m.dCalcType,"density"),e.namedComputeRenderables[qg].update()}else e.namedComputeRenderables[qg]=function P2t(e,t,n,r,i,o,s,a,l,c,u,d,f){const p=C.sub(C(),s.max,s.min),m={drawCount:O.create(t),instanceCount:O.create(1),aRadius:O.create(r),aPosition:O.create(n),aGroup:O.create(i),uCurrentSlice:O.create(0),uCurrentX:O.create(0),uCurrentY:O.create(0),uBboxMin:O.create(s.min),uBboxSize:O.create(p),uGridDim:O.create(a),uGridTexDim:O.create(l),uGridTexScale:O.create(c),uAlpha:O.create(u),uResolution:O.create(d),uRadiusFactorInv:O.create(1/f),tMinDistanceTex:O.create(o),dGridTexType:O.create(o.getDepth()>0?"3d":"2d"),dCalcType:O.create("density")},h={...E2t};return ys(ms(e,"points",Wi(qg,A2t,I2t),h,m),m)}(e,t,n,r,i,o,s,a,l,c,u,d,f);return e.namedComputeRenderables[qg]}function ixe(e){const{gl:t,state:n}=e;n.disable(t.CULL_FACE),n.enable(t.BLEND),n.disable(t.DEPTH_TEST),n.enable(t.SCISSOR_TEST),n.depthMask(!1),n.clearColor(0,0,0,0)}function oxe(e,t){const{gl:n,state:r}=e;if(O.update(t.values.dCalcType,"minDistance"),t.update(),r.colorMask(!1,!1,!1,!0),r.blendFunc(n.ONE,n.ONE),!e.extensions.blendMinMax)throw new Error("GPU gaussian surface calculation requires EXT_blend_minmax");r.blendEquation(e.extensions.blendMinMax.MAX)}function sxe(e,t){const{gl:n,state:r}=e;O.update(t.values.dCalcType,"density"),t.update(),r.colorMask(!1,!1,!1,!0),r.blendFunc(n.ONE,n.ONE),r.blendEquation(n.FUNC_ADD)}function axe(e,t){const{gl:n,state:r}=e;O.update(t.values.dCalcType,"groupId"),t.update(),r.colorMask(!0,!0,!0,!1),r.blendFunc(n.ONE,n.ZERO),r.blendEquation(n.FUNC_ADD)}function lxe(e,t,n,r,i){return RY.apply(this,arguments)}function RY(){return RY=le(function*(e,t,n,r,i){const{resolution:o,radiusOffset:s,smoothness:a}=i,l=1/o,{indices:c,x:u,y:d,z:f,id:p}=t,m=Ve.size(c),h=new Float32Array(m);let g=0;for(let ee=0;ee<m;++ee){const se=r(Ve.getAt(c,ee))+s;g<se&&(g=se),h[ee]=se}const y=2*g+o,v=Gt.expand(Gt(),n,C.create(y,y,y)),x=v.min,_=Gt.scale(Gt(),v,l),w=Gt.size(C(),_);C.ceil(w,w);const A=mr.Space(w,[0,1,2],Float32Array),M=A.create(),E=mr.create(A,M),D=A.create();D.fill(-1);const T=mr.create(A,D),[F,R,N]=w,j=N,z=j*R,$=pw(w[0],x[0],o),V=pw(w[1],x[1],o),X=pw(w[2],x[2],o),H=A.create(),oe=a,te=Math.ceil(1e5/(Math.pow(Math.pow(g,3),3)*l));function K(ee,se){for(let xe=ee;xe<se;++xe){const re=Ve.getAt(c,xe),ae=u[re],ge=d[re],Ie=f[re],me=h[xe],he=1/(me*me),ie=2*me,ue=ie*ie,_e=Math.ceil(ie*l),Fe=Math.floor(l*(ae-x[0])),Ze=Math.floor(l*(ge-x[1])),ct=Math.floor(l*(Ie-x[2])),q=Math.max(0,Fe-_e),ne=Math.max(0,Ze-_e),be=Math.max(0,ct-_e),Ce=Math.min(F,Fe+_e+2),Re=Math.min(R,Ze+_e+2),Be=Math.min(N,ct+_e+2);for(let $e=q;$e<Ce;++$e){const nt=$[$e]-ae,ht=$e*z;for(let Ge=ne;Ge<Re;++Ge){const ft=V[Ge]-ge,vt=nt*nt+ft*ft,Pt=Ge*j+ht;for(let St=be;St<Be;++St){const Mt=X[St]-Ie,Qt=vt+Mt*Mt;if(Qt<=ue){const An=wA(Qt*he*-oe),Kn=St+Pt;M[Kn]+=An,An>H[Kn]&&(H[Kn]=An,D[Kn]=p?p[xe]:xe)}}}}}}function G(){return(G=le(function*(){for(let ee=0;ee<m;ee+=te)K(ee,Math.min(ee+te,m)),e.shouldUpdate&&(yield e.update({message:"filling density grid",current:ee,max:m}))})).apply(this,arguments)}yield function Q(){return G.apply(this,arguments)}();const Z=fe.identity();return fe.fromScaling(Z,C.create(o,o,o)),fe.setTranslation(Z,v.min),{field:E,idField:T,transform:Z,radiusFactor:1,resolution:o,maxRadius:g}}),RY.apply(this,arguments)}const ZP={resolution:I.Numeric(1,{min:.1,max:20,step:.1},{description:"Grid resolution/cell spacing.",...xt.CustomQualityParamInfo}),radiusOffset:I.Numeric(0,{min:0,max:10,step:.1},{description:"Extra/offset radius added to the atoms/coarse elements for gaussian calculation. Useful to create coarse, low resolution surfaces."}),smoothness:I.Numeric(1.5,{min:.5,max:2.5,step:.1},{description:"Smoothness of the gausian surface, lower is smoother."}),...$F};function cxe(e,t){const n=e.maxTextureSize/3;return n*n/Math.max(1,t?t.units.length/16:1)}function uxe(e,t,n,r){const{position:i,boundary:o,radius:s}=YF(e,t,n,r),a=sv(o.box,r);return Ke.create("Gaussian Density",function(){var l=le(function*(c){return yield lxe(c,i,o.box,s,a)});return function(c){return l.apply(this,arguments)}}())}I.getDefaultValues(ZP);const dxe={...ZP,...Dde,ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),tryUseGpu:I.Boolean(!0),includeParent:I.Boolean(!1,{isHidden:!0})},NY={...ml,...agt,...dxe},fxe={...kA,...egt,...dxe};function pxe(e){return e.extensions.colorBufferFloat&&e.extensions.textureFloat&&e.extensions.blendMinMax&&e.extensions.drawBuffers}function mI(e,t,n){if(t.resolution>1)return!1;const r=n.maxTextureSize/3,{areaCells:i,maxAreaCells:o}=Fye(e.boundary.box,t.resolution,r*r);return i<o}function L2t(e,t,n,r){return n.tryUseGpu&&r&&pxe(r)&&mI(t,n,r)?function q2t(e){return function lgt(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.createGeometry=!0)},geometryUtils:iu.Utils},t)}({defaultProps:I.getDefaultValues(NY),createGeometry:G2t,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0),n.smoothColors.name!==r.smoothColors.name?t.updateColor=!0:"on"===n.smoothColors.name&&"on"===r.smoothColors.name&&(n.smoothColors.params.resolutionFactor!==r.smoothColors.params.resolutionFactor&&(t.updateColor=!0),n.smoothColors.params.sampleStride!==r.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,n,r)=>!n.tryUseGpu||!r||!mI(t.structure,n,r),processValues:(t,n,r,i,o)=>{const{resolution:s,colorTexture:a}=n.meta,l=Dp(r.smoothColors,i.color.preferSmoothing,s);l&&o&&(ame(t,l.resolution,l.stride,o,a),n.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var n;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),null===(n=t.meta.colorTexture)||void 0===n||n.destroy()}},e)}(e):function z2t(e){return mc({defaultProps:I.getDefaultValues(NY),createGeometry:U2t,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0),n.smoothColors.name!==r.smoothColors.name?t.updateColor=!0:"on"===n.smoothColors.name&&"on"===r.smoothColors.name&&(n.smoothColors.params.resolutionFactor!==r.smoothColors.params.resolutionFactor&&(t.updateColor=!0),n.smoothColors.params.sampleStride!==r.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,n,r)=>n.tryUseGpu&&!!r&&mI(t.structure,n,r),processValues:(t,n,r,i,o)=>{const{resolution:s,colorTexture:a}=n.meta,l=Dp(r.smoothColors,i.color.preferSmoothing,s);l&&(nF(t,l.resolution,l.stride,o,a),n.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var n;null===(n=t.meta.colorTexture)||void 0===n||n.destroy()}},e)}(e)}function j2t(e,t,n,r){return n.tryUseGpu&&r&&pxe(r)&&mI(t,n,r)?function $2t(e){return function tgt(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.createGeometry=!0)},geometryUtils:iu.Utils},t)}({defaultProps:I.getDefaultValues(fxe),createGeometry:W2t,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0),n.smoothColors.name!==r.smoothColors.name?t.updateColor=!0:"on"===n.smoothColors.name&&"on"===r.smoothColors.name&&(n.smoothColors.params.resolutionFactor!==r.smoothColors.params.resolutionFactor&&(t.updateColor=!0),n.smoothColors.params.sampleStride!==r.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,n,r)=>!n.tryUseGpu||!r||!mI(t,n,r),processValues:(t,n,r,i,o)=>{const{resolution:s,colorTexture:a}=n.meta,l=Dp(r.smoothColors,i.color.preferSmoothing,s);l&&o&&(ame(t,l.resolution,l.stride,o,a),n.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var n;t.vertexTexture.ref.value.destroy(),t.groupTexture.ref.value.destroy(),t.normalTexture.ref.value.destroy(),t.doubleBuffer.destroy(),null===(n=t.meta.colorTexture)||void 0===n||n.destroy()}},e)}(e):function H2t(e){return Hy({defaultProps:I.getDefaultValues(fxe),createGeometry:V2t,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.smoothColors.name!==r.smoothColors.name?t.updateColor=!0:"on"===n.smoothColors.name&&"on"===r.smoothColors.name&&(n.smoothColors.params.resolutionFactor!==r.smoothColors.params.resolutionFactor&&(t.updateColor=!0),n.smoothColors.params.sampleStride!==r.smoothColors.params.sampleStride&&(t.updateColor=!0))},mustRecreate:(t,n,r)=>n.tryUseGpu&&!!r&&mI(t,n,r),processValues:(t,n,r,i,o)=>{const{resolution:s,colorTexture:a}=n.meta,l=Dp(r.smoothColors,i.color.preferSmoothing,s);l&&(nF(t,l.resolution,l.stride,o,a),n.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var n;null===(n=t.meta.colorTexture)||void 0===n||n.destroy()}},e)}(e)}function U2t(e,t,n,r,i,o){return FY.apply(this,arguments)}function FY(){return FY=le(function*(e,t,n,r,i,o){const{smoothness:s}=i,{transform:a,field:l,idField:c,radiusFactor:u,resolution:d,maxRadius:f}=yield uxe(n,t,r.size,i).runInContext(e.runtime),p={isoLevel:Math.exp(-s)/u,scalarField:l,idField:c},m=yield yA(p,o).runAsChild(e.runtime);m.meta.resolution=d,on.transform(m,a),e.webgl&&!e.webgl.isWebGL2?(on.uniformTriangleGroup(m),O.updateIfChanged(m.varyingGroup,!1)):O.updateIfChanged(m.varyingGroup,!0);const h=ke.expand(ke(),t.boundary.sphere,f);return m.setBoundingSphere(h),m}),FY.apply(this,arguments)}function V2t(e,t,n,r,i){return OY.apply(this,arguments)}function OY(){return OY=le(function*(e,t,n,r,i){const{smoothness:o}=r,{transform:s,field:a,idField:l,radiusFactor:c,resolution:u,maxRadius:d}=yield function F2t(e,t,n){const{position:r,boundary:i,radius:o}=XF(e,t,n),s=sv(i.box,n);return Ke.create("Gaussian Density",function(){var a=le(function*(l){return yield lxe(l,r,i.box,o,s)});return function(l){return a.apply(this,arguments)}}())}(t,n.size,r).runInContext(e.runtime),f={isoLevel:Math.exp(-o)/c,scalarField:a,idField:l},p=yield yA(f,i).runAsChild(e.runtime);p.meta.resolution=u,on.transform(p,s),e.webgl&&!e.webgl.isWebGL2?(on.uniformTriangleGroup(p),O.updateIfChanged(p.varyingGroup,!1)):O.updateIfChanged(p.varyingGroup,!0);const m=ke.expand(ke(),t.boundary.sphere,d);return p.setBoundingSphere(m),p}),OY.apply(this,arguments)}const gI="gaussian-surface";function G2t(e,t,n,r,i,o){return BY.apply(this,arguments)}function BY(){return BY=le(function*(e,t,n,r,i,o){if(!e.webgl)throw new Error("webgl context required to create gaussian surface texture-mesh");It&&e.webgl.timer.mark("createGaussianSurfaceTextureMesh");const{namedTextures:s,resources:a,extensions:{colorBufferFloat:l,textureFloat:c,colorBufferHalfFloat:u,textureHalfFloat:d}}=e.webgl;s[gI]||(s[gI]=u&&d?a.texture("image-float16","rgba","fp16","linear"):l&&c?a.texture("image-float32","rgba","float","linear"):a.texture("image-uint8","rgba","ubyte","linear"));const f=yield function N2t(e,t,n,r,i,o,s){const{position:a,boundary:l,radius:c}=YF(e,t,n,i),u=sv(l.box,i,cxe(o,e));return Ke.create("Gaussian Density",function(){var d=le(function*(f){return MY(o,a,l.box,c,r,u,s)});return function(f){return d.apply(this,arguments)}}())}(n,t,r.size,!0,i,e.webgl,s[gI]).runInContext(e.runtime),p=Math.exp(-i.smoothness)/f.radiusFactor,m=C.create(0,1,2),h=o?.doubleBuffer.get(),g=xF(e.webgl,f.texture,f.gridDim,f.gridTexDim,f.gridTexScale,f.transform,p,!1,!0,m,!0,h?.vertex,h?.group,h?.normal);It&&e.webgl.timer.markEnd("createGaussianSurfaceTextureMesh");const y=t.elements.length,v=ke.expand(ke(),t.boundary.sphere,f.maxRadius),x=iu.create(g.vertexCount,y,g.vertexTexture,g.groupTexture,g.normalTexture,v,o);return x.meta.resolution=f.resolution,x.meta.webgl=e.webgl,x}),BY.apply(this,arguments)}function W2t(e,t,n,r,i){return LY.apply(this,arguments)}function LY(){return LY=le(function*(e,t,n,r,i){if(!e.webgl)throw new Error("webgl context required to create structure gaussian surface texture-mesh");It&&e.webgl.timer.mark("createStructureGaussianSurfaceTextureMesh");const{namedTextures:o,resources:s,extensions:{colorBufferFloat:a,textureFloat:l,colorBufferHalfFloat:c,textureHalfFloat:u}}=e.webgl;o[gI]||(o[gI]=c&&u?s.texture("image-float16","rgba","fp16","linear"):a&&l?s.texture("image-float32","rgba","float","linear"):s.texture("image-uint8","rgba","ubyte","linear"));const d=yield function B2t(e,t,n,r,i,o){const{box:s}=e.lookup3d.boundary,{position:a,boundary:l,radius:c}=XF(e,t,r),u=sv(l.box,r);return Ke.create("Gaussian Density",function(){var d=le(function*(f){return MY(i,a,s,c,n,u,o)});return function(f){return d.apply(this,arguments)}}())}(t,n.size,!0,r,e.webgl,o[gI]).runInContext(e.runtime),f=Math.exp(-r.smoothness)/d.radiusFactor,p=C.create(0,1,2),m=i?.doubleBuffer.get(),h=xF(e.webgl,d.texture,d.gridDim,d.gridTexDim,d.gridTexScale,d.transform,f,!1,!0,p,!0,m?.vertex,m?.group,m?.normal);It&&e.webgl.timer.markEnd("createStructureGaussianSurfaceTextureMesh");const g=t.elementCount,y=ke.expand(ke(),t.boundary.sphere,d.maxRadius),v=iu.create(h.vertexCount,g,h.vertexTexture,h.groupTexture,h.normalTexture,y,i);return v.meta.resolution=d.resolution,v.meta.webgl=e.webgl,v}),LY.apply(this,arguments)}function Y2t(e,t,n,r,i,o){return jY.apply(this,arguments)}function jY(){return jY=le(function*(e,t,n,r,i,o){const{smoothness:s}=i,{transform:a,field:l,idField:c,maxRadius:u}=yield uxe(n,t,r.size,i).runInContext(e.runtime),d={isoLevel:Math.exp(-s),scalarField:l,idField:c},f=yield YG(d,o).runAsChild(e.runtime);Mo.transform(f,a);const p=ke.expand(ke(),t.boundary.sphere,u);return f.setBoundingSphere(p),f}),jY.apply(this,arguments)}const hxe={...KF,...ZP,sizeFactor:I.Numeric(3,{min:0,max:10,step:.1}),lineSizeAttenuation:I.Boolean(!1),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),includeParent:I.Boolean(!1,{isHidden:!0})};function X2t(e){return ZF({defaultProps:I.getDefaultValues(hxe),createGeometry:Y2t,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0)}},e)}const mxe={"gaussian-surface-mesh":(e,t)=>Uo("Gaussian surface mesh",e,t,L2t),"structure-gaussian-surface-mesh":(e,t)=>Ff("Structure-Gaussian surface mesh",e,t,j2t),"gaussian-surface-wireframe":(e,t)=>Uo("Gaussian surface wireframe",e,t,X2t)},gxe={...NY,...hxe,visuals:I.MultiSelect(["gaussian-surface-mesh"],I.objectToOptions(mxe)),bumpFrequency:I.Numeric(1,{min:0,max:10,step:.1},xt.ShadingCategory)},Q2t={name:"gaussian-surface",label:"Gaussian Surface",description:"Displays a gaussian molecular surface.",factory:function Z2t(e,t){return Xn.createMulti("Gaussian Surface",e,t,gl,mxe)},getParams:function K2t(e,t){return gxe},defaultValues:I.getDefaultValues(gxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0},yxe={...Kmt,background:I.Boolean(!1),backgroundMargin:I.Numeric(0,{min:0,max:1,step:.01}),backgroundColor:I.Color(qn.black),backgroundOpacity:I.Numeric(.5,{min:0,max:1,step:.01}),borderWidth:I.Numeric(.25,{min:0,max:.5,step:.01}),level:I.Select("residue",[["chain","Chain"],["residue","Residue"],["element","Element"]],{isEssential:!0}),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),chainScale:I.Numeric(10,{min:0,max:20,step:.1}),residueScale:I.Numeric(1,{min:0,max:20,step:.1}),elementScale:I.Numeric(.5,{min:0,max:20,step:.1})};function J2t(e){return function Zmt(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0),r.background!==i.background&&(n.createGeometry=!0),r.backgroundMargin!==i.backgroundMargin&&(n.createGeometry=!0),r.tether!==i.tether&&(n.createGeometry=!0),r.tetherLength!==i.tetherLength&&(n.createGeometry=!0),r.tetherBaseWidth!==i.tetherBaseWidth&&(n.createGeometry=!0),r.attachment!==i.attachment&&(n.createGeometry=!0),r.fontFamily!==i.fontFamily&&(n.createGeometry=!0),r.fontQuality!==i.fontQuality&&(n.createGeometry=!0),r.fontStyle!==i.fontStyle&&(n.createGeometry=!0),r.fontVariant!==i.fontVariant&&(n.createGeometry=!0),r.fontWeight!==i.fontWeight&&(n.createGeometry=!0)},geometryUtils:Tf.Utils},t)}({defaultProps:I.getDefaultValues(yxe),createGeometry:eSt,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{t.createGeometry=n.level!==r.level||"chain"===n.level&&n.chainScale!==r.chainScale||"residue"===n.level&&n.residueScale!==r.residueScale||"element"===n.level&&n.elementScale!==r.elementScale||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant}},e)}function eSt(e,t,n,r,i){switch(r.level){case"chain":return function tSt(e,t,n,r,i){const o=dt.create(t),{units:s,serialMapping:a}=t,{auth_asym_id:l,label_asym_id:c}=Je.chain,{cumulativeUnitElementCount:u}=a,d=s.length,{chainScale:f}=r,p=Ig.create(r,d,d/2,i);for(let m=0,h=s.length;m<h;++m){const g=s[m];o.unit=g,o.element=g.elements[0];const{center:y,radius:v}=g.lookup3d.boundary.sphere;C.transformMat4(eh,y,g.conformation.operator.matrix);const x=l(o),_=c(o);p.add(x===_?_:`${_} [${x}]`,eh[0],eh[1],eh[2],v,f,u[m])}return p.getText()}(0,t,0,r,i);case"residue":return function nSt(e,t,n,r,i){const o=dt.create(t),{units:s,serialMapping:a}=t,{label_comp_id:l}=Je.atom,{auth_seq_id:c}=Je.residue,{cumulativeUnitElementCount:u}=a,d=2*t.polymerResidueCount,{residueScale:f}=r,p=Ig.create(r,d,d/2,i);for(let m=0,h=s.length;m<h;++m){const g=s[m],y=g.conformation,{elements:v}=g;o.unit=g,o.element=g.elements[0];const x=g.model.atomicHierarchy.residueAtomSegments.index,_=u[m];let w=0;const A=v.length;for(;w<A;){const M=w,E=x[v[w]];for(w++;w<A&&x[v[w]]===E;)w++;QP.reset();for(let j=M;j<w;j++)y.position(v[j],eh),QP.includePosition(eh);QP.finishedIncludeStep();for(let j=M;j<w;j++)y.position(v[j],eh),QP.radiusPosition(eh);o.element=v[M];const{center:D,radius:T}=QP.getSphere(),F=c(o),N=`${l(o)} ${F}`;p.add(N,D[0],D[1],D[2],T,f,_+M)}}return p.getText()}(0,t,0,r,i);case"element":return function rSt(e,t,n,r,i){const o=dt.create(t),{units:s,serialMapping:a}=t,{label_atom_id:l,label_alt_id:c}=Je.atom,{cumulativeUnitElementCount:u}=a,d=n.size,f=t.elementCount,{elementScale:p}=r,m=Ig.create(r,f,f/2,i);for(let h=0,g=s.length;h<g;++h){const y=s[h],v=y.conformation,{elements:x}=y;o.unit=y;const _=u[h],w=g2(t,y,{...r,traceOnly:!1});for(let A=0,M=x.length;A<M;A++){if(w&&w(x[A]))continue;o.element=x[A],v.position(o.element,eh);const E=l(o),D=c(o);m.add(D?`${E}%${D}`:E,eh[0],eh[1],eh[2],d.size(o),p,_+A)}}return m.getText()}(0,t,n,r,i)}}const eh=C(),QP=new xf("98"),bxe={"label-text":(e,t)=>Ff("Label text",e,t,J2t)},vxe={...yxe,visuals:I.MultiSelect(["label-text"],I.objectToOptions(bxe))},sSt={name:"label",label:"Label",description:"Displays labels.",factory:function oSt(e,t){const n=Xn.createMulti("Label",e,t,gl,bxe);return n.setState({pickable:!1,markerActions:un.None}),n},getParams:function iSt(e,t){return vxe},defaultValues:I.getDefaultValues(vxe),defaultColorTheme:{name:"uniform"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0},UY={probeRadius:I.Numeric(1.4,{min:0,max:10,step:.1},{description:"Radius of the probe tracing the molecular surface."}),resolution:I.Numeric(.5,{min:.01,max:20,step:.01},{description:"Grid resolution/cell spacing.",...xt.CustomQualityParamInfo}),probePositions:I.Numeric(36,{min:12,max:90,step:1},{description:"Number of positions tested for probe target intersection.",...xt.CustomQualityParamInfo})};function zY(){return zY=le(function*(e,t,n,r,i,o){let s=-1;function a(ne,be,Ce,Re,Be){if(-1!==s){const $e=s;if($e!==Re&&$e!==Be&&l($e,ne,be,Ce))return $e;s=-1}for(let $e=0,nt=F.count;$e<nt;++$e){const ht=Ve.getAt(R,F.indices[$e]);if(ht!==Re&&ht!==Be&&l(ht,ne,be,Ce))return s=ht,ht}return-1}function l(ne,be,Ce,Re){const Be=$[ne],$e=N[ne]-be,nt=j[ne]-Ce,ht=W[ne]-Re;return $e*$e+nt*nt+ht*ht<Be*Be}function c(ne,be){for(let Ce=ne;Ce<be;++Ce){const Re=Ve.getAt(R,Ce),Be=N[Re],$e=j[Re],nt=W[Re],ht=$[Re],Ge=ht*ht;T.find(Be,$e,nt,ht);const ft=Math.ceil(ht*M),vt=Math.floor(M*(Be-oe)),Pt=Math.floor(M*($e-te)),St=Math.floor(M*(nt-K)),Mt=Math.max(0,vt-ft),Qt=Math.max(0,Pt-ft),An=Math.max(0,St-ft),Kn=Math.min(Z,vt+ft+2),ti=Math.min(ee,Pt+ft+2),ut=Math.min(se,St+ft+2);for(let Et=Mt;Et<Kn;++Et){const Nt=ie[Et]-Be,ye=Et*ae;for(let we=Qt;we<ti;++we){const Te=ue[we]-$e,je=Nt*Nt+Te*Te,Ft=we*xe+ye;for(let Vt=An;Vt<ut;++Vt){const pn=_e[Vt]-nt,Pr=je+pn*pn;if(Pr<Ge){const Jn=Vt+Ft;Ae[Jn]<0&&(Ae[Jn]*=-1);const bi=Math.sqrt(Pr),ns=ht/bi;if(-1===a(Nt*ns+Be,Te*ns+$e,pn*ns+nt,Re,-1)){const vm=ht-bi;vm<Ae[Jn]&&(Ae[Jn]=vm,he[Jn]=z[Ce])}}}}}}}function d(){return(d=le(function*(){for(let ne=0;ne<V;ne+=Fe)c(ne,Math.min(ne+Fe,V)),e.shouldUpdate&&(yield e.update({message:"projecting points",current:ne,max:V}))})).apply(this,arguments)}const f=C(),p=C(),m=C(),h=C();function g(ne,be){const Ce=$[ne],Re=$[be],Be=f[0]=N[be]-N[ne],$e=f[1]=j[be]-j[ne],nt=f[2]=W[be]-W[ne],Ge=Math.sqrt(Be*Be+$e*$e+nt*nt),vt=Ce*((Ce*Ce+Ge*Ge-Re*Re)/(2*Ce*Ge));C.normalize(f,f),function aSt(e,t){e[0]=e[1]=e[2]=1,0!==t[0]?e[0]=(t[1]+t[2])/-t[0]:0!==t[1]?e[1]=(t[0]+t[2])/-t[1]:0!==t[2]&&(e[2]=(t[0]+t[1])/-t[2])}(m,f),C.normalize(m,m),C.cross(h,f,m),C.normalize(h,h);const Pt=Math.sqrt(Ce*Ce-vt*vt);C.scale(m,m,Pt),C.scale(h,h,Pt),C.scale(f,f,vt),p[0]=f[0]+N[ne],p[1]=f[1]+j[ne],p[2]=f[2]+W[ne],s=-1;for(let St=0;St<A;++St){const Mt=ge[St],Qt=Ie[St],An=p[0]+Mt*m[0]+Qt*h[0],Kn=p[1]+Mt*m[1]+Qt*h[1],ti=p[2]+Mt*m[2]+Qt*h[2];if(-1===a(An,Kn,ti,ne,be)){const ut=Math.floor(M*(An-oe)),Et=Math.floor(M*(Kn-te)),Nt=Math.floor(M*(ti-K)),ye=Math.max(0,ut-E),we=Math.max(0,Et-E),Te=Math.max(0,Nt-E),je=Math.min(Z,ut+E+2),Ft=Math.min(ee,Et+E+2),Vt=Math.min(se,Nt+E+2);for(let pn=ye;pn<je;++pn){const Pr=An-ie[pn],Jn=pn*ae;for(let bi=we;bi<Ft;++bi){const ns=Kn-ue[bi],_c=Pr*Pr+ns*ns,Js=bi*xe+Jn;for(let id=Te;id<Vt;++id){const vm=ti-_e[id],Qe=_c+vm*vm,Mn=id+Js,gt=Ae[Mn];gt>0&&Qe<gt*gt&&(Ae[Mn]=Math.sqrt(Qe),he[Mn]=z[Ve.indexOf(R,Pr*f[0]+ns*f[1]+vm*f[2]<0?be:ne)])}}}}}}function y(ne,be){for(let Ce=ne;Ce<be;++Ce){const Re=Ve.getAt(R,Ce);T.find(N[Re],j[Re],W[Re],$[Re]);for(let Be=0,$e=F.count;Be<$e;++Be){const nt=Ve.getAt(R,F.indices[Be]);Re<nt&&g(Re,nt)}}}function x(){return(x=le(function*(){for(let ne=0;ne<V;ne+=Fe)y(ne,Math.min(ne+Fe,V)),e.shouldUpdate&&(yield e.update({message:"projecting torii",current:ne,max:V}))})).apply(this,arguments)}const{resolution:_,probeRadius:w,probePositions:A}=o,M=1/_,E=Math.max(5,2+Math.floor(w*M)),D=C.create(r,r,r);C.scale(D,D,2);const T=zh(t,n,D),F=T.result;null===i&&(i=T.boundary.box);const{indices:R,x:N,y:j,z:W,id:z,radius:$}=t,V=Ve.size(R),X=r+_,H=Gt.expand(Gt(),i,C.create(X,X,X)),[oe,te,K]=H.min,Q=Gt.scale(Gt(),H,M),G=Gt.size(C(),Q);C.ceil(G,G);const[Z,ee,se]=G,xe=se,ae=xe*ee,{cosTable:ge,sinTable:Ie}=function lSt(e){let t=0;const n=2*Math.PI/e,r=new Float32Array(e),i=new Float32Array(e);for(let o=0;o<e;o++)r[o]=Math.cos(t),i[o]=Math.sin(t),t+=n;return{cosTable:r,sinTable:i}}(A),me=mr.Space(G,[0,1,2],Float32Array),Ae=me.create(),he=me.create();Ae.fill(-1001),he.fill(-1);const ie=pw(Z,oe,_),ue=pw(ee,te,_),_e=pw(se,K,_),Fe=Math.ceil(1e5/(Math.pow(Math.pow(r,3),3)*M));yield function u(){return d.apply(this,arguments)}(),yield function v(){return x.apply(this,arguments)}();const Ze=mr.create(me,Ae),ct=mr.create(me,he),q=fe.identity();return fe.fromScaling(q,C.create(_,_,_)),fe.setTranslation(q,H.min),{field:Ze,idField:ct,transform:q,resolution:_,maxRadius:r}}),zY.apply(this,arguments)}function xxe(e,t,n,r){const{position:i,boundary:o,maxRadius:s}=function uSt(e,t,n,r){const{probeRadius:i}=r,{position:o,boundary:s,radius:a}=YF(e,t,n,r),{indices:l}=o,c=Ve.size(l),u=new Float32Array(Ve.end(l));let d=0;for(let f=0;f<c;++f){const p=Ve.getAt(l,f),m=a(p);d<m&&(d=m),u[p]=m+i}return{position:{...o,radius:u},boundary:s,maxRadius:d}}(e,t,n,r),a=sv(o.box,r);return Ke.create("Molecular Surface",function(){var l=le(function*(c){return yield _xe(c,i,o,s,o.box,a)});return function(c){return l.apply(this,arguments)}}())}function _xe(e,t,n,r,i,o){return VY.apply(this,arguments)}function VY(){return VY=le(function*(e,t,n,r,i,o){return function cSt(e,t,n,r,i,o){return zY.apply(this,arguments)}(e,t,n,r,i,o)}),VY.apply(this,arguments)}I.getDefaultValues(UY);const HY={...ml,...UY,...$F,...Dde};function pSt(e,t,n,r,i,o){return GY.apply(this,arguments)}function GY(){return GY=le(function*(e,t,n,r,i,o){const{transform:s,field:a,idField:l,resolution:c,maxRadius:u}=yield xxe(n,t,r.size,i).runInContext(e.runtime),d={isoLevel:i.probeRadius,scalarField:a,idField:l},f=yield yA(d,o).runAsChild(e.runtime);if(i.includeParent){const m=Math.ceil(2/i.resolution);on.smoothEdges(f,{iterations:m,maxNewEdgeLength:Math.sqrt(2)})}on.transform(f,s),e.webgl&&!e.webgl.isWebGL2?(on.uniformTriangleGroup(f),O.updateIfChanged(f.varyingGroup,!1)):O.updateIfChanged(f.varyingGroup,!0);const p=ke.expand(ke(),t.boundary.sphere,u);return f.setBoundingSphere(p),f.meta.resolution=c,f}),GY.apply(this,arguments)}function hSt(e){return mc({defaultProps:I.getDefaultValues(HY),createGeometry:pSt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.probeRadius!==r.probeRadius&&(t.createGeometry=!0),n.probePositions!==r.probePositions&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0),n.smoothColors.name!==r.smoothColors.name?t.updateColor=!0:"on"===n.smoothColors.name&&"on"===r.smoothColors.name&&(n.smoothColors.params.resolutionFactor!==r.smoothColors.params.resolutionFactor&&(t.updateColor=!0),n.smoothColors.params.sampleStride!==r.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,n,r,i,o)=>{const{resolution:s,colorTexture:a}=n.meta,l=Dp(r.smoothColors,i.color.preferSmoothing,s);l&&(nF(t,l.resolution,l.stride,o,a),n.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var n;null===(n=t.meta.colorTexture)||void 0===n||n.destroy()}},e)}function mSt(e,t,n,r,i){return qY.apply(this,arguments)}function qY(){return qY=le(function*(e,t,n,r,i){const{transform:o,field:s,idField:a,resolution:l,maxRadius:c}=yield function fSt(e,t,n){const{position:r,boundary:i,maxRadius:o}=function dSt(e,t,n){const{probeRadius:r}=n,{position:i,boundary:o,radius:s}=XF(e,t,n),{indices:a}=i,l=Ve.size(a),c=new Float32Array(Ve.end(a));let u=0;for(let d=0;d<l;++d){const f=Ve.getAt(a,d),p=s(f);u<p&&(u=p),c[f]=p+r}return{position:{...i,radius:c},boundary:o,maxRadius:u}}(e,t,n),s=sv(i.box,n);return Ke.create("Molecular Surface",function(){var a=le(function*(l){return yield _xe(l,r,i,o,i.box,s)});return function(l){return a.apply(this,arguments)}}())}(t,n.size,r).runInContext(e.runtime),u={isoLevel:r.probeRadius,scalarField:s,idField:a},d=yield yA(u,i).runAsChild(e.runtime);if(r.includeParent){const p=Math.ceil(2/r.resolution);on.smoothEdges(d,{iterations:p,maxNewEdgeLength:Math.sqrt(2)})}on.transform(d,o),e.webgl&&!e.webgl.isWebGL2?(on.uniformTriangleGroup(d),O.updateIfChanged(d.varyingGroup,!1)):O.updateIfChanged(d.varyingGroup,!0);const f=ke.expand(ke(),t.boundary.sphere,c);return d.setBoundingSphere(f),d.meta.resolution=l,d}),qY.apply(this,arguments)}function gSt(e){return Hy({defaultProps:I.getDefaultValues(HY),createGeometry:mSt,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.probeRadius!==r.probeRadius&&(t.createGeometry=!0),n.probePositions!==r.probePositions&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0),n.smoothColors.name!==r.smoothColors.name?t.updateColor=!0:"on"===n.smoothColors.name&&"on"===r.smoothColors.name&&(n.smoothColors.params.resolutionFactor!==r.smoothColors.params.resolutionFactor&&(t.updateColor=!0),n.smoothColors.params.sampleStride!==r.smoothColors.params.sampleStride&&(t.updateColor=!0))},processValues:(t,n,r,i,o)=>{const{resolution:s,colorTexture:a}=n.meta,l=Dp(r.smoothColors,i.color.preferSmoothing,s);l&&(nF(t,l.resolution,l.stride,o,a),n.meta.colorTexture=t.tColorGrid.ref.value)},dispose:t=>{var n;null===(n=t.meta.colorTexture)||void 0===n||n.destroy()}},e)}const Sxe={...KF,...UY,...$F,sizeFactor:I.Numeric(1.5,{min:0,max:10,step:.1})};function ySt(e,t,n,r,i,o){return WY.apply(this,arguments)}function WY(){return WY=le(function*(e,t,n,r,i,o){const{transform:s,field:a,idField:l,maxRadius:c}=yield xxe(n,t,r.size,i).runInContext(e.runtime),u={isoLevel:i.probeRadius,scalarField:a,idField:l},d=yield YG(u,o).runAsChild(e.runtime);Mo.transform(d,s);const f=ke.expand(ke(),t.boundary.sphere,c);return d.setBoundingSphere(f),d}),WY.apply(this,arguments)}function bSt(e){return ZF({defaultProps:I.getDefaultValues(Sxe),createGeometry:ySt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.probeRadius!==r.probeRadius&&(t.createGeometry=!0),n.probePositions!==r.probePositions&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0)}},e)}const Cxe={"molecular-surface-mesh":(e,t)=>Uo("Molecular surface mesh",e,t,hSt),"structure-molecular-surface-mesh":(e,t)=>Ff("Structure Molecular surface mesh",e,t,gSt),"molecular-surface-wireframe":(e,t)=>Uo("Molecular surface wireframe",e,t,bSt)},wxe={...HY,...Sxe,visuals:I.MultiSelect(["molecular-surface-mesh"],I.objectToOptions(Cxe)),bumpFrequency:I.Numeric(1,{min:0,max:10,step:.1},xt.ShadingCategory)},_St={name:"molecular-surface",label:"Molecular Surface",description:"Displays a molecular surface.",factory:function xSt(e,t){return Xn.createMulti("Molecular Surface",e,t,gl,Cxe)},getParams:function vSt(e,t){return wxe},defaultValues:I.getDefaultValues(wxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0},Axe={...ml,sizeFactor:I.Numeric(1,{min:0,max:2,step:.1}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo)};function SSt(e){return mc({defaultProps:I.getDefaultValues(Axe),createGeometry:wSt,createLocationIterator:ASt,getLoci:ISt,eachLocation:ESt,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail}},e)}function wSt(e,t,n,r,i,o){if(!function CSt(e){if(ze.Traits.is(e.traits,ze.Trait.MultiChain)||ze.Traits.is(e.traits,ze.Trait.Partitioned))return!1;if(ze.isCoarse(e))return!0;if(0===e.elements.length)return!1;const n=e.model.atomicHierarchy.derived.residue.moleculeType[e.residueIndex[e.elements[0]]];return!(3===n||2===n)}(t))return on.createEmpty(o);const{detail:s,sizeFactor:a}=i,c=Ct.createState(256,128,o),u=t.principalAxes.boxAxes,{origin:d,dirA:f,dirB:p}=u,m=rc.size(C(),u);C.scale(m,m,a/2);const h=C.create(m[2],m[1],m[0]);c.currentGroup=0,OG(c,d,f,p,h,s+1);const g=Ct.getMesh(c),y=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return g.setBoundingSphere(y),g}function ASt(e){const{group:t,structure:n}=e,i=t.units.length,o=dt.create(n);return Vi(1,i,1,(a,l)=>{const c=t.units[l];return o.unit=c,o.element=c.elements[a],o})}function ISt(e,t,n){const{objectId:r,instanceId:i}=e;if(n===r){const{structure:o,group:s}=t,a=s.units[i];return Me(o,[{unit:a,indices:Ve.ofBounds(0,a.elements.length)}])}return qr}function ESt(e,t,n){let r=!1;if(!Me.is(e))return!1;const{structure:i,group:o}=t;if(!Xe.areEquivalent(e.structure,i))return!1;const s=o.elements.length;for(const a of e.elements){const l=o.unitIndexMap.get(a.unit.id);void 0!==l&&Ve.size(a.indices)===s&&n(Pe.ofSingleton(l))&&(r=!0)}return r}const Ixe={"orientation-ellipsoid-mesh":(e,t)=>Uo("Orientation ellipsoid mesh",e,t,SSt)},Exe={...Axe,visuals:I.MultiSelect(["orientation-ellipsoid-mesh"],I.objectToOptions(Ixe)),bumpFrequency:I.Numeric(1,{min:0,max:10,step:.1},xt.ShadingCategory)},PSt={name:"orientation",label:"Orientation",description:"Displays orientation ellipsoids for polymer chains.",factory:function DSt(e,t){return Xn.createMulti("Orientation",e,t,gl,Ixe)},getParams:function TSt(e,t){return Exe},defaultValues:I.getDefaultValues(Exe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0},kSt=tt.add3,MSt=tt.add;var $Y;!function(e){e.create=function t(n=2048,r=1024,i){const o=tt.create(Float32Array,3,r,i?i.centerBuffer.ref.value:n),s=tt.create(Float32Array,1,r,i?i.groupBuffer.ref.value:n);return{add:(a,l,c,u)=>{kSt(o,a,l,c),MSt(s,u)},getPoints:()=>{const a=tt.compact(o,!0),l=tt.compact(s,!0);return G1.create(a,l,o.elementCount,i)}}}}($Y||($Y={}));const Txe=C.add,YY={...rgt,pointSizeAttenuation:I.Boolean(!1),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),traceOnly:I.Boolean(!1),stride:I.Numeric(1,{min:1,max:100,step:1})};function RSt(e,t,n,r,i,o){const{child:s}=n;if(s&&!s.unitMap.get(t.id))return G1.createEmpty(o);const a=t.elements,l=a.length,c=$Y.create(l,l/10,o),u=C(),d=t.conformation,f=g2(n,t,i),p=C();let m=0;if(f)for(let v=0;v<l;++v)f(a[v])||(d.invariantPosition(a[v],u),Txe(p,p,u),m+=1,c.add(u[0],u[1],u[2],v));else for(let v=0;v<l;++v)d.invariantPosition(a[v],u),Txe(p,p,u),m+=1,c.add(u[0],u[1],u[2],v);const h=o?ke.clone(o.boundingSphere):void 0,g=c.getPoints();if(0===m)return g;let y;return C.scale(p,p,1/m),y=h&&C.distance(p,h.center)/h.radius<.1?h:ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor),g.setBoundingSphere(y),g}function Dxe(e){return function igt(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:G1.Utils},t)}({defaultProps:I.getDefaultValues(YY),createGeometry:RSt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{t.createGeometry=n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.traceOnly!==r.traceOnly||n.stride!==r.stride}},e)}const NSt={"element-point":(e,t)=>Uo("Points",e,t,Dxe)},Pxe={...YY},BSt={name:"point",label:"Point",description:"Displays elements (atoms, coarse spheres) as points.",factory:function OSt(e,t){return Xn.createMulti("Point",e,t,gl,NSt)},getParams:function FSt(e,t){return Pxe},defaultValues:I.getDefaultValues(Pxe),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0},kxe={sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),linearSegments:I.Numeric(8,{min:1,max:48,step:1},xt.CustomQualityParamInfo),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo)},Ud=(I.getDefaultValues(kxe),C());function LSt(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return on.createEmpty(o);const{sizeFactor:a,detail:l,linearSegments:c,radialSegments:u}=i,d=c*u*s+(u+1)*s*2,f=Ct.createState(d,d/10,o),p=eY(c),{curvePoints:m,normalVectors:h,binormalVectors:g,widthValues:y,heightValues:v}=p;let x=0;const _=Z$(t,n,{ignoreSecondaryStructure:!0});for(;_.hasNext;){const M=_.move();f.currentGroup=x;const D=Fu(M.moleculeType)?FO:NO;tY(p,M,uve,D);const T=M.coarseBackboneFirst||M.first,F=M.coarseBackboneLast||M.last,R=r.size.size(M.centerPrev)*a,N=r.size.size(M.center)*a,j=r.size.size(M.centerNext)*a;sY(p,R,N,j,R,N,j,D);let W=c;if(M.initial){W=Math.max(Math.round(c*D),1);const z=c-W;m.copyWithin(0,3*z),g.copyWithin(0,3*z),h.copyWithin(0,3*z),y.copyWithin(0,3*z),v.copyWithin(0,3*z),C.fromArray(Ud,m,3),C.normalize(Ud,C.sub(Ud,M.p2,Ud)),C.scaleAndAdd(Ud,M.p2,Ud,N*OO),C.toArray(Ud,m,0)}else M.final&&(W=Math.max(Math.round(c*(1-D)),1),C.fromArray(Ud,m,3*W-3),C.normalize(Ud,C.sub(Ud,M.p2,Ud)),C.scaleAndAdd(Ud,M.p2,Ud,N*OO),C.toArray(Ud,m,3*W));!0===M.initial&&!0===M.final?Jr(f,M.p2,2*N,l):2===u?aB(f,m,h,g,W,y,v,0):4===u?oB(f,m,h,g,W,y,v,0,T,F):AY(f,m,h,g,W,u,y,v,T,F,"elliptical"),++x}const w=Ct.getMesh(f),A=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return w.setBoundingSphere(A),w}const Mxe={...ml,...kxe};function jSt(e){return mc({defaultProps:I.getDefaultValues(Mxe),createGeometry:LSt,createLocationIterator:t=>nb.fromGroup(t,{asSecondary:!0}),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail||n.linearSegments!==r.linearSegments||n.radialSegments!==r.radialSegments}},e)}const Rxe={"polymer-tube":(e,t)=>Uo("Polymer tube mesh",e,t,jSt),"polymer-gap":(e,t)=>Uo("Polymer gap cylinder",e,t,xY)},Nxe={...Mxe,...tB,sizeFactor:I.Numeric(.2,{min:0,max:10,step:.01}),visuals:I.MultiSelect(["polymer-tube","polymer-gap"],I.objectToOptions(Rxe)),bumpFrequency:I.Numeric(2,{min:0,max:10,step:.1},xt.ShadingCategory)},VSt={name:"putty",label:"Putty",description:"Displays a tube smoothly following the trace atoms of polymers.",factory:function zSt(e,t){return Xn.createMulti("Putty",e,t,gl,Rxe)},getParams:function USt(e,t){const n=I.clone(Nxe);let r=!1,i=!1;return t.units.forEach(o=>{!r&&ze.isAtomic(o)&&o.nucleotideElements.length&&(r=!0),!i&&o.gapElements.length&&(i=!0)}),n.visuals.defaultValue=["polymer-tube"],i&&n.visuals.defaultValue.push("polymer-gap"),n},defaultValues:I.getDefaultValues(Nxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uncertainty"},isApplicable:e=>e.polymerResidueCount>0},Fxe={"element-sphere":(e,t)=>Uo("Sphere mesh/impostor",e,t,L1e),"structure-element-sphere":(e,t)=>Ff("Structure sphere mesh/impostor",e,t,Zvt)},XY={...EO,bumpFrequency:I.Numeric(1,{min:0,max:10,step:.1},xt.ShadingCategory),visuals:I.MultiSelect(["element-sphere"],I.objectToOptions(Fxe))};let lB;const qSt={name:"spacefill",label:"Spacefill",description:"Displays atomic/coarse elements as spheres.",factory:function GSt(e,t){return Xn.createMulti("Spacefill",e,t,gl,Fxe)},getParams:function HSt(e,t){return t.isCoarseGrained?(lB||(lB=I.clone(XY),lB.sizeFactor.defaultValue=2),lB):XY},defaultValues:I.getDefaultValues(XY),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0},KY=Lr.is;function WSt(e,t,n,r,i,o){if(!ze.isAtomic(t))return Mo.createEmpty(o);const{child:s}=n,a=s?.unitMap.get(t.id);if(s&&!a)return Mo.createEmpty(o);const l=dt.create(n,t),c=t.elements,u=t.bonds,{edgeCount:d,a:f,b:p,edgeProps:m,offset:h}=u;if(!d)return Mo.createEmpty(o);const{order:g,flags:y}=m,{sizeFactor:v,aromaticBonds:x,includeTypes:_,excludeTypes:w,multipleBonds:A}=i,M="off"===A,E="symmetric"===A,F=wO(Lr.fromNames(_),Lr.fromNames(w),32),R=C(),N=t.conformation,{elementRingIndices:j,elementAromaticRingIndices:W}=t.rings,z=x?t.resonance.delocalizedTriplets:void 0,$={linkCount:2*d,referencePosition:H=>{let oe=f[H],te=p[H];const K=z?.getThirdElement(oe,te);if(void 0!==K)return N.invariantPosition(c[K],R);oe>te&&([oe,te]=[te,oe]),h[oe+1]-h[oe]==1&&([oe,te]=[te,oe]);const Q=W.get(oe)||j.get(oe);let G=0;for(let Z=h[oe],ee=h[oe+1];Z<ee;++Z){const se=p[Z];if(se!==te&&se!==oe){if(!Q)return N.invariantPosition(c[se],R);{const xe=W.get(se)||j.get(se);if(!xe)continue;const re=jR(Q,xe);re>G&&(G=re,N.invariantPosition(c[se],R))}}}return G>0?R:null},position:(H,oe,te)=>{N.invariantPosition(c[f[te]],H),N.invariantPosition(c[p[te]],oe)},style:H=>{const oe=g[H],te=y[H];if(KY(te,2)||KY(te,4))return 1;if(3===oe)return M?0:E?4:5;if(x){const Q=p[H],G=W.get(f[H]),Z=W.get(Q),ee=G&&Z?jR(G,Z):0;if(KY(te,16)||ee&&!F)return 2===ee?8:7}return 2!==oe||M?0:E?2:3},radius:H=>{l.element=c[f[H]];const oe=r.size.size(l);l.element=c[p[H]];const te=r.size.size(l);return Math.min(oe,te)*v},ignore:D1e(n,t,i)},{lines:V,boundingSphere:X}=Yye(0,$,i,o);if(X)V.setBoundingSphere(X);else if(V.lineCount>0){const H=ke.expand(ke(),(a??t).boundary.sphere,1*v);V.setBoundingSphere(H)}return V}const Oxe={...KF,...E$,includeParent:I.Boolean(!1)};function $St(e){return ZF({defaultProps:I.getDefaultValues(Oxe),createGeometry:WSt,createLocationIterator:t=>fv.fromGroup(t),getLoci:T$,eachLocation:D$,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.linkScale!==r.linkScale||n.linkSpacing!==r.linkSpacing||n.aromaticDashCount!==r.aromaticDashCount||n.dashCount!==r.dashCount||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||!Ru(n.includeTypes,r.includeTypes)||!Ru(n.excludeTypes,r.excludeTypes)||n.aromaticBonds!==r.aromaticBonds||n.multipleBonds!==r.multipleBonds;const l=s.group.units[0],c=a.group.units[0];ze.isAtomic(l)&&ze.isAtomic(c)&&(Cd.areEqual(l.bonds,c.bonds)||(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0))}},e)}const ZY=new fn.ElementBondIterator;function Bxe(e,t,n,r){for(ZY.setElement(t,n,r);ZY.hasNext;){const i=ZY.move();return i.otherUnit.conformation.position(i.otherUnit.elements[i.otherIndex],e),e}return null}function YSt(e,t,n,r,i){const o=t.interUnitBonds,{edgeCount:s,edges:a}=o;if(!s)return Mo.createEmpty(i);const{sizeFactor:l,aromaticBonds:c,multipleBonds:u}=r,d="off"===u,f="symmetric"===u,p=C(),m=dt.create(),h={linkCount:s,referencePosition:v=>{const x=a[v];let _,w,A,M;if(x.unitA<x.unitB)_=t.unitMap.get(x.unitA),w=t.unitMap.get(x.unitB),A=x.indexA,M=x.indexB;else{if(!(x.unitA>x.unitB))throw new Error("same units in createInterUnitBondLines");_=t.unitMap.get(x.unitB),w=t.unitMap.get(x.unitA),A=x.indexB,M=x.indexA}return Bxe(p,t,_,A)||Bxe(p,t,w,M)},position:(v,x,_)=>{const w=a[_],A=t.unitMap.get(w.unitA),M=t.unitMap.get(w.unitB);A.conformation.position(A.elements[w.indexA],v),M.conformation.position(M.elements[w.indexB],x)},style:v=>{const x=a[v].props.order,_=Mc.create(a[v].props.flag);return Lr.is(_,2)||Lr.is(_,4)?1:3===x?d?0:f?4:5:c&&Lr.is(_,16)?7:2!==x||d?0:f?2:3},radius:v=>{const x=a[v];m.structure=t,m.unit=t.unitMap.get(x.unitA),m.element=m.unit.elements[x.indexA];const _=n.size.size(m);m.unit=t.unitMap.get(x.unitB),m.element=m.unit.elements[x.indexB];const w=n.size.size(m);return Math.min(_,w)*l},ignore:P1e(t,r)},{lines:g,boundingSphere:y}=Yye(0,h,r,i);if(y)g.setBoundingSphere(y);else if(g.lineCount>0){const{child:v}=t,x=ke.expand(ke(),(v??t).boundary.sphere,1*l);g.setBoundingSphere(x)}return g}const Lxe={...Ymt,...E$,includeParent:I.Boolean(!1)};function XSt(e){return function Xmt(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.updateSize=!0)},geometryUtils:Mo.Utils},t)}({defaultProps:I.getDefaultValues(Lxe),createGeometry:YSt,createLocationIterator:t=>fv.fromStructure(t),getLoci:P$,eachLocation:M$,setUpdateState:(t,n,r,i,o,s,a)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.linkScale!==r.linkScale||n.linkSpacing!==r.linkSpacing||n.aromaticDashCount!==r.aromaticDashCount||n.dashCount!==r.dashCount||n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||!Ru(n.includeTypes,r.includeTypes)||!Ru(n.excludeTypes,r.excludeTypes)||n.multipleBonds!==r.multipleBonds,s.interUnitBonds!==a.interUnitBonds&&(t.createGeometry=!0,t.updateTransform=!0,t.updateColor=!0,t.updateSize=!0)}},e)}const yI=C.scaleAndAdd,jxe=C.unitX,Uxe=C.unitY,zxe=C.unitZ,Vxe={...KF,lineSizeAttenuation:I.Boolean(!1),ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),traceOnly:I.Boolean(!1),crosses:I.Select("lone",I.arrayToOptions(["lone","all"])),crossSize:I.Numeric(.35,{min:0,max:2,step:.01})};function KSt(e,t,n,r,i,o){const{child:s}=n;if(s&&!s.unitMap.get(t.id))return Mo.createEmpty(o);const a=t.elements,l=a.length,c=Pd.create(l,l/10,o),u=C(),d=C(),f=C(),p=t.conformation,m=g2(n,t,i),h=i.crossSize/2,g="lone"===i.crosses;for(let x=0;x<l;++x)m&&m(a[x])||g&&ze.isAtomic(t)&&0!==kg(n,t,x)||(p.invariantPosition(a[x],u),yI(d,u,jxe,h),yI(f,u,jxe,-h),c.add(d[0],d[1],d[2],f[0],f[1],f[2],x),yI(d,u,Uxe,h),yI(f,u,Uxe,-h),c.add(d[0],d[1],d[2],f[0],f[1],f[2],x),yI(d,u,zxe,h),yI(f,u,zxe,-h),c.add(d[0],d[1],d[2],f[0],f[1],f[2],x));const y=c.getLines(),v=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return y.setBoundingSphere(v),y}function ZSt(e){return ZF({defaultProps:I.getDefaultValues(Vxe),createGeometry:KSt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{t.createGeometry=n.ignoreHydrogens!==r.ignoreHydrogens||n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant||n.traceOnly!==r.traceOnly||n.crosses!==r.crosses||n.crossSize!==r.crossSize}},e)}const Hxe={"intra-bond":(e,t)=>Uo("Intra-unit bond line",e,t,$St),"inter-bond":(e,t)=>Ff("Inter-unit bond line",e,t,XSt),"element-point":(e,t)=>Uo("Points",e,t,Dxe),"element-cross":(e,t)=>Uo("Crosses",e,t,ZSt)},QY={...Oxe,...Lxe,...YY,...Vxe,pointStyle:I.Select("circle",I.objectToOptions(G1.StyleTypes)),multipleBonds:I.Select("offset",I.arrayToOptions(["off","symmetric","offset"])),includeParent:I.Boolean(!1),sizeFactor:I.Numeric(2,{min:.01,max:10,step:.01}),unitKinds:MP(["atomic"]),visuals:I.MultiSelect(["intra-bond","inter-bond","element-point","element-cross"],I.objectToOptions(Hxe))},eCt={name:"line",label:"Line",description:"Displays bonds as lines and atoms as points or croses.",factory:function JSt(e,t){return Xn.createMulti("Line",e,t,gl,Hxe)},getParams:function QSt(e,t){if(Xe.getSize(t)>=Xe.Size.Huge){const r=I.clone(QY);return r.visuals.defaultValue=["intra-bond","element-point","element-cross"],r}return QY},defaultValues:I.getDefaultValues(QY),defaultColorTheme:{name:"element-symbol"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.elementCount>0,getData:(e,t)=>t.includeParent?e.asParent():e,mustRecreate:(e,t)=>e.includeParent!==t.includeParent};function tCt(e,t,n,r,i){return JY.apply(this,arguments)}function JY(){return JY=le(function*(e,t,n,r,i){const{runtime:o,webgl:s}=e;if(!s||!s.extensions.blendMinMax)throw new Error("GaussianDensityVolume requires `webgl` and `blendMinMax` extension");const a=i?i.gridTexture.ref.value:void 0,l=yield function O2t(e,t,n,r,i){const{position:o,boundary:s,radius:a}=XF(e,t,n),l=sv(s.box,n);return Ke.create("Gaussian Density",function(){var c=le(function*(u){return Qve(r,o,s.box,a,l,i)});return function(u){return c.apply(this,arguments)}}())}(t,n.size,r,s,a).runInContext(o),{transform:c,texture:u,bbox:d,gridDim:f}=l,m=fe.mul(fe(),c,fe.fromScaling(fe(),f)),h=fe.getScaling(C(),c),g=C.create(0,1,2),y=Df.create(d,f,c,m,h,u,{min:0,max:1,mean:.04,sigma:.01},!0,g,i),v=ke.expand(ke(),t.boundary.sphere,l.maxRadius);return y.setBoundingSphere(v),y}),JY.apply(this,arguments)}const Gxe={...Qmt,...ZP,ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),includeParent:I.Boolean(!1,{isHidden:!0})};function nCt(e){return function Jmt(e,t){return e2({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.createGeometry=!0)},geometryUtils:Df.Utils},t)}({defaultProps:I.getDefaultValues(Gxe),createGeometry:tCt,createLocationIterator:vl.fromStructure,getLoci:b2,eachLocation:y2,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}function rCt(e,t,n,r,i,o){return eX.apply(this,arguments)}function eX(){return eX=le(function*(e,t,n,r,i,o){const{runtime:s,webgl:a}=e;if(!a)throw new Error("GaussianDensityVolume requires `webgl`");const l=o?o.gridTexture.ref.value:void 0,c=yield function R2t(e,t,n,r,i,o){const{position:s,boundary:a,radius:l}=YF(e,t,n,r),c=sv(a.box,r,cxe(i,e));return Ke.create("Gaussian Density",function(){var u=le(function*(d){return Qve(i,s,a.box,l,c,o)});return function(d){return u.apply(this,arguments)}}())}(n,t,r.size,i,a,l).runInContext(s),{transform:u,texture:d,bbox:f,gridDim:p}=c,h=fe.mul(fe(),u,fe.fromScaling(fe(),p)),g=fe.getScaling(C(),u),y=C.create(0,1,2),v=Df.create(f,p,u,h,g,d,{min:0,max:1,mean:.04,sigma:.01},!0,y,o),x=ke.expand(ke(),t.boundary.sphere,c.maxRadius);return v.setBoundingSphere(x),v}),eX.apply(this,arguments)}const iCt={...ogt,...ZP,ignoreHydrogens:I.Boolean(!1),ignoreHydrogensVariant:I.Select("all",I.arrayToOptions(["all","non-polar"])),includeParent:I.Boolean(!1,{isHidden:!0})};function oCt(e){return function sgt(e,t){return av({...e,setUpdateState:(n,r,i,o,s,a,l)=>{e.setUpdateState(n,r,i,o,s,a,l),Ya.areEqual(o.size,s.size)||(n.createGeometry=!0)},geometryUtils:Df.Utils},t)}({defaultProps:I.getDefaultValues(iCt),createGeometry:rCt,createLocationIterator:vl.fromGroup,getLoci:dm,eachLocation:um,setUpdateState:(t,n,r)=>{n.resolution!==r.resolution&&(t.createGeometry=!0),n.radiusOffset!==r.radiusOffset&&(t.createGeometry=!0),n.smoothness!==r.smoothness&&(t.createGeometry=!0),n.ignoreHydrogens!==r.ignoreHydrogens&&(t.createGeometry=!0),n.ignoreHydrogensVariant!==r.ignoreHydrogensVariant&&(t.createGeometry=!0),n.traceOnly!==r.traceOnly&&(t.createGeometry=!0),n.includeParent!==r.includeParent&&(t.createGeometry=!0)},dispose:t=>{t.gridTexture.ref.value.destroy()}},e)}const qxe={"gaussian-volume":(e,t)=>Ff("Gaussian volume",e,t,nCt),"units-gaussian-volume":(e,t)=>Uo("Units-Gaussian volume",e,t,oCt)},Wxe={...Gxe,jumpLength:I.Numeric(4,{min:0,max:20,step:.1}),visuals:I.MultiSelect(["gaussian-volume"],I.objectToOptions(qxe))},lCt={name:"gaussian-volume",label:"Gaussian Volume",description:"Displays a gaussian molecular density using direct volume rendering.",factory:function aCt(e,t){return Xn.createMulti("Gaussian Volume",e,t,gl,qxe)},getParams:function sCt(e,t){return Wxe},defaultValues:I.getDefaultValues(Wxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"physical"},isApplicable:e=>e.elementCount>0},cCt=C.scale,uCt=C.add,dCt=C.sub,tX={...ml,..._W,sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),radialSegments:I.Numeric(16,{min:2,max:56,step:2},xt.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)};function fCt(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth?function hCt(e){return SW({defaultProps:I.getDefaultValues(tX),createGeometry:pCt,createLocationIterator:t=>nb.fromGroup(t),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r)=>{},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function gCt(e){return mc({defaultProps:I.getDefaultValues(tX),createGeometry:mCt,createLocationIterator:t=>nb.fromGroup(t),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.radialSegments!==r.radialSegments},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}function pCt(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return Wu.createEmpty(o);const a=2*s,l=NP.create(a,a/4,o),c=t.conformation,u=C(),d=C(),f=C();eve(t,function(g,y,v,x,_){c.invariantPosition(g,u),c.invariantPosition(y,d);const A=Fu(_)?FO:NO;uCt(f,u,cCt(f,dCt(f,d,u),A)),l.add(u[0],u[1],u[2],f[0],f[1],f[2],1,!1,!1,2,v),l.add(f[0],f[1],f[2],d[0],d[1],d[2],1,!1,!1,2,x)});const m=l.getCylinders(),h=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return m.setBoundingSphere(h),m}function mCt(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return on.createEmpty(o);const{radialSegments:a,sizeFactor:l}=i,c=2*a*s*2,u=Ct.createState(c,c/10,o),d=t.conformation,f=C(),p=C(),m={radiusTop:1,radiusBottom:1,radialSegments:a},h=dt.create(n,t),g=dt.create(n,t);eve(t,function(_,w,A,M,E){h.element=_,g.element=w,d.invariantPosition(h.element,f),d.invariantPosition(g.element,p);const T=Fu(E)?FO:NO;m.radiusTop=m.radiusBottom=r.size.size(h)*l,u.currentGroup=A,Ur(u,f,p,T,m),m.radiusTop=m.radiusBottom=r.size.size(g)*l,u.currentGroup=M,Ur(u,p,f,1-T,m)});const v=Ct.getMesh(u),x=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return v.setBoundingSphere(x),v}const nX={...ml,...vW,sizeFactor:I.Numeric(.3,{min:0,max:10,step:.01}),detail:I.Numeric(0,{min:0,max:3,step:1},xt.CustomQualityParamInfo),tryUseImpostor:I.Boolean(!0)};function yCt(e,t,n,r){return n.tryUseImpostor&&r&&r.extensions.fragDepth&&r.extensions.textureFloat?function vCt(e){return xW({defaultProps:I.getDefaultValues(nX),createGeometry:bCt,createLocationIterator:t=>nb.fromGroup(t),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r)=>{},mustRecreate:(t,n,r)=>!n.tryUseImpostor||!r},e)}(e):function _Ct(e){return mc({defaultProps:I.getDefaultValues(nX),createGeometry:xCt,createLocationIterator:t=>nb.fromGroup(t),getLoci:x2,eachLocation:_2,setUpdateState:(t,n,r)=>{t.createGeometry=n.sizeFactor!==r.sizeFactor||n.detail!==r.detail},mustRecreate:(t,n,r)=>n.tryUseImpostor&&!!r},e)}(e)}function bCt(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return Rp.createEmpty(o);const a=HA.create(s,s/2,o),l=t.conformation,c=C();tve(t,(p,m)=>{l.invariantPosition(p,c),a.add(c[0],c[1],c[2],m)});const d=a.getSpheres(),f=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return d.setBoundingSphere(f),d}function xCt(e,t,n,r,i,o){const s=t.polymerElements.length;if(!s)return on.createEmpty(o);const{detail:a,sizeFactor:l}=i,c=s*qw(a),u=Ct.createState(c,c/2,o),d=t.conformation,f=C(),p=dt.create(n,t);tve(t,(y,v)=>{p.element=y,d.invariantPosition(p.element,f),u.currentGroup=v,Jr(u,f,r.size.size(p)*l,a)});const h=Ct.getMesh(u),g=ke.expand(ke(),t.boundary.sphere,1*i.sizeFactor);return h.setBoundingSphere(g),h}const $xe={"polymer-backbone-cylinder":(e,t)=>Uo("Polymer backbone cylinder",e,t,fCt),"polymer-backbone-sphere":(e,t)=>Uo("Polymer backbone sphere",e,t,yCt),"polymer-gap":(e,t)=>Uo("Polymer gap cylinder",e,t,xY)},Yxe={...nX,...tX,...tB,sizeAspectRatio:I.Numeric(1,{min:.1,max:3,step:.1}),visuals:I.MultiSelect(["polymer-backbone-cylinder","polymer-backbone-sphere","polymer-gap"],I.objectToOptions($xe)),bumpFrequency:I.Numeric(0,{min:0,max:10,step:.1},xt.ShadingCategory),colorMode:I.Select("default",I.arrayToOptions(["default","interpolate"]),{...xt.ShadingCategory,isHidden:!0})},wCt={name:"backbone",label:"Backbone",description:"Displays polymer backbone with cylinders and spheres.",factory:function CCt(e,t){return Xn.createMulti("Backbone",e,t,gl,$xe)},getParams:function SCt(e,t){const n=I.clone(Yxe);let r=!1;return t.units.forEach(i=>{!r&&i.gapElements.length&&(r=!0)}),n.visuals.defaultValue=["polymer-backbone-cylinder","polymer-backbone-sphere"],r&&n.visuals.defaultValue.push("polymer-gap"),n},defaultValues:I.getDefaultValues(Yxe),defaultColorTheme:{name:"chain-id"},defaultSizeTheme:{name:"uniform"},isApplicable:e=>e.polymerResidueCount>0};class JP extends ume{constructor(){super(),Nu(JP.BuiltIn,(t,n)=>{if(t.name!==n)throw new Error(`Fix BuiltInStructureRepresentations to have matching names. ${t.name} ${n}`);this.add(t)})}}!function(e){e.BuiltIn={cartoon:v2t,backbone:wCt,"ball-and-stick":nxt,carbohydrate:Uxt,ellipsoid:w2t,"gaussian-surface":Q2t,"gaussian-volume":lCt,label:sSt,line:eCt,"molecular-surface":_St,orientation:PSt,point:BSt,putty:VSt,spacefill:qSt}}(JP||(JP={}));class ACt{get isAnimating(){return this._isAnimating}tick(t,n){var r=this;return le(function*(){var i,o;if(yield r.plugin.managers.animation.tick(t,n?.isSynchronous,n?.animation),null===(i=r.plugin.canvas3d)||void 0===i||i.tick(t,n),It){const s=null===(o=r.plugin.canvas3d)||void 0===o?void 0:o.webgl.timer.resolve();if(s)for(const a of s)ode([a])}})()}resetTime(t=Bo()){var n;null===(n=this.plugin.canvas3d)||void 0===n||n.resetTime(t)}start(t){var n;null===(n=this.plugin.canvas3d)||void 0===n||n.resume(),this._isAnimating=!0,this.resetTime(),t?.immediate?this.frame():this.currentFrame=requestAnimationFrame(this.frame)}stop(t){var n;this._isAnimating=!1,void 0!==this.currentFrame&&(cancelAnimationFrame(this.currentFrame),this.currentFrame=void 0),t?.noDraw&&(null===(n=this.plugin.canvas3d)||void 0===n||n.pause(t?.noDraw))}constructor(t){this.plugin=t,this.currentFrame=void 0,this._isAnimating=!1,this.frame=()=>{this.tick(Bo()),this._isAnimating&&(this.currentFrame=requestAnimationFrame(this.frame))}}}class M2 extends wP{get animation(){return this.plugin.managers.animation}getSnapshot(t){var n,r,i;const o={...this.snapshotParams.value,...t};return{id:oo.create22(),data:o.data?this.data.getSnapshot():void 0,behaviour:o.behavior?this.behaviors.getSnapshot():void 0,animation:o.animation?this.animation.getSnapshot():void 0,startAnimation:o.startAnimation?!!o.startAnimation:void 0,camera:o.camera?{current:this.plugin.canvas3d.camera.getSnapshot(),transitionStyle:o.cameraTransition.name,transitionDurationInMs:"animate"===(null===(n=o?.cameraTransition)||void 0===n?void 0:n.name)?o.cameraTransition.params.durationInMs:void 0}:void 0,canvas3dContext:o.canvas3dContext?{props:null===(r=this.plugin.canvas3dContext)||void 0===r?void 0:r.props}:void 0,canvas3d:o.canvas3d?{props:null===(i=this.plugin.canvas3d)||void 0===i?void 0:i.props}:void 0,interactivity:o.interactivity?{props:this.plugin.managers.interactivity.props}:void 0,structureFocus:this.plugin.managers.structure.focus.getSnapshot(),structureSelection:o.structureSelection?this.plugin.managers.structure.selection.getSnapshot():void 0,structureComponentManager:o.componentManager?{options:this.plugin.managers.structure.component.state.options}:void 0,durationInMs:o?.durationInMs}}setSnapshot(t){var n=this;return le(function*(){var r,i,o,s,a;if(yield n.animation.stop(),!(null===(r=t.structureComponentManager)||void 0===r)&&r.options&&n.plugin.managers.structure.component._setSnapshotState(null===(i=t.structureComponentManager)||void 0===i?void 0:i.options),t.behaviour&&(yield n.plugin.runTask(n.behaviors.setSnapshot(t.behaviour))),t.data&&(yield n.plugin.runTask(n.data.setSnapshot(t.data))),null!==(o=t.canvas3d)&&void 0!==o&&o.props){const l=I.normalizeParams(Fd,t.canvas3d.props,"children");yield jt.Canvas3D.SetSettings(n.plugin,{settings:l})}if(null!==(s=t.canvas3dContext)&&void 0!==s&&s.props){const l=I.normalizeParams(K_.Params,t.canvas3dContext.props,"children");null===(a=n.plugin.canvas3dContext)||void 0===a||a.setProps(l)}t.interactivity&&t.interactivity.props&&n.plugin.managers.interactivity.setProps(t.interactivity.props),t.structureFocus&&n.plugin.managers.structure.focus.setSnapshot(t.structureFocus),t.structureSelection&&n.plugin.managers.structure.selection.setSnapshot(t.structureSelection),t.animation&&n.animation.setSnapshot(t.animation),t.camera&&jt.Camera.Reset(n.plugin,{snapshot:t.camera.current,durationMs:"animate"===t.camera.transitionStyle?t.camera.transitionDurationInMs:void 0}),t.startAnimation&&n.animation.start()})()}updateTransform(t,n,r,i){const o=t.build().to(n).update(r);return jt.State.Update(this.plugin,{state:t,tree:o,options:{canUndo:i}})}hasBehavior(t){return this.behaviors.tree.transforms.has(t.id)}updateBehavior(t,n){const r=this.behaviors.build();if(this.behaviors.tree.transforms.has(t.id))r.to(t.id).update(n);else{const i=t.createDefaultParams(void 0,this.plugin);r.to(ii.getCategoryId(t)).apply(t,fy(i,n),{ref:t.id})}return this.plugin.runTask(this.behaviors.updateTree(r))}dispose(){this.behaviors.cells.forEach(t=>{var n,r,i,o;ii.Behavior.is(t.obj)&&(null===(r=(n=t.obj.data).unregister)||void 0===r||r.call(n),null===(o=(i=t.obj.data).dispose)||void 0===o||o.call(i))}),super.dispose(),this.data.dispose(),this.behaviors.dispose(),this.animation.dispose()}constructor(t){super(),this.plugin=t,this.data=L1.create(new Se.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,historyCapacity:this.plugin.config.get(ei.State.HistoryCapacity)}),this.behaviors=L1.create(new ii.Root({}),{runTask:this.plugin.runTask,globalContext:this.plugin,rootState:{isLocked:!0}}),this.events={cell:{stateUpdated:Jy(this.data.events.cell.stateUpdated,this.behaviors.events.cell.stateUpdated),created:Jy(this.data.events.cell.created,this.behaviors.events.cell.created),removed:Jy(this.data.events.cell.removed,this.behaviors.events.cell.removed)},object:{created:Jy(this.data.events.object.created,this.behaviors.events.object.created),removed:Jy(this.data.events.object.removed,this.behaviors.events.object.removed),updated:Jy(this.data.events.object.updated,this.behaviors.events.object.updated)}},this.snapshotParams=this.ev.behavior(M2.DefaultSnapshotParams),this.setSnapshotParams=n=>{this.snapshotParams.next({...M2.DefaultSnapshotParams,...n})}}}!function(e){e.SnapshotParams={durationInMs:I.Numeric(1500,{min:100,max:15e3,step:100},{label:"Duration in ms"}),data:I.Boolean(!0),behavior:I.Boolean(!1),structureSelection:I.Boolean(!1),componentManager:I.Boolean(!0),animation:I.Boolean(!0),startAnimation:I.Boolean(!1),canvas3d:I.Boolean(!0),canvas3dContext:I.Boolean(!0),interactivity:I.Boolean(!0),camera:I.Boolean(!0),cameraTransition:I.MappedStatic("animate",{animate:I.Group({durationInMs:I.Numeric(250,{min:100,max:5e3,step:500},{label:"Duration in ms"})}),instant:I.Group({})},{options:[["animate","Animate"],["instant","Instant"]]}),image:I.Boolean(!1)},e.DefaultSnapshotParams=I.getDefaultValues(e.SnapshotParams)}(M2||(M2={}));class ICt{getDecorator(t){const n=this.plugin.state.data.tree,r=n.children.get(t);if(1!==r.size)return t;const i=r.first();return n.transforms.get(i).transformer.definition.isDecorator?this.getDecorator(i):t}get(t,n=!1){const r=this.root.get(t);if(r)return this.plugin.state.data.cells.get(n?r.ref:this.getDecorator(r.ref))}addMapping(t,n,r){if(!Se.Molecule.Structure.is(r))return!1;if(this.tracked.set(n,r.data),this.root.has(r.data))this.root.get(r.data).count++;else{const i=t.select(Qn.Generators.byRef(n).rootOfType([Se.Molecule.Structure]))[0];this.root.set(r.data,i?{ref:i.transform.ref,count:1}:{ref:n,count:1})}return!0}removeMapping(t){if(!this.tracked.has(t))return!1;const n=this.tracked.get(t);this.tracked.delete(t);const r=this.root.get(n);return r.count>1?r.count--:this.root.delete(n),!0}updateMapping(t,n,r,i){return!!Se.Molecule.Structure.is(i)&&(this.removeMapping(n),this.addMapping(t,n,i),!0)}dispose(){this.ev.dispose()}constructor(t){this.plugin=t,this.ev=uy.create(),this.events={updated:this.ev(),removed:this.ev()},this.root=new Map,this.tracked=new Map,t.state.data.events.object.created.subscribe(n=>{this.addMapping(n.state,n.ref,n.obj)}),t.state.data.events.object.removed.subscribe(n=>{this.removeMapping(n.ref)&&this.events.removed.next({ref:n.ref,obj:n.obj})}),t.state.data.events.object.updated.subscribe(n=>{this.updateMapping(n.state,n.ref,n.oldObj,n.obj)&&this.events.updated.next({ref:n.ref,oldObj:n.oldObj,obj:n.obj})})}}class rX{constructor(){this.ev=uy.create(),this.id=0,this.runningTasks=new Set,this.abortRequests=new Map,this.options=new Map,this.currentContext=[],this.events={progress:this.ev(),finished:this.ev()}}tryGetAbortTaskId(t){if(this.abortRequests.has(t.progress.taskId))return t.progress.taskId;for(const n of t.children){const r=this.tryGetAbortTaskId(n);if(void 0!==r)return r}}track(t,n){return r=>{var i;if(r.canAbort&&r.requestAbort){const s=this.tryGetAbortTaskId(r.root);void 0!==s&&r.requestAbort(this.abortRequests.get(s))}const o=Bo()-r.root.progress.startedTime;this.events.progress.next({id:t,useOverlay:null===(i=this.options.get(n))||void 0===i?void 0:i.useOverlay,level:o<250?"none":"background",progress:r})}}run(t,n){var r=this;return le(function*(){const i=r.id++;let o;n?.createNewContext||0===r.currentContext.length?o={ctx:iOe(t,r.track(i,t.id),100),refCount:1}:(o=r.currentContext[r.currentContext.length-1],o.refCount++);try{return r.options.set(t.id,{useOverlay:!!n?.useOverlay}),r.runningTasks.add(t.id),yield poe(o.ctx,t)}finally{r.options.delete(t.id),r.runningTasks.delete(t.id),r.events.finished.next({id:i}),r.abortRequests.delete(t.id),o.refCount--,0===o.refCount&&p3(r.currentContext,o)}})()}requestAbortAll(t){this.runningTasks.forEach(n=>this.abortRequests.set(n,t))}requestAbort(t,n){this.abortRequests.set("number"==typeof t?t:t.root.progress.taskId,n)}dispose(){this.ev.dispose()}}!function(e){function t(r){return new Promise(i=>setTimeout(i,r))}e.testTask=function n(r){return Ke.create("Test",function(){var i=le(function*(o){let s=0;for(;s<r;)yield t(100+200*Math.random()),o.shouldUpdate&&(yield o.update({message:"Step "+s,current:s,max:r,isIndeterminate:!1})),s++});return function(o){return i.apply(this,arguments)}}())}}(rX||(rX={}));class ECt extends zy{findByKey(t){return this.state.entries.find(n=>!!n&&n.key===t)}show(t){let r,n=this.state.entries;const i=++this.serialId;let o;t.key&&(r=this.findByKey(t.key))?(void 0!==r.timeout&&clearTimeout(r.timeout),o=r.serialNumber,n=n.remove(r.id)):o=++this.serialNumber,r={id:i,serialNumber:o,key:t.key,title:t.title,message:t.message,timeout:this.timeout(i,t.timeoutMs),hide:()=>this.hideId(i)},this.updateState({entries:n.set(i,r)})&&this.events.changed.next(void 0)}timeout(t,n){if(void 0!==n)return n<0&&(n=500),setTimeout(()=>{const r=this.state.entries.get(t);r.timeout=void 0,this.hide(r)},n)}hideId(t){this.hide(this.state.entries.get(t))}hide(t){t&&(void 0!==t.timeout&&clearTimeout(t.timeout),t.hide=void 0,this.updateState({entries:this.state.entries.delete(t.id)})&&this.events.changed.next(void 0))}constructor(t){super({entries:Nc()}),this.events={changed:this.ev()},this.serialNumber=0,this.serialId=0,jt.Toast.Show.subscribe(t,n=>this.show(n)),jt.Toast.Hide.subscribe(t,n=>this.hide(this.findByKey(n.key)))}}class TCt extends wP{createParams(){const t=Math.min(this.plugin.canvas3d?this.plugin.canvas3d.webgl.maxRenderbufferSize:4096,4096);return{resolution:I.MappedStatic("viewport",{viewport:I.Group({}),hd:I.Group({}),"full-hd":I.Group({}),"ultra-hd":I.Group({}),custom:I.Group({width:I.Numeric(1920,{min:128,max:t,step:1}),height:I.Numeric(1080,{min:128,max:t,step:1})},{isFlat:!0})},{options:[["viewport","Viewport"],["hd","HD (1280 x 720)"],["full-hd","Full HD (1920 x 1080)"],["ultra-hd","Ultra HD (3840 x 2160)"],["custom","Custom"]]}),transparent:I.Boolean(!1),axes:kF.axes}}get params(){return this._params?this._params:this._params=this.createParams()}get values(){return this.behaviors.values.value}get cropParams(){return this.behaviors.cropParams.value}get relativeCrop(){return this.behaviors.relativeCrop.value}getCanvasSize(){var t,n;return{width:(null===(t=this.plugin.canvas3d)||void 0===t?void 0:t.webgl.gl.drawingBufferWidth)||0,height:(null===(n=this.plugin.canvas3d)||void 0===n?void 0:n.webgl.gl.drawingBufferHeight)||0}}getSize(){const t=this.values;switch(t.resolution.name){case"viewport":return this.getCanvasSize();case"hd":return{width:1280,height:720};case"full-hd":return{width:1920,height:1080};case"ultra-hd":return{width:3840,height:2160};default:return{width:t.resolution.params.width,height:t.resolution.params.height}}}createPass(t){const n=this.plugin.canvas3d,{colorBufferFloat:r,textureFloat:i}=n.webgl.extensions,o=n.props.postprocessing.occlusion;return n.getImagePass({transparentBackground:this.values.transparent,cameraHelper:{axes:this.values.axes},multiSample:{...n.props.multiSample,mode:t?"on":"off",sampleLevel:r&&i?4:2},postprocessing:{...n.props.postprocessing,occlusion:"on"===o.name?{name:"on",params:{...o.params,samples:128,resolutionScale:n.webgl.pixelRatio}}:o},marking:{...n.props.marking}})}get previewPass(){return this._previewPass||(this._previewPass=this.createPass(!1))}get imagePass(){if(this._imagePass){const t=this.plugin.canvas3d,n=t.props.postprocessing.occlusion;return this._imagePass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:{...t.props.postprocessing,occlusion:"on"===n.name?{name:"on",params:{...n.params,samples:128,resolutionScale:t.webgl.pixelRatio}}:n},marking:{...t.props.marking}}),this._imagePass}return this._imagePass=this.createPass(!0)}getFilename(t=".png"){const n=this.plugin.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Model)).map(o=>o.obj.data),r=new Set;return n.forEach(o=>r.add(o.entryId.toUpperCase())),`${Lo.toArray(r).join("-")||"molstar-image"}${t}`}resetCrop(){this.behaviors.relativeCrop.next({x:0,y:0,width:1,height:1})}toggleAutocrop(){this.cropParams.auto?(this.behaviors.cropParams.next({...this.cropParams,auto:!1}),this.resetCrop()):this.behaviors.cropParams.next({...this.cropParams,auto:!0})}get isFullFrame(){const t=this.relativeCrop;return Do(t.x,0,1e-5)&&Do(t.y,0,1e-5)&&Do(t.width,1,1e-5)&&Do(t.height,1,1e-5)}autocrop(t=this.cropParams.relativePadding){const{data:n,width:r,height:i}=this.previewData.image,o=this.previewData.transparent,s=o?this.previewData.background:4278190080|this.previewData.background;let a=r,l=0,c=i,u=0;for(let m=0;m<i;m++){const h=m*r;for(let g=0;g<r;g++){const y=4*(h+g);if(o){if(0===n[y+3])continue}else if((n[y]<<16|n[y+1]<<8|n[y+2]|n[y+3]<<24)===s)continue;g<a&&(a=g),g>l&&(l=g),m<c&&(c=m),m>u&&(u=m)}}if(a>l){const m=a;a=l,l=m}if(c>u){const m=c;c=u,u=m}const d=l-a+1,f=u-c+1;a-=t*d,l+=t*d,c-=t*f,u+=t*f;const p={x:Math.max(0,a/r),y:Math.max(0,c/i),width:Math.min(1,(l-a+1)/r),height:Math.min(1,(u-c+1)/i)};this.behaviors.relativeCrop.next(p)}getPreview(t=320){const{width:n,height:r}=this.getSize();if(n<=0||r<=0)return;const i=n/r;let o=0,s=0;i>1?(o=t,s=Math.round(t/i)):(s=t,o=Math.round(t*i));const a=this.plugin.canvas3d.props;this.previewPass.setProps({cameraHelper:{axes:this.values.axes},transparentBackground:this.values.transparent,postprocessing:a.postprocessing,marking:a.marking});const l=this.previewPass.getImageData(o,s),c=this.previewCanvas;c.width=l.width,c.height=l.height,this.previewData.image=l,this.previewData.background=a.renderer.backgroundColor,this.previewData.transparent=this.values.transparent;const u=c.getContext("2d");if(!u)throw new Error("Could not create canvas 2d context");return u.putImageData(l,0,0),this.cropParams.auto&&this.autocrop(),this.events.previewed.next(void 0),{canvas:c,width:o,height:s}}getSizeAndViewport(){const{width:t,height:n}=this.getSize(),r=this.relativeCrop,i={x:Math.floor(r.x*t),y:Math.floor(r.y*n),width:Math.ceil(r.width*t),height:Math.ceil(r.height*n)};return i.width+i.x>t&&(i.width=t-i.x),i.height+i.y>n&&(i.height=n-i.y),{width:t,height:n,viewport:i}}draw(t){var n=this;return le(function*(){const{width:r,height:i,viewport:o}=n.getSizeAndViewport();if(r<=0||i<=0)return;yield t.update("Rendering image...");const s=n.imagePass;yield s.updateBackground();const a=s.getImageData(r,i,o);yield t.update("Encoding image...");const l=n.canvas;l.width=a.width,l.height=a.height;const c=l.getContext("2d");if(!c)throw new Error("Could not create canvas 2d context");c.putImageData(a,0,0)})()}copyToClipboardTask(){var t=this;const n=navigator.clipboard;if(n?.write)return Ke.create("Copy Image",function(){var r=le(function*(i){yield t.draw(i),yield i.update("Converting image...");const o=yield yq(t.canvas,"png"),s=new ClipboardItem({"image/png":o});yield n.write([s]),t.plugin.log.message("Image copied to clipboard.")});return function(i){return r.apply(this,arguments)}}());this.plugin.log.error("clipboard.write not supported!")}getImageDataUri(){var t=this;return this.plugin.runTask(Ke.create("Generate Image",function(){var n=le(function*(r){return yield t.draw(r),yield r.update("Converting image..."),t.canvas.toDataURL("png")});return function(r){return n.apply(this,arguments)}}()))}copyToClipboard(){const t=this.copyToClipboardTask();if(t)return this.plugin.runTask(t)}downloadTask(t){var n=this;return Ke.create("Download Image",function(){var r=le(function*(i){yield n.draw(i),yield i.update("Downloading image..."),Mge(yield yq(n.canvas,"png"),t??n.getFilename())});return function(i){return r.apply(this,arguments)}}())}download(t){this.plugin.runTask(this.downloadTask(t))}constructor(t){super(),this.plugin=t,this._params=void 0,this.behaviors={values:this.ev.behavior({transparent:this.params.transparent.defaultValue,axes:{name:"off",params:{}},resolution:this.params.resolution.defaultValue}),cropParams:this.ev.behavior({auto:!0,relativePadding:.1}),relativeCrop:this.ev.behavior({x:0,y:0,width:1,height:1})},this.events={previewed:this.ev()},this.canvas=document.createElement("canvas"),this.previewCanvas=document.createElement("canvas"),this.previewData={image:{data:new Uint8ClampedArray(1),width:1,height:0},background:st(0),transparent:!1}}}class DCt{addHandler(t,n){const r=this.handlers.findIndex(i=>i[0]===t);r<0?this.handlers.push([t,n]):this.handlers[r][1]=n}removeHandler(t){const n=this.handlers.findIndex(r=>r[0]===t);n>=0&&this.handlers.splice(n,1)}handle(t){var n=this;return le(function*(){for(let r=n.handlers.length-1;r>=0;r--){const i=n.handlers[r][1];if(yield i(t,n.plugin))return}!function PCt(e,t){const n=t.filter(r=>{const i=r.name.toLowerCase();return i.endsWith(".molx")||i.endsWith(".molj")});n.length>0?jt.State.Snapshots.OpenFile(e,{file:n[0]}):e.runTask(e.state.data.applyAction(NW,{files:t.map(r=>jr.File(r)),format:{name:"auto",params:{}},visuals:!0}))}(n.plugin,t)})()}dispose(){this.handlers.length=0}constructor(t){this.plugin=t,this.handlers=[]}}class kCt{get isInitialized(){return this._isInitialized}build(){return this.state.data.build()}initContainer(t){var n;if(this.canvasContainer)return!0;const r=document.createElement("div");Object.assign(r.style,{position:"absolute",left:0,top:0,right:0,bottom:0,"-webkit-user-select":"none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none","touch-action":"manipulation"});let i=null===(n=t?.canvas3dContext)||void 0===n?void 0:n.canvas;return i||(i=document.createElement("canvas"),t?.checkeredCanvasBackground&&Object.assign(i.style,{"background-image":"linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey), linear-gradient(45deg, lightgrey 25%, transparent 25%, transparent 75%, lightgrey 75%, lightgrey)","background-size":"60px 60px","background-position":"0 0, 30px 30px"}),r.appendChild(i)),!!this.initViewer(i,r,t?.canvas3dContext)&&(this.canvasContainer=r,!0)}mount(t,n){var r;if(this.disposed)throw new Error("Cannot mount a disposed context");return!!this.initContainer(n)&&(this.canvasContainer.parentElement!==t&&(null===(r=this.canvasContainer.parentElement)||void 0===r||r.removeChild(this.canvasContainer)),t.appendChild(this.canvasContainer),this.handleResize(),!0)}unmount(){var t,n;null===(n=null===(t=this.canvasContainer)||void 0===t?void 0:t.parentElement)||void 0===n||n.removeChild(this.canvasContainer)}initViewer(t,n,r){var i,o,s,a,l,c;try{this.layout.setRoot(n),this.spec.layout&&this.spec.layout.initial&&this.layout.setProps(this.spec.layout.initial),r||(r=K_.fromCanvas(t,this.managers.asset,{antialias:!(null!==(i=this.config.get(ei.General.DisableAntialiasing))&&void 0!==i&&i),preserveDrawingBuffer:!(null!==(o=this.config.get(ei.General.DisablePreserveDrawingBuffer))&&void 0!==o&&o),preferWebGl1:this.config.get(ei.General.PreferWebGl1)||!1,failIfMajorPerformanceCaveat:!(null!==(s=this.config.get(ei.General.AllowMajorPerformanceCaveat))&&void 0!==s&&s),powerPreference:this.config.get(ei.General.PowerPreference)||"high-performance",handleResize:this.handleResize},{pixelScale:this.config.get(ei.General.PixelScale)||1,pickScale:this.config.get(ei.General.PickScale)||.25,transparency:this.config.get(ei.General.Transparency)||"wboit"})),this.canvas3dContext=r,this.canvas3d=zq.create(this.canvas3dContext),this.canvas3dInit.next(!0);let u=this.spec.canvas3d;const d=st(16579577);return u?(void 0===(null===(l=u.renderer)||void 0===l?void 0:l.backgroundColor)&&(u=fy(u,f=>{f.renderer?f.renderer.backgroundColor=d:f.renderer={backgroundColor:d}})),null===(c=this.canvas3d)||void 0===c||c.setProps(u)):null===(a=this.canvas3d)||void 0===a||a.setProps({renderer:{backgroundColor:d}}),this.animationLoop.start(),this.helpers.viewportScreenshot=new TCt(this),this.subs.push(this.canvas3d.interaction.click.subscribe(f=>this.behaviors.interaction.click.next(f))),this.subs.push(this.canvas3d.interaction.drag.subscribe(f=>this.behaviors.interaction.drag.next(f))),this.subs.push(this.canvas3d.interaction.hover.subscribe(f=>this.behaviors.interaction.hover.next(f))),this.subs.push(this.canvas3d.input.resize.pipe(Qbe(50),mA(100,void 0,{leading:!1,trailing:!0})).subscribe(()=>this.handleResize())),this.subs.push(this.canvas3d.input.keyDown.subscribe(f=>this.behaviors.interaction.key.next(f))),this.subs.push(this.canvas3d.input.keyUp.subscribe(f=>this.behaviors.interaction.keyReleased.next(f))),this.subs.push(this.layout.events.updated.subscribe(()=>requestAnimationFrame(()=>this.handleResize()))),this.handleResize(),m3.setImmediate(()=>this.initCanvas3dPromiseCallbacks[0]()),!0}catch(u){return this.log.error(""+u),console.error(u),m3.setImmediate(()=>this.initCanvas3dPromiseCallbacks[1](u)),!1}}get isBusy(){return this.behaviors.state.isAnimating.value||this.behaviors.state.isUpdating.value}get selectionMode(){return this.behaviors.interaction.selectionMode.value}set selectionMode(t){this.behaviors.interaction.selectionMode.next(t)}dataTransaction(t,n){return this.runTask(this.state.data.transaction(t,n))}clear(t=!1){var n;return t&&(null===(n=this.canvas3d)||void 0===n||n.setProps(Uq)),jt.State.RemoveObject(this,{state:this.state.data,ref:vr.RootRef})}dispose(t){var n,r;if(!this.disposed){for(const i of this.subs)i.unsubscribe();this.subs=[],this.animationLoop.stop(),this.commands.dispose(),null===(n=this.canvas3d)||void 0===n||n.dispose(),null===(r=this.canvas3dContext)||void 0===r||r.dispose(t),this.ev.dispose(),this.state.dispose(),this.helpers.substructureParent.dispose(),Nu(this.managers,i=>{var o;return null===(o=i?.dispose)||void 0===o?void 0:o.call(i)}),Nu(this.managers.structure,i=>{var o;return null===(o=i?.dispose)||void 0===o?void 0:o.call(i)}),Nu(this.managers.volume,i=>{var o;return null===(o=i?.dispose)||void 0===o?void 0:o.call(i)}),this.unmount(),this.canvasContainer=void 0,this.customState={},this.disposed=!0}}initBehaviorEvents(){this.subs.push(Jy(this.state.data.behaviors.isUpdating,this.state.behaviors.behaviors.isUpdating).subscribe(s=>{this.behaviors.state.isUpdating.value!==s&&this.behaviors.state.isUpdating.next(s)}));const t=this.config.get(ei.General.IsBusyTimeoutMs)||750,n=this.behaviors.state.isBusy;let r;const i=()=>{n.value||n.next(!0)},o=()=>{void 0!==r&&clearTimeout(r),r=void 0};this.subs.push(Jy(this.behaviors.state.isUpdating,this.behaviors.state.isAnimating).subscribe(s=>{this.behaviors.state.isUpdating.value||this.behaviors.state.isAnimating.value?n.value||(o(),r=setTimeout(i,t)):(o(),n.next(!1))})),this.subs.push(this.behaviors.interaction.selectionMode.subscribe(s=>{var a;s||null===(a=this.managers.interactivity)||void 0===a||a.lociSelects.deselectAll()}))}initBuiltInBehavior(){nO.State.registerDefault(this),nO.Representation.registerDefault(this),nO.Camera.registerDefault(this),nO.Misc.registerDefault(this),this.subs.push(Jy(this.state.data.events.log,this.state.behaviors.events.log).subscribe(t=>this.events.log.next(t)))}initBehaviors(){var t=this;return le(function*(){let n=t.state.behaviors.build();for(const r of Object.keys(ii.Categories))n.toRoot().apply(ii.CreateCategory,{label:ii.Categories[r]},{ref:r,state:{isLocked:!0}});for(const r of t.spec.behaviors)"custom-props"===ii.getCategoryId(r.transformer)&&n.to(ii.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});yield t.runTask(t.state.behaviors.updateTree(n,{doNotUpdateCurrent:!0,doNotLogTiming:!0})),n=t.state.behaviors.build();for(const r of t.spec.behaviors)"custom-props"!==ii.getCategoryId(r.transformer)&&n.to(ii.getCategoryId(r.transformer)).apply(r.transformer,r.defaultParams,{ref:r.transformer.id});yield t.runTask(t.state.behaviors.updateTree(n,{doNotUpdateCurrent:!0,doNotLogTiming:!0}))})()}initCustomFormats(){if(this.spec.customFormats)for(const t of this.spec.customFormats)this.dataFormats.add(t[0],t[1])}initAnimations(){if(this.spec.animations)for(const t of this.spec.animations)this.managers.animation.register(t)}initDataActions(){if(this.spec.actions)for(const t of this.spec.actions)this.state.data.actions.add(t.action)}init(){var t=this;return le(function*(){try{t.subs.push(t.events.log.subscribe(n=>t.log.entries=t.log.entries.push(n))),t.initCustomFormats(),t.initBehaviorEvents(),t.initBuiltInBehavior(),t.managers.interactivity=new eb(t),t.managers.lociLabels=new $1t(t),t.builders.structure=new x1t(t),t.initAnimations(),t.initDataActions(),yield t.initBehaviors(),t.log.message(`Mol* Plugin 4.0.1 [${Oct.toLocaleString()}]`),g3||t.log.message("Development mode enabled"),$n&&t.log.message("Debug mode enabled"),t._isInitialized=!0,t.initializedPromiseCallbacks[0]()}catch(n){throw t.initializedPromiseCallbacks[1](n),n}})()}constructor(t){var n;this.spec=t,this.runTask=(r,i)=>this.managers.task.run(r,i),this.resolveTask=r=>{if(r)return Ke.is(r)?this.runTask(r):r},this.subs=[],this.initCanvas3dPromiseCallbacks=[()=>{},()=>{}],this._isInitialized=!1,this.initializedPromiseCallbacks=[()=>{},()=>{}],this.disposed=!1,this.canvasContainer=void 0,this.ev=uy.create(),this.config=new Uat(this.spec.config),this.state=new M2(this),this.commands=new Yat,this.canvas3dInit=this.ev.behavior(!1),this.behaviors={state:{isAnimating:this.ev.behavior(!1),isUpdating:this.ev.behavior(!1),isBusy:this.ev.behavior(!1)},interaction:{hover:this.ev.behavior({current:Xn.Loci.Empty,modifiers:Rf.None,buttons:0,button:0}),click:this.ev.behavior({current:Xn.Loci.Empty,modifiers:Rf.None,buttons:0,button:0}),drag:this.ev.behavior({current:Xn.Loci.Empty,modifiers:Rf.None,buttons:0,button:0,pageStart:Ue(),pageEnd:Ue()}),key:this.ev.behavior(Qge),keyReleased:this.ev.behavior(Qge),selectionMode:this.ev.behavior(!1)},labels:{highlight:this.ev.behavior({labels:[]})},layout:{leftPanelTabName:this.ev.behavior("root")},canvas3d:{initialized:this.canvas3dInit.pipe(xd(r=>!!r),zx(1))}},this.canvas3dInitialized=new Promise((r,i)=>{this.initCanvas3dPromiseCallbacks=[r,i]}),this.initialized=new Promise((r,i)=>{this.initializedPromiseCallbacks=[r,i]}),this.layout=new Nvt(this),this.animationLoop=new ACt(this),this.representation={structure:{registry:new JP,themes:{colorThemeRegistry:Rd.createRegistry(),sizeThemeRegistry:Ya.createRegistry()}},volume:{registry:new bA,themes:{colorThemeRegistry:Rd.createRegistry(),sizeThemeRegistry:Ya.createRegistry()}}},this.query={structure:{registry:new Pet}},this.dataFormats=new P1t,this.builders={data:new p1t(this),structure:void 0},this.helpers={substructureParent:new ICt(this),viewportScreenshot:void 0},this.managers={structure:{hierarchy:new m2(this),component:new Bg(this),measurement:new gvt(this),selection:new bvt(this),focus:new Q1t(this)},volume:{hierarchy:new CO(this)},interactivity:void 0,camera:new W1t(this),animation:new k1t(this),snapshot:new vA(this),lociLabels:void 0,toast:new ECt(this),asset:new Yze,task:new rX,dragAndDrop:new DCt(this)},this.events={log:this.ev(),task:this.managers.task.events,canvas3d:{settingsUpdated:this.ev()}},this.customModelProperties=new bO.Registry,this.customStructureProperties=new bO.Registry,this.customStructureControls=new Map,this.customImportControls=new Map,this.genericRepresentationControls=new Map,this.customState=Object.create(null),this.handleResize=()=>{var r,i;const o=null===(r=this.canvas3dContext)||void 0===r?void 0:r.canvas,s=this.layout.root;s&&o&&(function Lct(e,t,n=1){let r=window.innerWidth,i=window.innerHeight;t!==document.body&&(r=t.offsetWidth,i=t.offsetHeight),function Bct(e,t,n,r=1){e.width=Math.round(window.devicePixelRatio*r*t),e.height=Math.round(window.devicePixelRatio*r*n),Object.assign(e.style,{width:`${t}px`,height:`${n}px`})}(e,r,i,n)}(o,s,this.canvas3dContext.props.pixelScale),null===(i=this.canvas3d)||void 0===i||i.requestResize())},this.log={entries:cy(),entry:r=>this.events.log.next(r),error:r=>this.events.log.next(pg.error(r)),message:r=>this.events.log.next(pg.message(r)),info:r=>this.events.log.next(pg.info(r)),warn:r=>this.events.log.next(pg.warning(r))},this.fetch=o7,KGe(!1),function c6e(e){$0="default"===e?fse:l6e}(null!==(n=this.config.get(ei.Structure.SaccharideCompIdMapType))&&void 0!==n?n:"default")}}class MCt extends kCt{initCustomParamEditors(){if(this.spec.customParamEditors)for(const[t,n]of this.spec.customParamEditors)this.customParamEditors.set(t.id,n)}dispose(t){super.dispose(t),this.layout.dispose()}constructor(t){super(t),this.spec=t,this.customParamEditors=new Map,this.initCustomParamEditors()}}let bI=(()=>{class e{constructor(){this.plugin=new MCt({actions:[Vn.Action(s2.Structure.DownloadStructure),Vn.Action(s2.Volume.DownloadDensity),Vn.Action(s2.DataFormat.DownloadFile),Vn.Action(s2.DataFormat.OpenFiles),Vn.Action(s2.Structure.LoadTrajectory),Vn.Action(s2.Structure.EnableModelCustomProps),Vn.Action(s2.Structure.EnableStructureCustomProps),Vn.Action(pq),Vn.Action(Dct),Vn.Action(hq),Vn.Action(at.Data.Download),Vn.Action(at.Data.ParseCif),Vn.Action(at.Data.ParseCcp4),Vn.Action(at.Data.ParseDsn6),Vn.Action(at.Model.TrajectoryFromMmCif),Vn.Action(at.Model.TrajectoryFromCifCore),Vn.Action(at.Model.TrajectoryFromPDB),Vn.Action(at.Model.TransformStructureConformation),Vn.Action(at.Model.StructureFromModel),Vn.Action(at.Model.StructureFromTrajectory),Vn.Action(at.Model.ModelFromTrajectory),Vn.Action(at.Model.StructureSelectionFromScript),Vn.Action(at.Representation.StructureRepresentation3D),Vn.Action(at.Representation.StructureSelectionsDistance3D),Vn.Action(at.Representation.StructureSelectionsAngle3D),Vn.Action(at.Representation.StructureSelectionsDihedral3D),Vn.Action(at.Representation.StructureSelectionsLabel3D),Vn.Action(at.Representation.StructureSelectionsOrientation3D),Vn.Action(at.Representation.ModelUnitcell3D),Vn.Action(at.Representation.StructureBoundingBox3D),Vn.Action(at.Representation.ExplodeStructureRepresentation3D),Vn.Action(at.Representation.SpinStructureRepresentation3D),Vn.Action(at.Representation.UnwindStructureAssemblyRepresentation3D),Vn.Action(at.Representation.OverpaintStructureRepresentation3DFromScript),Vn.Action(at.Representation.TransparencyStructureRepresentation3DFromScript),Vn.Action(at.Representation.ClippingStructureRepresentation3DFromScript),Vn.Action(at.Representation.SubstanceStructureRepresentation3DFromScript),Vn.Action(at.Representation.ThemeStrengthRepresentation3D),Vn.Action(Cbe),Vn.Action(at.Volume.VolumeFromCcp4),Vn.Action(at.Volume.VolumeFromDsn6),Vn.Action(at.Volume.VolumeFromCube),Vn.Action(at.Volume.VolumeFromDx),Vn.Action(at.Representation.VolumeRepresentation3D)],behaviors:[Vn.Behavior(Od.Representation.HighlightLoci),Vn.Behavior(Od.Representation.SelectLoci),Vn.Behavior(Od.Representation.DefaultLociLabelProvider),Vn.Behavior(Od.Representation.FocusLoci),Vn.Behavior(Od.Camera.FocusLoci),Vn.Behavior(Od.Camera.CameraAxisHelper),Vn.Behavior(Od.Camera.CameraControls),Vn.Behavior(iO),Vn.Behavior(Od.CustomProps.StructureInfo),Vn.Behavior(Od.CustomProps.AccessibleSurfaceArea),Vn.Behavior(Od.CustomProps.BestDatabaseSequenceMapping),Vn.Behavior(Od.CustomProps.Interactions),Vn.Behavior(Od.CustomProps.SecondaryStructure),Vn.Behavior(Od.CustomProps.ValenceModel),Vn.Behavior(Od.CustomProps.CrossLinkRestraint)],animations:[Nct,Rct,F0t,Fct,Mct,N0t,R0t],customParamEditors:[[hq,d1t]],config:[[ei.VolumeStreaming.Enabled,!1]]}),this.plugin$=Is(this.plugin.init()).pipe(hn(()=>this.plugin),ff(1))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),vI=(()=>{class e{set source(n){this.source$.next(n)}constructor(n){var r=this;this.pluginService=n,this.source$=new Ao(null),this.structure$=this.pluginService.plugin$.pipe(ba(i=>this.source$.pipe(xd(o=>null!=o),hn(o=>({plugin:i,source:o})))),ba(({source:i})=>Is(le(function*(){return"local"===i.type?{data:yield r.parseLocalSource(i),source:i}:{data:yield r.parseRemoteSource(i),source:i}})())),ba(({data:i,source:o})=>Is(le(function*(){const s=r.pluginService.plugin,a=yield s.builders.structure.parseTrajectory(i,o.format),l=yield s.builders.structure.createModel(a,{modelIndex:0});return s.builders.structure.createStructure(l,{name:"model",params:{}})})())),Ho(i=>{let o=0;this.residues=[];const s=this.r2i=new Map,a=this.i2r=new Map;Xe.eachAtomicHierarchyElement(i.cell?.obj?.data,{residue:l=>{const c=Je.residue.auth_seq_id(l),u=Je.residue.pdbx_PDB_ins_code(l),d=Je.chain.auth_asym_id(l),f=Je.atom.auth_comp_id(l),p=(d+c+u).trim();s.set(p,o),a.set(o,p),this.residues.push({pdbInsCode:u,authSeqId:c,authAsymId:d,authCompId3:UG.has(f)?f:"XXX",authCompId1:UG.get(f)||"X"}),o++}})}),ff(1))}parseRemoteSource(n){var r=this;return le(function*(){const i=jr.Url(n.link);return r.pluginService.plugin.builders.data.download({url:i,label:n.label,isBinary:n.binary})})()}parseLocalSource(n){var r=this;return le(function*(){const i=n.binary,o=n.label,s=r.pluginService.plugin;if("string"==typeof n.data)return s.builders.data.rawData({data:n.data,label:o});let a;a=n.data instanceof File?jr.File(n.data):jr.File(new File([n.data],`${o}.${"mmcif"===n.format?"cif":"ent"}`));const{data:l}=yield s.builders.data.readFile({file:a,label:o,isBinary:i});return l})()}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(bI))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),cB=(()=>{class e{constructor(){this.settings$=new Fh}set settings(n){this.settings$.next(this._settings=n)}get settings(){return this._settings}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const BCt=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,LCt=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,Xxe={};function Kxe(e,t){return((t||Xxe).jsx?LCt:BCt).test(e)}const jCt=/[ \t\n\f\r]/g;function Zxe(e){return""===e.replace(jCt,"")}class ek{constructor(t,n,r){this.property=t,this.normal=n,r&&(this.space=r)}}function Qxe(e,t){const n={},r={};let i=-1;for(;++i<e.length;)Object.assign(n,e[i].property),Object.assign(r,e[i].normal);return new ek(n,r,t)}function iX(e){return e.toLowerCase()}ek.prototype.property={},ek.prototype.normal={},ek.prototype.space=null;class th{constructor(t,n){this.property=t,this.attribute=n}}th.prototype.space=null,th.prototype.boolean=!1,th.prototype.booleanish=!1,th.prototype.overloadedBoolean=!1,th.prototype.number=!1,th.prototype.commaSeparated=!1,th.prototype.spaceSeparated=!1,th.prototype.commaOrSpaceSeparated=!1,th.prototype.mustUseProperty=!1,th.prototype.defined=!1;let zCt=0;const di=R2(),wl=R2(),Jxe=R2(),en=R2(),xs=R2(),xI=R2(),Lf=R2();function R2(){return 2**++zCt}const oX=Object.keys(Cs);class sX extends th{constructor(t,n,r,i){let o=-1;if(super(t,n),e_e(this,"space",i),"number"==typeof r)for(;++o<oX.length;){const s=oX[o];e_e(this,oX[o],(r&Cs[s])===Cs[s])}}}function e_e(e,t,n){n&&(e[t]=n)}sX.prototype.defined=!0;const VCt={}.hasOwnProperty;function _I(e){const t={},n={};let r;for(r in e.properties)if(VCt.call(e.properties,r)){const i=e.properties[r],o=new sX(r,e.transform(e.attributes||{},r),i,e.space);e.mustUseProperty&&e.mustUseProperty.includes(r)&&(o.mustUseProperty=!0),t[r]=o,n[iX(r)]=r,n[iX(o.attribute)]=r}return new ek(t,n,e.space)}const t_e=_I({space:"xlink",transform:(e,t)=>"xlink:"+t.slice(5).toLowerCase(),properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),n_e=_I({space:"xml",transform:(e,t)=>"xml:"+t.slice(3).toLowerCase(),properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function r_e(e,t){return t in e?e[t]:t}function i_e(e,t){return r_e(e,t.toLowerCase())}const o_e=_I({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:i_e,properties:{xmlns:null,xmlnsXLink:null}}),s_e=_I({transform:(e,t)=>"role"===t?t:"aria-"+t.slice(4).toLowerCase(),properties:{ariaActiveDescendant:null,ariaAtomic:wl,ariaAutoComplete:null,ariaBusy:wl,ariaChecked:wl,ariaColCount:en,ariaColIndex:en,ariaColSpan:en,ariaControls:xs,ariaCurrent:null,ariaDescribedBy:xs,ariaDetails:null,ariaDisabled:wl,ariaDropEffect:xs,ariaErrorMessage:null,ariaExpanded:wl,ariaFlowTo:xs,ariaGrabbed:wl,ariaHasPopup:null,ariaHidden:wl,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:xs,ariaLevel:en,ariaLive:null,ariaModal:wl,ariaMultiLine:wl,ariaMultiSelectable:wl,ariaOrientation:null,ariaOwns:xs,ariaPlaceholder:null,ariaPosInSet:en,ariaPressed:wl,ariaReadOnly:wl,ariaRelevant:null,ariaRequired:wl,ariaRoleDescription:xs,ariaRowCount:en,ariaRowIndex:en,ariaRowSpan:en,ariaSelected:wl,ariaSetSize:en,ariaSort:null,ariaValueMax:en,ariaValueMin:en,ariaValueNow:en,ariaValueText:null,role:null}}),HCt=_I({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:i_e,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:xI,acceptCharset:xs,accessKey:xs,action:null,allow:null,allowFullScreen:di,allowPaymentRequest:di,allowUserMedia:di,alt:null,as:null,async:di,autoCapitalize:null,autoComplete:xs,autoFocus:di,autoPlay:di,blocking:xs,capture:null,charSet:null,checked:di,cite:null,className:xs,cols:en,colSpan:null,content:null,contentEditable:wl,controls:di,controlsList:xs,coords:en|xI,crossOrigin:null,data:null,dateTime:null,decoding:null,default:di,defer:di,dir:null,dirName:null,disabled:di,download:Jxe,draggable:wl,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:di,formTarget:null,headers:xs,height:en,hidden:di,high:en,href:null,hrefLang:null,htmlFor:xs,httpEquiv:xs,id:null,imageSizes:null,imageSrcSet:null,inert:di,inputMode:null,integrity:null,is:null,isMap:di,itemId:null,itemProp:xs,itemRef:xs,itemScope:di,itemType:xs,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:di,low:en,manifest:null,max:null,maxLength:en,media:null,method:null,min:null,minLength:en,multiple:di,muted:di,name:null,nonce:null,noModule:di,noValidate:di,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:di,optimum:en,pattern:null,ping:xs,placeholder:null,playsInline:di,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:di,referrerPolicy:null,rel:xs,required:di,reversed:di,rows:en,rowSpan:en,sandbox:xs,scope:null,scoped:di,seamless:di,selected:di,shadowRootDelegatesFocus:di,shadowRootMode:null,shape:null,size:en,sizes:null,slot:null,span:en,spellCheck:wl,src:null,srcDoc:null,srcLang:null,srcSet:null,start:en,step:null,style:null,tabIndex:en,target:null,title:null,translate:null,type:null,typeMustMatch:di,useMap:null,value:wl,width:en,wrap:null,align:null,aLink:null,archive:xs,axis:null,background:null,bgColor:null,border:en,borderColor:null,bottomMargin:en,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:di,declare:di,event:null,face:null,frame:null,frameBorder:null,hSpace:en,leftMargin:en,link:null,longDesc:null,lowSrc:null,marginHeight:en,marginWidth:en,noResize:di,noHref:di,noShade:di,noWrap:di,object:null,profile:null,prompt:null,rev:null,rightMargin:en,rules:null,scheme:null,scrolling:wl,standby:null,summary:null,text:null,topMargin:en,valueType:null,version:null,vAlign:null,vLink:null,vSpace:en,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:di,disableRemotePlayback:di,prefix:null,property:null,results:en,security:null,unselectable:null}}),GCt=_I({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:r_e,properties:{about:Lf,accentHeight:en,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:en,amplitude:en,arabicForm:null,ascent:en,attributeName:null,attributeType:null,azimuth:en,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:en,by:null,calcMode:null,capHeight:en,className:xs,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:en,diffuseConstant:en,direction:null,display:null,dur:null,divisor:en,dominantBaseline:null,download:di,dx:null,dy:null,edgeMode:null,editable:null,elevation:en,enableBackground:null,end:null,event:null,exponent:en,externalResourcesRequired:null,fill:null,fillOpacity:en,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:xI,g2:xI,glyphName:xI,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:en,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:en,horizOriginX:en,horizOriginY:en,id:null,ideographic:en,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:en,k:en,k1:en,k2:en,k3:en,k4:en,kernelMatrix:Lf,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:en,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:en,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:en,overlineThickness:en,paintOrder:null,panose1:null,path:null,pathLength:en,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:xs,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:en,pointsAtY:en,pointsAtZ:en,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Lf,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Lf,rev:Lf,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Lf,requiredFeatures:Lf,requiredFonts:Lf,requiredFormats:Lf,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:en,specularExponent:en,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:en,strikethroughThickness:en,string:null,stroke:null,strokeDashArray:Lf,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:en,strokeOpacity:en,strokeWidth:null,style:null,surfaceScale:en,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Lf,tabIndex:en,tableValues:null,target:null,targetX:en,targetY:en,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Lf,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:en,underlineThickness:en,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:en,values:null,vAlphabetic:en,vMathematical:en,vectorEffect:null,vHanging:en,vIdeographic:en,version:null,vertAdvY:en,vertOriginX:en,vertOriginY:en,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:en,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),qCt=Qxe([n_e,t_e,o_e,s_e,HCt],"html"),aX=Qxe([n_e,t_e,o_e,s_e,GCt],"svg"),WCt=/^data[-\w.:]+$/i,a_e=/-[a-z]/g,$Ct=/[A-Z]/g;function XCt(e){return"-"+e.toLowerCase()}function KCt(e){return e.charAt(1).toUpperCase()}const ZCt={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"};var l_e=ln(390);const JCt=l_e.default||l_e,c_e=u_e("end"),lX=u_e("start");function u_e(e){return function t(n){const r=n&&n.position&&n.position[e]||{};if("number"==typeof r.line&&r.line>0&&"number"==typeof r.column&&r.column>0)return{line:r.line,column:r.column,offset:"number"==typeof r.offset&&r.offset>-1?r.offset:void 0}}}function tk(e){return e&&"object"==typeof e?"position"in e||"type"in e?d_e(e.position):"start"in e||"end"in e?d_e(e):"line"in e||"column"in e?cX(e):"":""}function cX(e){return f_e(e&&e.line)+":"+f_e(e&&e.column)}function d_e(e){return cX(e&&e.start)+"-"+cX(e&&e.end)}function f_e(e){return e&&"number"==typeof e?e:1}class gu extends Error{constructor(t,n,r){super(),"string"==typeof n&&(r=n,n=void 0);let i="",o={},s=!1;if(n&&(o="line"in n&&"column"in n||"start"in n&&"end"in n?{place:n}:"type"in n?{ancestors:[n],place:n.position}:{...n}),"string"==typeof t?i=t:!o.cause&&t&&(s=!0,i=t.message,o.cause=t),!o.ruleId&&!o.source&&"string"==typeof r){const l=r.indexOf(":");-1===l?o.ruleId=r:(o.source=r.slice(0,l),o.ruleId=r.slice(l+1))}if(!o.place&&o.ancestors&&o.ancestors){const l=o.ancestors[o.ancestors.length-1];l&&(o.place=l.position)}const a=o.place&&"start"in o.place?o.place.start:o.place;this.ancestors=o.ancestors||void 0,this.cause=o.cause||void 0,this.column=a?a.column:void 0,this.fatal=void 0,this.message=i,this.line=a?a.line:void 0,this.name=tk(o.place)||"1:1",this.place=o.place||void 0,this.reason=this.message,this.ruleId=o.ruleId||void 0,this.source=o.source||void 0,this.stack=s&&o.cause&&"string"==typeof o.cause.stack?o.cause.stack:""}}gu.prototype.file="",gu.prototype.name="",gu.prototype.reason="",gu.prototype.message="",gu.prototype.stack="",gu.prototype.column=void 0,gu.prototype.line=void 0,gu.prototype.ancestors=void 0,gu.prototype.cause=void 0,gu.prototype.fatal=void 0,gu.prototype.place=void 0,gu.prototype.ruleId=void 0,gu.prototype.source=void 0;const uX={}.hasOwnProperty,twt=new Map,nwt=/[A-Z]/g,rwt=/-([a-z])/g,iwt=new Set(["table","tbody","thead","tfoot","tr"]),owt=new Set(["td","th"]),p_e="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function h_e(e,t,n){return"element"===t.type?function awt(e,t,n){const r=e.schema;let i=r;"svg"===t.tagName.toLowerCase()&&"html"===r.space&&(i=aX,e.schema=i),e.ancestors.push(t);const o=g_e(e,t.tagName,!1),s=function mwt(e,t){const n={};let r,i;for(i in t.properties)if("children"!==i&&uX.call(t.properties,i)){const o=ywt(e,i,t.properties[i]);if(o){const[s,a]=o;e.tableCellAlignToStyle&&"align"===s&&"string"==typeof a&&owt.has(t.tagName)?r=a:n[s]=a}}return r&&((n.style||(n.style={}))["css"===e.stylePropertyNameCase?"text-align":"textAlign"]=r),n}(e,t);let a=fX(e,t);return iwt.has(t.tagName)&&(a=a.filter(function(l){return"string"!=typeof l||!function UCt(e){return"object"==typeof e?"text"===e.type&&Zxe(e.value):Zxe(e)}(l)})),m_e(e,s,o,t),dX(s,a),e.ancestors.pop(),e.schema=r,e.create(t,o,s,n)}(e,t,n):"mdxFlowExpression"===t.type||"mdxTextExpression"===t.type?function lwt(e,t){if(t.data&&t.data.estree&&e.evaluater){return e.evaluater.evaluateExpression(t.data.estree.body[0].expression)}nk(e,t.position)}(e,t):"mdxJsxFlowElement"===t.type||"mdxJsxTextElement"===t.type?function uwt(e,t,n){const r=e.schema;let i=r;"svg"===t.name&&"html"===r.space&&(i=aX,e.schema=i),e.ancestors.push(t);const o=null===t.name?e.Fragment:g_e(e,t.name,!0),s=function gwt(e,t){const n={};for(const r of t.attributes)if("mdxJsxExpressionAttribute"===r.type)if(r.data&&r.data.estree&&e.evaluater){Object.assign(n,e.evaluater.evaluateExpression(r.data.estree.body[0].expression.properties[0].argument))}else nk(e,t.position);else{const i=r.name;let o;if(r.value&&"object"==typeof r.value)if(r.value.data&&r.value.data.estree&&e.evaluater){o=e.evaluater.evaluateExpression(r.value.data.estree.body[0].expression)}else nk(e,t.position);else o=null===r.value||r.value;n[i]=o}return n}(e,t),a=fX(e,t);return m_e(e,s,o,t),dX(s,a),e.ancestors.pop(),e.schema=r,e.create(t,o,s,n)}(e,t,n):"mdxjsEsm"===t.type?function cwt(e,t){if(t.data&&t.data.estree&&e.evaluater)return e.evaluater.evaluateProgram(t.data.estree);nk(e,t.position)}(e,t):"root"===t.type?function dwt(e,t,n){const r={};return dX(r,fX(e,t)),e.create(t,e.Fragment,r,n)}(e,t,n):"text"===t.type?function fwt(e,t){return t.value}(0,t):void 0}function m_e(e,t,n,r){"string"!=typeof n&&n!==e.Fragment&&e.passNode&&(t.node=r)}function dX(e,t){if(t.length>0){const n=t.length>1?t:t[0];n&&(e.children=n)}}function fX(e,t){const n=[];let r=-1;const i=e.passKeys?new Map:twt;for(;++r<t.children.length;){const o=t.children[r];let s;if(e.passKeys){const l="element"===o.type?o.tagName:"mdxJsxFlowElement"===o.type||"mdxJsxTextElement"===o.type?o.name:void 0;if(l){const c=i.get(l)||0;s=l+"-"+c,i.set(l,c+1)}}const a=h_e(e,o,s);void 0!==a&&n.push(a)}return n}function ywt(e,t,n){const r=function YCt(e,t){const n=iX(t);let r=t,i=th;if(n in e.normal)return e.property[e.normal[n]];if(n.length>4&&"data"===n.slice(0,4)&&WCt.test(t)){if("-"===t.charAt(4)){const o=t.slice(5).replace(a_e,KCt);r="data"+o.charAt(0).toUpperCase()+o.slice(1)}else{const o=t.slice(4);if(!a_e.test(o)){let s=o.replace($Ct,XCt);"-"!==s.charAt(0)&&(s="-"+s),t="data"+s}}i=sX}return new i(r,t)}(e.schema,t);if(!(null==n||"number"==typeof n&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?function RCt(e,t){const n=t||{};return(""===e[e.length-1]?[...e,""]:e).join((n.padRight?" ":"")+","+(!1===n.padLeft?"":" ")).trim()}(n):function QCt(e){return e.join(" ").trim()}(n)),"style"===r.property){let i="object"==typeof n?n:function bwt(e,t){const n={};try{JCt(t,function r(i,o){let s=i;"--"!==s.slice(0,2)&&("-ms-"===s.slice(0,4)&&(s="ms-"+s.slice(4)),s=s.replace(rwt,_wt)),n[s]=o})}catch(i){if(!e.ignoreInvalidStyle){const s=new gu("Cannot parse `style` attribute",{ancestors:e.ancestors,cause:i,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=e.filePath||void 0,s.url=p_e+"#cannot-parse-style-attribute",s}}return n}(e,String(n));return"css"===e.stylePropertyNameCase&&(i=function vwt(e){const t={};let n;for(n in e)uX.call(e,n)&&(t[xwt(n)]=e[n]);return t}(i)),["style",i]}return["react"===e.elementAttributeNameCase&&r.space?ZCt[r.property]||r.property:r.attribute,n]}}function g_e(e,t,n){let r;if(n)if(t.includes(".")){const i=t.split(".");let s,o=-1;for(;++o<i.length;){const a=Kxe(i[o])?{type:"Identifier",name:i[o]}:{type:"Literal",value:i[o]};s=s?{type:"MemberExpression",object:s,property:a,computed:!(!o||"Literal"!==a.type),optional:!1}:a}r=s}else r=Kxe(t)&&!/^[a-z]/.test(t)?{type:"Identifier",name:t}:{type:"Literal",value:t};else r={type:"Literal",value:t};if("Literal"===r.type){const i=r.value;return uX.call(e.components,i)?e.components[i]:i}if(e.evaluater)return e.evaluater.evaluateExpression(r);nk(e)}function nk(e,t){const n=new gu("Cannot handle MDX estrees without `createEvaluater`",{ancestors:e.ancestors,place:t,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=e.filePath||void 0,n.url=p_e+"#cannot-handle-mdx-estrees-without-createevaluater",n}function xwt(e){let t=e.replace(nwt,Swt);return"ms-"===t.slice(0,3)&&(t="-"+t),t}function _wt(e,t){return t.toUpperCase()}function Swt(e){return"-"+e.toLowerCase()}const pX={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},Cwt={};function y_e(e,t,n){if(function Awt(e){return!(!e||"object"!=typeof e)}(e)){if("value"in e)return"html"!==e.type||n?e.value:"";if(t&&"alt"in e&&e.alt)return e.alt;if("children"in e)return b_e(e.children,t,n)}return Array.isArray(e)?b_e(e,t,n):""}function b_e(e,t,n){const r=[];let i=-1;for(;++i<e.length;)r[i]=y_e(e[i],t,n);return r.join("")}function Wg(e,t,n,r){const i=e.length;let s,o=0;if(t=t<0?-t>i?0:i+t:t>i?i:t,n=n>0?n:0,r.length<1e4)s=Array.from(r),s.unshift(t,n),e.splice(...s);else for(n&&e.splice(t,n);o<r.length;)s=r.slice(o,o+1e4),s.unshift(t,0),e.splice(...s),o+=1e4,t+=1e4}function nh(e,t){return e.length>0?(Wg(e,e.length,0,t),e):t}function v_e(e){const t={};let r,i,o,s,a,l,c,n=-1;for(;++n<e.length;){for(;n in t;)n=t[n];if(r=e[n],n&&"chunkFlow"===r[1].type&&"listItemPrefix"===e[n-1][1].type&&(l=r[1]._tokenizer.events,o=0,o<l.length&&"lineEndingBlank"===l[o][1].type&&(o+=2),o<l.length&&"content"===l[o][1].type))for(;++o<l.length&&"content"!==l[o][1].type;)"chunkText"===l[o][1].type&&(l[o][1]._isInFirstContentOfListItem=!0,o++);if("enter"===r[0])r[1].contentType&&(Object.assign(t,Iwt(e,n)),n=t[n],c=!0);else if(r[1]._container){for(o=n,i=void 0;o--&&(s=e[o],"lineEnding"===s[1].type||"lineEndingBlank"===s[1].type);)"enter"===s[0]&&(i&&(e[i][1].type="lineEndingBlank"),s[1].type="lineEnding",i=o);i&&(r[1].end=Object.assign({},e[i][1].start),a=e.slice(i,n),a.unshift(r),Wg(e,i,n-i+1,a))}}return!c}function Iwt(e,t){const n=e[t][1],r=e[t][2];let i=t-1;const o=[],s=n._tokenizer||r.parser[n.contentType](n.start),a=s.events,l=[],c={};let u,d,f=-1,p=n,m=0,h=0;const g=[h];for(;p;){for(;e[++i][1]!==p;);o.push(i),p._tokenizer||(u=r.sliceStream(p),p.next||u.push(null),d&&s.defineSkip(p.start),p._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(u),p._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=n;++f<a.length;)"exit"===a[f][0]&&"enter"===a[f-1][0]&&a[f][1].type===a[f-1][1].type&&a[f][1].start.line!==a[f][1].end.line&&(h=f+1,g.push(h),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(s.events=[],p?(p._tokenizer=void 0,p.previous=void 0):g.pop(),f=g.length;f--;){const y=a.slice(g[f],g[f+1]),v=o.pop();l.unshift([v,v+y.length-1]),Wg(e,v,2,y)}for(f=-1;++f<l.length;)c[m+l[f][0]]=m+l[f][1],m+=l[f][1]-l[f][0]-1;return c}const hX={}.hasOwnProperty;function Dwt(e,t){let n;for(n in t){const i=(hX.call(e,n)?e[n]:void 0)||(e[n]={}),o=t[n];let s;if(o)for(s in o){hX.call(i,s)||(i[s]=[]);const a=o[s];Pwt(i[s],Array.isArray(a)?a:a?[a]:[])}}}function Pwt(e,t){let n=-1;const r=[];for(;++n<t.length;)("after"===t[n].add?e:r).push(t[n]);Wg(e,0,0,r)}const $g=Sv(/[A-Za-z]/),jf=Sv(/[\dA-Za-z]/),Mwt=Sv(/[#-'*+\--9=?A-Z^-~]/);function mX(e){return null!==e&&(e<32||127===e)}const gX=Sv(/\d/),Rwt=Sv(/[\dA-Fa-f]/),Nwt=Sv(/[!-/:-@[-`{-~]/);function Dr(e){return null!==e&&e<-2}function zd(e){return null!==e&&(e<0||32===e)}function wo(e){return-2===e||-1===e||32===e}const Fwt=Sv(new RegExp("\\p{P}|\\p{S}","u")),Owt=Sv(/\s/);function Sv(e){return function t(n){return null!==n&&n>-1&&e.test(String.fromCharCode(n))}}function _s(e,t,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let o=0;return function s(l){return wo(l)?(e.enter(n),a(l)):t(l)};function a(l){return wo(l)&&o++<i?(e.consume(l),a):(e.exit(n),t(l))}}const Bwt={tokenize:function Lwt(e){const t=e.attempt(this.parser.constructs.contentInitial,function r(a){if(null!==a)return e.enter("lineEnding"),e.consume(a),e.exit("lineEnding"),_s(e,t,"linePrefix");e.consume(a)},function i(a){return e.enter("paragraph"),o(a)});let n;return t;function o(a){const l=e.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=l),n=l,s(a)}function s(a){return null===a?(e.exit("chunkText"),e.exit("paragraph"),void e.consume(a)):Dr(a)?(e.consume(a),e.exit("chunkText"),o):(e.consume(a),s)}}},jwt={tokenize:function Uwt(e){const t=this,n=[];let i,o,s,r=0;return a;function a(x){if(r<n.length){const _=n[r];return t.containerState=_[1],e.attempt(_[0].continuation,l,c)(x)}return c(x)}function l(x){if(r++,t.containerState._closeFlow){t.containerState._closeFlow=void 0,i&&v();const _=t.events.length;let A,w=_;for(;w--;)if("exit"===t.events[w][0]&&"chunkFlow"===t.events[w][1].type){A=t.events[w][1].end;break}y(r);let M=_;for(;M<t.events.length;)t.events[M][1].end=Object.assign({},A),M++;return Wg(t.events,w+1,0,t.events.slice(_)),t.events.length=M,c(x)}return a(x)}function c(x){if(r===n.length){if(!i)return f(x);if(i.currentConstruct&&i.currentConstruct.concrete)return m(x);t.interrupt=!(!i.currentConstruct||i._gfmTableDynamicInterruptHack)}return t.containerState={},e.check(x_e,u,d)(x)}function u(x){return i&&v(),y(r),f(x)}function d(x){return t.parser.lazy[t.now().line]=r!==n.length,s=t.now().offset,m(x)}function f(x){return t.containerState={},e.attempt(x_e,p,m)(x)}function p(x){return r++,n.push([t.currentConstruct,t.containerState]),f(x)}function m(x){return null===x?(i&&v(),y(0),void e.consume(x)):(i=i||t.parser.flow(t.now()),e.enter("chunkFlow",{contentType:"flow",previous:o,_tokenizer:i}),h(x))}function h(x){return null===x?(g(e.exit("chunkFlow"),!0),y(0),void e.consume(x)):Dr(x)?(e.consume(x),g(e.exit("chunkFlow")),r=0,t.interrupt=void 0,a):(e.consume(x),h)}function g(x,_){const w=t.sliceStream(x);if(_&&w.push(null),x.previous=o,o&&(o.next=x),o=x,i.defineSkip(x.start),i.write(w),t.parser.lazy[x.start.line]){let A=i.events.length;for(;A--;)if(i.events[A][1].start.offset<s&&(!i.events[A][1].end||i.events[A][1].end.offset>s))return;const M=t.events.length;let D,T,E=M;for(;E--;)if("exit"===t.events[E][0]&&"chunkFlow"===t.events[E][1].type){if(D){T=t.events[E][1].end;break}D=!0}for(y(r),A=M;A<t.events.length;)t.events[A][1].end=Object.assign({},T),A++;Wg(t.events,E+1,0,t.events.slice(M)),t.events.length=A}}function y(x){let _=n.length;for(;_-- >x;){const w=n[_];t.containerState=w[1],w[0].exit.call(t,e)}n.length=x}function v(){i.write([null]),o=void 0,i=void 0,t.containerState._closeFlow=void 0}}},x_e={tokenize:function zwt(e,t,n){return _s(e,e.attempt(this.parser.constructs.document,t,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}},uB={tokenize:function Vwt(e,t,n){return function r(o){return wo(o)?_s(e,i,"linePrefix")(o):i(o)};function i(o){return null===o||Dr(o)?t(o):n(o)}},partial:!0},Hwt={tokenize:function Wwt(e,t){let n;return function r(a){return e.enter("content"),n=e.enter("chunkContent",{contentType:"content"}),i(a)};function i(a){return null===a?o(a):Dr(a)?e.check(Gwt,s,o)(a):(e.consume(a),i)}function o(a){return e.exit("chunkContent"),e.exit("content"),t(a)}function s(a){return e.consume(a),e.exit("chunkContent"),n.next=e.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,i}},resolve:function qwt(e){return v_e(e),e}},Gwt={tokenize:function $wt(e,t,n){const r=this;return function i(s){return e.exit("chunkContent"),e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),_s(e,o,"linePrefix")};function o(s){if(null===s||Dr(s))return n(s);const a=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(s):e.interrupt(r.parser.constructs.flow,n,t)(s)}},partial:!0},Ywt={tokenize:function Xwt(e){const t=this,n=e.attempt(uB,function r(o){if(null!==o)return e.enter("lineEndingBlank"),e.consume(o),e.exit("lineEndingBlank"),t.currentConstruct=void 0,n;e.consume(o)},e.attempt(this.parser.constructs.flowInitial,i,_s(e,e.attempt(this.parser.constructs.flow,i,e.attempt(Hwt,i)),"linePrefix")));return n;function i(o){if(null!==o)return e.enter("lineEnding"),e.consume(o),e.exit("lineEnding"),t.currentConstruct=void 0,n;e.consume(o)}}},Kwt={resolveAll:S_e()},Zwt=__e("string"),Qwt=__e("text");function __e(e){return{tokenize:function t(n){const r=this,i=this.parser.constructs[e],o=n.attempt(i,s,a);return s;function s(u){return c(u)?o(u):a(u)}function a(u){if(null!==u)return n.enter("data"),n.consume(u),l;n.consume(u)}function l(u){return c(u)?(n.exit("data"),o(u)):(n.consume(u),l)}function c(u){if(null===u)return!0;const d=i[u];let f=-1;if(d)for(;++f<d.length;){const p=d[f];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}},resolveAll:S_e("text"===e?Jwt:void 0)}}function S_e(e){return function t(n,r){let o,i=-1;for(;++i<=n.length;)void 0===o?n[i]&&"data"===n[i][1].type&&(o=i,i++):(!n[i]||"data"!==n[i][1].type)&&(i!==o+2&&(n[o][1].end=n[i-1][1].end,n.splice(o+2,i-o-2),i=o+2),o=void 0);return e?e(n,r):n}}function Jwt(e,t){let n=0;for(;++n<=e.length;)if((n===e.length||"lineEnding"===e[n][1].type)&&"data"===e[n-1][1].type){const r=e[n-1][1],i=t.sliceStream(r);let l,o=i.length,s=-1,a=0;for(;o--;){const c=i[o];if("string"==typeof c){for(s=c.length;32===c.charCodeAt(s-1);)a++,s--;if(s)break;s=-1}else if(-2===c)l=!0,a++;else if(-1!==c){o++;break}}if(a){const c={type:n===e.length||l||a<2?"lineSuffix":"hardBreakTrailing",start:{line:r.end.line,column:r.end.column-a,offset:r.end.offset-a,_index:r.start._index+o,_bufferIndex:o?s:r.start._bufferIndex+s},end:Object.assign({},r.end)};r.end=Object.assign({},c.start),r.start.offset===r.end.offset?Object.assign(r,c):(e.splice(n,0,["enter",c,t],["exit",c,t]),n+=2)}n++}return e}function yX(e,t,n){const r=[];let i=-1;for(;++i<e.length;){const o=e[i].resolveAll;o&&!r.includes(o)&&(t=o(t,n),r.push(o))}return t}const dB={name:"thematicBreak",tokenize:function rAt(e,t,n){let i,r=0;return function o(c){return e.enter("thematicBreak"),function s(c){return i=c,a(c)}(c)};function a(c){return c===i?(e.enter("thematicBreakSequence"),l(c)):r>=3&&(null===c||Dr(c))?(e.exit("thematicBreak"),t(c)):n(c)}function l(c){return c===i?(e.consume(c),r++,l):(e.exit("thematicBreakSequence"),wo(c)?_s(e,a,"whitespace")(c):a(c))}}},Vd={name:"list",tokenize:function sAt(e,t,n){const r=this,i=r.events[r.events.length-1];let o=i&&"linePrefix"===i[1].type?i[2].sliceSerialize(i[1],!0).length:0,s=0;return function a(p){const m=r.containerState.type||(42===p||43===p||45===p?"listUnordered":"listOrdered");if("listUnordered"===m?!r.containerState.marker||p===r.containerState.marker:gX(p)){if(r.containerState.type||(r.containerState.type=m,e.enter(m,{_container:!0})),"listUnordered"===m)return e.enter("listItemPrefix"),42===p||45===p?e.check(dB,n,c)(p):c(p);if(!r.interrupt||49===p)return e.enter("listItemPrefix"),e.enter("listItemValue"),l(p)}return n(p)};function l(p){return gX(p)&&++s<10?(e.consume(p),l):(!r.interrupt||s<2)&&(r.containerState.marker?p===r.containerState.marker:41===p||46===p)?(e.exit("listItemValue"),c(p)):n(p)}function c(p){return e.enter("listItemMarker"),e.consume(p),e.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,e.check(uB,r.interrupt?n:u,e.attempt(iAt,f,d))}function u(p){return r.containerState.initialBlankLine=!0,o++,f(p)}function d(p){return wo(p)?(e.enter("listItemPrefixWhitespace"),e.consume(p),e.exit("listItemPrefixWhitespace"),f):n(p)}function f(p){return r.containerState.size=o+r.sliceSerialize(e.exit("listItemPrefix"),!0).length,t(p)}},continuation:{tokenize:function aAt(e,t,n){const r=this;return r.containerState._closeFlow=void 0,e.check(uB,function i(a){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,_s(e,t,"listItemIndent",r.containerState.size+1)(a)},function o(a){return r.containerState.furtherBlankLines||!wo(a)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(a)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,e.attempt(oAt,t,s)(a))});function s(a){return r.containerState._closeFlow=!0,r.interrupt=void 0,_s(e,e.attempt(Vd,t,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(a)}}},exit:function cAt(e){e.exit(this.containerState.type)}},iAt={tokenize:function uAt(e,t,n){const r=this;return _s(e,function i(o){const s=r.events[r.events.length-1];return!wo(o)&&s&&"listItemPrefixWhitespace"===s[1].type?t(o):n(o)},"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5)},partial:!0},oAt={tokenize:function lAt(e,t,n){const r=this;return _s(e,function i(o){const s=r.events[r.events.length-1];return s&&"listItemIndent"===s[1].type&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?t(o):n(o)},"listItemIndent",r.containerState.size+1)},partial:!0},C_e={name:"blockQuote",tokenize:function dAt(e,t,n){const r=this;return function i(s){if(62===s){const a=r.containerState;return a.open||(e.enter("blockQuote",{_container:!0}),a.open=!0),e.enter("blockQuotePrefix"),e.enter("blockQuoteMarker"),e.consume(s),e.exit("blockQuoteMarker"),o}return n(s)};function o(s){return wo(s)?(e.enter("blockQuotePrefixWhitespace"),e.consume(s),e.exit("blockQuotePrefixWhitespace"),e.exit("blockQuotePrefix"),t):(e.exit("blockQuotePrefix"),t(s))}},continuation:{tokenize:function fAt(e,t,n){const r=this;return function i(s){return wo(s)?_s(e,o,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):o(s)};function o(s){return e.attempt(C_e,t,n)(s)}}},exit:function pAt(e){e.exit("blockQuote")}};function w_e(e,t,n,r,i,o,s,a,l){const c=l||Number.POSITIVE_INFINITY;let u=0;return function d(y){return 60===y?(e.enter(r),e.enter(i),e.enter(o),e.consume(y),e.exit(o),f):null===y||32===y||41===y||mX(y)?n(y):(e.enter(r),e.enter(s),e.enter(a),e.enter("chunkString",{contentType:"string"}),h(y))};function f(y){return 62===y?(e.enter(o),e.consume(y),e.exit(o),e.exit(i),e.exit(r),t):(e.enter(a),e.enter("chunkString",{contentType:"string"}),p(y))}function p(y){return 62===y?(e.exit("chunkString"),e.exit(a),f(y)):null===y||60===y||Dr(y)?n(y):(e.consume(y),92===y?m:p)}function m(y){return 60===y||62===y||92===y?(e.consume(y),p):p(y)}function h(y){return u||null!==y&&41!==y&&!zd(y)?u<c&&40===y?(e.consume(y),u++,h):41===y?(e.consume(y),u--,h):null===y||32===y||40===y||mX(y)?n(y):(e.consume(y),92===y?g:h):(e.exit("chunkString"),e.exit(a),e.exit(s),e.exit(r),t(y))}function g(y){return 40===y||41===y||92===y?(e.consume(y),h):h(y)}}function A_e(e,t,n,r,i,o){const s=this;let l,a=0;return function c(p){return e.enter(r),e.enter(i),e.consume(p),e.exit(i),e.enter(o),u};function u(p){return a>999||null===p||91===p||93===p&&!l||94===p&&!a&&"_hiddenFootnoteSupport"in s.parser.constructs?n(p):93===p?(e.exit(o),e.enter(i),e.consume(p),e.exit(i),e.exit(r),t):Dr(p)?(e.enter("lineEnding"),e.consume(p),e.exit("lineEnding"),u):(e.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return null===p||91===p||93===p||Dr(p)||a++>999?(e.exit("chunkString"),u(p)):(e.consume(p),l||(l=!wo(p)),92===p?f:d)}function f(p){return 91===p||92===p||93===p?(e.consume(p),a++,d):d(p)}}function I_e(e,t,n,r,i,o){let s;return function a(f){return 34===f||39===f||40===f?(e.enter(r),e.enter(i),e.consume(f),e.exit(i),s=40===f?41:f,l):n(f)};function l(f){return f===s?(e.enter(i),e.consume(f),e.exit(i),e.exit(r),t):(e.enter(o),c(f))}function c(f){return f===s?(e.exit(o),l(s)):null===f?n(f):Dr(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),_s(e,c,"linePrefix")):(e.enter("chunkString",{contentType:"string"}),u(f))}function u(f){return f===s||null===f||Dr(f)?(e.exit("chunkString"),c(f)):(e.consume(f),92===f?d:u)}function d(f){return f===s||92===f?(e.consume(f),u):u(f)}}function rk(e,t){let n;return function r(i){return Dr(i)?(e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),n=!0,r):wo(i)?_s(e,r,n?"linePrefix":"lineSuffix")(i):t(i)}}function SI(e){return e.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const hAt={name:"definition",tokenize:function gAt(e,t,n){const r=this;let i;return function o(p){return e.enter("definition"),function s(p){return A_e.call(r,e,a,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}(p)};function a(p){return i=SI(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),58===p?(e.enter("definitionMarker"),e.consume(p),e.exit("definitionMarker"),l):n(p)}function l(p){return zd(p)?rk(e,c)(p):c(p)}function c(p){return w_e(e,u,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function u(p){return e.attempt(mAt,d,d)(p)}function d(p){return wo(p)?_s(e,f,"whitespace")(p):f(p)}function f(p){return null===p||Dr(p)?(e.exit("definition"),r.parser.defined.push(i),t(p)):n(p)}}},mAt={tokenize:function yAt(e,t,n){return function r(a){return zd(a)?rk(e,i)(a):n(a)};function i(a){return I_e(e,o,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(a)}function o(a){return wo(a)?_s(e,s,"whitespace")(a):s(a)}function s(a){return null===a||Dr(a)?t(a):n(a)}},partial:!0},bX={name:"codeIndented",tokenize:function vAt(e,t,n){const r=this;return function i(c){return e.enter("codeIndented"),_s(e,o,"linePrefix",5)(c)};function o(c){const u=r.events[r.events.length-1];return u&&"linePrefix"===u[1].type&&u[2].sliceSerialize(u[1],!0).length>=4?s(c):n(c)}function s(c){return null===c?l(c):Dr(c)?e.attempt(bAt,s,l)(c):(e.enter("codeFlowValue"),a(c))}function a(c){return null===c||Dr(c)?(e.exit("codeFlowValue"),s(c)):(e.consume(c),a)}function l(c){return e.exit("codeIndented"),t(c)}}},bAt={tokenize:function xAt(e,t,n){const r=this;return i;function i(s){return r.parser.lazy[r.now().line]?n(s):Dr(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),i):_s(e,o,"linePrefix",5)(s)}function o(s){const a=r.events[r.events.length-1];return a&&"linePrefix"===a[1].type&&a[2].sliceSerialize(a[1],!0).length>=4?t(s):Dr(s)?i(s):n(s)}},partial:!0},_At={name:"headingAtx",tokenize:function CAt(e,t,n){let r=0;return function i(u){return e.enter("atxHeading"),function o(u){return e.enter("atxHeadingSequence"),s(u)}(u)};function s(u){return 35===u&&r++<6?(e.consume(u),s):null===u||zd(u)?(e.exit("atxHeadingSequence"),a(u)):n(u)}function a(u){return 35===u?(e.enter("atxHeadingSequence"),l(u)):null===u||Dr(u)?(e.exit("atxHeading"),t(u)):wo(u)?_s(e,a,"whitespace")(u):(e.enter("atxHeadingText"),c(u))}function l(u){return 35===u?(e.consume(u),l):(e.exit("atxHeadingSequence"),a(u))}function c(u){return null===u||35===u||zd(u)?(e.exit("atxHeadingText"),a(u)):(e.consume(u),c)}},resolve:function SAt(e,t){let i,o,n=e.length-2,r=3;return"whitespace"===e[r][1].type&&(r+=2),n-2>r&&"whitespace"===e[n][1].type&&(n-=2),"atxHeadingSequence"===e[n][1].type&&(r===n-1||n-4>r&&"whitespace"===e[n-2][1].type)&&(n-=r+1===n?2:4),n>r&&(i={type:"atxHeadingText",start:e[r][1].start,end:e[n][1].end},o={type:"chunkText",start:e[r][1].start,end:e[n][1].end,contentType:"text"},Wg(e,r,n-r+1,[["enter",i,t],["enter",o,t],["exit",o,t],["exit",i,t]])),e}},E_e={name:"setextUnderline",tokenize:function AAt(e,t,n){const r=this;let i;return function o(c){let d,u=r.events.length;for(;u--;)if("lineEnding"!==r.events[u][1].type&&"linePrefix"!==r.events[u][1].type&&"content"!==r.events[u][1].type){d="paragraph"===r.events[u][1].type;break}return r.parser.lazy[r.now().line]||!r.interrupt&&!d?n(c):(e.enter("setextHeadingLine"),i=c,function s(c){return e.enter("setextHeadingLineSequence"),a(c)}(c))};function a(c){return c===i?(e.consume(c),a):(e.exit("setextHeadingLineSequence"),wo(c)?_s(e,l,"lineSuffix")(c):l(c))}function l(c){return null===c||Dr(c)?(e.exit("setextHeadingLine"),t(c)):n(c)}},resolveTo:function wAt(e,t){let r,i,o,n=e.length;for(;n--;)if("enter"===e[n][0]){if("content"===e[n][1].type){r=n;break}"paragraph"===e[n][1].type&&(i=n)}else"content"===e[n][1].type&&e.splice(n,1),!o&&"definition"===e[n][1].type&&(o=n);const s={type:"setextHeading",start:Object.assign({},e[i][1].start),end:Object.assign({},e[e.length-1][1].end)};return e[i][1].type="setextHeadingText",o?(e.splice(i,0,["enter",s,t]),e.splice(o+1,0,["exit",e[r][1],t]),e[r][1].end=Object.assign({},e[o][1].end)):e[r][1]=s,e.push(["exit",s,t]),e}},IAt=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],T_e=["pre","script","style","textarea"],EAt={name:"htmlFlow",tokenize:function kAt(e,t,n){const r=this;let i,o,s,a,l;return function c(K){return function u(K){return e.enter("htmlFlow"),e.enter("htmlFlowData"),e.consume(K),d}(K)};function d(K){return 33===K?(e.consume(K),f):47===K?(e.consume(K),o=!0,h):63===K?(e.consume(K),i=3,r.interrupt?t:H):$g(K)?(e.consume(K),s=String.fromCharCode(K),g):n(K)}function f(K){return 45===K?(e.consume(K),i=2,p):91===K?(e.consume(K),i=5,a=0,m):$g(K)?(e.consume(K),i=4,r.interrupt?t:H):n(K)}function p(K){return 45===K?(e.consume(K),r.interrupt?t:H):n(K)}function m(K){return K==="CDATA[".charCodeAt(a++)?(e.consume(K),6===a?r.interrupt?t:R:m):n(K)}function h(K){return $g(K)?(e.consume(K),s=String.fromCharCode(K),g):n(K)}function g(K){if(null===K||47===K||62===K||zd(K)){const Q=47===K,G=s.toLowerCase();return Q||o||!T_e.includes(G)?IAt.includes(s.toLowerCase())?(i=6,Q?(e.consume(K),y):r.interrupt?t(K):R(K)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(K):o?v(K):x(K)):(i=1,r.interrupt?t(K):R(K))}return 45===K||jf(K)?(e.consume(K),s+=String.fromCharCode(K),g):n(K)}function y(K){return 62===K?(e.consume(K),r.interrupt?t:R):n(K)}function v(K){return wo(K)?(e.consume(K),v):T(K)}function x(K){return 47===K?(e.consume(K),T):58===K||95===K||$g(K)?(e.consume(K),_):wo(K)?(e.consume(K),x):T(K)}function _(K){return 45===K||46===K||58===K||95===K||jf(K)?(e.consume(K),_):w(K)}function w(K){return 61===K?(e.consume(K),A):wo(K)?(e.consume(K),w):x(K)}function A(K){return null===K||60===K||61===K||62===K||96===K?n(K):34===K||39===K?(e.consume(K),l=K,M):wo(K)?(e.consume(K),A):E(K)}function M(K){return K===l?(e.consume(K),l=null,D):null===K||Dr(K)?n(K):(e.consume(K),M)}function E(K){return null===K||34===K||39===K||47===K||60===K||61===K||62===K||96===K||zd(K)?w(K):(e.consume(K),E)}function D(K){return 47===K||62===K||wo(K)?x(K):n(K)}function T(K){return 62===K?(e.consume(K),F):n(K)}function F(K){return null===K||Dr(K)?R(K):wo(K)?(e.consume(K),F):n(K)}function R(K){return 45===K&&2===i?(e.consume(K),z):60===K&&1===i?(e.consume(K),$):62===K&&4===i?(e.consume(K),oe):63===K&&3===i?(e.consume(K),H):93===K&&5===i?(e.consume(K),X):!Dr(K)||6!==i&&7!==i?null===K||Dr(K)?(e.exit("htmlFlowData"),N(K)):(e.consume(K),R):(e.exit("htmlFlowData"),e.check(TAt,te,N)(K))}function N(K){return e.check(DAt,j,te)(K)}function j(K){return e.enter("lineEnding"),e.consume(K),e.exit("lineEnding"),W}function W(K){return null===K||Dr(K)?N(K):(e.enter("htmlFlowData"),R(K))}function z(K){return 45===K?(e.consume(K),H):R(K)}function $(K){return 47===K?(e.consume(K),s="",V):R(K)}function V(K){if(62===K){const Q=s.toLowerCase();return T_e.includes(Q)?(e.consume(K),oe):R(K)}return $g(K)&&s.length<8?(e.consume(K),s+=String.fromCharCode(K),V):R(K)}function X(K){return 93===K?(e.consume(K),H):R(K)}function H(K){return 62===K?(e.consume(K),oe):45===K&&2===i?(e.consume(K),H):R(K)}function oe(K){return null===K||Dr(K)?(e.exit("htmlFlowData"),te(K)):(e.consume(K),oe)}function te(K){return e.exit("htmlFlow"),t(K)}},resolveTo:function PAt(e){let t=e.length;for(;t--&&("enter"!==e[t][0]||"htmlFlow"!==e[t][1].type););return t>1&&"linePrefix"===e[t-2][1].type&&(e[t][1].start=e[t-2][1].start,e[t+1][1].start=e[t-2][1].start,e.splice(t-2,2)),e},concrete:!0},TAt={tokenize:function RAt(e,t,n){return function r(i){return e.enter("lineEnding"),e.consume(i),e.exit("lineEnding"),e.attempt(uB,t,n)}},partial:!0},DAt={tokenize:function MAt(e,t,n){const r=this;return function i(s){return Dr(s)?(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),o):n(s)};function o(s){return r.parser.lazy[r.now().line]?n(s):t(s)}},partial:!0},D_e={tokenize:function FAt(e,t,n){const r=this;return function i(s){return null===s?n(s):(e.enter("lineEnding"),e.consume(s),e.exit("lineEnding"),o)};function o(s){return r.parser.lazy[r.now().line]?n(s):t(s)}},partial:!0},P_e={name:"codeFenced",tokenize:function NAt(e,t,n){const r=this,i={tokenize:function w(A,M,E){let D=0;return function T(W){return A.enter("lineEnding"),A.consume(W),A.exit("lineEnding"),F};function F(W){return A.enter("codeFencedFence"),wo(W)?_s(A,R,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(W):R(W)}function R(W){return W===a?(A.enter("codeFencedFenceSequence"),N(W)):E(W)}function N(W){return W===a?(D++,A.consume(W),N):D>=s?(A.exit("codeFencedFenceSequence"),wo(W)?_s(A,j,"whitespace")(W):j(W)):E(W)}function j(W){return null===W||Dr(W)?(A.exit("codeFencedFence"),M(W)):E(W)}},partial:!0};let a,o=0,s=0;return function l(A){return function c(A){const M=r.events[r.events.length-1];return o=M&&"linePrefix"===M[1].type?M[2].sliceSerialize(M[1],!0).length:0,a=A,e.enter("codeFenced"),e.enter("codeFencedFence"),e.enter("codeFencedFenceSequence"),u(A)}(A)};function u(A){return A===a?(s++,e.consume(A),u):s<3?n(A):(e.exit("codeFencedFenceSequence"),wo(A)?_s(e,d,"whitespace")(A):d(A))}function d(A){return null===A||Dr(A)?(e.exit("codeFencedFence"),r.interrupt?t(A):e.check(D_e,h,_)(A)):(e.enter("codeFencedFenceInfo"),e.enter("chunkString",{contentType:"string"}),f(A))}function f(A){return null===A||Dr(A)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),d(A)):wo(A)?(e.exit("chunkString"),e.exit("codeFencedFenceInfo"),_s(e,p,"whitespace")(A)):96===A&&A===a?n(A):(e.consume(A),f)}function p(A){return null===A||Dr(A)?d(A):(e.enter("codeFencedFenceMeta"),e.enter("chunkString",{contentType:"string"}),m(A))}function m(A){return null===A||Dr(A)?(e.exit("chunkString"),e.exit("codeFencedFenceMeta"),d(A)):96===A&&A===a?n(A):(e.consume(A),m)}function h(A){return e.attempt(i,_,g)(A)}function g(A){return e.enter("lineEnding"),e.consume(A),e.exit("lineEnding"),y}function y(A){return o>0&&wo(A)?_s(e,v,"linePrefix",o+1)(A):v(A)}function v(A){return null===A||Dr(A)?e.check(D_e,h,_)(A):(e.enter("codeFlowValue"),x(A))}function x(A){return null===A||Dr(A)?(e.exit("codeFlowValue"),v(A)):(e.consume(A),x)}function _(A){return e.exit("codeFenced"),t(A)}},concrete:!0},k_e=document.createElement("i");function vX(e){const t="&"+e+";";k_e.innerHTML=t;const n=k_e.textContent;return(59!==n.charCodeAt(n.length-1)||"semi"===e)&&n!==t&&n}const M_e={name:"characterReference",tokenize:function OAt(e,t,n){const r=this;let o,s,i=0;return function a(d){return e.enter("characterReference"),e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),l};function l(d){return 35===d?(e.enter("characterReferenceMarkerNumeric"),e.consume(d),e.exit("characterReferenceMarkerNumeric"),c):(e.enter("characterReferenceValue"),o=31,s=jf,u(d))}function c(d){return 88===d||120===d?(e.enter("characterReferenceMarkerHexadecimal"),e.consume(d),e.exit("characterReferenceMarkerHexadecimal"),e.enter("characterReferenceValue"),o=6,s=Rwt,u):(e.enter("characterReferenceValue"),o=7,s=gX,u(d))}function u(d){if(59===d&&i){const f=e.exit("characterReferenceValue");return s!==jf||vX(r.sliceSerialize(f))?(e.enter("characterReferenceMarker"),e.consume(d),e.exit("characterReferenceMarker"),e.exit("characterReference"),t):n(d)}return s(d)&&i++<o?(e.consume(d),u):n(d)}}},R_e={name:"characterEscape",tokenize:function BAt(e,t,n){return function r(o){return e.enter("characterEscape"),e.enter("escapeMarker"),e.consume(o),e.exit("escapeMarker"),i};function i(o){return Nwt(o)?(e.enter("characterEscapeValue"),e.consume(o),e.exit("characterEscapeValue"),e.exit("characterEscape"),t):n(o)}}},xX={name:"lineEnding",tokenize:function LAt(e,t){return function n(r){return e.enter("lineEnding"),e.consume(r),e.exit("lineEnding"),_s(e,t,"linePrefix")}}},_X={name:"labelEnd",tokenize:function GAt(e,t,n){const r=this;let o,s,i=r.events.length;for(;i--;)if(("labelImage"===r.events[i][1].type||"labelLink"===r.events[i][1].type)&&!r.events[i][1]._balanced){o=r.events[i][1];break}return function a(f){return o?o._inactive?d(f):(s=r.parser.defined.includes(SI(r.sliceSerialize({start:o.end,end:r.now()}))),e.enter("labelEnd"),e.enter("labelMarker"),e.consume(f),e.exit("labelMarker"),e.exit("labelEnd"),l):n(f)};function l(f){return 40===f?e.attempt(jAt,u,s?u:d)(f):91===f?e.attempt(UAt,u,s?c:d)(f):s?u(f):d(f)}function c(f){return e.attempt(zAt,u,d)(f)}function u(f){return t(f)}function d(f){return o._balanced=!0,n(f)}},resolveTo:function HAt(e,t){let i,o,s,a,n=e.length,r=0;for(;n--;)if(i=e[n][1],o){if("link"===i.type||"labelLink"===i.type&&i._inactive)break;"enter"===e[n][0]&&"labelLink"===i.type&&(i._inactive=!0)}else if(s){if("enter"===e[n][0]&&("labelImage"===i.type||"labelLink"===i.type)&&!i._balanced&&(o=n,"labelLink"!==i.type)){r=2;break}}else"labelEnd"===i.type&&(s=n);const l={type:"labelLink"===e[o][1].type?"link":"image",start:Object.assign({},e[o][1].start),end:Object.assign({},e[e.length-1][1].end)},c={type:"label",start:Object.assign({},e[o][1].start),end:Object.assign({},e[s][1].end)},u={type:"labelText",start:Object.assign({},e[o+r+2][1].end),end:Object.assign({},e[s-2][1].start)};return a=[["enter",l,t],["enter",c,t]],a=nh(a,e.slice(o+1,o+r+3)),a=nh(a,[["enter",u,t]]),a=nh(a,yX(t.parser.constructs.insideSpan.null,e.slice(o+r+4,s-3),t)),a=nh(a,[["exit",u,t],e[s-2],e[s-1],["exit",c,t]]),a=nh(a,e.slice(s+1)),a=nh(a,[["exit",l,t]]),Wg(e,o,e.length,a),e},resolveAll:function VAt(e){let t=-1;for(;++t<e.length;){const n=e[t][1];("labelImage"===n.type||"labelLink"===n.type||"labelEnd"===n.type)&&(e.splice(t+1,"labelImage"===n.type?4:2),n.type="data",t++)}return e}},jAt={tokenize:function qAt(e,t,n){return function r(d){return e.enter("resource"),e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),i};function i(d){return zd(d)?rk(e,o)(d):o(d)}function o(d){return 41===d?u(d):w_e(e,s,a,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function s(d){return zd(d)?rk(e,l)(d):u(d)}function a(d){return n(d)}function l(d){return 34===d||39===d||40===d?I_e(e,c,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):u(d)}function c(d){return zd(d)?rk(e,u)(d):u(d)}function u(d){return 41===d?(e.enter("resourceMarker"),e.consume(d),e.exit("resourceMarker"),e.exit("resource"),t):n(d)}}},UAt={tokenize:function WAt(e,t,n){const r=this;return function i(a){return A_e.call(r,e,o,s,"reference","referenceMarker","referenceString")(a)};function o(a){return r.parser.defined.includes(SI(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?t(a):n(a)}function s(a){return n(a)}}},zAt={tokenize:function $At(e,t,n){return function r(o){return e.enter("reference"),e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),i};function i(o){return 93===o?(e.enter("referenceMarker"),e.consume(o),e.exit("referenceMarker"),e.exit("reference"),t):n(o)}}},YAt={name:"labelStartImage",tokenize:function XAt(e,t,n){const r=this;return function i(a){return e.enter("labelImage"),e.enter("labelImageMarker"),e.consume(a),e.exit("labelImageMarker"),o};function o(a){return 91===a?(e.enter("labelMarker"),e.consume(a),e.exit("labelMarker"),e.exit("labelImage"),s):n(a)}function s(a){return 94===a&&"_hiddenFootnoteSupport"in r.parser.constructs?n(a):t(a)}},resolveAll:_X.resolveAll};function N_e(e){return null===e||zd(e)||Owt(e)?1:Fwt(e)?2:void 0}const SX={name:"attention",tokenize:function ZAt(e,t){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=N_e(r);let o;return function s(l){return o=l,e.enter("attentionSequence"),a(l)};function a(l){if(l===o)return e.consume(l),a;const c=e.exit("attentionSequence"),u=N_e(l),d=!u||2===u&&i||n.includes(l),f=!i||2===i&&u||n.includes(r);return c._open=!!(42===o?d:d&&(i||!f)),c._close=!!(42===o?f:f&&(u||!d)),t(l)}},resolveAll:function KAt(e,t){let r,i,o,s,a,l,c,u,n=-1;for(;++n<e.length;)if("enter"===e[n][0]&&"attentionSequence"===e[n][1].type&&e[n][1]._close)for(r=n;r--;)if("exit"===e[r][0]&&"attentionSequence"===e[r][1].type&&e[r][1]._open&&t.sliceSerialize(e[r][1]).charCodeAt(0)===t.sliceSerialize(e[n][1]).charCodeAt(0)){if((e[r][1]._close||e[n][1]._open)&&(e[n][1].end.offset-e[n][1].start.offset)%3&&!((e[r][1].end.offset-e[r][1].start.offset+e[n][1].end.offset-e[n][1].start.offset)%3))continue;l=e[r][1].end.offset-e[r][1].start.offset>1&&e[n][1].end.offset-e[n][1].start.offset>1?2:1;const d=Object.assign({},e[r][1].end),f=Object.assign({},e[n][1].start);F_e(d,-l),F_e(f,l),s={type:l>1?"strongSequence":"emphasisSequence",start:d,end:Object.assign({},e[r][1].end)},a={type:l>1?"strongSequence":"emphasisSequence",start:Object.assign({},e[n][1].start),end:f},o={type:l>1?"strongText":"emphasisText",start:Object.assign({},e[r][1].end),end:Object.assign({},e[n][1].start)},i={type:l>1?"strong":"emphasis",start:Object.assign({},s.start),end:Object.assign({},a.end)},e[r][1].end=Object.assign({},s.start),e[n][1].start=Object.assign({},a.end),c=[],e[r][1].end.offset-e[r][1].start.offset&&(c=nh(c,[["enter",e[r][1],t],["exit",e[r][1],t]])),c=nh(c,[["enter",i,t],["enter",s,t],["exit",s,t],["enter",o,t]]),c=nh(c,yX(t.parser.constructs.insideSpan.null,e.slice(r+1,n),t)),c=nh(c,[["exit",o,t],["enter",a,t],["exit",a,t],["exit",i,t]]),e[n][1].end.offset-e[n][1].start.offset?(u=2,c=nh(c,[["enter",e[n][1],t],["exit",e[n][1],t]])):u=0,Wg(e,r-1,n-r+3,c),n=r+c.length-u-2;break}for(n=-1;++n<e.length;)"attentionSequence"===e[n][1].type&&(e[n][1].type="data");return e}};function F_e(e,t){e.column+=t,e.offset+=t,e._bufferIndex+=t}const QAt={name:"autolink",tokenize:function JAt(e,t,n){let r=0;return function i(p){return e.enter("autolink"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.enter("autolinkProtocol"),o};function o(p){return $g(p)?(e.consume(p),s):c(p)}function s(p){return 43===p||45===p||46===p||jf(p)?(r=1,a(p)):c(p)}function a(p){return 58===p?(e.consume(p),r=0,l):(43===p||45===p||46===p||jf(p))&&r++<32?(e.consume(p),a):(r=0,c(p))}function l(p){return 62===p?(e.exit("autolinkProtocol"),e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):null===p||32===p||60===p||mX(p)?n(p):(e.consume(p),l)}function c(p){return 64===p?(e.consume(p),u):Mwt(p)?(e.consume(p),c):n(p)}function u(p){return jf(p)?d(p):n(p)}function d(p){return 46===p?(e.consume(p),r=0,u):62===p?(e.exit("autolinkProtocol").type="autolinkEmail",e.enter("autolinkMarker"),e.consume(p),e.exit("autolinkMarker"),e.exit("autolink"),t):f(p)}function f(p){if((45===p||jf(p))&&r++<63){const m=45===p?f:d;return e.consume(p),m}return n(p)}}},eIt={name:"htmlText",tokenize:function tIt(e,t,n){const r=this;let i,o,s;return function a(H){return e.enter("htmlText"),e.enter("htmlTextData"),e.consume(H),l};function l(H){return 33===H?(e.consume(H),c):47===H?(e.consume(H),w):63===H?(e.consume(H),x):$g(H)?(e.consume(H),E):n(H)}function c(H){return 45===H?(e.consume(H),u):91===H?(e.consume(H),o=0,m):$g(H)?(e.consume(H),v):n(H)}function u(H){return 45===H?(e.consume(H),p):n(H)}function d(H){return null===H?n(H):45===H?(e.consume(H),f):Dr(H)?(s=d,$(H)):(e.consume(H),d)}function f(H){return 45===H?(e.consume(H),p):d(H)}function p(H){return 62===H?z(H):45===H?f(H):d(H)}function m(H){return H==="CDATA[".charCodeAt(o++)?(e.consume(H),6===o?h:m):n(H)}function h(H){return null===H?n(H):93===H?(e.consume(H),g):Dr(H)?(s=h,$(H)):(e.consume(H),h)}function g(H){return 93===H?(e.consume(H),y):h(H)}function y(H){return 62===H?z(H):93===H?(e.consume(H),y):h(H)}function v(H){return null===H||62===H?z(H):Dr(H)?(s=v,$(H)):(e.consume(H),v)}function x(H){return null===H?n(H):63===H?(e.consume(H),_):Dr(H)?(s=x,$(H)):(e.consume(H),x)}function _(H){return 62===H?z(H):x(H)}function w(H){return $g(H)?(e.consume(H),A):n(H)}function A(H){return 45===H||jf(H)?(e.consume(H),A):M(H)}function M(H){return Dr(H)?(s=M,$(H)):wo(H)?(e.consume(H),M):z(H)}function E(H){return 45===H||jf(H)?(e.consume(H),E):47===H||62===H||zd(H)?D(H):n(H)}function D(H){return 47===H?(e.consume(H),z):58===H||95===H||$g(H)?(e.consume(H),T):Dr(H)?(s=D,$(H)):wo(H)?(e.consume(H),D):z(H)}function T(H){return 45===H||46===H||58===H||95===H||jf(H)?(e.consume(H),T):F(H)}function F(H){return 61===H?(e.consume(H),R):Dr(H)?(s=F,$(H)):wo(H)?(e.consume(H),F):D(H)}function R(H){return null===H||60===H||61===H||62===H||96===H?n(H):34===H||39===H?(e.consume(H),i=H,N):Dr(H)?(s=R,$(H)):wo(H)?(e.consume(H),R):(e.consume(H),j)}function N(H){return H===i?(e.consume(H),i=void 0,W):null===H?n(H):Dr(H)?(s=N,$(H)):(e.consume(H),N)}function j(H){return null===H||34===H||39===H||60===H||61===H||96===H?n(H):47===H||62===H||zd(H)?D(H):(e.consume(H),j)}function W(H){return 47===H||62===H||zd(H)?D(H):n(H)}function z(H){return 62===H?(e.consume(H),e.exit("htmlTextData"),e.exit("htmlText"),t):n(H)}function $(H){return e.exit("htmlTextData"),e.enter("lineEnding"),e.consume(H),e.exit("lineEnding"),V}function V(H){return wo(H)?_s(e,X,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(H):X(H)}function X(H){return e.enter("htmlTextData"),s(H)}}},nIt={name:"labelStartLink",tokenize:function rIt(e,t,n){const r=this;return function i(s){return e.enter("labelLink"),e.enter("labelMarker"),e.consume(s),e.exit("labelMarker"),e.exit("labelLink"),o};function o(s){return 94===s&&"_hiddenFootnoteSupport"in r.parser.constructs?n(s):t(s)}},resolveAll:_X.resolveAll},iIt={name:"hardBreakEscape",tokenize:function oIt(e,t,n){return function r(o){return e.enter("hardBreakEscape"),e.consume(o),i};function i(o){return Dr(o)?(e.exit("hardBreakEscape"),t(o)):n(o)}}},sIt={name:"codeText",tokenize:function cIt(e,t,n){let o,s,i=0;return function a(f){return e.enter("codeText"),e.enter("codeTextSequence"),l(f)};function l(f){return 96===f?(e.consume(f),i++,l):(e.exit("codeTextSequence"),c(f))}function c(f){return null===f?n(f):32===f?(e.enter("space"),e.consume(f),e.exit("space"),c):96===f?(s=e.enter("codeTextSequence"),o=0,d(f)):Dr(f)?(e.enter("lineEnding"),e.consume(f),e.exit("lineEnding"),c):(e.enter("codeTextData"),u(f))}function u(f){return null===f||32===f||96===f||Dr(f)?(e.exit("codeTextData"),c(f)):(e.consume(f),u)}function d(f){return 96===f?(e.consume(f),o++,d):o===i?(e.exit("codeTextSequence"),e.exit("codeText"),t(f)):(s.type="codeTextData",u(f))}},resolve:function aIt(e){let r,i,t=e.length-4,n=3;if(!("lineEnding"!==e[n][1].type&&"space"!==e[n][1].type||"lineEnding"!==e[t][1].type&&"space"!==e[t][1].type))for(r=n;++r<t;)if("codeTextData"===e[r][1].type){e[n][1].type="codeTextPadding",e[t][1].type="codeTextPadding",n+=2,t-=2;break}for(r=n-1,t++;++r<=t;)void 0===i?r!==t&&"lineEnding"!==e[r][1].type&&(i=r):(r===t||"lineEnding"===e[r][1].type)&&(e[i][1].type="codeTextData",r!==i+2&&(e[i][1].end=e[r-1][1].end,e.splice(i+2,r-i-2),t-=r-i-2,r=i+2),i=void 0);return e},previous:function lIt(e){return 96!==e||"characterEscape"===this.events[this.events.length-1][1].type}},uIt={42:Vd,43:Vd,45:Vd,48:Vd,49:Vd,50:Vd,51:Vd,52:Vd,53:Vd,54:Vd,55:Vd,56:Vd,57:Vd,62:C_e},dIt={91:hAt},fIt={[-2]:bX,[-1]:bX,32:bX},pIt={35:_At,42:dB,45:[E_e,dB],60:EAt,61:E_e,95:dB,96:P_e,126:P_e},hIt={38:M_e,92:R_e},mIt={[-5]:xX,[-4]:xX,[-3]:xX,33:YAt,38:M_e,42:SX,60:[QAt,eIt],91:nIt,92:[iIt,R_e],93:_X,95:SX,96:sIt},gIt={null:[SX,Kwt]},yIt={null:[42,95]},bIt={null:[]};function vIt(e){const n=function Twt(e){const t={};let n=-1;for(;++n<e.length;)Dwt(t,e[n]);return t}([Al,...(e||{}).extensions||[]]),r={defined:[],lazy:{},constructs:n,content:i(Bwt),document:i(jwt),flow:i(Ywt),string:i(Zwt),text:i(Qwt)};return r;function i(o){return function s(a){return function eAt(e,t,n){let r=Object.assign(n?Object.assign({},n):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const i={},o=[];let s=[],a=[],l=!0;const c={consume:function _(N){Dr(N)?(r.line++,r.column=1,r.offset+=-3===N?2:1,R()):-1!==N&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=N,l=!0},enter:function w(N,j){const W=j||{};return W.type=N,W.start=g(),u.events.push(["enter",W,u]),a.push(W),W},exit:function A(N){const j=a.pop();return j.end=g(),u.events.push(["exit",j,u]),j},attempt:D(function M(N,j){T(N,j.from)}),check:D(E),interrupt:D(E,{interrupt:!0})},u={previous:null,code:null,containerState:{},events:[],parser:e,sliceStream:h,sliceSerialize:function m(N,j){return function nAt(e,t){let n=-1;const r=[];let i;for(;++n<e.length;){const o=e[n];let s;if("string"==typeof o)s=o;else switch(o){case-5:s="\r";break;case-4:s="\n";break;case-3:s="\r\n";break;case-2:s=t?" ":"\t";break;case-1:if(!t&&i)continue;s=" ";break;default:s=String.fromCharCode(o)}i=-2===o,r.push(s)}return r.join("")}(h(N),j)},now:g,defineSkip:function y(N){i[N.line]=N.column,R()},write:function p(N){return s=nh(s,N),function v(){let N;for(;r._index<s.length;){const j=s[r._index];if("string"==typeof j)for(N=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===N&&r._bufferIndex<j.length;)x(j.charCodeAt(r._bufferIndex));else x(j)}}(),null!==s[s.length-1]?[]:(T(t,0),u.events=yX(o,u.events,u),u.events)}};let f,d=t.tokenize.call(u,c);return t.resolveAll&&o.push(t),u;function h(N){return function tAt(e,t){const n=t.start._index,r=t.start._bufferIndex,i=t.end._index,o=t.end._bufferIndex;let s;if(n===i)s=[e[n].slice(r,o)];else{if(s=e.slice(n,i),r>-1){const a=s[0];"string"==typeof a?s[0]=a.slice(r):s.shift()}o>0&&s.push(e[i].slice(0,o))}return s}(s,N)}function g(){const{line:N,column:j,offset:W,_index:z,_bufferIndex:$}=r;return{line:N,column:j,offset:W,_index:z,_bufferIndex:$}}function x(N){l=void 0,f=N,d=d(N)}function E(N,j){j.restore()}function D(N,j){return function W(z,$,V){let X,H,oe,te;return Array.isArray(z)?Q(z):"tokenize"in z?Q([z]):function K(se){return function xe(re){const ae=null!==re&&se[re],ge=null!==re&&se.null;return Q([...Array.isArray(ae)?ae:ae?[ae]:[],...Array.isArray(ge)?ge:ge?[ge]:[]])(re)}}(z);function Q(se){return X=se,H=0,0===se.length?V:G(se[H])}function G(se){return function xe(re){return te=function F(){const N=g(),j=u.previous,W=u.currentConstruct,z=u.events.length,$=Array.from(a);return{restore:function V(){r=N,u.previous=j,u.currentConstruct=W,u.events.length=z,a=$,R()},from:z}}(),oe=se,se.partial||(u.currentConstruct=se),se.name&&u.parser.constructs.disable.null.includes(se.name)?ee():se.tokenize.call(j?Object.assign(Object.create(u),j):u,c,Z,ee)(re)}}function Z(se){return l=!0,N(oe,te),$}function ee(se){return l=!0,te.restore(),++H<X.length?G(X[H]):V}}}function T(N,j){N.resolveAll&&!o.includes(N)&&o.push(N),N.resolve&&Wg(u.events,j,u.events.length-j,N.resolve(u.events.slice(j),u)),N.resolveTo&&(u.events=N.resolveTo(u.events,u))}function R(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}(r,o,a)}}}const O_e=/[\0\t\n\r]/g;function B_e(e,t){const n=Number.parseInt(e,t);return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||!(65535&~n)||65534==(65535&n)||n>1114111?"\ufffd":String.fromCodePoint(n)}const _It=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function CIt(e,t,n){if(t)return t;if(35===n.charCodeAt(0)){const i=n.charCodeAt(1),o=120===i||88===i;return B_e(n.slice(o?2:1),o?16:10)}return vX(n)||e}const L_e={}.hasOwnProperty;function wIt(e,t,n){return"string"!=typeof t&&(n=t,t=void 0),function AIt(e){const t={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:o(ue),autolinkProtocol:D,autolinkEmail:D,atxHeading:o(me),blockQuote:o(function xe(){return{type:"blockquote",children:[]}}),characterEscape:D,characterReference:D,codeFenced:o(re),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:o(re,s),codeText:o(function ae(){return{type:"inlineCode",value:""}},s),codeTextData:D,data:D,codeFlowValue:D,definition:o(function ge(){return{type:"definition",identifier:"",label:null,title:null,url:""}}),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:o(function Ie(){return{type:"emphasis",children:[]}}),hardBreakEscape:o(Ae),hardBreakTrailing:o(Ae),htmlFlow:o(he,s),htmlFlowData:D,htmlText:o(he,s),htmlTextData:D,image:o(function ie(){return{type:"image",title:null,url:"",alt:null}}),label:s,link:o(ue),listItem:o(function Fe(be){return{type:"listItem",spread:be._spread,checked:null,children:[]}}),listItemValue:function f(be){this.data.expectingFirstListItemValue&&(this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(be),10),this.data.expectingFirstListItemValue=void 0)},listOrdered:o(_e,function d(){this.data.expectingFirstListItemValue=!0}),listUnordered:o(_e),paragraph:o(function Ze(){return{type:"paragraph",children:[]}}),reference:function K(){this.data.referenceType="collapsed"},referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:o(me),strong:o(function ct(){return{type:"strong",children:[]}}),thematicBreak:o(function ne(){return{type:"thematicBreak"}})},exit:{atxHeading:l(),atxHeadingSequence:function w(be){const Ce=this.stack[this.stack.length-1];if(!Ce.depth){const Re=this.sliceSerialize(be).length;Ce.depth=Re}},autolink:l(),autolinkEmail:function se(be){T.call(this,be),this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(be)},autolinkProtocol:function ee(be){T.call(this,be),this.stack[this.stack.length-1].url=this.sliceSerialize(be)},blockQuote:l(),characterEscapeValue:T,characterReferenceMarkerHexadecimal:G,characterReferenceMarkerNumeric:G,characterReferenceValue:function Z(be){const Ce=this.sliceSerialize(be),Re=this.data.characterReferenceType;let Be;Re?(Be=B_e(Ce,"characterReferenceMarkerNumeric"===Re?10:16),this.data.characterReferenceType=void 0):Be=vX(Ce);const $e=this.stack.pop();$e.value+=Be,$e.position.end=Cv(be.end)},codeFenced:l(function g(){const be=this.resume();this.stack[this.stack.length-1].value=be.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}),codeFencedFence:function h(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)},codeFencedFenceInfo:function p(){const be=this.resume();this.stack[this.stack.length-1].lang=be},codeFencedFenceMeta:function m(){const be=this.resume();this.stack[this.stack.length-1].meta=be},codeFlowValue:T,codeIndented:l(function y(){const be=this.resume();this.stack[this.stack.length-1].value=be.replace(/(\r?\n|\r)$/g,"")}),codeText:l(function W(){const be=this.resume();this.stack[this.stack.length-1].value=be}),codeTextData:T,data:T,definition:l(),definitionDestinationString:function _(){const be=this.resume();this.stack[this.stack.length-1].url=be},definitionLabelString:function v(be){const Ce=this.resume(),Re=this.stack[this.stack.length-1];Re.label=Ce,Re.identifier=SI(this.sliceSerialize(be)).toLowerCase()},definitionTitleString:function x(){const be=this.resume();this.stack[this.stack.length-1].title=be},emphasis:l(),hardBreakEscape:l(R),hardBreakTrailing:l(R),htmlFlow:l(function N(){const be=this.resume();this.stack[this.stack.length-1].value=be}),htmlFlowData:T,htmlText:l(function j(){const be=this.resume();this.stack[this.stack.length-1].value=be}),htmlTextData:T,image:l(function $(){const be=this.stack[this.stack.length-1];if(this.data.inReference){const Ce=this.data.referenceType||"shortcut";be.type+="Reference",be.referenceType=Ce,delete be.url,delete be.title}else delete be.identifier,delete be.label;this.data.referenceType=void 0}),label:function X(){const be=this.stack[this.stack.length-1],Ce=this.resume(),Re=this.stack[this.stack.length-1];this.data.inReference=!0,"link"===Re.type?Re.children=be.children:Re.alt=Ce},labelText:function V(be){const Ce=this.sliceSerialize(be),Re=this.stack[this.stack.length-2];Re.label=function SIt(e){return e.replace(_It,CIt)}(Ce),Re.identifier=SI(Ce).toLowerCase()},lineEnding:function F(be){const Ce=this.stack[this.stack.length-1];if(this.data.atHardBreak)return Ce.children[Ce.children.length-1].position.end=Cv(be.end),void(this.data.atHardBreak=void 0);!this.data.setextHeadingSlurpLineEnding&&t.canContainEols.includes(Ce.type)&&(D.call(this,be),T.call(this,be))},link:l(function z(){const be=this.stack[this.stack.length-1];if(this.data.inReference){const Ce=this.data.referenceType||"shortcut";be.type+="Reference",be.referenceType=Ce,delete be.url,delete be.title}else delete be.identifier,delete be.label;this.data.referenceType=void 0}),listItem:l(),listOrdered:l(),listUnordered:l(),paragraph:l(),referenceString:function Q(be){const Ce=this.resume(),Re=this.stack[this.stack.length-1];Re.label=Ce,Re.identifier=SI(this.sliceSerialize(be)).toLowerCase(),this.data.referenceType="full"},resourceDestinationString:function H(){const be=this.resume();this.stack[this.stack.length-1].url=be},resourceTitleString:function oe(){const be=this.resume();this.stack[this.stack.length-1].title=be},resource:function te(){this.data.inReference=void 0},setextHeading:l(function E(){this.data.setextHeadingSlurpLineEnding=void 0}),setextHeadingLineSequence:function M(be){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(be).codePointAt(0)?1:2},setextHeadingText:function A(){this.data.setextHeadingSlurpLineEnding=!0},strong:l(),thematicBreak:l()}};j_e(t,(e||{}).mdastExtensions||[]);const n={};return function r(be){let Ce={type:"root",children:[]};const Re={stack:[Ce],tokenStack:[],config:t,enter:a,exit:c,buffer:s,resume:u,data:n},Be=[];let $e=-1;for(;++$e<be.length;)"listOrdered"!==be[$e][1].type&&"listUnordered"!==be[$e][1].type||("enter"===be[$e][0]?Be.push($e):$e=i(be,Be.pop(),$e));for($e=-1;++$e<be.length;){const nt=t[be[$e][0]];L_e.call(nt,be[$e][1].type)&&nt[be[$e][1].type].call(Object.assign({sliceSerialize:be[$e][2].sliceSerialize},Re),be[$e][1])}if(Re.tokenStack.length>0){const nt=Re.tokenStack[Re.tokenStack.length-1];(nt[1]||U_e).call(Re,void 0,nt[0])}for(Ce.position={start:Cv(be.length>0?be[0][1].start:{line:1,column:1,offset:0}),end:Cv(be.length>0?be[be.length-2][1].end:{line:1,column:1,offset:0})},$e=-1;++$e<t.transforms.length;)Ce=t.transforms[$e](Ce)||Ce;return Ce};function i(be,Ce,Re){let ht,Ge,ft,vt,Be=Ce-1,$e=-1,nt=!1;for(;++Be<=Re;){const Pt=be[Be];switch(Pt[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===Pt[0]?$e++:$e--,vt=void 0;break;case"lineEndingBlank":"enter"===Pt[0]&&(ht&&!vt&&!$e&&!ft&&(ft=Be),vt=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:vt=void 0}if(!$e&&"enter"===Pt[0]&&"listItemPrefix"===Pt[1].type||-1===$e&&"exit"===Pt[0]&&("listUnordered"===Pt[1].type||"listOrdered"===Pt[1].type)){if(ht){let St=Be;for(Ge=void 0;St--;){const Mt=be[St];if("lineEnding"===Mt[1].type||"lineEndingBlank"===Mt[1].type){if("exit"===Mt[0])continue;Ge&&(be[Ge][1].type="lineEndingBlank",nt=!0),Mt[1].type="lineEnding",Ge=St}else if("linePrefix"!==Mt[1].type&&"blockQuotePrefix"!==Mt[1].type&&"blockQuotePrefixWhitespace"!==Mt[1].type&&"blockQuoteMarker"!==Mt[1].type&&"listItemIndent"!==Mt[1].type)break}ft&&(!Ge||ft<Ge)&&(ht._spread=!0),ht.end=Object.assign({},Ge?be[Ge][1].start:Pt[1].end),be.splice(Ge||Be,0,["exit",ht,Pt[2]]),Be++,Re++}if("listItemPrefix"===Pt[1].type){const St={type:"listItem",_spread:!1,start:Object.assign({},Pt[1].start),end:void 0};ht=St,be.splice(Be,0,["enter",St,Pt[2]]),Be++,Re++,ft=void 0,vt=!0}}}return be[Ce][1]._spread=nt,Re}function o(be,Ce){return function Re(Be){a.call(this,be(Be),Be),Ce&&Ce.call(this,Be)}}function s(){this.stack.push({type:"fragment",children:[]})}function a(be,Ce,Re){this.stack[this.stack.length-1].children.push(be),this.stack.push(be),this.tokenStack.push([Ce,Re]),be.position={start:Cv(Ce.start),end:void 0}}function l(be){return function Ce(Re){be&&be.call(this,Re),c.call(this,Re)}}function c(be,Ce){const Re=this.stack.pop(),Be=this.tokenStack.pop();if(!Be)throw new Error("Cannot close `"+be.type+"` ("+tk({start:be.start,end:be.end})+"): it\u2019s not open");Be[0].type!==be.type&&(Ce?Ce.call(this,be,Be[0]):(Be[1]||U_e).call(this,be,Be[0])),Re.position.end=Cv(be.end)}function u(){return function wwt(e,t){const n=t||Cwt;return y_e(e,"boolean"!=typeof n.includeImageAlt||n.includeImageAlt,"boolean"!=typeof n.includeHtml||n.includeHtml)}(this.stack.pop())}function D(be){const Re=this.stack[this.stack.length-1].children;let Be=Re[Re.length-1];(!Be||"text"!==Be.type)&&(Be={type:"text",value:""},Be.position={start:Cv(be.start),end:void 0},Re.push(Be)),this.stack.push(Be)}function T(be){const Ce=this.stack.pop();Ce.value+=this.sliceSerialize(be),Ce.position.end=Cv(be.end)}function R(){this.data.atHardBreak=!0}function G(be){this.data.characterReferenceType=be.type}function re(){return{type:"code",lang:null,meta:null,value:""}}function me(){return{type:"heading",depth:0,children:[]}}function Ae(){return{type:"break"}}function he(){return{type:"html",value:""}}function ue(){return{type:"link",title:null,url:"",children:[]}}function _e(be){return{type:"list",ordered:"listOrdered"===be.type,start:null,spread:be._spread,children:[]}}}(n)(function Ewt(e){for(;!v_e(e););return e}(vIt(n).document().write(function xIt(){let r,e=1,t="",n=!0;return function i(o,s,a){const l=[];let c,u,d,f,p;for(o=t+("string"==typeof o?o.toString():new TextDecoder(s||void 0).decode(o)),d=0,t="",n&&(65279===o.charCodeAt(0)&&d++,n=void 0);d<o.length;){if(O_e.lastIndex=d,c=O_e.exec(o),f=c&&void 0!==c.index?c.index:o.length,p=o.charCodeAt(f),!c){t=o.slice(d);break}if(10===p&&d===f&&r)l.push(-3),r=void 0;else switch(r&&(l.push(-5),r=void 0),d<f&&(l.push(o.slice(d,f)),e+=f-d),p){case 0:l.push(65533),e++;break;case 9:for(u=4*Math.ceil(e/4),l.push(-2);e++<u;)l.push(-1);break;case 10:l.push(-4),e=1;break;default:r=!0,e=1}d=f+1}return a&&(r&&l.push(-5),t&&l.push(t),l.push(null)),l}}()(e,t,!0))))}function Cv(e){return{line:e.line,column:e.column,offset:e.offset}}function j_e(e,t){let n=-1;for(;++n<t.length;){const r=t[n];Array.isArray(r)?j_e(e,r):IIt(e,r)}}function IIt(e,t){let n;for(n in t)if(L_e.call(t,n))switch(n){case"canContainEols":{const r=t[n];r&&e[n].push(...r);break}case"transforms":{const r=t[n];r&&e[n].push(...r);break}case"enter":case"exit":{const r=t[n];r&&Object.assign(e[n],r);break}}}function U_e(e,t){throw e?new Error("Cannot close `"+e.type+"` ("+tk({start:e.start,end:e.end})+"): a different token (`"+t.type+"`, "+tk({start:t.start,end:t.end})+") is open"):new Error("Cannot close document, a token (`"+t.type+"`, "+tk({start:t.start,end:t.end})+") is still open")}function EIt(e){const t=this;t.parser=function n(r){return wIt(r,{...t.data("settings"),...e,extensions:t.data("micromarkExtensions")||[],mdastExtensions:t.data("fromMarkdownExtensions")||[]})}}const G_e="object"==typeof self?self:globalThis,q_e=e=>((e,t)=>{const n=(i,o)=>(e.set(o,i),i),r=i=>{if(e.has(i))return e.get(i);const[o,s]=t[i];switch(o){case 0:case-1:return n(s,i);case 1:{const a=n([],i);for(const l of s)a.push(r(l));return a}case 2:{const a=n({},i);for(const[l,c]of s)a[r(l)]=r(c);return a}case 3:return n(new Date(s),i);case 4:{const{source:a,flags:l}=s;return n(new RegExp(a,l),i)}case 5:{const a=n(new Map,i);for(const[l,c]of s)a.set(r(l),r(c));return a}case 6:{const a=n(new Set,i);for(const l of s)a.add(r(l));return a}case 7:{const{name:a,message:l}=s;return n(new G_e[a](l),i)}case 8:return n(BigInt(s),i);case"BigInt":return n(Object(BigInt(s)),i)}return n(new G_e[o](s),i)};return r})(new Map,e)(0),{toString:DIt}={},{keys:PIt}=Object,ik=e=>{const t=typeof e;if("object"!==t||!e)return[0,t];const n=DIt.call(e).slice(8,-1);switch(n){case"Array":return[1,""];case"Object":return[2,""];case"Date":return[3,""];case"RegExp":return[4,""];case"Map":return[5,""];case"Set":return[6,""]}return n.includes("Array")?[1,n]:n.includes("Error")?[7,n]:[2,n]},mB=([e,t])=>0===e&&("function"===t||"symbol"===t),W_e=(e,{json:t,lossy:n}={})=>{const r=[];return((e,t,n,r)=>{const i=(s,a)=>{const l=r.push(s)-1;return n.set(a,l),l},o=s=>{if(n.has(s))return n.get(s);let[a,l]=ik(s);switch(a){case 0:{let u=s;switch(l){case"bigint":a=8,u=s.toString();break;case"function":case"symbol":if(e)throw new TypeError("unable to serialize "+l);u=null;break;case"undefined":return i([-1],s)}return i([a,u],s)}case 1:{if(l)return i([l,[...s]],s);const u=[],d=i([a,u],s);for(const f of s)u.push(o(f));return d}case 2:{if(l)switch(l){case"BigInt":return i([l,s.toString()],s);case"Boolean":case"Number":case"String":return i([l,s.valueOf()],s)}if(t&&"toJSON"in s)return o(s.toJSON());const u=[],d=i([a,u],s);for(const f of PIt(s))(e||!mB(ik(s[f])))&&u.push([o(f),o(s[f])]);return d}case 3:return i([a,s.toISOString()],s);case 4:{const{source:u,flags:d}=s;return i([a,{source:u,flags:d}],s)}case 5:{const u=[],d=i([a,u],s);for(const[f,p]of s)(e||!mB(ik(f))&&!mB(ik(p)))&&u.push([o(f),o(p)]);return d}case 6:{const u=[],d=i([a,u],s);for(const f of s)(e||!mB(ik(f)))&&u.push(o(f));return d}}const{message:c}=s;return i([a,{name:l,message:c}],s)};return o})(!(t||n),!!t,new Map,r)(e),r},gB="function"==typeof structuredClone?(e,t)=>t&&("json"in t||"lossy"in t)?q_e(W_e(e,t)):structuredClone(e):(e,t)=>q_e(W_e(e,t));function N2(e){const t=[];let n=-1,r=0,i=0;for(;++n<e.length;){const o=e.charCodeAt(n);let s="";if(37===o&&jf(e.charCodeAt(n+1))&&jf(e.charCodeAt(n+2)))i=2;else if(o<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(o))||(s=String.fromCharCode(o));else if(o>55295&&o<57344){const a=e.charCodeAt(n+1);o<56320&&a>56319&&a<57344?(s=String.fromCharCode(o,a),i=1):s="\ufffd"}else s=String.fromCharCode(o);s&&(t.push(e.slice(r,n),encodeURIComponent(s)),r=n+i+1,s=""),i&&(n+=i,i=0)}return t.join("")+e.slice(r)}function MIt(e,t){const n=[{type:"text",value:"\u21a9"}];return t>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(t)}]}),n}function RIt(e,t){return"Back to reference "+(e+1)+(t>1?"-"+t:"")}const EX=function(e){if(null==e)return jIt;if("function"==typeof e)return yB(e);if("object"==typeof e)return Array.isArray(e)?function OIt(e){const t=[];let n=-1;for(;++n<e.length;)t[n]=EX(e[n]);return yB(function r(...i){let o=-1;for(;++o<t.length;)if(t[o].apply(this,i))return!0;return!1})}(e):function BIt(e){const t=e;return yB(function n(r){const i=r;let o;for(o in e)if(i[o]!==t[o])return!1;return!0})}(e);if("string"==typeof e)return function LIt(e){return yB(function t(n){return n&&n.type===e})}(e);throw new Error("Expected function, string, or object as test")};function yB(e){return function t(n,r,i){return!(!function $_e(e){return null!==e&&"object"==typeof e&&"type"in e}(n)||!e.call(this,n,"number"==typeof r?r:void 0,i||void 0))}}function jIt(){return!0}const Y_e=[],UIt=!0,X_e=!1,zIt="skip";function K_e(e,t,n,r){let i,o,s;"function"==typeof t&&"function"!=typeof n?(o=void 0,s=t,i=n):(o=t,s=n,i=r),function VIt(e,t,n,r){let i;"function"==typeof t&&"function"!=typeof n?(r=n,n=t):i=t;const o=EX(i),s=r?-1:1;!function a(l,c,u){const d=l&&"object"==typeof l?l:{};if("string"==typeof d.type){const p="string"==typeof d.tagName?d.tagName:"string"==typeof d.name?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+l.type+(p?"<"+p+">":"")+")"})}return f;function f(){let m,h,g,p=Y_e;if((!t||o(l,c,u[u.length-1]||void 0))&&(p=function HIt(e){return Array.isArray(e)?e:"number"==typeof e?[UIt,e]:null==e?Y_e:[e]}(n(l,u)),p[0]===X_e))return p;if("children"in l&&l.children){const y=l;if(y.children&&p[0]!==zIt)for(h=(r?y.children.length:-1)+s,g=u.concat(y);h>-1&&h<y.children.length;){if(m=a(y.children[h],h,g)(),m[0]===X_e)return m;h="number"==typeof m[1]?m[1]:h+s}}return p}}(e,void 0,[])()}(e,o,function a(l,c){const u=c[c.length-1],d=u?u.children.indexOf(l):void 0;return s(l,d,u)},i)}function Z_e(e,t){const n=t.referenceType;let r="]";if("collapsed"===n?r+="[]":"full"===n&&(r+="["+(t.label||t.identifier)+"]"),"imageReference"===t.type)return[{type:"text",value:"!["+t.alt+r}];const i=e.all(t),o=i[0];o&&"text"===o.type?o.value="["+o.value:i.unshift({type:"text",value:"["});const s=i[i.length-1];return s&&"text"===s.type?s.value+=r:i.push({type:"text",value:r}),i}function Q_e(e){return e.spread??e.children.length>1}const J_e=9,e2e=32;function fEt(e){const t=String(e),n=/\r?\n|\r/g;let r=n.exec(t),i=0;const o=[];for(;r;)o.push(t2e(t.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=n.exec(t);return o.push(t2e(t.slice(i),i>0,!1)),o.join("")}function t2e(e,t,n){let r=0,i=e.length;if(t){let o=e.codePointAt(r);for(;o===J_e||o===e2e;)r++,o=e.codePointAt(r)}if(n){let o=e.codePointAt(i-1);for(;o===J_e||o===e2e;)i--,o=e.codePointAt(i-1)}return i>r?e.slice(r,i):""}const mEt={blockquote:function GIt(e,t){const n={type:"element",tagName:"blockquote",properties:{},children:e.wrap(e.all(t),!0)};return e.patch(t,n),e.applyData(t,n)},break:function qIt(e,t){const n={type:"element",tagName:"br",properties:{},children:[]};return e.patch(t,n),[e.applyData(t,n),{type:"text",value:"\n"}]},code:function WIt(e,t){const n=t.value?t.value+"\n":"",r={};t.lang&&(r.className=["language-"+t.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return t.meta&&(i.data={meta:t.meta}),e.patch(t,i),i=e.applyData(t,i),i={type:"element",tagName:"pre",properties:{},children:[i]},e.patch(t,i),i},delete:function $It(e,t){const n={type:"element",tagName:"del",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},emphasis:function YIt(e,t){const n={type:"element",tagName:"em",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},footnoteReference:function XIt(e,t){const n="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",r=String(t.identifier).toUpperCase(),i=N2(r.toLowerCase()),o=e.footnoteOrder.indexOf(r);let s,a=e.footnoteCounts.get(r);void 0===a?(a=0,e.footnoteOrder.push(r),s=e.footnoteOrder.length):s=o+1,a+=1,e.footnoteCounts.set(r,a);const l={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+i,id:n+"fnref-"+i+(a>1?"-"+a:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};e.patch(t,l);const c={type:"element",tagName:"sup",properties:{},children:[l]};return e.patch(t,c),e.applyData(t,c)},heading:function KIt(e,t){const n={type:"element",tagName:"h"+t.depth,properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},html:function ZIt(e,t){if(e.options.allowDangerousHtml){const n={type:"raw",value:t.value};return e.patch(t,n),e.applyData(t,n)}},imageReference:function QIt(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return Z_e(e,t);const i={src:N2(r.url||""),alt:t.alt};null!=r.title&&(i.title=r.title);const o={type:"element",tagName:"img",properties:i,children:[]};return e.patch(t,o),e.applyData(t,o)},image:function JIt(e,t){const n={src:N2(t.url)};null!=t.alt&&(n.alt=t.alt),null!=t.title&&(n.title=t.title);const r={type:"element",tagName:"img",properties:n,children:[]};return e.patch(t,r),e.applyData(t,r)},inlineCode:function eEt(e,t){const n={type:"text",value:t.value.replace(/\r?\n|\r/g," ")};e.patch(t,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return e.patch(t,r),e.applyData(t,r)},linkReference:function tEt(e,t){const n=String(t.identifier).toUpperCase(),r=e.definitionById.get(n);if(!r)return Z_e(e,t);const i={href:N2(r.url||"")};null!=r.title&&(i.title=r.title);const o={type:"element",tagName:"a",properties:i,children:e.all(t)};return e.patch(t,o),e.applyData(t,o)},link:function nEt(e,t){const n={href:N2(t.url)};null!=t.title&&(n.title=t.title);const r={type:"element",tagName:"a",properties:n,children:e.all(t)};return e.patch(t,r),e.applyData(t,r)},listItem:function rEt(e,t,n){const r=e.all(t),i=n?function iEt(e){let t=!1;if("list"===e.type){t=e.spread||!1;const n=e.children;let r=-1;for(;!t&&++r<n.length;)t=Q_e(n[r])}return t}(n):Q_e(t),o={},s=[];if("boolean"==typeof t.checked){const u=r[0];let d;u&&"element"===u.type&&"p"===u.tagName?d=u:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:t.checked,disabled:!0},children:[]}),o.className=["task-list-item"]}let a=-1;for(;++a<r.length;){const u=r[a];(i||0!==a||"element"!==u.type||"p"!==u.tagName)&&s.push({type:"text",value:"\n"}),"element"!==u.type||"p"!==u.tagName||i?s.push(u):s.push(...u.children)}const l=r[r.length-1];l&&(i||"element"!==l.type||"p"!==l.tagName)&&s.push({type:"text",value:"\n"});const c={type:"element",tagName:"li",properties:o,children:s};return e.patch(t,c),e.applyData(t,c)},list:function oEt(e,t){const n={},r=e.all(t);let i=-1;for("number"==typeof t.start&&1!==t.start&&(n.start=t.start);++i<r.length;){const s=r[i];if("element"===s.type&&"li"===s.tagName&&s.properties&&Array.isArray(s.properties.className)&&s.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const o={type:"element",tagName:t.ordered?"ol":"ul",properties:n,children:e.wrap(r,!0)};return e.patch(t,o),e.applyData(t,o)},paragraph:function sEt(e,t){const n={type:"element",tagName:"p",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},root:function aEt(e,t){const n={type:"root",children:e.wrap(e.all(t))};return e.patch(t,n),e.applyData(t,n)},strong:function lEt(e,t){const n={type:"element",tagName:"strong",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},table:function cEt(e,t){const n=e.all(t),r=n.shift(),i=[];if(r){const s={type:"element",tagName:"thead",properties:{},children:e.wrap([r],!0)};e.patch(t.children[0],s),i.push(s)}if(n.length>0){const s={type:"element",tagName:"tbody",properties:{},children:e.wrap(n,!0)},a=lX(t.children[1]),l=c_e(t.children[t.children.length-1]);a&&l&&(s.position={start:a,end:l}),i.push(s)}const o={type:"element",tagName:"table",properties:{},children:e.wrap(i,!0)};return e.patch(t,o),e.applyData(t,o)},tableCell:function dEt(e,t){const n={type:"element",tagName:"td",properties:{},children:e.all(t)};return e.patch(t,n),e.applyData(t,n)},tableRow:function uEt(e,t,n){const r=n?n.children:void 0,o=0===(r?r.indexOf(t):1)?"th":"td",s=n&&"table"===n.type?n.align:void 0,a=s?s.length:t.children.length;let l=-1;const c=[];for(;++l<a;){const d=t.children[l],f={},p=s?s[l]:void 0;p&&(f.align=p);let m={type:"element",tagName:o,properties:f,children:[]};d&&(m.children=e.all(d),e.patch(d,m),m=e.applyData(d,m)),c.push(m)}const u={type:"element",tagName:"tr",properties:{},children:e.wrap(c,!0)};return e.patch(t,u),e.applyData(t,u)},text:function pEt(e,t){const n={type:"text",value:fEt(String(t.value))};return e.patch(t,n),e.applyData(t,n)},thematicBreak:function hEt(e,t){const n={type:"element",tagName:"hr",properties:{},children:[]};return e.patch(t,n),e.applyData(t,n)},toml:bB,yaml:bB,definition:bB,footnoteDefinition:bB};function bB(){}const TX={}.hasOwnProperty,gEt={};function yEt(e,t){const n=t||gEt,r=new Map,i=new Map,s={...mEt,...n.handlers},a={all:function c(u){const d=[];if("children"in u){const f=u.children;let p=-1;for(;++p<f.length;){const m=a.one(f[p],u);if(m){if(p&&"break"===f[p-1].type&&(!Array.isArray(m)&&"text"===m.type&&(m.value=n2e(m.value)),!Array.isArray(m)&&"element"===m.type)){const h=m.children[0];h&&"text"===h.type&&(h.value=n2e(h.value))}Array.isArray(m)?d.push(...m):d.push(m)}}}return d},applyData:vEt,definitionById:r,footnoteById:i,footnoteCounts:new Map,footnoteOrder:[],handlers:s,one:function l(u,d){const f=u.type,p=a.handlers[f];if(TX.call(a.handlers,f)&&p)return p(a,u,d);if(a.options.passThrough&&a.options.passThrough.includes(f)){if("children"in u){const{children:h,...g}=u,y=gB(g);return y.children=a.all(u),y}return gB(u)}return(a.options.unknownHandler||xEt)(a,u,d)},options:n,patch:bEt,wrap:_Et};return K_e(e,function(u){if("definition"===u.type||"footnoteDefinition"===u.type){const d="definition"===u.type?r:i,f=String(u.identifier).toUpperCase();d.has(f)||d.set(f,u)}}),a}function bEt(e,t){e.position&&(t.position=function ewt(e){const t=lX(e),n=c_e(e);if(t&&n)return{start:t,end:n}}(e))}function vEt(e,t){let n=t;if(e&&e.data){const r=e.data.hName,i=e.data.hChildren,o=e.data.hProperties;"string"==typeof r&&("element"===n.type?n.tagName=r:n={type:"element",tagName:r,properties:{},children:"children"in n?n.children:[n]}),"element"===n.type&&o&&Object.assign(n.properties,gB(o)),"children"in n&&n.children&&null!=i&&(n.children=i)}return n}function xEt(e,t){const n=t.data||{},r=!("value"in t)||TX.call(n,"hProperties")||TX.call(n,"hChildren")?{type:"element",tagName:"div",properties:{},children:e.all(t)}:{type:"text",value:t.value};return e.patch(t,r),e.applyData(t,r)}function _Et(e,t){const n=[];let r=-1;for(t&&n.push({type:"text",value:"\n"});++r<e.length;)r&&n.push({type:"text",value:"\n"}),n.push(e[r]);return t&&e.length>0&&n.push({type:"text",value:"\n"}),n}function n2e(e){let t=0,n=e.charCodeAt(t);for(;9===n||32===n;)t++,n=e.charCodeAt(t);return e.slice(t)}function r2e(e,t){const n=yEt(e,t),r=n.one(e,void 0),i=function NIt(e){const t="string"==typeof e.options.clobberPrefix?e.options.clobberPrefix:"user-content-",n=e.options.footnoteBackContent||MIt,r=e.options.footnoteBackLabel||RIt,i=e.options.footnoteLabel||"Footnotes",o=e.options.footnoteLabelTagName||"h2",s=e.options.footnoteLabelProperties||{className:["sr-only"]},a=[];let l=-1;for(;++l<e.footnoteOrder.length;){const c=e.footnoteById.get(e.footnoteOrder[l]);if(!c)continue;const u=e.all(c),d=String(c.identifier).toUpperCase(),f=N2(d.toLowerCase());let p=0;const m=[],h=e.footnoteCounts.get(d);for(;void 0!==h&&++p<=h;){m.length>0&&m.push({type:"text",value:" "});let v="string"==typeof n?n:n(l,p);"string"==typeof v&&(v={type:"text",value:v}),m.push({type:"element",tagName:"a",properties:{href:"#"+t+"fnref-"+f+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:"string"==typeof r?r:r(l,p),className:["data-footnote-backref"]},children:Array.isArray(v)?v:[v]})}const g=u[u.length-1];if(g&&"element"===g.type&&"p"===g.tagName){const v=g.children[g.children.length-1];v&&"text"===v.type?v.value+=" ":g.children.push({type:"text",value:" "}),g.children.push(...m)}else u.push(...m);const y={type:"element",tagName:"li",properties:{id:t+"fn-"+f},children:e.wrap(u,!0)};e.patch(c,y),a.push(y)}if(0!==a.length)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:o,properties:{...gB(s),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:"\n"},{type:"element",tagName:"ol",properties:{},children:e.wrap(a,!0)},{type:"text",value:"\n"}]}}(n),o=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&o.children.push({type:"text",value:"\n"},i),o}function SEt(e,t){return e&&"run"in e?function(){var n=le(function*(r,i){const o=r2e(r,{file:i,...t});yield e.run(o,i)});return function(r,i){return n.apply(this,arguments)}}():function(n,r){return r2e(n,{file:r,...t||e})}}function i2e(e){if(e)throw e}var DX=ln(216);function PX(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)}const Yg_basename=function AEt(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');ok(e);let o,n=0,r=-1,i=e.length;if(void 0===t||0===t.length||t.length>e.length){for(;i--;)if(47===e.codePointAt(i)){if(o){n=i+1;break}}else r<0&&(o=!0,r=i+1);return r<0?"":e.slice(n,r)}if(t===e)return"";let s=-1,a=t.length-1;for(;i--;)if(47===e.codePointAt(i)){if(o){n=i+1;break}}else s<0&&(o=!0,s=i+1),a>-1&&(e.codePointAt(i)===t.codePointAt(a--)?a<0&&(r=i):(a=-1,r=s));return n===r?r=s:r<0&&(r=e.length),e.slice(n,r)},Yg_dirname=function IEt(e){if(ok(e),0===e.length)return".";let r,t=-1,n=e.length;for(;--n;)if(47===e.codePointAt(n)){if(r){t=n;break}}else r||(r=!0);return t<0?47===e.codePointAt(0)?"/":".":1===t&&47===e.codePointAt(0)?"//":e.slice(0,t)},Yg_extname=function EEt(e){ok(e);let s,t=e.length,n=-1,r=0,i=-1,o=0;for(;t--;){const a=e.codePointAt(t);if(47!==a)n<0&&(s=!0,n=t+1),46===a?i<0?i=t:1!==o&&(o=1):i>-1&&(o=-1);else if(s){r=t+1;break}}return i<0||n<0||0===o||1===o&&i===n-1&&i===r+1?"":e.slice(i,n)},Yg_join=function TEt(...e){let n,t=-1;for(;++t<e.length;)ok(e[t]),e[t]&&(n=void 0===n?e[t]:n+"/"+e[t]);return void 0===n?".":function DEt(e){ok(e);const t=47===e.codePointAt(0);let n=function PEt(e,t){let a,l,n="",r=0,i=-1,o=0,s=-1;for(;++s<=e.length;){if(s<e.length)a=e.codePointAt(s);else{if(47===a)break;a=47}if(47===a){if(i!==s-1&&1!==o)if(i!==s-1&&2===o){if(n.length<2||2!==r||46!==n.codePointAt(n.length-1)||46!==n.codePointAt(n.length-2))if(n.length>2){if(l=n.lastIndexOf("/"),l!==n.length-1){l<0?(n="",r=0):(n=n.slice(0,l),r=n.length-1-n.lastIndexOf("/")),i=s,o=0;continue}}else if(n.length>0){n="",r=0,i=s,o=0;continue}t&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+e.slice(i+1,s):n=e.slice(i+1,s),r=s-i-1;i=s,o=0}else 46===a&&o>-1?o++:o=-1}return n}(e,!t);return 0===n.length&&!t&&(n="."),n.length>0&&47===e.codePointAt(e.length-1)&&(n+="/"),t?"/"+n:n}(n)},Yg_sep="/";function ok(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}const kEt_cwd=function MEt(){return"/"};function kX(e){return!!(null!==e&&"object"==typeof e&&"href"in e&&e.href&&"protocol"in e&&e.protocol&&void 0===e.auth)}const MX=["history","path","basename","stem","extname","dirname"];class o2e{constructor(t){let n;n=t?kX(t)?{path:t}:"string"==typeof t||function FEt(e){return!!(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(t)?{value:t}:t:{},this.cwd=kEt_cwd(),this.data={},this.history=[],this.messages=[];let i,r=-1;for(;++r<MX.length;){const o=MX[r];o in n&&null!=n[o]&&(this[o]="history"===o?[...n[o]]:n[o])}for(i in n)MX.includes(i)||(this[i]=n[i])}get basename(){return"string"==typeof this.path?Yg_basename(this.path):void 0}set basename(t){NX(t,"basename"),RX(t,"basename"),this.path=Yg_join(this.dirname||"",t)}get dirname(){return"string"==typeof this.path?Yg_dirname(this.path):void 0}set dirname(t){s2e(this.basename,"dirname"),this.path=Yg_join(t||"",this.basename)}get extname(){return"string"==typeof this.path?Yg_extname(this.path):void 0}set extname(t){if(RX(t,"extname"),s2e(this.dirname,"extname"),t){if(46!==t.codePointAt(0))throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=Yg_join(this.dirname,this.stem+(t||""))}get path(){return this.history[this.history.length-1]}set path(t){kX(t)&&(t=function REt(e){if("string"==typeof e)e=new URL(e);else if(!kX(e)){const t=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+e+"`");throw t.code="ERR_INVALID_ARG_TYPE",t}if("file:"!==e.protocol){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return function NEt(e){if(""!==e.hostname){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const t=e.pathname;let n=-1;for(;++n<t.length;)if(37===t.codePointAt(n)&&50===t.codePointAt(n+1)){const r=t.codePointAt(n+2);if(70===r||102===r){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(t)}(e)}(t)),NX(t,"path"),this.path!==t&&this.history.push(t)}get stem(){return"string"==typeof this.path?Yg_basename(this.path,this.extname):void 0}set stem(t){NX(t,"stem"),RX(t,"stem"),this.path=Yg_join(this.dirname||"",t+(this.extname||""))}fail(t,n,r){const i=this.message(t,n,r);throw i.fatal=!0,i}info(t,n,r){const i=this.message(t,n,r);return i.fatal=void 0,i}message(t,n,r){const i=new gu(t,n,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(t){return void 0===this.value?"":"string"==typeof this.value?this.value:new TextDecoder(t||void 0).decode(this.value)}}function RX(e,t){if(e&&e.includes(Yg_sep))throw new Error("`"+t+"` cannot be a path: did not expect `"+Yg_sep+"`")}function NX(e,t){if(!e)throw new Error("`"+t+"` cannot be empty")}function s2e(e,t){if(!e)throw new Error("Setting `"+t+"` requires `path` to be set too")}const OEt=function(e){const r=this.constructor.prototype,i=r[e],o=function(){return i.apply(o,arguments)};Object.setPrototypeOf(o,r);const s=Object.getOwnPropertyNames(i);for(const a of s){const l=Object.getOwnPropertyDescriptor(i,a);l&&Object.defineProperty(o,a,l)}return o},BEt={}.hasOwnProperty;class FX extends OEt{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=function CEt(){const e=[],t={run:function n(...i){let o=-1;const s=i.pop();if("function"!=typeof s)throw new TypeError("Expected function as last argument, not "+s);!function a(l,...c){const u=e[++o];let d=-1;if(l)s(l);else{for(;++d<i.length;)null==c[d]&&(c[d]=i[d]);i=c,u?function wEt(e,t){let n;return function r(...s){const a=e.length>s.length;let l;a&&s.push(i);try{l=e.apply(this,s)}catch(c){if(a&&n)throw c;return i(c)}a||(l&&l.then&&"function"==typeof l.then?l.then(o,i):l instanceof Error?i(l):o(l))};function i(s,...a){n||(n=!0,t(s,...a))}function o(s){i(null,s)}}(u,a)(...c):s(null,...c)}}(null,...i)},use:function r(i){if("function"!=typeof i)throw new TypeError("Expected `middelware` to be a function, not "+i);return e.push(i),t}};return t}()}copy(){const t=new FX;let n=-1;for(;++n<this.attachers.length;)t.use(...this.attachers[n]);return t.data(DX(!0,{},this.namespace)),t}data(t,n){return"string"==typeof t?2===arguments.length?(LX("data",this.frozen),this.namespace[t]=n,this):BEt.call(this.namespace,t)&&this.namespace[t]||void 0:t?(LX("data",this.frozen),this.namespace=t,this):this.namespace}freeze(){if(this.frozen)return this;const t=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(!1===r[0])continue;!0===r[0]&&(r[0]=void 0);const i=n.call(t,...r);"function"==typeof i&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(t){this.freeze();const n=vB(t),r=this.parser||this.Parser;return OX("parse",r),r(String(n),n)}process(t,n){const r=this;return this.freeze(),OX("process",this.parser||this.Parser),BX("process",this.compiler||this.Compiler),n?i(void 0,n):new Promise(i);function i(o,s){const a=vB(t),l=r.parse(a);function c(u,d){u||!d?s(u):o?o(d):n(void 0,d)}r.run(l,a,function(u,d,f){if(u||!d||!f)return c(u);const m=r.stringify(d,f);!function UEt(e){return"string"==typeof e||function zEt(e){return!!(e&&"object"==typeof e&&"byteLength"in e&&"byteOffset"in e)}(e)}(m)?f.result=m:f.value=m,c(u,f)})}}processSync(t){let r,n=!1;return this.freeze(),OX("processSync",this.parser||this.Parser),BX("processSync",this.compiler||this.Compiler),this.process(t,function i(o,s){n=!0,i2e(o),r=s}),l2e("processSync","process",n),r}run(t,n,r){a2e(t),this.freeze();const i=this.transformers;return!r&&"function"==typeof n&&(r=n,n=void 0),r?o(void 0,r):new Promise(o);function o(s,a){const l=vB(n);i.run(t,l,function c(u,d,f){const p=d||t;u?a(u):s?s(p):r(void 0,p,f)})}}runSync(t,n){let i,r=!1;return this.run(t,n,function o(s,a){i2e(s),i=a,r=!0}),l2e("runSync","run",r),i}stringify(t,n){this.freeze();const r=vB(n),i=this.compiler||this.Compiler;return BX("stringify",i),a2e(t),i(t,r)}use(t,...n){const r=this.attachers,i=this.namespace;if(LX("use",this.frozen),null!=t)if("function"==typeof t)l(t,n);else{if("object"!=typeof t)throw new TypeError("Expected usable value, not `"+t+"`");Array.isArray(t)?a(t):s(t)}return this;function o(c){if("function"==typeof c)l(c,[]);else{if("object"!=typeof c)throw new TypeError("Expected usable value, not `"+c+"`");if(Array.isArray(c)){const[u,...d]=c;l(u,d)}else s(c)}}function s(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");a(c.plugins),c.settings&&(i.settings=DX(!0,i.settings,c.settings))}function a(c){let u=-1;if(null!=c){if(!Array.isArray(c))throw new TypeError("Expected a list of plugins, not `"+c+"`");for(;++u<c.length;)o(c[u])}}function l(c,u){let d=-1,f=-1;for(;++d<r.length;)if(r[d][0]===c){f=d;break}if(-1===f)r.push([c,...u]);else if(u.length>0){let[p,...m]=u;const h=r[f][1];PX(h)&&PX(p)&&(p=DX(!0,h,p)),r[f]=[c,p,...m]}}}}const LEt=(new FX).freeze();function OX(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `parser`")}function BX(e,t){if("function"!=typeof t)throw new TypeError("Cannot `"+e+"` without `compiler`")}function LX(e,t){if(t)throw new Error("Cannot call `"+e+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function a2e(e){if(!PX(e)||"string"!=typeof e.type)throw new TypeError("Expected node, got `"+e+"`")}function l2e(e,t,n){if(!n)throw new Error("`"+e+"` finished async. Use `"+t+"` instead")}function vB(e){return function jEt(e){return!!(e&&"object"==typeof e&&"message"in e&&"messages"in e)}(e)?e:new o2e(e)}const c2e=[],u2e={allowDangerousHtml:!0},HEt=/^(https?|ircs?|mailto|xmpp)$/i,GEt=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function d2e(e){const t=e.allowedElements,n=e.allowElement,r=e.children||"",i=e.className,o=e.components,s=e.disallowedElements,a=e.rehypePlugins||c2e,l=e.remarkPlugins||c2e,c=e.remarkRehypeOptions?{...e.remarkRehypeOptions,...u2e}:u2e,u=e.skipHtml,d=e.unwrapDisallowed,f=e.urlTransform||qEt,p=LEt().use(EIt).use(l).use(SEt,c).use(a),m=new o2e;"string"==typeof r&&(m.value=r);for(const v of GEt)Object.hasOwn(e,v.from);const h=p.parse(m);let g=p.runSync(h,m);return i&&(g={type:"element",tagName:"div",properties:{className:i},children:"root"===g.type?g.children:[g]}),K_e(g,function y(v,x,_){if("raw"===v.type&&_&&"number"==typeof x)return u?_.children.splice(x,1):_.children[x]={type:"text",value:v.value},x;if("element"===v.type){let w;for(w in pX)if(Object.hasOwn(pX,w)&&Object.hasOwn(v.properties,w)){const A=v.properties[w],M=pX[w];(null===M||M.includes(v.tagName))&&(v.properties[w]=f(String(A||""),w,v))}}if("element"===v.type){let w=t?!t.includes(v.tagName):!!s&&s.includes(v.tagName);if(!w&&n&&"number"==typeof x&&(w=!n(v,x,_)),w&&_&&"number"==typeof x)return d&&v.children?_.children.splice(x,1,...v.children):_.children.splice(x,1),x}}),function swt(e,t){if(!t||void 0===t.Fragment)throw new TypeError("Expected `Fragment` in options");const n=t.filePath||void 0;let r;if(t.development){if("function"!=typeof t.jsxDEV)throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=function hwt(e,t){return function n(r,i,o,s){const a=Array.isArray(o.children),l=lX(r);return t(i,o,s,a,{columnNumber:l?l.column-1:void 0,fileName:e,lineNumber:l?l.line:void 0},void 0)}}(n,t.jsxDEV)}else{if("function"!=typeof t.jsx)throw new TypeError("Expected `jsx` in production options");if("function"!=typeof t.jsxs)throw new TypeError("Expected `jsxs` in production options");r=function pwt(e,t,n){return function r(i,o,s,a){const c=Array.isArray(s.children)?n:t;return a?c(o,s,a):c(o,s)}}(0,t.jsx,t.jsxs)}const i={Fragment:t.Fragment,ancestors:[],components:t.components||{},create:r,elementAttributeNameCase:t.elementAttributeNameCase||"react",evaluater:t.createEvaluater?t.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:t.ignoreInvalidStyle||!1,passKeys:!1!==t.passKeys,passNode:t.passNode||!1,schema:"svg"===t.space?aX:qCt,stylePropertyNameCase:t.stylePropertyNameCase||"dom",tableCellAlignToStyle:!1!==t.tableCellAlignToStyle},o=h_e(i,e,void 0);return o&&"string"!=typeof o?o:i.create(e,i.Fragment,{children:o||void 0},void 0)}(g,{Fragment:L.Fragment,components:o,ignoreInvalidStyle:!0,jsx:L.jsx,jsxs:L.jsxs,passKeys:!0,passNode:!0})}function qEt(e){const t=e.indexOf(":"),n=e.indexOf("?"),r=e.indexOf("#"),i=e.indexOf("/");return t<0||i>-1&&t>i||n>-1&&t>n||r>-1&&t>r||HEt.test(e.slice(0,t))?e:""}class WEt extends Vr{constructor(){super(...arguments),this.updateParams=t=>{this.plugin.managers.animation.updateParams({[t.name]:t.value})},this.updateCurrentParams=t=>{this.plugin.managers.animation.updateCurrentParams({[t.name]:t.value})},this.startOrStop=()=>{const t=this.plugin.managers.animation;"playing"===t.state.animationState?t.stop():(this.props.onStart&&this.props.onStart(),t.start())}}componentDidMount(){this.subscribe(this.plugin.managers.animation.events.updated,()=>this.forceUpdate())}render(){var t,n;const r=this.plugin.managers.animation;if(r.isEmpty)return null;const i="playing"===r.state.animationState,o=null===(n=(t=r.current.anim).canApply)||void 0===n?void 0:n.call(t,this.plugin);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(vs,{params:r.getParams(),values:r.state.params,onChange:this.updateParams,isDisabled:i}),(0,L.jsx)(vs,{params:r.current.params,values:r.current.paramValues,onChange:this.updateCurrentParams,isDisabled:i}),(0,L.jsx)("div",{className:"msp-flex-row",children:(0,L.jsx)(ir,{icon:"playing"!==r.state.animationState?void 0:Rbe,onClick:this.startOrStop,disabled:void 0!==o&&!1===o.canApply,children:"playing"===r.state.animationState?"Stop":void 0===o||o.canApply?"Start":o.reason||"Start"})})]})}}function f2e(e){return xd((t,n)=>e<=n)}class F2 extends bl{constructor(){super(...arguments),this.onChange=({name:t,value:n})=>{const r={...this.props.params,[t]:n};this.props.events.onChange(r,this.areInitial(r),this.validate(r))}}validate(t){}areInitial(t){return I.areEqual(this.props.info.params,t,this.props.info.initialValues)}render(){return(0,L.jsx)(vs,{params:this.props.info.params,values:this.props.params,onChange:this.onChange,onEnter:this.props.events.onEnter,isDisabled:this.props.isDisabled})}}!function(e){function t(i){const o=Object.keys(i);for(const s of o)if(!i[s].isHidden)return!1;return!0}e.infoFromAction=function n(i,o,s,a){const l=o.cells.get(a).obj,c=s.definition.params?s.definition.params(l,i):{};return{initialValues:I.getDefaultValues(c),params:c,isEmpty:t(c)}},e.infoFromTransform=function r(i,o,s){const a=o.cells.get(s.ref),l=a.params&&a.params.definition||{};return{initialValues:a.params&&a.params.values||{},params:l,isEmpty:t(l)}}}(F2||(F2={}));class p2e extends bl{constructor(){var t;super(...arguments),t=this,this.busy=new Ao(!1),this.onEnter=()=>{this.state.error||this.apply()},this.autoApplyHandle=void 0,this.events={onEnter:this.onEnter,onChange:(n,r,i)=>{this.clearAutoApply(),this.setState({params:n,isInitial:r,error:i&&i[0]},()=>{!r&&!this.state.error&&this.canAutoApply(n)&&(this.clearAutoApply(),this.autoApplyHandle=setTimeout(this.apply,50))})}},this.apply=le(function*(){var n,r;t.clearAutoApply(),t.setState({busy:!0});try{yield t.applyAction()}catch(i){console.error(i)}finally{null===(r=(n=t.props).onApply)||void 0===r||r.call(n),t.busy.next(!1)}}),this.refresh=()=>{this.setState({params:this.getInfo().initialValues,isInitial:!0,error:void 0})},this.setDefault=()=>{const n=this.getInfo(),r=I.getDefaultValues(n.params);this.setState({params:r,isInitial:I.areEqual(n.params,r,n.initialValues),error:void 0})},this.toggleExpanded=()=>{this.setState({isCollapsed:!this.state.isCollapsed})}}clearAutoApply(){void 0!==this.autoApplyHandle&&(clearTimeout(this.autoApplyHandle),this.autoApplyHandle=void 0)}componentDidMount(){this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.busy.value!==t&&this.busy.next(t)}),this.subscribe(this.busy.pipe(f2e(1)),t=>{this.setState({busy:t})})}renderApply(){const t=this.canApply();return!this.props.autoHideApply||t&&!this.canAutoApply(this.state.params)?(0,L.jsxs)("div",{className:"msp-transform-apply-wrap",children:[(0,L.jsx)(kn,{svg:HW,className:"msp-transform-default-params",onClick:this.setDefault,disabled:this.state.busy,title:"Set default params"}),(0,L.jsx)("div",{className:"msp-transform-apply-wider",children:(0,L.jsx)(ir,{icon:t?a2:void 0,className:"msp-btn-commit msp-btn-commit-"+(t?"on":"off"),onClick:this.apply,disabled:!t,children:this.props.applyLabel||this.applyText()})})]}):null}renderDefault(){const t=this.getInfo(),n=t.isEmpty&&this.isUpdate(),r=this.getHeader(),i=this.getTransformerId(),o=this.plugin.customParamEditors.has(i)?this.plugin.customParamEditors.get(i):F2,s=this.state.isCollapsed?"msp-transform-wrapper msp-transform-wrapper-collapsed":"msp-transform-wrapper";let a=null;if(!n&&!this.state.isCollapsed){const{a:c,b:u,bCell:d}=this.getSourceAndTarget(),f=this.renderApply();a=(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(o,{info:t,a:c,b:u,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy}),f]})}const l=(0,L.jsxs)("div",{className:s,style:{marginBottom:this.props.noMargin?0:void 0},children:["none"!==r&&!this.props.wrapInExpander&&(0,L.jsx)("div",{className:"msp-transform-header",children:(0,L.jsxs)(ir,{onClick:this.toggleExpanded,title:r.description,children:[!n&&(0,L.jsx)(Mi,{svg:this.state.isCollapsed?Xy:Yy}),r.name]})}),a]});return n||!this.props.wrapInExpander?l:(0,L.jsx)(lm,{header:this.isUpdate()?`Update ${"none"===r?"":r.name}`:`Apply ${"none"===r?"":r.name}`,headerLeftMargin:this.props.expanderHeaderLeftMargin,children:l})}renderSimple(){var t,n,r;const i=this.getInfo(),o=this.canApply(),s=(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(ir,{icon:null===(t=this.props.simpleApply)||void 0===t?void 0:t.icon,title:null===(n=this.props.simpleApply)||void 0===n?void 0:n.title,disabled:this.state.busy||!o,onClick:this.apply,className:"msp-btn-apply-simple",children:null===(r=this.props.simpleApply)||void 0===r?void 0:r.header}),!i.isEmpty&&(0,L.jsx)(yl,{icon:uv,label:"",title:"Options",toggle:this.toggleExpanded,isSelected:!this.state.isCollapsed,disabled:this.state.busy,style:{flex:"0 0 40px",padding:0}})]});if(this.state.isCollapsed)return s;const a=this.getTransformerId(),l=this.plugin.customParamEditors.has(a)?this.plugin.customParamEditors.get(a):F2,{a:c,b:u,bCell:d}=this.getSourceAndTarget();return(0,L.jsxs)(L.Fragment,{children:[s,(0,L.jsx)(l,{info:i,a:c,b:u,bCell:d,events:this.events,params:this.state.params,isDisabled:this.state.busy})]})}render(){return this.props.simpleApply?this.renderSimple():this.renderDefault()}}class ab extends p2e{constructor(){super(...arguments),this._getInfo=sy(t=>F2.infoFromTransform(this.plugin,this.props.state,t)),this.state={error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return this.props.customUpdate?this.props.customUpdate(this.state.params):this.plugin.state.updateTransform(this.props.state,this.props.transform.ref,this.state.params)}getInfo(){return this._getInfo(this.props.transform)}getTransformerId(){return this.props.transform.transformer.id}getHeader(){return this.props.customHeader||this.props.transform.transformer.definition.display}canApply(){const{state:t}=this.props,n=t.cells.get(this.props.transform.ref);if(!n)return!1;if("error"===n.status){const r=t.cells.get(this.props.transform.parent);return!!r&&"ok"===r.status}return!this.state.error&&!this.state.busy&&!this.state.isInitial}applyText(){return this.canApply()?"Update":"Nothing to Update"}isUpdate(){return!0}getSourceAndTarget(){const t=this.props.state.cells.get(this.props.transform.ref);return{a:this.props.state.cells.get(this.props.transform.parent).obj,b:t?.obj,bCell:t}}canAutoApply(t){const n=this.props.transform.transformer.definition.canAutoUpdate;if(!n)return!1;const{state:r}=this.props,i=r.cells.get(this.props.transform.ref);return!(!i||!i.sourceRef||"ok"!==i.status)&&n({a:r.cells.get(i.sourceRef).obj,b:i.obj,oldParams:this.getInfo().initialValues,newParams:t},this.plugin)}componentDidMount(){super.componentDidMount(),this.props.toggleCollapsed&&this.subscribe(this.props.toggleCollapsed,()=>this.setState({isCollapsed:!this.state.isCollapsed})),this.subscribe(this.plugin.state.events.object.updated,({ref:t,state:n})=>{this.props.transform.ref!==t||this.props.state!==n||this.state.params!==this.props.transform.params&&(this._getInfo=sy(r=>F2.infoFromTransform(this.plugin,this.props.state,r)),this.setState({params:this.props.transform.params,isInitial:!0}))})}componentDidUpdate(t){var n;if(this.props.transform!==t.transform){const r=this.props.state.cells.get(this.props.transform.ref);this.setState({params:(null===(n=r.params)||void 0===n?void 0:n.values)||{},isInitial:!0,error:void 0,simpleOnly:this.state.simpleOnly})}}}class $Et extends bl{get current(){return this.plugin.managers.structure.hierarchy.behaviors.selection}componentDidMount(){this.subscribe(this.current,()=>this.forceUpdate())}get unitcell(){var t;const{selection:n}=this.plugin.managers.structure.hierarchy;if(0===n.structures.length)return null;const r=[];for(const i of n.structures){const o=i.model;o?.unitcell&&null!==(t=o.unitcell)&&void 0!==t&&t.cell.obj&&r.push(o.unitcell)}return 0===r.length?null:(0,L.jsx)(h2e,{refs:r,labelMultiple:"Unit Cells"})}get customControls(){const t=[];return this.plugin.genericRepresentationControls.forEach((n,r)=>{const[i,o]=n(this.plugin.managers.structure.hierarchy.selection);i.length>0&&t.push((0,L.jsx)("div",{children:(0,L.jsx)(h2e,{refs:i,labelMultiple:o})},r))}),t.length>0?t:null}render(){return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)("div",{style:{marginTop:"6px"},children:[this.unitcell,this.customControls]})})}}class h2e extends bl{constructor(){super(...arguments),this.state={showOptions:!1},this.toggleVisibility=t=>{t.preventDefault(),this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs),t.currentTarget.blur()},this.highlight=t=>{t.preventDefault(),this.pivot.cell.parent&&jt.Interactivity.Object.Highlight(this.plugin,{state:this.pivot.cell.parent,ref:this.props.refs.map(n=>n.cell.transform.ref)})},this.clearHighlight=t=>{t.preventDefault(),jt.Interactivity.ClearHighlights(this.plugin)},this.focus=t=>{var n;t.preventDefault();let r=!0;for(const o of this.props.refs)if(!o.cell.state.isHidden){r=!1;break}r&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.refs,"show");const i=[];for(const o of this.props.refs){if(o.cell.state.isHidden)continue;const s=null===(n=o.cell.obj)||void 0===n?void 0:n.data.repr.getLoci();s&&i.push(s)}this.plugin.managers.camera.focusLoci(i)},this.toggleOptions=()=>this.setState({showOptions:!this.state.showOptions})}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{var n;L1.ObjectEvent.isCell(t,null===(n=this.pivot)||void 0===n?void 0:n.cell)&&this.forceUpdate()})}get pivot(){return this.props.refs[0]}render(){const{refs:t,labelMultiple:n}=this.props;if(0===t.length)return null;const r=t[0];let i,o;if(1===t.length){const{obj:s}=r.cell;if(!s)return null;i=s?.label,o=s?.description}else i=`${t.length} ${n||"Objects"}`;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsxs)("button",{className:"msp-form-control msp-control-button-label",title:`${i}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[i," ",(0,L.jsx)("small",{children:o})]}),(0,L.jsx)(kn,{svg:r.cell.state.isHidden?c2:u2,toggleState:!1,className:"msp-form-control",onClick:this.toggleVisibility,title:r.cell.state.isHidden?"Show":"Hide",small:!0,flex:!0}),1===t.length&&(0,L.jsx)(kn,{svg:l2,className:"msp-form-control",onClick:this.toggleOptions,title:"Options",toggleState:this.state.showOptions,flex:!0})]}),1===t.length&&this.state.showOptions&&r.cell.parent&&(0,L.jsx)(L.Fragment,{children:(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(ab,{state:r.cell.parent,transform:r.cell.transform,customHeader:"none",autoHideApply:!0})})})]})}}class YEt extends d2{defaultState(){return{header:"Components",isCollapsed:!1,isDisabled:!1,brand:{accent:"blue",svg:LW}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>this.setState({description:m2.getSelectedStructuresDescription(this.plugin)}))}renderControls(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(XEt,{}),(0,L.jsx)(ZEt,{}),(0,L.jsx)($Et,{})]})}}class XEt extends bl{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1,canUndo:!1},this.togglePreset=this.toggleAction("preset"),this.toggleAdd=this.toggleAction("add"),this.toggleOptions=this.toggleAction("options"),this.hideAction=()=>this.setState({action:void 0}),this.applyPreset=t=>{if(this.hideAction(),!t)return;const n=this.plugin.managers.structure,{structures:r}=n.hierarchy.selection;null===t.value?n.component.clear(r):n.component.applyPreset(r,t.value)},this.undo=()=>{const t=this.plugin.state.data.undo();t&&this.plugin.runTask(t)}}get isDisabled(){return this.state.isBusy||this.state.isEmpty}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>this.setState({action:"options"!==this.state.action||0===t.structures.length?void 0:"options",isEmpty:0===t.structures.length})),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t,action:"options"!==this.state.action?void 0:"options"})}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:t})=>{this.setState({canUndo:t.canUndo})})}toggleAction(t){return()=>this.setState({action:this.state.action===t?void 0:t})}get presetControls(){return(0,L.jsx)(Hn,{items:this.presetActions,onSelect:this.applyPreset})}get presetActions(){const t=this.plugin.managers.structure.component.pivotStructure,n=this.plugin.builders.structure.representation.getPresets(t?.cell.obj);return Hn.createItems(n,{label:r=>r.display.name,category:r=>r.display.group,description:r=>r.display.description})}render(){const t=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.";return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(yl,{icon:OA,label:"Preset",title:"Apply a representation preset for the current structure(s).",toggle:this.togglePreset,isSelected:"preset"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:FA,label:"Add",title:"Add a new representation component for a selection.",toggle:this.toggleAdd,isSelected:"add"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:uv,label:"",title:"Options that are applied to all applicable representations.",style:{flex:"0 0 40px",padding:0},toggle:this.toggleOptions,isSelected:"options"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(kn,{svg:qW,className:"msp-flex-item",flex:"40px",onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:t})]}),"preset"===this.state.action&&this.presetControls,"add"===this.state.action&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(m2e,{onApply:this.hideAction})}),"options"===this.state.action&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(KEt,{isDisabled:this.isDisabled})})]})}}class m2e extends bl{constructor(){super(...arguments),this.state=this.createState(),this.apply=()=>{const t=this.props.forSelection?this.currentStructures:this.selectedStructures;this.props.onApply(),this.plugin.managers.structure.component.add(this.state.values,t)},this.paramsChanged=t=>this.setState({values:t})}createState(){const t=Bg.getAddParams(this.plugin);return{params:t,values:I.getDefaultValues(t)}}get selectedStructures(){return this.plugin.managers.structure.component.currentStructures}get currentStructures(){return this.plugin.managers.structure.hierarchy.current.structures}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(vs,{params:this.state.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,L.jsx)(ir,{icon:FA,title:"Use Selection and optional Representation to create a new Component.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Create Component"})]})}}class KEt extends bl{constructor(){super(...arguments),this.update=t=>this.plugin.managers.structure.component.setOptions(t)}componentDidMount(){this.subscribe(this.plugin.managers.structure.component.events.optionsUpdated,()=>this.forceUpdate())}render(){return(0,L.jsx)(vs,{params:Bg.OptionsParams,values:this.plugin.managers.structure.component.state.options,onChangeValues:this.update,isDisabled:this.props.isDisabled})}}class ZEt extends bl{componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.forceUpdate()})}render(){const t=this.plugin.managers.structure.hierarchy.currentComponentGroups;return 0===t.length?null:(0,L.jsx)("div",{style:{marginTop:"6px"},children:t.map(n=>(0,L.jsx)(QEt,{group:n},n[0].cell.transform.ref))})}}class QEt extends bl{constructor(){super(...arguments),this.state={action:void 0},this.toggleVisible=t=>{t.preventDefault(),t.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group)},this.selectAction=t=>{t&&(0,t?.value)()},this.remove=()=>this.plugin.managers.structure.hierarchy.remove(this.props.group,!0),this.toggleAction=()=>this.setState({action:"action"===this.state.action?void 0:"action"}),this.toggleLabel=()=>this.setState({action:"label"===this.state.action?void 0:"label"}),this.highlight=t=>{t.preventDefault(),this.props.group[0].cell.parent&&jt.Interactivity.Object.Highlight(this.plugin,{state:this.props.group[0].cell.parent,ref:this.props.group.map(n=>n.cell.transform.ref)})},this.clearHighlight=t=>{t.preventDefault(),jt.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{let t=!0;for(const n of this.props.group)if(!n.cell.state.isHidden){t=!1;break}t&&this.plugin.managers.structure.hierarchy.toggleVisibility(this.props.group,"show"),this.plugin.managers.camera.focusSpheres(this.props.group,n=>{var r;if(!n.cell.state.isHidden)return null===(r=n.cell.obj)||void 0===r?void 0:r.data.boundary.sphere})},this.updateLabel=t=>{this.plugin.managers.structure.component.updateLabel(this.pivot,t)}}get pivot(){return this.props.group[0]}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{L1.ObjectEvent.isCell(t,this.pivot.cell)&&this.forceUpdate()})}get colorByActions(){var t,n;const r=this.plugin.managers.structure.component,o=null===(t=this.pivot.representations[0].cell.transform.params)||void 0===t?void 0:t.colorTheme.name,s=function $gt(e,t){const{themes:n}=e.representation.structure;return t?n.colorThemeRegistry.getApplicableTypes({structure:t}):n.colorThemeRegistry.types}(this.plugin,null===(n=this.pivot.cell.obj)||void 0===n?void 0:n.data);return Hn.createItemsFromSelectOptions(s,{value:a=>()=>r.updateRepresentationsTheme(this.props.group,{color:a[0]}),selected:a=>a[0]===o})}get actions(){const t=this.plugin.managers.structure.component,n=[[Hn.Header("Add Representation"),...Bg.getRepresentationTypes(this.plugin,this.props.group[0]).map(r=>Hn.Item(r[1],()=>t.addRepresentation(this.props.group,r[0])))]];return this.pivot.representations.length>0&&n.push([Hn.Header("Set Coloring",{isIndependent:!0}),...this.colorByActions]),t.canBeModified(this.props.group[0])&&n.push([Hn.Header("Modify by Selection"),Hn.Item("Include",()=>t.modifyByCurrentSelection(this.props.group,"union"),{icon:FW}),Hn.Item("Subtract",()=>t.modifyByCurrentSelection(this.props.group,"subtract"),{icon:OW}),Hn.Item("Intersect",()=>t.modifyByCurrentSelection(this.props.group,"intersect"),{icon:BW})]),n.push(Hn.Item("Select This",()=>t.selectThis(this.props.group),{icon:dO})),t.canBeModified(this.props.group[0])&&n.push(Hn.Item("Edit Label",this.toggleLabel)),n}get reprLabel(){var t;const n=this.pivot;return 0===n.representations.length?"No repr.":1===n.representations.length?null===(t=n.representations[0].cell.obj)||void 0===t?void 0:t.label:`${n.representations.length} reprs`}render(){var t;const n=this.pivot,r=n.cell,i=null===(t=r.obj)||void 0===t?void 0:t.label;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsxs)(ir,{noOverflow:!0,className:"msp-control-button-label",title:`${i}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[i,(0,L.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:this.reprLabel})]}),(0,L.jsx)(kn,{svg:r.state.isHidden?c2:u2,toggleState:!1,onClick:this.toggleVisible,title:(r.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0}),(0,L.jsx)(kn,{svg:qp,toggleState:!1,onClick:this.remove,title:"Remove",small:!0,className:"msp-form-control",flex:!0}),(0,L.jsx)(kn,{svg:l2,onClick:this.toggleAction,title:"Actions",toggleState:"action"===this.state.action,className:"msp-form-control",flex:!0})]}),"label"===this.state.action&&(0,L.jsx)("div",{className:"msp-control-offset",style:{marginBottom:"6px"},children:(0,L.jsx)(Bd,{label:"Label",control:(0,L.jsxs)("div",{style:{display:"flex",textAlignLast:"center"},children:[(0,L.jsx)(Ky,{onChange:this.updateLabel,value:i,style:{flex:"1 1 auto",minWidth:0},className:"msp-form-control",blurOnEnter:!0,blurOnEscape:!0}),(0,L.jsx)(kn,{svg:a2,onClick:this.toggleLabel,className:"msp-form-control msp-control-button-label",flex:!0})]})})}),"action"===this.state.action&&(0,L.jsxs)("div",{className:"msp-accent-offset",children:[(0,L.jsx)("div",{style:{marginBottom:"6px"},children:(0,L.jsx)(Hn,{items:this.actions,onSelect:this.selectAction,noOffset:!0})}),(0,L.jsx)("div",{style:{marginBottom:"6px"},children:n.representations.map(s=>(0,L.jsx)(JEt,{group:this.props.group,representation:s},s.cell.transform.ref))})]})]})}}class JEt extends bl{constructor(){super(...arguments),this.remove=()=>this.plugin.managers.structure.component.removeRepresentations(this.props.group,this.props.representation),this.toggleVisible=t=>{t.preventDefault(),t.currentTarget.blur(),this.plugin.managers.structure.component.toggleVisibility(this.props.group,this.props.representation)},this.update=t=>this.plugin.managers.structure.component.updateRepresentations(this.props.group,this.props.representation,t)}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{L1.ObjectEvent.isCell(t,this.props.representation.cell)&&this.forceUpdate()})}render(){var t;const n=this.props.representation.cell;return(0,L.jsxs)("div",{className:"msp-representation-entry",children:[n.parent&&(0,L.jsx)(lm,{header:`${(null===(t=n.obj)||void 0===t?void 0:t.label)||""} Representation`,noOffset:!0,children:(0,L.jsx)(ab,{state:n.parent,transform:n.transform,customHeader:"none",customUpdate:this.update,noMargin:!0})}),(0,L.jsx)(kn,{svg:qp,onClick:this.remove,title:"Remove",small:!0,className:"msp-default-bg",toggleState:!1,style:{position:"absolute",top:0,right:"32px",lineHeight:"24px",height:"24px",textAlign:"right",width:"44px",paddingRight:"6px",background:"none"}}),(0,L.jsx)(kn,{svg:this.props.representation.cell.state.isHidden?c2:u2,toggleState:!1,onClick:this.toggleVisible,title:"Toggle Visibility",small:!0,className:"msp-default-bg",style:{position:"absolute",top:0,right:0,lineHeight:"24px",height:"24px",textAlign:"right",width:"32px",paddingRight:"6px",background:"none"}})]})}}function sTt(e,t){if("atom-id"===t){const n=function oTt(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(n=>!!n)).filter(t=>1===t.length||2===t.length).map(t=>1===t.length?[+t[0],+t[0]]:[+t[0],+t[1]])}(e);return function tTt(e){const t=Ti.create();for(const[r,i]of e)for(let o=r;o<=i;o++)Ti.add(t,o,o);return M_(pe.struct.generator.atomGroups({"atom-test":pe.core.set.has([pe.set(...t.array),pe.ammp("id")])}))}(n)}return function eTt(e,t){var n;const r=[],i="auth"===t?"auth_asym_id":"label_asym_id",o="auth"===t?"auth_seq_id":"label_seq_id";for(const a of e)if("range"===a.kind)r.push(pe.struct.generator.atomGroups({"chain-test":pe.core.rel.eq([pe.ammp(i),a.asym_id]),"residue-test":pe.core.rel.inRange([pe.ammp(o),a.seq_id_beg,a.seq_id_end])}));else{const l=(null!==(n=a.ins_code)&&void 0!==n?n:"").trim();r.push(pe.struct.generator.atomGroups({"chain-test":pe.core.rel.eq([pe.ammp(i),a.asym_id]),"residue-test":pe.core.logic.and([pe.core.rel.eq([pe.ammp(o),a.seq_id]),pe.core.rel.eq([pe.ammp("pdbx_PDB_ins_code"),l])])}))}return M_(pe.struct.combinator.merge(r))}(function iTt(e){return e.split(",").map(t=>t.trim().split(/\s+|[-]/g).filter(n=>!!n)).map(t=>function nTt(e,t,n){if(e&&0!==t.length&&!Number.isNaN(+t[0]))return Number.isNaN(n)?{kind:"single",asym_id:e,seq_id:+t[0],ins_code:t[1]}:{kind:"range",asym_id:e,seq_id_beg:+t[0],seq_id_end:n}}(t[0],function rTt(e){return e?e.split(":"):[]}(t[1]),+t[2])).filter(t=>!!t)}(e),t)}class jX extends Yt.PureComponent{getBindingComponents(){const t=function aTt(e){return Object.keys(e).map(t=>[t,e[t]]).filter(t=>Ut.isBinding(t[1]))}(this.props.bindings);return(0,L.jsx)(L.Fragment,{children:t.map(n=>{const[r,i]=n;return Ut.isEmpty(i)?null:(0,L.jsxs)("div",{style:{marginBottom:"6px"},children:[(0,L.jsx)("b",{children:i.action}),(0,L.jsx)("br",{}),(0,L.jsx)("span",{dangerouslySetInnerHTML:{__html:Ut.format(i,r)}})]},r)})})}render(){return(0,L.jsx)(Xg,{children:this.getBindingComponents()})}}class Xg extends Yt.PureComponent{render(){return(0,L.jsx)("div",{className:"msp-help-text",children:(0,L.jsx)("div",{children:this.props.children})})}}class Kg extends Yt.PureComponent{constructor(){super(...arguments),this.state={header:this.props.header,isExpanded:!!this.props.initiallyExpanded},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded})}render(){return(0,L.jsxs)("div",{className:"msp-control-group-wrapper",children:[(0,L.jsx)("div",{className:"msp-control-group-header",children:(0,L.jsxs)(ir,{onClick:this.toggleExpanded,children:[(0,L.jsx)(Mi,{svg:this.state.isExpanded?Yy:Xy}),this.props.header]})}),this.state.isExpanded&&(0,L.jsx)("div",{className:"msp-control-offset",style:{display:this.state.isExpanded?"block":"none"},children:this.props.children})]})}}function UX(e){return(0,L.jsx)("div",{className:"msp-simple-help-section",children:e.header})}class zX extends Vr{constructor(){super(...arguments),this.getInteractionBindings=sy(t=>{let n;return t.forEach(r=>{var i;const o=null===(i=r.params)||void 0===i?void 0:i.values;o?.bindings&&Object.keys(o.bindings).length>0&&(n||(n={}),Object.assign(n,o.bindings))}),n})}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}render(){const t=this.getInteractionBindings(this.plugin.state.behaviors.cells);return(0,L.jsxs)(L.Fragment,{children:[!this.props.selectOnly&&this.plugin.canvas3d&&(0,L.jsx)(Kg,{header:"Moving in 3D",children:(0,L.jsx)(jX,{bindings:this.plugin.canvas3d.props.trackball.bindings})},"trackball"),!!t&&(0,L.jsx)(Kg,{header:"Mouse & Key Controls",children:(0,L.jsx)(jX,{bindings:t})},"interactions")]})}}class lTt extends Vr{componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate())}formatTriggers(t){return t.triggers.map(n=>Ut.Trigger.format(n)).join(" or ")}getTriggerFor(t,n){const i=this.plugin.state.behaviors.select(Qn.Generators.ofTransformer(t)),o=1===i.length?i[0].params:void 0,s=o?o.values.bindings:{};return this.formatTriggers(n in s?s[n]:Ut.Empty)}render(){const t=this.getTriggerFor(W0e,"clickSelectToggle"),n=this.getTriggerFor(OF,"clickFocus");return(0,L.jsxs)("div",{children:[(0,L.jsx)(UX,{header:"Interface Controls"}),(0,L.jsxs)(Kg,{header:"Inline Help",children:[(0,L.jsx)(Xg,{children:"Many user interface elements show a little questionmark icon when hovered over. Clicking the icon toggles the display of an inline help text."}),(0,L.jsx)(Xg,{children:"Tooltips may provide additional information on a user interface element and are shown when hovering over it with the mouse."})]}),(0,L.jsx)(Kg,{header:"Selections",children:(0,L.jsxs)(Xg,{children:["The viewer allows changing colors and representations for selections of atoms, residues or chains. Selections can be created by",(0,L.jsxs)("ul",{style:{paddingLeft:"20px"},children:[(0,L.jsxs)("li",{children:["picking elements on the 3D canvas or the sequence view using the mouse, e.g. toggle selection using ",t," (for more see help section on ",(0,L.jsx)("i",{children:"Mouse Controls"}),")"]}),(0,L.jsxs)("li",{children:["using the ",(0,L.jsx)("i",{children:"Add"}),", ",(0,L.jsx)("i",{children:"Remove"})," and ",(0,L.jsx)("i",{children:"Only"})," dropdown buttons in the ",(0,L.jsx)("i",{children:"Manage Selection"})," panel which allow modifing the current selection by predefined sets"]})]})]})}),(0,L.jsx)(Kg,{header:"Coloring",children:(0,L.jsxs)(Xg,{children:["There are two ways to color structures. Every representation (e.g. cartoon or spacefill) has a color theme which can be changed using the dropdown for each representation in the ",(0,L.jsx)("i",{children:"Structure Settings"})," panel. Additionally any selection atoms, residues or chains can by given a custom color. For that, first select the parts of the structure to be colored (see help section on ",(0,L.jsx)("i",{children:"Selections"}),") and, second, choose a color from the color dropdown botton in the ",(0,L.jsx)("i",{children:"Selection"})," row of the ",(0,L.jsx)("i",{children:"Change Representation"})," panel. The theme color can be seen as a base color that is overpainted by the custom color. Custom colors can be removed for a selection with the 'Clear' option in the color dropdown."]})}),(0,L.jsx)(Kg,{header:"Representations",children:(0,L.jsxs)(Xg,{children:["Structures can be shown with many different representations (e.g. cartoon or spacefill). The ",(0,L.jsx)("i",{children:"Change Representation"})," panel offers a collection of predefined styles which can be applied using the ",(0,L.jsx)("i",{children:"Preset"})," dropdown button. Additionally any selection atoms, residues or chains can by shown with a custom representation. For that, first select the parts of the structure to be mofified (see help section on ",(0,L.jsx)("i",{children:"Selections"}),") and, second, choose a representation to hide or show from the ",(0,L.jsx)("i",{children:"Show"})," and ",(0,L.jsx)("i",{children:"Hide"})," dropdown bottons in the ",(0,L.jsx)("i",{children:"Selection"})," row of the ",(0,L.jsx)("i",{children:"Change Representation"})," panel. The ",(0,L.jsx)("i",{children:"Everything"})," row applies the action to the whole structure instead of the current selection."]})}),(0,L.jsx)(Kg,{header:"Surroundings",children:(0,L.jsxs)(Xg,{children:["To show the surroundings of a residue or ligand, click it in the 3D scene or in the sequence widget using ",n,"."]})}),(0,L.jsx)(UX,{header:"How-to Guides"}),(0,L.jsx)(Kg,{header:"Create an Image",children:(0,L.jsxs)(Xg,{children:[(0,L.jsxs)("p",{children:["Use the ",(0,L.jsx)(Mi,{svg:byt})," icon in the viewport to bring up the screenshot controls."]}),(0,L.jsxs)("p",{children:["To adjust the size of the image, use the ",(0,L.jsx)("i",{children:"Resolution"})," dropdown."]})]})}),(0,L.jsx)(UX,{header:"Mouse Controls"}),(0,L.jsx)(zX,{})]})}}class VX extends bl{constructor(){super(...arguments),this._toggleSelMode=()=>{this.plugin.selectionMode=!this.plugin.selectionMode}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return(0,L.jsx)(kn,{svg:Cbt,onClick:this._toggleSelMode,title:"Toggle Selection Mode",style:this.props.inline?{background:"transparent",width:"auto",height:"auto",lineHeight:"unset"}:{background:"transparent"},toggleState:this.plugin.selectionMode})}}const cTt={granularity:eb.Params.granularity},wI=new Map([["add","Add/Union Selection"],["remove","Remove/Subtract Selection"],["intersect","Intersect Selection"],["set","Set Selection"]]);class uTt extends Vr{constructor(){super(...arguments),this.state={action:void 0,helper:void 0,isEmpty:!0,isBusy:!1,canUndo:!1},this.set=(t,n)=>{this.plugin.managers.structure.selection.fromSelectionQuery(t,n,!1)},this.selectQuery=(t,n)=>{if(!t||!this.state.action)return void this.setState({action:void 0});const r=this.state.action;n?.shiftKey?this.set(r,t.value):this.setState({action:void 0},()=>{this.set(r,t.value)})},this.selectHelper=(t,n)=>{console.log(t),this.setState(t&&this.state.action?{helper:t.value.kind}:{action:void 0,helper:void 0})},this.queriesItems=[],this.queriesVersion=-1,this.helpersItems=void 0,this.toggleAdd=this.showAction("add"),this.toggleRemove=this.showAction("remove"),this.toggleIntersect=this.showAction("intersect"),this.toggleSet=this.showAction("set"),this.toggleTheme=this.showAction("theme"),this.toggleAddComponent=this.showAction("add-component"),this.toggleHelp=this.showAction("help"),this.setGranuality=({value:t})=>{this.plugin.managers.interactivity.setProps({granularity:t})},this.turnOff=()=>this.plugin.selectionMode=!1,this.undo=()=>{const t=this.plugin.state.data.undo();t&&this.plugin.runTask(t)},this.subtract=()=>{const t=this.plugin.managers.structure.hierarchy.getStructuresWithSelection(),n=[];for(const r of t)n.push(...r.components);0!==n.length&&this.plugin.managers.structure.component.modifyByCurrentSelection(n,"subtract")}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{const n=0===t.hierarchy.structures.length;this.state.isEmpty!==n&&this.setState({isEmpty:n}),this.queriesVersion=-1,this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t,action:void 0})}),this.subscribe(this.plugin.managers.interactivity.events.propsUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.historyUpdated,({state:t})=>{this.setState({canUndo:t.canUndo})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get structures(){var t;const n=[];for(const r of this.plugin.managers.structure.hierarchy.selection.structures){const i=null===(t=r.cell.obj)||void 0===t?void 0:t.data;i&&n.push(i)}return n}get queries(){const{registry:t}=this.plugin.query.structure;if(t.version!==this.queriesVersion){const n=this.structures,r=[...t.list,...Det(n),...Tet(n),...Eet(n)].sort((i,o)=>o.priority-i.priority);this.queriesItems=Hn.createItems(r,{filter:i=>i!==Ps.current&&!i.isHidden,label:i=>i.label,category:i=>i.category,description:i=>i.description}),this.queriesVersion=t.version}return this.queriesItems}get helpers(){return this.helpersItems||(this.helpersItems=Hn.createItems([{kind:"residue-list",category:"Helpers",label:"Atom/Residue Identifier List",description:"Create a selection from a list of atom/residue ranges."}],{label:n=>n.label,category:n=>n.category,description:n=>n.description})),this.helpersItems}showAction(t){return()=>this.setState({action:this.state.action===t?void 0:t,helper:void 0})}render(){const t=this.plugin.managers.interactivity.props.granularity,n=this.state.canUndo?`Undo ${this.plugin.state.data.latestUndoLabel}`:"Some mistakes of the past can be undone.";let r;if(this.state.action&&!this.state.helper)r=(0,L.jsxs)(L.Fragment,{children:[this.state.action&&"theme"!==this.state.action&&"add-component"!==this.state.action&&"help"!==this.state.action&&(0,L.jsxs)("div",{className:"msp-selection-viewport-controls-actions",children:[(0,L.jsx)(Hn,{header:wI.get(this.state.action),title:"Click to close.",items:this.queries,onSelect:this.selectQuery,noOffset:!0}),(0,L.jsx)(Hn,{items:this.helpers,onSelect:this.selectHelper,noOffset:!0})]}),"theme"===this.state.action&&(0,L.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,L.jsx)(Fg,{header:"Theme",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleTheme,topRightIcon:Rg,children:(0,L.jsx)(fTt,{onApply:this.toggleTheme})})}),"add-component"===this.state.action&&(0,L.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,L.jsx)(Fg,{header:"Add Component",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleAddComponent,topRightIcon:Rg,children:(0,L.jsx)(m2e,{onApply:this.toggleAddComponent,forSelection:!0})})}),"help"===this.state.action&&(0,L.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,L.jsxs)(Fg,{header:"Help",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleHelp,topRightIcon:Rg,maxHeight:"300px",children:[(0,L.jsx)(Kg,{header:"Selection Operations",children:(0,L.jsxs)(Xg,{children:["Use ",(0,L.jsx)(Mi,{svg:FW,inline:!0})," ",(0,L.jsx)(Mi,{svg:OW,inline:!0})," ",(0,L.jsx)(Mi,{svg:BW,inline:!0})," ",(0,L.jsx)(Mi,{svg:dO,inline:!0})," to modify the selection."]})}),(0,L.jsx)(Kg,{header:"Representation Operations",children:(0,L.jsxs)(Xg,{children:["Use ",(0,L.jsx)(Mi,{svg:jW,inline:!0})," ",(0,L.jsx)(Mi,{svg:LW,inline:!0})," ",(0,L.jsx)(Mi,{svg:GW,inline:!0})," ",(0,L.jsx)(Mi,{svg:qW,inline:!0})," to color, create components, remove from components, or undo actions."]})}),(0,L.jsx)(zX,{selectOnly:!0})]})})]});else if(wI.has(this.state.action)&&"residue-list"===this.state.helper){const i=()=>this.setState({action:void 0,helper:void 0});r=(0,L.jsx)("div",{className:"msp-selection-viewport-controls-actions",children:(0,L.jsx)(Fg,{header:"Atom/Residue Identifier List",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:i,topRightIcon:Rg,children:(0,L.jsx)(hTt,{modifier:this.state.action,plugin:this.plugin,close:i})})})}return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",style:{background:"none"},children:[(0,L.jsx)(jA,{title:"Picking Level for selecting and highlighting",param:cTt.granularity,name:"granularity",value:t,onChange:this.setGranuality,isDisabled:this.isDisabled}),(0,L.jsx)(yl,{icon:FW,title:`${wI.get("add")}. Hold shift key to keep menu open.`,toggle:this.toggleAdd,isSelected:"add"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:OW,title:`${wI.get("remove")}. Hold shift key to keep menu open.`,toggle:this.toggleRemove,isSelected:"remove"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:BW,title:`${wI.get("intersect")}. Hold shift key to keep menu open.`,toggle:this.toggleIntersect,isSelected:"intersect"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:dO,title:`${wI.get("set")}. Hold shift key to keep menu open.`,toggle:this.toggleSet,isSelected:"set"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:jW,title:"Apply Theme to Selection",toggle:this.toggleTheme,isSelected:"theme"===this.state.action,disabled:this.isDisabled,style:{marginLeft:"10px"}}),(0,L.jsx)(yl,{icon:LW,title:"Create Component of Selection with Representation",toggle:this.toggleAddComponent,isSelected:"add-component"===this.state.action,disabled:this.isDisabled}),(0,L.jsx)(kn,{svg:GW,title:"Remove/subtract Selection from all Components",onClick:this.subtract,disabled:this.isDisabled}),(0,L.jsx)(kn,{svg:qW,onClick:this.undo,disabled:!this.state.canUndo||this.isDisabled,title:n}),(0,L.jsx)(yl,{icon:Ng,title:"Show/hide help",toggle:this.toggleHelp,style:{marginLeft:"10px"},isSelected:"help"===this.state.action}),this.plugin.config.get(ei.Viewport.ShowSelectionMode)&&(0,L.jsx)(kn,{svg:UW,title:"Turn selection mode off",onClick:this.turnOff})]}),r]})}}class dTt extends Vr{constructor(){super(...arguments),this.state={isEmpty:!0,isBusy:!1},this.clear=()=>this.plugin.managers.interactivity.lociSelects.deselectAll(),this.focus=()=>{if(0===this.plugin.managers.structure.selection.stats.elementCount)return;const{sphere:t}=this.plugin.managers.structure.selection.getBoundary();this.plugin.managers.camera.focusSphere(t)},this.highlight=t=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights(),this.plugin.managers.structure.selection.entries.forEach(n=>{this.plugin.managers.interactivity.lociHighlights.highlight({loci:n.selection},!1)})},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{const n=0===t.structures.length;this.state.isEmpty!==n&&this.setState({isEmpty:n})}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get isDisabled(){return this.state.isBusy||this.state.isEmpty}get stats(){const t=this.plugin.managers.structure.selection.stats;return 0===t.structureCount||0===t.elementCount?"Nothing Selected":`${b1(t.label)} Selected`}render(){const t=this.plugin.managers.structure.selection.stats,n=0===t.structureCount||0===t.elementCount;return n&&this.props.hideOnEmpty?null:(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(ir,{noOverflow:!0,onClick:this.focus,title:"Click to Focus Selection",disabled:n,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlignLast:n?void 0:"left"},children:this.stats}),!n&&(0,L.jsx)(kn,{svg:UW,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0})]})})}}class fTt extends bl{constructor(){super(...arguments),this._params=sy(t=>Bg.getThemeParams(this.plugin,t)),this.state={values:I.getDefaultValues(this.params)},this.apply=()=>{var t,n;this.plugin.managers.structure.component.applyTheme(this.state.values,this.plugin.managers.structure.hierarchy.current.structures),null===(n=(t=this.props).onApply)||void 0===n||n.call(t)},this.paramsChanged=t=>this.setState({values:t})}get params(){return this._params(this.plugin.managers.structure.component.pivotStructure)}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(vs,{params:this.params,values:this.state.values,onChangeValues:this.paramsChanged}),(0,L.jsx)(ir,{icon:jW,className:"msp-btn-commit msp-btn-commit-on",onClick:this.apply,style:{marginTop:"1px"},children:"Apply Theme"})]})}}const g2e={idType:I.Select("auth",I.arrayToOptions(["auth","label","atom-id"])),identifiers:I.Text("",{description:"A comma separated list of atom identifiers (e.g. 10, 15-25) or residue ranges in given chain (e.g. A 10-15, B 25, C 30:i)"})},pTt=I.getDefaultValues(g2e);function hTt({modifier:e,plugin:t,close:n}){const[r,i]=Yt.useState(pTt),o=()=>{if(0!==r.identifiers.trim().length)try{n();const s=sTt(r.identifiers,r.idType);t.managers.structure.selection.fromCompiledQuery(e,s,!1)}catch(s){console.error(s),t.log.error("Failed to create selection")}};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(vs,{params:g2e,values:r,onChangeValues:i,onEnter:o}),(0,L.jsxs)(ir,{className:"msp-btn-commit msp-btn-commit-on",disabled:0===r.identifiers.trim().length,onClick:o,style:{marginTop:"1px"},children:[y1(e)," Selection"]})]})}class mTt extends d2{defaultState(){return{isCollapsed:!1,header:"Measurements",brand:{accent:"gray",svg:J0t}}}renderControls(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(yTt,{}),(0,L.jsx)(gTt,{})]})}}class gTt extends bl{componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()})}renderGroup(t,n){const r=[];for(const i of t)i.obj&&r.push((0,L.jsx)(vTt,{cell:i},i.obj.id));return r.length?(0,L.jsx)(lm,{header:n,initiallyExpanded:!0,children:r}):null}render(){const t=this.plugin.managers.structure.measurement.state;return(0,L.jsxs)("div",{style:{marginTop:"6px"},children:[this.renderGroup(t.labels,"Labels"),this.renderGroup(t.distances,"Distances"),this.renderGroup(t.angles,"Angles"),this.renderGroup(t.dihedrals,"Dihedrals"),this.renderGroup(t.orientations,"Orientations"),this.renderGroup(t.planes,"Planes")]})}}class yTt extends bl{constructor(){super(...arguments),this.state={isBusy:!1,action:void 0},this.measureDistance=()=>{const t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDistance(t[0].loci,t[1].loci)},this.measureAngle=()=>{const t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addAngle(t[0].loci,t[1].loci,t[2].loci)},this.measureDihedral=()=>{const t=this.plugin.managers.structure.selection.additionsHistory;this.plugin.managers.structure.measurement.addDihedral(t[0].loci,t[1].loci,t[2].loci,t[3].loci)},this.addLabel=()=>{this.plugin.managers.structure.measurement.addLabel(this.plugin.managers.structure.selection.additionsHistory[0].loci)},this.addOrientation=()=>{const t=[];this.plugin.managers.structure.selection.entries.forEach(n=>{t.push(n.selection)}),this.plugin.managers.structure.measurement.addOrientation(t)},this.addPlane=()=>{const t=[];this.plugin.managers.structure.selection.entries.forEach(n=>{t.push(n.selection)}),this.plugin.managers.structure.measurement.addPlane(t)},this.selectAction=t=>{this.toggleAdd(),t&&(0,t?.value)()},this.toggleAdd=()=>this.setState({action:"add"===this.state.action?void 0:"add"}),this.toggleOptions=()=>this.setState({action:"options"===this.state.action?void 0:"options"})}componentDidMount(){this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate(),this.updateOrderLabels()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}componentWillUnmount(){this.clearOrderLabels(),super.componentWillUnmount()}componentDidUpdate(t,n){this.state.action!==n.action&&this.updateOrderLabels()}clearOrderLabels(){this.plugin.managers.structure.measurement.addOrderLabels([])}updateOrderLabels(){if("add"!==this.state.action)return void this.clearOrderLabels();const t=[],n=this.selection.additionsHistory;for(let r=0;r<n.length&&r<4;r++)t.push(n[r].loci);this.plugin.managers.structure.measurement.addOrderLabels(t)}get selection(){return this.plugin.managers.structure.selection}get actions(){const t=this.selection.additionsHistory;return[{kind:"item",label:"Label "+(0===t.length?" (1 selection item required)":" (1st selection item)"),value:this.addLabel,disabled:0===t.length},{kind:"item",label:"Distance "+(t.length<2?" (2 selection items required)":" (top 2 selection items)"),value:this.measureDistance,disabled:t.length<2},{kind:"item",label:"Angle "+(t.length<3?" (3 selection items required)":" (top 3 items)"),value:this.measureAngle,disabled:t.length<3},{kind:"item",label:"Dihedral "+(t.length<4?" (4 selection items required)":" (top 4 selection items)"),value:this.measureDihedral,disabled:t.length<4},{kind:"item",label:"Orientation "+(0===t.length?" (selection required)":" (current selection)"),value:this.addOrientation,disabled:0===t.length},{kind:"item",label:"Plane "+(0===t.length?" (selection required)":" (current selection)"),value:this.addPlane,disabled:0===t.length}]}highlight(t){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:t},!1)}moveHistory(t,n){this.plugin.managers.structure.selection.modifyHistory(t,n,4)}focusLoci(t){this.plugin.managers.camera.focusLoci(t)}historyEntry(t,n){const r=this.plugin.managers.structure.selection.additionsHistory;return(0,L.jsxs)("div",{className:"msp-flex-row",onMouseEnter:()=>this.highlight(t.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[(0,L.jsxs)(ir,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(t.loci),style:{width:"auto",textAlign:"left"},children:[n,". ",(0,L.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}})]}),r.length>1&&(0,L.jsx)(kn,{svg:pO,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"up"),flex:"20px",title:"Move up"}),r.length>1&&(0,L.jsx)(kn,{svg:fO,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"down"),flex:"20px",title:"Move down"}),(0,L.jsx)(kn,{svg:qp,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(t,"remove"),flex:!0,title:"Remove"})]},t.id)}add(){const t=this.plugin.managers.structure.selection.additionsHistory,n=[];for(let o=0,s=Math.min(t.length,4);o<s;o++)n.push(this.historyEntry(t[o],o+1));const i=this.plugin.config.get(ei.Viewport.ShowSelectionMode)?(0,L.jsxs)(L.Fragment,{children:[" ","(toggle ",(0,L.jsx)(VX,{inline:!0})," mode)"]}):null;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Hn,{items:this.actions,onSelect:this.selectAction}),n.length>0&&(0,L.jsx)("div",{className:"msp-control-offset",children:n}),0===n.length&&(0,L.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,L.jsxs)("div",{className:"msp-help-description",children:[(0,L.jsx)(Mi,{svg:Ng,inline:!0}),"Add one or more selections",i]})})]})}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(yl,{icon:FA,label:"Add",toggle:this.toggleAdd,isSelected:"add"===this.state.action,disabled:this.state.isBusy,className:"msp-btn-apply-simple"}),(0,L.jsx)(yl,{icon:uv,label:"",title:"Options",toggle:this.toggleOptions,isSelected:"options"===this.state.action,disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),"add"===this.state.action&&this.add(),"options"===this.state.action&&(0,L.jsx)(bTt,{})]})}}class bTt extends bl{constructor(){super(...arguments),this.state={isDisabled:!1},this.changed=t=>{this.plugin.managers.structure.measurement.setOptions(t)}}componentDidMount(){this.subscribe(this.plugin.managers.structure.measurement.behaviors.state,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isDisabled:t})})}render(){return(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(vs,{params:A1e,values:this.plugin.managers.structure.measurement.state.options,onChangeValues:this.changed,isDisabled:this.state.isDisabled})})}}class vTt extends bl{constructor(){super(...arguments),this.state={showUpdate:!1},this.delete=()=>{jt.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent,removeParentGhosts:!0})},this.toggleVisibility=t=>{t.preventDefault(),jt.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.props.cell.transform.parent}),t.currentTarget.blur()},this.highlight=()=>{var t;if(!this.selections)return;this.plugin.managers.interactivity.lociHighlights.clearHighlights();for(const i of this.lociArray)this.plugin.managers.interactivity.lociHighlights.highlight({loci:i},!1);const r=null===(t=this.props.cell.obj)||void 0===t?void 0:t.data.repr.getAllLoci();if(r)for(const i of r)this.plugin.managers.interactivity.lociHighlights.highlight({loci:i},!1)},this.clearHighlight=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()},this.toggleUpdate=()=>this.setState({showUpdate:!this.state.showUpdate}),this.focus=()=>{if(!this.selections)return;const n=Yn.getBundleBoundingSphere({loci:this.lociArray});n&&this.plugin.managers.camera.focusSphere(n)},this.selectAction=t=>{t&&(this.setState({showUpdate:!1}),(0,t?.value)())}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{this.forceUpdate()})}get selections(){var t;return null===(t=this.props.cell.obj)||void 0===t?void 0:t.data.sourceData}get lociArray(){const t=this.selections;return t?t.infos?[t.infos[0].loci]:t.pairs?t.pairs[0].loci:t.triples?t.triples[0].loci:t.quads?t.quads[0].loci:t.locis?t.locis:[]:[]}get label(){const t=this.selections;return t?t.infos?L_(t.infos[0].loci,{condensed:!0}):t.pairs?aF(t.pairs[0],{condensed:!0,unitLabel:this.plugin.managers.structure.measurement.state.options.distanceUnitLabel}):t.triples?lF(t.triples[0],{condensed:!0}):t.quads?cF(t.quads[0],{condensed:!0}):t.locis?fP(t.locis,{countsOnly:!0}):"<empty>":"<empty>"}get actions(){return[Hn.Item("Select This",()=>this.plugin.managers.structure.selection.fromSelections(this.props.cell.sourceRef),{icon:dO})]}render(){const{cell:t}=this.props,{obj:n}=t;return n?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,children:[(0,L.jsx)("button",{className:"msp-form-control msp-control-button-label msp-no-overflow",title:"Click to focus. Hover to highlight.",onClick:this.focus,style:{width:"auto",textAlign:"left"},children:(0,L.jsx)("span",{dangerouslySetInnerHTML:{__html:this.label}})}),(0,L.jsx)(kn,{svg:t.state.isHidden?c2:u2,toggleState:!1,small:!0,className:"msp-form-control",onClick:this.toggleVisibility,flex:!0,title:t.state.isHidden?"Show":"Hide"}),(0,L.jsx)(kn,{svg:qp,small:!0,className:"msp-form-control",onClick:this.delete,flex:!0,title:"Delete",toggleState:!1}),(0,L.jsx)(kn,{svg:l2,className:"msp-form-control",onClick:this.toggleUpdate,flex:!0,title:"Actions",toggleState:this.state.showUpdate})]},n.id),this.state.showUpdate&&t.parent&&(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)("div",{className:"msp-accent-offset",children:[(0,L.jsx)(Hn,{items:this.actions,onSelect:this.selectAction,noOffset:!0}),(0,L.jsx)(lm,{header:"Options",noOffset:!0,children:(0,L.jsx)(ab,{state:t.parent,transform:t.transform,customHeader:"none",autoHideApply:!0})})]})})]}):null}}function HX(e,t,n,r){const i=rt.indexOf(t.unit.elements,t.element),o=Me(t.structure,[{unit:t.unit,indices:Ve.ofSingleton(i)}]),s="residue"===r?Me.extendToWholeResidues(o):Me.extendToWholeChains(o),a=Je.entity.pdbx_description(t).join(", ");for(const l of n.units){const c=Me(s.structure,[{unit:l,indices:s.elements[0].indices}]);let u=L_(c,{reverse:!0,hidePrefix:!0,htmlStyling:!1,granularity:r});u||(u=L_(c,{hidePrefix:!1,htmlStyling:!1})),n.units.length>1&&(u+=` | ${c.elements[0].unit.conformation.operator.name}`);const d={label:u,category:a,loci:c};e.has(a)?e.get(a).push(d):e.set(a,[d])}}function xTt(e){const t=new Map,n=dt.create(e);for(const i of e.unitSymmetryGroups){if(!ze.isAtomic(i.units[0]))continue;n.unit=i.units[0],n.element=i.elements[0];const o=ze.Traits.is(n.unit.traits,ze.Trait.MultiChain),s=Je.entity.type(n),a="non-polymer"===s,l="branched"===s;if(Je.entity.prd_id(n))HX(t,n,i,"chain");else if(a&&!o)HX(t,n,i,"residue");else if(l||a&&o){const u=n.unit,{index:d}=u.model.atomicHierarchy.residueAtomSegments;let f=-1;for(let p=0,m=u.elements.length;p<m;++p){const h=u.elements[p],g=d[h];g!==f&&(n.element=h,HX(t,n,i,"residue"),f=g)}}}const r=[];return t.forEach((i,o)=>{1===i.length?r.push({label:`${o}: ${i[0].label}`,loci:i[0].loci}):i.length<2e3&&r.push(...i)}),r}class _Tt extends Vr{constructor(){super(...arguments),this.state={isBusy:!1,showAction:!1},this.getSelectionItems=sy(t=>{var n;const r=[];for(const i of t){const o=null===(n=i.cell.obj)||void 0===n?void 0:n.data;if(o){const s=xTt(o);s.length>0&&r.push([Hn.Header(o.label,{description:o.label}),...Hn.createItems(s,{label:a=>a.label,category:a=>a.category,description:a=>a.label})])}}return r}),this.selectAction=(t,n)=>{if(!t||!this.state.showAction)return void this.setState({showAction:!1});const r=t.value;n?.shiftKey?this.plugin.managers.structure.focus.addFromLoci(r.loci):this.plugin.managers.structure.focus.set(r),this.focusCamera()},this.toggleAction=()=>this.setState({showAction:!this.state.showAction}),this.focusCamera=()=>{const{current:t}=this.plugin.managers.structure.focus;t&&this.plugin.managers.camera.focusLoci(t.loci)},this.clear=()=>{this.plugin.managers.structure.focus.clear(),this.plugin.managers.camera.reset()},this.highlightCurrent=()=>{const{current:t}=this.plugin.managers.structure.focus;t&&this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:t.loci},!1)},this.clearHighlights=()=>{this.plugin.managers.interactivity.lociHighlights.clearHighlights()}}componentDidMount(){this.subscribe(this.plugin.managers.structure.focus.behaviors.current,t=>{this.getSelectionItems([]),this.forceUpdate()}),this.subscribe(this.plugin.managers.structure.focus.events.historyUpdated,t=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t,showAction:!1})})}get isDisabled(){return this.state.isBusy||0===this.plugin.managers.structure.hierarchy.selection.structures.length}get actionItems(){const t=[],{history:n}=this.plugin.managers.structure.focus;n.length>0&&t.push([Hn.Header("History",{description:"Previously focused on items."}),...Hn.createItems(n,{label:o=>o.label,description:o=>o.category&&o.label!==o.category?`${o.category} | ${o.label}`:o.label})]);const r=this.getSelectionItems(this.plugin.managers.structure.hierarchy.selection.structures);1===r.length&&(r[0][0].initiallyExpanded=!0);const i=[];return r.length>0&&i.push(...r),t.length>0&&i.push(...t),i}getToggleBindingLabel(){var t;const n=this.plugin.state.behaviors.transforms.get(OF.id);if(!n)return"";const r=null===(t=n.params)||void 0===t?void 0:t.bindings.clickFocus;return!r||Ut.isEmpty(r)?"":Ut.formatTriggers(r)}render(){const{current:t}=this.plugin.managers.structure.focus,n=t?.label||"Nothing Focused";let r="Click to Center Camera";if(!t){r="Select focus using the menu";const i=this.getToggleBindingLabel();i&&(r+=`\nor use '${i}' on element`)}return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(ir,{noOverflow:!0,onClick:this.focusCamera,title:r,onMouseEnter:this.highlightCurrent,onMouseLeave:this.clearHighlights,disabled:this.isDisabled||!t,style:{textAlignLast:t?"left":void 0},children:n}),t&&(0,L.jsx)(kn,{svg:UW,onClick:this.clear,title:"Clear",className:"msp-form-control",flex:!0,disabled:this.isDisabled}),(0,L.jsx)(yl,{icon:Syt,title:"Select a focus target to center on an show its surroundings. Hold shift to focus on multiple targets.",toggle:this.toggleAction,isSelected:this.state.showAction,disabled:this.isDisabled,style:{flex:"0 0 40px",padding:0}})]}),this.state.showAction&&(0,L.jsx)(Hn,{items:this.actionItems,onSelect:this.selectAction})]})}}class STt extends d2{constructor(){super(...arguments),this.item=t=>{var n,r,i,o,s,a,l,c,u;const d=this.plugin.managers.structure.hierarchy.seletionSet;let f;switch(t.kind){case"model":{const m=null===(n=t.cell.obj)||void 0===n?void 0:n.data;m&&Sn.TrajectoryInfo.get(m).size>1&&(f=`${null===(r=t.cell.obj)||void 0===r?void 0:r.data.entryId} | Model ${Sn.TrajectoryInfo.get(m).index+1} of ${Sn.TrajectoryInfo.get(m).size}`),f=`${null===(i=t.cell.obj)||void 0===i?void 0:i.data.entryId} | ${null===(o=t.cell.obj)||void 0===o?void 0:o.label}`;break}case"structure":{const m=null===(s=t.cell.obj)||void 0===s?void 0:s.data.models[0];if(m&&Sn.TrajectoryInfo.get(m).size>1){f=`${m.entryId} | ${null===(a=t.cell.obj)||void 0===a?void 0:a.label} (Model ${Sn.TrajectoryInfo.get(m).index+1} of ${Sn.TrajectoryInfo.get(m).size})`;break}if(m){f=`${m.entryId} | ${null===(l=t.cell.obj)||void 0===l?void 0:l.label}`;break}f=`${null===(c=t.cell.obj)||void 0===c?void 0:c.label}`;break}default:f=null===(u=t.cell.obj)||void 0===u?void 0:u.label}return{kind:"item",label:f||t.kind,selected:d.has(t.cell.transform.ref),value:[t]}},this.getTrajectoryItems=t=>{var n;return 0===t.models.length?this.item(t):[Hn.Header(null===(n=t.cell.obj)||void 0===n?void 0:n.label),...t.models.map(this.getModelItems)]},this.getModelItems=t=>{var n,r,i;if(0===t.structures.length)return this.item(t);if(1===t.structures.length){const s=t.structures[0];return{label:`${null===(n=t.cell.obj)||void 0===n?void 0:n.label} | ${null===(r=s.cell.obj)||void 0===r?void 0:r.label}`,selected:this.plugin.managers.structure.hierarchy.seletionSet.has(s.cell.transform.ref),value:[t,s]}}return[Hn.Header(null===(i=t.cell.obj)||void 0===i?void 0:i.label),...t.structures.map(this.item)]},this.selectHierarchy=t=>{if(!t||0===t.length)return;const n=[];for(const r of t)for(const i of r.value)n.push(i);this.plugin.managers.structure.hierarchy.updateCurrent(n,t[0].selected?"remove":"add")},this.toggleHierarchy=()=>this.setState({show:"hierarchy"!==this.state.show?"hierarchy":void 0}),this.togglePreset=()=>this.setState({show:"presets"!==this.state.show?"presets":void 0}),this.applyPreset=t=>{if(this.setState({show:void 0}),!t)return;const n=this.plugin.managers.structure,{trajectories:r}=n.hierarchy.selection;n.hierarchy.applyPreset(r,t.value)},this.updateModelQueueParams=void 0,this.isUpdatingModel=!1,this.updateStructureModel=t=>{this.updateModelQueueParams=t,this._updateStructureModel()},this.updateStructure=t=>{const{selection:n}=this.plugin.managers.structure.hierarchy;return this.plugin.managers.structure.hierarchy.updateStructure(n.structures[0],t)}}defaultState(){return{header:"Structure",isCollapsed:!1,isBusy:!1,brand:{accent:"purple",svg:V0t}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get hierarchyItems(){const t=this.plugin.managers.structure.hierarchy,{current:n}=t,r=[];return n.trajectories.length>1&&r.push([Hn.Header("Trajectories"),...n.trajectories.map(this.item)]),(n.models.length>1||n.trajectories.length>1)&&r.push([Hn.Header("Models"),...n.models.map(this.item)]),1===n.trajectories.length&&1===n.models.length?r.push(...n.structures.map(this.item)):n.structures.length>0&&r.push([Hn.Header("Structures"),...n.structures.map(this.item)]),r}get isEmpty(){const{structures:t,models:n,trajectories:r}=this.plugin.managers.structure.hierarchy.current;return 0===r.length&&0===n.length&&0===t.length}get label(){var t,n,r,i,o,s,a,l,c,u,d,f,p,m;const{structures:h,models:g,trajectories:y}=this.plugin.managers.structure.hierarchy.selection;if(1===h.length){const v=h[0];return null!==(n=null===(t=v.model)||void 0===t?void 0:t.trajectory)&&void 0!==n&&n.models&&1===v.model.trajectory.models.length?null===(r=v.cell.obj)||void 0===r?void 0:r.data.label:v.model?`${null===(i=v.model.cell.obj)||void 0===i?void 0:i.label} | ${null===(o=v.cell.obj)||void 0===o?void 0:o.data.label}`:null===(s=v.cell.obj)||void 0===s?void 0:s.data.label}if(h.length>1){const v=h[0],x=null===(a=v?.model)||void 0===a?void 0:a.trajectory;let _=!0;for(const w of h)if((null===(l=w?.model)||void 0===l?void 0:l.trajectory)!==x){_=!1;break}return _&&x?`${null===(c=x.cell.obj)||void 0===c?void 0:c.label} | ${h.length} structures`:`${h.length} structures`}if(g.length>0){const v=g[0].trajectory;if(1===g.length){const _=null===(u=g[0].cell.obj)||void 0===u?void 0:u.data;return _&&Sn.TrajectoryInfo.get(_).size>1?`${null===(d=v?.cell.obj)||void 0===d?void 0:d.label} | Model ${Sn.TrajectoryInfo.get(_).index+1} of ${Sn.TrajectoryInfo.get(_).size}`:`${null===(f=v?.cell.obj)||void 0===f?void 0:f.label} | Model`}let x=!0;for(const _ of g)if(_.trajectory!==v){x=!1;break}return x?`${null===(p=v?.cell.obj)||void 0===p?void 0:p.label} | ${g.length} models`:`${g.length} models`}return y.length>0?1===y.length?`${null===(m=y[0].cell.obj)||void 0===m?void 0:m.label} trajectory`:`${y.length} trajectories`:0===y.length&&0===g.length&&0===h.length?"Nothing Loaded":"Nothing Selected"}get presetActions(){const t=[],{trajectories:n}=this.plugin.managers.structure.hierarchy.selection;if(0===n.length)return t;let r=this.plugin.builders.structure.hierarchy.getPresets(n[0].cell.obj);if(n.length>1){const i=new Set(r);for(let o=1;o<n.length;o++){const s=this.plugin.builders.structure.hierarchy.getPresets(n[o].cell.obj),a=new Set(s);for(const l of s)a.has(l)||i.delete(l)}r=r.filter(o=>i.has(o))}for(const i of r)t.push(Hn.Item(i.display.name,i,{description:i.display.description}));return t}_updateStructureModel(){var t=this;return le(function*(){if(!t.updateModelQueueParams||t.isUpdatingModel)return;const n=t.updateModelQueueParams;t.updateModelQueueParams=void 0;try{t.isUpdatingModel=!0;const{selection:r}=t.plugin.managers.structure.hierarchy,i=r.structures[0].model;yield t.plugin.state.updateTransform(t.plugin.state.data,i.cell.transform.ref,n,"Model Index")}finally{t.isUpdatingModel=!1,t._updateStructureModel()}})()}get modelIndex(){var t,n;const{selection:r}=this.plugin.managers.structure.hierarchy;if(1!==r.structures.length)return null;const i=r.structures[0].model;if(!i||i.cell.transform.transformer!==at.Model.ModelFromTrajectory||!i.cell.obj||Sn.TrajectoryInfo.get(i.cell.obj.data).size<=1)return null;const o=null===(t=i.cell.params)||void 0===t?void 0:t.definition;return o?(0,L.jsx)(vs,{params:o,values:null===(n=i.cell.params)||void 0===n?void 0:n.values,onChangeValues:this.updateStructureModel,isDisabled:this.state.isBusy}):null}get structureType(){var t;const{selection:n}=this.plugin.managers.structure.hierarchy;if(1!==n.structures.length)return null;const r=n.structures[0];return(null===(t=r.cell.params)||void 0===t?void 0:t.definition)&&r.cell.parent?(0,L.jsx)(ab,{state:r.cell.parent,transform:r.cell.transform,customHeader:"none",customUpdate:this.updateStructure,noMargin:!0,autoHideApply:!0}):null}get transform(){const{selection:t}=this.plugin.managers.structure.hierarchy;if(1!==t.structures.length)return null;const n=t.structures[0];if(!n.cell.parent)return null;const r=Qn.tryFindDecorator(this.plugin.state.data,n.cell.transform.ref,at.Model.TransformStructureConformation);return r?(0,L.jsx)(lm,{header:"Conformation Transform",children:(0,L.jsx)(ab,{state:r.parent,transform:r.transform,customHeader:"none",noMargin:!0,autoHideApply:!0})}):void 0}renderControls(){const t=this.state.isBusy||this.isEmpty,n=this.presetActions,r=this.label;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,L.jsx)(ir,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:t,title:r,children:r}),n.length>0&&(0,L.jsx)(kn,{svg:OA,className:"msp-form-control",flex:"40px",onClick:this.togglePreset,title:"Apply a structure presets to the current hierarchy.",toggleState:"presets"===this.state.show,disabled:t})]}),"hierarchy"===this.state.show&&(0,L.jsx)(Hn,{items:this.hierarchyItems,onSelect:this.selectHierarchy,multiselect:!0}),"presets"===this.state.show&&(0,L.jsx)(Hn,{items:n,onSelect:this.applyPreset}),this.modelIndex,this.structureType,this.transform,(0,L.jsxs)("div",{style:{marginTop:"6px"},children:[(0,L.jsx)(_Tt,{}),(0,L.jsx)(dTt,{hideOnEmpty:!0})]})]})}}class GX extends p2e{constructor(){super(...arguments),this._getInfo=sy((t,n,r)=>F2.infoFromAction(this.plugin,this.props.state,this.props.action,this.props.nodeRef)),this.state={plugin:this.plugin,ref:this.props.nodeRef,version:this.props.state.transforms.get(this.props.nodeRef).version,error:void 0,isInitial:!0,params:this.getInfo().initialValues,busy:!1,isCollapsed:this.props.initiallyCollapsed}}applyAction(){return jt.State.ApplyAction(this.plugin,{state:this.props.state,action:this.props.action.create(this.state.params),ref:this.props.nodeRef})}getInfo(){var t;return this._getInfo(this.props.nodeRef,this.props.state.transforms.get(this.props.nodeRef).version,null===(t=this.state)||void 0===t?void 0:t.isCollapsed)}getTransformerId(){return this.props.state.transforms.get(this.props.nodeRef).transformer.id}getHeader(){return this.props.hideHeader?"none":this.props.action.definition.display}canApply(){return!this.state.error&&!this.state.busy}canAutoApply(){return!1}applyText(){return"Apply"}isUpdate(){return!1}getSourceAndTarget(){return{a:this.props.state.cells.get(this.props.nodeRef).obj}}static getDerivedStateFromProps(t,n){const r=t.state.transforms.get(t.nodeRef).version;if(t.nodeRef===n.ref&&r===n.version)return null;const i=t.state.cells.get(t.nodeRef).obj,o=t.action.definition.params?I.getDefaultValues(t.action.definition.params(i,n.plugin)):{};return{plugin:n.plugin,ref:t.nodeRef,version:r,params:o,isInitial:!0,error:void 0}}}class CTt extends d2{defaultState(){return{header:"Volume Streaming",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"cyan",svg:Ebe}}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,()=>{this.setState({isHidden:!this.canEnable(),description:m2.getSelectedStructuresDescription(this.plugin)})}),this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{vr.hasTag(t.cell.transform,fu.RootTag)&&this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get pivot(){return this.plugin.managers.structure.hierarchy.selection.structures[0]}canEnable(){var t,n;const{selection:r}=this.plugin.managers.structure.hierarchy;if(1!==r.structures.length)return!1;const i=this.pivot.cell;return!!i.obj&&!(null===(n=(t=pq.definition).isApplicable)||void 0===n||!n.call(t,i.obj,i.transform,this.plugin))}renderEnable(){var t,n;const r=this.pivot;if(!r.cell.parent)return null;const i=Qn.findTagInSubtree(r.cell.parent.tree,this.pivot.cell.transform.ref,fu.RootTag),o=i&&r.cell.parent.cells.get(i),s=o&&"error"===o.status?{header:o.errorText&&null!==(t=o.errorText)&&void 0!==t&&t.includes("404")?"No Density Data Available":"Error Enabling",icon:Pbe,title:o.errorText}:o&&0===(null===(n=o.obj)||void 0===n?void 0:n.data.entries.length)?{header:"Error Enabling",icon:Pbe,title:"No Entry for Streaming Found"}:{header:"Enable",icon:a2,title:"Enable"};return(0,L.jsx)(GX,{state:r.cell.parent,action:pq,initiallyCollapsed:!0,nodeRef:r.cell.transform.ref,simpleApply:s})}renderParams(){var t,n,r,i,o;const s=this.pivot;if(!s.cell.parent)return null;const a="selection-box"===(null===(n=null===(t=s.volumeStreaming)||void 0===t?void 0:t.cell.transform.params)||void 0===n?void 0:n.entry.params.view.name)&&(null===(o=null===(i=null===(r=this.plugin.state.behaviors.cells.get(OF.id))||void 0===r?void 0:r.params)||void 0===i?void 0:i.values)||void 0===o?void 0:o.bindings);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(ab,{state:s.cell.parent,transform:s.volumeStreaming.cell.transform,customHeader:"none",noMargin:!0}),a&&(0,L.jsx)(lm,{header:"Controls Help",children:(0,L.jsx)(jX,{bindings:a})})]})}renderControls(){const t=this.pivot;return t?t.volumeStreaming?this.renderParams():this.renderEnable():null}}class wTt extends d2{constructor(){super(...arguments),this.item=t=>{var n;const i=(null===(n=t.cell.obj)||void 0===n?void 0:n.label)||"Volume";return{kind:"item",label:("lazy-volume"===t.kind?"Load ":"")+(i||t.kind),selected:this.plugin.managers.volume.hierarchy.selection===t,value:t}},this.selectCurrent=t=>{if(this.toggleHierarchy(),!t)return;const n=t.value;"volume"===n.kind?this.plugin.managers.volume.hierarchy.setCurrent(n):this.lazyLoad(n.cell)},this.selectAdd=t=>{t&&(this.setState({show:void 0}),t.value())},this.toggleHierarchy=()=>this.setState({show:"hierarchy"!==this.state.show?"hierarchy":void 0}),this.toggleAddRepr=()=>this.setState({show:"add-repr"!==this.state.show?"add-repr":void 0})}defaultState(){return{header:"Volume",isCollapsed:!1,isBusy:!1,isHidden:!0,brand:{accent:"purple",svg:Ebe}}}componentDidMount(){this.subscribe(this.plugin.managers.volume.hierarchy.behaviors.selection,t=>{this.setState({isHidden:0===t.hierarchy.volumes.length&&0===t.hierarchy.lazyVolumes.length})}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})})}get hierarchyItems(){const t=this.plugin.managers.volume.hierarchy,{current:n}=t,r=[];for(const i of n.volumes)r.push(this.item(i));for(const i of n.lazyVolumes)r.push(this.item(i));return r}get addActions(){const t=this.plugin.managers.volume.hierarchy,n=t.selection;return[...CO.getRepresentationTypes(this.plugin,n).map(i=>Hn.Item(i[1],()=>t.addRepresentation(n,i[0])))]}get isEmpty(){const{volumes:t,lazyVolumes:n}=this.plugin.managers.volume.hierarchy.current;return 0===t.length&&0===n.length}get label(){var t;if(this.state.loadingLabel)return`Loading ${this.state.loadingLabel}...`;const n=this.plugin.managers.volume.hierarchy.selection;return n?(null===(t=n?.cell.obj)||void 0===t?void 0:t.label)||"Volume":"Nothing Selected"}lazyLoad(t){var n=this;return le(function*(){const{url:r,isBinary:i,format:o,entryId:s,isovalues:a}=t.obj.data;n.setState({isBusy:!0,loadingLabel:t.obj.label});try{const l=n.plugin;yield l.dataTransaction(le(function*(){var c,u,d,f;const p=yield l.builders.data.download({url:r,isBinary:i},{state:{isGhost:!0}}),m=yield l.dataFormats.get(o).parse(l,p,{entryId:s}),h=m.volume||m.volumes[0];if(!h?.isOk)throw new Error("Failed to parse any volume.");const g=l.build();for(const y of a)g.to(null!==(d=null===(c=m.volumes)||void 0===c?void 0:c[null!==(u=y.volumeIndex)&&void 0!==u?u:0])&&void 0!==d?d:m.volume).apply(at.Representation.VolumeRepresentation3D,UA(n.plugin,h.data,{type:"isosurface",typeParams:{alpha:null!==(f=y.alpha)&&void 0!==f?f:1,isoValue:"absolute"===y.type?{kind:"absolute",absoluteValue:y.value}:{kind:"relative",relativeValue:y.value}},color:"uniform",colorParams:{value:y.color}}));yield g.commit(),yield l.build().delete(t).commit()}))}finally{n.setState({isBusy:!1,loadingLabel:void 0})}})()}renderControls(){const t=this.state.isBusy||this.isEmpty,n=this.label,r=this.plugin.managers.volume.hierarchy.selection;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",style:{marginTop:"1px"},children:[(0,L.jsx)(ir,{noOverflow:!0,flex:!0,onClick:this.toggleHierarchy,disabled:t,title:n,children:n}),!this.isEmpty&&r&&(0,L.jsx)(kn,{svg:FA,onClick:this.toggleAddRepr,title:"Apply a structure presets to the current hierarchy.",toggleState:"add-repr"===this.state.show,disabled:t})]}),"hierarchy"===this.state.show&&(0,L.jsx)(Hn,{items:this.hierarchyItems,onSelect:this.selectCurrent}),"add-repr"===this.state.show&&(0,L.jsx)(Hn,{items:this.addActions,onSelect:this.selectAdd}),r&&r.representations.length>0&&(0,L.jsx)("div",{style:{marginTop:"6px"},children:r.representations.map(i=>(0,L.jsx)(ATt,{representation:i},i.cell.transform.ref))})]})}}class ATt extends bl{constructor(){super(...arguments),this.state={action:void 0},this.remove=()=>this.plugin.managers.volume.hierarchy.remove([this.props.representation],!0),this.toggleVisible=t=>{t.preventDefault(),t.currentTarget.blur(),this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation])},this.toggleColor=()=>{this.setState({action:"select-color"===this.state.action?void 0:"select-color"})},this.toggleUpdate=()=>this.setState({action:"update"===this.state.action?void 0:"update"}),this.highlight=t=>{t.preventDefault(),this.props.representation.cell.parent&&jt.Interactivity.Object.Highlight(this.plugin,{state:this.props.representation.cell.parent,ref:this.props.representation.cell.transform.ref})},this.clearHighlight=t=>{t.preventDefault(),jt.Interactivity.ClearHighlights(this.plugin)},this.focus=()=>{var t;const n=this.props.representation,r=null===(t=n.cell.obj)||void 0===t?void 0:t.data.repr.getAllLoci();n.cell.state.isHidden&&this.plugin.managers.volume.hierarchy.toggleVisibility([this.props.representation],"show"),r&&this.plugin.managers.camera.focusLoci(r,{extraRadius:1})},this.updateColor=({value:t})=>{const n=this.props.representation.cell.transform;return this.plugin.build().to(n.ref).update({...n.params,colorTheme:{name:"uniform",params:{value:t}}}).commit()}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{L1.ObjectEvent.isCell(t,this.props.representation.cell)&&this.forceUpdate()})}get color(){var t,n;const r=this.props.representation.cell;if("uniform"===(null===(t=r.transform.params)||void 0===t?void 0:t.colorTheme.name))return null===(n=r.transform.params)||void 0===n?void 0:n.colorTheme.params.value}render(){var t,n,r;const i=this.props.representation.cell,o=this.color;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[void 0!==o&&(0,L.jsx)(ir,{style:{backgroundColor:st.toStyle(o),minWidth:32,width:32},onClick:this.toggleColor}),(0,L.jsxs)(ir,{noOverflow:!0,className:"msp-control-button-label",title:`${null===(t=i.obj)||void 0===t?void 0:t.label}. Click to focus.`,onClick:this.focus,onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{textAlign:"left"},children:[null===(n=i.obj)||void 0===n?void 0:n.label,(0,L.jsx)("small",{className:"msp-25-lower-contrast-text",style:{float:"right"},children:null===(r=i.obj)||void 0===r?void 0:r.description})]}),(0,L.jsx)(kn,{svg:i.state.isHidden?c2:u2,toggleState:!1,onClick:this.toggleVisible,title:(i.state.isHidden?"Show":"Hide")+" component",small:!0,className:"msp-form-control",flex:!0}),(0,L.jsx)(kn,{svg:qp,onClick:this.remove,title:"Remove",small:!0}),(0,L.jsx)(kn,{svg:l2,onClick:this.toggleUpdate,title:"Actions",toggleState:"update"===this.state.action})]}),"update"===this.state.action&&!!i.parent&&(0,L.jsx)("div",{style:{marginBottom:"6px"},className:"msp-accent-offset",children:(0,L.jsx)(ab,{state:i.parent,transform:i.transform,customHeader:"none",noMargin:!0})}),"select-color"===this.state.action&&void 0!==o&&(0,L.jsx)("div",{style:{marginBottom:"6px",marginTop:1},className:"msp-accent-offset",children:(0,L.jsx)(Fg,{header:"Select Color",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleColor,topRightIcon:Rg,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,L.jsx)(Ube,{param:ITt,value:this.color,onChange:this.updateColor,name:"color",hideNameRow:!0})})})]})}}const ITt=I.Color(st(1184274));var xB,lb;function y2e(e,t){if(Math.abs(e)>Math.abs(t)){const n=t/e;return Math.abs(e)*Math.sqrt(1+n*n)}if(0!==t){const n=e/t;return Math.abs(t)*Math.sqrt(1+n*n)}return 0}!function(e){e.createCache=function t(r){return{size:r,matrix:Zr.create(r,r),eigenValues:new Float64Array(r),D:new Float64Array(r),E:new Float64Array(r)}},e.compute=function n(r){!function ETt(e,t,n,r,i){for(let s=0;s<e;s++)i[s]=0;const o=e-1;for(let s=0;s<e;s++)r[s]=t[s*e+o];(function TTt(e,t,n,r){for(let i=r-1;i>0;i--){let o=0,s=0;for(let a=0;a<i;a++)o+=Math.abs(t[a]);if(0===o){n[i]=t[i-1];for(let a=0;a<i;a++)t[a]=e[a*r+i-1],e[a*r+i]=0,e[i*r+a]=0}else{for(let u=0;u<i;u++)t[u]/=o,s+=t[u]*t[u];let a=t[i-1],l=Math.sqrt(s);a>0&&(l=-l),n[i]=o*l,s-=a*l,t[i-1]=a-l;for(let u=0;u<i;u++)n[u]=0;for(let u=0;u<i;u++){a=t[u],e[i*r+u]=a,l=n[u]+e[u*r+u]*a;for(let d=u+1;d<=i-1;d++)l+=e[u*r+d]*t[d],n[d]+=e[u*r+d]*a;n[u]=l}a=0;for(let u=0;u<i;u++)n[u]/=s,a+=n[u]*t[u];const c=a/(s+s);for(let u=0;u<i;u++)n[u]-=c*t[u];for(let u=0;u<i;u++){a=t[u],l=n[u];for(let d=u;d<=i-1;d++)e[u*r+d]-=a*n[d]+l*t[d];t[u]=e[u*r+i-1],e[u*r+i]=0}}t[i]=s}for(let i=0;i<r-1;i++){e[i*r+r-1]=e[i*r+i],e[i*r+i]=1;const o=t[i+1];if(0!==o){for(let s=0;s<=i;s++)t[s]=e[(i+1)*r+s]/o;for(let s=0;s<=i;s++){let a=0;for(let l=0;l<=i;l++)a+=e[(i+1)*r+l]*e[s*r+l];for(let l=0;l<=i;l++)e[s*r+l]-=a*t[l]}}for(let s=0;s<=i;s++)e[(i+1)*r+s]=0}for(let i=0;i<r;i++)t[i]=e[i*r+r-1],e[i*r+r-1]=0;e[r*r-1]=1,n[0]=0})(t,r,i,e),function DTt(e,t,n,r){for(let l=1;l<r;l++)n[l-1]=n[l];n[r-1]=0;let o=0,s=0;const a=Math.pow(2,-53);for(let l=0;l<r;l++){s=Math.max(s,Math.abs(t[l])+Math.abs(n[l]));let c=l;for(;c<r&&!(Math.abs(n[c])<=a*s);)c++;if(c>l){let u=0;do{u+=1;let d=t[l],f=(t[l+1]-d)/(2*n[l]),p=y2e(f,1);f<0&&(p=-p),t[l]=n[l]/(f+p),t[l+1]=n[l]*(f+p);const m=t[l+1];let h=d-t[l];for(let A=l+2;A<r;A++)t[A]-=h;o+=h,f=t[c];let g=1,y=g,v=g;const x=n[l+1];let _=0,w=0;for(let A=c-1;A>=l;A--){v=y,y=g,w=_,d=g*n[A],h=g*f,p=y2e(f,n[A]),n[A+1]=_*p,_=n[A]/p,g=f/p,f=g*t[A]-_*d,t[A+1]=h+_*(g*d+_*t[A]);for(let M=0;M<r;M++)h=e[(A+1)*r+M],e[(A+1)*r+M]=_*e[A*r+M]+g*h,e[A*r+M]=g*e[A*r+M]-_*h}if(f=-_*w*v*x*n[l]/m,n[l]=_*f,t[l]=g*f,u>=1e3)throw new Error("SVD: Not converging.")}while(Math.abs(n[l])>a*s)}t[l]=t[l]+o,n[l]=0}for(let l=0;l<r-1;l++){let c=l,u=t[l];for(let d=l+1;d<r;d++)t[d]<u&&(c=d,u=t[d]);if(c!==l){t[c]=t[l],t[l]=u;for(let d=0;d<r;d++)u=e[l*r+d],e[l*r+d]=e[c*r+d],e[c*r+d]=u}}}(t,r,i,e);for(let s=0;s<e;s++)n[s]=r[s]}(r.size,r.matrix.data,r.eigenValues,r.D,r.E)}}(xB||(xB={})),function(e){let t;(t=e.Positions||(e.Positions={})).empty=function i(o){return{x:new Float64Array(o),y:new Float64Array(o),z:new Float64Array(o)}},e.compute=function n(r,i){return typeof i>"u"&&(i={bTransform:fe.zero(),rmsd:0}),function RTt(e){const t=function kTt(e){const t=e.evdCache.matrix;Zr.makeZero(t);const n=e.a.x,r=e.a.y,i=e.a.z,o=e.b.x,s=e.b.y,a=e.b.z,l=e.centerA,c=e.centerB;let u=0;for(let d=0,f=e.a.x.length;d<f;d++){const p=n[d]-l[0],m=r[d]-l[1],h=i[d]-l[2],g=o[d]-c[0],y=s[d]-c[1],v=a[d]-c[2];u+=p*p+m*m+h*h+g*g+y*y+v*v,Zr.add(t,0,0,p*g+m*y+h*v),Zr.add(t,0,1,-h*y+m*v),Zr.add(t,0,2,h*g-p*v),Zr.add(t,0,3,-m*g+p*y),Zr.add(t,1,0,-h*y+m*v),Zr.add(t,1,1,p*g-m*y-h*v),Zr.add(t,1,2,m*g+p*y),Zr.add(t,1,3,h*g+p*v),Zr.add(t,2,0,h*g-p*v),Zr.add(t,2,1,m*g+p*y),Zr.add(t,2,2,-p*g+m*y-h*v),Zr.add(t,2,3,h*y+m*v),Zr.add(t,3,0,-m*g+p*y),Zr.add(t,3,1,h*g+p*v),Zr.add(t,3,2,h*y+m*v),Zr.add(t,3,3,-p*g-m*y+h*v)}return u}(e);xB.compute(e.evdCache);let n=t-2*e.evdCache.eigenValues[3];n=n<0?0:Math.sqrt(n/e.a.x.length),function MTt(e){const t=e.evdCache.matrix,n=Zr.get(t,1,3),r=Zr.get(t,2,3),i=Zr.get(t,3,3),o=Zr.get(t,0,3),s=2*r*r,a=2*i*i,l=2*n*n,c=2*n*r,u=2*o*i,d=2*n*i,f=2*o*r,p=2*r*i,m=2*o*n;let h=e.translateB;fe.setValue(h,0,3,-e.centerB[0]),fe.setValue(h,1,3,-e.centerB[1]),fe.setValue(h,2,3,-e.centerB[2]),h=e.rotateB,fe.setValue(h,0,0,1-s-a),fe.setValue(h,0,1,c+u),fe.setValue(h,0,2,d-f),fe.setValue(h,1,0,c-u),fe.setValue(h,1,1,1-l-a),fe.setValue(h,1,2,p+m),fe.setValue(h,2,0,d+f),fe.setValue(h,2,1,p-m),fe.setValue(h,2,2,1-l-s),fe.setValue(h,3,3,1),fe.mul(e.tempMatrix,e.rotateB,e.translateB),h=e.translateB,fe.setValue(h,0,3,e.centerA[0]),fe.setValue(h,1,3,e.centerA[1]),fe.setValue(h,2,3,e.centerA[2]),fe.mul(e.result.bTransform,e.translateB,e.tempMatrix)}(e),e.result.rmsd=n}(new PTt(r,i)),i}}(lb||(lb={}));class PTt{constructor(t,n){this.evdCache=xB.createCache(4),this.translateB=fe.identity(),this.rotateB=fe.identity(),this.tempMatrix=fe.identity(),this.a=t.a,this.b=t.b,this.centerA=t.centerA?t.centerA:t.centerA=X0.fromArrays(t.a,ke()).center,this.centerB=t.centerB?t.centerB:t.centerB=X0.fromArrays(t.b,ke()).center,this.result=n}}function b2e(e,t){let n,r=0;const i={};return t.forEach(o=>{n=0;const s={};o.forEach(a=>s[e[n++]]=a),i[e[r++]]=s}),i}const LTt={blosum62:b2e("ARNDCQEGHILKMFPSTWYVBZX",[[4,-1,-2,-2,0,-1,-1,0,-2,-1,-1,-1,-1,-2,-1,1,0,-3,-2,0,-2,-1,0],[-1,5,0,-2,-3,1,0,-2,0,-3,-2,2,-1,-3,-2,-1,-1,-3,-2,-3,-1,0,-1],[-2,0,6,1,-3,0,0,0,1,-3,-3,0,-2,-3,-2,1,0,-4,-2,-3,3,0,-1],[-2,-2,1,6,-3,0,2,-1,-1,-3,-4,-1,-3,-3,-1,0,-1,-4,-3,-3,4,1,-1],[0,-3,-3,-3,9,-3,-4,-3,-3,-1,-1,-3,-1,-2,-3,-1,-1,-2,-2,-1,-3,-3,-2],[-1,1,0,0,-3,5,2,-2,0,-3,-2,1,0,-3,-1,0,-1,-2,-1,-2,0,3,-1],[-1,0,0,2,-4,2,5,-2,0,-3,-3,1,-2,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-2,0,-1,-3,-2,-2,6,-2,-4,-4,-2,-3,-3,-2,0,-2,-2,-3,-3,-1,-2,-1],[-2,0,1,-1,-3,0,0,-2,8,-3,-3,-1,-2,-1,-2,-1,-2,-2,2,-3,0,0,-1],[-1,-3,-3,-3,-1,-3,-3,-4,-3,4,2,-3,1,0,-3,-2,-1,-3,-1,3,-3,-3,-1],[-1,-2,-3,-4,-1,-2,-3,-4,-3,2,4,-2,2,0,-3,-2,-1,-2,-1,1,-4,-3,-1],[-1,2,0,-1,-3,1,1,-2,-1,-3,-2,5,-1,-3,-1,0,-1,-3,-2,-2,0,1,-1],[-1,-1,-2,-3,-1,0,-2,-3,-2,1,2,-1,5,0,-2,-1,-1,-1,-1,1,-3,-1,-1],[-2,-3,-3,-3,-2,-3,-3,-3,-1,0,0,-3,0,6,-4,-2,-2,1,3,-1,-3,-3,-1],[-1,-2,-2,-1,-3,-1,-1,-2,-2,-3,-3,-1,-2,-4,7,-1,-1,-4,-3,-2,-2,-1,-2],[1,-1,1,0,-1,0,0,0,-1,-2,-2,0,-1,-2,-1,4,1,-3,-2,-2,0,0,0],[0,-1,0,-1,-1,-1,-1,-2,-2,-1,-1,-1,-1,-2,-1,1,5,-2,-2,0,-1,-1,0],[-3,-3,-4,-4,-2,-2,-3,-2,-2,-3,-2,-3,-1,1,-4,-3,-2,11,2,-3,-4,-3,-2],[-2,-2,-2,-3,-2,-1,-2,-3,2,-1,-1,-2,-1,3,-3,-2,-2,2,7,-1,-3,-2,-1],[0,-3,-3,-3,-1,-2,-2,-3,-3,3,1,-2,1,-1,-2,-2,0,-3,-1,4,-3,-2,-1],[-2,-1,3,4,-3,0,1,-1,0,-3,-4,0,-3,-3,-2,0,-1,-4,-3,-3,4,1,-1],[-1,0,0,1,-3,3,4,-2,0,-3,-3,1,-1,-3,-1,0,-1,-3,-2,-2,1,4,-1],[0,-1,-1,-1,-2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-2,0,0,-2,-1,-1,-1,-1,-1]]),blosum62x:b2e("ACDEFGHIKLMNPQRSTVWY",[[4,0,-2,-1,-2,0,-2,-1,-1,-1,-1,-2,-1,-1,-1,1,0,0,-3,-2],[0,9,-3,-4,-2,-3,-3,-1,-3,-1,-1,-3,-3,-3,-3,-1,-1,-1,-2,-2],[-2,-3,6,2,-3,-1,-1,-3,-1,-4,-3,1,-1,0,-2,0,-1,-3,-4,-3],[-1,-4,2,5,-3,-2,0,-3,1,-3,-2,0,-1,2,0,0,-1,-2,-3,-2],[-2,-2,-3,-3,6,-3,-1,0,-3,0,0,-3,-4,-3,-3,-2,-2,-1,1,3],[0,-3,-1,-2,-3,6,-2,-4,-2,-4,-3,0,-2,-2,-2,0,-2,-3,-2,-3],[-2,-3,-1,0,-1,-2,8,-3,-1,-3,-2,1,-2,0,0,-1,-2,-3,-2,2],[-1,-1,-3,-3,0,-4,-3,4,-3,2,1,-3,-3,-3,-3,-2,-1,3,-3,-1],[-1,-3,-1,1,-3,-2,-1,-3,5,-2,-1,0,-1,1,2,0,-1,-2,-3,-2],[-1,-1,-4,-3,0,-4,-3,2,-2,4,2,-3,-3,-2,-2,-2,-1,1,-2,-1],[-1,-1,-3,-2,0,-3,-2,1,-1,2,5,-2,-2,0,-1,-1,-1,1,-1,-1],[-2,-3,1,0,-3,0,1,-3,0,-3,-2,6,-2,0,0,1,0,-3,-4,-2],[-1,-3,-1,-1,-4,-2,-2,-3,-1,-3,-2,-2,7,-1,-2,-1,-1,-2,-4,-3],[-1,-3,0,2,-3,-2,0,-3,1,-2,0,0,-1,5,1,0,-1,-2,-2,-1],[-1,-3,-2,0,-3,-2,0,-3,2,-2,-1,0,-2,1,5,-1,-1,-3,-3,-2],[1,-1,0,0,-2,0,-1,-2,0,-2,-1,1,-1,0,-1,4,1,-2,-3,-2],[0,-1,-1,-1,-2,-2,-2,-1,-1,-1,-1,0,-1,-1,-1,1,5,0,-2,-2],[0,-1,-3,-2,-1,-3,-3,3,-2,1,1,-3,-2,-2,-3,-2,0,4,-3,-1],[-3,-2,-4,-3,1,-2,-2,-3,-3,-2,-1,-4,-4,-2,-3,-3,-2,-3,11,2],[-2,-2,-3,-2,3,-3,2,-1,-2,-1,-1,-2,-3,-1,-2,-2,-2,-1,2,7]])},jTt={gapPenalty:-11,gapExtensionPenalty:-1,substMatrix:"default"};class zTt{constructor(t,n,r){this.seqA=t,this.seqB=n,this.S=[],this.V=[],this.H=[],this.gapPenalty=r.gapPenalty,this.gapExtensionPenalty=r.gapExtensionPenalty,this.substMatrix="default"===r.substMatrix?void 0:LTt[r.substMatrix],this.n=this.seqA.length,this.m=this.seqB.length}initMatrices(){const{n:t,m:n,gapPenalty:r,S:i,V:o,H:s}=this;for(let a=0;a<=t;++a){i[a]=[],o[a]=[],s[a]=[];for(let l=0;l<=n;++l)i[a][l]=0,o[a][l]=0,s[a][l]=0}for(let a=0;a<=t;++a)i[a][0]=r,s[a][0]=-1/0;for(let a=0;a<=n;++a)i[0][a]=r,o[0][a]=-1/0;i[0][0]=0}makeScoreFn(){const{seqA:t,seqB:n,substMatrix:r}=this;return r?function(o,s){var a,l;return null!==(l=null===(a=r[t[o]])||void 0===a?void 0:a[n[s]])&&void 0!==l?l:-4}:function(o,s){return t[o]===n[s]?5:-3}}calculate(){this.initMatrices();const t=this.makeScoreFn(),{V:n,H:r,S:i,n:o,m:s,gapExtensionPenalty:a,gapPenalty:l}=this;let c,u,d,f,p;for(let m=1;m<=o;++m){u=i[m-1],c=n[m-1],d=n[m],f=r[m],p=i[m];for(let h=1;h<=s;++h)d[h]=Math.max(u[h]+l,c[h]+a),f[h]=Math.max(p[h-1]+l,f[h-1]+a),p[h]=Math.max(u[h-1]+t(m-1,h-1),d[h],f[h])}}trace(){const t=this.makeScoreFn(),{V:n,H:r,S:i,seqA:o,seqB:s,gapExtensionPenalty:a,gapPenalty:l}=this;let d,f,c=this.n,u=this.m,p="",m="";for(i[c][u]>=n[c][u]?(d="S",f=i[c][u]):n[c][u]>=r[c][u]?(d="V",f=n[c][u]):(d="H",f=r[c][u]);c>0&&u>0;)"S"===d?i[c][u]===i[c-1][u-1]+t(c-1,u-1)?(p=o[c-1]+p,m=s[u-1]+m,--c,--u,d="S"):i[c][u]===n[c][u]?d="V":i[c][u]===r[c][u]?d="H":(--c,--u):"V"===d?n[c][u]===n[c-1][u]+a?(p=o[c-1]+p,m="-"+m,--c,d="V"):n[c][u]===i[c-1][u]+l?(p=o[c-1]+p,m="-"+m,--c,d="S"):--c:"H"===d&&(r[c][u]===r[c][u-1]+a?(p="-"+p,m=s[u-1]+m,--u,d="H"):r[c][u]===i[c][u-1]+l?(p="-"+p,m=s[u-1]+m,--u,d="S"):--u);for(;c>0;)p=o[c-1]+p,m="-"+m,--c;for(;u>0;)p="-"+p,m=s[u-1]+m,--u;return{aliA:p,aliB:m,score:f}}}var qX;function v2e(e){return e.model.sequence.byEntityKey[function VTt(e){switch(e.kind){case 0:return e.model.atomicHierarchy.index.getEntityFromChain(e.chainIndex[e.elements[0]]);case 1:return e.model.coarseHierarchy.spheres.entityKey[e.elements[0]];case 2:return e.model.coarseHierarchy.gaussians.entityKey[e.elements[0]]}}(e)].sequence}function x2e(e){const t=[];if(e.length<=0)return t;const n=function qTt(e){if(0===e.length)return 0;let t=Me.size(e[0]);for(let n=1;n<e.length;n++){const r=Me.size(e[n]);r<t&&(t=r)}return t}(e),r={a:sk(e[0],n),b:sk(e[1],n)};t[0]=lb.compute(r);for(let i=2;i<e.length;i++)r.b=sk(e[i],n),r.centerB=void 0,t.push(lb.compute(r));return t}!function(e){function t(r){const i=new Map;if(ze.isAtomic(r.unit)){const{label_seq_id:o}=r.unit.model.atomicHierarchy.residues,{residueIndex:s}=r.unit;for(let a=0,l=Ve.size(r.indices);a<l;++a){const c=Ve.getAt(r.indices,a),d=o.value(s[r.unit.elements[c]]);i.has(d)?i.get(d).push(c):i.set(d,[c])}}else if(ze.isCoarse(r.unit)){const{seq_id_begin:o}=ze.isSpheres(r.unit)?r.unit.model.coarseHierarchy.spheres:r.unit.model.coarseHierarchy.gaussians;for(let s=0,a=Ve.size(r.indices);s<a;++s){const l=Ve.getAt(r.indices,s),u=o.value(r.unit.elements[l]);i.set(u,[l])}}return i}e.createSeqIdIndicesMap=t,e.compute=function n(r,i={}){const o=v2e(r.a.unit),s=v2e(r.b.unit),a=t(r.a),l=t(r.b),c=[],u=[],{aliA:d,aliB:f,score:p}=function UTt(e,t,n={}){const r={...jTt,...n},i=new zTt(e,t,r);return i.calculate(),i.trace()}(o.code.toArray(),s.code.toArray(),i);let m=0,h=0;for(let v=0,x=d.length;v<x;++v){if("-"===d[v]||"-"===f[v]){"-"!==d[v]&&(m+=1),"-"!==f[v]&&(h+=1);continue}const _=o.seqId.value(m),w=s.seqId.value(h);if(a.has(_)&&l.has(w)){const A=a.get(_),M=l.get(w);for(let E=0,D=Math.min(A.length,M.length);E<D;++E)c.push(A[E]),u.push(M[E])}m+=1,h+=1}const g=Ve.intersect(Ve.ofSortedArray(c),r.a.indices),y=Ve.intersect(Ve.ofSortedArray(u),r.b.indices);return{a:{unit:r.a.unit,indices:g},b:{unit:r.b.unit,indices:y},score:p}}}(qX||(qX={}));const HTt=/(polypeptide|cyclic-pseudo-peptide)/i;function sk(e,t){const n=lb.Positions.empty(t);let r=0;for(const i of e.elements){const{unit:o,indices:s}=i,{elements:a,conformation:l}=o;for(let c=0,u=Ve.size(s);c<u;c++){const d=a[Ve.getAt(s,c)];if(n.x[r]=l.x(d),n.y[r]=l.y(d),n.z[r]=l.z(d),r++,r>=t)break}if(r>=t)break}return n}function $Tt(e,t,n,r){const i=lb.Positions.empty(r),o=lb.Positions.empty(r);let s=0;for(const{pivots:a}of e){const l=a[t],c=a[n];if(!l||!c)continue;const u=Math.min(l[2]-l[1],c[2]-c[1]);for(let d=0;d<u;d++){let f=l[1]+d;i.x[s]=l[0].conformation.x(f),i.y[s]=l[0].conformation.y(f),i.z[s]=l[0].conformation.z(f),f=c[1]+d,o.x[s]=c[0].conformation.x(f),o.y[s]=c[0].conformation.y(f),o.z[s]=c[0].conformation.z(f),s++}}return[i,o]}function XTt(){return!0}function KTt(e,t,n,r,i){const o=dt.create(e);for(const s of e.units){if(0!==s.kind)continue;const{elements:a,model:l}=s;o.unit=s;const c=yp.Provider.get(l).value;if(!c)return;const{dbName:u,accession:d,num:f}=c,p=En.transientSegments(s.model.atomicHierarchy.chainAtomSegments,a),m=En.transientSegments(s.model.atomicHierarchy.residueAtomSegments,a),h=s.model.atomicHierarchy.derived.residue.traceElementIndex;for(;p.hasNext;){const g=p.move();for(m.setSegment(g);m.hasNext;){const y=m.move(),v=y.index;if(!u[v])continue;const x=h[v];let _,w;if(r){if(_=x,-1===_)continue;w=_+1}else _=a[y.start],w=a[y.end-1]+1;if(o.element=x>=0?x:_,!i(o,v,_,w))continue;const A=`${u[v]}-${d[v]}-${f[v]}`;if(t.has(A)){const M=t.get(A);M.pivots[n]||(M.pivots[n]=[s,_,w])}else t.set(A,{key:A,pivots:{[n]:[s,_,w]}})}}}}class ZTt extends d2{defaultState(){return{isCollapsed:!1,header:"Superposition",brand:{accent:"gray",svg:Abt},isHidden:!0}}componentDidMount(){this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{this.setState({isHidden:t.structures.length<2})})}renderControls(){return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(e3t,{})})}}const _2e={alignSequences:I.Boolean(!0,{isEssential:!0,description:"For Chain-based 3D superposition, perform a sequence alignment and use the aligned residue pairs to guide the 3D superposition."}),traceOnly:I.Boolean(!0,{description:"For Chain- and Uniprot-based 3D superposition, base superposition only on CA (and equivalent) atoms."})},QTt=I.getDefaultValues(_2e);class e3t extends bl{constructor(){var t;super(...arguments),t=this,this.state={isBusy:!1,canUseDb:!1,action:void 0,options:QTt},this.superposeChains=le(function*(){var n,r,i;const{query:o}=t.state.options.traceOnly?Ps.trace:Ps.polymer,s=t.chainEntries,a=s.map(f=>{const p=Me.toStructure(f.loci),m=Dt.toLociWithSourceUnits(o(new _f(p)));return Me.remap(m,t.getRootStructure(f.loci.structure))}),l=t.plugin.managers.structure.hierarchy.findStructure(null===(n=a[0])||void 0===n?void 0:n.structure),c=null===(i=null===(r=l?.transform)||void 0===r?void 0:r.cell.obj)||void 0===i?void 0:i.data.coordinateSystem,u=t.state.options.alignSequences?function GTt(e){const t=[];if(e.length<=0)return t;const n=Me.getFirstLocation(e[0]),i=Je.entity.subtype(n).match(HTt)?"blosum62":"default";for(let o=1;o<e.length;o++){const{a:s,b:a,score:l}=qX.compute({a:e[0].elements[0],b:e[o].elements[0]},{substMatrix:i}),c=Me(e[0].structure,[s]),u=Me(e[o].structure,[a]),d=Ve.size(s.indices);t.push({...lb.compute({a:sk(c,d),b:sk(u,d)}),alignmentScore:l})}return t}(a):x2e(a),d=s[0];for(let f=1,p=a.length;f<p;++f){const m=s[f],{bTransform:h,rmsd:g}=u[f-1];yield t.transform(m.cell,h,c);const y=b1(d.label),v=b1(m.label);t.plugin.log.info(`Superposed [${y}] and [${v}] with RMSD ${g.toFixed(2)}.`)}yield t.cameraReset()}),this.superposeAtoms=le(function*(){var n,r,i;const o=t.atomEntries,s=o.map(d=>Me.remap(d.loci,t.getRootStructure(d.loci.structure))),a=x2e(s),l=t.plugin.managers.structure.hierarchy.findStructure(null===(n=s[0])||void 0===n?void 0:n.structure),c=null===(i=null===(r=l?.transform)||void 0===r?void 0:r.cell.obj)||void 0===i?void 0:i.data.coordinateSystem,u=o[0];for(let d=1,f=s.length;d<f;++d){const p=o[d],{bTransform:m,rmsd:h}=a[d-1];yield t.transform(p.cell,m,c);const g=b1(u.label),y=b1(p.label),v=o[d].atoms.length;t.plugin.log.info(`Superposed ${v} ${1===v?"atom":"atoms"} of [${g}] and [${y}] with RMSD ${h.toFixed(2)}.`)}yield t.cameraReset()}),this.superposeDb=le(function*(){var n,r,i;const o=t.plugin.managers.structure.hierarchy.behaviors.selection.value.structures,s=t.state.options.traceOnly,a=o.map(m=>{var h;return null===(h=m.cell.obj)||void 0===h?void 0:h.data}),{entries:l,failedPairs:c,zeroOverlapPairs:u}=function WTt(e,t){var n,r;const i=new Map;for(let u=0;u<e.length;u++)KTt(e[u],i,u,null===(n=t?.traceOnly)||void 0===n||n,null!==(r=t?.includeResidueTest)&&void 0!==r?r:XTt);const o=Array.from(i.values()),s=function YTt(e,t){const n=[];for(let i=0;i<e;i++){n[i]=[];for(let o=0;o<e;o++)n[i][o]=0}for(const{pivots:i}of t)for(let o=0;o<e;o++){if(!i[o])continue;const s=i[o][2]-i[o][1];for(let a=o+1;a<e;a++)i[a]&&(n[o][a]=n[o][a]+Math.min(s,i[a][2]-i[a][1]))}const r=[];for(let i=1;i<e;i++)r[i-1]={i:0,j:i,count:n[0][i]};return r}(e.length,o),a=[],l=[],c=[];for(const u of s)if(0===u.count)a.push([u.i,u.j]);else{const[d,f]=$Tt(o,u.i,u.j,u.count),p=lb.compute({a:d,b:f});Number.isNaN(p.rmsd)?l.push([u.i,u.j]):c.push({transform:p,pivot:u.i,other:u.j})}return{entries:c,zeroOverlapPairs:a,failedPairs:l}}(a,{traceOnly:s}),d=null===(i=null===(r=null===(n=o[0])||void 0===n?void 0:n.transform)||void 0===r?void 0:r.cell.obj)||void 0===i?void 0:i.data.coordinateSystem;let f=0;for(const m of l)yield t.transform(o[m.other].cell,m.transform.bTransform,d),f+=m.transform.rmsd;f/=Math.max(l.length-1,1);const p=m=>`[${m.map(([h,g])=>`(${a[h].models[0].entryId}, ${a[g].models[0].entryId})`).join(", ")}]`;u.length&&t.plugin.log.warn(`Superposition: No UNIPROT mapping overlap between structures ${p(u)}.`),c.length&&t.plugin.log.error(`Superposition: Failed to superpose structures ${p(c)}.`),l.length&&(t.plugin.log.info(`Superposed ${l.length+1} structures with avg. RMSD ${f.toFixed(2)} \xc5.`),yield t.cameraReset())}),this.toggleByChains=()=>this.setState({action:"byChains"===this.state.action?void 0:"byChains"}),this.toggleByAtoms=()=>this.setState({action:"byAtoms"===this.state.action?void 0:"byAtoms"}),this.toggleOptions=()=>this.setState({action:"options"===this.state.action?void 0:"options"}),this.setOptions=n=>{this.setState({options:n})}}componentDidMount(){this.subscribe(this.selection.events.changed,()=>{this.forceUpdate()}),this.subscribe(this.selection.events.additionsHistoryUpdated,()=>{this.forceUpdate()}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState({isBusy:t})}),this.subscribe(this.plugin.managers.structure.hierarchy.behaviors.selection,t=>{this.setState({canUseDb:t.structures.every(n=>{var r;return!(null===(r=n.cell.obj)||void 0===r||!r.data)&&n.cell.obj.data.models.some(i=>yp.Provider.isApplicable(i))})})})}get selection(){return this.plugin.managers.structure.selection}transform(t,n,r){var i=this;return le(function*(){const o=_a.resolveAndCheck(i.plugin.state.data,t);if(!o)return;const s=i.plugin.state.data.selectQ(u=>u.byRef(o.transform.ref).subtree().withTransformer(at.Model.TransformStructureConformation))[0],l={transform:{name:"matrix",params:{data:r&&!fe.isIdentity(r.matrix)?fe.mul(fe(),r.matrix,n):n,transpose:!1}}},c=s?i.plugin.state.data.build().to(s).update(l):i.plugin.state.data.build().to(t).insert(at.Model.TransformStructureConformation,l,{tags:"SuperpositionTransform"});yield i.plugin.runTask(i.plugin.state.data.updateTree(c))})()}getRootStructure(t){var n;const r=this.plugin.helpers.substructureParent.get(t);return null===(n=this.plugin.state.data.selectQ(i=>i.byValue(r).rootOfType(Se.Molecule.Structure))[0].obj)||void 0===n?void 0:n.data}cameraReset(){var t=this;return le(function*(){yield new Promise(n=>requestAnimationFrame(n)),jt.Camera.Reset(t.plugin)})()}highlight(t){this.plugin.managers.interactivity.lociHighlights.highlightOnly({loci:t},!1)}moveHistory(t,n){this.plugin.managers.structure.selection.modifyHistory(t,n,void 0,!0)}focusLoci(t){this.plugin.managers.camera.focusLoci(t)}lociEntry(t,n){return(0,L.jsx)("div",{className:"msp-flex-row",children:(0,L.jsx)(ir,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(t.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(t.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:(0,L.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}})})},n)}historyEntry(t,n){const r=this.plugin.managers.structure.selection.additionsHistory;return(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsxs)(ir,{noOverflow:!0,title:"Click to focus. Hover to highlight.",onClick:()=>this.focusLoci(t.loci),style:{width:"auto",textAlign:"left"},onMouseEnter:()=>this.highlight(t.loci),onMouseLeave:()=>this.plugin.managers.interactivity.lociHighlights.clearHighlights(),children:[n,". ",(0,L.jsx)("span",{dangerouslySetInnerHTML:{__html:t.label}})]}),r.length>1&&(0,L.jsx)(kn,{svg:pO,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"up"),flex:"20px",title:"Move up"}),r.length>1&&(0,L.jsx)(kn,{svg:fO,small:!0,className:"msp-form-control",onClick:()=>this.moveHistory(t,"down"),flex:"20px",title:"Move down"}),(0,L.jsx)(kn,{svg:qp,small:!0,className:"msp-form-control",onClick:()=>this.plugin.managers.structure.selection.modifyHistory(t,"remove"),flex:!0,title:"Remove"})]},t.id)}atomsLociEntry(t,n){return(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"msp-control-group-header",children:(0,L.jsx)("div",{className:"msp-no-overflow",title:t.label,children:t.label})}),(0,L.jsx)("div",{className:"msp-control-offset",children:t.atoms.map((r,i)=>this.historyEntry(r,i))})]},n)}get chainEntries(){const t=dt.create(),n=[];return this.plugin.managers.structure.selection.entries.forEach(({selection:r},i)=>{const o=_a.resolveAndCheck(this.plugin.state.data,i);if(!o||Me.isEmpty(r))return;const s=Me.getFirstLocation(r,t);if(r.elements.length>1||"polymer"!==Je.entity.type(s))return;const l=dP(Wh.ofLoci(r),{countsOnly:!0}),c=em(s,{reverse:!0,granularity:"chain"}).split("|");n.push({loci:r,label:`${l} | ${c[0]} | ${c[c.length-1]}`,cell:o})}),n}get atomEntries(){const t=new Map,n=this.plugin.managers.structure.selection.additionsHistory;for(let i=0,o=n.length;i<o;++i){const s=n[i];if(1!==Me.size(s.loci))continue;const a=s.loci.structure;t.has(a)?t.get(a).push(s):t.set(a,[s])}const r=[];return t.forEach((i,o)=>{const s=this.plugin.helpers.substructureParent.get(o),a=[];for(let u=0,d=i.length;u<d;++u)a.push(i[u].loci.elements[0]);const l=Me(i[0].loci.structure,a),c=l.structure.label.split(" | ")[0];r.push({loci:l,label:c,cell:s,atoms:i})}),r}toggleHint(){return this.plugin.config.get(ei.Viewport.ShowSelectionMode)?(0,L.jsxs)(L.Fragment,{children:[" ","(toggle ",(0,L.jsx)(VX,{inline:!0})," mode)"]}):null}addByChains(){const t=this.chainEntries;return(0,L.jsxs)(L.Fragment,{children:[t.length>0&&(0,L.jsx)("div",{className:"msp-control-offset",children:t.map((n,r)=>this.lociEntry(n,r))}),t.length<2&&(0,L.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,L.jsxs)("div",{className:"msp-help-description",children:[(0,L.jsx)(Mi,{svg:Ng,inline:!0}),"Add 2 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single polymer chains or residues therein."]})}),t.length>1&&(0,L.jsx)(ir,{title:"Superpose structures by selected chains.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeChains,style:{marginTop:"1px"},children:"Superpose"})]})}addByAtoms(){const t=this.atomEntries;return(0,L.jsxs)(L.Fragment,{children:[t.length>0&&(0,L.jsx)("div",{className:"msp-control-offset",children:t.map((n,r)=>this.atomsLociEntry(n,r))}),t.length<2&&(0,L.jsx)("div",{className:"msp-control-offset msp-help-text",children:(0,L.jsxs)("div",{className:"msp-help-description",children:[(0,L.jsx)(Mi,{svg:Ng,inline:!0}),"Add 1 or more selections",this.toggleHint()," from separate structures. Selections must be limited to single atoms."]})}),t.length>1&&(0,L.jsx)(ir,{title:"Superpose structures by selected atoms.",className:"msp-btn-commit msp-btn-commit-on",onClick:this.superposeAtoms,style:{marginTop:"1px"},children:"Superpose"})]})}superposeByDbMapping(){return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(ir,{icon:Bbe,title:"Superpose structures using intersection of residues from SIFTS UNIPROT mapping.",className:"msp-btn msp-btn-block",onClick:this.superposeDb,style:{marginTop:"1px"},disabled:this.state.isBusy,children:"Uniprot"})})}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(yl,{icon:Bbe,label:"Chains",toggle:this.toggleByChains,isSelected:"byChains"===this.state.action,disabled:this.state.isBusy}),(0,L.jsx)(yl,{icon:wbt,label:"Atoms",toggle:this.toggleByAtoms,isSelected:"byAtoms"===this.state.action,disabled:this.state.isBusy}),this.state.canUseDb&&this.superposeByDbMapping(),(0,L.jsx)(yl,{icon:uv,label:"",title:"Options",toggle:this.toggleOptions,isSelected:"options"===this.state.action,disabled:this.state.isBusy,style:{flex:"0 0 40px",padding:0}})]}),"byChains"===this.state.action&&this.addByChains(),"byAtoms"===this.state.action&&this.addByAtoms(),"options"===this.state.action&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(vs,{params:_2e,values:this.state.options,onChangeValues:this.setOptions,isDisabled:this.state.isBusy})})]})}}class t3t extends d2{defaultState(){return{isCollapsed:!1,header:"Quick Styles",brand:{accent:"gray",svg:Z0t}}}renderControls(){return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(n3t,{})})}}class n3t extends bl{default(){var t=this;return le(function*(){const{structures:n}=t.plugin.managers.structure.hierarchy.selection,r=t.plugin.config.get(ei.Structure.DefaultRepresentationPreset)||Gp.auto.id,i=t.plugin.builders.structure.representation.resolveProvider(r);if(yield t.plugin.managers.structure.component.applyPreset(n,i),t.plugin.managers.structure.component.setOptions(I.getDefaultValues(Bg.OptionsParams)),t.plugin.canvas3d){const o=I.getDefaultValues(Tq);t.plugin.canvas3d.setProps({postprocessing:{outline:o.outline,occlusion:o.occlusion}})}})()}illustrative(){var t=this;return le(function*(){const{structures:n}=t.plugin.managers.structure.hierarchy.selection;yield t.plugin.managers.structure.component.applyPreset(n,Gp.illustrative),t.plugin.canvas3d&&t.plugin.canvas3d.setProps({postprocessing:{outline:{name:"on",params:{scale:1,color:st(0),threshold:.25,includeTransparent:!0}},occlusion:{name:"on",params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,samples:32,resolutionScale:1,color:st(0)}},shadow:{name:"off",params:{}}}})})()}stylized(){var t=this;return le(function*(){if(t.plugin.managers.structure.component.setOptions({...t.plugin.managers.structure.component.state.options,ignoreLight:!0}),t.plugin.canvas3d){const n=t.plugin.canvas3d.props.postprocessing;t.plugin.canvas3d.setProps({postprocessing:{outline:{name:"on",params:"on"===n.outline.name?n.outline.params:{scale:1,color:st(0),threshold:.33,includeTransparent:!0}},occlusion:{name:"on",params:"on"===n.occlusion.name?n.occlusion.params:{multiScale:{name:"off",params:{}},radius:5,bias:.8,blurKernelSize:15,samples:32,resolutionScale:1,color:st(0)}},shadow:{name:"off",params:{}}}})}})()}render(){return(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(ir,{noOverflow:!0,title:"Applies default representation preset. Set outline and occlusion effects to defaults.",onClick:()=>this.default(),style:{width:"auto"},children:"Default"}),(0,L.jsx)(ir,{noOverflow:!0,title:"Applies no representation preset. Enables outline and occlusion effects. Enables ignore-light representation parameter.",onClick:()=>this.stylized(),style:{width:"auto"},children:"Stylized"}),(0,L.jsx)(ir,{noOverflow:!0,title:"Applies illustrative representation preset. Enables outline and occlusion effects. Enables ignore-light parameter.",onClick:()=>this.illustrative(),style:{width:"auto"},children:"Illustrative"})]})}}class r3t extends Vr{constructor(){super(...arguments),this.state={show:!1,label:""},this.update=()=>{const t=this.plugin.state.data,n=t.selectQ(s=>s.ofTransformer(at.Model.ModelFromTrajectory));if(0===n.length)return void this.setState({show:!1});let r="",i=0;const o=new Set;for(const s of n){if(!s.sourceRef)continue;const a=t.cells.get(s.sourceRef).obj;if(a&&a.data.frameCount>1){if(o.has(s.sourceRef))return void this.setState({show:!1});o.add(s.sourceRef),i++,r||(r=`Model ${s.transform.params.modelIndex+1} / ${a.data.frameCount}`)}}i>1&&(r=""),this.setState({show:i>0,label:r})},this.reset=()=>jt.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:sO.create({action:"reset"})}),this.prev=()=>jt.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:sO.create({action:"advance",by:-1})}),this.next=()=>jt.State.ApplyAction(this.plugin,{state:this.plugin.state.data,action:sO.create({action:"advance",by:1})})}componentDidMount(){this.subscribe(this.plugin.state.data.events.changed,this.update),this.subscribe(this.plugin.behaviors.state.isAnimating,this.update)}render(){const t=this.plugin.behaviors.state.isAnimating.value;return!this.state.show||t&&!this.state.label||!this.plugin.config.get(ei.Viewport.ShowTrajectoryControls)?null:(0,L.jsxs)("div",{className:"msp-traj-controls",children:[!t&&(0,L.jsx)(kn,{svg:fbt,title:"First Model",onClick:this.reset,disabled:t}),!t&&(0,L.jsx)(kn,{svg:kbe,title:"Previous Model",onClick:this.prev,disabled:t}),!t&&(0,L.jsx)(kn,{svg:Mbe,title:"Next Model",onClick:this.next,disabled:t}),!!this.state.label&&(0,L.jsx)("span",{children:this.state.label})]})}}class i3t extends Vr{constructor(){super(...arguments),this.state={isBusy:!1,show:!0},this.keyUp=t=>{if(!t.ctrlKey||this.state.isBusy||t.target!==document.body)return;const n=this.plugin.managers.snapshot;if(37===t.keyCode||"ArrowLeft"===t.key)n.state.isPlaying&&n.stop(),this.prev();else if(38===t.keyCode||"ArrowUp"===t.key){if(n.state.isPlaying&&n.stop(),0===n.state.entries.size)return;const r=n.state.entries.get(0);this.update(r.snapshot.id)}else if(39===t.keyCode||"ArrowRight"===t.key)n.state.isPlaying&&n.stop(),this.next();else if(40===t.keyCode||"ArrowDown"===t.key){if(n.state.isPlaying&&n.stop(),0===n.state.entries.size)return;const r=n.state.entries.get(n.state.entries.size-1);this.update(r.snapshot.id)}},this.change=t=>{"none"!==t.target.value&&this.update(t.target.value)},this.prev=()=>{const t=this.plugin.managers.snapshot,n=t.getNextId(t.state.current,-1);n&&this.update(n)},this.next=()=>{const t=this.plugin.managers.snapshot,n=t.getNextId(t.state.current,1);n&&this.update(n)},this.togglePlay=()=>{this.plugin.managers.snapshot.togglePlay()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate()),this.subscribe(this.plugin.behaviors.state.isBusy,t=>this.setState({isBusy:t})),this.subscribe(this.plugin.behaviors.state.isAnimating,t=>this.setState({isBusy:t})),window.addEventListener("keyup",this.keyUp,!1)}componentWillUnmount(){super.componentWillUnmount(),window.removeEventListener("keyup",this.keyUp,!1)}update(t){var n=this;return le(function*(){n.setState({isBusy:!0}),yield jt.State.Snapshots.Apply(n.plugin,{id:t}),n.setState({isBusy:!1})})()}render(){const t=this.plugin.managers.snapshot,n=t.state.entries.size;if(n<2||!this.state.show)return null;const r=t.state.current,i=t.state.isPlaying;return(0,L.jsxs)("div",{className:"msp-state-snapshot-viewport-controls",children:[(0,L.jsxs)("select",{className:"msp-form-control",value:r||"none",onChange:this.change,disabled:this.state.isBusy||i,children:[!r&&(0,L.jsx)("option",{value:"none"},"none"),t.state.entries.valueSeq().map((o,s)=>(0,L.jsxs)("option",{value:o.snapshot.id,children:[`[${s+1}/${n}]`," ",o.name||new Date(o.timestamp).toLocaleString()]},o.snapshot.id))]}),(0,L.jsx)(kn,{svg:i?Fbe:Rbe,title:i?"Pause":"Cycle States",onClick:this.togglePlay,disabled:!i&&this.state.isBusy}),!i&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(kn,{svg:kbe,title:"Previous State",onClick:this.prev,disabled:this.state.isBusy||i}),(0,L.jsx)(kn,{svg:Mbe,title:"Next State",onClick:this.next,disabled:this.state.isBusy||i})]})]})}}function o3t(){var e;const t=Yt.useContext(cm),[n,r]=Yt.useState(0);Yt.useEffect(()=>{const s=t.managers.snapshot.events.changed.subscribe(()=>r(a=>a+1));return()=>s.unsubscribe()},[t]);const i=t.managers.snapshot.state.current;if(!i)return null;const o=t.managers.snapshot.getEntry(i);return null!==(e=o?.description)&&void 0!==e&&e.trim()?(0,L.jsx)("div",{className:"msp-snapshot-description-wrapper",children:(0,L.jsx)(d2e,{skipHtml:!0,components:{a:s3t},children:o.description})}):null}function s3t({href:e,children:t,element:n}){const r=Yt.useContext(cm);return e&&"#"===e[0]?(0,L.jsx)("a",{href:"#",onClick:i=>{i.preventDefault(),r.managers.snapshot.applyKey(e.substring(1))},children:t}):n}class a3t extends Vr{constructor(){super(...arguments),this.state={isEmpty:!0,isExpanded:!1,isBusy:!1,isAnimating:!1,isPlaying:!1},this.toggleExpanded=()=>this.setState({isExpanded:!this.state.isExpanded}),this.stop=()=>{this.plugin.managers.animation.stop(),this.plugin.managers.snapshot.stop()}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>{this.setState(this.plugin.managers.snapshot.state.isPlaying?{isPlaying:!0,isExpanded:!1}:{isPlaying:!1})}),this.subscribe(this.plugin.behaviors.state.isBusy,t=>{this.setState(t?{isBusy:!0,isExpanded:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2}:{isBusy:!1,isEmpty:this.plugin.state.data.tree.transforms.size<2})}),this.subscribe(this.plugin.behaviors.state.isAnimating,t=>{this.setState(t?{isAnimating:!0,isExpanded:!1}:{isAnimating:!1})})}render(){const t=this.plugin.managers.snapshot.state.isPlaying;if(t||this.state.isEmpty||this.plugin.managers.animation.isEmpty||!this.plugin.config.get(ei.Viewport.ShowAnimation))return null;const n=this.state.isAnimating;return(0,L.jsxs)("div",{className:"msp-animation-viewport-controls",children:[(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"msp-semi-transparent-background"}),(0,L.jsx)(kn,{svg:n||t?Fbe:mbt,transparent:!0,title:n?"Stop":"Select Animation",onClick:n||t?this.stop:this.toggleExpanded,toggleState:this.state.isExpanded,disabled:!n&&!t&&(this.state.isBusy||this.state.isPlaying||this.state.isEmpty)})]}),this.state.isExpanded&&!this.state.isBusy&&(0,L.jsx)("div",{className:"msp-animation-viewport-controls-select",children:(0,L.jsx)(WEt,{onStart:this.toggleExpanded})})]})}}class l3t extends Vr{componentDidMount(){this.subscribe(this.plugin.behaviors.interaction.selectionMode,()=>this.forceUpdate())}render(){return this.plugin.selectionMode?(0,L.jsx)("div",{className:"msp-selection-viewport-controls",children:(0,L.jsx)(uTt,{})}):null}}class c3t extends Vr{constructor(){super(...arguments),this.state={labels:[]}}componentDidMount(){this.subscribe(this.plugin.behaviors.labels.highlight,t=>this.setState({labels:t.labels}))}render(){return 0===this.state.labels.length?null:(0,L.jsx)("div",{className:"msp-highlight-info",children:this.state.labels.map((t,n)=>t.indexOf("\n")>0?(0,L.jsx)("div",{className:"msp-highlight-markdown-row",children:(0,L.jsx)(d2e,{skipHtml:!0,children:t})},""+n):(0,L.jsx)("div",{className:"msp-highlight-simple-row",dangerouslySetInnerHTML:{__html:t}},""+n))})}}class u3t extends Vr{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){const t=[];return this.plugin.customStructureControls.forEach((n,r)=>{t.push((0,L.jsx)(n,{initiallyCollapsed:this.props.initiallyCollapsed},r))}),t.length>0?(0,L.jsx)(L.Fragment,{children:t}):null}}class d3t extends Vr{render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-section-header",children:[(0,L.jsx)(Mi,{svg:hyt}),"Structure Tools"]}),(0,L.jsx)(STt,{}),(0,L.jsx)(mTt,{}),(0,L.jsx)(ZTt,{}),(0,L.jsx)(t3t,{}),(0,L.jsx)(YEt,{}),this.plugin.config.get(ei.VolumeStreaming.Enabled)&&(0,L.jsx)(CTt,{}),(0,L.jsx)(wTt,{}),(0,L.jsx)(u3t,{})]})}}class f3t extends Vr{get current(){return this.props.state.behaviors.currentObject.value}componentDidMount(){this.subscribe(this.plugin.state.events.object.updated,({ref:t,state:n})=>{const r=this.current;r.ref!==t||r.state!==n||this.forceUpdate()}),this.subscribe(this.plugin.state.data.actions.events.added,()=>this.forceUpdate()),this.subscribe(this.plugin.state.data.actions.events.removed,()=>this.forceUpdate())}render(){const{state:t,nodeRef:n}=this.props,r=t.cells.get(n),i=t.actions.fromCell(r,this.plugin);if(0===i.length)return null;const o=r.transform.transformer.definition,s=r.obj?r.obj.label:o.display&&o.display.name||o.name;return(0,L.jsxs)("div",{className:"msp-state-actions",children:[!this.props.hideHeader&&(0,L.jsxs)("div",{className:"msp-section-header",children:[(0,L.jsx)(Mi,{svg:Dyt})," ",`Actions (${s})`]}),i.map((a,l)=>(0,L.jsx)(GX,{state:t,action:a,nodeRef:n,initiallyCollapsed:0===l?!this.props.alwaysExpandFirst&&this.props.initiallyCollapsed:this.props.initiallyCollapsed},`${a.id}`))]})}}class p3t extends Vr{render(){var t;return(0,L.jsxs)("div",{children:[(0,L.jsx)(Zy,{icon:Nbe,title:"Plugin State"}),(0,L.jsx)("div",{style:{marginBottom:"10px"},children:(0,L.jsx)(lm,{header:"Save Options",initiallyExpanded:!1,children:(0,L.jsx)(C2e,{})})}),(0,L.jsx)(_B,{}),(0,L.jsx)(m3t,{}),(0,L.jsx)(Zy,{title:"Save as File",accent:"blue"}),(0,L.jsx)(S2e,{}),"none"!==(null===(t=this.plugin.spec.components)||void 0===t?void 0:t.remoteState)&&(0,L.jsx)(I2e,{})]})}}class S2e extends Vr{constructor(){super(...arguments),this.downloadToFileJson=()=>{var t,n;null===(n=(t=this.props).onAction)||void 0===n||n.call(t),jt.State.Snapshots.DownloadToFile(this.plugin,{type:"json"})},this.downloadToFileZip=()=>{var t,n;null===(n=(t=this.props).onAction)||void 0===n||n.call(t),jt.State.Snapshots.DownloadToFile(this.plugin,{type:"zip"})},this.open=t=>{var n,r;t.target.files&&t.target.files[0]?(null===(r=(n=this.props).onAction)||void 0===r||r.call(n),jt.State.Snapshots.OpenFile(this.plugin,{file:t.target.files[0]})):this.plugin.log.error("No state file selected")}}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(ir,{icon:zW,onClick:this.downloadToFileJson,title:"Save the state description. Input data are loaded using the provided sources. Does not work if local files are used as input.",children:"State"}),(0,L.jsx)(ir,{icon:zW,onClick:this.downloadToFileZip,title:"Save the state including the input data.",children:"Session"}),(0,L.jsxs)("div",{className:"msp-btn msp-btn-block msp-btn-action msp-loader-msp-btn-file",children:[(0,L.jsx)(Mi,{svg:nbt,inline:!0})," Open ",(0,L.jsx)("input",{onChange:this.open,type:"file",multiple:!1,accept:".molx,.molj"})]})]}),(0,L.jsxs)("div",{className:"msp-help-text",style:{padding:"10px"},children:[(0,L.jsx)(Mi,{svg:Obe})," This is an experimental feature and stored states/sessions might not be openable in a future version."]})]})}}class C2e extends Vr{componentDidMount(){this.subscribe(this.plugin.state.snapshotParams,()=>this.forceUpdate())}render(){return(0,L.jsx)(vs,{params:M2.SnapshotParams,values:this.plugin.state.snapshotParams.value,onChangeValues:this.plugin.state.setSnapshotParams})}}class _B extends Vr{constructor(){super(...arguments),this.state={params:I.getDefaultValues(_B.Params)},this.add=()=>{jt.State.Snapshots.Add(this.plugin,{name:this.state.params.name,description:this.state.params.description})},this.updateParams=t=>this.setState({params:t}),this.clear=()=>{jt.State.Snapshots.Clear(this.plugin,{})}}shouldComponentUpdate(t,n){return!lw(this.props,t)||!lw(this.state,n)}render(){return(0,L.jsx)("div",{children:(0,L.jsx)(h3t,{parent:this})})}}function w2e(e,t,n){return!!t&&e.managers.snapshot.state.entries.some(r=>(!n||r.snapshot.id!==n)&&r.key===t)}function h3t({parent:e}){const[t,n]=Yt.useState({key:"",name:"",description:""}),r=()=>{jt.State.Snapshots.Add(e.plugin,{key:t.key,name:t.name,description:t.description}),n({key:"",name:"",description:""})},i=w2e(e.plugin,t.key);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A2e,{state:t,setState:n,apply:r}),(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(kn,{onClick:e.clear,svg:qp,title:"Remove All"}),(0,L.jsx)(ir,{onClick:r,icon:i?void 0:FA,style:{textAlign:"right"},commit:i?"off":"on",disabled:i,children:i?"Key must be unique":"Add"})]})]})}_B.Params={name:I.Text(),description:I.Text()};class m3t extends Vr{constructor(){super(...arguments),this.state={editingId:void 0},this.edit=t=>{const n=t.currentTarget.getAttribute("data-id");n&&this.setState({editingId:n===this.state.editingId?void 0:n})},this.doneEdit=()=>this.setState({editingId:void 0}),this.apply=t=>{const n=t.currentTarget.getAttribute("data-id");n&&jt.State.Snapshots.Apply(this.plugin,{id:n})},this.remove=t=>{const n=t.currentTarget.getAttribute("data-id");n&&jt.State.Snapshots.Remove(this.plugin,{id:n})},this.moveUp=t=>{const n=t.currentTarget.getAttribute("data-id");n&&jt.State.Snapshots.Move(this.plugin,{id:n,dir:-1})},this.moveDown=t=>{const n=t.currentTarget.getAttribute("data-id");n&&jt.State.Snapshots.Move(this.plugin,{id:n,dir:1})},this.replace=t=>{const n=t.currentTarget.getAttribute("data-id");n&&jt.State.Snapshots.Replace(this.plugin,{id:n})}}componentDidMount(){this.subscribe(this.plugin.managers.snapshot.events.changed,()=>this.forceUpdate())}render(){const t=this.plugin.managers.snapshot.state.current,n=[];return this.plugin.managers.snapshot.state.entries.forEach(r=>{var i;n.push((0,L.jsxs)("li",{className:"msp-flex-row",children:[(0,L.jsxs)(ir,{"data-id":r.snapshot.id,onClick:this.apply,className:"msp-no-overflow",children:[(0,L.jsxs)("span",{style:{fontWeight:r.snapshot.id===t?"bold":void 0},children:[!!r.key&&`[${r.key}] `,r.name||new Date(r.timestamp).toLocaleString()]})," ",(0,L.jsx)("small",{children:`${r.snapshot.durationInMs?AR(r.snapshot.durationInMs,!1):""}`})]}),(0,L.jsx)(kn,{svg:uv,"data-id":r.snapshot.id,title:"Edit",onClick:this.edit,flex:"28px"}),(0,L.jsx)(kn,{svg:pO,"data-id":r.snapshot.id,title:"Move Up",onClick:this.moveUp,flex:"20px"}),(0,L.jsx)(kn,{svg:fO,"data-id":r.snapshot.id,title:"Move Down",onClick:this.moveDown,flex:"20px"}),(0,L.jsx)(kn,{svg:ybt,"data-id":r.snapshot.id,title:"Replace",onClick:this.replace,flex:"20px"}),(0,L.jsx)(kn,{svg:qp,"data-id":r.snapshot.id,title:"Remove",onClick:this.remove,flex:"20px"})]},r.snapshot.id)),this.state.editingId===r.snapshot.id&&n.push((0,L.jsx)(g3t,{entry:r,plugin:this.plugin,done:this.doneEdit},`${r.snapshot.id}-edit`));const o=r.image&&(null===(i=this.plugin.managers.asset.get(r.image))||void 0===i?void 0:i.file);o&&n.push((0,L.jsx)("li",{className:"msp-state-image-row",children:(0,L.jsx)(ir,{"data-id":r.snapshot.id,onClick:this.apply,children:(0,L.jsx)("img",{draggable:!1,src:URL.createObjectURL(o)})})},`${r.snapshot.id}-image`))}),(0,L.jsx)(L.Fragment,{children:(0,L.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:n})})}}function A2e({state:e,setState:t,apply:n}){const r=Yt.useRef(),i=Yt.useRef(),[o,s]=Yt.useState(!1);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bd,{label:"Name",control:(0,L.jsx)("input",{type:"text",value:e.name,placeholder:"Name",onChange:a=>t({...e,name:a.target.value}),onKeyUp:a=>{var l;"Enter"===a.key&&(null===(l=r.current)||void 0===l||l.focus())}})}),(0,L.jsx)(Bd,{label:(0,L.jsxs)(L.Fragment,{children:["Key",(0,L.jsx)($be,{show:o,toggle:()=>s(a=>!a)})]}),control:(0,L.jsx)("input",{type:"text",ref:r,value:e.key,placeholder:"Key (optional)",onChange:a=>t({...e,key:a.target.value}),onKeyUp:a=>{var l;"Enter"===a.key&&(null===(l=i.current)||void 0===l||l.focus())}})}),o&&(0,L.jsx)("div",{className:"msp-control-offset",children:(0,L.jsx)(Wbe,{description:"Optional snapshot key used to activate snapshots from descriptions, labels, etc."})}),(0,L.jsx)("div",{className:"msp-flex-row msp-text-area-wrapper",style:{marginBottom:1},children:(0,L.jsx)("textarea",{ref:i,placeholder:"Markdown Description\n\n- Use [title](#key) to link to a snapshot",className:"msp-form-control",value:e.description,onChange:a=>t({...e,description:a.target.value}),onKeyUp:a=>{"Enter"===a.key&&a.ctrlKey&&n(e)}})})]})}function g3t({entry:e,plugin:t,done:n}){var r,i,o;const[s,a]=Yt.useState({key:null!==(r=e.key)&&void 0!==r?r:"",name:null!==(i=e.name)&&void 0!==i?i:"",description:null!==(o=e.description)&&void 0!==o?o:""}),l=()=>{t.managers.snapshot.update(e,s),n()},c=w2e(t,s.key,e.snapshot.id);return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(A2e,{state:s,setState:a,apply:l}),(0,L.jsx)("div",{className:"msp-flex-row",style:{marginBottom:1},children:(0,L.jsx)(ir,{onClick:l,icon:c?void 0:a2,style:{textAlign:"right"},commit:c?"off":"on",disabled:c,children:c?"Key must be unique":"Apply"})})]})}class I2e extends Vr{constructor(){var t;super(...arguments),t=this,this.Params={name:I.Text(),options:I.Group({description:I.Text(),playOnLoad:I.Boolean(!1),serverUrl:I.Text(this.plugin.config.get(ei.State.CurrentServer))})},this.state={params:I.getDefaultValues(this.Params),entries:Nc(),isBusy:!1},this.ListOnlyParams={options:I.Group({serverUrl:I.Text(this.plugin.config.get(ei.State.CurrentServer))},{isFlat:!0})},this._mounted=!1,this.refresh=le(function*(){try{t.setState({isBusy:!0}),t.plugin.config.set(ei.State.CurrentServer,t.state.params.options.serverUrl);const n=(yield t.plugin.runTask(t.plugin.fetch({url:t.serverUrl("list"),type:"json"})))||[];n.sort((i,o)=>i.isSticky===o.isSticky?i.timestamp-o.timestamp:i.isSticky?-1:1);const r=Nc().asMutable();for(const i of n)r.set(i.id,{...i,url:t.serverUrl(`get/${i.id}`),removeUrl:t.serverUrl(`remove/${i.id}`)});t._mounted&&t.setState({entries:r.asImmutable(),isBusy:!1})}catch(n){console.error(n),t.plugin.log.error("Error fetching remote snapshots"),t._mounted&&t.setState({entries:Nc(),isBusy:!1})}}),this.upload=le(function*(){t.setState({isBusy:!0}),t.plugin.config.set(ei.State.CurrentServer,t.state.params.options.serverUrl),yield jt.State.Snapshots.Upload(t.plugin,{name:t.state.params.name,description:t.state.params.options.description,playOnLoad:t.state.params.options.playOnLoad,serverUrl:t.state.params.options.serverUrl}),t.plugin.log.message("Snapshot uploaded."),t._mounted&&(t.setState({isBusy:!1}),t.refresh())}),this.fetch=function(){var n=le(function*(r){const i=r.currentTarget.getAttribute("data-id");if(!i)return;const o=t.state.entries.get(i);if(o){t.setState({isBusy:!0});try{yield jt.State.Snapshots.Fetch(t.plugin,{url:o.url})}finally{t._mounted&&t.setState({isBusy:!1})}}});return function(r){return n.apply(this,arguments)}}(),this.remove=function(){var n=le(function*(r){const i=r.currentTarget.getAttribute("data-id");if(!i)return;const o=t.state.entries.get(i);if(o){t.setState({entries:t.state.entries.remove(i)});try{yield fetch(o.removeUrl)}catch(s){console.error(s)}}});return function(r){return n.apply(this,arguments)}}()}componentDidMount(){this.refresh(),this._mounted=!0}componentWillUnmount(){super.componentWillUnmount(),this._mounted=!1}serverUrl(t){return t?mF(this.state.params.options.serverUrl,t):this.state.params.options.serverUrl}render(){return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Zy,{title:"Remote States",accent:"blue"}),!this.props.listOnly&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(vs,{params:this.Params,values:this.state.params,onEnter:this.upload,onChange:t=>{this.setState({params:{...this.state.params,[t.name]:t.value}})},isDisabled:this.state.isBusy}),(0,L.jsxs)("div",{className:"msp-flex-row",children:[(0,L.jsx)(kn,{onClick:this.refresh,disabled:this.state.isBusy,svg:HW}),(0,L.jsx)(ir,{icon:Eyt,onClick:this.upload,disabled:this.state.isBusy,commit:!0,children:"Upload"})]})]}),(0,L.jsx)(y3t,{entries:this.state.entries,isBusy:this.state.isBusy,serverUrl:this.state.params.options.serverUrl,fetch:this.fetch,remove:this.props.listOnly?void 0:this.remove}),this.props.listOnly&&(0,L.jsxs)("div",{style:{marginTop:"10px"},children:[(0,L.jsx)(vs,{params:this.ListOnlyParams,values:this.state.params,onEnter:this.upload,onChange:t=>{this.setState({params:{...this.state.params,[t.name]:t.value}})},isDisabled:this.state.isBusy}),(0,L.jsx)("div",{className:"msp-flex-row",children:(0,L.jsx)(ir,{onClick:this.refresh,disabled:this.state.isBusy,icon:HW,children:"Refresh"})})]})]})}}class y3t extends bl{constructor(){var t;super(...arguments),t=this,this.open=function(){var n=le(function*(r){const i=r.currentTarget.getAttribute("data-id");if(!i)return;const o=t.props.entries.get(i);if(!o)return;r.preventDefault();let s=`${window.location}`;const a=s.indexOf("?");a>0&&(s=s.substr(0,a)),window.open(`${s}?snapshot-url=${encodeURIComponent(o.url)}`,"_blank")});return function(r){return n.apply(this,arguments)}}()}render(){return(0,L.jsx)("ul",{style:{listStyle:"none",marginTop:"10px"},className:"msp-state-list",children:this.props.entries.valueSeq().map(t=>(0,L.jsxs)("li",{className:"msp-flex-row",children:[(0,L.jsxs)(ir,{"data-id":t.id,onClick:this.props.fetch,disabled:this.props.isBusy,onContextMenu:this.open,title:"Click to download, right-click to open in a new tab.",children:[t.name||new Date(t.timestamp).toLocaleString()," ",(0,L.jsx)("small",{children:t.description})]}),!t.isSticky&&this.props.remove&&(0,L.jsx)(kn,{svg:qp,"data-id":t.id,title:"Remove",onClick:this.props.remove,disabled:this.props.isBusy,small:!0})]},t.id))})}}class E2e extends Vr{constructor(){super(...arguments),this.state={showActions:!0}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,t=>{t.cell.transform.parent===vr.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,t=>{t.parent===vr.RootRef&&this.forceUpdate()})}static getDerivedStateFromProps(t,n){const o=0===t.state.tree.children.get(t.state.tree.root.ref).size;return n.showActions===o?null:{showActions:o}}render(){const t=this.props.state.tree.root.ref;return this.state.showActions?(0,L.jsxs)("div",{style:{margin:"10px",cursor:"default"},children:[(0,L.jsx)("p",{children:"Nothing to see here yet."}),(0,L.jsxs)("p",{children:["Structures and Volumes can be loaded from the ",(0,L.jsx)(Mi,{svg:VW})," tab."]})]}):(0,L.jsx)(mm,{cell:this.props.state.cells.get(t),depth:0})}}class mm extends Vr{constructor(){super(...arguments),this.state={isCollapsed:!!this.props.cell.state.isCollapsed,isNull:mm.isNull(this.props.cell),showLabel:mm.showLabel(this.props.cell)}}is(t){return t.ref===this.ref&&t.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated,t=>{this.props.cell===t.cell&&this.is(t)&&t.state.cells.has(this.ref)&&(this.state.isCollapsed!==!!t.cell.state.isCollapsed||this.state.isNull!==mm.isNull(t.cell)||this.state.showLabel!==mm.showLabel(t.cell))&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.created,t=>{this.props.cell.parent===t.state&&this.ref===t.cell.transform.parent&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,t=>{this.props.cell.parent===t.state&&this.ref===t.parent&&this.forceUpdate()})}static getDerivedStateFromProps(t,n){const r=mm.isNull(t.cell),i=mm.showLabel(t.cell);return!!t.cell.state.isCollapsed===n.isCollapsed&&n.isNull===r&&n.showLabel===i?null:{isCollapsed:!!t.cell.state.isCollapsed,isNull:r,showLabel:i}}static hasDecorator(t){var n;const r=t.parent.tree.children.get(t.transform.ref);return 1===r.size&&!(null===(n=t.parent)||void 0===n||!n.tree.transforms.get(r.first()).transformer.definition.isDecorator)}static isNull(t){return!t||!t.parent||t.obj===vo.Null||!t.parent.tree.transforms.has(t.transform.ref)}static showLabel(t){return t.transform.ref!==vr.RootRef&&("ok"!==t.status||!t.state.isGhost&&!mm.hasDecorator(t))}render(){if(this.state.isNull)return null;const t=this.props.cell,n=t.parent.tree.children.get(this.ref);if(!this.state.showLabel)return 0===n.size?null:(0,L.jsx)(L.Fragment,{children:n.map(i=>(0,L.jsx)(mm,{cell:t.parent.cells.get(i),depth:this.props.depth},i))});const r=this.props.depth+1;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(b3t,{cell:t,depth:this.props.depth}),0===n.size?void 0:(0,L.jsx)("div",{style:{display:this.state.isCollapsed?"none":"block"},children:n.map(i=>(0,L.jsx)(mm,{cell:t.parent.cells.get(i),depth:r},i))})]})}}class b3t extends Vr{constructor(){super(...arguments),this.state={isCurrent:this.props.cell.parent.current===this.ref,isCollapsed:!!this.props.cell.state.isCollapsed,action:void 0,currentAction:void 0},this.setCurrent=t=>{t?.preventDefault(),t?.currentTarget.blur(),jt.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:this.ref})},this.setCurrentRoot=t=>{t?.preventDefault(),t?.currentTarget.blur(),jt.State.SetCurrentObject(this.plugin,{state:this.props.cell.parent,ref:vr.RootRef})},this.remove=t=>{t?.preventDefault(),jt.State.RemoveObject(this.plugin,{state:this.props.cell.parent,ref:this.ref,removeParentGhosts:!0})},this.toggleVisible=t=>{t.preventDefault(),jt.State.ToggleVisibility(this.plugin,{state:this.props.cell.parent,ref:this.ref}),t.currentTarget.blur()},this.toggleExpanded=t=>{t.preventDefault(),jt.State.ToggleExpanded(this.plugin,{state:this.props.cell.parent,ref:this.ref}),t.currentTarget.blur()},this.highlight=t=>{t.preventDefault(),jt.Interactivity.Object.Highlight(this.plugin,{state:this.props.cell.parent,ref:this.ref}),t.currentTarget.blur()},this.clearHighlight=t=>{t.preventDefault(),jt.Interactivity.ClearHighlights(this.plugin),t.currentTarget.blur()},this.hideApply=()=>{this.setCurrentRoot()},this.selectAction=t=>{t&&(0,t?.value)()}}is(t){return t.ref===this.ref&&t.state===this.props.cell.parent}get ref(){return this.props.cell.transform.ref}componentDidMount(){this.subscribe(this.plugin.state.events.cell.stateUpdated.pipe(xd(t=>this.is(t)),Qbe(33)),t=>{this.forceUpdate()}),this.subscribe(this.props.cell.parent.behaviors.currentObject,t=>{this.is(t)?t.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,!!this.props.cell.state.isCollapsed):this.state.isCurrent&&t.state.transforms.has(this.ref)&&this._setCurrent(this.props.cell.parent.current===this.ref,this.state.isCollapsed)})}_setCurrent(t,n){this.setState(t?{isCurrent:t,action:"options",currentAction:void 0,isCollapsed:n}:{isCurrent:t,action:void 0,currentAction:void 0,isCollapsed:n})}static getDerivedStateFromProps(t,n){const r=t.cell.parent.current===t.cell.transform.ref,i=!!t.cell.state.isCollapsed;return n.isCollapsed===i&&n.isCurrent===r?null:{isCurrent:r,isCollapsed:i,action:void 0,currentAction:void 0}}get actions(){const t=this.props.cell,n=[...t.parent.actions.fromCell(t,this.plugin)];if(0!==n.length)return n.sort((r,i)=>r.definition.display.name<i.definition.display.name?-1:r.definition.display.name===i.definition.display.name?0:1),[Hn.Header("Apply Action"),...n.map(r=>Hn.Item(r.definition.display.name,()=>this.setState({action:"apply",currentAction:r})))]}updates(t){const n=this.props.cell,r=TD.getDecoratorChain(n.parent,n.transform.ref),i=[];for(let o=r.length-1;o>=0;o--){const s=r[o];i.push((0,L.jsx)(ab,{state:n.parent,transform:s.transform,noMargin:!0,wrapInExpander:!0,expanderHeaderLeftMargin:t},`${s.transform.transformer.id}-${o}`))}return(0,L.jsx)("div",{className:"msp-tree-updates-wrapper",children:i})}render(){const t=this.props.cell,n=t.transform;if(!t)return null;const r=this.is(t.parent.behaviors.currentObject.value),i="error"!==t.status&&"ok"!==t.status;let o;if("error"!==t.status&&t.obj){const p=t.obj;o=(0,L.jsxs)(ir,{className:`msp-btn-tree-label msp-type-class-${p.type.typeClass}`,noOverflow:!0,disabled:i,title:`${p.label} ${p.description?p.description:""}`,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,children:[(0,L.jsx)("span",{children:p.label})," ",p.description?(0,L.jsx)("small",{children:p.description}):void 0]})}else{const p="error"===t.status?t.errorText:n.transformer.definition.display.name;o=(0,L.jsxs)(ir,{className:"msp-btn-tree-label msp-no-hover-outline",noOverflow:!0,title:p,onClick:this.state.isCurrent?this.setCurrentRoot:this.setCurrent,disabled:i,children:["error"===t.status&&(0,L.jsxs)("b",{children:["[",t.status,"]"]})," ",(0,L.jsx)("span",{children:p})]})}const s=t.parent.tree.children.get(this.ref),a=t.state,l=(0,L.jsx)(kn,{svg:a.isCollapsed?Xy:Yy,flex:"20px",disabled:i,onClick:this.toggleExpanded,transparent:!0,className:"msp-no-hover-outline",style:{visibility:s.size>0?"visible":"hidden"}}),c=t.state.isLocked?void 0:(0,L.jsx)(kn,{svg:qp,onClick:this.remove,disabled:i,small:!0,toggleState:!1}),u=(0,L.jsx)(kn,{svg:a.isHidden?c2:u2,toggleState:!1,disabled:i,small:!0,onClick:this.toggleVisible}),f=(0,L.jsxs)("div",{className:"msp-flex-row msp-tree-row"+(r?" msp-tree-row-current":""),onMouseEnter:this.highlight,onMouseLeave:this.clearHighlight,style:{marginLeft:8*this.props.depth+"px"},children:[l,o,c,u]});if(!r)return f;if("apply"===this.state.action&&this.state.currentAction)return(0,L.jsxs)("div",{style:{marginBottom:"1px"},children:[f,(0,L.jsx)(Fg,{header:`Apply ${this.state.currentAction.definition.display.name}`,initialExpanded:!0,hideExpander:!0,hideOffset:!1,onHeaderClick:this.hideApply,topRightIcon:Rg,headerLeftMargin:8*this.props.depth+21+"px",children:(0,L.jsx)(GX,{onApply:this.hideApply,state:this.props.cell.parent,action:this.state.currentAction,nodeRef:this.props.cell.transform.ref,hideHeader:!0,noMargin:!0})})]});if("options"===this.state.action){const p=this.actions,m=this.updates(8*this.props.depth+21+"px");return(0,L.jsxs)("div",{style:{marginBottom:"1px"},children:[f,m,p&&(0,L.jsx)("div",{style:{marginLeft:8*this.props.depth+21+"px",marginTop:"-1px"},children:(0,L.jsx)(Hn,{items:p,onSelect:this.selectAction})})]})}return f}}class v3t extends Vr{componentDidMount(){this.subscribe(this.plugin.state.behaviors.events.changed,()=>this.forceUpdate())}render(){const t=[];return this.plugin.customImportControls.forEach((n,r)=>{t.push((0,L.jsx)(n,{initiallyCollapsed:this.props.initiallyCollapsed},r))}),t.length>0?(0,L.jsx)(L.Fragment,{children:t}):null}}class x3t extends Vr{constructor(){var t;super(...arguments),this.state={tab:this.plugin.behaviors.layout.leftPanelTabName.value},this.set=n=>{if(this.state.tab===n)return this.setState({tab:"none"},()=>this.plugin.behaviors.layout.leftPanelTabName.next("none")),void jt.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}});this.setState({tab:n},()=>this.plugin.behaviors.layout.leftPanelTabName.next(n)),"full"!==this.plugin.layout.state.regionState.left&&jt.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"full"}}})},this.tabs={none:(0,L.jsx)(L.Fragment,{}),root:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Zy,{icon:VW,title:"Home"}),(0,L.jsx)(f3t,{state:this.plugin.state.data,nodeRef:vr.RootRef,hideHeader:!0,initiallyCollapsed:!0,alwaysExpandFirst:!0}),(0,L.jsx)(v3t,{}),"none"!==(null===(t=this.plugin.spec.components)||void 0===t?void 0:t.remoteState)&&(0,L.jsx)(I2e,{listOnly:!0})]}),data:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Zy,{icon:Ibe,title:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(C3t,{})," State Tree"]})}),(0,L.jsx)(E2e,{state:this.plugin.state.data})]}),states:(0,L.jsx)(p3t,{}),settings:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Zy,{icon:uv,title:"Plugin Settings"}),(0,L.jsx)(S3t,{})]}),help:(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Zy,{icon:Ng,title:"Help"}),(0,L.jsx)(lTt,{})]})}}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,t=>{this.state.tab!==t&&this.setState({tab:t}),"none"===t&&"collapsed"!==this.plugin.layout.state.regionState.left&&jt.Layout.Update(this.plugin,{state:{regionState:{...this.plugin.layout.state.regionState,left:"collapsed"}}})}),this.subscribe(this.plugin.state.data.events.changed,({state:t})=>{"data"===this.state.tab&&1===t.cells.size&&this.set("root")})}render(){const t=this.state.tab;return(0,L.jsxs)("div",{className:"msp-left-panel-controls",children:[(0,L.jsxs)("div",{className:"msp-left-panel-controls-buttons",children:[(0,L.jsx)(kn,{svg:VW,toggleState:"root"===t,transparent:!0,onClick:()=>this.set("root"),title:"Home"}),(0,L.jsx)(_3t,{set:this.set}),(0,L.jsx)(kn,{svg:Nbe,toggleState:"states"===t,transparent:!0,onClick:()=>this.set("states"),title:"Plugin State"}),(0,L.jsx)(kn,{svg:Ng,toggleState:"help"===t,transparent:!0,onClick:()=>this.set("help"),title:"Help"}),(0,L.jsx)("div",{className:"msp-left-panel-controls-buttons-bottom",children:(0,L.jsx)(kn,{svg:uv,toggleState:"settings"===t,transparent:!0,onClick:()=>this.set("settings"),title:"Settings"})})]}),(0,L.jsx)("div",{className:"msp-scrollable-container",children:this.tabs[t]})]})}}class _3t extends Vr{constructor(){super(...arguments),this.state={changed:!1}}get tab(){return this.plugin.behaviors.layout.leftPanelTabName.value}componentDidMount(){this.subscribe(this.plugin.behaviors.layout.leftPanelTabName,t=>{"data"===this.tab?this.setState({changed:!1}):this.forceUpdate()}),this.subscribe(this.plugin.state.data.events.changed,t=>{"data"!==this.tab&&this.setState({changed:!0})})}render(){return(0,L.jsx)(kn,{svg:Ibe,toggleState:"data"===this.tab,transparent:!0,onClick:()=>this.props.set("data"),title:"State Tree",style:{position:"relative"},extraContent:this.state.changed?(0,L.jsx)("div",{className:"msp-left-panel-controls-button-data-dirty"}):void 0})}}class S3t extends Vr{constructor(){super(...arguments),this.setSettings=t=>{jt.Canvas3D.SetSettings(this.plugin,{settings:{[t.name]:t.value}})},this.setCanvas3DContextProps=t=>{var n;null===(n=this.plugin.canvas3dContext)||void 0===n||n.setProps({[t.name]:t.value}),this.plugin.events.canvas3d.settingsUpdated.next(void 0)}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(mA(500,void 0,{leading:!0,trailing:!0})),t=>{(void 0!==t.radiusMax||void 0!==t.radius)&&this.forceUpdate()})}render(){return(0,L.jsxs)(L.Fragment,{children:[this.plugin.canvas3d&&this.plugin.canvas3dContext&&(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Zy,{title:"Viewport"}),(0,L.jsx)(vs,{params:Fd,values:this.plugin.canvas3d.props,onChange:this.setSettings}),(0,L.jsx)(vs,{params:K_.Params,values:this.plugin.canvas3dContext.props,onChange:this.setCanvas3DContextProps})]}),(0,L.jsx)(Zy,{title:"Behavior"}),(0,L.jsx)(E2e,{state:this.plugin.state.behaviors})]})}}class C3t extends Vr{constructor(){super(...arguments),this.remove=t=>{t.preventDefault(),jt.State.RemoveObject(this.plugin,{state:this.plugin.state.data,ref:vr.RootRef})}}componentDidMount(){this.subscribe(this.plugin.state.events.cell.created,t=>{t.cell.transform.parent===vr.RootRef&&this.forceUpdate()}),this.subscribe(this.plugin.state.events.cell.removed,t=>{t.parent===vr.RootRef&&this.forceUpdate()})}render(){return 0===this.plugin.state.data.tree.children.get(vr.RootRef).size?null:(0,L.jsx)(kn,{svg:qp,onClick:this.remove,title:"Remove All",style:{display:"inline-block"},small:!0,className:"msp-no-hover-outline",transparent:!0})}}class w3t extends Vr{constructor(){super(...arguments),this.parentDiv=Yt.createRef(),this.lastMouseOverSeqIdx=-1,this.highlightQueue=new si,this.lociHighlightProvider=(t,n)=>{this.props.sequenceWrapper.markResidue(t.loci,n)&&this.updateMarker()},this.lociSelectionProvider=(t,n)=>{this.props.sequenceWrapper.markResidue(t.loci,n)&&this.updateMarker()},this.contextMenu=t=>{t.preventDefault()},this.mouseDownLoci=void 0,this.mouseDown=t=>{t.stopPropagation();const n=this.getSeqIdx(t),r=this.getLoci(n),i=q_(t.nativeEvent),o=xA(t.nativeEvent),s=wF(t.nativeEvent);this.click(r,i,o,s),this.mouseDownLoci=r},this.mouseUp=t=>{if(t.stopPropagation(),void 0===this.mouseDownLoci)return;const n=this.getSeqIdx(t),r=this.getLoci(n);if(r&&!Me.areEqual(this.mouseDownLoci,r)){const i=q_(t.nativeEvent),o=xA(t.nativeEvent),s=wF(t.nativeEvent),a=this.mouseDownLoci.elements[0],l=r.elements[0],c=Math.min(Ve.min(a.indices),Ve.min(l.indices)),u=Math.max(Ve.max(a.indices),Ve.max(l.indices)),d=Me(r.structure,[{unit:a.unit,indices:Ve.ofRange(c,u)}]);this.click(Me.subtract(d,this.mouseDownLoci),i,o,s)}this.mouseDownLoci=void 0},this.location=dt.create(void 0),this.mouseMove=t=>{t.stopPropagation();const n=q_(t.nativeEvent),r=xA(t.nativeEvent),i=wF(t.nativeEvent),o=t.target;if(!o||!o.getAttribute){if(-1===this.lastMouseOverSeqIdx)return;return this.lastMouseOverSeqIdx=-1,void this.highlightQueue.next({seqIdx:-1,buttons:n,button:r,modifiers:i})}const s=o.hasAttribute("data-seqid")?+o.getAttribute("data-seqid"):-1;if(this.lastMouseOverSeqIdx!==s)if(this.lastMouseOverSeqIdx=s,void 0!==this.mouseDownLoci){const a=this.getLoci(s);this.hover(a,es.Flag.None,es.Flag.None,{...i,shift:!0})}else this.highlightQueue.next({seqIdx:s,buttons:n,button:r,modifiers:i})},this.mouseLeave=t=>{if(t.stopPropagation(),this.mouseDownLoci=void 0,-1===this.lastMouseOverSeqIdx)return;this.lastMouseOverSeqIdx=-1;const n=q_(t.nativeEvent),r=xA(t.nativeEvent),i=wF(t.nativeEvent);this.highlightQueue.next({seqIdx:-1,buttons:n,button:r,modifiers:i})}}get sequenceNumberPeriod(){return void 0!==this.props.sequenceNumberPeriod?this.props.sequenceNumberPeriod:this.props.sequenceWrapper.length>10?10:this.getSequenceNumber(this.props.sequenceWrapper.length-1).length>1?5:1}componentDidMount(){this.plugin.managers.interactivity.lociHighlights.addProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.addProvider(this.lociSelectionProvider),this.subscribe(this.highlightQueue.pipe(mA(3*16.666,void 0,{leading:!0,trailing:!0})),t=>{const n=this.getLoci(t.seqIdx<0?void 0:t.seqIdx);this.hover(n,t.buttons,t.button,t.modifiers)})}componentWillUnmount(){super.componentWillUnmount(),this.plugin.managers.interactivity.lociHighlights.removeProvider(this.lociHighlightProvider),this.plugin.managers.interactivity.lociSelects.removeProvider(this.lociSelectionProvider)}getLoci(t){if(void 0!==t){const n=this.props.sequenceWrapper.getLoci(t);if(!Me.isEmpty(n))return n}}getSeqIdx(t){let n;const r=t.target;return r&&r.getAttribute&&(n=r.hasAttribute("data-seqid")?+r.getAttribute("data-seqid"):void 0),n}hover(t,n,r,i){const o={current:Xn.Loci.Empty,buttons:n,button:r,modifiers:i};void 0!==t&&!Me.isEmpty(t)&&(o.current={loci:t}),this.plugin.behaviors.interaction.hover.next(o)}click(t,n,r,i){const o={current:Xn.Loci.Empty,buttons:n,button:r,modifiers:i};void 0!==t&&!Me.isEmpty(t)&&(o.current={loci:t}),this.plugin.behaviors.interaction.click.next(o)}getBackgroundColor(t){return typeof t>"u"&&console.error("unexpected marker value"),0===t?"":t%2==0?"rgb(51, 255, 25)":"rgb(255, 102, 153)"}getResidueClass(t,n){return n.length>1?this.props.sequenceWrapper.residueClass(t)+(0===t?" msp-sequence-residue-long-begin":" msp-sequence-residue-long"):this.props.sequenceWrapper.residueClass(t)}residue(t,n,r){return(0,L.jsx)("span",{"data-seqid":t,style:{backgroundColor:this.getBackgroundColor(r)},className:this.getResidueClass(t,n),children:`\u200b${n}\u200b`},t)}getSequenceNumberClass(t,n,r){const i=["msp-sequence-number"];return n.startsWith("-")?i.push(r.length>1&&t>0?"msp-sequence-number-long-negative":"msp-sequence-number-negative"):r.length>1&&t>0&&i.push("msp-sequence-number-long"),i.join(" ")}getSequenceNumber(t){let n="";const r=this.props.sequenceWrapper.getLoci(t),i=Me.getFirstLocation(r,this.location);return i&&(ze.isAtomic(i.unit)?n=`${Je.residue.auth_seq_id(i)}${Je.residue.pdbx_PDB_ins_code(i)||""}`:ze.isCoarse(i.unit)&&(n=`${t+1}`)),n}padSeqNum(t){return t.length<5?t+new Array(5-t.length+1).join("\xa0"):t}getSequenceNumberSpan(t,n){const r=this.getSequenceNumber(t);return(0,L.jsx)("span",{className:this.getSequenceNumberClass(t,r,n),children:this.padSeqNum(r)},`marker-${t}`)}updateMarker(){if(!this.parentDiv.current)return;const t=this.parentDiv.current.children,{markerArray:n}=this.props.sequenceWrapper,r=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod;let o=0;for(let s=0,a=n.length;s<a;s++){r&&s%i==0&&s<a&&o++;const l=t[o];if(!l)return;o++;const c=this.getBackgroundColor(n[s]);l.style.backgroundColor!==c&&(l.style.backgroundColor=c)}}render(){const t=this.props.sequenceWrapper,n=[],r=!this.props.hideSequenceNumbers,i=this.sequenceNumberPeriod;for(let o=0,s=t.length;o<s;++o){const a=t.residueLabel(o);r&&o%i==0&&o<s&&(n[n.length]=this.getSequenceNumberSpan(o,a)),n[n.length]=this.residue(o,a,t.markerArray[o])}return this.updateMarker(),(0,L.jsx)("div",{className:"msp-sequence-wrapper",onContextMenu:this.contextMenu,onMouseDown:this.mouseDown,onMouseUp:this.mouseUp,onMouseMove:this.mouseMove,onMouseLeave:this.mouseLeave,ref:this.parentDiv,children:n})}}class SB{markResidue(t,n){return Xu(t)?Qh(this.markerArray,Pe.ofLength(this.length),n):this.mark(t,n)}constructor(t,n,r){this.data=t,this.markerArray=n,this.length=r}}class A3t extends SB{seqId(t){return this.sequence.seqId.value(t)}residueLabel(t){return this.sequence.label.value(t)||this.sequence.code.value(t)}residueColor(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?qn.grey:qn.black}residueClass(t){return this.missing.has(this.modelNum,this.asymId,this.seqId(t))?"msp-sequence-missing":"msp-sequence-present"}mark(t,n){let r=!1;const{structure:i}=this.data,o=s=>this.sequence.index(s);if(Me.is(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;t=Me.remap(t,i);for(const s of t.elements)this.unitMap.has(s.unit.id)&&(r=ze.isAtomic(s.unit)?E3t(s,n,this.markerArray,o)||r:T3t(s,n,this.markerArray,o)||r)}else if(Xe.isLoci(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;Qh(this.markerArray,this.observed,n)&&(r=!0)}return r}getLoci(t){const n=function I3t(e,t,n){return _i.generators.atoms({unitTest:r=>Je.unit.chainGroupId(r.element)===e&&Je.unit.operator_name(r.element)===t,residueTest:r=>0===r.element.unit.kind?Je.residue.label_seq_id(r.element)===n:Je.coarse.seq_id_begin(r.element)<=n&&Je.coarse.seq_id_end(r.element)>=n})}(this.data.units[0].chainGroupId,this.data.units[0].conformation.operator.name,this.seqId(t));return Dt.toLociWithSourceUnits(Cz.run(n,this.data.structure))}constructor(t){const n=dt.create(t.structure,t.units[0],t.units[0].elements[0]),r=t.units[0].model.sequence.byEntityKey[Je.entity.key(n)],i=r.sequence.length;super(t,new Uint8Array(i),i),this.unitMap=new Map;for(const a of t.units)this.unitMap.set(a.id,a);this.sequence=r.sequence,this.missing=t.units[0].model.properties.missingResidues,this.modelNum=t.units[0].model.modelNum,this.asymId=ze.isAtomic(t.units[0])?Je.chain.label_asym_id(n):Je.coarse.asym_id(n);const s=[];for(let a=0;a<i;++a)this.missing.has(this.modelNum,this.asymId,this.seqId(a))&&s.push(a);this.observed=Ve.subtract(Pe.ofBounds(0,i),rt.ofSortedArray(s))}}function E3t(e,t,n,r){const{model:i,elements:o}=e.unit,{index:s}=i.atomicHierarchy.residueAtomSegments,{label_seq_id:a}=i.atomicHierarchy.residues;return Ve.forEachSegment(e.indices,l=>s[o[l]],l=>{const c=a.value(l);sP(n,r(c),t)}),!0}function T3t(e,t,n,r){const{model:i,elements:o}=e.unit,s=ze.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_begin:i.coarseHierarchy.gaussians.seq_id_begin,a=ze.isSpheres(e.unit)?i.coarseHierarchy.spheres.seq_id_end:i.coarseHierarchy.gaussians.seq_id_end;return Ve.forEach(e.indices,l=>{const c=o[l];for(let u=r(s.value(c)),d=r(a.value(c));u<=d;u++)sP(n,u,t)}),!0}class D3t extends SB{residueLabel(t){return this.sequence[t]}residueColor(t){return qn.black}residueClass(t){return"msp-sequence-present"}mark(t,n){let r=!1;const{structure:i}=this.data;if(Me.is(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;t=Me.remap(t,i);for(const o of t.elements){const s=this.unitMap.get(o.unit.id);if(s){const{index:a}=o.unit.model.atomicHierarchy.residueAtomSegments;Ve.forEach(o.indices,l=>{const c=this.sequenceIndices.get(a[s.elements[l]]);void 0!==c&&Qh(this.markerArray,Pe.ofSingleton(c),n)&&(r=!0)})}}}else if(Xe.isLoci(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;Qh(this.markerArray,Pe.ofBounds(0,this.length),n)&&(r=!0)}return r}getLoci(t){const n=[],r=this.residueIndices.get(t);if(void 0!==r){const i=this.seqToUnit.get(t),{offsets:o}=i.model.atomicHierarchy.residueAtomSegments,s=rt.findPredecessorIndex(i.elements,o[r]),a=rt.findPredecessorIndex(i.elements,o[r+1]);n.push({unit:i,indices:Pe.ofBounds(s,a)})}return Me(this.data.structure,n)}constructor(t){const n=[],r=new Map,i=new Map,o=new Map;for(let l=0,c=t.units.length;l<c;++l){const u=t.units[l],{residueAtomSegments:d,atoms:f}=u.model.atomicHierarchy,p=En.transientSegments(d,u.elements);for(;p.hasNext;){const{index:m}=p.move();r.set(m,n.length),i.set(n.length,m),o.set(n.length,u),n.push(f.label_comp_id.value(d.offsets[m]))}}const s=n.length;super(t,new Uint8Array(s),s),this.unitMap=new Map;for(const l of t.units)this.unitMap.set(l.id,l);this.sequence=n,this.sequenceIndices=r,this.residueIndices=i,this.seqToUnit=o}}class WX extends SB{residueLabel(t){return this.label}residueColor(t){return qn.black}residueClass(t){return"msp-sequence-present"}mark(t,n){let r=!1;const{structure:i}=this.data;if(Me.is(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;t=Me.remap(t,i);for(const o of t.elements){const s=this.unitIndices.get(o.unit.id);s&&Ve.isSubset(s,o.indices)&&Qh(this.markerArray,Pe.ofSingleton(0),n)&&(r=!0)}}else if(Xe.isLoci(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;Qh(this.markerArray,Pe.ofSingleton(0),n)&&(r=!0)}return r}getLoci(t){return this.loci}constructor(t){let n=0,r=0;const i=[],o=dt.create(t.structure),s=new Map,a=[];for(let u=0,d=t.units.length;u<d;++u){const f=t.units[u];dt.set(o,t.structure,f,f.elements[0]);const p=f.model.sequence.byEntityKey[Je.entity.key(o)];p&&(n+=p.sequence.length),r+=f.elements.length;const m=Pe.ofBounds(0,f.elements.length);s.set(f.id,m),a.push({unit:f,indices:m})}n>0&&i.push(`${n} residues`),i.push(`${r} elements`),super(t,new Uint8Array(1),1),this.label=`Whole Chain (${i.join(", ")})`,this.unitIndices=s,this.loci=Me(this.data.structure,a)}}class P3t extends SB{residueLabel(t){return"X"}residueColor(t){return qn.black}residueClass(t){return"msp-sequence-present"}mark(t,n){let r=!1;const{structure:i,units:o}=this.data;if(Me.is(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;t=Me.remap(t,i);for(const s of t.elements){const a=this.unitIndices.get(s.unit.id);a&&Ve.isSubset(a,s.indices)&&Qh(this.markerArray,s.indices,n)&&(r=!0)}}else if(Xe.isLoci(t)){if(!Xe.areRootsEquivalent(t.structure,i))return!1;for(let s=0,a=o.length;s<a;++s){const l=this.unitIndices.get(o[s].id);Qh(this.markerArray,l,n)&&(r=!0)}}return r}getLoci(t){const{units:n}=this.data,r=[];let i=0;for(let o=0,s=n.length;o<s;++o){const a=n[o];if(t<i+a.elements.length){r.push({unit:a,indices:Pe.ofSingleton(t-i)});break}i+=a.elements.length}return Me(this.data.structure,r)}constructor(t){let n=0;const r=new Map,i=[];for(let s=0,a=t.units.length;s<a;++s){const l=t.units[s];n+=l.elements.length;const c=Pe.ofBounds(0,l.elements.length);r.set(l.id,c),i.push({unit:l,indices:c})}super(t,new Uint8Array(n),n),this.unitIndices=r}}function D2e(e){const t=Je.unit.pdbx_struct_oper_list_ids(e),n=Je.unit.struct_ncs_oper_id(e),r=Je.unit.hkl(e),i=Je.unit.spgrOp(e);return`${t.sort().join(",")}|${n}|${r}|${i}`}function XX(e){const[t,n]=e.split("|");return[parseInt(t),n]}function P2e(e,t){const{structure:n,modelEntityId:r,chainGroupId:i,operatorKey:o}=e,s=dt.create(n),[a,l]=XX(r),c=[];for(const u of n.units)dt.set(s,n,u,u.elements[0]),n.getModelIndex(u.model)===a&&Je.entity.id(s)===l&&u.chainGroupId===i&&D2e(s)===o&&c.push(u);if(c.length>0){const u={structure:n,units:c},d=c[0];let f;if(d.polymerElements.length){const p=dt.create(n,d,d.elements[0]),m=d.model.sequence.byEntityKey[Je.entity.key(p)];if(m&&m.sequence.length<=5e3)f=new A3t(u);else{const h=c.reduce((g,y)=>g+y.polymerElements.length,0);f=ze.isAtomic(d)||h>5e3?new WX(u):new P3t(u)}}else ze.isAtomic(d)?f=c.reduce((m,h)=>m+h.residueCount,0)>5e3?new WX(u):new D3t(u):(console.warn("should not happen, expecting coarse units to be polymeric"),f=new WX(u));return f.markResidue(t.getLoci(n),un.Select),f}return"No sequence available"}function CB(e,t=!1){const n=[],r=dt.create(e),i=new Set;for(const o of e.units){dt.set(r,e,o,o.elements[0]);const s=Je.entity.id(r),a=e.getModelIndex(o.model),l=`${a}|${s}`;if(i.has(l)||t&&"polymer"!==Je.entity.type(r))continue;let c=Je.entity.pdbx_description(r).join(", ");if(e.models.length&&(e.representativeModel?c+=` (Model ${e.models[a].modelNum})`:c.startsWith("Polymer ")&&(c+=` (${e.models[a].entry})`)),n.push([l,`${s}: ${c}`]),i.add(l),n.length>1e3)return[["","Too many entities"]]}return 0===n.length&&n.push(["","No entities"]),n}function ak(e,t){const n=[],r=dt.create(e),i=new Set,[o,s]=XX(t);for(const a of e.units){if(dt.set(r,e,a,a.elements[0]),e.getModelIndex(a.model)!==o||Je.entity.id(r)!==s)continue;const l=a.chainGroupId;if(i.has(l))continue;const c=em(r,{granularity:"chain",hidePrefix:!0,htmlStyling:!1});if(n.push([l,c]),i.add(l),n.length>1e3)return[[-1,"Too many chains"]]}return 0===n.length&&n.push([-1,"No chains"]),n}function AI(e,t,n){const r=[],i=dt.create(e),o=new Set,[s,a]=XX(t);for(const l of e.units){if(dt.set(i,e,l,l.elements[0]),e.getModelIndex(l.model)!==s||Je.entity.id(i)!==a||l.chainGroupId!==n)continue;const c=D2e(i);if(!o.has(c)&&(r.push([c,l.conformation.operator.name]),o.add(c),r.length>1e3))return[["","Too many operators"]]}return 0===r.length&&r.push(["","No operators"]),r}function k2e(e){var t;const n=[],r=[],i=e.select(Qn.Generators.rootsOfType(Se.Molecule.Structure));for(const o of i)null!==(t=o.obj)&&void 0!==t&&t.data&&(r.push(o.obj.data),n.push([o.transform.ref,o.obj.data.label]));return 0===n.length&&n.push(["","No structure"]),{options:n,all:r}}const M2e=I.Select("single",[["single","Chain"],["polymers","Polymers"],["all","Everything"]]);class M3t extends Vr{constructor(){super(...arguments),this.state={structureOptions:{options:[],all:[]},structure:Xe.Empty,structureRef:"",modelEntityId:"",chainGroupId:-1,operatorKey:"",mode:"single"},this.setParamProps=t=>{const n={...this.state};switch(t.name){case"mode":if(n.mode=t.value,this.state.mode===n.mode)return;if("all"===n.mode||"polymers"===n.mode)break;case"structure":"structure"===t.name&&(n.structureRef=t.value),n.structure=this.getStructure(n.structureRef),n.modelEntityId=CB(n.structure)[0][0],n.chainGroupId=ak(n.structure,n.modelEntityId)[0][0],n.operatorKey=AI(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"entity":n.modelEntityId=t.value,n.chainGroupId=ak(n.structure,n.modelEntityId)[0][0],n.operatorKey=AI(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"chain":n.chainGroupId=t.value,n.operatorKey=AI(n.structure,n.modelEntityId,n.chainGroupId)[0][0];break;case"operator":n.operatorKey=t.value}this.setState(n)}}componentDidMount(){this.plugin.state.data.select(Qn.Generators.rootsOfType(Se.Molecule.Structure)).length>0&&this.setState(this.getInitialState()),this.subscribe(this.plugin.state.events.object.updated,({ref:t,obj:n})=>{t===this.state.structureRef&&n&&n.type===Se.Molecule.Structure.type&&n.data!==this.state.structure&&this.sync()}),this.subscribe(this.plugin.state.events.object.created,({obj:t})=>{t&&t.type===Se.Molecule.Structure.type&&this.sync()}),this.subscribe(this.plugin.state.events.object.removed,({obj:t})=>{t&&t.type===Se.Molecule.Structure.type&&t.data===this.state.structure&&this.sync()})}sync(){IU(k2e(this.plugin.state.data).all,this.state.structureOptions.all)||this.setState(this.getInitialState())}getStructure(t){const r=this.plugin.state.data.select(t)[0];return t&&r&&r.obj?r.obj.data:Xe.Empty}getSequenceWrapper(t){return{wrapper:P2e(this.state,this.plugin.managers.structure.selection),label:`${I.optionLabel(t.chain,this.state.chainGroupId)} | ${I.optionLabel(t.entity,this.state.modelEntityId)}`}}getSequenceWrappers(t){if("single"===this.state.mode)return[this.getSequenceWrapper(t)];const n=this.getStructure(this.state.structureRef),r=[];for(const[i,o]of CB(n,"polymers"===this.state.mode))for(const[s,a]of ak(n,i))for(const[l]of AI(n,i,s))if(r.push({wrapper:P2e({structure:n,modelEntityId:i,chainGroupId:s,operatorKey:l},this.plugin.managers.structure.selection),label:`${a} | ${o}`}),r.length>30)return[];return r}getInitialState(){var t;const n=k2e(this.plugin.state.data),r=n.options[0][0],i=this.getStructure(r);let o=CB(i)[0][0],s=ak(i,o)[0][0],a=AI(i,o,s)[0][0];return this.state.structure&&this.state.structure===i&&(o=this.state.modelEntityId,s=this.state.chainGroupId,a=this.state.operatorKey),{structureOptions:n,structure:i,structureRef:r,modelEntityId:o,chainGroupId:s,operatorKey:a,mode:null!==(t=this.props.defaultMode)&&void 0!==t?t:"single"}}get params(){const{structureOptions:t,structure:n,modelEntityId:r,chainGroupId:i}=this.state,o=CB(n),s=ak(n,r),a=AI(n,r,i);return{structure:I.Select(t.options[0][0],t.options,{shortLabel:!0}),entity:I.Select(o[0][0],o,{shortLabel:!0}),chain:I.Select(s[0][0],s,{shortLabel:!0,twoColumns:!0,label:"Chain"}),operator:I.Select(a[0][0],a,{shortLabel:!0,twoColumns:!0}),mode:M2e}}get values(){return{structure:this.state.structureRef,entity:this.state.modelEntityId,chain:this.state.chainGroupId,operator:this.state.operatorKey,mode:this.state.mode}}render(){if(this.getStructure(this.state.structureRef)===Xe.Empty)return(0,L.jsx)("div",{className:"msp-sequence",children:(0,L.jsxs)("div",{className:"msp-sequence-select",children:[(0,L.jsx)(Mi,{svg:Ng,style:{cursor:"help",position:"absolute",right:0,top:0},title:"Shows a sequence of one or more chains. Use the controls to alter selection."}),(0,L.jsx)("span",{children:"Sequence"}),(0,L.jsx)("span",{style:{fontWeight:"normal"},children:"No structure available"})]})});const t=this.params,n=this.values,r=this.getSequenceWrappers(t);return(0,L.jsxs)("div",{className:"msp-sequence",children:[(0,L.jsxs)("div",{className:"msp-sequence-select",children:[(0,L.jsx)(Mi,{svg:Ng,style:{cursor:"help",position:"absolute",right:0,top:0},title:"This shows a single sequence. Use the controls to show a different sequence."}),(0,L.jsx)("span",{children:"Sequence of"}),(0,L.jsx)(jA,{title:`[Structure] ${I.optionLabel(t.structure,n.structure)}`,param:t.structure,name:"structure",value:n.structure,onChange:this.setParamProps}),(0,L.jsx)(jA,{title:"[Mode]",param:M2e,name:"mode",value:n.mode,onChange:this.setParamProps}),"single"===n.mode&&(0,L.jsx)(jA,{title:`[Entity] ${I.optionLabel(t.entity,n.entity)}`,param:t.entity,name:"entity",value:n.entity,onChange:this.setParamProps}),"single"===n.mode&&(0,L.jsx)(jA,{title:`[Chain] ${I.optionLabel(t.chain,n.chain)}`,param:t.chain,name:"chain",value:n.chain,onChange:this.setParamProps}),t.operator.options.length>1&&(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(jA,{title:`[Instance] ${I.optionLabel(t.operator,n.operator)}`,param:t.operator,name:"operator",value:n.operator,onChange:this.setParamProps})})]}),(0,L.jsx)(R3t,{children:r.map((i,o)=>{const s="string"==typeof i.wrapper?(0,L.jsx)("div",{className:"msp-sequence-wrapper",children:i.wrapper},o):(0,L.jsx)(w3t,{sequenceWrapper:i.wrapper},o);return"single"===n.mode?s:(0,L.jsxs)(Yt.Fragment,{children:[(0,L.jsx)("div",{className:"msp-sequence-chain-label",children:i.label}),s]},o)})})]})}}function R3t({children:e}){return(0,L.jsx)("div",{className:"msp-sequence-wrapper-non-empty",children:e})}const O3t=Yt.useSyncExternalStore?function F3t(e){return Yt.useSyncExternalStore(Yt.useCallback(t=>{const n=e?.pipe(f2e(1)).subscribe(t);return()=>n?.unsubscribe()},[e]),Yt.useCallback(()=>e?.value,[e]))}:function N3t(e){const[,t]=Yt.useState({}),n=Yt.useRef();return n.current=e?.value,Yt.useEffect(()=>{if(!e)return;const r=e.subscribe(i=>{n.current!==i&&t({})});return()=>r.unsubscribe()},[e]),e?.value};function cb(e){return O3t(e)}function B3t(){const e=(0,Yt.useContext)(cm),[t,n]=(0,Yt.useState)(Nc());return(0,Yt.useEffect)(()=>{const r=e.events.task.progress.subscribe(o=>{var s;const a=!(null===(s=e.spec.components)||void 0===s||!s.hideTaskOverlay);"background"===o.level&&(a||!o.useOverlay)&&n(l=>l.set(o.id,o))}),i=e.events.task.finished.subscribe(({id:o})=>{n(s=>s.delete(o))});return()=>{r.unsubscribe(),i.unsubscribe()}},[e]),(0,L.jsxs)("div",{className:"msp-background-tasks",children:[t.valueSeq().map(r=>(0,L.jsx)(R2e,{event:r},r.id)),(0,L.jsx)(L3t,{})]})}function L3t(){var e;const n=cb(null===(e=(0,Yt.useContext)(cm).canvas3d)||void 0===e?void 0:e.commitQueueSize);return n?(0,L.jsx)("div",{className:"msp-task-state",children:(0,L.jsx)("div",{children:(0,L.jsxs)("div",{children:["Commiting renderables... ",n," remaining"]})})}):null}class R2e extends Vr{constructor(){super(...arguments),this.abort=()=>{this.plugin.managers.task.requestAbort(this.props.event.progress.root.progress.taskId,"User Request")}}render(){const t=this.props.event.progress.root,n=N2e(this.props.event.progress.root)-1,r=t.progress.isIndeterminate?void 0:(0,L.jsxs)(L.Fragment,{children:["[",t.progress.current,"/",t.progress.max,"]"]}),i=n>0?(0,L.jsxs)(L.Fragment,{children:["[",n," subtask(s)]"]}):void 0;return(0,L.jsx)("div",{className:"msp-task-state",children:(0,L.jsxs)("div",{children:[t.progress.canAbort&&(0,L.jsx)(kn,{svg:Tbe,onClick:this.abort,title:"Abort"}),(0,L.jsxs)("div",{children:[t.progress.message," ",r," ",i]})]})})}}function N2e(e){if(0===e.children.length)return 1;let t=0;for(const n of e.children)t+=N2e(n);return t}function j3t(){const e=(0,Yt.useContext)(cm),[t,n]=(0,Yt.useState)(Nc());return(0,Yt.useEffect)(()=>{const r=e.events.task.progress.subscribe(o=>{o.useOverlay&&n(s=>s.set(o.id,o))}),i=e.events.task.finished.subscribe(({id:o})=>{n(s=>s.delete(o))});return()=>{r.unsubscribe(),i.unsubscribe()}},[e]),0===t.size?null:(0,L.jsx)("div",{className:"msp-overlay-tasks",children:t.valueSeq().map(r=>(0,L.jsx)(R2e,{event:r},r.id))})}class U3t extends Vr{constructor(){super(...arguments),this.hide=()=>{(this.props.entry.hide||function(){}).call(null)}}render(){const t=this.props.entry,n=(0,L.jsx)("div","string"==typeof t.message?{dangerouslySetInnerHTML:{__html:t.message}}:{children:(0,L.jsx)(t.message,{})});return(0,L.jsxs)("div",{className:"msp-toast-entry",children:[(0,L.jsx)("div",{className:"msp-toast-title",onClick:()=>this.hide(),children:t.title}),(0,L.jsx)("div",{className:"msp-toast-message",children:n}),(0,L.jsx)("div",{className:"msp-toast-clear"}),(0,L.jsx)("div",{className:"msp-toast-hide",children:(0,L.jsx)(kn,{svg:Tbe,onClick:this.hide,title:"Hide",className:"msp-no-hover-outline"})})]})}}class z3t extends Vr{componentDidMount(){this.subscribe(this.plugin.managers.toast.events.changed,()=>this.forceUpdate())}render(){const t=this.plugin.managers.toast.state;if(!t.entries.count())return null;const n=[];return t.entries.forEach((r,i)=>n.push(r)),n.sort(function(r,i){return r.serialNumber-i.serialNumber}),(0,L.jsx)("div",{className:"msp-toast-container",children:n.map(r=>(0,L.jsx)(U3t,{entry:r},r.serialNumber))})}}class V3t extends Vr{constructor(){super(...arguments),this.container=Yt.createRef(),this.state={noWebGl:!1,showLogo:!0},this.handleLogo=()=>{var t;this.setState({showLogo:!(null!==(t=this.plugin.canvas3d)&&void 0!==t&&t.reprCount.value)})}}componentDidMount(){this.container.current&&this.plugin.mount(this.container.current,{checkeredCanvasBackground:!0})?(this.handleLogo(),this.subscribe(this.plugin.canvas3d.reprCount,this.handleLogo)):this.setState({noWebGl:!0})}componentWillUnmount(){super.componentWillUnmount(),this.plugin.unmount()}renderMissing(){return this.props.noWebGl?(0,L.jsx)(this.props.noWebGl,{}):(0,L.jsx)("div",{className:"msp-no-webgl",children:(0,L.jsxs)("div",{children:[(0,L.jsx)("p",{children:(0,L.jsx)("b",{children:"WebGL does not seem to be available."})}),(0,L.jsx)("p",{children:"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps. Also, make sure hardware acceleration is enabled in your browser."}),(0,L.jsxs)("p",{children:["For a list of supported browsers, refer to ",(0,L.jsx)("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank",children:"http://caniuse.com/#feat=webgl"}),"."]})]})})}render(){if(this.state.noWebGl)return this.renderMissing();const t=this.props.logo;return(0,L.jsx)("div",{className:this.props.parentClassName||"msp-viewport",style:this.props.parentStyle,ref:this.container,children:this.state.showLogo&&t&&(0,L.jsx)(t,{})})}}const G3t=Yt.memo(e=>{const{plugin:t,cropFrameColor:n}=e,r=t.helpers.viewportScreenshot,[i,o]=(0,Yt.useState)(null),s=(0,Yt.useRef)(null),a=(0,Yt.useRef)(e);return(0,Yt.useEffect)(()=>{a.current=e},Object.values(e)),(0,Yt.useEffect)(()=>{i!==s.current&&o(s.current)}),(0,Yt.useEffect)(()=>{var l;let c=!1;const u=[];function d(g,y){g&&u.push(g.subscribe(y))}function f(){const g=a.current;!g.suspend&&s.current&&F2e(r,s.current,g.customBackground,g.borderColor,g.borderWidth),s.current||(c=!0)}const p=setInterval(()=>{c&&(c=!1,f())},125);let m;d(t.events.canvas3d.settingsUpdated,()=>c=!0),d(null===(l=t.canvas3d)||void 0===l?void 0:l.didDraw,()=>c=!0),d(t.state.data.behaviors.isUpdating,g=>{g||(c=!0)}),d(r?.behaviors.values,()=>c=!0),d(r?.behaviors.cropParams,()=>c=!0),typeof ResizeObserver<"u"&&(m=new ResizeObserver(()=>c=!0));const h=s.current;return m?.observe(h),f(),()=>{clearInterval(p),u.forEach(g=>g.unsubscribe()),m?.unobserve(h)}},[r]),(0,Yt.useLayoutEffect)(()=>{s.current&&F2e(r,s.current,e.customBackground,e.borderColor,e.borderWidth)},[...Object.values(e)]),(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)("div",{style:{position:"relative",width:"100%",height:"100%"},children:[(0,L.jsx)("canvas",{ref:s,onContextMenu:l=>{l.preventDefault(),l.stopPropagation()},style:{display:"block",width:"100%",height:"100%"}}),(0,L.jsx)(q3t,{plugin:t,canvas:i,color:n})]})})},(e,t)=>FR(e,t));function F2e(e,t,n,r,i){if(!e)return;const{canvas:o,width:s,height:a}=e.getPreview(),l=t.getContext("2d");if(!l)return;const c=t.clientWidth,u=t.clientHeight;t.width=c,t.height=u,l.clearRect(0,0,c,u);const d=B2e(s,a,c,u);if(n)l.fillStyle=n,l.fillRect(d.x,d.y,d.width,d.height);else if(e.values.transparent)for(let p=0;p<d.width;p+=13)for(let m=0;m<d.height;m+=13)l.fillStyle=(p+m)%2?"#ffffff":"#bfbfbf",l.fillRect(d.x+p,d.y+m,p+13>d.width?d.width-p:13,m+13>d.height?d.height-m:13);if(l.drawImage(o,d.x,d.y,d.width,d.height),r&&i){const f=i;l.rect(d.x,d.y,d.width,d.height),l.rect(d.x+f,d.y+f,d.width-2*f,d.height-2*f),l.fillStyle=r,l.fill("evenodd")}}function q3t({plugin:e,canvas:t,color:n="rgba(255, 87, 45, 0.75)"}){var r;const i=e.helpers.viewportScreenshot,o=cb(i?.behaviors.values),s=cb(i?.behaviors.cropParams),a=cb(i?.behaviors.relativeCrop),l=(0,Yt.useRef)({x:0,y:0,width:0,height:0});cb("viewport"===o?.resolution.name?null===(r=e.canvas3d)||void 0===r?void 0:r.resized:void 0);const[c,u]=Yt.useState(""),[d,f]=(0,Yt.useState)([0,0]),[p,m]=(0,Yt.useState)([0,0]);if(!i||!t||!a)return null;const{width:h,height:g}=i.getSizeAndViewport(),y=B2e(h,g,t.clientWidth,t.clientHeight),v={x:y.x+Math.floor(y.width*a.x),y:y.y+Math.floor(y.height*a.y),width:Math.ceil(y.width*a.width),height:Math.ceil(y.height*a.height)},x=O2e(v),_=O2e(y);if("move"===c?(x.l+=p[0]-d[0],x.r+=p[0]-d[0],x.t+=p[1]-d[1],x.b+=p[1]-d[1]):c&&(c.indexOf("left")>=0?x.l+=p[0]-d[0]:c.indexOf("right")>=0&&(x.r+=p[0]-d[0]),c.indexOf("top")>=0?x.t+=p[1]-d[1]:c.indexOf("bottom")>=0&&(x.b+=p[1]-d[1])),x.l>x.r){const $=x.l;x.l=x.r,x.r=$}if(x.t>x.b){const $=x.t;x.t=x.b,x.b=$}x.l=Math.min(_.r-40,Math.max(_.l,x.l)),x.r=Math.max(_.l+40,Math.min(_.r,x.r)),x.t=Math.min(_.b-40,Math.max(_.t,x.t)),x.b=Math.max(_.t+40,Math.min(_.b,x.b)),v.x=x.l,v.y=x.t,v.width=x.r-x.l+1,v.height=x.b-x.t+1,l.current=v;const A=$=>{$.preventDefault(),m([$.pageX,$.pageY])},M=$=>{$.preventDefault();const V=$.touches[0];m([V.pageX,V.pageY])},E=$=>{$.preventDefault(),u($.currentTarget.getAttribute("data-drag"));const V=$.touches[0],X=[V.pageX,V.pageY];f(X),m(X),window.addEventListener("touchend",F),window.addEventListener("touchmove",M)},D=$=>{$.preventDefault(),u($.currentTarget.getAttribute("data-drag"));const V=[$.pageX,$.pageY];f(V),m(V),window.addEventListener("mouseup",T),window.addEventListener("mousemove",A)},T=()=>{window.removeEventListener("mouseup",T),window.removeEventListener("mousemove",A),R()},F=()=>{window.removeEventListener("touchend",F),window.removeEventListener("touchmove",M),R()};function R(){const $=l.current;s?.auto&&i?.behaviors.cropParams.next({...s,auto:!1}),i?.behaviors.relativeCrop.next({x:($.x-y.x)/y.width,y:($.y-y.y)/y.height,width:$.width/y.width,height:$.height/y.height}),u("");const V=[0,0];f(V),m(V)}const N=$=>{$.preventDefault(),$.stopPropagation()},z="transparent";return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)("div",{"data-drag":"move",style:{position:"absolute",left:v.x,top:v.y,width:v.width,height:v.height,border:`3px solid ${n}`,cursor:"move"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"left",style:{position:"absolute",left:v.x-4,top:v.y+4,width:16,height:v.height-4,background:z,cursor:"w-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"right",style:{position:"absolute",left:x.r-8,top:v.y,width:16,height:v.height-4,background:z,cursor:"w-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"top",style:{position:"absolute",left:v.x-4,top:v.y-4,width:v.width+8,height:16,background:z,cursor:"n-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"bottom",style:{position:"absolute",left:v.x-4,top:x.b-8,width:v.width+8,height:16,background:z,cursor:"n-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"top, left",style:{position:"absolute",left:x.l-4,top:x.t-4,width:16,height:16,background:z,cursor:"nw-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"bottom, right",style:{position:"absolute",left:x.r-8,top:x.b-8,width:16,height:16,background:z,cursor:"nw-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"top, right",style:{position:"absolute",left:x.r-8,top:x.t-4,width:16,height:16,background:z,cursor:"ne-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N}),(0,L.jsx)("div",{"data-drag":"bottom, left",style:{position:"absolute",left:x.l-4,top:x.b-8,width:16,height:16,background:z,cursor:"ne-resize"},onMouseDown:D,onTouchStart:E,draggable:!1,onContextMenu:N})]})}function O2e(e){return{l:e.x,t:e.y,r:e.x+e.width-1,b:e.y+e.height-1}}function B2e(e,t,n,r){const i=e/t;if(i<=n/r){const s=r*i;return{x:Math.round((n-s)/2),y:0,width:Math.round(s),height:r}}{const s=n/i;return{x:0,y:Math.round((r-s)/2),width:n,height:Math.round(s)}}}class W3t extends Vr{constructor(){var t;super(...arguments),t=this,this.state={showPreview:!0,isDisabled:!1},this.download=()=>{var n;null===(n=this.plugin.helpers.viewportScreenshot)||void 0===n||n.download(),this.props.close()},this.copy=le(function*(){var n;try{yield null===(n=t.plugin.helpers.viewportScreenshot)||void 0===n?void 0:n.copyToClipboard(),jt.Toast.Show(t.plugin,{message:"Copied to clipboard.",title:"Screenshot",timeoutMs:1500})}catch{return t.copyImg()}}),this.copyImg=le(function*(){var n;const r=yield null===(n=t.plugin.helpers.viewportScreenshot)||void 0===n?void 0:n.getImageDataUri();t.setState({imageData:r})}),this.open=n=>{!n.target.files||!n.target.files[0]||jt.State.Snapshots.OpenFile(this.plugin,{file:n.target.files[0]})}}componentDidMount(){this.subscribe(this.plugin.state.data.behaviors.isUpdating,t=>{this.setState({isDisabled:t})})}componentWillUnmount(){super.componentWillUnmount(),this.setState({imageData:void 0})}render(){var t;const n=!(null===(t=navigator.clipboard)||void 0===t||!t.write);return(0,L.jsxs)("div",{children:[this.state.showPreview&&(0,L.jsxs)("div",{className:"msp-image-preview",children:[(0,L.jsx)(G3t,{plugin:this.plugin}),(0,L.jsx)(Y3t,{plugin:this.plugin})]}),(0,L.jsxs)("div",{className:"msp-flex-row",children:[!this.state.imageData&&(0,L.jsx)(ir,{icon:kyt,onClick:n?this.copy:this.copyImg,disabled:this.state.isDisabled,children:"Copy"}),this.state.imageData&&(0,L.jsx)(ir,{onClick:()=>this.setState({imageData:void 0}),disabled:this.state.isDisabled,children:"Clear"}),(0,L.jsx)(ir,{icon:zW,onClick:this.download,disabled:this.state.isDisabled,children:"Download"})]}),this.state.imageData&&(0,L.jsxs)("div",{className:"msp-row msp-copy-image-wrapper",children:[(0,L.jsx)("div",{children:"Right click below + Copy Image"}),(0,L.jsx)("img",{src:this.state.imageData,style:{width:"100%",height:32,display:"block"}})]}),(0,L.jsx)($3t,{plugin:this.plugin,isDisabled:this.state.isDisabled}),(0,L.jsxs)(lm,{header:"State",children:[(0,L.jsx)(S2e,{onAction:this.props.close}),(0,L.jsx)(lm,{header:"Save Options",initiallyExpanded:!1,noOffset:!0,children:(0,L.jsx)(C2e,{})})]})]})}}function $3t({plugin:e,isDisabled:t}){const n=e.helpers.viewportScreenshot,r=cb(n?.behaviors.values);return n?(0,L.jsx)(vs,{params:n.params,values:r,onChangeValues:i=>n.behaviors.values.next(i),isDisabled:t}):null}function Y3t({plugin:e}){const t=e.helpers.viewportScreenshot,n=cb(t?.behaviors.cropParams);return cb(t?.behaviors.relativeCrop),t&&n?(0,L.jsxs)("div",{style:{width:"100%",height:"24px",marginTop:"8px"},children:[(0,L.jsx)(yl,{icon:Byt,title:"Auto-crop",inline:!0,isSelected:n.auto,style:{background:"transparent",float:"left",width:"auto",height:"24px",lineHeight:"24px"},toggle:()=>t.toggleAutocrop(),label:"Auto-crop "+(n.auto?"On":"Off")}),!n.auto&&(0,L.jsx)(ir,{icon:Ryt,title:"Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.autocrop()}),!n.auto&&!t.isFullFrame&&(0,L.jsx)(ir,{icon:Fyt,title:"Reset Crop",style:{background:"transparent",float:"right",height:"24px",lineHeight:"24px",width:"24px",padding:"0"},onClick:()=>t.resetCrop()})]}):null}class K3t extends Vr{componentDidMount(){this.plugin.canvas3d&&(this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(mA(500,void 0,{leading:!0,trailing:!0})),t=>{(void 0!==t.radiusMax||void 0!==t.radius)&&this.forceUpdate()}))}render(){return this.plugin.canvas3d?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(Bbt,{mapping:Q3t}),(0,L.jsx)(zX,{})]}):null}}const lk={sequence:"Sequence",log:"Log",left:"Left Panel",right:"Right Panel"},Z3t={animate:Fd.trackball.params.animate,camera:Fd.camera,background:I.Group({color:I.Color(st(16579577),{label:"Background",description:"Custom background color"}),transparent:I.Boolean(!1),style:Fd.postprocessing.params.background},{pivot:"color"}),lighting:I.Group({occlusion:Fd.postprocessing.params.occlusion,shadow:Fd.postprocessing.params.shadow,outline:Fd.postprocessing.params.outline,fog:Fd.cameraFog},{isFlat:!0}),clipping:I.Group({...Fd.cameraClipping.params},{pivot:"radius"}),layout:I.MultiSelect([],I.objectToOptions(lk)),advanced:I.Group({multiSample:Fd.multiSample,hiZ:Fd.hiZ,sharpening:Fd.postprocessing.params.sharpening,pixelScale:K_.Params.pixelScale,transparency:K_.Params.transparency})},Q3t=function X3t(e){return({values:t,update:n,apply:r})=>({params:"function"==typeof e.params?e.params:i=>e.params,getTarget:e.target,getValues:t,update(i,o){const s=e.target(o);return fy(s,a=>n(i,a,o))},apply:r||(()=>{})})}({params:e=>{var t;const n=I.clone(Z3t),r=null===(t=e.spec.components)||void 0===t?void 0:t.controls;if(r){const o=[];"none"!==r.top&&o.push(["sequence",lk.sequence]),"none"!==r.bottom&&o.push(["log",lk.log]),"none"!==r.left&&o.push(["left",lk.left]),"none"!==r.right&&o.push(["right",lk.right]),n.layout.options=o}const i=e.config.get(ei.Background.Styles)||[];return i.length>0&&Object.assign(n.background.params.style,{presets:op(i),isFlat:!1}),n},target(e){var t,n,r;const i=null===(t=e.spec.components)||void 0===t?void 0:t.controls,o=e.layout.state.regionState,s=[];"hidden"!==o.top&&(!i||"none"!==i.top)&&s.push("sequence"),"hidden"!==o.bottom&&(!i||"none"!==i.bottom)&&s.push("log"),"hidden"!==o.left&&(!i||"none"!==i.left)&&s.push("left"),"hidden"!==o.right&&(!i||"none"!==i.right)&&s.push("right");const{pixelScale:a,transparency:l}=null===(n=e.canvas3dContext)||void 0===n?void 0:n.props;return{canvas:null===(r=e.canvas3d)||void 0===r?void 0:r.props,layout:s,pixelScale:a,transparency:l}}})({values(e,t){const{canvas:n}=e;return{layout:e.layout,animate:n.trackball.animate,camera:n.camera,background:{color:n.renderer.backgroundColor,transparent:n.transparentBackground,style:n.postprocessing.background},lighting:{occlusion:n.postprocessing.occlusion,shadow:n.postprocessing.shadow,outline:n.postprocessing.outline,fog:n.cameraFog},clipping:{...n.cameraClipping},advanced:{multiSample:n.multiSample,hiZ:n.hiZ,sharpening:n.postprocessing.sharpening,pixelScale:e.pixelScale,transparency:e.transparency}}},update(e,t){const n=t.canvas;n.trackball.animate=e.animate,n.camera=e.camera,n.transparentBackground=e.background.transparent,n.renderer.backgroundColor=e.background.color,n.postprocessing.occlusion=e.lighting.occlusion,n.postprocessing.shadow=e.lighting.shadow,n.postprocessing.outline=e.lighting.outline,n.postprocessing.background=e.background.style,n.cameraFog=e.lighting.fog,n.cameraClipping={radius:e.clipping.radius,far:e.clipping.far,minNear:e.clipping.minNear},n.multiSample=e.advanced.multiSample,n.hiZ=e.advanced.hiZ,n.postprocessing.sharpening=e.advanced.sharpening,t.layout=e.layout,t.pixelScale=e.advanced.pixelScale,t.transparency=e.advanced.transparency},apply:(e,t)=>le(function*(){var n;yield jt.Canvas3D.SetSettings(t,{settings:e.canvas});const r=e.layout.indexOf("left")<0,i=fy(t.layout.state,o=>{o.regionState.top=e.layout.indexOf("sequence")>=0?"full":"hidden",o.regionState.bottom=e.layout.indexOf("log")>=0?"full":"hidden",o.regionState.left=r?"hidden":"none"===t.behaviors.layout.leftPanelTabName.value?"collapsed":"full",o.regionState.right=e.layout.indexOf("right")>=0?"full":"hidden"});yield jt.Layout.Update(t,{state:i}),r&&jt.State.SetCurrentObject(t,{state:t.state.data,ref:vr.RootRef}),null===(n=t.canvas3dContext)||void 0===n||n.setProps({pixelScale:e.pixelScale,transparency:e.transparency})})()});class J3t extends Vr{constructor(){super(...arguments),this.allCollapsedState={isSettingsExpanded:!1,isScreenshotExpanded:!1},this.state={...this.allCollapsedState,isCameraResetEnabled:!0},this.resetCamera=()=>{jt.Camera.Reset(this.plugin,{})},this.toggleSettingsExpanded=this.toggle("isSettingsExpanded"),this.toggleScreenshotExpanded=this.toggle("isScreenshotExpanded"),this.toggleControls=()=>{jt.Layout.Update(this.plugin,{state:{showControls:!this.plugin.layout.state.showControls}})},this.toggleExpanded=()=>{jt.Layout.Update(this.plugin,{state:{isExpanded:!this.plugin.layout.state.isExpanded}})},this.setSettings=t=>{jt.Canvas3D.SetSettings(this.plugin,{settings:{[t.name]:t.value}})},this.setLayout=t=>{jt.Layout.Update(this.plugin,{state:{[t.name]:t.value}})},this.screenshot=()=>{var t;null===(t=this.plugin.helpers.viewportScreenshot)||void 0===t||t.download()},this.enableCameraReset=t=>{this.setState(n=>({...n,isCameraResetEnabled:t}))}}toggle(t){return n=>{this.setState(r=>({...r,...this.allCollapsedState,[t]:!this.state[t]})),n?.currentTarget.blur()}}componentDidMount(){this.subscribe(this.plugin.events.canvas3d.settingsUpdated,()=>this.forceUpdate()),this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate()),this.plugin.canvas3d&&this.subscribe(this.plugin.canvas3d.camera.stateChanged.pipe(mA(500,void 0,{leading:!0,trailing:!0})),t=>this.enableCameraReset(0!==t.radius&&0!==t.radiusMax))}icon(t,n,r,i=!0){return(0,L.jsx)(kn,{svg:t,toggleState:i,onClick:n,title:r,style:{background:"transparent"}})}render(){return(0,L.jsxs)("div",{className:"msp-viewport-controls",children:[(0,L.jsxs)("div",{className:"msp-viewport-controls-buttons",children:[(0,L.jsxs)("div",{className:"msp-hover-box-wrapper",children:[(0,L.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(ayt,this.resetCamera,"Reset Zoom"),(0,L.jsx)("div",{className:"msp-hover-box-body",children:(0,L.jsxs)("div",{className:"msp-flex-column",children:[(0,L.jsx)("div",{className:"msp-flex-row",children:(0,L.jsx)(ir,{onClick:()=>this.resetCamera(),disabled:!this.state.isCameraResetEnabled,title:"Set camera zoom to fit the visible scene into view",children:"Reset Zoom"})}),(0,L.jsx)("div",{className:"msp-flex-row",children:(0,L.jsx)(ir,{onClick:()=>jt.Camera.OrientAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align principal component axes of the loaded structures to the screen axes (\u201clay flat\u201d)",children:"Orient Axes"})}),(0,L.jsx)("div",{className:"msp-flex-row",children:(0,L.jsx)(ir,{onClick:()=>jt.Camera.ResetAxes(this.plugin),disabled:!this.state.isCameraResetEnabled,title:"Align Cartesian axes to the screen axes",children:"Reset Axes"})})]})}),(0,L.jsx)("div",{className:"msp-hover-box-spacer"})]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"msp-semi-transparent-background"}),this.icon(gyt,this.toggleScreenshotExpanded,"Screenshot / State Snapshot",this.state.isScreenshotExpanded)]}),(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"msp-semi-transparent-background"}),this.plugin.config.get(ei.Viewport.ShowControls)&&this.icon(fyt,this.toggleControls,"Toggle Controls Panel",this.plugin.layout.state.showControls),this.plugin.config.get(ei.Viewport.ShowExpand)&&this.icon(qyt,this.toggleExpanded,"Toggle Expanded Viewport",this.plugin.layout.state.isExpanded),this.plugin.config.get(ei.Viewport.ShowSettings)&&this.icon(uv,this.toggleSettingsExpanded,"Settings / Controls Info",this.state.isSettingsExpanded)]}),this.plugin.config.get(ei.Viewport.ShowSelectionMode)&&(0,L.jsxs)("div",{children:[(0,L.jsx)("div",{className:"msp-semi-transparent-background"}),(0,L.jsx)(VX,{})]})]}),this.state.isScreenshotExpanded&&(0,L.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,L.jsx)(Fg,{header:"Screenshot / State",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleScreenshotExpanded,topRightIcon:Rg,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,L.jsx)(W3t,{close:this.toggleScreenshotExpanded})})}),this.state.isSettingsExpanded&&(0,L.jsx)("div",{className:"msp-viewport-controls-panel",children:(0,L.jsx)(Fg,{header:"Settings / Controls Info",title:"Click to close.",initialExpanded:!0,hideExpander:!0,hideOffset:!0,onHeaderClick:this.toggleSettingsExpanded,topRightIcon:Rg,noTopMargin:!0,childrenClassName:"msp-viewport-controls-panel-controls",children:(0,L.jsx)(K3t,{})})})]})}}const eDt=()=>(0,L.jsx)("a",{className:"msp-logo",href:"https://molstar.org",target:"_blank"}),tDt=()=>(0,L.jsx)(V3t,{logo:eDt});function nDt({plugin:e}){return e.isInitialized?(0,L.jsx)(cm.Provider,{value:e,children:(0,L.jsx)(L2e,{})}):(0,L.jsx)(rDt,{plugin:e})}function rDt({plugin:e}){const[t,n]=Yt.useState({kind:"pending"});return Yt.useEffect(()=>{n({kind:"pending"});let r=!0;return e.initialized.then(()=>{r&&n({kind:"initialized"})}).catch(i=>{r&&n({kind:"error",message:`${i}`})}),()=>{r=!1}},[e]),"pending"===t.kind?null:"error"===t.kind?(0,L.jsx)("div",{className:"msp-plugin",children:(0,L.jsxs)("div",{className:"msp-plugin-init-error",children:["Initialization error: ",t.message]})}):(0,L.jsx)(cm.Provider,{value:e,children:(0,L.jsx)(L2e,{})})}class L2e extends Vr{constructor(){super(...arguments),this.onDrop=t=>{t.preventDefault();const n=[];if(t.dataTransfer.items)for(let i=0;i<t.dataTransfer.items.length;i++){if("file"!==t.dataTransfer.items[i].kind)continue;const o=t.dataTransfer.items[i].getAsFile();o&&n.push(o)}else for(let i=0;i<t.dataTransfer.files.length;i++){const o=t.dataTransfer.files[i];o&&n.push(o)}const r=n.filter(i=>{const o=i.name.toLowerCase();return o.endsWith(".molx")||o.endsWith(".molj")});r.length>0?jt.State.Snapshots.OpenFile(this.plugin,{file:r[0]}):this.plugin.runTask(this.plugin.state.data.applyAction(NW,{files:n.map(i=>jr.File(i)),format:{name:"auto",params:{}},visuals:!0}))},this.onDragOver=t=>{t.preventDefault()},this.showDragOverlay=new Ao(!1),this.onDragEnter=t=>{let n=!1;if(t.dataTransfer.items&&t.dataTransfer.items.length>0){for(let r=0;r<t.dataTransfer.items.length;r++)if("file"===t.dataTransfer.items[r].kind){n=!0;break}}else for(let r=0;r<t.dataTransfer.types.length;r++)if("Files"===t.dataTransfer.types[r]){n=!0;break}n&&this.showDragOverlay.next(!0)}}componentDidMount(){this.subscribe(this.plugin.layout.events.updated,()=>this.forceUpdate())}region(t,n){return(0,L.jsx)("div",{className:`msp-layout-region msp-layout-${t}`,children:(0,L.jsx)("div",{className:"msp-layout-static",children:n?(0,L.jsx)(n,{}):null})})}get layoutVisibilityClassName(){var t,n;const r=this.plugin.layout.state,i=null!==(n=null===(t=this.plugin.spec.components)||void 0===t?void 0:t.controls)&&void 0!==n?n:{},o=[];return("none"===i.top||!r.showControls||"hidden"===r.regionState.top)&&o.push("msp-layout-hide-top"),"none"!==i.left&&r.showControls&&"hidden"!==r.regionState.left?"collapsed"===r.regionState.left&&o.push("msp-layout-collapse-left"):o.push("msp-layout-hide-left"),("none"===i.right||!r.showControls||"hidden"===r.regionState.right)&&o.push("msp-layout-hide-right"),("none"===i.bottom||!r.showControls||"hidden"===r.regionState.bottom)&&o.push("msp-layout-hide-bottom"),o.join(" ")}get layoutClassName(){const t=this.plugin.layout.state,n=["msp-plugin-content"];return t.isExpanded?n.push("msp-layout-expanded"):n.push("msp-layout-standard",`msp-layout-standard-${t.controlsDisplay}`),n.join(" ")}render(){var t,n,r,i,o,s,a;const l=this.plugin.layout.state,c=(null===(t=this.plugin.spec.components)||void 0===t?void 0:t.controls)||{},u=(null===(r=null===(n=this.plugin.spec.components)||void 0===n?void 0:n.viewport)||void 0===r?void 0:r.view)||aDt,d=(null===(o=null===(i=this.plugin.spec.components)||void 0===i?void 0:i.sequenceViewer)||void 0===o?void 0:o.view)||M3t;return(0,L.jsx)("div",{className:"msp-plugin",children:(0,L.jsxs)("div",{className:this.layoutClassName,onDragEnter:this.onDragEnter,children:[(0,L.jsxs)("div",{className:this.layoutVisibilityClassName,children:[this.region("main",u),l.showControls&&"none"!==c.top&&this.region("top",c.top||d),l.showControls&&"none"!==c.left&&this.region("left",c.left||x3t),l.showControls&&"none"!==c.right&&this.region("right",c.right||sDt),l.showControls&&"none"!==c.bottom&&this.region("bottom",c.bottom||lDt)]}),!(null!==(s=this.plugin.spec.components)&&void 0!==s&&s.hideTaskOverlay)&&(0,L.jsx)(j3t,{}),!(null!==(a=this.plugin.spec.components)&&void 0!==a&&a.disableDragOverlay)&&(0,L.jsx)(oDt,{plugin:this.plugin,showDragOverlay:this.showDragOverlay})]})})}}function oDt({plugin:e,showDragOverlay:t}){const n=cb(t),r=i=>{i.dataTransfer.dropEffect="copy",i.preventDefault(),i.stopPropagation()};return(0,L.jsx)("div",{className:"msp-drag-drop-overlay",style:{display:n?"flex":"none"},onDragEnter:r,onDragOver:r,onDragLeave:()=>t.next(!1),onDrop:i=>function iDt(e,t,n){e.preventDefault(),e.stopPropagation(),n.next(!1);const r=[];if(e.dataTransfer.items)for(let i=0;i<e.dataTransfer.items.length;i++){if("file"!==e.dataTransfer.items[i].kind)continue;const o=e.dataTransfer.items[i].getAsFile();o&&r.push(o)}else for(let i=0;i<e.dataTransfer.files.length;i++){const o=e.dataTransfer.files[i];o&&r.push(o)}t.managers.dragAndDrop.handle(r)}(i,e,t),children:"Load File(s)"})}class sDt extends Vr{render(){var t;const n=(null===(t=this.plugin.spec.components)||void 0===t?void 0:t.structureTools)||d3t;return(0,L.jsx)("div",{className:"msp-scrollable-container",children:(0,L.jsx)(n,{})})}}class aDt extends Vr{render(){var t,n;const r=(null===(n=null===(t=this.plugin.spec.components)||void 0===t?void 0:t.viewport)||void 0===n?void 0:n.controls)||J3t;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(tDt,{}),(0,L.jsxs)("div",{className:"msp-viewport-top-left-controls",children:[(0,L.jsx)(a3t,{}),(0,L.jsx)(r3t,{}),(0,L.jsx)(i3t,{}),(0,L.jsx)(o3t,{})]}),(0,L.jsx)(l3t,{}),(0,L.jsx)(r,{}),(0,L.jsx)(B3t,{}),(0,L.jsxs)("div",{className:"msp-highlight-toast-wrapper",children:[(0,L.jsx)(c3t,{}),(0,L.jsx)(z3t,{})]})]})}}class lDt extends Vr{constructor(){super(...arguments),this.wrapper=Yt.createRef(),this.state={entries:this.plugin.log.entries}}componentDidMount(){this.subscribe(this.plugin.events.log,()=>this.setState({entries:this.plugin.log.entries}))}componentDidUpdate(){this.scrollToBottom()}scrollToBottom(){const t=this.wrapper.current;t&&(t.scrollTop=t.scrollHeight-t.clientHeight-1)}render(){const n=this.state.entries,r=n.size,i=[];for(let o=Math.max(0,r-10),s=0;o<r;o++){const a=n.get(o);i.push((0,L.jsxs)("li",{children:[(0,L.jsx)("div",{className:"msp-log-entry-badge msp-log-entry-"+a.type}),(0,L.jsx)("div",{className:"msp-log-timestamp",children:xFe(a.timestamp)}),(0,L.jsx)("div",{className:"msp-log-entry",children:a.message})]},s++))}return(0,L.jsx)("div",{ref:this.wrapper,className:"msp-log",style:{position:"absolute",top:"0",right:"0",bottom:"0",left:"0",overflowY:"auto"},children:(0,L.jsx)("ul",{className:"msp-list-unstyled",children:i})})}}var cDt=ln(46);let KX=(()=>{class e{set container(n){this.initialize$.next(n)}constructor(n,r){this.settingsService=n,this.pluginService=r,this.initialize$=new Fh(1);const i=this.pluginService.plugin$,o=this.settingsService.settings$;this.initialized$=this.initialize$.pipe(hn(s=>{const a=s.nativeElement;return{div:a,canvas:a.firstElementChild}}),z0(i),hn(([{div:s},a])=>((0,cDt.render)((0,Yt.createElement)(nDt,{plugin:a}),s),a)),ff(1),z0(o),hn(([s,a])=>{if(s.canvas3d){const[l,c]=gP(a["background-color"]);s.canvas3d.setProps({renderer:{backgroundColor:l,pickingAlphaThreshold:c}})}return s}))}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(cB),Rn(bI))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function ZX(e,t){return function uDt(e,t){const n=pa.getStructureSelection(e,t);return Dt.toLociWithSourceUnits(n)}(pe.struct.generator.atomGroups({"residue-test":pe.core.set.has([pe.set(...e),pe.core.str.concat([pe.ammp("auth_asym_id"),pe.ammp("auth_seq_id"),pe.ammp("pdbx_PDB_ins_code")])])}),t)}let j2e=(()=>{class e{set loci(n){this.loci$.next(n)}set interactions(n){this.interactions$.next(n)}constructor(n,r,i,o){var s=this;this.structureService=n,this.settingsService=r,this.pluginService=i,this.canvasService=o,this.loci$=new Fh(1),this.interactions$=new Fh(1);const a=this.structureService.source$.pipe(xd(u=>null!=u));this.structure$=this.structureService.structure$.pipe(function cFe(...e){const t=Bj(e);return is((n,r)=>{const i=e.length,o=new Array(i);let s=e.map(()=>!1),a=!1;for(let l=0;l<i;l++)vd(e[l]).subscribe(Xo(r,c=>{o[l]=c,!a&&!s[l]&&(s[l]=!0,(a=s.every(ah))&&(s=null))},kv));n.subscribe(Xo(r,l=>{if(a){const c=[l,...o];r.next(t?t(...c):c)}}))})}(a),ba(([u,d])=>Is(le(function*(){const f=s.pluginService.plugin,p=yield f.builders.structure.tryCreateComponentStatic(u,"polymer",{label:d.label}),[m]=gP(s.settingsService.settings["backbone-color"]);return yield f.builders.structure.representation.addRepresentation(p,{type:"cartoon",color:"uniform",colorParams:{value:m}}),u.cell.obj.data})())),ff(1));const l=this.getLociRepresentation(),c=this.getInteractionsRepresentation();this.representation$=this.structure$.pipe(z0(this.canvasService.initialized$),z0(l),z0(c),hn(()=>{}),ff(1)),this._representation=this.representation$.subscribe()}ngOnDestroy(){this._representation.unsubscribe()}getLociRepresentation(){return this.structure$.pipe(z0(this.loci$),hn(([n,r])=>({structure:n,loci:r})),hn(({structure:n,loci:r})=>{const i=[...this.structureService.i2r.values()];return{structure:n,loci:r.map(s=>{if(s.start){s={...s,end:s.end||s.start};const a=this.structureService.r2i.get(s.chain+s.start),l=this.structureService.r2i.get(s.chain+s.end);return{...s,ids:i.slice(a,l+1)}}return{...s,ids:i.filter(a=>a.startsWith(s.chain))}})}}),ba(({structure:n,loci:r})=>{const i=[];for(const{ids:l,color:c}of r){const u=ZX(l,n),d=Qr.fromLoci(u),[f]=gP(c||this.settingsService.settings["backbone-color"]);i.push({bundle:d,color:f,clear:!1})}const o=this.pluginService.plugin,s=o.state.data.build(),a=function dDt(e,t){const n=Ea.ofBundle(e,t.root),r=Ea.merge(n);return Ea.filter(r,t)}(i,n);for(const l of o.managers.structure.hierarchy.current.structures)for(const c of l.components)for(const u of c.representations){s.to(u.cell.transform.ref).apply(at.Representation.OverpaintStructureRepresentation3DFromBundle,Ea.toBundle(a));const d=ZX([...this.structureService.i2r.values()],n),f=Qr.fromLoci(d),[p,m]=gP(this.settingsService.settings["backbone-color"]);s.to(u.cell.transform.ref).apply(at.Representation.TransparencyStructureRepresentation3DFromBundle,{layers:[{bundle:f,value:m}]})}return Is(s.commit({doNotUpdateCurrent:!0}))}))}getInteractionsRepresentation(){let n;return this.structure$.pipe(z0(this.interactions$),hn(([r,i])=>({structure:r,interactions:i})),hn(({structure:r,interactions:i})=>{const o=i.reduce((s,{from:a,to:l})=>[...s,a,l],[]);return Xe.eachAtomicHierarchyElement(r,{atom:s=>{const a=C.create(Je.atom.x(s),Je.atom.y(s),Je.atom.z(s));for(const l of o)l.coordinates||(l["atom.id"]===Je.atom.id(s)||l["chain.id"]===Je.chain.auth_asym_id(s)&&l["residue.id"]===Je.residue.auth_seq_id(s)+Je.residue.pdbx_PDB_ins_code(s)&&l["atom.name"]===Je.atom.auth_atom_id(s))&&(l.coordinates=a)}}),{structure:r,interactions:i=i.filter(({from:s,to:a})=>s.coordinates&&a.coordinates)}}),ba(({interactions:r})=>{const o=this.pluginService.plugin.state.data.build(),s=r.map(({from:l,to:c,color:u,label:d,size:f})=>({from:l.coordinates,to:c.coordinates,color:gP(u||this.settingsService.settings["interaction-color"]).at(0),size:f||this.settingsService.settings["interaction-size"],label:d}));return n&&o.delete(n),n=o.toRoot().apply(Bat,{data:s}).apply(at.Representation.ShapeRepresentation3D).ref,Is(o.commit({doNotUpdateCurrent:!0}))}),ff(1))}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(vI),Rn(cB),Rn(bI),Rn(KX))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();let U2e=(()=>{class e{set highlights(n){this.input$.next(n)}constructor(n,r){this.structureService=n,this.pluginService=r,this.input$=new Fh(1);const i=this.pluginService.plugin,o=i.behaviors.interaction.hover,s=this.structureService.structure$.pipe(z0(this.input$),hn(([l,c])=>({structure:l,highlights:c})),hn(({structure:l,highlights:c})=>{if(c){const u=[...this.structureService.i2r.values()],d=this.structureService.r2i.get(c.chain+c.start),f=this.structureService.r2i.get(c.chain+c.end);return{structure:l,highlights:{...c,ids:u.slice(d,f+1)}}}return{structure:l,highlights:{start:"",end:"",chain:"",ids:[]}}}),hn(({structure:l,highlights:c})=>{if(c.ids.length>0){const u=ZX(c.ids,l);i.managers.interactivity.lociHighlights.highlightOnly({loci:u})}}));this.output$=o.pipe(hn(l=>{if(l&&"element-loci"===l.current.loci.kind&&Me.is(l.current.loci)){const c=Me.getFirstLocation(l.current.loci);if(c){const u=Je.chain.auth_asym_id(c),p=Je.residue.auth_seq_id(c)+Je.residue.pdbx_PDB_ins_code(c);return{start:p,end:p+"",chain:u}}}}),ff(1));const a=s.pipe(function pDt(...e){return function fDt(...e){const t=$C(e),n=Wre(e,1/0);return e=Qie(e),is((r,i)=>{Ux(n)(Is([r,...e],t)).subscribe(i)})}(...e)}(this.output$),hn(()=>{}));this._highlights=a.subscribe()}ngOnDestroy(){this._highlights.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(vI),Rn(bI))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const hDt=["container"];let mDt=(()=>{class e{set container(n){this.canvasService.container=n}set source(n){this.structureService.source=n}set loci(n){this.representationService.loci=n}set interactions(n){this.representationService.interactions=n}set settings(n){this.settingsService.settings=n}set highlights(n){this.highlightService.highlights=n}constructor(n,r,i,o,s,a){this.representationService=n,this.highlightService=r,this.structureService=i,this.settingsService=o,this.pluginService=s,this.canvasService=a,this.highlights$=this.highlightService.output$}static#e=this.\u0275fac=function(r){return new(r||e)(On(j2e),On(U2e),On(vI),On(cB),On(bI),On(KX))};static#t=this.\u0275cmp=$d({type:e,selectors:[["ngx-structure-viewer"]],viewQuery:function(r,i){if(1&r&&F8(hDt,5),2&r){let o;MT(o=RT())&&(i.container=o.first)}},inputs:{source:"source",loci:"loci",interactions:"interactions",settings:"settings",highlights:"highlights"},outputs:{highlights$:"highlights"},standalone:!0,features:[NT([j2e,U2e,vI,cB,bI,KX]),Dh],decls:4,vars:0,consts:[["container",""],["canvas",""],[1,"ngx-structure-viewer-container"],[1,"ngx-structure-viewer-canvas"]],template:function(r,i){1&r&&(br(0,"div",2,0),js(2,"canvas",3,1),Sr())},dependencies:[L0],styles:[".msp-plugin{font-family:Helvetica Neue,Segoe UI,Helvetica,Source Sans Pro,Arial,sans-serif;font-size:14px;line-height:1.42857143;position:absolute;inset:0;background:#111318}.msp-plugin *{box-sizing:border-box}.msp-plugin [hidden],.msp-plugin template{display:none}.msp-plugin a{background-color:transparent}.msp-plugin a:active,.msp-plugin a:hover{outline:0}.msp-plugin abbr[title]{border-bottom:1px dotted}.msp-plugin b,.msp-plugin strong{font-weight:700}.msp-plugin small{font-size:80%}.msp-plugin img{border:0}.msp-plugin svg:not(:root){overflow:hidden}.msp-plugin button,.msp-plugin input,.msp-plugin optgroup,.msp-plugin select,.msp-plugin textarea{color:inherit;font:inherit;margin:0}.msp-plugin button{overflow:visible}.msp-plugin button,.msp-plugin select{text-transform:none}.msp-plugin button,.msp-plugin html input[type=button],.msp-plugin input[type=reset],.msp-plugin input[type=submit]{-webkit-appearance:button;cursor:pointer}.msp-plugin button[disabled],.msp-plugin html input[disabled]{cursor:default}.msp-plugin button::-moz-focus-inner,.msp-plugin input::-moz-focus-inner{border:0;padding:0}.msp-plugin input{line-height:normal}.msp-plugin input[type=checkbox],.msp-plugin input[type=radio]{box-sizing:border-box;padding:0}.msp-plugin input[type=number]::-webkit-inner-spin-button,.msp-plugin input[type=number]::-webkit-outer-spin-button{height:auto}.msp-plugin textarea{overflow:auto}.msp-plugin .msp-layout-expanded,.msp-plugin .msp-layout-standard{inset:0}.msp-plugin .msp-layout-standard{border:1px solid #313645}.msp-plugin .msp-layout-region{overflow:hidden}.msp-plugin .msp-layout-static,.msp-plugin .msp-layout-scrollable{position:absolute}.msp-plugin .msp-scrollable{overflow-y:auto}.msp-plugin .msp-scrollable-container{position:absolute;inset:0;overflow-y:auto}.msp-plugin .msp-layout-static{overflow:hidden}.msp-plugin .msp-layout-top .msp-layout-static,.msp-plugin .msp-layout-main .msp-layout-static,.msp-plugin .msp-layout-bottom .msp-layout-static,.msp-plugin .msp-layout-right .msp-layout-static{inset:0}.msp-plugin .msp-layout-right .msp-layout-scrollable{inset:43px 0 0}.msp-plugin .msp-layout-left .msp-layout-static{inset:0}.msp-plugin .msp-layout-standard-outside{position:absolute}.msp-plugin .msp-layout-standard-outside .msp-layout-main{position:absolute;inset:0}.msp-plugin .msp-layout-standard-outside .msp-layout-top{position:absolute;right:0;height:97px;top:-97px;width:50%;border-left:1px solid #313645;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-outside .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;top:-97px;width:50%;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-outside .msp-layout-right{position:absolute;width:50%;right:0;bottom:-295px;height:295px;border-left:1px solid #313645;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-outside .msp-layout-left{position:absolute;width:50%;left:0;bottom:-295px;height:295px;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-standard-outside .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-outside .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-outside .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-standard-landscape{position:absolute}.msp-plugin .msp-layout-standard-landscape .msp-layout-main{position:absolute;inset:100px 300px 70px 330px}.msp-plugin .msp-layout-standard-landscape .msp-layout-top{position:absolute;left:330px;right:300px;height:100px;top:0;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-landscape .msp-layout-bottom{position:absolute;left:330px;right:300px;height:70px;bottom:0;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-landscape .msp-layout-right{position:absolute;width:300px;right:0;bottom:0;top:0;border-left:1px solid #313645}.msp-plugin .msp-layout-standard-landscape .msp-layout-left{position:absolute;width:330px;left:0;bottom:0;top:0;border-right:1px solid #313645}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-main,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-top,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-right .msp-layout-bottom{right:0}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-main,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-top,.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-left .msp-layout-bottom{left:0}.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-main,.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-top,.msp-plugin .msp-layout-standard-landscape .msp-layout-collapse-left .msp-layout-bottom{left:32px}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-bottom .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-landscape .msp-layout-hide-top .msp-layout-main{top:0}.msp-plugin .msp-layout-standard-portrait{position:absolute}.msp-plugin .msp-layout-standard-portrait .msp-layout-main{position:absolute;inset:97px 0 361px}.msp-plugin .msp-layout-standard-portrait .msp-layout-top{position:absolute;right:0;height:97px;top:0;width:50%;border-left:1px solid #313645;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-portrait .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;width:50%;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-portrait .msp-layout-right{position:absolute;width:50%;right:0;bottom:0;height:361px;border-left:1px solid #313645;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-portrait .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;height:361px;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-right.msp-layout-hide-left .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-portrait .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-portrait .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-standard-portrait .msp-layout-hide-top.msp-layout-hide-bottom .msp-layout-main{top:0}.msp-plugin .msp-layout-standard-reactive{position:absolute}@media (orientation: landscape),(min-width: 1000px){.msp-plugin .msp-layout-standard-reactive .msp-layout-main{position:absolute;inset:100px 300px 70px 330px}.msp-plugin .msp-layout-standard-reactive .msp-layout-top{position:absolute;left:330px;right:300px;height:100px;top:0;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-bottom{position:absolute;left:330px;right:300px;height:70px;bottom:0;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-right{position:absolute;width:300px;right:0;bottom:0;top:0;border-left:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-left{position:absolute;width:330px;left:0;bottom:0;top:0;border-right:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-main,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-top,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-bottom{right:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-main,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-top,.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-bottom{left:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-main,.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-top,.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-bottom{left:32px}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-main{top:0}}@media (orientation: portrait) and (max-width: 1000px){.msp-plugin .msp-layout-standard-reactive .msp-layout-main{position:absolute;inset:97px 0 361px}.msp-plugin .msp-layout-standard-reactive .msp-layout-top{position:absolute;right:0;height:97px;top:0;width:50%;border-left:1px solid #313645;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;width:50%;border-bottom:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-right{position:absolute;width:50%;right:0;bottom:0;height:361px;border-left:1px solid #313645;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;height:361px;border-top:1px solid #313645}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-right.msp-layout-hide-left .msp-layout-main{bottom:0}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-standard-reactive .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-standard-reactive .msp-layout-hide-top.msp-layout-hide-bottom .msp-layout-main{top:0}}.msp-plugin .msp-layout-expanded{position:fixed}@media (orientation: landscape){.msp-plugin .msp-layout-expanded .msp-layout-main{position:absolute;inset:100px 300px 70px 330px}.msp-plugin .msp-layout-expanded .msp-layout-top{position:absolute;left:330px;right:300px;height:100px;top:0;border-bottom:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-bottom{position:absolute;left:330px;right:300px;height:70px;bottom:0;border-top:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-right{position:absolute;width:300px;right:0;bottom:0;top:0;border-left:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-left{position:absolute;width:330px;left:0;bottom:0;top:0;border-right:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-main,.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-top,.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-bottom{right:0}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-main,.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-top,.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-bottom{left:0}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-main,.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-top,.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-bottom{left:32px}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-main{bottom:0}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-main{top:0}}@media (orientation: portrait){.msp-plugin .msp-layout-expanded .msp-layout-main{position:absolute;inset:97px 0 361px}.msp-plugin .msp-layout-expanded .msp-layout-top{position:absolute;right:0;height:97px;top:0;width:50%;border-left:1px solid #313645;border-bottom:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-bottom{position:absolute;left:0;right:0;height:97px;width:50%;border-bottom:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-right{position:absolute;width:50%;right:0;bottom:0;height:361px;border-left:1px solid #313645;border-top:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-left{position:absolute;width:50%;left:0;bottom:0;height:361px;border-top:1px solid #313645}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-right{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-right .msp-layout-left{width:100%}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-left{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-left .msp-layout-right{width:100%;border-left:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-right.msp-layout-hide-left .msp-layout-main{bottom:0}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-left{width:32px}.msp-plugin .msp-layout-expanded .msp-layout-collapse-left .msp-layout-right{left:32px;width:auto}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-top{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-top .msp-layout-bottom{width:100%;border-left:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-bottom{display:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-bottom .msp-layout-top{width:100%;border-left:none}.msp-plugin .msp-layout-expanded .msp-layout-hide-top.msp-layout-hide-bottom .msp-layout-main{top:0}}.msp-plugin ::-webkit-scrollbar{width:10px;height:10px}.msp-plugin ::-webkit-scrollbar-track{border-radius:0;background-color:#16191f}.msp-plugin ::-webkit-scrollbar-thumb{border-radius:0;background-color:#0e0f14}.msp-plugin .msp-form-control,.msp-plugin .msp-control-row select,.msp-plugin .msp-control-row button,.msp-plugin .msp-control-row input[type=text],.msp-plugin .msp-btn{display:block;width:100%;background:#0c0d11;border:none;padding:0 10px;line-height:30px;height:32px;appearance:none;box-shadow:none;background-image:none}.msp-plugin .msp-form-control::-moz-placeholder,.msp-plugin .msp-control-row select::-moz-placeholder,.msp-plugin .msp-control-row button::-moz-placeholder,.msp-plugin .msp-control-row input[type=text]::-moz-placeholder,.msp-plugin .msp-btn::-moz-placeholder{color:#637ca0;opacity:1}.msp-plugin .msp-form-control:-ms-input-placeholder,.msp-plugin .msp-control-row select:-ms-input-placeholder,.msp-plugin .msp-control-row button:-ms-input-placeholder,.msp-plugin .msp-control-row input[type=text]:-ms-input-placeholder,.msp-plugin .msp-btn:-ms-input-placeholder{color:#637ca0}.msp-plugin .msp-form-control::-webkit-input-placeholder,.msp-plugin .msp-control-row select::-webkit-input-placeholder,.msp-plugin .msp-control-row button::-webkit-input-placeholder,.msp-plugin .msp-control-row input[type=text]::-webkit-input-placeholder,.msp-plugin .msp-btn::-webkit-input-placeholder{color:#637ca0}.msp-plugin .msp-form-control:hover,.msp-plugin .msp-control-row select:hover,.msp-plugin .msp-control-row button:hover,.msp-plugin .msp-control-row input[type=text]:hover,.msp-plugin .msp-btn:hover{color:#51a2fb;background-color:#16191f;border:none;outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-form-control:active,.msp-plugin .msp-control-row select:active,.msp-plugin .msp-control-row button:active,.msp-plugin .msp-control-row input[type=text]:active,.msp-plugin .msp-btn:active,.msp-plugin .msp-form-control:focus,.msp-plugin .msp-control-row select:focus,.msp-plugin .msp-control-row button:focus,.msp-plugin .msp-control-row input[type=text]:focus,.msp-plugin .msp-btn:focus{color:#ccd4e0;background-color:#0c0d11;border:none;outline-offset:0;outline:none}.msp-plugin .msp-form-control[disabled],.msp-plugin .msp-control-row select[disabled],.msp-plugin .msp-control-row button[disabled],.msp-plugin .msp-control-row input[disabled][type=text],.msp-plugin [disabled].msp-btn,.msp-plugin .msp-form-control[readonly],.msp-plugin .msp-control-row select[readonly],.msp-plugin .msp-control-row button[readonly],.msp-plugin .msp-control-row input[readonly][type=text],.msp-plugin [readonly].msp-btn,fieldset[disabled] .msp-plugin .msp-form-control,fieldset[disabled] .msp-plugin .msp-control-row select,fieldset[disabled] .msp-plugin .msp-control-row button,fieldset[disabled] .msp-plugin .msp-control-row input[type=text],fieldset[disabled] .msp-plugin .msp-btn{background:#111318;opacity:.35}.msp-plugin .msp-btn,.msp-plugin .msp-control-row button{display:inline-block;margin-bottom:0;text-align:center;touch-action:manipulation;cursor:pointer;background-image:none;white-space:nowrap;-webkit-user-select:none;user-select:none;padding:0 10px;line-height:32px;border:none;box-sizing:border-box}.msp-plugin .msp-btn[disabled],.msp-plugin .msp-control-row button[disabled]{background:#111318;opacity:.35}.msp-plugin .msp-btn-block,.msp-plugin .msp-control-row button{display:block;width:100%}.msp-plugin .msp-btn,.msp-plugin .msp-control-row button,.msp-plugin .msp-btn:active,.msp-plugin .msp-btn-link:focus,.msp-plugin .msp-btn:hover{outline:none}.msp-plugin .msp-material-icon svg{display:inline-flex;vertical-align:middle;font-size:1.2em;margin-bottom:3px;fill:currentColor;width:1em;height:1em;flex-shrink:0;-webkit-user-select:none;user-select:none}.msp-plugin .msp-btn-block>.msp-material-icon,.msp-plugin .msp-control-row button>.msp-material-icon{margin-left:0;margin-right:.4em}.msp-plugin .msp-btn-childless>.msp-material-icon{margin-left:0;margin-right:0}.msp-plugin .msp-btn-icon{border:none;height:32px;width:32px;line-height:32px;padding:0;text-align:center}.msp-plugin .msp-btn-icon:hover{color:#51a2fb;background-color:#16191f;border:none;outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-btn-icon[disabled],.msp-plugin .msp-btn-icon[disabled]:hover,.msp-plugin .msp-btn-icon[disabled]:active{color:#637ca0}.msp-plugin .msp-btn-icon-small{border:none;height:32px;width:20px;line-height:32px;padding:0;text-align:center}.msp-plugin .msp-btn-icon-small:hover{color:#51a2fb;background-color:#16191f;border:none;outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-btn-icon-small[disabled],.msp-plugin .msp-btn-icon-small[disabled]:hover,.msp-plugin .msp-btn-icon-small[disabled]:active{color:#637ca0}.msp-plugin .msp-btn-link{font-weight:400;border-radius:0}.msp-plugin .msp-btn-link,.msp-plugin .msp-btn-link:active,.msp-plugin .msp-btn-link.active,.msp-plugin .msp-btn-link[disabled],fieldset[disabled] .msp-plugin .msp-btn-link{background-color:transparent;box-shadow:none}.msp-plugin .msp-btn-link,.msp-plugin .msp-btn-link:hover,.msp-plugin .msp-btn-link:focus,.msp-plugin .msp-btn-link:active{border-color:transparent}.msp-plugin .msp-btn-link:hover,.msp-plugin .msp-btn-link:focus{text-decoration:none;background-color:transparent}.msp-plugin .msp-btn-link[disabled]:hover,.msp-plugin .msp-btn-link[disabled]:focus,fieldset[disabled] .msp-plugin .msp-btn-link:hover,fieldset[disabled] .msp-plugin .msp-btn-link:focus{text-decoration:none}.msp-plugin .msp-btn-link .msp-icon{font-size:100%}.msp-plugin .msp-btn-link,.msp-plugin .msp-btn-link:active,.msp-plugin .msp-btn-link:focus{color:#ccd4e0;text-decoration:none}.msp-plugin .msp-btn-link:hover{color:#51a2fb;text-decoration:none}.msp-plugin .msp-btn-link-toggle-on{color:#ccd4e0}.msp-plugin .msp-btn-link-toggle-off,.msp-plugin .msp-btn-link-toggle-off:active,.msp-plugin .msp-btn-link-toggle-off:focus{color:#637ca0!important}.msp-plugin .msp-btn-link-toggle-off:hover,.msp-plugin .msp-btn-link-toggle-on:hover{color:#51a2fb!important}.msp-plugin .msp-btn-action,.msp-plugin .msp-btn-action:active,.msp-plugin .msp-btn-action:focus{color:#ccd4e0;background:#0c0d11}.msp-plugin .msp-btn-action:hover{color:#51a2fb;background:#060709}.msp-plugin .msp-btn-action[disabled],.msp-plugin .msp-btn-action[disabled]:hover,.msp-plugin .msp-btn-action[disabled]:active,.msp-plugin .msp-btn-action[disabled]:focus{color:#c9d1de}.msp-plugin .msp-btn-commit-on,.msp-plugin .msp-btn-commit-on:active,.msp-plugin .msp-btn-commit-on:focus{color:#68befd;background:#0d0e12}.msp-plugin .msp-btn-commit-on:hover{color:#51a2fb;background:#07080b}.msp-plugin .msp-btn-commit-on[disabled],.msp-plugin .msp-btn-commit-on[disabled]:hover,.msp-plugin .msp-btn-commit-on[disabled]:active,.msp-plugin .msp-btn-commit-on[disabled]:focus{color:#63bcfd}.msp-plugin .msp-btn-commit-off,.msp-plugin .msp-btn-commit-off:active,.msp-plugin .msp-btn-commit-off:focus{color:#ccd4e0;background:#090a0c}.msp-plugin .msp-btn-commit-off:hover{color:#51a2fb;background:#030405}.msp-plugin .msp-btn-commit-off[disabled],.msp-plugin .msp-btn-commit-off[disabled]:hover,.msp-plugin .msp-btn-commit-off[disabled]:active,.msp-plugin .msp-btn-commit-off[disabled]:focus{color:#c9d1de}.msp-plugin .msp-btn-remove:hover{color:#f2f4f7}.msp-plugin .msp-btn-commit-on:hover{color:#0393fc}.msp-plugin .msp-btn-action{height:32px;line-height:32px}.msp-plugin input[type=file]{display:block}.msp-plugin input[type=range]{display:block;width:100%}.msp-plugin select[multiple],.msp-plugin select[size],.msp-plugin textarea.msp-form-control,.msp-plugin textarea.msp-btn{height:auto}.msp-plugin .msp-control-top-offset{margin-top:1px}.msp-plugin .msp-btn-commit{text-align:right;padding:0 10px 0 0;line-height:32px;border:none;overflow:hidden;font-weight:700}.msp-plugin .msp-btn-commit .msp-icon{display:block-inline;line-height:32px;width:32px;text-align:center}.msp-plugin select.msp-form-control,.msp-plugin .msp-control-row select,.msp-plugin select.msp-btn{background:none;background-color:#0c0d11;background-size:8px 12px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAUCAMAAACzvE1FAAAADFBMVEUzMzMzMzMzMzMzMzMKAG/3AAAAA3RSTlMAf4C/aSLHAAAAPElEQVR42q3NMQ4AIAgEQTn//2cLdRKppSGzBYwzVXvznNWs8C58CiussPJj8h6NwgorrKRdTvuV9v16Afn0AYFOB7aYAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-position:right 10px center;padding-right:24px}.msp-plugin select.msp-form-control:-moz-focusring,.msp-plugin .msp-control-row select:-moz-focusring,.msp-plugin select.msp-btn:-moz-focusring{color:transparent;text-shadow:0 0 0 #ccd4e0}.msp-plugin .msp-default-bg{background:#111318}.msp-plugin .msp-transparent-bg{background:transparent}.msp-plugin .msp-no-hover-outline:hover{color:#51a2fb;background-color:inherit;border:none;outline-offset:0!important;outline:none!important}.msp-plugin .msp-icon-inline{margin-right:8px}.msp-plugin .msp-control-row{position:relative;height:32px;background:#111318;margin-top:1px}.msp-plugin .msp-control-row>span.msp-control-row-label,.msp-plugin .msp-control-row>button.msp-control-button-label{line-height:32px;display:block;width:120px;text-align:right;padding:0 10px;color:#9cacc3;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;position:relative;-webkit-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-control-row>button.msp-control-button-label{background:#111318;cursor:pointer}.msp-plugin .msp-control-row .msp-control-current{background:#111318}.msp-plugin .msp-control-row>div.msp-control-row-ctrl{position:absolute;inset:0 0 0 120px}.msp-plugin .msp-control-row>div{background:#0c0d11}.msp-plugin .msp-control-row>.msp-flex-row,.msp-plugin .msp-control-row>.msp-state-image-row{background:#111318}.msp-plugin .msp-control-label-short>span{width:80px!important}.msp-plugin .msp-control-label-short>div:nth-child(2){left:80px!important}.msp-plugin .msp-control-col-2{float:left;width:50%}.msp-plugin .msp-control-twoline{height:64px!important}.msp-plugin .msp-control-group{position:relative}.msp-plugin .msp-toggle-button .msp-icon{display:inline-block;margin-right:6px}.msp-plugin .msp-toggle-button>div>button:hover{border-color:#16191f!important;border:none;outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-slider>div:first-child{position:absolute;inset:0 62px 0 18px;display:flex}.msp-plugin .msp-slider>div:last-child{position:absolute;height:32px;line-height:32px;text-align:center;right:0;width:50px;top:0;bottom:0}.msp-plugin .msp-slider input[type=text]{padding-right:6px;padding-left:4px;font-size:80%;text-align:right}.msp-plugin .msp-slider2>div:first-child{position:absolute;height:32px;line-height:32px;text-align:center;left:0;width:25px;top:0;bottom:0;font-size:80%}.msp-plugin .msp-slider2>div:nth-child(2){position:absolute;inset:0 37px 0 35px;display:flex}.msp-plugin .msp-slider2>div:last-child{position:absolute;height:32px;line-height:32px;text-align:center;right:0;width:25px;top:0;bottom:0;font-size:80%}.msp-plugin .msp-slider2 input[type=text]{padding-right:4px;padding-left:4px;font-size:80%;text-align:center}.msp-plugin .msp-toggle-color-picker button{border:10px solid #0c0d11!important;margin:0;text-align:center;padding-right:10px;padding-left:10px}.msp-plugin .msp-toggle-color-picker button:hover{border-color:#16191f!important;border:none;outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-toggle-color-picker .msp-color-picker{position:absolute;z-index:100000;background:#111318;border-top:1px solid #111318;padding-bottom:5px;width:100%}.msp-plugin .msp-toggle-color-picker-above .msp-color-picker{top:-85px;height:85px}.msp-plugin .msp-toggle-color-picker-below .msp-color-picker{top:32px;height:80px}.msp-plugin .msp-control-offset{padding-left:10px}.msp-plugin .msp-accent-offset{padding-left:1px;margin-left:8px;border-left:2px solid #d67118}.msp-plugin .msp-control-group-wrapper{margin-bottom:0;margin-top:1px}.msp-plugin .msp-control-group-header{background:#111318}.msp-plugin .msp-control-group-header>button,.msp-plugin .msp-control-group-header div{padding-left:4px;text-align:left;height:24px!important;line-height:24px!important;font-size:85%!important;background:#111318!important;color:#9cacc3}.msp-plugin .msp-control-group-header .msp-icon{height:24px!important;line-height:24px!important}.msp-plugin .msp-control-group-header>span{padding-left:5px;line-height:21.3333333333px;font-size:70%;background:#111318;color:#9cacc3}.msp-plugin .msp-control-current{background:#111318}.msp-plugin .msp-control-group-footer{background:#1c1f27;height:5px;font-size:1px;margin-top:1px}.msp-plugin .msp-control-group-expander{display:block;position:absolute;line-height:32px;padding:0;left:0;top:0;width:120px;text-align:left;background:transparent}.msp-plugin .msp-control-group-expander .msp-icon{line-height:29px;width:31px;text-align:center;font-size:100%}.msp-plugin .msp-plugin-layout_controls{position:absolute;left:10px;top:10px}.msp-plugin .msp-plugin-layout_controls>button:first-child{margin-right:6px}.msp-plugin .msp-empty-control{display:none}.msp-plugin .msp-control .msp-btn-block,.msp-plugin .msp-control .msp-control-row button,.msp-plugin .msp-control-row .msp-control button{margin-bottom:0;margin-top:0}.msp-plugin .msp-row-text{height:32px;position:relative;background:#111318;margin-top:1px}.msp-plugin .msp-row-text>div{line-height:32px;text-align:center;color:#9cacc3}.msp-plugin .msp-help span{display:none}.msp-plugin .msp-help:hover span{display:inline-block;background:linear-gradient(#111318,#111318cc)}.msp-plugin .msp-help-text{position:relative;background:#111318;margin-top:1px}.msp-plugin .msp-help-text>div{padding:5px 10px;text-align:left;color:#9cacc3}.msp-plugin .msp-help-description{font-style:italic}.msp-plugin .msp-help-legend{padding-top:10px}.msp-plugin .msp-scale-legend>div{width:100%;height:30px}.msp-plugin .msp-scale-legend>div>span{padding:5px;color:#fff;font-weight:700;background-color:#0003}.msp-plugin .msp-table-legend>div{margin-right:5px;display:inline-flex}.msp-plugin .msp-table-legend>div .msp-table-legend-color{width:30px;height:20px}.msp-plugin .msp-table-legend>div .msp-table-legend-text{margin:0 5px}.msp-plugin .msp-image-preview{position:relative;background:#111318;margin-top:1px;padding:10px}.msp-plugin .msp-image-preview canvas{-webkit-user-select:none;user-select:none}.msp-plugin .msp-image-preview>span{margin-top:6px;display:block;text-align:center;font-size:80%;line-height:15px}.msp-plugin .msp-copy-image-wrapper{position:relative}.msp-plugin .msp-copy-image-wrapper div{font-weight:700;padding:3px;margin:1px 0;width:100%;background:#0c0d11;text-align:center}.msp-plugin .msp-copy-image-wrapper img{margin-top:1px}.msp-plugin .msp-control-text-area-wrapper,.msp-plugin .msp-text-area-wrapper{position:relative}.msp-plugin .msp-control-text-area-wrapper textarea,.msp-plugin .msp-text-area-wrapper textarea{border:none;width:100%;height:100%;background:#0c0d11;padding:5px 10px;resize:none;font-size:12px;line-height:16px}.msp-plugin .msp-control-text-area-wrapper{height:64px!important}.msp-plugin .msp-text-area-wrapper{height:96px!important}.msp-plugin .msp-slider-base{position:relative;height:14px;padding:5px 0;width:100%;border-radius:6px;align-self:center;box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.msp-plugin .msp-slider-base *{box-sizing:border-box;-webkit-tap-highlight-color:rgba(0,0,0,0)}.msp-plugin .msp-slider-base-rail{position:absolute;width:100%;background-color:#1f222b;height:4px;border-radius:2px}.msp-plugin .msp-slider-base-track{position:absolute;left:0;height:4px;border-radius:6px;background-color:tint(#ccd4e0,60%)}.msp-plugin .msp-slider-base-handle{position:absolute;margin-left:-11px;margin-top:-9px;width:22px;height:22px;cursor:pointer;border-radius:50%;background-color:#ccd4e0;border:4px solid #1f222b}.msp-plugin .msp-slider-base-handle:hover{background-color:#51a2fb}.msp-plugin .msp-slider-base-mark{position:absolute;top:18px;left:0;width:100%;font-size:12px}.msp-plugin .msp-slider-base-mark-text{position:absolute;display:inline-block;vertical-align:middle;text-align:center;cursor:pointer;color:#999}.msp-plugin .msp-slider-base-mark-text-active{color:#666}.msp-plugin .msp-slider-base-step{position:absolute;width:100%;height:4px;background:transparent}.msp-plugin .msp-slider-base-dot{position:absolute;bottom:-2px;margin-left:-4px;width:8px;height:8px;border:2px solid #e9e9e9;background-color:#fff;cursor:pointer;border-radius:50%;vertical-align:middle}.msp-plugin .msp-slider-base-dot:first-child{margin-left:-4px}.msp-plugin .msp-slider-base-dot:last-child{margin-left:-4px}.msp-plugin .msp-slider-base-dot-active{border-color:tint(#ccd4e0,50%)}.msp-plugin .msp-slider-base-disabled{background:#111318;opacity:.35}.msp-plugin .msp-slider-base-disabled .msp-slider-base-handle,.msp-plugin .msp-slider-base-disabled .msp-slider-base-dot{cursor:not-allowed}.msp-plugin .msp-slider-base-disabled .msp-slider-base-mark-text,.msp-plugin .msp-slider-base-disabled .msp-slider-base-dot{cursor:not-allowed!important}.msp-plugin .msp-description{padding:10px;font-size:85%;background:#111318;text-align:center;-webkit-user-select:none;-o-user-select:none;user-select:none;font-weight:light;cursor:default}.msp-plugin .msp-description:not(:first-child){border-top:1px solid #1f222b}.msp-plugin .msp-color-picker input{color:#000!important}.msp-plugin .msp-no-webgl{position:absolute;width:100%;height:100%;left:0;top:0;display:table;text-align:center;background:#111318}.msp-plugin .msp-no-webgl>div{display:table-cell;vertical-align:middle;text-align:center;width:100%;height:100%}.msp-plugin .msp-no-webgl>div b{font-size:120%}.msp-plugin .msp-loader-msp-btn-file{position:relative;overflow:hidden}.msp-plugin .msp-loader-msp-btn-file input[type=file]{position:absolute;top:0;right:0;min-width:100%;min-height:100%;font-size:100px;text-align:right;filter:alpha(opacity=0);opacity:0;outline:none;background:#fff;cursor:inherit;display:block}.msp-plugin .msp-controls-section{margin-bottom:10px}.msp-plugin .msp-combined-color-button{border:4px solid #0c0d11!important;margin:0;text-align:center;padding-right:10px;padding-left:10px}.msp-plugin .msp-combined-color-button:hover{border-color:#16191f!important;border:none;outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-combined-color-swatch{width:100%;display:grid;grid-gap:1px;grid-template-columns:repeat(6,auto)}.msp-plugin .msp-combined-color-swatch .msp-btn:hover,.msp-plugin .msp-combined-color-swatch .msp-control-row button:hover,.msp-plugin .msp-control-row .msp-combined-color-swatch button:hover{outline-offset:-1px!important;outline:1px solid #363c4c!important}.msp-plugin .msp-action-select{position:relative}.msp-plugin .msp-action-select select{padding-left:42px}.msp-plugin .msp-action-select option:first-child{color:#9cacc3}.msp-plugin .msp-action-select>.msp-icon{display:block;top:0;left:10px;position:absolute;line-height:32px}.msp-plugin .msp-simple-help-section{height:28px;line-height:28px;margin-top:5px;margin-bottom:5px;padding:0 10px;font-weight:500;background:#111318;color:#ccd4e0}.msp-plugin .msp-left-panel-controls-buttons{position:absolute;width:32px;top:0;bottom:0;padding-top:10px;background:#111318}.msp-plugin .msp-left-panel-controls-buttons-bottom{position:absolute;bottom:0}.msp-plugin .msp-left-panel-controls-button-data-dirty{position:absolute;width:6px;height:6px;background:#d67118;border-radius:3px;right:6px;bottom:6px}.msp-plugin .msp-left-panel-controls .msp-scrollable-container{left:33px}.msp-plugin .msp-mapped-parameter-group{position:relative}.msp-plugin .msp-mapped-parameter-group>.msp-control-row:first-child>div:nth-child(2){right:33px}.msp-plugin .msp-mapped-parameter-group>button:first-child{right:33px}.msp-plugin .msp-mapped-parameter-group>.msp-btn-icon{position:absolute;right:0;width:32px;top:0;padding:0}.msp-plugin .msp-shape-filled{fill:#ccd4e0;stroke:#ccd4e0}.msp-plugin .msp-shape-empty{fill:none;stroke:#ccd4e0}.msp-plugin .msp-no-overflow{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.msp-plugin .msp-25-lower-contrast-text{color:#7d91b0}.msp-plugin .msp-expandable-group-color-stripe{position:absolute;left:0;top:30px;width:120px;height:2px}.msp-plugin .msp-section-header{height:32px;line-height:32px;margin-top:10px;margin-bottom:10px;text-align:right;padding:0 10px;font-weight:700;background:#111318;overflow:hidden;cursor:default}.msp-plugin .msp-section-header>.msp-icon{display:block;float:left}.msp-plugin .msp-section-header>small{font-weight:400}.msp-plugin .msp-current-header{height:32px;line-height:32px;margin-bottom:10px;text-align:center;font-weight:700;background:#111318}.msp-plugin .msp-flex-row,.msp-plugin .msp-state-image-row{margin-top:1px;background:#111318;display:flex;flex-direction:row;width:inherit;height:32px}.msp-plugin .msp-flex-row>.msp-flex-item,.msp-plugin .msp-state-image-row>.msp-flex-item{margin:0 1px 0 0;flex:1 1 auto;overflow:hidden}.msp-plugin .msp-flex-row>.msp-flex-item:last-child,.msp-plugin .msp-state-image-row>.msp-flex-item:last-child{margin-right:0}.msp-plugin .msp-flex-row>select,.msp-plugin .msp-state-image-row>select,.msp-plugin .msp-flex-row>button,.msp-plugin .msp-state-image-row>button{margin:0 1px 0 0;flex:1 1 auto;height:32px;overflow:hidden}.msp-plugin .msp-flex-row .msp-btn-icon,.msp-plugin .msp-state-image-row .msp-btn-icon,.msp-plugin .msp-flex-row .msp-btn-icon-small,.msp-plugin .msp-state-image-row .msp-btn-icon-small{flex:0 0 32px;max-width:32px}.msp-plugin .msp-flex-row>select,.msp-plugin .msp-state-image-row>select{background:none}.msp-plugin .msp-flex-row>select>option[value=_],.msp-plugin .msp-state-image-row>select>option[value=_]{display:none}.msp-plugin .msp-flex-row>select:last-child,.msp-plugin .msp-state-image-row>select:last-child,.msp-plugin .msp-flex-row>button:last-child,.msp-plugin .msp-state-image-row>button:last-child{margin-right:0}.msp-plugin .msp-flex-row>button.msp-control-button-label,.msp-plugin .msp-state-image-row>button.msp-control-button-label{background:#111318}.msp-plugin .msp-state-list{list-style:none}.msp-plugin .msp-state-list>li{position:relative;overflow:hidden}.msp-plugin .msp-state-list>li>button:first-child{text-align:left;border-left:10px solid #2a2f3c!important}.msp-plugin .msp-state-list>li>div{position:absolute;right:0;top:0}.msp-plugin .msp-state-image-row{height:96px;margin-top:0}.msp-plugin .msp-state-image-row>button{height:96px;padding:0}.msp-plugin .msp-state-image-row>button>img{min-height:96px;width:inherit;transform:translateY(-50%);top:50%;position:relative}.msp-plugin .msp-tree-row{position:relative;margin-top:0;margin-bottom:1px;background:transparent}.msp-plugin .msp-tree-row-current .msp-btn-tree-label{border-radius:0!important}.msp-plugin .msp-tree-row-current .msp-btn-tree-label>span{font-weight:700}.msp-plugin .msp-tree-row .msp-btn-tree-label{text-align:left;border-radius:0 0 0 8px;border-left-width:4px;border-left-style:solid}.msp-plugin .msp-tree-row .msp-btn-tree-label>small{color:#8d9fb9}.msp-plugin .msp-tree-updates-wrapper .msp-control-group-header:last-child{margin-bottom:1px}.msp-plugin .msp-viewport-top-left-controls{position:absolute;left:10px;top:10px}.msp-plugin .msp-viewport-top-left-controls .msp-traj-controls{line-height:32px;float:left;margin-right:10px;background-color:#0c0d11}.msp-plugin .msp-viewport-top-left-controls .msp-traj-controls>span{color:#ccd4e0;margin-left:10px;margin-right:10px;font-size:85%;display:inline-block}.msp-plugin .msp-viewport-top-left-controls .msp-state-snapshot-viewport-controls{line-height:32px;float:left;margin-right:10px}.msp-plugin .msp-viewport-top-left-controls .msp-state-snapshot-viewport-controls>button{background-color:#0c0d11}.msp-plugin .msp-viewport-top-left-controls .msp-state-snapshot-viewport-controls>select{display:inline-block;width:200px;margin-right:10px}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls{line-height:32px;float:left;margin-right:10px;position:relative}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls>div:first-child{position:relative;display:inline-block}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls>div:first-child>button{position:relative}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls .msp-animation-viewport-controls-select{width:290px;position:absolute;left:0;margin-top:10px;background:#1f222b}.msp-plugin .msp-viewport-top-left-controls .msp-animation-viewport-controls .msp-animation-viewport-controls-select .msp-control-row:first-child{margin-top:0}.msp-plugin .msp-selection-viewport-controls{position:relative;margin:10px auto 0;width:430px}.msp-plugin .msp-selection-viewport-controls-actions{position:absolute;width:100%;top:32px;background:#1f222b}.msp-plugin .msp-selection-viewport-controls>.msp-flex-row .msp-btn,.msp-plugin .msp-selection-viewport-controls>.msp-state-image-row .msp-btn,.msp-plugin .msp-selection-viewport-controls>.msp-flex-row .msp-control-row button,.msp-plugin .msp-control-row .msp-selection-viewport-controls>.msp-flex-row button,.msp-plugin .msp-selection-viewport-controls>.msp-state-image-row .msp-control-row button,.msp-plugin .msp-control-row .msp-selection-viewport-controls>.msp-state-image-row button{padding:0 5px}.msp-plugin .msp-selection-viewport-controls select.msp-form-control,.msp-plugin .msp-selection-viewport-controls select.msp-btn,.msp-plugin .msp-selection-viewport-controls .msp-control-row select,.msp-plugin .msp-control-row .msp-selection-viewport-controls select{padding:0 5px;text-align:center;background:#0c0d11;flex:0 0 80px;text-overflow:ellipsis}.msp-plugin .msp-param-object-list-item{margin-top:1px;position:relative}.msp-plugin .msp-param-object-list-item>button{text-align:left}.msp-plugin .msp-param-object-list-item>button>span{font-weight:700}.msp-plugin .msp-param-object-list-item>div{position:absolute;right:0;top:0}.msp-plugin .msp-state-actions .msp-transform-wrapper:last-child{margin-bottom:10px}.msp-plugin .msp-button-row{display:flex;flex-direction:row;height:32px;width:inherit}.msp-plugin .msp-button-row>button{margin:0 1px 0 0;flex:1 1 auto;height:32px;text-align-last:center;background:none;padding:0 10px;overflow:hidden}.msp-plugin .msp-action-menu-options-no-header,.msp-plugin .msp-action-menu-options .msp-control-group-children{max-height:300px;overflow:hidden;overflow-y:auto}.msp-plugin .msp-action-menu-options .msp-control-row,.msp-plugin .msp-action-menu-options button,.msp-plugin .msp-action-menu-options .msp-icon,.msp-plugin .msp-action-menu-options .msp-flex-row,.msp-plugin .msp-action-menu-options .msp-state-image-row{height:24px;line-height:24px}.msp-plugin .msp-action-menu-options button{text-align:left}.msp-plugin .msp-action-menu-options .msp-action-menu-button{margin-top:1px;display:flex}.msp-plugin .msp-action-menu-options .msp-action-menu-button .msp-icon{margin-right:6px}.msp-plugin .msp-representation-entry{position:relative}.msp-plugin .msp-representation-entry>.msp-control-group-header>.msp-btn,.msp-plugin .msp-control-row .msp-representation-entry>.msp-control-group-header>button{font-weight:700}.msp-plugin .msp-representation-entry>.msp-control-group-header>.msp-icon,.msp-plugin .msp-representation-entry>.msp-control-group-header>.msp-btn-link{line-height:24px;height:24px}.msp-plugin .msp-control-group-presets-wrapper{position:absolute;right:0;top:0}.msp-plugin .msp-control-group-presets-wrapper .msp-control-group-header{background:transparent}.msp-plugin .msp-control-group-presets-wrapper button{background:transparent!important}.msp-plugin .msp-parameter-matrix input{flex:1 1 auto;min-width:0}.msp-plugin .msp-btn-apply-simple{text-align:left}.msp-plugin .msp-btn-apply-simple .msp-icon{margin-right:10px}.msp-plugin .msp-type-class-Root{border-left-color:#111318}.msp-plugin .msp-type-class-Group{border-left-color:#d67118}.msp-plugin .msp-type-class-Data{border-left-color:#6d8082}.msp-plugin .msp-type-class-Object{border-left-color:#25a25a}.msp-plugin .msp-type-class-Representation3D{border-left-color:#258cd1}.msp-plugin .msp-type-class-Behavior{border-left-color:#804399}.msp-plugin .msp-accent-color-cyan{color:#6d8082}.msp-plugin .msp-accent-bg-cyan{background:#6d8082}.msp-plugin .msp-transform-header-brand-cyan{border-bottom:1px solid #6d8082}.msp-plugin .msp-transform-header-brand-cyan:active,.msp-plugin .msp-transform-header-brand-cyan:focus{border-bottom:1px solid #6d8082}.msp-plugin .msp-accent-color-red{color:#bf2718}.msp-plugin .msp-accent-bg-red{background:#bf2718}.msp-plugin .msp-transform-header-brand-red{border-bottom:1px solid #bf2718}.msp-plugin .msp-transform-header-brand-red:active,.msp-plugin .msp-transform-header-brand-red:focus{border-bottom:1px solid #bf2718}.msp-plugin .msp-accent-color-gray{color:#22303d}.msp-plugin .msp-accent-bg-gray{background:#22303d}.msp-plugin .msp-transform-header-brand-gray{border-bottom:1px solid #22303d}.msp-plugin .msp-transform-header-brand-gray:active,.msp-plugin .msp-transform-header-brand-gray:focus{border-bottom:1px solid #22303d}.msp-plugin .msp-accent-color-green{color:#25a25a}.msp-plugin .msp-accent-bg-green{background:#25a25a}.msp-plugin .msp-transform-header-brand-green{border-bottom:1px solid #25a25a}.msp-plugin .msp-transform-header-brand-green:active,.msp-plugin .msp-transform-header-brand-green:focus{border-bottom:1px solid #25a25a}.msp-plugin .msp-accent-color-purple{color:#804399}.msp-plugin .msp-accent-bg-purple{background:#804399}.msp-plugin .msp-transform-header-brand-purple{border-bottom:1px solid #804399}.msp-plugin .msp-transform-header-brand-purple:active,.msp-plugin .msp-transform-header-brand-purple:focus{border-bottom:1px solid #804399}.msp-plugin .msp-accent-color-blue{color:#258cd1}.msp-plugin .msp-accent-bg-blue{background:#258cd1}.msp-plugin .msp-transform-header-brand-blue{border-bottom:1px solid #258cd1}.msp-plugin .msp-transform-header-brand-blue:active,.msp-plugin .msp-transform-header-brand-blue:focus{border-bottom:1px solid #258cd1}.msp-plugin .msp-accent-color-orange{color:#d67118}.msp-plugin .msp-accent-bg-orange{background:#d67118}.msp-plugin .msp-transform-header-brand-orange{border-bottom:1px solid #d67118}.msp-plugin .msp-transform-header-brand-orange:active,.msp-plugin .msp-transform-header-brand-orange:focus{border-bottom:1px solid #d67118}.msp-plugin .msp-volume-channel-inline-controls>:first-child{position:absolute;left:0;top:0;height:32px;right:32px}.msp-plugin .msp-volume-channel-inline-controls .msp-slider>div:first-child{right:42px}.msp-plugin .msp-volume-channel-inline-controls .msp-slider>div:last-child{width:30px}.msp-plugin .msp-volume-channel-inline-controls>button{position:absolute;right:0;width:32px;top:0;padding:0}.msp-plugin .msp-volume-channel-inline-controls>button .msp-material-icon{margin-right:0}.msp-plugin .msp-list-unstyled{padding-left:0;list-style:none}.msp-plugin .msp-drag-drop-overlay{border:12px dashed #ccd4e0;background:#0000005c;display:flex;align-items:center;justify-content:center;position:absolute;inset:0;font-size:48px;font-weight:700}.msp-plugin .msp-task-state{line-height:32px}.msp-plugin .msp-task-state>span{-webkit-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-overlay-tasks{position:absolute;display:flex;inset:0;height:100%;width:100%;z-index:1000;justify-content:center;align-items:center;background:#00000040}.msp-plugin .msp-overlay-tasks .msp-task-state>div{height:32px;margin-top:1px;position:relative;width:100%;background:#111318}.msp-plugin .msp-overlay-tasks .msp-task-state>div>div{height:32px;line-height:32px;display:inline-block;padding:0 10px;-webkit-user-select:none;-o-user-select:none;user-select:none;cursor:default;white-space:nowrap;background:#111318;position:absolute}.msp-plugin .msp-overlay-tasks .msp-task-state>div>button{display:inline-block;margin-top:-3px}.msp-plugin .msp-background-tasks{position:absolute;left:0;bottom:0;z-index:1000}.msp-plugin .msp-background-tasks .msp-task-state>div{height:32px;margin-top:1px;position:relative;width:100%;background:#111318}.msp-plugin .msp-background-tasks .msp-task-state>div>div{height:32px;line-height:32px;display:inline-block;padding:0 10px;-webkit-user-select:none;-o-user-select:none;user-select:none;cursor:default;white-space:nowrap;background:#111318;position:absolute}.msp-plugin .msp-background-tasks .msp-task-state>div>button{display:inline-block;margin-top:-3px}.msp-plugin .msp-viewport{position:absolute;inset:0;background:#111318}.msp-plugin .msp-viewport .msp-btn-link{background:#0003}.msp-plugin .msp-viewport-expanded{position:fixed;z-index:1000}.msp-plugin .msp-viewport-host3d{position:absolute;inset:0;-webkit-user-select:none;user-select:none;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-touch-callout:none;touch-action:manipulation}.msp-plugin .msp-viewport-host3d>canvas{background-color:#111318;background-image:linear-gradient(45deg,lightgrey 25%,transparent 25%,transparent 75%,lightgrey 75%,lightgrey),linear-gradient(45deg,lightgrey 25%,transparent 25%,transparent 75%,lightgrey 75%,lightgrey);background-size:60px 60px;background-position:0 0,30px 30px}.msp-plugin .msp-viewport-controls{position:absolute;right:10px;top:10px;width:32px}.msp-plugin .msp-viewport-controls-buttons{text-align:right;position:relative}.msp-plugin .msp-viewport-controls-buttons>div{position:relative;margin-bottom:4px}.msp-plugin .msp-viewport-controls-buttons button{padding:0;text-align:center;width:32px;position:relative}.msp-plugin .msp-viewport-controls-buttons .msp-btn-link-toggle-off{color:#637ca0}.msp-plugin .msp-viewport-controls-buttons .msp-btn-link:hover{color:#51a2fb}.msp-plugin .msp-semi-transparent-background{background:#111318;opacity:.5;position:absolute;top:0;left:0;width:100%;height:100%}.msp-plugin .msp-hover-box-wrapper{position:relative}.msp-plugin .msp-hover-box-wrapper .msp-hover-box-body{visibility:hidden;position:absolute;right:36px;top:0;width:100px;background-color:#111318}.msp-plugin .msp-hover-box-wrapper .msp-hover-box-spacer{visibility:hidden;position:absolute;right:32px;top:0;width:4px;height:32px}.msp-plugin .msp-hover-box-wrapper:hover .msp-hover-box-body,.msp-plugin .msp-hover-box-wrapper:hover .msp-hover-box-spacer{visibility:visible}.msp-plugin .msp-viewport-controls-panel{width:290px;top:0;right:36px;position:absolute;background:#1f222b}.msp-plugin .msp-viewport-controls-panel .msp-control-group-wrapper:first-child{padding-top:0}.msp-plugin .msp-viewport-controls-panel .msp-viewport-controls-panel-controls{overflow-y:auto;max-height:400px}.msp-plugin .msp-highlight-toast-wrapper{position:absolute;right:10px;bottom:10px;max-width:95%;z-index:10000}.msp-plugin .msp-highlight-info{color:#51a2fb;padding:3px 10px;background:#111318;opacity:90%;max-width:400px;-webkit-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-highlight-markdown-row{padding-left:10px}.msp-plugin .msp-highlight-simple-row{text-align:right}.msp-plugin .msp-highlight-info-hr{margin-inline:0px;margin-block:3px;border:none;height:1px;background-color:#51a2fb}.msp-plugin .msp-highlight-info-additional{font-size:85%;display:inline-block;color:#056ee1}.msp-plugin .msp-snapshot-description-wrapper{background:#11131880;position:absolute;left:0;top:42px;padding:6.6px 10px;max-height:224px;overflow:hidden;overflow-y:auto;max-width:400px}.msp-plugin .msp-snapshot-description-wrapper a{text-decoration:underline;cursor:pointer;color:#ccd4e0}.msp-plugin .msp-snapshot-description-wrapper ul,.msp-plugin .msp-snapshot-description-wrapper ol{padding-left:14px}.msp-plugin .msp-log-wrap{position:absolute;inset:0;overflow:hidden}.msp-plugin .msp-log{position:absolute;inset:0 -20px 0 0;overflow-y:scroll;overflow-x:hidden;font-size:90%;background:#1f222b}.msp-plugin .msp-log{font-size:90%;color:#bcc7d6}.msp-plugin .msp-log ul{padding:0;margin:0}.msp-plugin .msp-log li{clear:both;margin:0;background:#111318;position:relative}.msp-plugin .msp-log li:not(:last-child){border-bottom:1px solid #313645}.msp-plugin .msp-log .msp-log-entry{margin-left:110px;background:#14171c;padding:3px 25px 3px 10px}.msp-plugin .msp-log .msp-log-timestamp{padding:3px 10px;float:left;text-align:right;width:110px;color:#8d9fb9;font-size:100%}.msp-plugin .msp-log .msp-log-timestamp small{font-size:100%}.msp-plugin .msp-log .label{margin-top:-3px;font-size:7pt}.msp-plugin .msp-log-entry-badge{position:absolute;left:0;top:0;bottom:0;width:6px}.msp-plugin .msp-log-entry-message{background:#0cca5d}.msp-plugin .msp-log-entry-info{background:#5e3673}.msp-plugin .msp-log-entry-error{background:#fd354b}.msp-plugin .msp-log-entry-warning{background:#fcc937}.msp-plugin .msp-sequence{position:absolute;inset:0;background:#111318}.msp-plugin .msp-sequence-select{position:relative;height:24px;width:100%;margin-bottom:1px;background:#1f222b;text-align:left}.msp-plugin .msp-sequence-select>span{display:inline-block;line-height:24px;padding:0 10px;font-size:85%;font-weight:700;cursor:default}.msp-plugin .msp-sequence-select>select{display:inline-block;max-width:120px;width:auto;text-overflow:ellipsis;font-size:85%;height:24px;line-height:24px;background-size:6px 8px;background-color:#1f222b}.msp-plugin .msp-sequence-wrapper{word-break:break-word;padding:10px 10px 3px;-webkit-user-select:none;user-select:none}.msp-plugin .msp-sequence-wrapper-non-empty{font-size:85%;line-height:180%;font-family:Courier New,monospace;background:#0c0d11;width:100%;overflow-y:auto;overflow-x:hidden;position:absolute;inset:25px 0 0}.msp-plugin .msp-sequence-chain-label{margin-left:10px;margin-top:10px;-webkit-user-select:none;user-select:none;color:#51a2fb;font-size:90%;line-height:90%;padding-left:.2em}.msp-plugin .msp-sequence-wrapper span{cursor:pointer}.msp-plugin .msp-sequence-wrapper .msp-sequence-residue-long{margin:0 .2em}.msp-plugin .msp-sequence-wrapper .msp-sequence-residue-long-begin{margin:0 .2em 0 0}.msp-plugin .msp-sequence-wrapper .msp-sequence-label{color:#51a2fb;font-size:90%;line-height:90%;padding-bottom:1em;padding-left:.2em}.msp-plugin .msp-sequence-wrapper .msp-sequence-number{color:#51a2fb;word-break:keep-all;cursor:default;position:relative;top:-1.1em;left:3.1em;padding:0;margin-left:-3em;font-size:80%}.msp-plugin .msp-sequence-wrapper .msp-sequence-number-long{left:3.3em}.msp-plugin .msp-sequence-wrapper .msp-sequence-number-long-negative{left:2.7em}.msp-plugin .msp-sequence-wrapper .msp-sequence-number-negative{left:2.5em}.msp-plugin .msp-sequence-wrapper .msp-sequence-present{color:#ccd4e0}.msp-plugin .msp-sequence-wrapper .msp-sequence-missing{color:#637ca0}.msp-plugin .msp-transformer .msp-entity-badge{position:absolute;top:0;right:0;height:32px;line-height:32px;width:32px}.msp-plugin .msp-layout-right,.msp-plugin .msp-layout-left{background:#1f222b}.msp-plugin .msp-transformer-wrapper{position:relative}.msp-plugin .msp-transformer-wrapper .msp-entity-badge{left:0;top:0}.msp-plugin .msp-transformer-wrapper:first-child .msp-panel-description-content{top:33px}.msp-plugin .msp-transformer-wrapper:not(:first-child) .msp-panel-description-content{bottom:33px}.msp-plugin .msp-transform-wrapper{margin-bottom:10px}.msp-plugin .msp-transform-wrapper-collapsed,.msp-plugin .msp-transform-update-wrapper,.msp-plugin .msp-transform-update-wrapper-collapsed{margin-bottom:1px}.msp-plugin .msp-transform-update-wrapper>.msp-transform-header>button,.msp-plugin .msp-transform-update-wrapper-collapsed>.msp-transform-header>button{text-align:left;padding-left:32px;line-height:24px;background:#16191f}.msp-plugin .msp-transform-wrapper>.msp-transform-header>button{text-align:left;background:#111318;font-weight:700;padding-right:5px}.msp-plugin .msp-transform-header{position:relative}.msp-plugin .msp-transform-header>button>small{font-weight:400;float:right}.msp-plugin .msp-transform-header>button>span:first-child{margin-right:10px}.msp-plugin .msp-transform-header>button:hover{color:#9cacc3}.msp-plugin .msp-transform-header-brand{margin-bottom:-1px}.msp-plugin .msp-transform-header-brand svg{fill:#ccd4e0;stroke:#ccd4e0}.msp-plugin .msp-transform-default-params{background:#111318;position:absolute;left:0;top:0;width:32px;padding:0}.msp-plugin .msp-transform-default-params:hover{background:#000}.msp-plugin .msp-transform-apply-wrap{position:relative;margin-top:1px;width:100%;height:32px}.msp-plugin .msp-transform-refresh{width:87px;margin-left:33px;background:#111318;text-align:right}.msp-plugin .msp-transform-apply{display:block;position:absolute;left:120px;right:0;top:0}.msp-plugin .msp-transform-apply-wider{margin-left:33px}.msp-plugin .msp-data-beh{margin:10px 0!important}.msp-plugin .msp-toast-container{position:relative;z-index:1001}.msp-plugin .msp-toast-container .msp-toast-entry{color:#ccd4e0;background:#1f222b;position:relative;float:right;min-height:32px;margin-top:10px;border:1px solid #313645;display:table}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-title{height:100%;line-height:32px;padding:0 10px;background:#111318;font-weight:700;display:table-cell;-webkit-user-select:none;-o-user-select:none;user-select:none;font-weight:light;cursor:pointer}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message{padding:3px 42px 3px 10px;display:table-cell}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a{text-decoration:none;color:#68befd;font-weight:700}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a:hover{text-decoration:underline;color:#0393fc}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a:active,.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-message a:focus{color:#68befd;outline-offset:0;outline:none}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-hide{position:absolute;width:42px;right:0;top:0;bottom:0}.msp-plugin .msp-toast-container .msp-toast-entry .msp-toast-hide .msp-btn-icon{background:transparent;position:absolute;inset:1px 0 0;width:100%;text-align:right;padding-right:5px}.msp-plugin .msp-help-row{position:relative;height:32px;background:#111318;margin-top:1px;display:table;width:100%}.msp-plugin .msp-help-row>span{width:120px;text-align:right;padding:3px 10px;color:#9cacc3;display:table-cell;font-weight:700;-webkit-user-select:none;-o-user-select:none;user-select:none;cursor:default}.msp-plugin .msp-help-row>div{background:#0c0d11;position:relative;padding:3px 10px;display:table-cell}.msp-plugin .msp-canvas{width:100%;height:100%;background-color:#f3f2ee}.msp-plugin .msp-canvas text{-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.msp-plugin .msp-canvas circle{stroke:#000;stroke-width:10;stroke-opacity:.3}.msp-plugin .msp-canvas circle:hover{fill:#ae5d04;stroke:#000;stroke-width:10px}.msp-plugin .msp-canvas .info{fill:#fff;stroke:#000;stroke-width:3}.msp-plugin .msp-canvas .show{visibility:visible}.msp-plugin .msp-canvas .hide{visibility:hidden}.msp-plugin .msp-canvas .delete-button rect{fill:#ed4337;stroke:#000}.msp-plugin .msp-canvas .delete-button text{stroke:#fff;fill:#fff}.msp-plugin .msp-canvas .delete-button:hover{stroke:#000;stroke-width:3;fill:#ff6961}.msp-plugin .msp-canvas .infoCircle:hover{fill:#4c66b2}.msp-plugin .msp-canvas:focus{outline:none}.msp-plugin .msp-logo{display:block;position:absolute;bottom:10px;right:10px;height:32px;width:100px;background-repeat:no-repeat;background-position:bottom right;background-size:auto;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAAAgCAYAAABn7+QVAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAACHDwAAjA8AAP1SAACBQAAAfXkAAOmLAAA85QAAGcxzPIV3AAAKL2lDQ1BJQ0MgUHJvZmlsZQAASMedlndUVNcWh8+9d3qhzTACUobeu8AA0nuTXkVhmBlgKAMOMzSxIaICEUVEmiJIUMSA0VAkVkSxEBRUsAckCCgxGEVULG9G1ouurLz38vL746xv7bP3ufvsvc9aFwCSpy+XlwZLAZDKE/CDPJzpEZFRdOwAgAEeYIApAExWRrpfsHsIEMnLzYWeIXICXwQB8HpYvAJw09AzgE4H/5+kWel8geiYABGbszkZLBEXiDglS5Auts+KmBqXLGYYJWa+KEERy4k5YZENPvsssqOY2ak8tojFOaezU9li7hXxtkwhR8SIr4gLM7mcLBHfErFGijCVK+I34thUDjMDABRJbBdwWIkiNhExiR8S5CLi5QDgSAlfcdxXLOBkC8SXcklLz+FzExIFdB2WLt3U2ppB9+RkpXAEAsMAJiuZyWfTXdJS05m8HAAW7/xZMuLa0kVFtjS1trQ0NDMy/apQ/3Xzb0rc20V6Gfi5ZxCt/4vtr/zSGgBgzIlqs/OLLa4KgM4tAMjd+2LTOACApKhvHde/ug9NPC+JAkG6jbFxVlaWEZfDMhIX9A/9T4e/oa++ZyQ+7o/y0F058UxhioAurhsrLSVNyKdnpDNZHLrhn4f4Hwf+dR4GQZx4Dp/DE0WEiaaMy0sQtZvH5gq4aTw6l/efmvgPw/6kxbkWidL4EVBjjIDUdSpAfu0HKAoRINH7xV3/o2+++DAgfnnhKpOLc//vN/1nwaXiJYOb8DnOJSiEzhLyMxf3xM8SoAEBSAIqkAfKQB3oAENgBqyALXAEbsAb+IMQEAlWAxZIBKmAD7JAHtgECkEx2An2gGpQBxpBM2gFx0EnOAXOg0vgGrgBboP7YBRMgGdgFrwGCxAEYSEyRIHkIRVIE9KHzCAGZA+5Qb5QEBQJxUIJEA8SQnnQZqgYKoOqoXqoGfoeOgmdh65Ag9BdaAyahn6H3sEITIKpsBKsBRvDDNgJ9oFD4FVwArwGzoUL4B1wJdwAH4U74PPwNfg2PAo/g+cQgBARGqKKGCIMxAXxR6KQeISPrEeKkAqkAWlFupE+5CYyiswgb1EYFAVFRxmibFGeqFAUC7UGtR5VgqpGHUZ1oHpRN1FjqFnURzQZrYjWR9ugvdAR6AR0FroQXYFuQrejL6JvoyfQrzEYDA2jjbHCeGIiMUmYtZgSzD5MG+YcZhAzjpnDYrHyWH2sHdYfy8QKsIXYKuxR7FnsEHYC+wZHxKngzHDuuCgcD5ePq8AdwZ3BDeEmcQt4Kbwm3gbvj2fjc/Cl+EZ8N/46fgK/QJAmaBPsCCGEJMImQiWhlXCR8IDwkkgkqhGtiYFELnEjsZJ4jHiZOEZ8S5Ih6ZFcSNEkIWkH6RDpHOku6SWZTNYiO5KjyALyDnIz+QL5EfmNBEXCSMJLgi2xQaJGokNiSOK5JF5SU9JJcrVkrmSF5AnJ65IzUngpLSkXKabUeqkaqZNSI1Jz0hRpU2l/6VTpEukj0lekp2SwMloybjJsmQKZgzIXZMYpCEWd4kJhUTZTGikXKRNUDFWb6kVNohZTv6MOUGdlZWSXyYbJZsvWyJ6WHaUhNC2aFy2FVko7ThumvVuitMRpCWfJ9iWtS4aWzMstlXOU48gVybXJ3ZZ7J0+Xd5NPlt8l3yn/UAGloKcQqJClsF/hosLMUupS26WspUVLjy+9pwgr6ikGKa5VPKjYrzinpKzkoZSuVKV0QWlGmabsqJykXK58RnlahaJir8JVKVc5q/KULkt3oqfQK+m99FlVRVVPVaFqveqA6oKatlqoWr5am9pDdYI6Qz1evVy9R31WQ0XDTyNPo0XjniZek6GZqLlXs09zXktbK1xrq1an1pS2nLaXdq52i/YDHbKOg84anQadW7oYXYZusu4+3Rt6sJ6FXqJejd51fVjfUp+rv09/0ABtYG3AM2gwGDEkGToZZhq2GI4Z0Yx8jfKNOo2eG2sYRxnvMu4z/mhiYZJi0mhy31TG1Ns037Tb9HczPTOWWY3ZLXOyubv5BvMu8xfL9Jdxlu1fdseCYuFnsdWix+KDpZUl37LVctpKwyrWqtZqhEFlBDBKGJet0dbO1husT1m/tbG0Edgct/nN1tA22faI7dRy7eWc5Y3Lx+3U7Jh29Xaj9nT7WPsD9qMOqg5MhwaHx47qjmzHJsdJJ12nJKejTs+dTZz5zu3O8y42Lutczrkirh6uRa4DbjJuoW7Vbo/c1dwT3FvcZz0sPNZ6nPNEe/p47vIc8VLyYnk1e816W3mv8+71IfkE+1T7PPbV8+X7dvvBft5+u/0erNBcwVvR6Q/8vfx3+z8M0A5YE/BjICYwILAm8EmQaVBeUF8wJTgm+Ejw6xDnkNKQ+6E6ocLQnjDJsOiw5rD5cNfwsvDRCOOIdRHXIhUiuZFdUdiosKimqLmVbiv3rJyItogujB5epb0qe9WV1QqrU1afjpGMYcaciEXHhsceiX3P9Gc2MOfivOJq42ZZLqy9rGdsR3Y5e5pjxynjTMbbxZfFTyXYJexOmE50SKxInOG6cKu5L5I8k+qS5pP9kw8lf0oJT2lLxaXGpp7kyfCSeb1pymnZaYPp+umF6aNrbNbsWTPL9+E3ZUAZqzK6BFTRz1S/UEe4RTiWaZ9Zk/kmKyzrRLZ0Ni+7P0cvZ3vOZK577rdrUWtZa3vyVPM25Y2tc1pXvx5aH7e+Z4P6hoINExs9Nh7eRNiUvOmnfJP8svxXm8M3dxcoFWwsGN/isaWlUKKQXziy1XZr3TbUNu62ge3m26u2fyxiF10tNimuKH5fwiq5+o3pN5XffNoRv2Og1LJ0/07MTt7O4V0Ouw6XSZfllo3v9tvdUU4vLyp/tSdmz5WKZRV1ewl7hXtHK30ru6o0qnZWva9OrL5d41zTVqtYu712fh9739B+x/2tdUp1xXXvDnAP3Kn3qO9o0GqoOIg5mHnwSWNYY9+3jG+bmxSaips+HOIdGj0cdLi32aq5+YjikdIWuEXYMn00+uiN71y/62o1bK1vo7UVHwPHhMeefh/7/fBxn+M9JxgnWn/Q/KG2ndJe1AF15HTMdiZ2jnZFdg2e9D7Z023b3f6j0Y+HTqmeqjkte7r0DOFMwZlPZ3PPzp1LPzdzPuH8eE9Mz/0LERdu9Qb2Dlz0uXj5kvulC31OfWcv210+dcXmysmrjKud1yyvdfRb9Lf/ZPFT+4DlQMd1q+tdN6xvdA8uHzwz5DB0/qbrzUu3vG5du73i9uBw6PCdkeiR0TvsO1N3U+6+uJd5b+H+xgfoB0UPpR5WPFJ81PCz7s9to5ajp8dcx/ofBz++P84af/ZLxi/vJwqekJ9UTKpMNk+ZTZ2adp++8XTl04ln6c8WZgp/lf619rnO8x9+c/ytfzZiduIF/8Wn30teyr889GrZq565gLlHr1NfL8wXvZF/c/gt423fu/B3kwtZ77HvKz/ofuj+6PPxwafUT5/+BQOY8/xvJtwPAAAACXBIWXMAAC4iAAAuIgGq4t2SAAANMElEQVRoQ92aB1xURx7H/69sY5eOFBELCipESsSC0RCMJRZMrICHGiMmGjWaqDk7YEsuGok5TS6xi56KGtsFG6jBiAYLKhqVc8GGBZG+fd97N+/twNJWFksS7/v5DG/nN/OG/fze/838Z4CA/wMCE9d9W8oQ3mUMBSojBTqWAuBQAweHIC56lanXHw8xJixM6qhQNcX1KuQykluyKzMPVxvF5XUh3hIpgFSiQz8AJBItSKU6sCsX55P9byLxxRKwYl3W5O6dg5o62IMRmcpyBBz87wNYcyH3R4iL+gh3+8MhHaTqYJKUKO2dPYTigIqza1MlLZLnzh3arQ/uZzVn14YOIGRyJWXrqgR5U6VI1kRJS92VBEEry+wrAnC3F04XL3cY4OMF7/p6weC2zSDQzQG3/IlM7dspdPmU0VxtLqYf5haM6HYOBYLVUwcXByQy92JxXioexUzFhT5cySn3TrjrC4WP3EsPHuPfZGJVZg4HCdt/wF0aT8LWUHT/jTpl4fZU3KNBSHytQ0D33uDR0qfjoqg3hmOpQU65d4u2cW4X6NCyJ1ZeIeKSFRC3p1q4kzYdmzr6Zk98p6rsj+rhi0KoFe5gIm53M/ypDhbNJQgC3kbTFUGSi+LiwmgsWyQ5zk9McESCZ8gEVHvF1kneWJI5CJT2SHWDbUQ0vNbEvqr4OClwCyZ+RzSQ+psomqOwUgOL5vL4BIdCi/aBvtJb3AdYsoirs0usnWfH1vbNOmPlFWHmWlve2DFB3t0nhvh0qm2wRRZuG+ksFyUlDe4qcbYRJ0H8v6NxSxVPNZcnPPJDIAlY8PWnXWVYqsPhZb3lDAfzW3T50xbmZ+MfyFhbRcr7yNj1EZ1gdb+O8DFvMKk7it4+ywYjY11k0s1po8KpmA4tITUmnHaWS5HBKJKr0aC5zXw6QJvgNzyhXDIZS3UgCN3UJq3fdLd188PKs3H8+Bjpvn2x/jv2TwnbsOezt3/YPavTss3TXXHzi4U3Vic/+H5gq+7rkLEkmgb5yWwVb3CnNiFAcD+aOtaGaMobmzrqLaoyIwlC11RkNB/JvPGCiGjQXJ43h8QCSRGzEqeG1Xmah77u48QCPdM7NBYrjSPveJg069i7H2UcjUpndWSZrZ3bFRfHlic8nL1TnezcM2Vyh0dLtsbnzdu8JHHW5qVt8G3Pj9qOT4RYluOE/UYllQZPCvFxMik1cbGRSKsbWwlKUPhxhDGxZJ25Ls28oX2X3k60HmZiqQqDTj+rqX8fB7lTC6xYT2569zA9Jb5m7xz8r3aB03uE9fpOFP7WYujZ/TPo22MSDOs1FT4ePBfG9ZvQsod/12kUJf190prli4YnJ6Mt2HOSMKICGLL/5su3Tn6wPxMYZE4lvMH/RAZP6NjaJGBsJSJIi3mrTg6d9bAYem05YSxS6WJgQdR2LFtnLk9oxFigRaKpq2aEuWMJDizu6UlQosltuo3FivU8zgyOkEhkRzz941u2CogDxyYhgMzDrWb4rMXN0Q36vN4TZr43XuTt0WyeoiR/MwqV509JqgzOSx+77zcw8nGM4UMx2r+5qYJpqpByHVztcc3E+QdFXJWx8dE78MgCDaZYldi5eIB/jwj577/+NB9VJ/GajmHj2nYZKpPZNW5aVJ9v2ULDwlaXdsvFYlvzpo1l9PD4yXUoKStAY3MgFjuAexNvcFA4C+32NgqY3HcofHFg18ioH1adRSHyjdBgCQJaQ/y2SFyzAIMKuSkp+1YAepIOGwZ1Bgo9UGu4gCK2z9ZfoEit3yMI1X8XxZwh+B2al2/7jOnfbsKqGaNeB7RYgmsAmvJi2LHkbwaC0baXyElKKpVe7f/JVlpsY4978Abp0PxsvqcSVVZfMGoud3Z44+HZ8vOeG2m3GWOkntNwK8CTgky4eiWJK9fqflUZJRe0jFirZmgvDSPu29or2PmdzhEgpkVC3/ziIpiRvL1ETUua74+NLed3aEnRg4IC3F2Edp6DNx/AmqxcXLMeFK0w3M8L1yxToTfCtCNZUKTRY8VMZv4TyC/VxFiM3OM7N0BudiaMW/g9VgBkto7QIWyYKDstaSEYGdo3dEQNY/n5/EbKJHBq2QPcOozBWk24K00UGgM3QuI2GisA5cVXIOdyYqHeKBo0cEDSaSwLLNu8TJ5968o6LQORI3oMETRPRycI9GrhkHH7Di/UjQpEvzYeQnlZKMQ0rB1Y/25+xO4M2Fl61/KcazTo4W5ONuRcOIUVEx3CI0Fqax8lljsO9w2tuTMuyksHVcHvwKHX2xIcU9aFsgmQEbR5MX50aztQYJzWu19NY3lmjp6pekIrxmbfvv6woLQQqwCBzZujn0SYqfbX5KkLGprVL51IXgMcW5VdgFgqh4DwkaR/WAxBi837Co5j4Hbmj3wucglL9cJy4ENKzRkVf5+q9Bqnpol9WKpDYuR0DfoKabcL8rGCotfBEQ0GLy41ewk81VyWIfYV3lNmXj2NNizVaNvtPfBBc2B1Hl07BKqi2xkkyf0HSxYg0D7eFn9G5rJ69EAYfXj4zgos1QtaYoq16G2qRCYWA0dw5oFqcb9cAyfvPG50ufq4FI/wdPg5t777+VKoNh1ZPzVbIAiWIwl69qm9G9Lad+kJFF5QKFosXCthjXrI/W0jsCw5G62+Tz0D5p8mU3sxrp7FWwClZKYcHWMawvKqvuf6PZh86HwBusW6VY0g/FzlEru0mHAsPB05mnN3X7sHKzNz+K91Df2o+VQIorDBVGz2lpPHvhobdvRy+v7ewT2HYrUmdy/tBU3po5Ren55MP7e+a6MP2F8aHLHXqr9ExO8Y46oQr08bFS6cflkD/1gT+wYLH1aeydGCSD8Q5ox5Ymo1YdUmgqTI2ZkpWziDToMVM0adCpRntrAERc/B0qvFImSsrWAsWdvYx/j1rkRtYNBGo+bbk9gnGKZ19Q0GgzgVlm4yJeQYq8ydsfb4eW158a6LaTuxYkaZuQN0mrLtb39y/KkL2V+Shdved7URrz9Wj7Fn7xfBuAOZuGbiTqkKRu09Y8HgtkFg5A3+qcpgq8zloUT0vItpyUZthXlq0amKQfnbTgNw5AIsvTos3o2SYGL10vAA0r8eY/mdV4nWgBUz26/eqWMwz7JeQeDrbIcM1idgyXpzp6xOyzHoVBuyUrdiBeD6ySQw6DVr+n9+XImlBmE5ggHOiGs8wleg0G7e8urEQwBNEuavywjpYY2BGse8oQ9QHjgM7bK0/ApfiWDslhOGEq1+NZZqwnH526/cOVbdYP7K13OelKcBY/O5ICKsNpeHFJMJ1zL2aVQlBaAqfgDKswdUKIFYhJutAqVqDznDI1xDdbRVFkkc6YzDQ9piqX448HNSmE+jitVq/mkU4OqzERd9sEJnGNJ/W7pgcGalsTp9FDLRdF5QGwJ0wNpEoAhOi0GGao0M8Fe+DkzpIEgYpMY9G2fuxMRj+axBvyrryEbITtsIjNGwcuDnvzzEzVahJ+gsVnURfTK/Vg6uYUDSNH8gVG/0Ltqy6E2FVNajjYf5WFNZ8AhQcvb88zxvsIEZzBvcV4hYYyQsiP4Jt9YPbyAycgcytM2qn4G/moz9qMpYnkaZK0CIv8y9cKQk72JqkYqAZVi1GmlAxXVGX3DdWHYGKwDurSLBxrb1yLRDo/ftTxkflpQyxW5lyhTJ97vm+azYNneWiCJ+HtxtICnCeTZ/wH0m9yaQHHNAEJ6X+ZGHeINLtLpIiIusP2JrwxspJyLyyzVL+WttY3kabe74xCNFBMd+xXDcl2MTfinBcqPggP5Kfe+bqimTomTwWkg8tPaNjLC3bX5CxtKljjqxViGzyfFrFfTFB/3GK3w9zTvd49eyobCsNGPvlCl1ziKeGWQwxI2sYWx2QamwsFWWcQfO4hbM9EgNLIiaK1zrofGRy8PQ34o1mmf+Hyz5/nub9Kprh4qVS4WzBR6SFEOLVv3hze7zYOiAFTDqveUQ03829O0yDJrYm8+Lr9+/AztOn1SxHPNy/xoqklxEi9qAo7kPq0rGvcIBaOIah3s0yDOZO/rro6rIxDP1Pi1rIBKABb3tiIqCw0fzL38GmvKbuMUyOoMODmf9Ct8d3l3CsfpByR9Pu4KbXg5zhjxBUZlSp8yPPoF7NIhwWG5jb5/h16kbltBrShLw+K4SCvOVCYt2no7HslWg7e9iW5fWcxVNvIGmGVMRGYEoO4zmykLhsBx3heTk4VSgW+lENSObQ8n9POSOHUEi90L97dHOlQKtXg9FFSVwu+A+XLmbx5Tp2F1qhvr7d7Ezb+MhBPjD8tdbNA+SSGSgYwmUGpFwo7AczuYX/an/iEdM6B3qKqbZAbguIKJQEZEosYSLi3efzsKyVZxd3/V1Cc0FisQMGsMAUqkBXfXoqgXChjlgF/LAfCiLOXfuQ5G2tDRcY5CGaRhxO41R4qJlRJSaEZVrjOLbapY6Z9BASkJswn18Sw2CVqx/t5ghncoZElQsBTqm8u+X3A0UaRm48gcD8D/XZskfp8IFSwAAAABJRU5ErkJggg==)}.msp-plugin .msp-plugin-content{color:#ccd4e0}.msp-plugin .msp-plugin-init-error{white-space:pre;margin:10px}\n",".ngx-structure-viewer-container{position:relative;height:100%;width:100%}.ngx-structure-viewer-canvas{position:absolute;height:100%;width:100%;left:0;top:0}\n"],encapsulation:2})}return e})();function yDt(e,t){if(1&e&&(br(0,"div",6)(1,"div",7),js(2,"div",8),br(3,"code",9)(4,"pre",10),Li(5),Ox(6,"json"),Sr()()()()),2&e){const n=t.$implicit;Yc(2),xT("background-color",n.color),Yc(3),T4(Bx(6,3,n))}}function bDt(e,t){if(1&e&&(br(0,"div",0)(1,"div",1)(2,"div",2),js(3,"ngx-structure-viewer",3),Sr()(),br(4,"div",4)(5,"h2"),Li(6,"Color chain"),Sr(),br(7,"div",5),wT(8,yDt,7,5,"div",6,CT),Sr()()()),2&e){const n=t,r=Pu();Yc(3),R0("settings",r.settings)("source",r.source)("loci",n),Yc(5),AT(n)}}let vDt=(()=>{class e{constructor(){this.settings={"background-color":"#2b3035ff","backbone-color":"#6ea8fecc","interaction-color":"#ff0000ff","interaction-size":1},this.source={type:"remote",format:"mmcif",label:"8VAP",binary:!1,link:"assets/8vap.cif"};const n=[{chain:"A",color:"#6f42c1"},{chain:"B",color:"#0d6efd"},{chain:"C",color:"#dc3545"},{chain:"D",color:"#ffc107"},{chain:"E",color:"#28a745"},{chain:"F",color:"#17a2b8"},{chain:"G",color:"#fd7e14"}];this.chains$=function gDt(e=0,t=yF){return e<0&&(e=0),oge(e,e,t)}(3e3).pipe(hn(()=>n.map(r=>r.color)),hn(r=>r.sort(()=>Math.random()-.5)),hn(r=>r.map((i,o)=>({...n[o],color:i}))),WT(n),ff(1))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=$d({type:e,selectors:[["app-section-chains"]],standalone:!0,features:[Dh],decls:2,vars:3,consts:[[1,"row","mb-3"],[1,"col-9"],[1,"rounded","squared","overflow-hidden","shadow-sm"],[3,"settings","source","loci"],[1,"col-3","pt-0","p-3"],[1,"d-flex","flex-column","gap-2"],[1,"flex-1"],[1,"d-flex","flex-row","gap-2"],[1,"d-block","flex-shrink-0","p-2"],[1,"bg-body-tertiary","flex-grow-1","p-3"],[1,"m-0"]],template:function(r,i){if(1&r&&(Ym(0,bDt,10,3,"div",0),Ox(1,"async")),2&r){let o;ST(0,(o=Bx(1,1,i.chains$))?0:-1,o)}},dependencies:[mDt,L0,iR,_j],changeDetection:0})}return e})(),xDt=(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=$d({type:e,selectors:[["page-structure-viewer"]],standalone:!0,features:[Dh],decls:10,vars:0,consts:[[1,"container","pt-3"],[1,"mb-3"]],template:function(r,i){1&r&&(br(0,"div",0)(1,"div",1)(2,"h1"),Li(3,"Structure viewer"),Sr(),br(4,"p"),Li(5," The "),br(6,"b"),Li(7,"ngx-structure-viewer"),Sr(),Li(8," is a Mol* wrapper for Angular. It is a viewer for molecular structures and can be used to visualize and interact with 3D molecular structures. It works out of the box with the latest releases of Angular and automatized the most common features of Mol*. "),Sr()(),js(9,"app-section-chains"),Sr())},dependencies:[vDt,mU,L0],styles:[".progress-bar[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_progress 10s linear infinite;width:0}@keyframes _ngcontent-%COMP%_progress{0%{width:0}to{width:100%}}"]})}return e})();const z2e={A:{background:"#FFBF00",color:"#000000"},R:{background:"#FF0000",color:"#FFFFFF"},N:{background:"#00FFFF",color:"#000000"},D:{background:"#0000FF",color:"#FFFFFF"},C:{background:"#FFFF00",color:"#000000"},Q:{background:"#00FF00",color:"#000000"},E:{background:"#FF00FF",color:"#FFFFFF"},G:{background:"#808080",color:"#FFFFFF"},H:{background:"#008000",color:"#FFFFFF"},I:{background:"#FFA500",color:"#000000"},L:{background:"#FFA500",color:"#000000"},K:{background:"#FF0000",color:"#FFFFFF"},M:{background:"#FFA500",color:"#000000"},F:{background:"#FFA500",color:"#000000"},P:{background:"#800080",color:"#FFFFFF"},S:{background:"#00FF00",color:"#000000"},T:{background:"#00FF00",color:"#000000"},W:{background:"#FFA500",color:"#000000"},Y:{background:"#FFA500",color:"#000000"},V:{background:"#FFA500",color:"#000000"},B:{background:"#FFA500",color:"#000000"},Z:{background:"#FFA500",color:"#000000"},X:{background:"#FFA500",color:"#000000"},"-":{background:"#FFFFFF",color:"#000000"}};let QX=(()=>{class e{constructor(){this.selected$=new Ao(void 0)}set selected(n){this.selected$.next(n)}get selected(){return this.selected$.value}onMouseDown(n,r){this.selected=this.selected?void 0:{start:r,end:r,type:"range"}}onMouseEnter(n,r){1===n.buttons&&this.selected&&(this.selected={...this.selected,end:r})}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),V2e=(()=>{class e{set positions(n){this.input$.next(n)}get positions(){return this.input$.value}constructor(n){this.selectionService=n,this.input$=new Ao([])}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(QX))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();function _Dt(e,t){if(1&e){const n=C4();br(0,"div",4),Fx("mouseenter",function(i){const o=Sh(n).$index,s=Pu();return qf(s.onMouseEnter(i,s.index[o]))})("mousedown",function(i){const o=Sh(n).$index,s=Pu();return qf(s.onMouseDown(i,s.index[o]))})("mouseup",function(i){return Sh(n),qf(Pu().onMouseUp(i))}),Li(1),Sr()}if(2&e){const n=t.$implicit,r=t.$index,i=Pu();xT("background",null==n?null:n.background)("color",null==n?null:n.color),R0("id","index-residue-"+r),Yc(),UC(" ",i.index[r]," ")}}function SDt(e,t){if(1&e){const n=C4();br(0,"div",5),Fx("mouseenter",function(i){const o=Sh(n).$index,s=Pu();return qf(s.onMouseEnter(i,s.index[o]))})("mousedown",function(i){const o=Sh(n).$index,s=Pu();return qf(s.onMouseDown(i,s.index[o]))})("mouseup",function(i){return Sh(n),qf(Pu().onMouseUp(i))}),Li(1),Sr()}if(2&e){const n=t.$implicit,r=t.$index,i=Pu();xT("background",i.colors[n].background||i.colors["-"].background)("color",i.colors[n].color||i.colors["-"].color),R0("id","sequence-residue-"+r),Yc(),UC(" ",n," ")}}let CDt=(()=>{class e{set positions(n){this.positionsService.positions=n}get positions(){return this.positionsService.positions}constructor(n,r){this.positionsService=n,this.selectionService=r,this.selected$=this.selectionService.selected$,this.positions$=this.selectionService.selected$.pipe(hn(i=>({...i,background:"#FFFFFF",color:"#000000"})),WT(void 0),z0(this.positionsService.input$),hn(([i,o])=>{o=[...o];const s=new Map(this.index.map((c,u)=>[c,u])),a=i?.start,l=i?.end;if(null!=a&&null!=l){let c=s.get(a),u=s.get(l);c>u&&([c,u]=[u,c]),o.splice(c,u-c+1,...Array(u-c+1).fill(i))}return o}),ff(1))}ngOnChanges(n){if(n){if(n.sequence||n.index){if("string"==typeof this.sequence){if(!this.description&&">"===this.sequence[0]){const[s,...a]=this.sequence.split("\n");this.description=s,this.sequence=a.join("\n")}this.sequence=this.sequence.replace(/[\n\r\s\t]+/g,"").split("")}this.index||(this.index=Array.from({length:this.sequence.length},(s,a)=>a+1))}this.colors||(this.colors=z2e);const r=new Map(this.index.map((s,a)=>[s,a])),i=new Array(this.index.length).fill(void 0),o=(this.loci||[]).map(({start:s,end:a,type:l,background:c,color:u})=>{const d=r.get(s),f=void 0!==a?r.get(a):s,p={start:d,end:f,type:l,background:c,color:u};for(let m=d;m<=f;m++)i[m]=p;return p});o.sort((s,a)=>s.start-a.start||(s.end||0)-(a.end||0)),this.loci=o,this.positions=i}}onMouseUp(n){}onMouseDown(n,r){this.selectionService.onMouseDown(n,r)}onMouseEnter(n,r){this.selectionService.onMouseEnter(n,r)}static#e=this.\u0275fac=function(r){return new(r||e)(On(V2e),On(QX))};static#t=this.\u0275cmp=$d({type:e,selectors:[["ngx-sequence-viewer"]],inputs:{loci:"loci",index:"index",sequence:"sequence",colors:"colors",description:"description"},outputs:{selected$:"selected"},standalone:!0,features:[NT([V2e,QX]),Oo,Dh],decls:7,vars:2,consts:[[1,"index"],[1,"index-residue",3,"id","background","color"],[1,"sequence"],[1,"sequence-residue",3,"id","background","color"],[1,"index-residue",3,"mouseenter","mousedown","mouseup","id"],[1,"sequence-residue",3,"mouseenter","mousedown","mouseup","id"]],template:function(r,i){1&r&&(br(0,"div",0),wT(1,_Dt,2,6,"div",1,CT),Ox(3,"async"),Sr(),br(4,"div",2),wT(5,SDt,2,6,"div",3,CT),Sr()),2&r&&(Yc(),AT(Bx(3,0,i.positions$)),Yc(4),AT(i.sequence))},dependencies:[L0,iR],styles:["[_nghost-%COMP%]{cursor:default;-webkit-user-select:none;user-select:none}[_nghost-%COMP%]   .sequence[_ngcontent-%COMP%], [_nghost-%COMP%]   .index[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:flex-start;align-items:stretch}[_nghost-%COMP%]   .sequence[_ngcontent-%COMP%] > div[_ngcontent-%COMP%], [_nghost-%COMP%]   .index[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:0 0 auto;display:block;height:1rem;width:1rem;text-align:center;font-size:inherit;line-height:1rem}[_nghost-%COMP%]   .sequence[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{text-align:center;vertical-align:center}[_nghost-%COMP%]   .index[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{height:auto;text-align:left;transform:rotate(-180deg);writing-mode:vertical-rl;white-space:nowrap;padding-bottom:.25rem;padding-top:.25rem}"]})}return e})();function wDt(e,t){if(1&e&&js(0,"ngx-sequence-viewer",6),2&e){const n=Pu();R0("sequence",n.sequence)("index",n.index)("loci",n.loci)("colors",n.colors)}}let ADt=(()=>{class e{constructor(n,r){this.structureService=n,this.location=r,this.loci=[{start:"12",end:"43",type:"range",background:"#007A78",color:"#FFC745"},{start:"57",end:"58",type:"range",background:"#BDE673",color:"#000000"}],this.colors=z2e,this.structure$=this.structureService.structure$,this._structure=this.structure$.subscribe(()=>{this.sequence=this.structureService.residues.map(({authCompId1:o})=>o),this.index=this.structureService.residues.map(({authSeqId:o,pdbInsCode:s})=>o+s)});const i=this.location.prepareExternalUrl("assets/8vap.A.cif");this.source=this.structureService.source={type:"remote",label:"8VAP",binary:!1,format:"mmcif",link:i}}ngOnDestroy(){this._structure.unsubscribe()}static#e=this.\u0275fac=function(r){return new(r||e)(On(vI),On(qC))};static#t=this.\u0275cmp=$d({type:e,selectors:[["app-page-sequence-viewer"]],standalone:!0,features:[NT([vI]),Dh],decls:17,vars:6,consts:[[1,"container","pt-3"],[1,"row"],[1,"col-7"],[1,"col-5"],[1,"rounded","bg-body-tertiary","p-3"],["id","sequence-viewer-structure",1,"d-block","rounded","border","w-100","h-auto",2,"overflow-x","auto","overflow-y","hidden"],[3,"sequence","index","loci","colors"]],template:function(r,i){1&r&&(br(0,"div",0)(1,"h1"),Li(2,"Sequence viewer"),Sr(),br(3,"div")(4,"h2"),Li(5,"Visualize structure"),Sr(),br(6,"div",1)(7,"div",2),Li(8," In this example, the sequence underlying the PDB structure `1BRR`, chain `A` is shown. The colouring scheme chosen is based on the structural characteristics of the amino acids. "),Sr(),br(9,"div",3)(10,"code")(11,"pre",4),Li(12),Ox(13,"json"),Sr()()()(),br(14,"div",5),Ym(15,wDt,1,4,"ngx-sequence-viewer",6),Ox(16,"async"),Sr()()()),2&r&&(Yc(12),T4(Bx(13,2,i.source)),Yc(3),ST(15,Bx(16,4,i.structure$)?15:-1))},dependencies:[L0,iR,_j,CDt]})}return e})(),H2e=(()=>{class e{constructor(n){this.templateRef=n}static#e=this.\u0275fac=function(r){return new(r||e)(On(qm))};static#t=this.\u0275dir=Ja({type:e,selectors:[["","ngx-features-viewer-label",""]],standalone:!0})}return e})();function IDt(e){return e}function EDt(e){return"translate("+e+",0)"}function TDt(e){return"translate(0,"+e+")"}function DDt(e){return t=>+e(t)}function PDt(e,t){return t=Math.max(0,e.bandwidth()-2*t)/2,e.round()&&(t=Math.round(t)),n=>+e(n)+t}function kDt(){return!this.__axis}function IB(e,t){var n=[],r=null,i=null,o=6,s=6,a=3,l=typeof window<"u"&&window.devicePixelRatio>1?0:.5,c=1===e||4===e?-1:1,u=4===e||2===e?"x":"y",d=1===e||3===e?EDt:TDt;function f(p){var m=r??(t.ticks?t.ticks.apply(t,n):t.domain()),h=i??(t.tickFormat?t.tickFormat.apply(t,n):IDt),g=Math.max(o,0)+a,y=t.range(),v=+y[0]+l,x=+y[y.length-1]+l,_=(t.bandwidth?PDt:DDt)(t.copy(),l),w=p.selection?p.selection():p,A=w.selectAll(".domain").data([null]),M=w.selectAll(".tick").data(m,t).order(),E=M.exit(),D=M.enter().append("g").attr("class","tick"),T=M.select("line"),F=M.select("text");A=A.merge(A.enter().insert("path",".tick").attr("class","domain").attr("stroke","currentColor")),M=M.merge(D),T=T.merge(D.append("line").attr("stroke","currentColor").attr(u+"2",c*o)),F=F.merge(D.append("text").attr("fill","currentColor").attr(u,c*g).attr("dy",1===e?"0em":3===e?"0.71em":"0.32em")),p!==w&&(A=A.transition(p),M=M.transition(p),T=T.transition(p),F=F.transition(p),E=E.transition(p).attr("opacity",1e-6).attr("transform",function(R){return isFinite(R=_(R))?d(R+l):this.getAttribute("transform")}),D.attr("opacity",1e-6).attr("transform",function(R){var N=this.parentNode.__axis;return d((N&&isFinite(N=N(R))?N:_(R))+l)})),E.remove(),A.attr("d",4===e||2===e?s?"M"+c*s+","+v+"H"+l+"V"+x+"H"+c*s:"M"+l+","+v+"V"+x:s?"M"+v+","+c*s+"V"+l+"H"+x+"V"+c*s:"M"+v+","+l+"H"+x),M.attr("opacity",1).attr("transform",function(R){return d(_(R)+l)}),T.attr(u+"2",c*o),F.attr(u,c*g).text(h),w.filter(kDt).attr("fill","none").attr("font-size",10).attr("font-family","sans-serif").attr("text-anchor",2===e?"start":4===e?"end":"middle"),w.each(function(){this.__axis=_})}return f.scale=function(p){return arguments.length?(t=p,f):t},f.ticks=function(){return n=Array.from(arguments),f},f.tickArguments=function(p){return arguments.length?(n=null==p?[]:Array.from(p),f):n.slice()},f.tickValues=function(p){return arguments.length?(r=null==p?null:Array.from(p),f):r&&r.slice()},f.tickFormat=function(p){return arguments.length?(i=p,f):i},f.tickSize=function(p){return arguments.length?(o=s=+p,f):o},f.tickSizeInner=function(p){return arguments.length?(o=+p,f):o},f.tickSizeOuter=function(p){return arguments.length?(s=+p,f):s},f.tickPadding=function(p){return arguments.length?(a=+p,f):a},f.offset=function(p){return arguments.length?(l=+p,f):l},f}function RDt(){}function eK(e){return null==e?RDt:function(){return this.querySelector(e)}}function ODt(){return[]}function q2e(e){return null==e?ODt:function(){return this.querySelectorAll(e)}}function W2e(e){return function(){return this.matches(e)}}function $2e(e){return function(t){return t.matches(e)}}var jDt=Array.prototype.find;function zDt(){return this.firstElementChild}var HDt=Array.prototype.filter;function GDt(){return Array.from(this.children)}function Y2e(e){return new Array(e.length)}function EB(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function KDt(e,t,n,r,i,o){for(var a,s=0,l=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],r[s]=a):n[s]=new EB(e,o[s]);for(;s<l;++s)(a=t[s])&&(i[s]=a)}function ZDt(e,t,n,r,i,o,s){var a,l,p,c=new Map,u=t.length,d=o.length,f=new Array(u);for(a=0;a<u;++a)(l=t[a])&&(f[a]=p=s.call(l,l.__data__,a,t)+"",c.has(p)?i[a]=l:c.set(p,l));for(a=0;a<d;++a)p=s.call(e,o[a],a,o)+"",(l=c.get(p))?(r[a]=l,l.__data__=o[a],c.delete(p)):n[a]=new EB(e,o[a]);for(a=0;a<u;++a)(l=t[a])&&c.get(f[a])===l&&(i[a]=l)}function QDt(e){return e.__data__}function ePt(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function sPt(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}EB.prototype={constructor:EB,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};var tK="http://www.w3.org/1999/xhtml";const X2e={svg:"http://www.w3.org/2000/svg",xhtml:tK,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function TB(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),X2e.hasOwnProperty(t)?{space:X2e[t],local:e}:e}function pPt(e){return function(){this.removeAttribute(e)}}function hPt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function mPt(e,t){return function(){this.setAttribute(e,t)}}function gPt(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function yPt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function bPt(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function K2e(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function xPt(e){return function(){this.style.removeProperty(e)}}function _Pt(e,t,n){return function(){this.style.setProperty(e,t,n)}}function SPt(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function II(e,t){return e.style.getPropertyValue(t)||K2e(e).getComputedStyle(e,null).getPropertyValue(t)}function wPt(e){return function(){delete this[e]}}function APt(e,t){return function(){this[e]=t}}function IPt(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function Z2e(e){return e.trim().split(/^|\s+/)}function nK(e){return e.classList||new Q2e(e)}function Q2e(e){this._node=e,this._names=Z2e(e.getAttribute("class")||"")}function J2e(e,t){for(var n=nK(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function eSe(e,t){for(var n=nK(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function TPt(e){return function(){J2e(this,e)}}function DPt(e){return function(){eSe(this,e)}}function PPt(e,t){return function(){(t.apply(this,arguments)?J2e:eSe)(this,e)}}function MPt(){this.textContent=""}function RPt(e){return function(){this.textContent=e}}function NPt(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function OPt(){this.innerHTML=""}function BPt(e){return function(){this.innerHTML=e}}function LPt(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function UPt(){this.nextSibling&&this.parentNode.appendChild(this)}function VPt(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function GPt(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===tK&&t.documentElement.namespaceURI===tK?t.createElement(e):t.createElementNS(n,e)}}function qPt(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function rK(e){var t=TB(e);return(t.local?qPt:GPt)(t)}function $Pt(){return null}function XPt(){var e=this.parentNode;e&&e.removeChild(this)}function ZPt(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function QPt(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function rkt(e){return function(){var t=this.__on;if(t){for(var o,n=0,r=-1,i=t.length;n<i;++n)o=t[n],e.type&&o.type!==e.type||o.name!==e.name?t[++r]=o:this.removeEventListener(o.type,o.listener,o.options);++r?t.length=r:delete this.__on}}}function ikt(e,t,n){return function(){var i,r=this.__on,o=function tkt(e){return function(t){e.call(this,t,this.__data__)}}(t);if(r)for(var s=0,a=r.length;s<a;++s)if((i=r[s]).type===e.type&&i.name===e.name)return this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=n),void(i.value=t);this.addEventListener(e.type,o,n),i={type:e.type,name:e.name,value:t,listener:o,options:n},r?r.push(i):this.__on=[i]}}function tSe(e,t,n){var r=K2e(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function skt(e,t){return function(){return tSe(this,e,t)}}function akt(e,t){return function(){return tSe(this,e,t.apply(this,arguments))}}Q2e.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var nSe=[null];function Uf(e,t){this._groups=e,this._parents=t}function rSe(){return new Uf([[document.documentElement]],nSe)}Uf.prototype=rSe.prototype={constructor:Uf,select:function NDt(e){"function"!=typeof e&&(e=eK(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var l,c,o=t[i],s=o.length,a=r[i]=new Array(s),u=0;u<s;++u)(l=o[u])&&(c=e.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new Uf(r,this._parents)},selectAll:function LDt(e){e="function"==typeof e?function BDt(e){return function(){return function FDt(e){return null==e?[]:Array.isArray(e)?e:Array.from(e)}(e.apply(this,arguments))}}(e):q2e(e);for(var t=this._groups,n=t.length,r=[],i=[],o=0;o<n;++o)for(var l,s=t[o],a=s.length,c=0;c<a;++c)(l=s[c])&&(r.push(e.call(l,l.__data__,c,s)),i.push(l));return new Uf(r,i)},selectChild:function VDt(e){return this.select(null==e?zDt:function UDt(e){return function(){return jDt.call(this.children,e)}}("function"==typeof e?e:$2e(e)))},selectChildren:function WDt(e){return this.selectAll(null==e?GDt:function qDt(e){return function(){return HDt.call(this.children,e)}}("function"==typeof e?e:$2e(e)))},filter:function $Dt(e){"function"!=typeof e&&(e=W2e(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var l,o=t[i],s=o.length,a=r[i]=[],c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new Uf(r,this._parents)},data:function JDt(e,t){if(!arguments.length)return Array.from(this,QDt);var n=t?ZDt:KDt,r=this._parents,i=this._groups;"function"!=typeof e&&(e=function XDt(e){return function(){return e}}(e));for(var o=i.length,s=new Array(o),a=new Array(o),l=new Array(o),c=0;c<o;++c){var u=r[c],d=i[c],f=d.length,p=ePt(e.call(u,u&&u.__data__,c,r)),m=p.length,h=a[c]=new Array(m),g=s[c]=new Array(m);n(u,d,h,g,l[c]=new Array(f),p,t);for(var _,w,v=0,x=0;v<m;++v)if(_=h[v]){for(v>=x&&(x=v+1);!(w=g[x])&&++x<m;);_._next=w||null}}return(s=new Uf(s,r))._enter=a,s._exit=l,s},enter:function YDt(){return new Uf(this._enter||this._groups.map(Y2e),this._parents)},exit:function tPt(){return new Uf(this._exit||this._groups.map(Y2e),this._parents)},join:function nPt(e,t,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function rPt(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,s=Math.min(i,r.length),a=new Array(i),l=0;l<s;++l)for(var p,c=n[l],u=r[l],d=c.length,f=a[l]=new Array(d),m=0;m<d;++m)(p=c[m]||u[m])&&(f[m]=p);for(;l<i;++l)a[l]=n[l];return new Uf(a,this._parents)},selection:function ukt(){return this},order:function iPt(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var s,r=e[t],i=r.length-1,o=r[i];--i>=0;)(s=r[i])&&(o&&4^s.compareDocumentPosition(o)&&o.parentNode.insertBefore(s,o),o=s);return this},sort:function oPt(e){function t(d,f){return d&&f?e(d.__data__,f.__data__):!d-!f}e||(e=sPt);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var c,s=n[o],a=s.length,l=i[o]=new Array(a),u=0;u<a;++u)(c=s[u])&&(l[u]=c);l.sort(t)}return new Uf(i,this._parents).order()},call:function aPt(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function lPt(){return Array.from(this)},node:function cPt(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length;i<o;++i){var s=r[i];if(s)return s}return null},size:function uPt(){let e=0;for(const t of this)++e;return e},empty:function dPt(){return!this.node()},each:function fPt(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var a,i=t[n],o=0,s=i.length;o<s;++o)(a=i[o])&&e.call(a,a.__data__,o,i);return this},attr:function vPt(e,t){var n=TB(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?hPt:pPt:"function"==typeof t?n.local?bPt:yPt:n.local?gPt:mPt)(n,t))},style:function CPt(e,t,n){return arguments.length>1?this.each((null==t?xPt:"function"==typeof t?SPt:_Pt)(e,t,n??"")):II(this.node(),e)},property:function EPt(e,t){return arguments.length>1?this.each((null==t?wPt:"function"==typeof t?IPt:APt)(e,t)):this.node()[e]},classed:function kPt(e,t){var n=Z2e(e+"");if(arguments.length<2){for(var r=nK(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?PPt:t?TPt:DPt)(n,t))},text:function FPt(e){return arguments.length?this.each(null==e?MPt:("function"==typeof e?NPt:RPt)(e)):this.node().textContent},html:function jPt(e){return arguments.length?this.each(null==e?OPt:("function"==typeof e?LPt:BPt)(e)):this.node().innerHTML},raise:function zPt(){return this.each(UPt)},lower:function HPt(){return this.each(VPt)},append:function WPt(e){var t="function"==typeof e?e:rK(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})},insert:function YPt(e,t){var n="function"==typeof e?e:rK(e),r=null==t?$Pt:"function"==typeof t?t:eK(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})},remove:function KPt(){return this.each(XPt)},clone:function JPt(e){return this.select(e?QPt:ZPt)},datum:function ekt(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function okt(e,t,n){var i,s,r=function nkt(e){return e.trim().split(/^|\s+/).map(function(t){var n="",r=t.indexOf(".");return r>=0&&(n=t.slice(r+1),t=t.slice(0,r)),{type:t,name:n}})}(e+""),o=r.length;if(!(arguments.length<2)){for(a=t?ikt:rkt,i=0;i<o;++i)this.each(a(r[i],t,n));return this}var a=this.node().__on;if(a)for(var u,l=0,c=a.length;l<c;++l)for(i=0,u=a[l];i<o;++i)if((s=r[i]).type===u.type&&s.name===u.name)return u.value},dispatch:function lkt(e,t){return this.each(("function"==typeof t?akt:skt)(e,t))},[Symbol.iterator]:function*ckt(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var s,r=e[t],i=0,o=r.length;i<o;++i)(s=r[i])&&(yield s)}};const uk=rSe;var dkt={value:()=>{}};function iSe(){for(var r,e=0,t=arguments.length,n={};e<t;++e){if(!(r=arguments[e]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new DB(n)}function DB(e){this._=e}function pkt(e,t){for(var i,n=0,r=e.length;n<r;++n)if((i=e[n]).name===t)return i.value}function oSe(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=dkt,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}DB.prototype=iSe.prototype={constructor:DB,on:function(e,t){var i,n=this._,r=function fkt(e,t){return e.trim().split(/^|\s+/).map(function(n){var r="",i=n.indexOf(".");if(i>=0&&(r=n.slice(i+1),n=n.slice(0,i)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}(e+"",n),o=-1,s=r.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++o<s;)if(i=(e=r[o]).type)n[i]=oSe(n[i],e.name,t);else if(null==t)for(i in n)n[i]=oSe(n[i],e.name,null);return this}for(;++o<s;)if((i=(e=r[o]).type)&&(i=pkt(n[i],e.name)))return i},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new DB(e)},call:function(e,t){if((i=arguments.length-2)>0)for(var i,o,n=new Array(i),r=0;r<i;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(r=0,i=(o=this._[e]).length;r<i;++r)o[r].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};const sSe=iSe;var PB,pk,EI=0,dk=0,fk=0,aSe=1e3,kB=0,O2=0,MB=0,hk="object"==typeof performance&&performance.now?performance:Date,lSe="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function iK(){return O2||(lSe(hkt),O2=hk.now()+MB)}function hkt(){O2=0}function RB(){this._call=this._time=this._next=null}function cSe(e,t,n){var r=new RB;return r.restart(e,t,n),r}function uSe(){O2=(kB=hk.now())+MB,EI=dk=0;try{!function mkt(){iK(),++EI;for(var t,e=PB;e;)(t=O2-e._time)>=0&&e._call.call(void 0,t),e=e._next;--EI}()}finally{EI=0,function ykt(){for(var e,n,t=PB,r=1/0;t;)t._call?(r>t._time&&(r=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:PB=n);pk=e,oK(r)}(),O2=0}}function gkt(){var e=hk.now(),t=e-kB;t>aSe&&(MB-=t,kB=e)}function oK(e){EI||(dk&&(dk=clearTimeout(dk)),e-O2>24?(e<1/0&&(dk=setTimeout(uSe,e-hk.now()-MB)),fk&&(fk=clearInterval(fk))):(fk||(kB=hk.now(),fk=setInterval(gkt,aSe)),EI=1,lSe(uSe)))}function dSe(e,t,n){var r=new RB;return r.restart(i=>{r.stop(),e(i+t)},t=null==t?0:+t,n),r}RB.prototype=cSe.prototype={constructor:RB,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?iK():+n)+(null==t?0:+t),!this._next&&pk!==this&&(pk?pk._next=this:PB=this,pk=this),this._call=e,this._time=n,oK()},stop:function(){this._call&&(this._call=null,this._time=1/0,oK())}};var bkt=sSe("start","end","cancel","interrupt"),vkt=[],fSe=0,sK=2,NB=3,aK=5,FB=6;function OB(e,t,n,r,i,o){var s=e.__transition;if(s){if(n in s)return}else e.__transition={};!function xkt(e,t,n){var i,r=e.__transition;function s(c){var u,d,f,p;if(1!==n.state)return l();for(u in r)if((p=r[u]).name===n.name){if(p.state===NB)return dSe(s);4===p.state?(p.state=FB,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete r[u]):+u<t&&(p.state=FB,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete r[u])}if(dSe(function(){n.state===NB&&(n.state=4,n.timer.restart(a,n.delay,n.time),a(c))}),n.state=sK,n.on.call("start",e,e.__data__,n.index,n.group),n.state===sK){for(n.state=NB,i=new Array(f=n.tween.length),u=0,d=-1;u<f;++u)(p=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(i[++d]=p);i.length=d+1}}function a(c){for(var u=c<n.duration?n.ease.call(null,c/n.duration):(n.timer.restart(l),n.state=aK,1),d=-1,f=i.length;++d<f;)i[d].call(e,u);n.state===aK&&(n.on.call("end",e,e.__data__,n.index,n.group),l())}function l(){for(var c in n.state=FB,n.timer.stop(),delete r[t],r)return;delete e.__transition}r[t]=n,n.timer=cSe(function o(c){n.state=1,n.timer.restart(s,n.delay,n.time),n.delay<=c&&s(c-n.delay)},0,n.time)}(e,n,{name:t,index:r,group:i,on:bkt,tween:vkt,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:fSe})}function lK(e,t){var n=gm(e,t);if(n.state>fSe)throw new Error("too late; already scheduled");return n}function Zg(e,t){var n=gm(e,t);if(n.state>NB)throw new Error("too late; already running");return n}function gm(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function BB(e,t){var r,i,s,n=e.__transition,o=!0;if(n){for(s in t=null==t?null:t+"",n)(r=n[s]).name===t?(i=r.state>sK&&r.state<aK,r.state=FB,r.timer.stop(),r.on.call(i?"interrupt":"cancel",e,e.__data__,r.index,r.group),delete n[s]):o=!1;o&&delete e.__transition}}function ym(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}var LB,mSe=180/Math.PI,cK={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function gSe(e,t,n,r,i,o){var s,a,l;return(s=Math.sqrt(e*e+t*t))&&(e/=s,t/=s),(l=e*n+t*r)&&(n-=e*l,r-=t*l),(a=Math.sqrt(n*n+r*r))&&(n/=a,r/=a,l/=a),e*r<t*n&&(e=-e,t=-t,l=-l,s=-s),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*mSe,skewX:Math.atan(l)*mSe,scaleX:s,scaleY:a}}function ySe(e,t,n,r){function i(c){return c.length?c.pop()+" ":""}return function(c,u){var d=[],f=[];return c=e(c),u=e(u),function o(c,u,d,f,p,m){if(c!==d||u!==f){var h=p.push("translate(",null,t,null,n);m.push({i:h-4,x:ym(c,d)},{i:h-2,x:ym(u,f)})}else(d||f)&&p.push("translate("+d+t+f+n)}(c.translateX,c.translateY,u.translateX,u.translateY,d,f),function s(c,u,d,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:d.push(i(d)+"rotate(",null,r)-2,x:ym(c,u)})):u&&d.push(i(d)+"rotate("+u+r)}(c.rotate,u.rotate,d,f),function a(c,u,d,f){c!==u?f.push({i:d.push(i(d)+"skewX(",null,r)-2,x:ym(c,u)}):u&&d.push(i(d)+"skewX("+u+r)}(c.skewX,u.skewX,d,f),function l(c,u,d,f,p,m){if(c!==d||u!==f){var h=p.push(i(p)+"scale(",null,",",null,")");m.push({i:h-4,x:ym(c,d)},{i:h-2,x:ym(u,f)})}else(1!==d||1!==f)&&p.push(i(p)+"scale("+d+","+f+")")}(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,f),c=u=null,function(p){for(var g,m=-1,h=f.length;++m<h;)d[(g=f[m]).i]=g.x(p);return d.join("")}}}var wkt=ySe(function Skt(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?cK:gSe(t.a,t.b,t.c,t.d,t.e,t.f)},"px, ","px)","deg)"),Akt=ySe(function Ckt(e){return null!=e&&(LB||(LB=document.createElementNS("http://www.w3.org/2000/svg","g")),LB.setAttribute("transform",e),e=LB.transform.baseVal.consolidate())?gSe((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):cK},", ",")",")");function Ikt(e,t){var n,r;return function(){var i=Zg(this,e),o=i.tween;if(o!==n)for(var s=0,a=(r=n=o).length;s<a;++s)if(r[s].name===t){(r=r.slice()).splice(s,1);break}i.tween=r}}function Ekt(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Zg(this,e),s=o.tween;if(s!==r){i=(r=s).slice();for(var a={name:t,value:n},l=0,c=i.length;l<c;++l)if(i[l].name===t){i[l]=a;break}l===c&&i.push(a)}o.tween=i}}function uK(e,t,n){var r=e._id;return e.each(function(){var i=Zg(this,r);(i.value||(i.value={}))[t]=n.apply(this,arguments)}),function(i){return gm(i,r).value[t]}}function dK(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function bSe(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function mk(){}var jB=1/.7,TI="\\s*([+-]?\\d+)\\s*",yk="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Qg="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Dkt=/^#([0-9a-f]{3,8})$/,Pkt=new RegExp(`^rgb\\(${TI},${TI},${TI}\\)$`),kkt=new RegExp(`^rgb\\(${Qg},${Qg},${Qg}\\)$`),Mkt=new RegExp(`^rgba\\(${TI},${TI},${TI},${yk}\\)$`),Rkt=new RegExp(`^rgba\\(${Qg},${Qg},${Qg},${yk}\\)$`),Nkt=new RegExp(`^hsl\\(${yk},${Qg},${Qg}\\)$`),Fkt=new RegExp(`^hsla\\(${yk},${Qg},${Qg},${yk}\\)$`),vSe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function xSe(){return this.rgb().formatHex()}function _Se(){return this.rgb().formatRgb()}function B2(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Dkt.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?SSe(t):3===n?new Hd(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?UB(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?UB(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Pkt.exec(e))?new Hd(t[1],t[2],t[3],1):(t=kkt.exec(e))?new Hd(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Mkt.exec(e))?UB(t[1],t[2],t[3],t[4]):(t=Rkt.exec(e))?UB(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Nkt.exec(e))?ASe(t[1],t[2]/100,t[3]/100,1):(t=Fkt.exec(e))?ASe(t[1],t[2]/100,t[3]/100,t[4]):vSe.hasOwnProperty(e)?SSe(vSe[e]):"transparent"===e?new Hd(NaN,NaN,NaN,0):null}function SSe(e){return new Hd(e>>16&255,e>>8&255,255&e,1)}function UB(e,t,n,r){return r<=0&&(e=t=n=NaN),new Hd(e,t,n,r)}function zB(e,t,n,r){return 1===arguments.length?function Lkt(e){return e instanceof mk||(e=B2(e)),e?new Hd((e=e.rgb()).r,e.g,e.b,e.opacity):new Hd}(e):new Hd(e,t,n,r??1)}function Hd(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function CSe(){return`#${j2(this.r)}${j2(this.g)}${j2(this.b)}`}function wSe(){const e=VB(this.opacity);return`${1===e?"rgb(":"rgba("}${L2(this.r)}, ${L2(this.g)}, ${L2(this.b)}${1===e?")":`, ${e})`}`}function VB(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function L2(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function j2(e){return((e=L2(e))<16?"0":"")+e.toString(16)}function ASe(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new bm(e,t,n,r)}function ISe(e){if(e instanceof bm)return new bm(e.h,e.s,e.l,e.opacity);if(e instanceof mk||(e=B2(e)),!e)return new bm;if(e instanceof bm)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),s=NaN,a=o-i,l=(o+i)/2;return a?(s=t===o?(n-r)/a+6*(n<r):n===o?(r-t)/a+2:(t-n)/a+4,a/=l<.5?o+i:2-o-i,s*=60):a=l>0&&l<1?0:s,new bm(s,a,l,e.opacity)}function bm(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function ESe(e){return(e=(e||0)%360)<0?e+360:e}function HB(e){return Math.max(0,Math.min(1,e||0))}function fK(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}function TSe(e,t,n,r,i){var o=e*e,s=o*e;return((1-3*e+3*o-s)*t+(4-6*o+3*s)*n+(1+3*e+3*o-3*s)*r+s*i)/6}dK(mk,B2,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:xSe,formatHex:xSe,formatHex8:function Okt(){return this.rgb().formatHex8()},formatHsl:function Bkt(){return ISe(this).formatHsl()},formatRgb:_Se,toString:_Se}),dK(Hd,zB,bSe(mk,{brighter(e){return e=null==e?jB:Math.pow(jB,e),new Hd(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new Hd(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Hd(L2(this.r),L2(this.g),L2(this.b),VB(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:CSe,formatHex:CSe,formatHex8:function jkt(){return`#${j2(this.r)}${j2(this.g)}${j2(this.b)}${j2(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:wSe,toString:wSe})),dK(bm,function Ukt(e,t,n,r){return 1===arguments.length?ISe(e):new bm(e,t,n,r??1)},bSe(mk,{brighter(e){return e=null==e?jB:Math.pow(jB,e),new bm(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?.7:Math.pow(.7,e),new bm(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new Hd(fK(e>=240?e-240:e+120,i,r),fK(e,i,r),fK(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new bm(ESe(this.h),HB(this.s),HB(this.l),VB(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=VB(this.opacity);return`${1===e?"hsl(":"hsla("}${ESe(this.h)}, ${100*HB(this.s)}%, ${100*HB(this.l)}%${1===e?")":`, ${e})`}`}}));const pK=e=>()=>e;function PSe(e,t){var n=t-e;return n?function DSe(e,t){return function(n){return e+n*t}}(e,n):pK(isNaN(e)?t:e)}const GB=function e(t){var n=function Gkt(e){return 1==(e=+e)?PSe:function(t,n){return n-t?function Hkt(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):pK(isNaN(t)?n:t)}}(t);function r(i,o){var s=n((i=zB(i)).r,(o=zB(o)).r),a=n(i.g,o.g),l=n(i.b,o.b),c=PSe(i.opacity,o.opacity);return function(u){return i.r=s(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return r.gamma=e,r}(1);function kSe(e){return function(t){var s,a,n=t.length,r=new Array(n),i=new Array(n),o=new Array(n);for(s=0;s<n;++s)a=zB(t[s]),r[s]=a.r||0,i[s]=a.g||0,o[s]=a.b||0;return r=e(r),i=e(i),o=e(o),a.opacity=1,function(l){return a.r=r(l),a.g=i(l),a.b=o(l),a+""}}}kSe(function zkt(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1];return TSe((n-r/t)*t,r>0?e[r-1]:2*i-o,i,o,r<t-1?e[r+2]:2*o-i)}}),kSe(function Vkt(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t);return TSe((n-r/t)*t,e[(r+t-1)%t],e[r%t],e[(r+1)%t],e[(r+2)%t])}});var hK=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,mK=new RegExp(hK.source,"g");function MSe(e,t){var r,i,o,n=hK.lastIndex=mK.lastIndex=0,s=-1,a=[],l=[];for(e+="",t+="";(r=hK.exec(e))&&(i=mK.exec(t));)(o=i.index)>n&&(o=t.slice(n,o),a[s]?a[s]+=o:a[++s]=o),(r=r[0])===(i=i[0])?a[s]?a[s]+=i:a[++s]=i:(a[++s]=null,l.push({i:s,x:ym(r,i)})),n=mK.lastIndex;return n<t.length&&(o=t.slice(n),a[s]?a[s]+=o:a[++s]=o),a.length<2?l[0]?function Wkt(e){return function(t){return e(t)+""}}(l[0].x):function qkt(e){return function(){return e}}(t):(t=l.length,function(c){for(var d,u=0;u<t;++u)a[(d=l[u]).i]=d.x(c);return a.join("")})}function RSe(e,t){var n;return("number"==typeof t?ym:t instanceof B2?GB:(n=B2(t))?(t=n,GB):MSe)(e,t)}function $kt(e){return function(){this.removeAttribute(e)}}function Ykt(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Xkt(e,t,n){var r,o,i=n+"";return function(){var s=this.getAttribute(e);return s===i?null:s===r?o:o=t(r=s,n)}}function Kkt(e,t,n){var r,o,i=n+"";return function(){var s=this.getAttributeNS(e.space,e.local);return s===i?null:s===r?o:o=t(r=s,n)}}function Zkt(e,t,n){var r,i,o;return function(){var s,l,a=n(this);return null==a?void this.removeAttribute(e):(s=this.getAttribute(e))===(l=a+"")?null:s===r&&l===i?o:(i=l,o=t(r=s,a))}}function Qkt(e,t,n){var r,i,o;return function(){var s,l,a=n(this);return null==a?void this.removeAttributeNS(e.space,e.local):(s=this.getAttributeNS(e.space,e.local))===(l=a+"")?null:s===r&&l===i?o:(i=l,o=t(r=s,a))}}function nMt(e,t){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&function tMt(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,o)),n}return i._value=t,i}function rMt(e,t){var n,r;function i(){var o=t.apply(this,arguments);return o!==r&&(n=(r=o)&&function eMt(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,o)),n}return i._value=t,i}function oMt(e,t){return function(){lK(this,e).delay=+t.apply(this,arguments)}}function sMt(e,t){return t=+t,function(){lK(this,e).delay=t}}function lMt(e,t){return function(){Zg(this,e).duration=+t.apply(this,arguments)}}function cMt(e,t){return t=+t,function(){Zg(this,e).duration=t}}var wMt=uk.prototype.constructor;function NSe(e){return function(){this.style.removeProperty(e)}}var VMt=0;function ub(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function FSe(){return++VMt}var db=uk.prototype;ub.prototype=function HMt(e){return uk().transition(e)}.prototype={constructor:ub,select:function SMt(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=eK(e));for(var r=this._groups,i=r.length,o=new Array(i),s=0;s<i;++s)for(var u,d,a=r[s],l=a.length,c=o[s]=new Array(l),f=0;f<l;++f)(u=a[f])&&(d=e.call(u,u.__data__,f,a))&&("__data__"in u&&(d.__data__=u.__data__),c[f]=d,OB(c[f],t,n,f,c,gm(u,n)));return new ub(o,this._parents,t,n)},selectAll:function CMt(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=q2e(e));for(var r=this._groups,i=r.length,o=[],s=[],a=0;a<i;++a)for(var u,l=r[a],c=l.length,d=0;d<c;++d)if(u=l[d]){for(var p,f=e.call(u,u.__data__,d,l),m=gm(u,n),h=0,g=f.length;h<g;++h)(p=f[h])&&OB(p,t,n,h,f,m);o.push(f),s.push(u)}return new ub(o,s,t,n)},selectChild:db.selectChild,selectChildren:db.selectChildren,filter:function mMt(e){"function"!=typeof e&&(e=W2e(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var l,o=t[i],s=o.length,a=r[i]=[],c=0;c<s;++c)(l=o[c])&&e.call(l,l.__data__,c,o)&&a.push(l);return new ub(r,this._parents,this._name,this._id)},merge:function gMt(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,o=Math.min(r,n.length),s=new Array(r),a=0;a<o;++a)for(var f,l=t[a],c=n[a],u=l.length,d=s[a]=new Array(u),p=0;p<u;++p)(f=l[p]||c[p])&&(d[p]=f);for(;a<r;++a)s[a]=t[a];return new ub(s,this._parents,this._name,this._id)},selection:function AMt(){return new wMt(this._groups,this._parents)},transition:function UMt(){for(var e=this._name,t=this._id,n=FSe(),r=this._groups,i=r.length,o=0;o<i;++o)for(var l,s=r[o],a=s.length,c=0;c<a;++c)if(l=s[c]){var u=gm(l,t);OB(l,e,n,c,s,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ub(r,this._parents,e,n)},call:db.call,nodes:db.nodes,node:db.node,size:db.size,empty:db.empty,each:db.each,on:function vMt(e,t){var n=this._id;return arguments.length<2?gm(this.node(),n).on.on(e):this.each(function bMt(e,t,n){var r,i,o=function yMt(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||"start"===t})}(t)?lK:Zg;return function(){var s=o(this,e),a=s.on;a!==r&&(i=(r=a).copy()).on(t,n),s.on=i}}(n,e,t))},attr:function Jkt(e,t){var n=TB(e),r="transform"===n?Akt:RSe;return this.attrTween(e,"function"==typeof t?(n.local?Qkt:Zkt)(n,r,uK(this,"attr."+e,t)):null==t?(n.local?Ykt:$kt)(n):(n.local?Kkt:Xkt)(n,r,t))},attrTween:function iMt(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var r=TB(e);return this.tween(n,(r.local?nMt:rMt)(r,t))},style:function PMt(e,t,n){var r="transform"==(e+="")?wkt:RSe;return null==t?this.styleTween(e,function IMt(e,t){var n,r,i;return function(){var o=II(this,e),s=(this.style.removeProperty(e),II(this,e));return o===s?null:o===n&&s===r?i:i=t(n=o,r=s)}}(e,r)).on("end.style."+e,NSe(e)):"function"==typeof t?this.styleTween(e,function TMt(e,t,n){var r,i,o;return function(){var s=II(this,e),a=n(this),l=a+"";return null==a&&(this.style.removeProperty(e),l=a=II(this,e)),s===l?null:s===r&&l===i?o:(i=l,o=t(r=s,a))}}(e,r,uK(this,"style."+e,t))).each(function DMt(e,t){var n,r,i,a,o="style."+t,s="end."+o;return function(){var l=Zg(this,e),c=l.on,u=null==l.value[o]?a||(a=NSe(t)):void 0;(c!==n||i!==u)&&(r=(n=c).copy()).on(s,i=u),l.on=r}}(this._id,e)):this.styleTween(e,function EMt(e,t,n){var r,o,i=n+"";return function(){var s=II(this,e);return s===i?null:s===r?o:o=t(r=s,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function RMt(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function MMt(e,t,n){var r,i;function o(){var s=t.apply(this,arguments);return s!==i&&(r=(i=s)&&function kMt(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,s,n)),r}return o._value=t,o}(e,t,n??""))},text:function OMt(e){return this.tween("text","function"==typeof e?function FMt(e){return function(){var t=e(this);this.textContent=t??""}}(uK(this,"text",e)):function NMt(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function jMt(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function LMt(e){var t,n;function r(){var i=e.apply(this,arguments);return i!==n&&(t=(n=i)&&function BMt(e){return function(t){this.textContent=e.call(this,t)}}(i)),t}return r._value=e,r}(e))},remove:function _Mt(){return this.on("end.remove",function xMt(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function Tkt(e,t){var n=this._id;if(e+="",arguments.length<2){for(var s,r=gm(this.node(),n).tween,i=0,o=r.length;i<o;++i)if((s=r[i]).name===e)return s.value;return null}return this.each((null==t?Ikt:Ekt)(n,e,t))},delay:function aMt(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?oMt:sMt)(t,e)):gm(this.node(),t).delay},duration:function uMt(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?lMt:cMt)(t,e)):gm(this.node(),t).duration},ease:function fMt(e){var t=this._id;return arguments.length?this.each(function dMt(e,t){if("function"!=typeof t)throw new Error;return function(){Zg(this,e).ease=t}}(t,e)):gm(this.node(),t).ease},easeVarying:function hMt(e){if("function"!=typeof e)throw new Error;return this.each(function pMt(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Zg(this,e).ease=n}}(this._id,e))},end:function zMt(){var e,t,n=this,r=n._id,i=n.size();return new Promise(function(o,s){var a={value:s},l={value:function(){0==--i&&o()}};n.each(function(){var c=Zg(this,r),u=c.on;u!==e&&((t=(e=u).copy())._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),0===i&&o()})},[Symbol.iterator]:db[Symbol.iterator]};var qMt={time:null,delay:0,duration:250,ease:function GMt(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function WMt(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}uk.prototype.interrupt=function _kt(e){return this.each(function(){BB(this,e)})},uk.prototype.transition=function $Mt(e){var t,n;e instanceof ub?(t=e._id,e=e._name):(t=FSe(),(n=qMt).time=iK(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var l,s=r[o],a=s.length,c=0;c<a;++c)(l=s[c])&&OB(l,e,t,c,s,n||WMt(l,t));return new ub(r,this._parents,e,t)};Math;function bk(e){return{type:e}}function $B(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function kI(e){return(e=$B(Math.abs(e)))?e[1]:NaN}["w","e"].map(bk),["n","s"].map(bk),["n","w","e","s","nw","ne","sw","se"].map(bk);var zSe,i4t=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function YB(e){if(!(t=i4t.exec(e)))throw new Error("invalid format: "+e);var t;return new xK({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function xK(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function VSe(e,t){var n=$B(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}YB.prototype=xK.prototype,xK.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const HSe={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function t4t(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>VSe(100*e,t),r:VSe,s:function s4t(e,t){var n=$B(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(zSe=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return o===s?r:o>s?r+new Array(o-s+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+$B(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function GSe(e){return e}var XB,_K,$Se,qSe=Array.prototype.map,WSe=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];!function l4t(e){XB=function a4t(e){var t=void 0===e.grouping||void 0===e.thousands?GSe:function n4t(e,t){return function(n,r){for(var i=n.length,o=[],s=0,a=e[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),o.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=e[s=(s+1)%e.length];return o.reverse().join(t)}}(qSe.call(e.grouping,Number),e.thousands+""),n=void 0===e.currency?"":e.currency[0]+"",r=void 0===e.currency?"":e.currency[1]+"",i=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?GSe:function r4t(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}(qSe.call(e.numerals,String)),s=void 0===e.percent?"%":e.percent+"",a=void 0===e.minus?"\u2212":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function c(d){var f=(d=YB(d)).fill,p=d.align,m=d.sign,h=d.symbol,g=d.zero,y=d.width,v=d.comma,x=d.precision,_=d.trim,w=d.type;"n"===w?(v=!0,w="g"):HSe[w]||(void 0===x&&(x=12),_=!0,w="g"),(g||"0"===f&&"="===p)&&(g=!0,f="0",p="=");var A="$"===h?n:"#"===h&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",M="$"===h?r:/[%p]/.test(w)?s:"",E=HSe[w],D=/[defgprs%]/.test(w);function T(F){var j,W,z,R=A,N=M;if("c"===w)N=E(F)+N,F="";else{var $=(F=+F)<0||1/F<0;if(F=isNaN(F)?l:E(Math.abs(F),x),_&&(F=function o4t(e){e:for(var i,t=e.length,n=1,r=-1;n<t;++n)switch(e[n]){case".":r=i=n;break;case"0":0===r&&(r=n),i=n;break;default:if(!+e[n])break e;r>0&&(r=0)}return r>0?e.slice(0,r)+e.slice(i+1):e}(F)),$&&0==+F&&"+"!==m&&($=!1),R=($?"("===m?m:a:"-"===m||"("===m?"":m)+R,N=("s"===w?WSe[8+zSe/3]:"")+N+($&&"("===m?")":""),D)for(j=-1,W=F.length;++j<W;)if(48>(z=F.charCodeAt(j))||z>57){N=(46===z?i+F.slice(j+1):F.slice(j))+N,F=F.slice(0,j);break}}v&&!g&&(F=t(F,1/0));var V=R.length+F.length+N.length,X=V<y?new Array(y-V+1).join(f):"";switch(v&&g&&(F=t(X+F,X.length?y-N.length:1/0),X=""),p){case"<":F=R+F+N+X;break;case"=":F=R+X+F+N;break;case"^":F=X.slice(0,V=X.length>>1)+R+F+N+X.slice(V);break;default:F=X+R+F+N}return o(F)}return x=void 0===x?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,x)):Math.max(0,Math.min(20,x)),T.toString=function(){return d+""},T}return{format:c,formatPrefix:function u(d,f){var p=c(((d=YB(d)).type="f",d)),m=3*Math.max(-8,Math.min(8,Math.floor(kI(f)/3))),h=Math.pow(10,-m),g=WSe[8+m/3];return function(y){return p(h*y)+g}}}}(e),_K=XB.format,$Se=XB.formatPrefix}({thousands:",",grouping:[3],currency:["$",""]});const c4t=Math.sqrt(50),u4t=Math.sqrt(10),d4t=Math.sqrt(2);function KB(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),s=o>=c4t?10:o>=u4t?5:o>=d4t?2:1;let a,l,c;return i<0?(c=Math.pow(10,-i)/s,a=Math.round(e*c),l=Math.round(t*c),a/c<e&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,a=Math.round(e/c),l=Math.round(t/c),a*c<e&&++a,l*c>t&&--l),l<a&&.5<=n&&n<2?KB(e,t,2*n):[a,l,c]}function SK(e,t,n){return KB(e=+e,t=+t,n=+n)[2]}function ZB(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function h4t(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function YSe(e){let t,n,r;function i(a,l,c=0,u=a.length){if(c<u){if(0!==t(l,l))return u;do{const d=c+u>>>1;n(a[d],l)<0?c=d+1:u=d}while(c<u)}return c}return 2!==e.length?(t=ZB,n=(a,l)=>ZB(e(a),l),r=(a,l)=>e(a)-l):(t=e===ZB||e===h4t?e:m4t,n=e,r=e),{left:i,center:function s(a,l,c=0,u=a.length){const d=i(a,l,c,u-1);return d>c&&r(a[d-1],l)>-r(a[d],l)?d-1:d},right:function o(a,l,c=0,u=a.length){if(c<u){if(0!==t(l,l))return u;do{const d=c+u>>>1;n(a[d],l)<=0?c=d+1:u=d}while(c<u)}return c}}}function m4t(){return 0}const y4t=YSe(ZB).right,b4t=(YSe(function g4t(e){return null===e?NaN:+e}),y4t);function KSe(e,t){var s,n=t?t.length:0,r=e?Math.min(n,e.length):0,i=new Array(r),o=new Array(n);for(s=0;s<r;++s)i[s]=CK(e[s],t[s]);for(;s<n;++s)o[s]=t[s];return function(a){for(s=0;s<r;++s)o[s]=i[s](a);return o}}function v4t(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function x4t(e,t){var i,n={},r={};for(i in(null===e||"object"!=typeof e)&&(e={}),(null===t||"object"!=typeof t)&&(t={}),t)i in e?n[i]=CK(e[i],t[i]):r[i]=t[i];return function(o){for(i in n)r[i]=n[i](o);return r}}function _4t(e,t){t||(t=[]);var i,n=e?Math.min(t.length,e.length):0,r=t.slice();return function(o){for(i=0;i<n;++i)r[i]=e[i]*(1-o)+t[i]*o;return r}}function CK(e,t){var r,n=typeof t;return null==t||"boolean"===n?pK(t):("number"===n?ym:"string"===n?(r=B2(t))?(t=r,GB):MSe:t instanceof B2?GB:t instanceof Date?v4t:function S4t(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}(t)?_4t:Array.isArray(t)?KSe:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?x4t:ym)(e,t)}function C4t(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function A4t(e){return+e}var ZSe=[0,1];function MI(e){return e}function wK(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:function w4t(e){return function(){return e}}(isNaN(t)?NaN:.5)}function E4t(e,t,n){var r=e[0],i=e[1],o=t[0],s=t[1];return i<r?(r=wK(i,r),o=n(s,o)):(r=wK(r,i),o=n(o,s)),function(a){return o(r(a))}}function T4t(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=wK(e[s],e[s+1]),o[s]=n(t[s],t[s+1]);return function(a){var l=b4t(e,a,1,r)-1;return o[l](i[l](a))}}function QSe(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function O4t(e){var t=e.domain;return e.ticks=function(n){var r=t();return function f4t(e,t,n){if(!((n=+n)>0))return[];if((e=+e)==(t=+t))return[e];const r=t<e,[i,o,s]=r?KB(t,e,n):KB(e,t,n);if(!(o>=i))return[];const a=o-i+1,l=new Array(a);if(r)if(s<0)for(let c=0;c<a;++c)l[c]=(o-c)/-s;else for(let c=0;c<a;++c)l[c]=(o-c)*s;else if(s<0)for(let c=0;c<a;++c)l[c]=(i+c)/-s;else for(let c=0;c<a;++c)l[c]=(i+c)*s;return l}(r[0],r[r.length-1],n??10)},e.tickFormat=function(n,r){var i=t();return function F4t(e,t,n,r){var o,i=function p4t(e,t,n){n=+n;const r=(t=+t)<(e=+e),i=r?SK(t,e,n):SK(e,t,n);return(r?-1:1)*(i<0?1/-i:i)}(e,t,n);switch((r=YB(r??",f")).type){case"s":var s=Math.max(Math.abs(e),Math.abs(t));return null==r.precision&&!isNaN(o=function M4t(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(kI(t)/3)))-kI(Math.abs(e)))}(i,s))&&(r.precision=o),$Se(r,s);case"":case"e":case"g":case"p":case"r":null==r.precision&&!isNaN(o=function R4t(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,kI(t)-kI(e))+1}(i,Math.max(Math.abs(e),Math.abs(t))))&&(r.precision=o-("e"===r.type));break;case"f":case"%":null==r.precision&&!isNaN(o=function N4t(e){return Math.max(0,-kI(Math.abs(e)))}(i))&&(r.precision=o-2*("%"===r.type))}return _K(r)}(i[0],i[i.length-1],n??10,r)},e.nice=function(n){null==n&&(n=10);var l,c,r=t(),i=0,o=r.length-1,s=r[i],a=r[o],u=10;for(a<s&&(c=s,s=a,a=c,c=i,i=o,o=c);u-- >0;){if((c=SK(s,a,n))===l)return r[i]=s,r[o]=a,t(r);if(c>0)s=Math.floor(s/c)*c,a=Math.ceil(a/c)*c;else{if(!(c<0))break;s=Math.ceil(s*c)/c,a=Math.floor(a*c)/c}l=c}return e},e}function JSe(){var e=function k4t(){return function P4t(){var r,i,o,a,l,c,e=ZSe,t=ZSe,n=CK,s=MI;function u(){var f=Math.min(e.length,t.length);return s!==MI&&(s=function I4t(e,t){var n;return e>t&&(n=e,e=t,t=n),function(r){return Math.max(e,Math.min(t,r))}}(e[0],e[f-1])),a=f>2?T4t:E4t,l=c=null,d}function d(f){return null==f||isNaN(f=+f)?o:(l||(l=a(e.map(r),t,n)))(r(s(f)))}return d.invert=function(f){return s(i((c||(c=a(t,e.map(r),ym)))(f)))},d.domain=function(f){return arguments.length?(e=Array.from(f,A4t),u()):e.slice()},d.range=function(f){return arguments.length?(t=Array.from(f),u()):t.slice()},d.rangeRound=function(f){return t=Array.from(f),n=C4t,u()},d.clamp=function(f){return arguments.length?(s=!!f||MI,u()):s!==MI},d.interpolate=function(f){return arguments.length?(n=f,u()):n},d.unknown=function(f){return arguments.length?(o=f,d):o},function(f,p){return r=f,i=p,u()}}()(MI,MI)}();return e.copy=function(){return function D4t(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}(e,JSe())},QSe.apply(e,arguments),O4t(e)}class eCe extends Map{constructor(t,n=rCe){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),null!=t)for(const[r,i]of t)this.set(r,i)}get(t){return super.get(AK(this,t))}has(t){return super.has(AK(this,t))}set(t,n){return super.set(function tCe({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):(e.set(r,n),n)}(this,t),n)}delete(t){return super.delete(function nCe({_intern:e,_key:t},n){const r=t(n);return e.has(r)&&(n=e.get(r),e.delete(r)),n}(this,t))}}function AK({_intern:e,_key:t},n){const r=t(n);return e.has(r)?e.get(r):n}function rCe(e){return null!==e&&"object"==typeof e?e.valueOf():e}Set;const iCe=Symbol("implicit");function oCe(){var e=new eCe,t=[],n=[],r=iCe;function i(o){let s=e.get(o);if(void 0===s){if(r!==iCe)return r;e.set(o,s=t.push(o)-1)}return n[s%n.length]}return i.domain=function(o){if(!arguments.length)return t.slice();t=[],e=new eCe;for(const s of o)e.has(s)||e.set(s,t.push(s)-1);return i},i.range=function(o){return arguments.length?(n=Array.from(o),i):n.slice()},i.unknown=function(o){return arguments.length?(r=o,i):r},i.copy=function(){return oCe(t,n).unknown(r)},QSe.apply(i,arguments),i}function rd(e){return"string"==typeof e?new Uf([[document.querySelector(e)]],[document.documentElement]):new Uf([[e]],nSe)}function RI(e){return function(){return e}}function sCe(e){this._context=e}function j4t(e){return new sCe(e)}sCe.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}};const IK=Math.PI,EK=2*IK,U2=1e-6,U4t=EK-U2;function aCe(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}class QB{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==t?aCe:function z4t(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return aCe;const n=10**t;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*n)/n+r[i]}}(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,r,i){this._append`Q${+t},${+n},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(t,n,r,i,o,s){this._append`C${+t},${+n},${+r},${+i},${this._x1=+o},${this._y1=+s}`}arcTo(t,n,r,i,o){if(t=+t,n=+n,r=+r,i=+i,(o=+o)<0)throw new Error(`negative radius: ${o}`);let s=this._x1,a=this._y1,l=r-t,c=i-n,u=s-t,d=a-n,f=u*u+d*d;if(null===this._x1)this._append`M${this._x1=t},${this._y1=n}`;else if(f>U2)if(Math.abs(d*l-c*u)>U2&&o){let p=r-s,m=i-a,h=l*l+c*c,g=p*p+m*m,y=Math.sqrt(h),v=Math.sqrt(f),x=o*Math.tan((IK-Math.acos((h+f-g)/(2*y*v)))/2),_=x/v,w=x/y;Math.abs(_-1)>U2&&this._append`L${t+_*u},${n+_*d}`,this._append`A${o},${o},0,0,${+(d*p>u*m)},${this._x1=t+w*l},${this._y1=n+w*c}`}else this._append`L${this._x1=t},${this._y1=n}`}arc(t,n,r,i,o,s){if(t=+t,n=+n,s=!!s,(r=+r)<0)throw new Error(`negative radius: ${r}`);let a=r*Math.cos(i),l=r*Math.sin(i),c=t+a,u=n+l,d=1^s,f=s?i-o:o-i;null===this._x1?this._append`M${c},${u}`:(Math.abs(this._x1-c)>U2||Math.abs(this._y1-u)>U2)&&this._append`L${c},${u}`,r&&(f<0&&(f=f%EK+EK),f>U4t?this._append`A${r},${r},0,1,${d},${t-a},${n-l}A${r},${r},0,1,${d},${this._x1=c},${this._y1=u}`:f>U2&&this._append`A${r},${r},0,${+(f>=IK)},${d},${this._x1=t+r*Math.cos(o)},${this._y1=n+r*Math.sin(o)}`)}rect(t,n,r,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}}function G4t(e){return e[0]}function q4t(e){return e[1]}function lCe(e){return e<0?-1:1}function cCe(e,t,n){var r=e._x1-e._x0,i=t-e._x1,o=(e._y1-e._y0)/(r||i<0&&-0),s=(n-e._y1)/(i||r<0&&-0),a=(o*i+s*r)/(r+i);return(lCe(o)+lCe(s))*Math.min(Math.abs(o),Math.abs(s),.5*Math.abs(a))||0}function uCe(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function TK(e,t,n){var r=e._x0,o=e._x1,s=e._y1,a=(o-r)/3;e._context.bezierCurveTo(r+a,e._y0+a*t,o-a,s-a*n,o,s)}function JB(e){this._context=e}function fCe(e){this._context=e}function $4t(e){return new JB(e)}JB.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:TK(this,this._t0,uCe(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,TK(this,uCe(this,n=cCe(this,e,t)),n);break;default:TK(this,this._t0,n=cCe(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}},(function dCe(e){this._context=new fCe(e)}.prototype=Object.create(JB.prototype)).point=function(e,t){JB.prototype.point.call(this,t,e)},fCe.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,n,r,i,o){this._context.bezierCurveTo(t,e,r,n,o,i)}};const DK={capture:!0,passive:!1};function PK(e){e.preventDefault(),e.stopImmediatePropagation()}function pCe(e){return((e=Math.exp(e))+1/e)/2}const J4t=function e(t,n,r){function i(o,s){var g,y,a=o[0],l=o[1],c=o[2],f=s[2],p=s[0]-a,m=s[1]-l,h=p*p+m*m;if(h<1e-12)y=Math.log(f/c)/t,g=function(M){return[a+M*p,l+M*m,c*Math.exp(t*M*y)]};else{var v=Math.sqrt(h),x=(f*f-c*c+r*h)/(2*c*n*v),_=(f*f-c*c-r*h)/(2*f*n*v),w=Math.log(Math.sqrt(x*x+1)-x),A=Math.log(Math.sqrt(_*_+1)-_);y=(A-w)/t,g=function(M){var E=M*y,D=pCe(w),T=c/(n*v)*(D*function Q4t(e){return((e=Math.exp(2*e))-1)/(e+1)}(t*E+w)-function Z4t(e){return((e=Math.exp(e))-1/e)/2}(w));return[a+T*p,l+T*m,c*D/pCe(t*E+w)]}}return g.duration=1e3*y*t/Math.SQRT2,g}return i.rho=function(o){var s=Math.max(.001,+o),a=s*s;return e(s,a,a*a)},i}(Math.SQRT2,2,4);function z2(e,t){if(e=function eRt(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}const eL=e=>()=>e;function tRt(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function pb(e,t,n){this.k=e,this.x=t,this.y=n}pb.prototype={constructor:pb,scale:function(e){return 1===e?this:new pb(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new pb(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var kK=new pb(1,0,0);function MK(e){e.stopImmediatePropagation()}function vk(e){e.preventDefault(),e.stopImmediatePropagation()}function rRt(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function iRt(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function hCe(){return this.__zoom||kK}function oRt(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function sRt(){return navigator.maxTouchPoints||"ontouchstart"in this}function aRt(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],s=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),s>o?(o+s)/2:Math.min(0,o)||Math.max(0,s))}let xk=(()=>{class e{get div(){return this.root.nativeElement}get width(){return this.div.offsetWidth}get margin(){const{"margin-top":n,"margin-right":r,"margin-bottom":i,"margin-left":o}=this.settings;return{top:n,right:r,bottom:i,left:o}}constructor(){this.initialize$=new Fh(1),this.initialized$=this.initialize$.pipe(Ho(n=>this.root=n),hn(()=>{const n=function B4t(e){return rd(rK(e).call(document.documentElement))}("svg"),r=n.node();if(!r)throw new Error("Could not create SVG node");return this.div.append(r),n}),Ho(n=>this.svg=n),Ho(n=>{this.clip=n.append("defs").append("clipPath").attr("id","clip").append("rect");const r=n.append("g").attr("class","focus");this.draw=r.append("g").attr("class","features").attr("clip-path","url(#clip)"),this.zoom=function lRt(){var u,d,f,e=rRt,t=iRt,n=aRt,r=oRt,i=sRt,o=[0,1/0],s=[[-1/0,-1/0],[1/0,1/0]],a=250,l=J4t,c=sSe("start","zoom","end"),p=500,m=150,h=0,g=10;function y(j){j.property("__zoom",hCe).on("wheel.zoom",E,{passive:!1}).on("mousedown.zoom",D).on("dblclick.zoom",T).filter(i).on("touchstart.zoom",F).on("touchmove.zoom",R).on("touchend.zoom touchcancel.zoom",N).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function v(j,W){return(W=Math.max(o[0],Math.min(o[1],W)))===j.k?j:new pb(W,j.x,j.y)}function x(j,W,z){var $=W[0]-z[0]*j.k,V=W[1]-z[1]*j.k;return $===j.x&&V===j.y?j:new pb(j.k,$,V)}function _(j){return[(+j[0][0]+ +j[1][0])/2,(+j[0][1]+ +j[1][1])/2]}function w(j,W,z,$){j.on("start.zoom",function(){A(this,arguments).event($).start()}).on("interrupt.zoom end.zoom",function(){A(this,arguments).event($).end()}).tween("zoom",function(){var V=this,X=arguments,H=A(V,X).event($),oe=t.apply(V,X),te=null==z?_(oe):"function"==typeof z?z.apply(V,X):z,K=Math.max(oe[1][0]-oe[0][0],oe[1][1]-oe[0][1]),Q=V.__zoom,G="function"==typeof W?W.apply(V,X):W,Z=l(Q.invert(te).concat(K/Q.k),G.invert(te).concat(K/G.k));return function(ee){if(1===ee)ee=G;else{var se=Z(ee),xe=K/se[2];ee=new pb(xe,te[0]-se[0]*xe,te[1]-se[1]*xe)}H.zoom(null,ee)}})}function A(j,W,z){return!z&&j.__zooming||new M(j,W)}function M(j,W){this.that=j,this.args=W,this.active=0,this.sourceEvent=null,this.extent=t.apply(j,W),this.taps=0}function E(j,...W){if(e.apply(this,arguments)){var z=A(this,W).event(j),$=this.__zoom,V=Math.max(o[0],Math.min(o[1],$.k*Math.pow(2,r.apply(this,arguments)))),X=z2(j);if(z.wheel)(z.mouse[0][0]!==X[0]||z.mouse[0][1]!==X[1])&&(z.mouse[1]=$.invert(z.mouse[0]=X)),clearTimeout(z.wheel);else{if($.k===V)return;z.mouse=[X,$.invert(X)],BB(this),z.start()}vk(j),z.wheel=setTimeout(function H(){z.wheel=null,z.end()},m),z.zoom("mouse",n(x(v($,V),z.mouse[0],z.mouse[1]),z.extent,s))}}function D(j,...W){if(!f&&e.apply(this,arguments)){var z=j.currentTarget,$=A(this,W,!0).event(j),V=rd(j.view).on("mousemove.zoom",function te(Q){if(vk(Q),!$.moved){var G=Q.clientX-H,Z=Q.clientY-oe;$.moved=G*G+Z*Z>h}$.event(Q).zoom("mouse",n(x($.that.__zoom,$.mouse[0]=z2(Q,z),$.mouse[1]),$.extent,s))},!0).on("mouseup.zoom",function K(Q){V.on("mousemove.zoom mouseup.zoom",null),function X4t(e,t){var n=e.document.documentElement,r=rd(e).on("dragstart.drag",null);t&&(r.on("click.drag",PK,DK),setTimeout(function(){r.on("click.drag",null)},0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(Q.view,$.moved),vk(Q),$.event(Q).end()},!0),X=z2(j,z),H=j.clientX,oe=j.clientY;(function Y4t(e){var t=e.document.documentElement,n=rd(e).on("dragstart.drag",PK,DK);"onselectstart"in t?n.on("selectstart.drag",PK,DK):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")})(j.view),MK(j),$.mouse=[X,this.__zoom.invert(X)],BB(this),$.start()}}function T(j,...W){if(e.apply(this,arguments)){var z=this.__zoom,$=z2(j.changedTouches?j.changedTouches[0]:j,this),V=z.invert($),H=n(x(v(z,z.k*(j.shiftKey?.5:2)),$,V),t.apply(this,W),s);vk(j),a>0?rd(this).transition().duration(a).call(w,H,$,j):rd(this).call(y.transform,H,$,j)}}function F(j,...W){if(e.apply(this,arguments)){var X,H,oe,te,z=j.touches,$=z.length,V=A(this,W,j.changedTouches.length===$).event(j);for(MK(j),H=0;H<$;++H)te=[te=z2(oe=z[H],this),this.__zoom.invert(te),oe.identifier],V.touch0?!V.touch1&&V.touch0[2]!==te[2]&&(V.touch1=te,V.taps=0):(V.touch0=te,X=!0,V.taps=1+!!u);u&&(u=clearTimeout(u)),X&&(V.taps<2&&(d=te[0],u=setTimeout(function(){u=null},p)),BB(this),V.start())}}function R(j,...W){if(this.__zooming){var X,H,oe,te,z=A(this,W).event(j),$=j.changedTouches,V=$.length;for(vk(j),X=0;X<V;++X)oe=z2(H=$[X],this),z.touch0&&z.touch0[2]===H.identifier?z.touch0[0]=oe:z.touch1&&z.touch1[2]===H.identifier&&(z.touch1[0]=oe);if(H=z.that.__zoom,z.touch1){var K=z.touch0[0],Q=z.touch0[1],G=z.touch1[0],Z=z.touch1[1],ee=(ee=G[0]-K[0])*ee+(ee=G[1]-K[1])*ee,se=(se=Z[0]-Q[0])*se+(se=Z[1]-Q[1])*se;H=v(H,Math.sqrt(ee/se)),oe=[(K[0]+G[0])/2,(K[1]+G[1])/2],te=[(Q[0]+Z[0])/2,(Q[1]+Z[1])/2]}else{if(!z.touch0)return;oe=z.touch0[0],te=z.touch0[1]}z.zoom("touch",n(x(H,oe,te),z.extent,s))}}function N(j,...W){if(this.__zooming){var X,H,z=A(this,W).event(j),$=j.changedTouches,V=$.length;for(MK(j),f&&clearTimeout(f),f=setTimeout(function(){f=null},p),X=0;X<V;++X)H=$[X],z.touch0&&z.touch0[2]===H.identifier?delete z.touch0:z.touch1&&z.touch1[2]===H.identifier&&delete z.touch1;if(z.touch1&&!z.touch0&&(z.touch0=z.touch1,delete z.touch1),z.touch0)z.touch0[1]=this.__zoom.invert(z.touch0[0]);else if(z.end(),2===z.taps&&(H=z2(H,this),Math.hypot(d[0]-H[0],d[1]-H[1])<g)){var oe=rd(this).on("dblclick.zoom");oe&&oe.apply(this,arguments)}}}return y.transform=function(j,W,z,$){var V=j.selection?j.selection():j;V.property("__zoom",hCe),j!==V?w(j,W,z,$):V.interrupt().each(function(){A(this,arguments).event($).start().zoom(null,"function"==typeof W?W.apply(this,arguments):W).end()})},y.scaleBy=function(j,W,z,$){y.scaleTo(j,function(){return this.__zoom.k*("function"==typeof W?W.apply(this,arguments):W)},z,$)},y.scaleTo=function(j,W,z,$){y.transform(j,function(){var V=t.apply(this,arguments),X=this.__zoom,H=null==z?_(V):"function"==typeof z?z.apply(this,arguments):z,oe=X.invert(H),te="function"==typeof W?W.apply(this,arguments):W;return n(x(v(X,te),H,oe),V,s)},z,$)},y.translateBy=function(j,W,z,$){y.transform(j,function(){return n(this.__zoom.translate("function"==typeof W?W.apply(this,arguments):W,"function"==typeof z?z.apply(this,arguments):z),t.apply(this,arguments),s)},null,$)},y.translateTo=function(j,W,z,$,V){y.transform(j,function(){var X=t.apply(this,arguments),H=this.__zoom,oe=null==$?_(X):"function"==typeof $?$.apply(this,arguments):$;return n(kK.translate(oe[0],oe[1]).scale(H.k).translate("function"==typeof W?-W.apply(this,arguments):-W,"function"==typeof z?-z.apply(this,arguments):-z),X,s)},$,V)},M.prototype={event:function(j){return j&&(this.sourceEvent=j),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(j,W){return this.mouse&&"mouse"!==j&&(this.mouse[1]=W.invert(this.mouse[0])),this.touch0&&"touch"!==j&&(this.touch0[1]=W.invert(this.touch0[0])),this.touch1&&"touch"!==j&&(this.touch1[1]=W.invert(this.touch1[0])),this.that.__zoom=W,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(j){var W=rd(this.that).datum();c.call(j,this.that,new tRt(j,{sourceEvent:this.sourceEvent,target:y,type:j,transform:this.that.__zoom,dispatch:c}),W)}},y.wheelDelta=function(j){return arguments.length?(r="function"==typeof j?j:eL(+j),y):r},y.filter=function(j){return arguments.length?(e="function"==typeof j?j:eL(!!j),y):e},y.touchable=function(j){return arguments.length?(i="function"==typeof j?j:eL(!!j),y):i},y.extent=function(j){return arguments.length?(t="function"==typeof j?j:eL([[+j[0][0],+j[0][1]],[+j[1][0],+j[1][1]]]),y):t},y.scaleExtent=function(j){return arguments.length?(o[0]=+j[0],o[1]=+j[1],y):[o[0],o[1]]},y.translateExtent=function(j){return arguments.length?(s[0][0]=+j[0][0],s[1][0]=+j[1][0],s[0][1]=+j[0][1],s[1][1]=+j[1][1],y):[[s[0][0],s[0][1]],[s[1][0],s[1][1]]]},y.constrain=function(j){return arguments.length?(n=j,y):n},y.duration=function(j){return arguments.length?(a=+j,y):a},y.interpolate=function(j){return arguments.length?(l=j,y):l},y.on=function(){var j=c.on.apply(c,arguments);return j===c?y:j},y.clickDistance=function(j){return arguments.length?(h=(j=+j)*j,y):Math.sqrt(h)},y.tapDistance=function(j){return arguments.length?(g=+j,y):g},y}(),this.events=r.append("rect").attr("class","zoom").style("fill","none").style("pointer-events","all").lower(),r.call(this.zoom)}),Ho(n=>{const r=n.append("g").attr("class","x axis"),i=n.append("g").attr("class","y axis");this.axes={x:r,y:i}}),Ho(()=>this.scale={x:JSe(),y:oCe()}),ff(1))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),RK=(()=>{class e{constructor(){this._traces=new Map,this._parent=new Map,this._children=new Map}set hierarchy(n){this.setHierarchy(n)}get traces(){return this._traces}get features(){const n=this.traces,r=new Map;for(const i of n.values())for(const[o,s]of Object.entries(i.values))r.set(`trace-${i.id}-feature-${o}`,s);return r}setHierarchy(n){let r=0,i=[...n];for(;i.length>0;){const[o]=i.splice(0,1),s=o.nested||[],a=new Array;for(const u of[o,...s]){const d="trace"===u.type?u:{type:"trace",values:[u],label:u.label,id:void 0,expanded:void 0};d.values=d.values.sort((f,p)=>"continuous"!==f.type?-1:"continuous"!==p.type?1:0),d.id=void 0!==d.id?d.id:r++,d.expanded=!1!==d.expanded,this._traces.set(d.id,d),a.push(d)}const l=a[0],c=a.slice(1);c.forEach(u=>this._parent.set(u,l.id)),this._children.set(l,c.map(u=>u.id)),i=[...a.slice(1),...i]}}getTrace(n){return this.traces.get(n)}getParent(n){const r=this._parent.get(n);return r&&this._traces.get(r)}getBranch(n){const r=[],i=[n];for(;i.length>0;){const o=i.pop();r.push(o);const s=this.getChildren(o);i.push(...s)}return r}getChildren(n){return(this._children.get(n)||[]).map(i=>this._traces.get(i))}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"root"})}return e})();function mCe(e,t,n){e.attr("height",t.height).attr("width",t.width).attr("y",n.top).attr("x",n.left)}let gCe=(()=>{class e{get svg(){return this.initializeService.svg}get div(){return this.initializeService.div}get height(){return this.div.offsetHeight}get width(){return this.div.offsetWidth}get margin(){return this.initializeService.margin}get scale(){return this.initializeService.scale}get axes(){return this.initializeService.axes}constructor(n){this.initializeService=n,this.resize$=new Fh(1);const r=this.resize$.pipe(hn(()=>({width:this.width,height:this.height})),sge((i,o)=>i.width===o.width),hn(()=>{}),WT(void 0));this.resized$=r.pipe(hn(()=>this.updateRoot()),hn(()=>this.updateDraw()),hn(()=>this.updateAxes()),hn(()=>this.updateRangeX()),hn(()=>this.updateRangeY()))}updateRoot(){const{y:n}=this.scale,i=n.range().at(-1)+this.margin.bottom,o=this.width;this.svg.attr("height",i).attr("width",o)}updateDraw(){const n={width:0,height:0};n.height=this.height-this.margin.top-this.margin.bottom,n.width=this.width-this.margin.left-this.margin.right,mCe(this.initializeService.clip,n,this.margin),mCe(this.initializeService.events,n,this.margin)}updateAxes(){const{x:n,y:r}=this.axes;n.attr("transform",`translate(0, ${this.height-this.margin.top})`),r.attr("transform",`translate(${this.margin.left}, 0)`)}updateRangeX(){const n=this.scale.x,r=this.width,{left:i,right:o}=this.margin;n.range([i,r-o])}updateRangeY(){}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(xk))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})(),yCe=(()=>{class e{constructor(n){this.initService=n,this.zoom$=new Fh(1);const i=this.initService.initialized$.pipe(hn(()=>this._scale={x:this.initService.scale.x.copy(),y:this.initService.scale.y.copy()}),ff(1)).pipe(ba(()=>this.zoom$),hn(o=>{const{x:s}=this._scale,{x:a}=this.initService.scale,l=o.transform.rescaleX(s),[c,u]=l.domain();return a.domain([c,u]),this.initService.scale}),WT(this.initService.scale));this.zoomed$=i.pipe(hn(()=>{const o=this.initService.axes,s=this.initService.scale,a=s.x.ticks().filter(c=>Number.isInteger(c)).slice(1,-1),l=function MDt(e){return IB(3,e)}(s.x).tickValues(a).tickFormat(_K(".0f"));o.x.call(l)}))}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(xk))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const bCe={H:"blue",K:"blue",R:"blue",D:"red",E:"red",S:"green",T:"green",N:"green",Q:"green",A:"white",V:"white",L:"white",I:"white",M:"white",F:"magenta",W:"magenta",Y:"magenta",P:"brown",G:"brown",C:"yellow",B:"grey",Z:"grey",X:"grey","-":"grey"},NK=(parseFloat(getComputedStyle(document.documentElement).fontSize),e=>e.id),FK=(e,t)=>t;let vCe=(()=>{class e{constructor(n,r){this.initializeService=n,this.featuresService=r,this.traces$=new Fh(1),this.sequence$=new Fh(1),this["char.width"]=0,this.draw$=this.sequence$.pipe(Ho(i=>{this.initializeService.scale.x.domain([0,i.length+1])}),hn(i=>this.createSequence(i)),Ho(()=>{const o=this.initializeService.settings["content-size"]/3;this.tooltip=rd(this.initializeService.div).append("div").attr("class","tooltip").style("position","absolute").style("display","none").style("opacity",1).style("color","black").style("padding",".25rem").style("background-color","white").style("border","solid").style("border-width","1px").style("border-radius",o+"px")}),ff(1),ba(()=>this.traces$),Ho(i=>this.updateScale(i)),Ho(i=>this.createLabels(i)),Ho(i=>this.createGrid(i)),Ho(i=>this.createTraces(i)),ff(1)),this.drawn$=this.draw$.pipe(hn(()=>this.updateSequence()),hn(()=>this.updateGrid()),hn(()=>this.updateLabels()),hn(()=>this.updateTraces()))}updateScale(n){const r=this.initializeService.scale.y,i=["sequence",...n.map(({id:s})=>s+"")],o=i.reduce((s,a,l)=>{if(0===l&&"sequence"===a){const d=this.initializeService.settings["margin-top"];return[d,d+this.initializeService.settings["line-height"]]}const c=this.featuresService.getTrace(+a);if(c){const u=s.at(-1);let d=c["line-height"]||this.initializeService.settings["line-height"];return"dodge"===c.position&&(d=c.values.reduce((f,p)=>f+(p["line-height"]||this.initializeService.settings["line-height"]),0)),[...s,u+d]}throw new Error("Trace not found")},[]);r.domain(i).range(o)}createSequence(n){const i=this.initializeService.draw.selectAll("g.sequence").data([n]).join("g").attr("class","sequence");this["group.residues"]=i.selectAll("g.residue").data(n).join("g").attr("id",(s,a)=>`residue-${a+1}`).attr("class","residue"),this["group.residues"].append("rect").attr("class","color").attr("fill",s=>(s=>bCe[s]||bCe.X)(s)).attr("fill-opacity",.1);let o=0;this["group.residues"].append("text").attr("class","name").text(s=>""+s).each(function(){o=Math.max(o,this.getBBox().width)}),this["char.width"]=o}updateSequence(){const n=this.initializeService.margin,{x:r,y:i}=this.initializeService.scale,{"line-height":o}=this.initializeService.settings,s=r(1)-r(0),a=this["char.width"],{"group.residues":l}=this;l.select("rect.color").attr("x",(c,u)=>r(u+.5)).attr("y",n.top).attr("width",()=>s).attr("height","100%"),l.select("text.name").attr("x",(c,u)=>r(u+1)).attr("y",i("sequence")+o/2).attr("width",()=>s).attr("height",o).attr("dominant-baseline","central").style("text-anchor","middle").attr("fill",this.initializeService.settings["text-color"]).attr("opacity",()=>a>s?0:1)}createLabels(n){const{y:r}=this.initializeService.scale,i=this.initializeService.settings,{left:o}=this.initializeService.margin,s=this.initializeService.svg.selectAll("g.labels").data([n],FK).join("g").attr("class","labels");this["group.labels"]=s.selectAll("g.label").data([{id:"sequence",label:"Sequence",expanded:!0},...n],NK).join(a=>{const l=a.append("g").attr("id",c=>"label-"+c.id).attr("class","label");return l.each(c=>{const u=""+c.id,d=this.initializeService.div.querySelector("div#label-"+u);d&&(d.style.position="absolute",d.style.left="0px",d.style.overflow="hidden",d.style.top=r(u)+"px",d.style.height=(c["line-height"]||i["line-height"])+"px",d.style.width=o+"px")}),l},a=>a,a=>(a.each(l=>{const u=this.initializeService.div.querySelector("div#label-"+l.id);u&&(u.style.display="none")}),a)),this["group.labels"].each(a=>{const l=""+a.id,c=this.initializeService.div.querySelector("div#label-"+l);c&&(c.style.position="absolute",c.style.overflow="hidden",c.style.left="0px",c.style.top=r(l)+"px",c.style.display="block",c.style.height=(a["line-height"]||i["line-height"])+"px",c.style.width=o+"px")}),this["group.labels"].selectAll("rect").data(a=>[a],FK).join("rect").attr("height",a=>a["line-height"]||i["line-height"]).attr("width",()=>o).attr("fill","none")}updateLabels(){const n=this.initializeService.scale.y,r=this.initializeService.settings;this["group.labels"].select("rect").attr("y",i=>n(String(i.id))).attr("x",0),this["group.labels"].select("text").attr("y",i=>n(String(i.id))+(i["line-height"]||r["line-height"])/2).attr("x",0).attr("dominant-baseline","central").attr("fill",i=>i["text-color"]||r["text-color"])}createGrid(n){const r=this.initializeService.svg.selectAll("g.grid").data([n],FK).join("g").attr("class","grid").lower();this["group.grid"]=r.selectAll("rect.grid-line").data(n,NK).join("rect").attr("id",i=>"grid-"+i.id).attr("class","grid-line")}updateGrid(){const n=this.initializeService.scale.y,r=this.initializeService.width,i=this.initializeService.margin,o=this.initializeService.settings;this["group.grid"].attr("x",i.left).attr("y",s=>{const a=s.values[s.values.length-1],l=n(""+s.id),c=a["line-height"]||s["line-height"]||o["line-height"];return"continuous"!==a.type?l+c/2-.5:l+c/2-(a["content-size"]||s["content-size"]||o["content-size"])/2}).attr("width",r-i.left-i.right).attr("height",s=>{const a=s.values[s.values.length-1];return"continuous"===a.type?a["content-size"]||s["content-size"]||o["content-size"]:1}).attr("fill",this.initializeService.settings["grid-color"])}createTraces(n){const r=this.initializeService.settings,i=this.tooltip;this["group.traces"]=this.initializeService.draw.selectAll("g.trace").data(n,NK).join("g").attr("id",o=>"trace-"+o.id).attr("class","trace"),this["group.traces"].each(function(o){const a=rd(this).selectAll("g.feature").data(o.values);a.enter().append("g").attr("class",l=>"feature "+l.type).attr("id",(l,c)=>`trace-${o.id}-feature-${c}`).each(function(l,c){"loci"===l.type&&l.values.forEach((u,d)=>{const f=(l["content-size"]||o["content-size"]||r["content-size"])/3,p=rd(this).append("rect").attr("stroke",l["trace-color"]||o["trace-color"]||r["trace-color"]).attr("stroke-opacity",1).attr("stroke-width",1).attr("fill",l["trace-color"]||o["trace-color"]||r["trace-color"]).attr("fill-opacity",.5).attr("rx",f).attr("ry",f);p.data([u]),p.on("mouseover",m=>function cRt(e,t,n,r,i,o){t.style("display","block"),t.style("opacity",1)}(0,i)),p.on("mousemove",m=>function uRt(e,t,n,r,i,o){"loci"===r.type&&t.html(`Trace: ${n.id}<br>Feature: ${r.index}<br>Index: ${i}<br>Value: ${o.start!==o.end?o.start+"-"+o.end:o.start}`),"continuous"===r.type&&t.html(`Trace: ${n.id}<br>Feature: ${r.index}<br>Index: ${i}<br>Value: ${o}`),t.style("left",e.offsetX+10+"px").style("top",e.offsetY+10+"px")}(m,i,o,{...l,index:c},d,u)),p.on("mouseleave",m=>function dRt(e,t,n,r,i,o){t.style("opacity",0),t.style("display","none")}(0,i))}),"continuous"===l.type&&rd(this).append("path").attr("stroke",l["trace-color"]||o["trace-color"]||r["trace-color"]).attr("stroke-opacity",1).attr("stroke-width",2).attr("fill","none").data([l.values])}),a.exit().remove()})}updateTraces(){const n=this.initializeService.scale,r=this.initializeService.settings;this["group.traces"].each(function(i){rd(this).selectAll("g.feature").each(function(a){const l=n.y(""+i.id),c=a["line-height"]||i["line-height"]||r["line-height"],u=a["line-height"]||i["content-size"]||r["content-size"];if("loci"===a.type){const d=n.x(1)-n.x(0);rd(this).selectAll("rect").attr("x",f=>n.x(f.start-.5)).attr("y",l+c/2-u/2).attr("height",u).attr("width",f=>d*(f.end-f.start+1))}if("continuous"===a.type){const d=a.values,f=void 0!==a.min?a.min:Math.min(...a.values),p=void 0!==a.max?a.max:Math.max(...a.values),m=d.map((g,y)=>[y+1,1-(g-f)/(p-f)]),h=function W4t(e,t){var n=RI(!0),r=null,i=j4t,o=null,s=function H4t(e){let t=3;return e.digits=function(n){if(!arguments.length)return t;if(null==n)t=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);t=r}return e},()=>new QB(t)}(a);function a(l){var c,d,p,u=(l=function L4t(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}(l)).length,f=!1;for(null==r&&(o=i(p=s())),c=0;c<=u;++c)!(c<u&&n(d=l[c],c,l))===f&&((f=!f)?o.lineStart():o.lineEnd()),f&&o.point(+e(d,c,l),+t(d,c,l));if(p)return o=null,p+""||null}return e="function"==typeof e?e:void 0===e?G4t:RI(e),t="function"==typeof t?t:void 0===t?q4t:RI(t),a.x=function(l){return arguments.length?(e="function"==typeof l?l:RI(+l),a):e},a.y=function(l){return arguments.length?(t="function"==typeof l?l:RI(+l),a):t},a.defined=function(l){return arguments.length?(n="function"==typeof l?l:RI(!!l),a):n},a.curve=function(l){return arguments.length?(i=l,null!=r&&(o=i(r)),a):i},a.context=function(l){return arguments.length?(null==l?r=o=null:o=i(r=l),a):r},a}().curve($4t).x(([g])=>n.x(g)).y(([,g])=>l+c/2-(u-2)/2+(u-2)*g);rd(this).select("path").attr("d",h(m))}})})}onLabelClick(n){n.expanded=!1===n.expanded;const r=Array.from(this.featuresService.traces.values()),i=[];for(const s of r){const{expanded:a}={expanded:!0,...s};if(!0!==a){const l=this.featuresService.getBranch(s).slice(1);i.push(...l)}}const o=r.filter(s=>!i.includes(s));this.traces$.next(o),console.log("Trace",n)}static#e=this.\u0275fac=function(r){return new(r||e)(Rn(xk),Rn(RK))};static#t=this.\u0275prov=gn({token:e,factory:e.\u0275fac,providedIn:"platform"})}return e})();const fRt=["root"],pRt=e=>({trace:e});function hRt(e,t){if(1&e){const n=C4();br(0,"div",3),Fx("click",function(){const i=Sh(n).$implicit;return qf(Pu(2).drawService.onLabelClick(i.value))})("keyup",function(){const i=Sh(n).$implicit;return qf(Pu(2).drawService.onLabelClick(i.value))}),D8(1,4),Sr()}if(2&e){const n=t.$implicit,r=Pu(2);R0("id","label-"+n.key),Yc(),R0("ngTemplateOutlet",r.label.templateRef)("ngTemplateOutletContext",function _te(e,t,n,r){return Ste(_t(),Kl(),e,t,n,r)}(3,pRt,n.value))}}function mRt(e,t){1&e&&(wT(0,hRt,2,5,"div",2,CT),Ox(2,"keyvalue")),2&e&&AT(Bx(2,0,Pu().featuresService.traces))}let gRt=(()=>{class e{set settings(n){this.initService.settings=n}set features(n){this.featuresService.hierarchy=n;const r=Array.from(this.featuresService.traces.values());this.traces$.next(r)}constructor(n,r,i,o,s){this.featuresService=n,this.initService=r,this.resizeService=i,this.zoomService=o,this.drawService=s,this.traces$=this.drawService.traces$,this.sequence$=this.drawService.sequence$,this.update$=this.initService.initialized$.pipe(ba(()=>this.drawService.draw$),ba(()=>this.resizeService.resized$),Ho(()=>{const{left:a,right:l,bottom:c}=this.resizeService.margin,u=this.resizeService.height,d=this.resizeService.width,f=this.sequence.length+1;this.initService.zoom.translateExtent([[a,0],[d-l,u-c]]).scaleExtent([1,f/5]).extent([[a,0],[d-l,u-c]]).on("zoom",p=>{this.zoomService.zoom$.next(p)})}),ba(()=>this.zoomService.zoomed$),ba(()=>this.drawService.drawn$)),this._update=this.update$.subscribe()}ngOnChanges(n){n&&n.sequence&&this.sequence$.next(this.sequence)}ngAfterViewInit(){this.initService.initialize$.next(this._root)}ngOnDestroy(){this._update.unsubscribe()}onResize(n){this.resizeService.resize$.next(n)}static#e=this.\u0275fac=function(r){return new(r||e)(On(RK),On(xk),On(gCe),On(yCe),On(vCe))};static#t=this.\u0275cmp=$d({type:e,selectors:[["ngx-features-viewer"]],contentQueries:function(r,i,o){if(1&r&&N8(o,H2e,5),2&r){let s;MT(s=RT())&&(i.label=s.first)}},viewQuery:function(r,i){if(1&r&&F8(fRt,5),2&r){let o;MT(o=RT())&&(i._root=o.first)}},hostBindings:function(r,i){1&r&&Fx("resize",function(s){return i.onResize(s)},0,AZ)},inputs:{settings:"settings",features:"features",sequence:"sequence"},standalone:!0,features:[NT([xk,RK,gCe,vCe,yCe]),Oo,Dh],decls:3,vars:1,consts:[["root",""],[2,"position","relative","display","block","width","100%","height","100%"],["tabindex","0",3,"id"],["tabindex","0",3,"click","keyup","id"],[3,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(r,i){1&r&&(br(0,"div",1,0),Ym(2,mRt,3,2),Sr()),2&r&&(Yc(2),ST(2,i.label?2:-1))},dependencies:[L0,nre,rre],styles:['@charset "UTF-8";.labels #label-sequence .parent div{cursor:default}.labels #label-sequence .parent div i{display:none}.labels .label .children-0>i{visibility:hidden}.labels .label i:before{transition:transform .4s}.labels .label.active i:before{transform:roate(0deg)}.labels .label:not(.active) i:before{transform:rotate(-90deg)}.labels .label div{display:flex;flex-direction:row;flex-wrap:nowrap;justify-content:space-between;align-items:center;box-sizing:border-box;height:100%;width:100%;cursor:pointer}.labels .label div span{text-wrap:wrap;line-break:anywhere;flex-shrink:1;flex-grow:1}.labels .label div i{flex-shrink:0;flex-grow:0}.labels div.depth-0{width:100%;padding:0 .25rem 0 .75rem}.labels div.depth-1{width:100%;padding:0 .25rem 0 1.5rem}.labels div.depth-2{width:100%;padding:0 .25rem 0 2.25rem}.labels div.depth-3{width:100%;padding:0 .25rem 0 3rem}.labels div.depth-4{width:100%;padding:0 .25rem 0 3.75rem}.labels div.depth-5{width:100%;padding:0 .25rem 0 4.5rem}/*!\n * Bootstrap Icons v1.11.3 (https://icons.getbootstrap.com/)\n * Copyright 2019-2024 The Bootstrap Authors\n * Licensed under MIT (https://github.com/twbs/icons/blob/main/LICENSE)\n */@font-face{font-display:block;font-family:bootstrap-icons;src:url(bootstrap-icons.bfa90bda92a84a6a.woff2) format("woff2"),url(bootstrap-icons.70a9dee9e5ab72aa.woff) format("woff")}.bi:before,[class^=bi-]:before,[class*=" bi-"]:before{display:inline-block;font-family:bootstrap-icons!important;font-style:normal;font-weight:400!important;font-variant:normal;text-transform:none;line-height:1;vertical-align:-.125em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.bi-123:before{content:"\\f67f"}.bi-alarm-fill:before{content:"\\f101"}.bi-alarm:before{content:"\\f102"}.bi-align-bottom:before{content:"\\f103"}.bi-align-center:before{content:"\\f104"}.bi-align-end:before{content:"\\f105"}.bi-align-middle:before{content:"\\f106"}.bi-align-start:before{content:"\\f107"}.bi-align-top:before{content:"\\f108"}.bi-alt:before{content:"\\f109"}.bi-app-indicator:before{content:"\\f10a"}.bi-app:before{content:"\\f10b"}.bi-archive-fill:before{content:"\\f10c"}.bi-archive:before{content:"\\f10d"}.bi-arrow-90deg-down:before{content:"\\f10e"}.bi-arrow-90deg-left:before{content:"\\f10f"}.bi-arrow-90deg-right:before{content:"\\f110"}.bi-arrow-90deg-up:before{content:"\\f111"}.bi-arrow-bar-down:before{content:"\\f112"}.bi-arrow-bar-left:before{content:"\\f113"}.bi-arrow-bar-right:before{content:"\\f114"}.bi-arrow-bar-up:before{content:"\\f115"}.bi-arrow-clockwise:before{content:"\\f116"}.bi-arrow-counterclockwise:before{content:"\\f117"}.bi-arrow-down-circle-fill:before{content:"\\f118"}.bi-arrow-down-circle:before{content:"\\f119"}.bi-arrow-down-left-circle-fill:before{content:"\\f11a"}.bi-arrow-down-left-circle:before{content:"\\f11b"}.bi-arrow-down-left-square-fill:before{content:"\\f11c"}.bi-arrow-down-left-square:before{content:"\\f11d"}.bi-arrow-down-left:before{content:"\\f11e"}.bi-arrow-down-right-circle-fill:before{content:"\\f11f"}.bi-arrow-down-right-circle:before{content:"\\f120"}.bi-arrow-down-right-square-fill:before{content:"\\f121"}.bi-arrow-down-right-square:before{content:"\\f122"}.bi-arrow-down-right:before{content:"\\f123"}.bi-arrow-down-short:before{content:"\\f124"}.bi-arrow-down-square-fill:before{content:"\\f125"}.bi-arrow-down-square:before{content:"\\f126"}.bi-arrow-down-up:before{content:"\\f127"}.bi-arrow-down:before{content:"\\f128"}.bi-arrow-left-circle-fill:before{content:"\\f129"}.bi-arrow-left-circle:before{content:"\\f12a"}.bi-arrow-left-right:before{content:"\\f12b"}.bi-arrow-left-short:before{content:"\\f12c"}.bi-arrow-left-square-fill:before{content:"\\f12d"}.bi-arrow-left-square:before{content:"\\f12e"}.bi-arrow-left:before{content:"\\f12f"}.bi-arrow-repeat:before{content:"\\f130"}.bi-arrow-return-left:before{content:"\\f131"}.bi-arrow-return-right:before{content:"\\f132"}.bi-arrow-right-circle-fill:before{content:"\\f133"}.bi-arrow-right-circle:before{content:"\\f134"}.bi-arrow-right-short:before{content:"\\f135"}.bi-arrow-right-square-fill:before{content:"\\f136"}.bi-arrow-right-square:before{content:"\\f137"}.bi-arrow-right:before{content:"\\f138"}.bi-arrow-up-circle-fill:before{content:"\\f139"}.bi-arrow-up-circle:before{content:"\\f13a"}.bi-arrow-up-left-circle-fill:before{content:"\\f13b"}.bi-arrow-up-left-circle:before{content:"\\f13c"}.bi-arrow-up-left-square-fill:before{content:"\\f13d"}.bi-arrow-up-left-square:before{content:"\\f13e"}.bi-arrow-up-left:before{content:"\\f13f"}.bi-arrow-up-right-circle-fill:before{content:"\\f140"}.bi-arrow-up-right-circle:before{content:"\\f141"}.bi-arrow-up-right-square-fill:before{content:"\\f142"}.bi-arrow-up-right-square:before{content:"\\f143"}.bi-arrow-up-right:before{content:"\\f144"}.bi-arrow-up-short:before{content:"\\f145"}.bi-arrow-up-square-fill:before{content:"\\f146"}.bi-arrow-up-square:before{content:"\\f147"}.bi-arrow-up:before{content:"\\f148"}.bi-arrows-angle-contract:before{content:"\\f149"}.bi-arrows-angle-expand:before{content:"\\f14a"}.bi-arrows-collapse:before{content:"\\f14b"}.bi-arrows-expand:before{content:"\\f14c"}.bi-arrows-fullscreen:before{content:"\\f14d"}.bi-arrows-move:before{content:"\\f14e"}.bi-aspect-ratio-fill:before{content:"\\f14f"}.bi-aspect-ratio:before{content:"\\f150"}.bi-asterisk:before{content:"\\f151"}.bi-at:before{content:"\\f152"}.bi-award-fill:before{content:"\\f153"}.bi-award:before{content:"\\f154"}.bi-back:before{content:"\\f155"}.bi-backspace-fill:before{content:"\\f156"}.bi-backspace-reverse-fill:before{content:"\\f157"}.bi-backspace-reverse:before{content:"\\f158"}.bi-backspace:before{content:"\\f159"}.bi-badge-3d-fill:before{content:"\\f15a"}.bi-badge-3d:before{content:"\\f15b"}.bi-badge-4k-fill:before{content:"\\f15c"}.bi-badge-4k:before{content:"\\f15d"}.bi-badge-8k-fill:before{content:"\\f15e"}.bi-badge-8k:before{content:"\\f15f"}.bi-badge-ad-fill:before{content:"\\f160"}.bi-badge-ad:before{content:"\\f161"}.bi-badge-ar-fill:before{content:"\\f162"}.bi-badge-ar:before{content:"\\f163"}.bi-badge-cc-fill:before{content:"\\f164"}.bi-badge-cc:before{content:"\\f165"}.bi-badge-hd-fill:before{content:"\\f166"}.bi-badge-hd:before{content:"\\f167"}.bi-badge-tm-fill:before{content:"\\f168"}.bi-badge-tm:before{content:"\\f169"}.bi-badge-vo-fill:before{content:"\\f16a"}.bi-badge-vo:before{content:"\\f16b"}.bi-badge-vr-fill:before{content:"\\f16c"}.bi-badge-vr:before{content:"\\f16d"}.bi-badge-wc-fill:before{content:"\\f16e"}.bi-badge-wc:before{content:"\\f16f"}.bi-bag-check-fill:before{content:"\\f170"}.bi-bag-check:before{content:"\\f171"}.bi-bag-dash-fill:before{content:"\\f172"}.bi-bag-dash:before{content:"\\f173"}.bi-bag-fill:before{content:"\\f174"}.bi-bag-plus-fill:before{content:"\\f175"}.bi-bag-plus:before{content:"\\f176"}.bi-bag-x-fill:before{content:"\\f177"}.bi-bag-x:before{content:"\\f178"}.bi-bag:before{content:"\\f179"}.bi-bar-chart-fill:before{content:"\\f17a"}.bi-bar-chart-line-fill:before{content:"\\f17b"}.bi-bar-chart-line:before{content:"\\f17c"}.bi-bar-chart-steps:before{content:"\\f17d"}.bi-bar-chart:before{content:"\\f17e"}.bi-basket-fill:before{content:"\\f17f"}.bi-basket:before{content:"\\f180"}.bi-basket2-fill:before{content:"\\f181"}.bi-basket2:before{content:"\\f182"}.bi-basket3-fill:before{content:"\\f183"}.bi-basket3:before{content:"\\f184"}.bi-battery-charging:before{content:"\\f185"}.bi-battery-full:before{content:"\\f186"}.bi-battery-half:before{content:"\\f187"}.bi-battery:before{content:"\\f188"}.bi-bell-fill:before{content:"\\f189"}.bi-bell:before{content:"\\f18a"}.bi-bezier:before{content:"\\f18b"}.bi-bezier2:before{content:"\\f18c"}.bi-bicycle:before{content:"\\f18d"}.bi-binoculars-fill:before{content:"\\f18e"}.bi-binoculars:before{content:"\\f18f"}.bi-blockquote-left:before{content:"\\f190"}.bi-blockquote-right:before{content:"\\f191"}.bi-book-fill:before{content:"\\f192"}.bi-book-half:before{content:"\\f193"}.bi-book:before{content:"\\f194"}.bi-bookmark-check-fill:before{content:"\\f195"}.bi-bookmark-check:before{content:"\\f196"}.bi-bookmark-dash-fill:before{content:"\\f197"}.bi-bookmark-dash:before{content:"\\f198"}.bi-bookmark-fill:before{content:"\\f199"}.bi-bookmark-heart-fill:before{content:"\\f19a"}.bi-bookmark-heart:before{content:"\\f19b"}.bi-bookmark-plus-fill:before{content:"\\f19c"}.bi-bookmark-plus:before{content:"\\f19d"}.bi-bookmark-star-fill:before{content:"\\f19e"}.bi-bookmark-star:before{content:"\\f19f"}.bi-bookmark-x-fill:before{content:"\\f1a0"}.bi-bookmark-x:before{content:"\\f1a1"}.bi-bookmark:before{content:"\\f1a2"}.bi-bookmarks-fill:before{content:"\\f1a3"}.bi-bookmarks:before{content:"\\f1a4"}.bi-bookshelf:before{content:"\\f1a5"}.bi-bootstrap-fill:before{content:"\\f1a6"}.bi-bootstrap-reboot:before{content:"\\f1a7"}.bi-bootstrap:before{content:"\\f1a8"}.bi-border-all:before{content:"\\f1a9"}.bi-border-bottom:before{content:"\\f1aa"}.bi-border-center:before{content:"\\f1ab"}.bi-border-inner:before{content:"\\f1ac"}.bi-border-left:before{content:"\\f1ad"}.bi-border-middle:before{content:"\\f1ae"}.bi-border-outer:before{content:"\\f1af"}.bi-border-right:before{content:"\\f1b0"}.bi-border-style:before{content:"\\f1b1"}.bi-border-top:before{content:"\\f1b2"}.bi-border-width:before{content:"\\f1b3"}.bi-border:before{content:"\\f1b4"}.bi-bounding-box-circles:before{content:"\\f1b5"}.bi-bounding-box:before{content:"\\f1b6"}.bi-box-arrow-down-left:before{content:"\\f1b7"}.bi-box-arrow-down-right:before{content:"\\f1b8"}.bi-box-arrow-down:before{content:"\\f1b9"}.bi-box-arrow-in-down-left:before{content:"\\f1ba"}.bi-box-arrow-in-down-right:before{content:"\\f1bb"}.bi-box-arrow-in-down:before{content:"\\f1bc"}.bi-box-arrow-in-left:before{content:"\\f1bd"}.bi-box-arrow-in-right:before{content:"\\f1be"}.bi-box-arrow-in-up-left:before{content:"\\f1bf"}.bi-box-arrow-in-up-right:before{content:"\\f1c0"}.bi-box-arrow-in-up:before{content:"\\f1c1"}.bi-box-arrow-left:before{content:"\\f1c2"}.bi-box-arrow-right:before{content:"\\f1c3"}.bi-box-arrow-up-left:before{content:"\\f1c4"}.bi-box-arrow-up-right:before{content:"\\f1c5"}.bi-box-arrow-up:before{content:"\\f1c6"}.bi-box-seam:before{content:"\\f1c7"}.bi-box:before{content:"\\f1c8"}.bi-braces:before{content:"\\f1c9"}.bi-bricks:before{content:"\\f1ca"}.bi-briefcase-fill:before{content:"\\f1cb"}.bi-briefcase:before{content:"\\f1cc"}.bi-brightness-alt-high-fill:before{content:"\\f1cd"}.bi-brightness-alt-high:before{content:"\\f1ce"}.bi-brightness-alt-low-fill:before{content:"\\f1cf"}.bi-brightness-alt-low:before{content:"\\f1d0"}.bi-brightness-high-fill:before{content:"\\f1d1"}.bi-brightness-high:before{content:"\\f1d2"}.bi-brightness-low-fill:before{content:"\\f1d3"}.bi-brightness-low:before{content:"\\f1d4"}.bi-broadcast-pin:before{content:"\\f1d5"}.bi-broadcast:before{content:"\\f1d6"}.bi-brush-fill:before{content:"\\f1d7"}.bi-brush:before{content:"\\f1d8"}.bi-bucket-fill:before{content:"\\f1d9"}.bi-bucket:before{content:"\\f1da"}.bi-bug-fill:before{content:"\\f1db"}.bi-bug:before{content:"\\f1dc"}.bi-building:before{content:"\\f1dd"}.bi-bullseye:before{content:"\\f1de"}.bi-calculator-fill:before{content:"\\f1df"}.bi-calculator:before{content:"\\f1e0"}.bi-calendar-check-fill:before{content:"\\f1e1"}.bi-calendar-check:before{content:"\\f1e2"}.bi-calendar-date-fill:before{content:"\\f1e3"}.bi-calendar-date:before{content:"\\f1e4"}.bi-calendar-day-fill:before{content:"\\f1e5"}.bi-calendar-day:before{content:"\\f1e6"}.bi-calendar-event-fill:before{content:"\\f1e7"}.bi-calendar-event:before{content:"\\f1e8"}.bi-calendar-fill:before{content:"\\f1e9"}.bi-calendar-minus-fill:before{content:"\\f1ea"}.bi-calendar-minus:before{content:"\\f1eb"}.bi-calendar-month-fill:before{content:"\\f1ec"}.bi-calendar-month:before{content:"\\f1ed"}.bi-calendar-plus-fill:before{content:"\\f1ee"}.bi-calendar-plus:before{content:"\\f1ef"}.bi-calendar-range-fill:before{content:"\\f1f0"}.bi-calendar-range:before{content:"\\f1f1"}.bi-calendar-week-fill:before{content:"\\f1f2"}.bi-calendar-week:before{content:"\\f1f3"}.bi-calendar-x-fill:before{content:"\\f1f4"}.bi-calendar-x:before{content:"\\f1f5"}.bi-calendar:before{content:"\\f1f6"}.bi-calendar2-check-fill:before{content:"\\f1f7"}.bi-calendar2-check:before{content:"\\f1f8"}.bi-calendar2-date-fill:before{content:"\\f1f9"}.bi-calendar2-date:before{content:"\\f1fa"}.bi-calendar2-day-fill:before{content:"\\f1fb"}.bi-calendar2-day:before{content:"\\f1fc"}.bi-calendar2-event-fill:before{content:"\\f1fd"}.bi-calendar2-event:before{content:"\\f1fe"}.bi-calendar2-fill:before{content:"\\f1ff"}.bi-calendar2-minus-fill:before{content:"\\f200"}.bi-calendar2-minus:before{content:"\\f201"}.bi-calendar2-month-fill:before{content:"\\f202"}.bi-calendar2-month:before{content:"\\f203"}.bi-calendar2-plus-fill:before{content:"\\f204"}.bi-calendar2-plus:before{content:"\\f205"}.bi-calendar2-range-fill:before{content:"\\f206"}.bi-calendar2-range:before{content:"\\f207"}.bi-calendar2-week-fill:before{content:"\\f208"}.bi-calendar2-week:before{content:"\\f209"}.bi-calendar2-x-fill:before{content:"\\f20a"}.bi-calendar2-x:before{content:"\\f20b"}.bi-calendar2:before{content:"\\f20c"}.bi-calendar3-event-fill:before{content:"\\f20d"}.bi-calendar3-event:before{content:"\\f20e"}.bi-calendar3-fill:before{content:"\\f20f"}.bi-calendar3-range-fill:before{content:"\\f210"}.bi-calendar3-range:before{content:"\\f211"}.bi-calendar3-week-fill:before{content:"\\f212"}.bi-calendar3-week:before{content:"\\f213"}.bi-calendar3:before{content:"\\f214"}.bi-calendar4-event:before{content:"\\f215"}.bi-calendar4-range:before{content:"\\f216"}.bi-calendar4-week:before{content:"\\f217"}.bi-calendar4:before{content:"\\f218"}.bi-camera-fill:before{content:"\\f219"}.bi-camera-reels-fill:before{content:"\\f21a"}.bi-camera-reels:before{content:"\\f21b"}.bi-camera-video-fill:before{content:"\\f21c"}.bi-camera-video-off-fill:before{content:"\\f21d"}.bi-camera-video-off:before{content:"\\f21e"}.bi-camera-video:before{content:"\\f21f"}.bi-camera:before{content:"\\f220"}.bi-camera2:before{content:"\\f221"}.bi-capslock-fill:before{content:"\\f222"}.bi-capslock:before{content:"\\f223"}.bi-card-checklist:before{content:"\\f224"}.bi-card-heading:before{content:"\\f225"}.bi-card-image:before{content:"\\f226"}.bi-card-list:before{content:"\\f227"}.bi-card-text:before{content:"\\f228"}.bi-caret-down-fill:before{content:"\\f229"}.bi-caret-down-square-fill:before{content:"\\f22a"}.bi-caret-down-square:before{content:"\\f22b"}.bi-caret-down:before{content:"\\f22c"}.bi-caret-left-fill:before{content:"\\f22d"}.bi-caret-left-square-fill:before{content:"\\f22e"}.bi-caret-left-square:before{content:"\\f22f"}.bi-caret-left:before{content:"\\f230"}.bi-caret-right-fill:before{content:"\\f231"}.bi-caret-right-square-fill:before{content:"\\f232"}.bi-caret-right-square:before{content:"\\f233"}.bi-caret-right:before{content:"\\f234"}.bi-caret-up-fill:before{content:"\\f235"}.bi-caret-up-square-fill:before{content:"\\f236"}.bi-caret-up-square:before{content:"\\f237"}.bi-caret-up:before{content:"\\f238"}.bi-cart-check-fill:before{content:"\\f239"}.bi-cart-check:before{content:"\\f23a"}.bi-cart-dash-fill:before{content:"\\f23b"}.bi-cart-dash:before{content:"\\f23c"}.bi-cart-fill:before{content:"\\f23d"}.bi-cart-plus-fill:before{content:"\\f23e"}.bi-cart-plus:before{content:"\\f23f"}.bi-cart-x-fill:before{content:"\\f240"}.bi-cart-x:before{content:"\\f241"}.bi-cart:before{content:"\\f242"}.bi-cart2:before{content:"\\f243"}.bi-cart3:before{content:"\\f244"}.bi-cart4:before{content:"\\f245"}.bi-cash-stack:before{content:"\\f246"}.bi-cash:before{content:"\\f247"}.bi-cast:before{content:"\\f248"}.bi-chat-dots-fill:before{content:"\\f249"}.bi-chat-dots:before{content:"\\f24a"}.bi-chat-fill:before{content:"\\f24b"}.bi-chat-left-dots-fill:before{content:"\\f24c"}.bi-chat-left-dots:before{content:"\\f24d"}.bi-chat-left-fill:before{content:"\\f24e"}.bi-chat-left-quote-fill:before{content:"\\f24f"}.bi-chat-left-quote:before{content:"\\f250"}.bi-chat-left-text-fill:before{content:"\\f251"}.bi-chat-left-text:before{content:"\\f252"}.bi-chat-left:before{content:"\\f253"}.bi-chat-quote-fill:before{content:"\\f254"}.bi-chat-quote:before{content:"\\f255"}.bi-chat-right-dots-fill:before{content:"\\f256"}.bi-chat-right-dots:before{content:"\\f257"}.bi-chat-right-fill:before{content:"\\f258"}.bi-chat-right-quote-fill:before{content:"\\f259"}.bi-chat-right-quote:before{content:"\\f25a"}.bi-chat-right-text-fill:before{content:"\\f25b"}.bi-chat-right-text:before{content:"\\f25c"}.bi-chat-right:before{content:"\\f25d"}.bi-chat-square-dots-fill:before{content:"\\f25e"}.bi-chat-square-dots:before{content:"\\f25f"}.bi-chat-square-fill:before{content:"\\f260"}.bi-chat-square-quote-fill:before{content:"\\f261"}.bi-chat-square-quote:before{content:"\\f262"}.bi-chat-square-text-fill:before{content:"\\f263"}.bi-chat-square-text:before{content:"\\f264"}.bi-chat-square:before{content:"\\f265"}.bi-chat-text-fill:before{content:"\\f266"}.bi-chat-text:before{content:"\\f267"}.bi-chat:before{content:"\\f268"}.bi-check-all:before{content:"\\f269"}.bi-check-circle-fill:before{content:"\\f26a"}.bi-check-circle:before{content:"\\f26b"}.bi-check-square-fill:before{content:"\\f26c"}.bi-check-square:before{content:"\\f26d"}.bi-check:before{content:"\\f26e"}.bi-check2-all:before{content:"\\f26f"}.bi-check2-circle:before{content:"\\f270"}.bi-check2-square:before{content:"\\f271"}.bi-check2:before{content:"\\f272"}.bi-chevron-bar-contract:before{content:"\\f273"}.bi-chevron-bar-down:before{content:"\\f274"}.bi-chevron-bar-expand:before{content:"\\f275"}.bi-chevron-bar-left:before{content:"\\f276"}.bi-chevron-bar-right:before{content:"\\f277"}.bi-chevron-bar-up:before{content:"\\f278"}.bi-chevron-compact-down:before{content:"\\f279"}.bi-chevron-compact-left:before{content:"\\f27a"}.bi-chevron-compact-right:before{content:"\\f27b"}.bi-chevron-compact-up:before{content:"\\f27c"}.bi-chevron-contract:before{content:"\\f27d"}.bi-chevron-double-down:before{content:"\\f27e"}.bi-chevron-double-left:before{content:"\\f27f"}.bi-chevron-double-right:before{content:"\\f280"}.bi-chevron-double-up:before{content:"\\f281"}.bi-chevron-down:before{content:"\\f282"}.bi-chevron-expand:before{content:"\\f283"}.bi-chevron-left:before{content:"\\f284"}.bi-chevron-right:before{content:"\\f285"}.bi-chevron-up:before{content:"\\f286"}.bi-circle-fill:before{content:"\\f287"}.bi-circle-half:before{content:"\\f288"}.bi-circle-square:before{content:"\\f289"}.bi-circle:before{content:"\\f28a"}.bi-clipboard-check:before{content:"\\f28b"}.bi-clipboard-data:before{content:"\\f28c"}.bi-clipboard-minus:before{content:"\\f28d"}.bi-clipboard-plus:before{content:"\\f28e"}.bi-clipboard-x:before{content:"\\f28f"}.bi-clipboard:before{content:"\\f290"}.bi-clock-fill:before{content:"\\f291"}.bi-clock-history:before{content:"\\f292"}.bi-clock:before{content:"\\f293"}.bi-cloud-arrow-down-fill:before{content:"\\f294"}.bi-cloud-arrow-down:before{content:"\\f295"}.bi-cloud-arrow-up-fill:before{content:"\\f296"}.bi-cloud-arrow-up:before{content:"\\f297"}.bi-cloud-check-fill:before{content:"\\f298"}.bi-cloud-check:before{content:"\\f299"}.bi-cloud-download-fill:before{content:"\\f29a"}.bi-cloud-download:before{content:"\\f29b"}.bi-cloud-drizzle-fill:before{content:"\\f29c"}.bi-cloud-drizzle:before{content:"\\f29d"}.bi-cloud-fill:before{content:"\\f29e"}.bi-cloud-fog-fill:before{content:"\\f29f"}.bi-cloud-fog:before{content:"\\f2a0"}.bi-cloud-fog2-fill:before{content:"\\f2a1"}.bi-cloud-fog2:before{content:"\\f2a2"}.bi-cloud-hail-fill:before{content:"\\f2a3"}.bi-cloud-hail:before{content:"\\f2a4"}.bi-cloud-haze-fill:before{content:"\\f2a6"}.bi-cloud-haze:before{content:"\\f2a7"}.bi-cloud-haze2-fill:before{content:"\\f2a8"}.bi-cloud-lightning-fill:before{content:"\\f2a9"}.bi-cloud-lightning-rain-fill:before{content:"\\f2aa"}.bi-cloud-lightning-rain:before{content:"\\f2ab"}.bi-cloud-lightning:before{content:"\\f2ac"}.bi-cloud-minus-fill:before{content:"\\f2ad"}.bi-cloud-minus:before{content:"\\f2ae"}.bi-cloud-moon-fill:before{content:"\\f2af"}.bi-cloud-moon:before{content:"\\f2b0"}.bi-cloud-plus-fill:before{content:"\\f2b1"}.bi-cloud-plus:before{content:"\\f2b2"}.bi-cloud-rain-fill:before{content:"\\f2b3"}.bi-cloud-rain-heavy-fill:before{content:"\\f2b4"}.bi-cloud-rain-heavy:before{content:"\\f2b5"}.bi-cloud-rain:before{content:"\\f2b6"}.bi-cloud-slash-fill:before{content:"\\f2b7"}.bi-cloud-slash:before{content:"\\f2b8"}.bi-cloud-sleet-fill:before{content:"\\f2b9"}.bi-cloud-sleet:before{content:"\\f2ba"}.bi-cloud-snow-fill:before{content:"\\f2bb"}.bi-cloud-snow:before{content:"\\f2bc"}.bi-cloud-sun-fill:before{content:"\\f2bd"}.bi-cloud-sun:before{content:"\\f2be"}.bi-cloud-upload-fill:before{content:"\\f2bf"}.bi-cloud-upload:before{content:"\\f2c0"}.bi-cloud:before{content:"\\f2c1"}.bi-clouds-fill:before{content:"\\f2c2"}.bi-clouds:before{content:"\\f2c3"}.bi-cloudy-fill:before{content:"\\f2c4"}.bi-cloudy:before{content:"\\f2c5"}.bi-code-slash:before{content:"\\f2c6"}.bi-code-square:before{content:"\\f2c7"}.bi-code:before{content:"\\f2c8"}.bi-collection-fill:before{content:"\\f2c9"}.bi-collection-play-fill:before{content:"\\f2ca"}.bi-collection-play:before{content:"\\f2cb"}.bi-collection:before{content:"\\f2cc"}.bi-columns-gap:before{content:"\\f2cd"}.bi-columns:before{content:"\\f2ce"}.bi-command:before{content:"\\f2cf"}.bi-compass-fill:before{content:"\\f2d0"}.bi-compass:before{content:"\\f2d1"}.bi-cone-striped:before{content:"\\f2d2"}.bi-cone:before{content:"\\f2d3"}.bi-controller:before{content:"\\f2d4"}.bi-cpu-fill:before{content:"\\f2d5"}.bi-cpu:before{content:"\\f2d6"}.bi-credit-card-2-back-fill:before{content:"\\f2d7"}.bi-credit-card-2-back:before{content:"\\f2d8"}.bi-credit-card-2-front-fill:before{content:"\\f2d9"}.bi-credit-card-2-front:before{content:"\\f2da"}.bi-credit-card-fill:before{content:"\\f2db"}.bi-credit-card:before{content:"\\f2dc"}.bi-crop:before{content:"\\f2dd"}.bi-cup-fill:before{content:"\\f2de"}.bi-cup-straw:before{content:"\\f2df"}.bi-cup:before{content:"\\f2e0"}.bi-cursor-fill:before{content:"\\f2e1"}.bi-cursor-text:before{content:"\\f2e2"}.bi-cursor:before{content:"\\f2e3"}.bi-dash-circle-dotted:before{content:"\\f2e4"}.bi-dash-circle-fill:before{content:"\\f2e5"}.bi-dash-circle:before{content:"\\f2e6"}.bi-dash-square-dotted:before{content:"\\f2e7"}.bi-dash-square-fill:before{content:"\\f2e8"}.bi-dash-square:before{content:"\\f2e9"}.bi-dash:before{content:"\\f2ea"}.bi-diagram-2-fill:before{content:"\\f2eb"}.bi-diagram-2:before{content:"\\f2ec"}.bi-diagram-3-fill:before{content:"\\f2ed"}.bi-diagram-3:before{content:"\\f2ee"}.bi-diamond-fill:before{content:"\\f2ef"}.bi-diamond-half:before{content:"\\f2f0"}.bi-diamond:before{content:"\\f2f1"}.bi-dice-1-fill:before{content:"\\f2f2"}.bi-dice-1:before{content:"\\f2f3"}.bi-dice-2-fill:before{content:"\\f2f4"}.bi-dice-2:before{content:"\\f2f5"}.bi-dice-3-fill:before{content:"\\f2f6"}.bi-dice-3:before{content:"\\f2f7"}.bi-dice-4-fill:before{content:"\\f2f8"}.bi-dice-4:before{content:"\\f2f9"}.bi-dice-5-fill:before{content:"\\f2fa"}.bi-dice-5:before{content:"\\f2fb"}.bi-dice-6-fill:before{content:"\\f2fc"}.bi-dice-6:before{content:"\\f2fd"}.bi-disc-fill:before{content:"\\f2fe"}.bi-disc:before{content:"\\f2ff"}.bi-discord:before{content:"\\f300"}.bi-display-fill:before{content:"\\f301"}.bi-display:before{content:"\\f302"}.bi-distribute-horizontal:before{content:"\\f303"}.bi-distribute-vertical:before{content:"\\f304"}.bi-door-closed-fill:before{content:"\\f305"}.bi-door-closed:before{content:"\\f306"}.bi-door-open-fill:before{content:"\\f307"}.bi-door-open:before{content:"\\f308"}.bi-dot:before{content:"\\f309"}.bi-download:before{content:"\\f30a"}.bi-droplet-fill:before{content:"\\f30b"}.bi-droplet-half:before{content:"\\f30c"}.bi-droplet:before{content:"\\f30d"}.bi-earbuds:before{content:"\\f30e"}.bi-easel-fill:before{content:"\\f30f"}.bi-easel:before{content:"\\f310"}.bi-egg-fill:before{content:"\\f311"}.bi-egg-fried:before{content:"\\f312"}.bi-egg:before{content:"\\f313"}.bi-eject-fill:before{content:"\\f314"}.bi-eject:before{content:"\\f315"}.bi-emoji-angry-fill:before{content:"\\f316"}.bi-emoji-angry:before{content:"\\f317"}.bi-emoji-dizzy-fill:before{content:"\\f318"}.bi-emoji-dizzy:before{content:"\\f319"}.bi-emoji-expressionless-fill:before{content:"\\f31a"}.bi-emoji-expressionless:before{content:"\\f31b"}.bi-emoji-frown-fill:before{content:"\\f31c"}.bi-emoji-frown:before{content:"\\f31d"}.bi-emoji-heart-eyes-fill:before{content:"\\f31e"}.bi-emoji-heart-eyes:before{content:"\\f31f"}.bi-emoji-laughing-fill:before{content:"\\f320"}.bi-emoji-laughing:before{content:"\\f321"}.bi-emoji-neutral-fill:before{content:"\\f322"}.bi-emoji-neutral:before{content:"\\f323"}.bi-emoji-smile-fill:before{content:"\\f324"}.bi-emoji-smile-upside-down-fill:before{content:"\\f325"}.bi-emoji-smile-upside-down:before{content:"\\f326"}.bi-emoji-smile:before{content:"\\f327"}.bi-emoji-sunglasses-fill:before{content:"\\f328"}.bi-emoji-sunglasses:before{content:"\\f329"}.bi-emoji-wink-fill:before{content:"\\f32a"}.bi-emoji-wink:before{content:"\\f32b"}.bi-envelope-fill:before{content:"\\f32c"}.bi-envelope-open-fill:before{content:"\\f32d"}.bi-envelope-open:before{content:"\\f32e"}.bi-envelope:before{content:"\\f32f"}.bi-eraser-fill:before{content:"\\f330"}.bi-eraser:before{content:"\\f331"}.bi-exclamation-circle-fill:before{content:"\\f332"}.bi-exclamation-circle:before{content:"\\f333"}.bi-exclamation-diamond-fill:before{content:"\\f334"}.bi-exclamation-diamond:before{content:"\\f335"}.bi-exclamation-octagon-fill:before{content:"\\f336"}.bi-exclamation-octagon:before{content:"\\f337"}.bi-exclamation-square-fill:before{content:"\\f338"}.bi-exclamation-square:before{content:"\\f339"}.bi-exclamation-triangle-fill:before{content:"\\f33a"}.bi-exclamation-triangle:before{content:"\\f33b"}.bi-exclamation:before{content:"\\f33c"}.bi-exclude:before{content:"\\f33d"}.bi-eye-fill:before{content:"\\f33e"}.bi-eye-slash-fill:before{content:"\\f33f"}.bi-eye-slash:before{content:"\\f340"}.bi-eye:before{content:"\\f341"}.bi-eyedropper:before{content:"\\f342"}.bi-eyeglasses:before{content:"\\f343"}.bi-facebook:before{content:"\\f344"}.bi-file-arrow-down-fill:before{content:"\\f345"}.bi-file-arrow-down:before{content:"\\f346"}.bi-file-arrow-up-fill:before{content:"\\f347"}.bi-file-arrow-up:before{content:"\\f348"}.bi-file-bar-graph-fill:before{content:"\\f349"}.bi-file-bar-graph:before{content:"\\f34a"}.bi-file-binary-fill:before{content:"\\f34b"}.bi-file-binary:before{content:"\\f34c"}.bi-file-break-fill:before{content:"\\f34d"}.bi-file-break:before{content:"\\f34e"}.bi-file-check-fill:before{content:"\\f34f"}.bi-file-check:before{content:"\\f350"}.bi-file-code-fill:before{content:"\\f351"}.bi-file-code:before{content:"\\f352"}.bi-file-diff-fill:before{content:"\\f353"}.bi-file-diff:before{content:"\\f354"}.bi-file-earmark-arrow-down-fill:before{content:"\\f355"}.bi-file-earmark-arrow-down:before{content:"\\f356"}.bi-file-earmark-arrow-up-fill:before{content:"\\f357"}.bi-file-earmark-arrow-up:before{content:"\\f358"}.bi-file-earmark-bar-graph-fill:before{content:"\\f359"}.bi-file-earmark-bar-graph:before{content:"\\f35a"}.bi-file-earmark-binary-fill:before{content:"\\f35b"}.bi-file-earmark-binary:before{content:"\\f35c"}.bi-file-earmark-break-fill:before{content:"\\f35d"}.bi-file-earmark-break:before{content:"\\f35e"}.bi-file-earmark-check-fill:before{content:"\\f35f"}.bi-file-earmark-check:before{content:"\\f360"}.bi-file-earmark-code-fill:before{content:"\\f361"}.bi-file-earmark-code:before{content:"\\f362"}.bi-file-earmark-diff-fill:before{content:"\\f363"}.bi-file-earmark-diff:before{content:"\\f364"}.bi-file-earmark-easel-fill:before{content:"\\f365"}.bi-file-earmark-easel:before{content:"\\f366"}.bi-file-earmark-excel-fill:before{content:"\\f367"}.bi-file-earmark-excel:before{content:"\\f368"}.bi-file-earmark-fill:before{content:"\\f369"}.bi-file-earmark-font-fill:before{content:"\\f36a"}.bi-file-earmark-font:before{content:"\\f36b"}.bi-file-earmark-image-fill:before{content:"\\f36c"}.bi-file-earmark-image:before{content:"\\f36d"}.bi-file-earmark-lock-fill:before{content:"\\f36e"}.bi-file-earmark-lock:before{content:"\\f36f"}.bi-file-earmark-lock2-fill:before{content:"\\f370"}.bi-file-earmark-lock2:before{content:"\\f371"}.bi-file-earmark-medical-fill:before{content:"\\f372"}.bi-file-earmark-medical:before{content:"\\f373"}.bi-file-earmark-minus-fill:before{content:"\\f374"}.bi-file-earmark-minus:before{content:"\\f375"}.bi-file-earmark-music-fill:before{content:"\\f376"}.bi-file-earmark-music:before{content:"\\f377"}.bi-file-earmark-person-fill:before{content:"\\f378"}.bi-file-earmark-person:before{content:"\\f379"}.bi-file-earmark-play-fill:before{content:"\\f37a"}.bi-file-earmark-play:before{content:"\\f37b"}.bi-file-earmark-plus-fill:before{content:"\\f37c"}.bi-file-earmark-plus:before{content:"\\f37d"}.bi-file-earmark-post-fill:before{content:"\\f37e"}.bi-file-earmark-post:before{content:"\\f37f"}.bi-file-earmark-ppt-fill:before{content:"\\f380"}.bi-file-earmark-ppt:before{content:"\\f381"}.bi-file-earmark-richtext-fill:before{content:"\\f382"}.bi-file-earmark-richtext:before{content:"\\f383"}.bi-file-earmark-ruled-fill:before{content:"\\f384"}.bi-file-earmark-ruled:before{content:"\\f385"}.bi-file-earmark-slides-fill:before{content:"\\f386"}.bi-file-earmark-slides:before{content:"\\f387"}.bi-file-earmark-spreadsheet-fill:before{content:"\\f388"}.bi-file-earmark-spreadsheet:before{content:"\\f389"}.bi-file-earmark-text-fill:before{content:"\\f38a"}.bi-file-earmark-text:before{content:"\\f38b"}.bi-file-earmark-word-fill:before{content:"\\f38c"}.bi-file-earmark-word:before{content:"\\f38d"}.bi-file-earmark-x-fill:before{content:"\\f38e"}.bi-file-earmark-x:before{content:"\\f38f"}.bi-file-earmark-zip-fill:before{content:"\\f390"}.bi-file-earmark-zip:before{content:"\\f391"}.bi-file-earmark:before{content:"\\f392"}.bi-file-easel-fill:before{content:"\\f393"}.bi-file-easel:before{content:"\\f394"}.bi-file-excel-fill:before{content:"\\f395"}.bi-file-excel:before{content:"\\f396"}.bi-file-fill:before{content:"\\f397"}.bi-file-font-fill:before{content:"\\f398"}.bi-file-font:before{content:"\\f399"}.bi-file-image-fill:before{content:"\\f39a"}.bi-file-image:before{content:"\\f39b"}.bi-file-lock-fill:before{content:"\\f39c"}.bi-file-lock:before{content:"\\f39d"}.bi-file-lock2-fill:before{content:"\\f39e"}.bi-file-lock2:before{content:"\\f39f"}.bi-file-medical-fill:before{content:"\\f3a0"}.bi-file-medical:before{content:"\\f3a1"}.bi-file-minus-fill:before{content:"\\f3a2"}.bi-file-minus:before{content:"\\f3a3"}.bi-file-music-fill:before{content:"\\f3a4"}.bi-file-music:before{content:"\\f3a5"}.bi-file-person-fill:before{content:"\\f3a6"}.bi-file-person:before{content:"\\f3a7"}.bi-file-play-fill:before{content:"\\f3a8"}.bi-file-play:before{content:"\\f3a9"}.bi-file-plus-fill:before{content:"\\f3aa"}.bi-file-plus:before{content:"\\f3ab"}.bi-file-post-fill:before{content:"\\f3ac"}.bi-file-post:before{content:"\\f3ad"}.bi-file-ppt-fill:before{content:"\\f3ae"}.bi-file-ppt:before{content:"\\f3af"}.bi-file-richtext-fill:before{content:"\\f3b0"}.bi-file-richtext:before{content:"\\f3b1"}.bi-file-ruled-fill:before{content:"\\f3b2"}.bi-file-ruled:before{content:"\\f3b3"}.bi-file-slides-fill:before{content:"\\f3b4"}.bi-file-slides:before{content:"\\f3b5"}.bi-file-spreadsheet-fill:before{content:"\\f3b6"}.bi-file-spreadsheet:before{content:"\\f3b7"}.bi-file-text-fill:before{content:"\\f3b8"}.bi-file-text:before{content:"\\f3b9"}.bi-file-word-fill:before{content:"\\f3ba"}.bi-file-word:before{content:"\\f3bb"}.bi-file-x-fill:before{content:"\\f3bc"}.bi-file-x:before{content:"\\f3bd"}.bi-file-zip-fill:before{content:"\\f3be"}.bi-file-zip:before{content:"\\f3bf"}.bi-file:before{content:"\\f3c0"}.bi-files-alt:before{content:"\\f3c1"}.bi-files:before{content:"\\f3c2"}.bi-film:before{content:"\\f3c3"}.bi-filter-circle-fill:before{content:"\\f3c4"}.bi-filter-circle:before{content:"\\f3c5"}.bi-filter-left:before{content:"\\f3c6"}.bi-filter-right:before{content:"\\f3c7"}.bi-filter-square-fill:before{content:"\\f3c8"}.bi-filter-square:before{content:"\\f3c9"}.bi-filter:before{content:"\\f3ca"}.bi-flag-fill:before{content:"\\f3cb"}.bi-flag:before{content:"\\f3cc"}.bi-flower1:before{content:"\\f3cd"}.bi-flower2:before{content:"\\f3ce"}.bi-flower3:before{content:"\\f3cf"}.bi-folder-check:before{content:"\\f3d0"}.bi-folder-fill:before{content:"\\f3d1"}.bi-folder-minus:before{content:"\\f3d2"}.bi-folder-plus:before{content:"\\f3d3"}.bi-folder-symlink-fill:before{content:"\\f3d4"}.bi-folder-symlink:before{content:"\\f3d5"}.bi-folder-x:before{content:"\\f3d6"}.bi-folder:before{content:"\\f3d7"}.bi-folder2-open:before{content:"\\f3d8"}.bi-folder2:before{content:"\\f3d9"}.bi-fonts:before{content:"\\f3da"}.bi-forward-fill:before{content:"\\f3db"}.bi-forward:before{content:"\\f3dc"}.bi-front:before{content:"\\f3dd"}.bi-fullscreen-exit:before{content:"\\f3de"}.bi-fullscreen:before{content:"\\f3df"}.bi-funnel-fill:before{content:"\\f3e0"}.bi-funnel:before{content:"\\f3e1"}.bi-gear-fill:before{content:"\\f3e2"}.bi-gear-wide-connected:before{content:"\\f3e3"}.bi-gear-wide:before{content:"\\f3e4"}.bi-gear:before{content:"\\f3e5"}.bi-gem:before{content:"\\f3e6"}.bi-geo-alt-fill:before{content:"\\f3e7"}.bi-geo-alt:before{content:"\\f3e8"}.bi-geo-fill:before{content:"\\f3e9"}.bi-geo:before{content:"\\f3ea"}.bi-gift-fill:before{content:"\\f3eb"}.bi-gift:before{content:"\\f3ec"}.bi-github:before{content:"\\f3ed"}.bi-globe:before{content:"\\f3ee"}.bi-globe2:before{content:"\\f3ef"}.bi-google:before{content:"\\f3f0"}.bi-graph-down:before{content:"\\f3f1"}.bi-graph-up:before{content:"\\f3f2"}.bi-grid-1x2-fill:before{content:"\\f3f3"}.bi-grid-1x2:before{content:"\\f3f4"}.bi-grid-3x2-gap-fill:before{content:"\\f3f5"}.bi-grid-3x2-gap:before{content:"\\f3f6"}.bi-grid-3x2:before{content:"\\f3f7"}.bi-grid-3x3-gap-fill:before{content:"\\f3f8"}.bi-grid-3x3-gap:before{content:"\\f3f9"}.bi-grid-3x3:before{content:"\\f3fa"}.bi-grid-fill:before{content:"\\f3fb"}.bi-grid:before{content:"\\f3fc"}.bi-grip-horizontal:before{content:"\\f3fd"}.bi-grip-vertical:before{content:"\\f3fe"}.bi-hammer:before{content:"\\f3ff"}.bi-hand-index-fill:before{content:"\\f400"}.bi-hand-index-thumb-fill:before{content:"\\f401"}.bi-hand-index-thumb:before{content:"\\f402"}.bi-hand-index:before{content:"\\f403"}.bi-hand-thumbs-down-fill:before{content:"\\f404"}.bi-hand-thumbs-down:before{content:"\\f405"}.bi-hand-thumbs-up-fill:before{content:"\\f406"}.bi-hand-thumbs-up:before{content:"\\f407"}.bi-handbag-fill:before{content:"\\f408"}.bi-handbag:before{content:"\\f409"}.bi-hash:before{content:"\\f40a"}.bi-hdd-fill:before{content:"\\f40b"}.bi-hdd-network-fill:before{content:"\\f40c"}.bi-hdd-network:before{content:"\\f40d"}.bi-hdd-rack-fill:before{content:"\\f40e"}.bi-hdd-rack:before{content:"\\f40f"}.bi-hdd-stack-fill:before{content:"\\f410"}.bi-hdd-stack:before{content:"\\f411"}.bi-hdd:before{content:"\\f412"}.bi-headphones:before{content:"\\f413"}.bi-headset:before{content:"\\f414"}.bi-heart-fill:before{content:"\\f415"}.bi-heart-half:before{content:"\\f416"}.bi-heart:before{content:"\\f417"}.bi-heptagon-fill:before{content:"\\f418"}.bi-heptagon-half:before{content:"\\f419"}.bi-heptagon:before{content:"\\f41a"}.bi-hexagon-fill:before{content:"\\f41b"}.bi-hexagon-half:before{content:"\\f41c"}.bi-hexagon:before{content:"\\f41d"}.bi-hourglass-bottom:before{content:"\\f41e"}.bi-hourglass-split:before{content:"\\f41f"}.bi-hourglass-top:before{content:"\\f420"}.bi-hourglass:before{content:"\\f421"}.bi-house-door-fill:before{content:"\\f422"}.bi-house-door:before{content:"\\f423"}.bi-house-fill:before{content:"\\f424"}.bi-house:before{content:"\\f425"}.bi-hr:before{content:"\\f426"}.bi-hurricane:before{content:"\\f427"}.bi-image-alt:before{content:"\\f428"}.bi-image-fill:before{content:"\\f429"}.bi-image:before{content:"\\f42a"}.bi-images:before{content:"\\f42b"}.bi-inbox-fill:before{content:"\\f42c"}.bi-inbox:before{content:"\\f42d"}.bi-inboxes-fill:before{content:"\\f42e"}.bi-inboxes:before{content:"\\f42f"}.bi-info-circle-fill:before{content:"\\f430"}.bi-info-circle:before{content:"\\f431"}.bi-info-square-fill:before{content:"\\f432"}.bi-info-square:before{content:"\\f433"}.bi-info:before{content:"\\f434"}.bi-input-cursor-text:before{content:"\\f435"}.bi-input-cursor:before{content:"\\f436"}.bi-instagram:before{content:"\\f437"}.bi-intersect:before{content:"\\f438"}.bi-journal-album:before{content:"\\f439"}.bi-journal-arrow-down:before{content:"\\f43a"}.bi-journal-arrow-up:before{content:"\\f43b"}.bi-journal-bookmark-fill:before{content:"\\f43c"}.bi-journal-bookmark:before{content:"\\f43d"}.bi-journal-check:before{content:"\\f43e"}.bi-journal-code:before{content:"\\f43f"}.bi-journal-medical:before{content:"\\f440"}.bi-journal-minus:before{content:"\\f441"}.bi-journal-plus:before{content:"\\f442"}.bi-journal-richtext:before{content:"\\f443"}.bi-journal-text:before{content:"\\f444"}.bi-journal-x:before{content:"\\f445"}.bi-journal:before{content:"\\f446"}.bi-journals:before{content:"\\f447"}.bi-joystick:before{content:"\\f448"}.bi-justify-left:before{content:"\\f449"}.bi-justify-right:before{content:"\\f44a"}.bi-justify:before{content:"\\f44b"}.bi-kanban-fill:before{content:"\\f44c"}.bi-kanban:before{content:"\\f44d"}.bi-key-fill:before{content:"\\f44e"}.bi-key:before{content:"\\f44f"}.bi-keyboard-fill:before{content:"\\f450"}.bi-keyboard:before{content:"\\f451"}.bi-ladder:before{content:"\\f452"}.bi-lamp-fill:before{content:"\\f453"}.bi-lamp:before{content:"\\f454"}.bi-laptop-fill:before{content:"\\f455"}.bi-laptop:before{content:"\\f456"}.bi-layer-backward:before{content:"\\f457"}.bi-layer-forward:before{content:"\\f458"}.bi-layers-fill:before{content:"\\f459"}.bi-layers-half:before{content:"\\f45a"}.bi-layers:before{content:"\\f45b"}.bi-layout-sidebar-inset-reverse:before{content:"\\f45c"}.bi-layout-sidebar-inset:before{content:"\\f45d"}.bi-layout-sidebar-reverse:before{content:"\\f45e"}.bi-layout-sidebar:before{content:"\\f45f"}.bi-layout-split:before{content:"\\f460"}.bi-layout-text-sidebar-reverse:before{content:"\\f461"}.bi-layout-text-sidebar:before{content:"\\f462"}.bi-layout-text-window-reverse:before{content:"\\f463"}.bi-layout-text-window:before{content:"\\f464"}.bi-layout-three-columns:before{content:"\\f465"}.bi-layout-wtf:before{content:"\\f466"}.bi-life-preserver:before{content:"\\f467"}.bi-lightbulb-fill:before{content:"\\f468"}.bi-lightbulb-off-fill:before{content:"\\f469"}.bi-lightbulb-off:before{content:"\\f46a"}.bi-lightbulb:before{content:"\\f46b"}.bi-lightning-charge-fill:before{content:"\\f46c"}.bi-lightning-charge:before{content:"\\f46d"}.bi-lightning-fill:before{content:"\\f46e"}.bi-lightning:before{content:"\\f46f"}.bi-link-45deg:before{content:"\\f470"}.bi-link:before{content:"\\f471"}.bi-linkedin:before{content:"\\f472"}.bi-list-check:before{content:"\\f473"}.bi-list-nested:before{content:"\\f474"}.bi-list-ol:before{content:"\\f475"}.bi-list-stars:before{content:"\\f476"}.bi-list-task:before{content:"\\f477"}.bi-list-ul:before{content:"\\f478"}.bi-list:before{content:"\\f479"}.bi-lock-fill:before{content:"\\f47a"}.bi-lock:before{content:"\\f47b"}.bi-mailbox:before{content:"\\f47c"}.bi-mailbox2:before{content:"\\f47d"}.bi-map-fill:before{content:"\\f47e"}.bi-map:before{content:"\\f47f"}.bi-markdown-fill:before{content:"\\f480"}.bi-markdown:before{content:"\\f481"}.bi-mask:before{content:"\\f482"}.bi-megaphone-fill:before{content:"\\f483"}.bi-megaphone:before{content:"\\f484"}.bi-menu-app-fill:before{content:"\\f485"}.bi-menu-app:before{content:"\\f486"}.bi-menu-button-fill:before{content:"\\f487"}.bi-menu-button-wide-fill:before{content:"\\f488"}.bi-menu-button-wide:before{content:"\\f489"}.bi-menu-button:before{content:"\\f48a"}.bi-menu-down:before{content:"\\f48b"}.bi-menu-up:before{content:"\\f48c"}.bi-mic-fill:before{content:"\\f48d"}.bi-mic-mute-fill:before{content:"\\f48e"}.bi-mic-mute:before{content:"\\f48f"}.bi-mic:before{content:"\\f490"}.bi-minecart-loaded:before{content:"\\f491"}.bi-minecart:before{content:"\\f492"}.bi-moisture:before{content:"\\f493"}.bi-moon-fill:before{content:"\\f494"}.bi-moon-stars-fill:before{content:"\\f495"}.bi-moon-stars:before{content:"\\f496"}.bi-moon:before{content:"\\f497"}.bi-mouse-fill:before{content:"\\f498"}.bi-mouse:before{content:"\\f499"}.bi-mouse2-fill:before{content:"\\f49a"}.bi-mouse2:before{content:"\\f49b"}.bi-mouse3-fill:before{content:"\\f49c"}.bi-mouse3:before{content:"\\f49d"}.bi-music-note-beamed:before{content:"\\f49e"}.bi-music-note-list:before{content:"\\f49f"}.bi-music-note:before{content:"\\f4a0"}.bi-music-player-fill:before{content:"\\f4a1"}.bi-music-player:before{content:"\\f4a2"}.bi-newspaper:before{content:"\\f4a3"}.bi-node-minus-fill:before{content:"\\f4a4"}.bi-node-minus:before{content:"\\f4a5"}.bi-node-plus-fill:before{content:"\\f4a6"}.bi-node-plus:before{content:"\\f4a7"}.bi-nut-fill:before{content:"\\f4a8"}.bi-nut:before{content:"\\f4a9"}.bi-octagon-fill:before{content:"\\f4aa"}.bi-octagon-half:before{content:"\\f4ab"}.bi-octagon:before{content:"\\f4ac"}.bi-option:before{content:"\\f4ad"}.bi-outlet:before{content:"\\f4ae"}.bi-paint-bucket:before{content:"\\f4af"}.bi-palette-fill:before{content:"\\f4b0"}.bi-palette:before{content:"\\f4b1"}.bi-palette2:before{content:"\\f4b2"}.bi-paperclip:before{content:"\\f4b3"}.bi-paragraph:before{content:"\\f4b4"}.bi-patch-check-fill:before{content:"\\f4b5"}.bi-patch-check:before{content:"\\f4b6"}.bi-patch-exclamation-fill:before{content:"\\f4b7"}.bi-patch-exclamation:before{content:"\\f4b8"}.bi-patch-minus-fill:before{content:"\\f4b9"}.bi-patch-minus:before{content:"\\f4ba"}.bi-patch-plus-fill:before{content:"\\f4bb"}.bi-patch-plus:before{content:"\\f4bc"}.bi-patch-question-fill:before{content:"\\f4bd"}.bi-patch-question:before{content:"\\f4be"}.bi-pause-btn-fill:before{content:"\\f4bf"}.bi-pause-btn:before{content:"\\f4c0"}.bi-pause-circle-fill:before{content:"\\f4c1"}.bi-pause-circle:before{content:"\\f4c2"}.bi-pause-fill:before{content:"\\f4c3"}.bi-pause:before{content:"\\f4c4"}.bi-peace-fill:before{content:"\\f4c5"}.bi-peace:before{content:"\\f4c6"}.bi-pen-fill:before{content:"\\f4c7"}.bi-pen:before{content:"\\f4c8"}.bi-pencil-fill:before{content:"\\f4c9"}.bi-pencil-square:before{content:"\\f4ca"}.bi-pencil:before{content:"\\f4cb"}.bi-pentagon-fill:before{content:"\\f4cc"}.bi-pentagon-half:before{content:"\\f4cd"}.bi-pentagon:before{content:"\\f4ce"}.bi-people-fill:before{content:"\\f4cf"}.bi-people:before{content:"\\f4d0"}.bi-percent:before{content:"\\f4d1"}.bi-person-badge-fill:before{content:"\\f4d2"}.bi-person-badge:before{content:"\\f4d3"}.bi-person-bounding-box:before{content:"\\f4d4"}.bi-person-check-fill:before{content:"\\f4d5"}.bi-person-check:before{content:"\\f4d6"}.bi-person-circle:before{content:"\\f4d7"}.bi-person-dash-fill:before{content:"\\f4d8"}.bi-person-dash:before{content:"\\f4d9"}.bi-person-fill:before{content:"\\f4da"}.bi-person-lines-fill:before{content:"\\f4db"}.bi-person-plus-fill:before{content:"\\f4dc"}.bi-person-plus:before{content:"\\f4dd"}.bi-person-square:before{content:"\\f4de"}.bi-person-x-fill:before{content:"\\f4df"}.bi-person-x:before{content:"\\f4e0"}.bi-person:before{content:"\\f4e1"}.bi-phone-fill:before{content:"\\f4e2"}.bi-phone-landscape-fill:before{content:"\\f4e3"}.bi-phone-landscape:before{content:"\\f4e4"}.bi-phone-vibrate-fill:before{content:"\\f4e5"}.bi-phone-vibrate:before{content:"\\f4e6"}.bi-phone:before{content:"\\f4e7"}.bi-pie-chart-fill:before{content:"\\f4e8"}.bi-pie-chart:before{content:"\\f4e9"}.bi-pin-angle-fill:before{content:"\\f4ea"}.bi-pin-angle:before{content:"\\f4eb"}.bi-pin-fill:before{content:"\\f4ec"}.bi-pin:before{content:"\\f4ed"}.bi-pip-fill:before{content:"\\f4ee"}.bi-pip:before{content:"\\f4ef"}.bi-play-btn-fill:before{content:"\\f4f0"}.bi-play-btn:before{content:"\\f4f1"}.bi-play-circle-fill:before{content:"\\f4f2"}.bi-play-circle:before{content:"\\f4f3"}.bi-play-fill:before{content:"\\f4f4"}.bi-play:before{content:"\\f4f5"}.bi-plug-fill:before{content:"\\f4f6"}.bi-plug:before{content:"\\f4f7"}.bi-plus-circle-dotted:before{content:"\\f4f8"}.bi-plus-circle-fill:before{content:"\\f4f9"}.bi-plus-circle:before{content:"\\f4fa"}.bi-plus-square-dotted:before{content:"\\f4fb"}.bi-plus-square-fill:before{content:"\\f4fc"}.bi-plus-square:before{content:"\\f4fd"}.bi-plus:before{content:"\\f4fe"}.bi-power:before{content:"\\f4ff"}.bi-printer-fill:before{content:"\\f500"}.bi-printer:before{content:"\\f501"}.bi-puzzle-fill:before{content:"\\f502"}.bi-puzzle:before{content:"\\f503"}.bi-question-circle-fill:before{content:"\\f504"}.bi-question-circle:before{content:"\\f505"}.bi-question-diamond-fill:before{content:"\\f506"}.bi-question-diamond:before{content:"\\f507"}.bi-question-octagon-fill:before{content:"\\f508"}.bi-question-octagon:before{content:"\\f509"}.bi-question-square-fill:before{content:"\\f50a"}.bi-question-square:before{content:"\\f50b"}.bi-question:before{content:"\\f50c"}.bi-rainbow:before{content:"\\f50d"}.bi-receipt-cutoff:before{content:"\\f50e"}.bi-receipt:before{content:"\\f50f"}.bi-reception-0:before{content:"\\f510"}.bi-reception-1:before{content:"\\f511"}.bi-reception-2:before{content:"\\f512"}.bi-reception-3:before{content:"\\f513"}.bi-reception-4:before{content:"\\f514"}.bi-record-btn-fill:before{content:"\\f515"}.bi-record-btn:before{content:"\\f516"}.bi-record-circle-fill:before{content:"\\f517"}.bi-record-circle:before{content:"\\f518"}.bi-record-fill:before{content:"\\f519"}.bi-record:before{content:"\\f51a"}.bi-record2-fill:before{content:"\\f51b"}.bi-record2:before{content:"\\f51c"}.bi-reply-all-fill:before{content:"\\f51d"}.bi-reply-all:before{content:"\\f51e"}.bi-reply-fill:before{content:"\\f51f"}.bi-reply:before{content:"\\f520"}.bi-rss-fill:before{content:"\\f521"}.bi-rss:before{content:"\\f522"}.bi-rulers:before{content:"\\f523"}.bi-save-fill:before{content:"\\f524"}.bi-save:before{content:"\\f525"}.bi-save2-fill:before{content:"\\f526"}.bi-save2:before{content:"\\f527"}.bi-scissors:before{content:"\\f528"}.bi-screwdriver:before{content:"\\f529"}.bi-search:before{content:"\\f52a"}.bi-segmented-nav:before{content:"\\f52b"}.bi-server:before{content:"\\f52c"}.bi-share-fill:before{content:"\\f52d"}.bi-share:before{content:"\\f52e"}.bi-shield-check:before{content:"\\f52f"}.bi-shield-exclamation:before{content:"\\f530"}.bi-shield-fill-check:before{content:"\\f531"}.bi-shield-fill-exclamation:before{content:"\\f532"}.bi-shield-fill-minus:before{content:"\\f533"}.bi-shield-fill-plus:before{content:"\\f534"}.bi-shield-fill-x:before{content:"\\f535"}.bi-shield-fill:before{content:"\\f536"}.bi-shield-lock-fill:before{content:"\\f537"}.bi-shield-lock:before{content:"\\f538"}.bi-shield-minus:before{content:"\\f539"}.bi-shield-plus:before{content:"\\f53a"}.bi-shield-shaded:before{content:"\\f53b"}.bi-shield-slash-fill:before{content:"\\f53c"}.bi-shield-slash:before{content:"\\f53d"}.bi-shield-x:before{content:"\\f53e"}.bi-shield:before{content:"\\f53f"}.bi-shift-fill:before{content:"\\f540"}.bi-shift:before{content:"\\f541"}.bi-shop-window:before{content:"\\f542"}.bi-shop:before{content:"\\f543"}.bi-shuffle:before{content:"\\f544"}.bi-signpost-2-fill:before{content:"\\f545"}.bi-signpost-2:before{content:"\\f546"}.bi-signpost-fill:before{content:"\\f547"}.bi-signpost-split-fill:before{content:"\\f548"}.bi-signpost-split:before{content:"\\f549"}.bi-signpost:before{content:"\\f54a"}.bi-sim-fill:before{content:"\\f54b"}.bi-sim:before{content:"\\f54c"}.bi-skip-backward-btn-fill:before{content:"\\f54d"}.bi-skip-backward-btn:before{content:"\\f54e"}.bi-skip-backward-circle-fill:before{content:"\\f54f"}.bi-skip-backward-circle:before{content:"\\f550"}.bi-skip-backward-fill:before{content:"\\f551"}.bi-skip-backward:before{content:"\\f552"}.bi-skip-end-btn-fill:before{content:"\\f553"}.bi-skip-end-btn:before{content:"\\f554"}.bi-skip-end-circle-fill:before{content:"\\f555"}.bi-skip-end-circle:before{content:"\\f556"}.bi-skip-end-fill:before{content:"\\f557"}.bi-skip-end:before{content:"\\f558"}.bi-skip-forward-btn-fill:before{content:"\\f559"}.bi-skip-forward-btn:before{content:"\\f55a"}.bi-skip-forward-circle-fill:before{content:"\\f55b"}.bi-skip-forward-circle:before{content:"\\f55c"}.bi-skip-forward-fill:before{content:"\\f55d"}.bi-skip-forward:before{content:"\\f55e"}.bi-skip-start-btn-fill:before{content:"\\f55f"}.bi-skip-start-btn:before{content:"\\f560"}.bi-skip-start-circle-fill:before{content:"\\f561"}.bi-skip-start-circle:before{content:"\\f562"}.bi-skip-start-fill:before{content:"\\f563"}.bi-skip-start:before{content:"\\f564"}.bi-slack:before{content:"\\f565"}.bi-slash-circle-fill:before{content:"\\f566"}.bi-slash-circle:before{content:"\\f567"}.bi-slash-square-fill:before{content:"\\f568"}.bi-slash-square:before{content:"\\f569"}.bi-slash:before{content:"\\f56a"}.bi-sliders:before{content:"\\f56b"}.bi-smartwatch:before{content:"\\f56c"}.bi-snow:before{content:"\\f56d"}.bi-snow2:before{content:"\\f56e"}.bi-snow3:before{content:"\\f56f"}.bi-sort-alpha-down-alt:before{content:"\\f570"}.bi-sort-alpha-down:before{content:"\\f571"}.bi-sort-alpha-up-alt:before{content:"\\f572"}.bi-sort-alpha-up:before{content:"\\f573"}.bi-sort-down-alt:before{content:"\\f574"}.bi-sort-down:before{content:"\\f575"}.bi-sort-numeric-down-alt:before{content:"\\f576"}.bi-sort-numeric-down:before{content:"\\f577"}.bi-sort-numeric-up-alt:before{content:"\\f578"}.bi-sort-numeric-up:before{content:"\\f579"}.bi-sort-up-alt:before{content:"\\f57a"}.bi-sort-up:before{content:"\\f57b"}.bi-soundwave:before{content:"\\f57c"}.bi-speaker-fill:before{content:"\\f57d"}.bi-speaker:before{content:"\\f57e"}.bi-speedometer:before{content:"\\f57f"}.bi-speedometer2:before{content:"\\f580"}.bi-spellcheck:before{content:"\\f581"}.bi-square-fill:before{content:"\\f582"}.bi-square-half:before{content:"\\f583"}.bi-square:before{content:"\\f584"}.bi-stack:before{content:"\\f585"}.bi-star-fill:before{content:"\\f586"}.bi-star-half:before{content:"\\f587"}.bi-star:before{content:"\\f588"}.bi-stars:before{content:"\\f589"}.bi-stickies-fill:before{content:"\\f58a"}.bi-stickies:before{content:"\\f58b"}.bi-sticky-fill:before{content:"\\f58c"}.bi-sticky:before{content:"\\f58d"}.bi-stop-btn-fill:before{content:"\\f58e"}.bi-stop-btn:before{content:"\\f58f"}.bi-stop-circle-fill:before{content:"\\f590"}.bi-stop-circle:before{content:"\\f591"}.bi-stop-fill:before{content:"\\f592"}.bi-stop:before{content:"\\f593"}.bi-stoplights-fill:before{content:"\\f594"}.bi-stoplights:before{content:"\\f595"}.bi-stopwatch-fill:before{content:"\\f596"}.bi-stopwatch:before{content:"\\f597"}.bi-subtract:before{content:"\\f598"}.bi-suit-club-fill:before{content:"\\f599"}.bi-suit-club:before{content:"\\f59a"}.bi-suit-diamond-fill:before{content:"\\f59b"}.bi-suit-diamond:before{content:"\\f59c"}.bi-suit-heart-fill:before{content:"\\f59d"}.bi-suit-heart:before{content:"\\f59e"}.bi-suit-spade-fill:before{content:"\\f59f"}.bi-suit-spade:before{content:"\\f5a0"}.bi-sun-fill:before{content:"\\f5a1"}.bi-sun:before{content:"\\f5a2"}.bi-sunglasses:before{content:"\\f5a3"}.bi-sunrise-fill:before{content:"\\f5a4"}.bi-sunrise:before{content:"\\f5a5"}.bi-sunset-fill:before{content:"\\f5a6"}.bi-sunset:before{content:"\\f5a7"}.bi-symmetry-horizontal:before{content:"\\f5a8"}.bi-symmetry-vertical:before{content:"\\f5a9"}.bi-table:before{content:"\\f5aa"}.bi-tablet-fill:before{content:"\\f5ab"}.bi-tablet-landscape-fill:before{content:"\\f5ac"}.bi-tablet-landscape:before{content:"\\f5ad"}.bi-tablet:before{content:"\\f5ae"}.bi-tag-fill:before{content:"\\f5af"}.bi-tag:before{content:"\\f5b0"}.bi-tags-fill:before{content:"\\f5b1"}.bi-tags:before{content:"\\f5b2"}.bi-telegram:before{content:"\\f5b3"}.bi-telephone-fill:before{content:"\\f5b4"}.bi-telephone-forward-fill:before{content:"\\f5b5"}.bi-telephone-forward:before{content:"\\f5b6"}.bi-telephone-inbound-fill:before{content:"\\f5b7"}.bi-telephone-inbound:before{content:"\\f5b8"}.bi-telephone-minus-fill:before{content:"\\f5b9"}.bi-telephone-minus:before{content:"\\f5ba"}.bi-telephone-outbound-fill:before{content:"\\f5bb"}.bi-telephone-outbound:before{content:"\\f5bc"}.bi-telephone-plus-fill:before{content:"\\f5bd"}.bi-telephone-plus:before{content:"\\f5be"}.bi-telephone-x-fill:before{content:"\\f5bf"}.bi-telephone-x:before{content:"\\f5c0"}.bi-telephone:before{content:"\\f5c1"}.bi-terminal-fill:before{content:"\\f5c2"}.bi-terminal:before{content:"\\f5c3"}.bi-text-center:before{content:"\\f5c4"}.bi-text-indent-left:before{content:"\\f5c5"}.bi-text-indent-right:before{content:"\\f5c6"}.bi-text-left:before{content:"\\f5c7"}.bi-text-paragraph:before{content:"\\f5c8"}.bi-text-right:before{content:"\\f5c9"}.bi-textarea-resize:before{content:"\\f5ca"}.bi-textarea-t:before{content:"\\f5cb"}.bi-textarea:before{content:"\\f5cc"}.bi-thermometer-half:before{content:"\\f5cd"}.bi-thermometer-high:before{content:"\\f5ce"}.bi-thermometer-low:before{content:"\\f5cf"}.bi-thermometer-snow:before{content:"\\f5d0"}.bi-thermometer-sun:before{content:"\\f5d1"}.bi-thermometer:before{content:"\\f5d2"}.bi-three-dots-vertical:before{content:"\\f5d3"}.bi-three-dots:before{content:"\\f5d4"}.bi-toggle-off:before{content:"\\f5d5"}.bi-toggle-on:before{content:"\\f5d6"}.bi-toggle2-off:before{content:"\\f5d7"}.bi-toggle2-on:before{content:"\\f5d8"}.bi-toggles:before{content:"\\f5d9"}.bi-toggles2:before{content:"\\f5da"}.bi-tools:before{content:"\\f5db"}.bi-tornado:before{content:"\\f5dc"}.bi-trash-fill:before{content:"\\f5dd"}.bi-trash:before{content:"\\f5de"}.bi-trash2-fill:before{content:"\\f5df"}.bi-trash2:before{content:"\\f5e0"}.bi-tree-fill:before{content:"\\f5e1"}.bi-tree:before{content:"\\f5e2"}.bi-triangle-fill:before{content:"\\f5e3"}.bi-triangle-half:before{content:"\\f5e4"}.bi-triangle:before{content:"\\f5e5"}.bi-trophy-fill:before{content:"\\f5e6"}.bi-trophy:before{content:"\\f5e7"}.bi-tropical-storm:before{content:"\\f5e8"}.bi-truck-flatbed:before{content:"\\f5e9"}.bi-truck:before{content:"\\f5ea"}.bi-tsunami:before{content:"\\f5eb"}.bi-tv-fill:before{content:"\\f5ec"}.bi-tv:before{content:"\\f5ed"}.bi-twitch:before{content:"\\f5ee"}.bi-twitter:before{content:"\\f5ef"}.bi-type-bold:before{content:"\\f5f0"}.bi-type-h1:before{content:"\\f5f1"}.bi-type-h2:before{content:"\\f5f2"}.bi-type-h3:before{content:"\\f5f3"}.bi-type-italic:before{content:"\\f5f4"}.bi-type-strikethrough:before{content:"\\f5f5"}.bi-type-underline:before{content:"\\f5f6"}.bi-type:before{content:"\\f5f7"}.bi-ui-checks-grid:before{content:"\\f5f8"}.bi-ui-checks:before{content:"\\f5f9"}.bi-ui-radios-grid:before{content:"\\f5fa"}.bi-ui-radios:before{content:"\\f5fb"}.bi-umbrella-fill:before{content:"\\f5fc"}.bi-umbrella:before{content:"\\f5fd"}.bi-union:before{content:"\\f5fe"}.bi-unlock-fill:before{content:"\\f5ff"}.bi-unlock:before{content:"\\f600"}.bi-upc-scan:before{content:"\\f601"}.bi-upc:before{content:"\\f602"}.bi-upload:before{content:"\\f603"}.bi-vector-pen:before{content:"\\f604"}.bi-view-list:before{content:"\\f605"}.bi-view-stacked:before{content:"\\f606"}.bi-vinyl-fill:before{content:"\\f607"}.bi-vinyl:before{content:"\\f608"}.bi-voicemail:before{content:"\\f609"}.bi-volume-down-fill:before{content:"\\f60a"}.bi-volume-down:before{content:"\\f60b"}.bi-volume-mute-fill:before{content:"\\f60c"}.bi-volume-mute:before{content:"\\f60d"}.bi-volume-off-fill:before{content:"\\f60e"}.bi-volume-off:before{content:"\\f60f"}.bi-volume-up-fill:before{content:"\\f610"}.bi-volume-up:before{content:"\\f611"}.bi-vr:before{content:"\\f612"}.bi-wallet-fill:before{content:"\\f613"}.bi-wallet:before{content:"\\f614"}.bi-wallet2:before{content:"\\f615"}.bi-watch:before{content:"\\f616"}.bi-water:before{content:"\\f617"}.bi-whatsapp:before{content:"\\f618"}.bi-wifi-1:before{content:"\\f619"}.bi-wifi-2:before{content:"\\f61a"}.bi-wifi-off:before{content:"\\f61b"}.bi-wifi:before{content:"\\f61c"}.bi-wind:before{content:"\\f61d"}.bi-window-dock:before{content:"\\f61e"}.bi-window-sidebar:before{content:"\\f61f"}.bi-window:before{content:"\\f620"}.bi-wrench:before{content:"\\f621"}.bi-x-circle-fill:before{content:"\\f622"}.bi-x-circle:before{content:"\\f623"}.bi-x-diamond-fill:before{content:"\\f624"}.bi-x-diamond:before{content:"\\f625"}.bi-x-octagon-fill:before{content:"\\f626"}.bi-x-octagon:before{content:"\\f627"}.bi-x-square-fill:before{content:"\\f628"}.bi-x-square:before{content:"\\f629"}.bi-x:before{content:"\\f62a"}.bi-youtube:before{content:"\\f62b"}.bi-zoom-in:before{content:"\\f62c"}.bi-zoom-out:before{content:"\\f62d"}.bi-bank:before{content:"\\f62e"}.bi-bank2:before{content:"\\f62f"}.bi-bell-slash-fill:before{content:"\\f630"}.bi-bell-slash:before{content:"\\f631"}.bi-cash-coin:before{content:"\\f632"}.bi-check-lg:before{content:"\\f633"}.bi-coin:before{content:"\\f634"}.bi-currency-bitcoin:before{content:"\\f635"}.bi-currency-dollar:before{content:"\\f636"}.bi-currency-euro:before{content:"\\f637"}.bi-currency-exchange:before{content:"\\f638"}.bi-currency-pound:before{content:"\\f639"}.bi-currency-yen:before{content:"\\f63a"}.bi-dash-lg:before{content:"\\f63b"}.bi-exclamation-lg:before{content:"\\f63c"}.bi-file-earmark-pdf-fill:before{content:"\\f63d"}.bi-file-earmark-pdf:before{content:"\\f63e"}.bi-file-pdf-fill:before{content:"\\f63f"}.bi-file-pdf:before{content:"\\f640"}.bi-gender-ambiguous:before{content:"\\f641"}.bi-gender-female:before{content:"\\f642"}.bi-gender-male:before{content:"\\f643"}.bi-gender-trans:before{content:"\\f644"}.bi-headset-vr:before{content:"\\f645"}.bi-info-lg:before{content:"\\f646"}.bi-mastodon:before{content:"\\f647"}.bi-messenger:before{content:"\\f648"}.bi-piggy-bank-fill:before{content:"\\f649"}.bi-piggy-bank:before{content:"\\f64a"}.bi-pin-map-fill:before{content:"\\f64b"}.bi-pin-map:before{content:"\\f64c"}.bi-plus-lg:before{content:"\\f64d"}.bi-question-lg:before{content:"\\f64e"}.bi-recycle:before{content:"\\f64f"}.bi-reddit:before{content:"\\f650"}.bi-safe-fill:before{content:"\\f651"}.bi-safe2-fill:before{content:"\\f652"}.bi-safe2:before{content:"\\f653"}.bi-sd-card-fill:before{content:"\\f654"}.bi-sd-card:before{content:"\\f655"}.bi-skype:before{content:"\\f656"}.bi-slash-lg:before{content:"\\f657"}.bi-translate:before{content:"\\f658"}.bi-x-lg:before{content:"\\f659"}.bi-safe:before{content:"\\f65a"}.bi-apple:before{content:"\\f65b"}.bi-microsoft:before{content:"\\f65d"}.bi-windows:before{content:"\\f65e"}.bi-behance:before{content:"\\f65c"}.bi-dribbble:before{content:"\\f65f"}.bi-line:before{content:"\\f660"}.bi-medium:before{content:"\\f661"}.bi-paypal:before{content:"\\f662"}.bi-pinterest:before{content:"\\f663"}.bi-signal:before{content:"\\f664"}.bi-snapchat:before{content:"\\f665"}.bi-spotify:before{content:"\\f666"}.bi-stack-overflow:before{content:"\\f667"}.bi-strava:before{content:"\\f668"}.bi-wordpress:before{content:"\\f669"}.bi-vimeo:before{content:"\\f66a"}.bi-activity:before{content:"\\f66b"}.bi-easel2-fill:before{content:"\\f66c"}.bi-easel2:before{content:"\\f66d"}.bi-easel3-fill:before{content:"\\f66e"}.bi-easel3:before{content:"\\f66f"}.bi-fan:before{content:"\\f670"}.bi-fingerprint:before{content:"\\f671"}.bi-graph-down-arrow:before{content:"\\f672"}.bi-graph-up-arrow:before{content:"\\f673"}.bi-hypnotize:before{content:"\\f674"}.bi-magic:before{content:"\\f675"}.bi-person-rolodex:before{content:"\\f676"}.bi-person-video:before{content:"\\f677"}.bi-person-video2:before{content:"\\f678"}.bi-person-video3:before{content:"\\f679"}.bi-person-workspace:before{content:"\\f67a"}.bi-radioactive:before{content:"\\f67b"}.bi-webcam-fill:before{content:"\\f67c"}.bi-webcam:before{content:"\\f67d"}.bi-yin-yang:before{content:"\\f67e"}.bi-bandaid-fill:before{content:"\\f680"}.bi-bandaid:before{content:"\\f681"}.bi-bluetooth:before{content:"\\f682"}.bi-body-text:before{content:"\\f683"}.bi-boombox:before{content:"\\f684"}.bi-boxes:before{content:"\\f685"}.bi-dpad-fill:before{content:"\\f686"}.bi-dpad:before{content:"\\f687"}.bi-ear-fill:before{content:"\\f688"}.bi-ear:before{content:"\\f689"}.bi-envelope-check-fill:before{content:"\\f68b"}.bi-envelope-check:before{content:"\\f68c"}.bi-envelope-dash-fill:before{content:"\\f68e"}.bi-envelope-dash:before{content:"\\f68f"}.bi-envelope-exclamation-fill:before{content:"\\f691"}.bi-envelope-exclamation:before{content:"\\f692"}.bi-envelope-plus-fill:before{content:"\\f693"}.bi-envelope-plus:before{content:"\\f694"}.bi-envelope-slash-fill:before{content:"\\f696"}.bi-envelope-slash:before{content:"\\f697"}.bi-envelope-x-fill:before{content:"\\f699"}.bi-envelope-x:before{content:"\\f69a"}.bi-explicit-fill:before{content:"\\f69b"}.bi-explicit:before{content:"\\f69c"}.bi-git:before{content:"\\f69d"}.bi-infinity:before{content:"\\f69e"}.bi-list-columns-reverse:before{content:"\\f69f"}.bi-list-columns:before{content:"\\f6a0"}.bi-meta:before{content:"\\f6a1"}.bi-nintendo-switch:before{content:"\\f6a4"}.bi-pc-display-horizontal:before{content:"\\f6a5"}.bi-pc-display:before{content:"\\f6a6"}.bi-pc-horizontal:before{content:"\\f6a7"}.bi-pc:before{content:"\\f6a8"}.bi-playstation:before{content:"\\f6a9"}.bi-plus-slash-minus:before{content:"\\f6aa"}.bi-projector-fill:before{content:"\\f6ab"}.bi-projector:before{content:"\\f6ac"}.bi-qr-code-scan:before{content:"\\f6ad"}.bi-qr-code:before{content:"\\f6ae"}.bi-quora:before{content:"\\f6af"}.bi-quote:before{content:"\\f6b0"}.bi-robot:before{content:"\\f6b1"}.bi-send-check-fill:before{content:"\\f6b2"}.bi-send-check:before{content:"\\f6b3"}.bi-send-dash-fill:before{content:"\\f6b4"}.bi-send-dash:before{content:"\\f6b5"}.bi-send-exclamation-fill:before{content:"\\f6b7"}.bi-send-exclamation:before{content:"\\f6b8"}.bi-send-fill:before{content:"\\f6b9"}.bi-send-plus-fill:before{content:"\\f6ba"}.bi-send-plus:before{content:"\\f6bb"}.bi-send-slash-fill:before{content:"\\f6bc"}.bi-send-slash:before{content:"\\f6bd"}.bi-send-x-fill:before{content:"\\f6be"}.bi-send-x:before{content:"\\f6bf"}.bi-send:before{content:"\\f6c0"}.bi-steam:before{content:"\\f6c1"}.bi-terminal-dash:before{content:"\\f6c3"}.bi-terminal-plus:before{content:"\\f6c4"}.bi-terminal-split:before{content:"\\f6c5"}.bi-ticket-detailed-fill:before{content:"\\f6c6"}.bi-ticket-detailed:before{content:"\\f6c7"}.bi-ticket-fill:before{content:"\\f6c8"}.bi-ticket-perforated-fill:before{content:"\\f6c9"}.bi-ticket-perforated:before{content:"\\f6ca"}.bi-ticket:before{content:"\\f6cb"}.bi-tiktok:before{content:"\\f6cc"}.bi-window-dash:before{content:"\\f6cd"}.bi-window-desktop:before{content:"\\f6ce"}.bi-window-fullscreen:before{content:"\\f6cf"}.bi-window-plus:before{content:"\\f6d0"}.bi-window-split:before{content:"\\f6d1"}.bi-window-stack:before{content:"\\f6d2"}.bi-window-x:before{content:"\\f6d3"}.bi-xbox:before{content:"\\f6d4"}.bi-ethernet:before{content:"\\f6d5"}.bi-hdmi-fill:before{content:"\\f6d6"}.bi-hdmi:before{content:"\\f6d7"}.bi-usb-c-fill:before{content:"\\f6d8"}.bi-usb-c:before{content:"\\f6d9"}.bi-usb-fill:before{content:"\\f6da"}.bi-usb-plug-fill:before{content:"\\f6db"}.bi-usb-plug:before{content:"\\f6dc"}.bi-usb-symbol:before{content:"\\f6dd"}.bi-usb:before{content:"\\f6de"}.bi-boombox-fill:before{content:"\\f6df"}.bi-displayport:before{content:"\\f6e1"}.bi-gpu-card:before{content:"\\f6e2"}.bi-memory:before{content:"\\f6e3"}.bi-modem-fill:before{content:"\\f6e4"}.bi-modem:before{content:"\\f6e5"}.bi-motherboard-fill:before{content:"\\f6e6"}.bi-motherboard:before{content:"\\f6e7"}.bi-optical-audio-fill:before{content:"\\f6e8"}.bi-optical-audio:before{content:"\\f6e9"}.bi-pci-card:before{content:"\\f6ea"}.bi-router-fill:before{content:"\\f6eb"}.bi-router:before{content:"\\f6ec"}.bi-thunderbolt-fill:before{content:"\\f6ef"}.bi-thunderbolt:before{content:"\\f6f0"}.bi-usb-drive-fill:before{content:"\\f6f1"}.bi-usb-drive:before{content:"\\f6f2"}.bi-usb-micro-fill:before{content:"\\f6f3"}.bi-usb-micro:before{content:"\\f6f4"}.bi-usb-mini-fill:before{content:"\\f6f5"}.bi-usb-mini:before{content:"\\f6f6"}.bi-cloud-haze2:before{content:"\\f6f7"}.bi-device-hdd-fill:before{content:"\\f6f8"}.bi-device-hdd:before{content:"\\f6f9"}.bi-device-ssd-fill:before{content:"\\f6fa"}.bi-device-ssd:before{content:"\\f6fb"}.bi-displayport-fill:before{content:"\\f6fc"}.bi-mortarboard-fill:before{content:"\\f6fd"}.bi-mortarboard:before{content:"\\f6fe"}.bi-terminal-x:before{content:"\\f6ff"}.bi-arrow-through-heart-fill:before{content:"\\f700"}.bi-arrow-through-heart:before{content:"\\f701"}.bi-badge-sd-fill:before{content:"\\f702"}.bi-badge-sd:before{content:"\\f703"}.bi-bag-heart-fill:before{content:"\\f704"}.bi-bag-heart:before{content:"\\f705"}.bi-balloon-fill:before{content:"\\f706"}.bi-balloon-heart-fill:before{content:"\\f707"}.bi-balloon-heart:before{content:"\\f708"}.bi-balloon:before{content:"\\f709"}.bi-box2-fill:before{content:"\\f70a"}.bi-box2-heart-fill:before{content:"\\f70b"}.bi-box2-heart:before{content:"\\f70c"}.bi-box2:before{content:"\\f70d"}.bi-braces-asterisk:before{content:"\\f70e"}.bi-calendar-heart-fill:before{content:"\\f70f"}.bi-calendar-heart:before{content:"\\f710"}.bi-calendar2-heart-fill:before{content:"\\f711"}.bi-calendar2-heart:before{content:"\\f712"}.bi-chat-heart-fill:before{content:"\\f713"}.bi-chat-heart:before{content:"\\f714"}.bi-chat-left-heart-fill:before{content:"\\f715"}.bi-chat-left-heart:before{content:"\\f716"}.bi-chat-right-heart-fill:before{content:"\\f717"}.bi-chat-right-heart:before{content:"\\f718"}.bi-chat-square-heart-fill:before{content:"\\f719"}.bi-chat-square-heart:before{content:"\\f71a"}.bi-clipboard-check-fill:before{content:"\\f71b"}.bi-clipboard-data-fill:before{content:"\\f71c"}.bi-clipboard-fill:before{content:"\\f71d"}.bi-clipboard-heart-fill:before{content:"\\f71e"}.bi-clipboard-heart:before{content:"\\f71f"}.bi-clipboard-minus-fill:before{content:"\\f720"}.bi-clipboard-plus-fill:before{content:"\\f721"}.bi-clipboard-pulse:before{content:"\\f722"}.bi-clipboard-x-fill:before{content:"\\f723"}.bi-clipboard2-check-fill:before{content:"\\f724"}.bi-clipboard2-check:before{content:"\\f725"}.bi-clipboard2-data-fill:before{content:"\\f726"}.bi-clipboard2-data:before{content:"\\f727"}.bi-clipboard2-fill:before{content:"\\f728"}.bi-clipboard2-heart-fill:before{content:"\\f729"}.bi-clipboard2-heart:before{content:"\\f72a"}.bi-clipboard2-minus-fill:before{content:"\\f72b"}.bi-clipboard2-minus:before{content:"\\f72c"}.bi-clipboard2-plus-fill:before{content:"\\f72d"}.bi-clipboard2-plus:before{content:"\\f72e"}.bi-clipboard2-pulse-fill:before{content:"\\f72f"}.bi-clipboard2-pulse:before{content:"\\f730"}.bi-clipboard2-x-fill:before{content:"\\f731"}.bi-clipboard2-x:before{content:"\\f732"}.bi-clipboard2:before{content:"\\f733"}.bi-emoji-kiss-fill:before{content:"\\f734"}.bi-emoji-kiss:before{content:"\\f735"}.bi-envelope-heart-fill:before{content:"\\f736"}.bi-envelope-heart:before{content:"\\f737"}.bi-envelope-open-heart-fill:before{content:"\\f738"}.bi-envelope-open-heart:before{content:"\\f739"}.bi-envelope-paper-fill:before{content:"\\f73a"}.bi-envelope-paper-heart-fill:before{content:"\\f73b"}.bi-envelope-paper-heart:before{content:"\\f73c"}.bi-envelope-paper:before{content:"\\f73d"}.bi-filetype-aac:before{content:"\\f73e"}.bi-filetype-ai:before{content:"\\f73f"}.bi-filetype-bmp:before{content:"\\f740"}.bi-filetype-cs:before{content:"\\f741"}.bi-filetype-css:before{content:"\\f742"}.bi-filetype-csv:before{content:"\\f743"}.bi-filetype-doc:before{content:"\\f744"}.bi-filetype-docx:before{content:"\\f745"}.bi-filetype-exe:before{content:"\\f746"}.bi-filetype-gif:before{content:"\\f747"}.bi-filetype-heic:before{content:"\\f748"}.bi-filetype-html:before{content:"\\f749"}.bi-filetype-java:before{content:"\\f74a"}.bi-filetype-jpg:before{content:"\\f74b"}.bi-filetype-js:before{content:"\\f74c"}.bi-filetype-jsx:before{content:"\\f74d"}.bi-filetype-key:before{content:"\\f74e"}.bi-filetype-m4p:before{content:"\\f74f"}.bi-filetype-md:before{content:"\\f750"}.bi-filetype-mdx:before{content:"\\f751"}.bi-filetype-mov:before{content:"\\f752"}.bi-filetype-mp3:before{content:"\\f753"}.bi-filetype-mp4:before{content:"\\f754"}.bi-filetype-otf:before{content:"\\f755"}.bi-filetype-pdf:before{content:"\\f756"}.bi-filetype-php:before{content:"\\f757"}.bi-filetype-png:before{content:"\\f758"}.bi-filetype-ppt:before{content:"\\f75a"}.bi-filetype-psd:before{content:"\\f75b"}.bi-filetype-py:before{content:"\\f75c"}.bi-filetype-raw:before{content:"\\f75d"}.bi-filetype-rb:before{content:"\\f75e"}.bi-filetype-sass:before{content:"\\f75f"}.bi-filetype-scss:before{content:"\\f760"}.bi-filetype-sh:before{content:"\\f761"}.bi-filetype-svg:before{content:"\\f762"}.bi-filetype-tiff:before{content:"\\f763"}.bi-filetype-tsx:before{content:"\\f764"}.bi-filetype-ttf:before{content:"\\f765"}.bi-filetype-txt:before{content:"\\f766"}.bi-filetype-wav:before{content:"\\f767"}.bi-filetype-woff:before{content:"\\f768"}.bi-filetype-xls:before{content:"\\f76a"}.bi-filetype-xml:before{content:"\\f76b"}.bi-filetype-yml:before{content:"\\f76c"}.bi-heart-arrow:before{content:"\\f76d"}.bi-heart-pulse-fill:before{content:"\\f76e"}.bi-heart-pulse:before{content:"\\f76f"}.bi-heartbreak-fill:before{content:"\\f770"}.bi-heartbreak:before{content:"\\f771"}.bi-hearts:before{content:"\\f772"}.bi-hospital-fill:before{content:"\\f773"}.bi-hospital:before{content:"\\f774"}.bi-house-heart-fill:before{content:"\\f775"}.bi-house-heart:before{content:"\\f776"}.bi-incognito:before{content:"\\f777"}.bi-magnet-fill:before{content:"\\f778"}.bi-magnet:before{content:"\\f779"}.bi-person-heart:before{content:"\\f77a"}.bi-person-hearts:before{content:"\\f77b"}.bi-phone-flip:before{content:"\\f77c"}.bi-plugin:before{content:"\\f77d"}.bi-postage-fill:before{content:"\\f77e"}.bi-postage-heart-fill:before{content:"\\f77f"}.bi-postage-heart:before{content:"\\f780"}.bi-postage:before{content:"\\f781"}.bi-postcard-fill:before{content:"\\f782"}.bi-postcard-heart-fill:before{content:"\\f783"}.bi-postcard-heart:before{content:"\\f784"}.bi-postcard:before{content:"\\f785"}.bi-search-heart-fill:before{content:"\\f786"}.bi-search-heart:before{content:"\\f787"}.bi-sliders2-vertical:before{content:"\\f788"}.bi-sliders2:before{content:"\\f789"}.bi-trash3-fill:before{content:"\\f78a"}.bi-trash3:before{content:"\\f78b"}.bi-valentine:before{content:"\\f78c"}.bi-valentine2:before{content:"\\f78d"}.bi-wrench-adjustable-circle-fill:before{content:"\\f78e"}.bi-wrench-adjustable-circle:before{content:"\\f78f"}.bi-wrench-adjustable:before{content:"\\f790"}.bi-filetype-json:before{content:"\\f791"}.bi-filetype-pptx:before{content:"\\f792"}.bi-filetype-xlsx:before{content:"\\f793"}.bi-1-circle-fill:before{content:"\\f796"}.bi-1-circle:before{content:"\\f797"}.bi-1-square-fill:before{content:"\\f798"}.bi-1-square:before{content:"\\f799"}.bi-2-circle-fill:before{content:"\\f79c"}.bi-2-circle:before{content:"\\f79d"}.bi-2-square-fill:before{content:"\\f79e"}.bi-2-square:before{content:"\\f79f"}.bi-3-circle-fill:before{content:"\\f7a2"}.bi-3-circle:before{content:"\\f7a3"}.bi-3-square-fill:before{content:"\\f7a4"}.bi-3-square:before{content:"\\f7a5"}.bi-4-circle-fill:before{content:"\\f7a8"}.bi-4-circle:before{content:"\\f7a9"}.bi-4-square-fill:before{content:"\\f7aa"}.bi-4-square:before{content:"\\f7ab"}.bi-5-circle-fill:before{content:"\\f7ae"}.bi-5-circle:before{content:"\\f7af"}.bi-5-square-fill:before{content:"\\f7b0"}.bi-5-square:before{content:"\\f7b1"}.bi-6-circle-fill:before{content:"\\f7b4"}.bi-6-circle:before{content:"\\f7b5"}.bi-6-square-fill:before{content:"\\f7b6"}.bi-6-square:before{content:"\\f7b7"}.bi-7-circle-fill:before{content:"\\f7ba"}.bi-7-circle:before{content:"\\f7bb"}.bi-7-square-fill:before{content:"\\f7bc"}.bi-7-square:before{content:"\\f7bd"}.bi-8-circle-fill:before{content:"\\f7c0"}.bi-8-circle:before{content:"\\f7c1"}.bi-8-square-fill:before{content:"\\f7c2"}.bi-8-square:before{content:"\\f7c3"}.bi-9-circle-fill:before{content:"\\f7c6"}.bi-9-circle:before{content:"\\f7c7"}.bi-9-square-fill:before{content:"\\f7c8"}.bi-9-square:before{content:"\\f7c9"}.bi-airplane-engines-fill:before{content:"\\f7ca"}.bi-airplane-engines:before{content:"\\f7cb"}.bi-airplane-fill:before{content:"\\f7cc"}.bi-airplane:before{content:"\\f7cd"}.bi-alexa:before{content:"\\f7ce"}.bi-alipay:before{content:"\\f7cf"}.bi-android:before{content:"\\f7d0"}.bi-android2:before{content:"\\f7d1"}.bi-box-fill:before{content:"\\f7d2"}.bi-box-seam-fill:before{content:"\\f7d3"}.bi-browser-chrome:before{content:"\\f7d4"}.bi-browser-edge:before{content:"\\f7d5"}.bi-browser-firefox:before{content:"\\f7d6"}.bi-browser-safari:before{content:"\\f7d7"}.bi-c-circle-fill:before{content:"\\f7da"}.bi-c-circle:before{content:"\\f7db"}.bi-c-square-fill:before{content:"\\f7dc"}.bi-c-square:before{content:"\\f7dd"}.bi-capsule-pill:before{content:"\\f7de"}.bi-capsule:before{content:"\\f7df"}.bi-car-front-fill:before{content:"\\f7e0"}.bi-car-front:before{content:"\\f7e1"}.bi-cassette-fill:before{content:"\\f7e2"}.bi-cassette:before{content:"\\f7e3"}.bi-cc-circle-fill:before{content:"\\f7e6"}.bi-cc-circle:before{content:"\\f7e7"}.bi-cc-square-fill:before{content:"\\f7e8"}.bi-cc-square:before{content:"\\f7e9"}.bi-cup-hot-fill:before{content:"\\f7ea"}.bi-cup-hot:before{content:"\\f7eb"}.bi-currency-rupee:before{content:"\\f7ec"}.bi-dropbox:before{content:"\\f7ed"}.bi-escape:before{content:"\\f7ee"}.bi-fast-forward-btn-fill:before{content:"\\f7ef"}.bi-fast-forward-btn:before{content:"\\f7f0"}.bi-fast-forward-circle-fill:before{content:"\\f7f1"}.bi-fast-forward-circle:before{content:"\\f7f2"}.bi-fast-forward-fill:before{content:"\\f7f3"}.bi-fast-forward:before{content:"\\f7f4"}.bi-filetype-sql:before{content:"\\f7f5"}.bi-fire:before{content:"\\f7f6"}.bi-google-play:before{content:"\\f7f7"}.bi-h-circle-fill:before{content:"\\f7fa"}.bi-h-circle:before{content:"\\f7fb"}.bi-h-square-fill:before{content:"\\f7fc"}.bi-h-square:before{content:"\\f7fd"}.bi-indent:before{content:"\\f7fe"}.bi-lungs-fill:before{content:"\\f7ff"}.bi-lungs:before{content:"\\f800"}.bi-microsoft-teams:before{content:"\\f801"}.bi-p-circle-fill:before{content:"\\f804"}.bi-p-circle:before{content:"\\f805"}.bi-p-square-fill:before{content:"\\f806"}.bi-p-square:before{content:"\\f807"}.bi-pass-fill:before{content:"\\f808"}.bi-pass:before{content:"\\f809"}.bi-prescription:before{content:"\\f80a"}.bi-prescription2:before{content:"\\f80b"}.bi-r-circle-fill:before{content:"\\f80e"}.bi-r-circle:before{content:"\\f80f"}.bi-r-square-fill:before{content:"\\f810"}.bi-r-square:before{content:"\\f811"}.bi-repeat-1:before{content:"\\f812"}.bi-repeat:before{content:"\\f813"}.bi-rewind-btn-fill:before{content:"\\f814"}.bi-rewind-btn:before{content:"\\f815"}.bi-rewind-circle-fill:before{content:"\\f816"}.bi-rewind-circle:before{content:"\\f817"}.bi-rewind-fill:before{content:"\\f818"}.bi-rewind:before{content:"\\f819"}.bi-train-freight-front-fill:before{content:"\\f81a"}.bi-train-freight-front:before{content:"\\f81b"}.bi-train-front-fill:before{content:"\\f81c"}.bi-train-front:before{content:"\\f81d"}.bi-train-lightrail-front-fill:before{content:"\\f81e"}.bi-train-lightrail-front:before{content:"\\f81f"}.bi-truck-front-fill:before{content:"\\f820"}.bi-truck-front:before{content:"\\f821"}.bi-ubuntu:before{content:"\\f822"}.bi-unindent:before{content:"\\f823"}.bi-unity:before{content:"\\f824"}.bi-universal-access-circle:before{content:"\\f825"}.bi-universal-access:before{content:"\\f826"}.bi-virus:before{content:"\\f827"}.bi-virus2:before{content:"\\f828"}.bi-wechat:before{content:"\\f829"}.bi-yelp:before{content:"\\f82a"}.bi-sign-stop-fill:before{content:"\\f82b"}.bi-sign-stop-lights-fill:before{content:"\\f82c"}.bi-sign-stop-lights:before{content:"\\f82d"}.bi-sign-stop:before{content:"\\f82e"}.bi-sign-turn-left-fill:before{content:"\\f82f"}.bi-sign-turn-left:before{content:"\\f830"}.bi-sign-turn-right-fill:before{content:"\\f831"}.bi-sign-turn-right:before{content:"\\f832"}.bi-sign-turn-slight-left-fill:before{content:"\\f833"}.bi-sign-turn-slight-left:before{content:"\\f834"}.bi-sign-turn-slight-right-fill:before{content:"\\f835"}.bi-sign-turn-slight-right:before{content:"\\f836"}.bi-sign-yield-fill:before{content:"\\f837"}.bi-sign-yield:before{content:"\\f838"}.bi-ev-station-fill:before{content:"\\f839"}.bi-ev-station:before{content:"\\f83a"}.bi-fuel-pump-diesel-fill:before{content:"\\f83b"}.bi-fuel-pump-diesel:before{content:"\\f83c"}.bi-fuel-pump-fill:before{content:"\\f83d"}.bi-fuel-pump:before{content:"\\f83e"}.bi-0-circle-fill:before{content:"\\f83f"}.bi-0-circle:before{content:"\\f840"}.bi-0-square-fill:before{content:"\\f841"}.bi-0-square:before{content:"\\f842"}.bi-rocket-fill:before{content:"\\f843"}.bi-rocket-takeoff-fill:before{content:"\\f844"}.bi-rocket-takeoff:before{content:"\\f845"}.bi-rocket:before{content:"\\f846"}.bi-stripe:before{content:"\\f847"}.bi-subscript:before{content:"\\f848"}.bi-superscript:before{content:"\\f849"}.bi-trello:before{content:"\\f84a"}.bi-envelope-at-fill:before{content:"\\f84b"}.bi-envelope-at:before{content:"\\f84c"}.bi-regex:before{content:"\\f84d"}.bi-text-wrap:before{content:"\\f84e"}.bi-sign-dead-end-fill:before{content:"\\f84f"}.bi-sign-dead-end:before{content:"\\f850"}.bi-sign-do-not-enter-fill:before{content:"\\f851"}.bi-sign-do-not-enter:before{content:"\\f852"}.bi-sign-intersection-fill:before{content:"\\f853"}.bi-sign-intersection-side-fill:before{content:"\\f854"}.bi-sign-intersection-side:before{content:"\\f855"}.bi-sign-intersection-t-fill:before{content:"\\f856"}.bi-sign-intersection-t:before{content:"\\f857"}.bi-sign-intersection-y-fill:before{content:"\\f858"}.bi-sign-intersection-y:before{content:"\\f859"}.bi-sign-intersection:before{content:"\\f85a"}.bi-sign-merge-left-fill:before{content:"\\f85b"}.bi-sign-merge-left:before{content:"\\f85c"}.bi-sign-merge-right-fill:before{content:"\\f85d"}.bi-sign-merge-right:before{content:"\\f85e"}.bi-sign-no-left-turn-fill:before{content:"\\f85f"}.bi-sign-no-left-turn:before{content:"\\f860"}.bi-sign-no-parking-fill:before{content:"\\f861"}.bi-sign-no-parking:before{content:"\\f862"}.bi-sign-no-right-turn-fill:before{content:"\\f863"}.bi-sign-no-right-turn:before{content:"\\f864"}.bi-sign-railroad-fill:before{content:"\\f865"}.bi-sign-railroad:before{content:"\\f866"}.bi-building-add:before{content:"\\f867"}.bi-building-check:before{content:"\\f868"}.bi-building-dash:before{content:"\\f869"}.bi-building-down:before{content:"\\f86a"}.bi-building-exclamation:before{content:"\\f86b"}.bi-building-fill-add:before{content:"\\f86c"}.bi-building-fill-check:before{content:"\\f86d"}.bi-building-fill-dash:before{content:"\\f86e"}.bi-building-fill-down:before{content:"\\f86f"}.bi-building-fill-exclamation:before{content:"\\f870"}.bi-building-fill-gear:before{content:"\\f871"}.bi-building-fill-lock:before{content:"\\f872"}.bi-building-fill-slash:before{content:"\\f873"}.bi-building-fill-up:before{content:"\\f874"}.bi-building-fill-x:before{content:"\\f875"}.bi-building-fill:before{content:"\\f876"}.bi-building-gear:before{content:"\\f877"}.bi-building-lock:before{content:"\\f878"}.bi-building-slash:before{content:"\\f879"}.bi-building-up:before{content:"\\f87a"}.bi-building-x:before{content:"\\f87b"}.bi-buildings-fill:before{content:"\\f87c"}.bi-buildings:before{content:"\\f87d"}.bi-bus-front-fill:before{content:"\\f87e"}.bi-bus-front:before{content:"\\f87f"}.bi-ev-front-fill:before{content:"\\f880"}.bi-ev-front:before{content:"\\f881"}.bi-globe-americas:before{content:"\\f882"}.bi-globe-asia-australia:before{content:"\\f883"}.bi-globe-central-south-asia:before{content:"\\f884"}.bi-globe-europe-africa:before{content:"\\f885"}.bi-house-add-fill:before{content:"\\f886"}.bi-house-add:before{content:"\\f887"}.bi-house-check-fill:before{content:"\\f888"}.bi-house-check:before{content:"\\f889"}.bi-house-dash-fill:before{content:"\\f88a"}.bi-house-dash:before{content:"\\f88b"}.bi-house-down-fill:before{content:"\\f88c"}.bi-house-down:before{content:"\\f88d"}.bi-house-exclamation-fill:before{content:"\\f88e"}.bi-house-exclamation:before{content:"\\f88f"}.bi-house-gear-fill:before{content:"\\f890"}.bi-house-gear:before{content:"\\f891"}.bi-house-lock-fill:before{content:"\\f892"}.bi-house-lock:before{content:"\\f893"}.bi-house-slash-fill:before{content:"\\f894"}.bi-house-slash:before{content:"\\f895"}.bi-house-up-fill:before{content:"\\f896"}.bi-house-up:before{content:"\\f897"}.bi-house-x-fill:before{content:"\\f898"}.bi-house-x:before{content:"\\f899"}.bi-person-add:before{content:"\\f89a"}.bi-person-down:before{content:"\\f89b"}.bi-person-exclamation:before{content:"\\f89c"}.bi-person-fill-add:before{content:"\\f89d"}.bi-person-fill-check:before{content:"\\f89e"}.bi-person-fill-dash:before{content:"\\f89f"}.bi-person-fill-down:before{content:"\\f8a0"}.bi-person-fill-exclamation:before{content:"\\f8a1"}.bi-person-fill-gear:before{content:"\\f8a2"}.bi-person-fill-lock:before{content:"\\f8a3"}.bi-person-fill-slash:before{content:"\\f8a4"}.bi-person-fill-up:before{content:"\\f8a5"}.bi-person-fill-x:before{content:"\\f8a6"}.bi-person-gear:before{content:"\\f8a7"}.bi-person-lock:before{content:"\\f8a8"}.bi-person-slash:before{content:"\\f8a9"}.bi-person-up:before{content:"\\f8aa"}.bi-scooter:before{content:"\\f8ab"}.bi-taxi-front-fill:before{content:"\\f8ac"}.bi-taxi-front:before{content:"\\f8ad"}.bi-amd:before{content:"\\f8ae"}.bi-database-add:before{content:"\\f8af"}.bi-database-check:before{content:"\\f8b0"}.bi-database-dash:before{content:"\\f8b1"}.bi-database-down:before{content:"\\f8b2"}.bi-database-exclamation:before{content:"\\f8b3"}.bi-database-fill-add:before{content:"\\f8b4"}.bi-database-fill-check:before{content:"\\f8b5"}.bi-database-fill-dash:before{content:"\\f8b6"}.bi-database-fill-down:before{content:"\\f8b7"}.bi-database-fill-exclamation:before{content:"\\f8b8"}.bi-database-fill-gear:before{content:"\\f8b9"}.bi-database-fill-lock:before{content:"\\f8ba"}.bi-database-fill-slash:before{content:"\\f8bb"}.bi-database-fill-up:before{content:"\\f8bc"}.bi-database-fill-x:before{content:"\\f8bd"}.bi-database-fill:before{content:"\\f8be"}.bi-database-gear:before{content:"\\f8bf"}.bi-database-lock:before{content:"\\f8c0"}.bi-database-slash:before{content:"\\f8c1"}.bi-database-up:before{content:"\\f8c2"}.bi-database-x:before{content:"\\f8c3"}.bi-database:before{content:"\\f8c4"}.bi-houses-fill:before{content:"\\f8c5"}.bi-houses:before{content:"\\f8c6"}.bi-nvidia:before{content:"\\f8c7"}.bi-person-vcard-fill:before{content:"\\f8c8"}.bi-person-vcard:before{content:"\\f8c9"}.bi-sina-weibo:before{content:"\\f8ca"}.bi-tencent-qq:before{content:"\\f8cb"}.bi-wikipedia:before{content:"\\f8cc"}.bi-alphabet-uppercase:before{content:"\\f2a5"}.bi-alphabet:before{content:"\\f68a"}.bi-amazon:before{content:"\\f68d"}.bi-arrows-collapse-vertical:before{content:"\\f690"}.bi-arrows-expand-vertical:before{content:"\\f695"}.bi-arrows-vertical:before{content:"\\f698"}.bi-arrows:before{content:"\\f6a2"}.bi-ban-fill:before{content:"\\f6a3"}.bi-ban:before{content:"\\f6b6"}.bi-bing:before{content:"\\f6c2"}.bi-cake:before{content:"\\f6e0"}.bi-cake2:before{content:"\\f6ed"}.bi-cookie:before{content:"\\f6ee"}.bi-copy:before{content:"\\f759"}.bi-crosshair:before{content:"\\f769"}.bi-crosshair2:before{content:"\\f794"}.bi-emoji-astonished-fill:before{content:"\\f795"}.bi-emoji-astonished:before{content:"\\f79a"}.bi-emoji-grimace-fill:before{content:"\\f79b"}.bi-emoji-grimace:before{content:"\\f7a0"}.bi-emoji-grin-fill:before{content:"\\f7a1"}.bi-emoji-grin:before{content:"\\f7a6"}.bi-emoji-surprise-fill:before{content:"\\f7a7"}.bi-emoji-surprise:before{content:"\\f7ac"}.bi-emoji-tear-fill:before{content:"\\f7ad"}.bi-emoji-tear:before{content:"\\f7b2"}.bi-envelope-arrow-down-fill:before{content:"\\f7b3"}.bi-envelope-arrow-down:before{content:"\\f7b8"}.bi-envelope-arrow-up-fill:before{content:"\\f7b9"}.bi-envelope-arrow-up:before{content:"\\f7be"}.bi-feather:before{content:"\\f7bf"}.bi-feather2:before{content:"\\f7c4"}.bi-floppy-fill:before{content:"\\f7c5"}.bi-floppy:before{content:"\\f7d8"}.bi-floppy2-fill:before{content:"\\f7d9"}.bi-floppy2:before{content:"\\f7e4"}.bi-gitlab:before{content:"\\f7e5"}.bi-highlighter:before{content:"\\f7f8"}.bi-marker-tip:before{content:"\\f802"}.bi-nvme-fill:before{content:"\\f803"}.bi-nvme:before{content:"\\f80c"}.bi-opencollective:before{content:"\\f80d"}.bi-pci-card-network:before{content:"\\f8cd"}.bi-pci-card-sound:before{content:"\\f8ce"}.bi-radar:before{content:"\\f8cf"}.bi-send-arrow-down-fill:before{content:"\\f8d0"}.bi-send-arrow-down:before{content:"\\f8d1"}.bi-send-arrow-up-fill:before{content:"\\f8d2"}.bi-send-arrow-up:before{content:"\\f8d3"}.bi-sim-slash-fill:before{content:"\\f8d4"}.bi-sim-slash:before{content:"\\f8d5"}.bi-sourceforge:before{content:"\\f8d6"}.bi-substack:before{content:"\\f8d7"}.bi-threads-fill:before{content:"\\f8d8"}.bi-threads:before{content:"\\f8d9"}.bi-transparency:before{content:"\\f8da"}.bi-twitter-x:before{content:"\\f8db"}.bi-type-h4:before{content:"\\f8dc"}.bi-type-h5:before{content:"\\f8dd"}.bi-type-h6:before{content:"\\f8de"}.bi-backpack-fill:before{content:"\\f8df"}.bi-backpack:before{content:"\\f8e0"}.bi-backpack2-fill:before{content:"\\f8e1"}.bi-backpack2:before{content:"\\f8e2"}.bi-backpack3-fill:before{content:"\\f8e3"}.bi-backpack3:before{content:"\\f8e4"}.bi-backpack4-fill:before{content:"\\f8e5"}.bi-backpack4:before{content:"\\f8e6"}.bi-brilliance:before{content:"\\f8e7"}.bi-cake-fill:before{content:"\\f8e8"}.bi-cake2-fill:before{content:"\\f8e9"}.bi-duffle-fill:before{content:"\\f8ea"}.bi-duffle:before{content:"\\f8eb"}.bi-exposure:before{content:"\\f8ec"}.bi-gender-neuter:before{content:"\\f8ed"}.bi-highlights:before{content:"\\f8ee"}.bi-luggage-fill:before{content:"\\f8ef"}.bi-luggage:before{content:"\\f8f0"}.bi-mailbox-flag:before{content:"\\f8f1"}.bi-mailbox2-flag:before{content:"\\f8f2"}.bi-noise-reduction:before{content:"\\f8f3"}.bi-passport-fill:before{content:"\\f8f4"}.bi-passport:before{content:"\\f8f5"}.bi-person-arms-up:before{content:"\\f8f6"}.bi-person-raised-hand:before{content:"\\f8f7"}.bi-person-standing-dress:before{content:"\\f8f8"}.bi-person-standing:before{content:"\\f8f9"}.bi-person-walking:before{content:"\\f8fa"}.bi-person-wheelchair:before{content:"\\f8fb"}.bi-shadows:before{content:"\\f8fc"}.bi-suitcase-fill:before{content:"\\f8fd"}.bi-suitcase-lg-fill:before{content:"\\f8fe"}.bi-suitcase-lg:before{content:"\\f8ff"}.bi-suitcase:before{content:"\\f900"}.bi-suitcase2-fill:before{content:"\\f901"}.bi-suitcase2:before{content:"\\f902"}.bi-vignette:before{content:"\\f903"}foreignObject.loci{box-sizing:border-box;border-radius:.375rem;position:relative;display:block}foreignObject.loci div.foreground{position:relative;display:flex;height:100%;width:100%;justify-content:center;align-items:center;box-sizing:inherit;border-radius:inherit;border-width:1px;border-style:solid;opacity:1}foreignObject.loci div.background{position:absolute;left:0;top:0;display:block;height:100%;width:100%;opacity:.3}foreignObject.pins div.foreground{position:relative;display:flex;height:100%;width:100%;justify-content:center;align-items:flex-end;box-sizing:border-box}foreignObject.dssp div.foreground{position:relative;display:flex;height:100%;width:100%;justify-content:center;align-items:flex-end;box-sizing:border-box}foreignObject.dssp i[class^=dssp]{position:relative;visibility:hidden;display:flex;height:100%;width:100%}foreignObject.dssp i.dssp-helix{visibility:visible;background-color:inherit;-webkit-mask-image:url(dssp-helix.74d0a47e4d7ed27e.svg);mask-image:url(dssp-helix.74d0a47e4d7ed27e.svg);-webkit-mask-position:0 center;mask-position:0 center;-webkit-mask-size:auto 100%;mask-size:auto 100%}foreignObject.dssp i.dssp-strand{display:flex;visibility:hidden}foreignObject.dssp i.dssp-strand:before{visibility:visible;background-color:inherit;-webkit-mask-image:url(dssp-strand-tail.783864b28823e2c7.svg);mask-image:url(dssp-strand-tail.783864b28823e2c7.svg);-webkit-mask-position:0 center;mask-position:0 center;-webkit-mask-size:auto 100%;mask-size:auto 100%;flex-shrink:1;flex-grow:1;content:""}foreignObject.dssp i.dssp-strand:after{visibility:visible;background-color:inherit;-webkit-mask-image:url(dssp-strand-head.85a295955fb4c220.svg);mask-image:url(dssp-strand-head.85a295955fb4c220.svg);-webkit-mask-position:0 center;mask-position:0 center;-webkit-mask-size:auto 100%;mask-size:auto 100%;flex-shrink:0;flex-grow:0;content:"";width:31px}.axis-grid line{stroke-opacity:.3;stroke:gray}.axis-grid line:nth-child(1){stroke-dasharray:2}.y.axis .tick text{display:none}\n'],encapsulation:2,changeDetection:0})}return e})();function yRt(e,t){1&e&&js(0,"i",10)}function bRt(e,t){1&e&&js(0,"i",11)}function vRt(e,t){if(1&e&&(br(0,"div"),Li(1),Ym(2,yRt,1,0,"i",10)(3,bRt,1,0),Sr()),2&e){const n=t.trace;_8("text-muted",!n.expanded),Yc(),UC(" ",n.label,"\xa0 "),Yc(),ST(2,n.expanded?2:3)}}const _Rt={providers:[function XNe(e,...t){return Vc([{provide:aw,multi:!0,useValue:e},[],{provide:nw,useFactory:Wie,deps:[Nh]},{provide:F4,multi:!0,useFactory:$ie},t.map(n=>n.\u0275providers)])}([{path:"structure",component:xDt},{path:"sequence",component:ADt},{path:"feature",component:(()=>{class e{constructor(){this.settings={"line-height":24,"content-size":16,"background-color":"transparent","trace-color":"cyan","grid-color":"rgba(222, 226, 230, 0.5)","text-color":"white","margin-top":24,"margin-right":24,"margin-bottom":24,"margin-left":128},this.sequence=Array.from("MEEPQSDPSVEPPLSQETFSDLWKLLPENNVLSPLPSQAMDDLMLSPDDIEQWFTEDPGPDEAPRMPEAAPPVAPAPAAPTPAAPAPAPSWPLSSSVPSQKTYQGSYGFRLGFLHSGTAKSVTCTYSPALNKMFCQLAKTCPVQLWVDSTPPPGTRVRAMAIYKQSQHMTEVVRRCPHHERCSDSDGLAPPQHLIRVEGNLRVEYLDDRNTFRHSVVVPYEPPEVGSDCTTIHYNYMCNSSCMGGMNRRPILTIITLEDSSGNLLGRNSFEVRVCACPGRDRRTEEENLRKKGEPHHELPPGSTKRALPNNTSSSPQPKKKPLDGEYFTLQIRGRERFEMFRELNEALELKDAQAGKEPGGSRAHSSHLKSKKGQSTSRHKKLMFKTEGPDSD".slice(0,100)),this.features=[{label:"Feature #1",type:"continuous",values:Array.from({length:70},()=>Math.floor(100*Math.random())+1)},{label:"Feature #2",type:"loci","trace-color":"red",values:[{start:1,end:50},{start:30,end:60}]},{label:"Feature #3",type:"trace",position:"overlap",values:[{type:"loci",values:[{start:1,end:10}],"trace-color":"blue"},{type:"loci",values:[{start:20,end:40}],"trace-color":"red"},{type:"loci",values:[{start:60,end:100}],"trace-color":"yellow"},{type:"continuous",values:Array.from({length:70},()=>Math.floor(100*Math.random())+1),"trace-color":"yellow"}],"background-color":"transparent"},{label:"Feature #4",type:"loci",values:[{start:27,end:56},{start:61,end:72}],nested:[{label:"Feature #5",type:"trace",values:[{type:"loci",values:[{start:1,end:5},{start:6,end:10}]},{type:"loci",values:[{start:10,end:27}]}]},{label:"Feature #6",type:"continuous",values:Array.from({length:70},()=>Math.floor(100*Math.random())+1)}]},{label:"Feature #7",type:"loci",values:[{start:81,end:81},{start:82,end:82}],nested:[{label:"Feature #8",type:"trace",values:[{type:"loci",values:[{start:81,end:81}]},{type:"loci",values:[{start:82,end:82}]}]},{label:"Feature #9",type:"continuous","trace-color":"greenyellow",values:Array.from({length:70},()=>Math.floor(100*Math.random())+1)}]}]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=$d({type:e,selectors:[["page-features-viewer"]],standalone:!0,features:[Dh],decls:25,vars:3,consts:[[1,"container","pt-3"],[1,"mb-3"],[1,"d-flex","flex-row","gap-3","mb-3"],[2,"display","block","width","1rem","height","1rem","background","black","font-size","1rem","line-height","1rem"],[2,"display","block","width","1rem","height","auto","background","black","color","white","font-size","1rem","line-height",".5rem"],[2,"display","block","width","auto","height","1rem","background","black","color","white","font-size","1rem","line-height","1rem"],[1,"d-block","mb-3"],[2,"display","block","height","auto","width","100%"],[3,"sequence","features","settings"],[3,"ngx-features-viewer-label"],[1,"bi","bi-caret-down-fill"],[1,"bi","bi-caret-right"]],template:function(r,i){1&r&&(br(0,"div",0)(1,"div",1)(2,"h1"),Li(3,"Feature viewer"),Sr(),br(4,"p"),Li(5," The feature viewer allows you to represent features on a reference seqeunce... "),Sr()(),br(6,"div",2),js(7,"div",3),br(8,"div",4),Li(9," W"),Sr(),br(10,"div",5),Li(11," W"),Sr()(),br(12,"div",6)(13,"p"),Li(14," Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras congue velit in sem sodales pretium. Vivamus sit amet enim malesuada, efficitur quam quis, semper metus. Aenean commodo tellus eu viverra lacinia. Nam sed lectus non tellus suscipit pellentesque. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Suspendisse lacus diam, laoreet eget nisl et, dictum dictum elit. Vivamus sit amet fringilla elit, vitae pulvinar nisl. Donec mattis magna lacus, id congue risus aliquet a. "),Sr(),br(15,"p"),Li(16," Cras nec malesuada risus. Integer a tincidunt ante. Vivamus eu mauris placerat, dictum diam vitae, laoreet eros. Integer porttitor neque vel lectus ullamcorper commodo. Aliquam erat volutpat. Morbi convallis fermentum mauris, quis aliquet tellus posuere non. Nunc aliquet mattis tellus et ultrices. "),Sr()(),br(17,"div",7)(18,"ngx-features-viewer",8),Ym(19,vRt,4,4,"ng-template",9),Sr()(),br(20,"div")(21,"p"),Li(22," Morbi convallis ipsum sit amet felis faucibus mollis. Duis nec viverra nisl, nec maximus nisl. Proin non malesuada massa, sit amet auctor elit. Sed condimentum, urna id commodo semper, nisi lorem lobortis velit, eu auctor ante magna eu nibh. Aliquam mattis pulvinar sapien vitae rhoncus. Sed lacinia ex a ultrices finibus. Phasellus eu erat eu sapien laoreet dapibus ac vitae mauris. "),Sr(),br(23,"p"),Li(24," Vestibulum elementum sem vel lorem suscipit varius. Mauris malesuada porta sapien blandit facilisis. Aliquam pretium erat nec lorem molestie, et feugiat turpis semper. Donec tempus posuere nibh, maximus hendrerit odio eleifend vitae. Praesent consequat felis leo, at ullamcorper nisl dictum sed. Morbi erat dui, sollicitudin id interdum convallis, elementum laoreet lorem. Duis leo massa, commodo id tempor sed, semper ut dui. Proin faucibus feugiat sapien, et cursus nunc. Duis eu mattis ipsum, ac facilisis quam. Donec a sapien non lectus iaculis luctus. Nulla lobortis turpis id nisi consectetur aliquet. Aliquam dignissim aliquam erat, at egestas nulla ullamcorper a. Duis porta interdum venenatis. Praesent a lorem at velit egestas efficitur eu et lectus. Suspendisse potenti. Duis imperdiet aliquam hendrerit. "),Sr()()()),2&r&&(Yc(18),R0("sequence",i.sequence)("features",i.features)("settings",i.settings))},dependencies:[H2e,gRt,L0],changeDetection:0})}return e})()},{path:"",component:(()=>{class e{static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=$d({type:e,selectors:[["page-home"]],standalone:!0,features:[Dh],decls:48,vars:0,consts:[[1,"container","pt-3"],[1,"row"],[1,"col-12"],[1,"mb-3"],[1,"row","align-items-stretch","mb-3"],[1,"col-4"],["routerLink","/structure",1,"product-card","rounded","bg-body-tertiary","p-3","mb-3"],[1,"bi","bi-boxes","me-3"],["src","assets/structure-viewer.png","alt","Structure viewer",1,"w-100","h-auto","mb-3"],[1,"text-justify","mb-3"],[1,"text-center","mt-auto"],[1,"badge","rounded-pill","text-bg-warning"],[1,"bi","bi-chevron-right"],[1,"col-4","product"],["routerLink","/feature",1,"product-card","rounded","bg-body-tertiary","p-3","mb-3"],[1,"bi","bi-sliders"],["routerLink","/sequence",1,"product-card","rounded","bg-body-tertiary","p-3","mb-3"],[1,"bi","bi-body-text"],[1,"rounded","bg-body-tertiary","shadow-sm","p-3","mb-3"],[1,"bi","bi-share-fill"]],template:function(r,i){1&r&&(br(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),Li(4,"Products"),Sr()()(),br(5,"div",4)(6,"div",5)(7,"div",6)(8,"h2"),js(9,"i",7),Li(10," Structure viewer "),Sr(),js(11,"img",8),br(12,"p",9),Li(13," Visualize and interact with 3D molecular structures. Provides Mol* functionalities out-of-the-box for Angular developers. "),Sr(),br(14,"div",10)(15,"span",11),Li(16," Try it out "),js(17,"i",12),Sr()()()(),br(18,"div",13)(19,"div",14)(20,"h2"),js(21,"i",15),Li(22," Feature viewer "),Sr(),br(23,"p",3),Li(24," The feature viewer is a powerful tool designed for visualizing features of biological sequences, such as proteins, DNA, or RNA. It provides a comprehensive set of functionalities to explore and analyze these sequences. With the feature viewer, users can easily identify and visualize various features, including structural elements, functional domains, mutations, and more. It offers a user-friendly interface with intuitive gestures and actions, allowing users to zoom in and out, pan across the sequence, highlight specific regions, and perform interactive selections. Whether you are a biologist, bioinformatician, or researcher, the feature viewer is an indispensable tool for gaining insights into the intricate details of biological sequences. "),Sr(),br(25,"div",10)(26,"span",11),Li(27," Try it out "),js(28,"i",12),Sr()()()(),br(29,"div",5)(30,"div",16)(31,"h2"),js(32,"i",17),Li(33," Sequence viewer "),Sr(),br(34,"p",3),Li(35," The sequence viewer is a specialized tool designed for visualizing multiple sequence alignments and other features across protein sequences. It provides a comprehensive view of the similarities and differences between multiple protein sequences, allowing users to easily identify conserved regions, mutations, and other important features. The sequence viewer supports various display options, enabling users to customize the view according to their needs. It also allows for interactive exploration, with features such as zooming and panning, highlighting specific regions, and hovering over specific points for more detailed information. This makes the sequence viewer an essential tool for bioinformaticians and researchers studying protein sequences and their relationships. "),Sr(),br(36,"div",10)(37,"span",11),Li(38," Try it out "),js(39,"i",12),Sr()()()()(),br(40,"div",1)(41,"div",2)(42,"div",18)(43,"h2"),js(44,"i",19),Li(45," Enhanced interactivity"),Sr(),br(46,"p"),Li(47," Our components are designed starting from the same, generic data structures. This is meant to easily wire up various compoents in the same page. Hence, implementing interactivity out-of-the-box "),Sr()()()()())},dependencies:[L0,mU,wR],styles:[".product-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex-wrap:nowrap;height:100%;width:100%;cursor:pointer;box-shadow:0 .125rem .25rem #00000013}.product-card[_ngcontent-%COMP%]:hover{box-shadow:0 .5rem 1rem #00000026}"]})}return e})()},{path:"**",redirectTo:""}])]};(function M4e(e,t){return HPe({rootComponent:e,...wre(t)})})((()=>{class e{constructor(){this.title="ngx-bio-tools",this.sequence="MLPGLALLLLAAWTARALEVPTDGNAGLLAEPQIAMFCGRLNMHMNVQNGKWDSDPSGTKTCIDTKEGILQYCQEVYPELQITNVVEANQPVTIQNWCKRGRKQCKTHPHFVIPYRCLVGEFVSDALLVPDKCKFLHQERMDVCETHLHWHTVAKETCSEKSTNLHDYGMLLPCGIDKFRGVEFVCCPLAEESDNVDSADAEEDDSDVWWGGADTDYADGSEDKVVEVAEEEEVAEVEEEEADDDEDDEDGDEVEEEAEEPYEEATERTTSIATTTTTTTESVEEVVREVCSEQAETGPCRAMISRWYFDVTEGKCAPFFYGGCGGNRNNFDTEEYCMAVCGSAMSQSLLKTTQEPLARDPVKLPTTAASTPDAVDKYLETPGDENEHAHFQKAKERLEAKHRERMSQVMREWEEAERQAKNLPKADKKAVIQHFQEKVESLEQEAANERQQLVETHMARVEAMLNDRRRLALENYITALQAVPPRPRHVFNMLKKYVRAEQKDRQHTLKHFEHVRMVDPKKAAQIRSQVMTHLRVIYERMNQSLSLLYNVPAVAEEIQDEVDELLQKEQNYSDDVLANMISEPRISYGNDALMPSLTETKTTVELLPVNGEFSLDDLQPWHSFGADSVPANTENEVEPVDARPAADRGLTTRPGSGLTNIKTEEISEVKMDAEFRHDSGYEVHHQKLVFFAEDVGSNKGAIIGLMVGGVVIATVIVITLVMLKKKQYTSIHHGVVEVDAAVTPEERHLSKMQQNGYENPTYKFFEQMQN".split(""),this.features=[{id:0,type:"continuous",color:"blue",values:this.sequence.map(()=>Math.random()),parent:void 0,height:128},{id:1,type:"loci",color:"red",values:[{start:1,end:3},{start:5,end:6}],parent:void 0,height:96},{id:2,type:"pins",color:"green",values:[{start:5},{start:100,color:"blue"},{start:400,color:"red"}],parent:1},{id:3,type:"loci",color:"orange",values:[{start:10,end:20},{start:30,end:70}],parent:1},{id:4,type:"loci",color:"purple",values:[{start:100,end:300}],parent:void 0},{id:5,type:"dssp",color:"black",values:[{start:30,end:90,code:"H",color:"orange"},{start:120,end:300,code:"E",color:"purple"}],parent:void 0}]}static#e=this.\u0275fac=function(r){return new(r||e)};static#t=this.\u0275cmp=$d({type:e,selectors:[["app-root"]],standalone:!0,features:[Dh],decls:17,vars:0,consts:[[1,"navbar"],[1,"container-fluid"],["href","#",1,"navbar-brand"],["src","assets/ngx-biocomp-up-white.svg","alt","ngx-biocomp-up","height","32",1,"d-inline-block","align-text-top"],[1,"container-fluid","bg-dark","pt-2","pb-2"],[1,"row"],[1,"col-3","d-flex","justify-content-start"],["src","assets/biocomp.svg","alt","BioComputing UP","height","36"],[1,"col-6","d-flex","align-items-center","justify-content-center"],["href","https://github.com/damiclem",1,"text-light","small"],[1,"bi","bi-github"],[1,"col-3","d-flex","justify-content-end"],["src","assets/unipd.svg","alt","University of Padua","height","36"]],template:function(r,i){1&r&&(br(0,"header")(1,"nav",0)(2,"div",1)(3,"a",2),js(4,"img",3),Sr()()()(),br(5,"main"),js(6,"router-outlet"),Sr(),br(7,"footer",4)(8,"div",5)(9,"div",6),js(10,"img",7),Sr(),br(11,"div",8)(12,"a",9),Li(13," Developed by Damiano Clementel "),js(14,"i",10),Sr()(),br(15,"div",11),js(16,"img",12),Sr()()())},dependencies:[L0,mU,iU],styles:["[_nghost-%COMP%]{height:inherit;display:inherit;flex-direction:inherit}"]})}return e})(),_Rt).catch(e=>console.error(e))},216:ga=>{"use strict";var an=Object.prototype.hasOwnProperty,ln=Object.prototype.toString,Wr=Object.defineProperty,Ms=Object.getOwnPropertyDescriptor,Ki=function(rr){return"function"==typeof Array.isArray?Array.isArray(rr):"[object Array]"===ln.call(rr)},At=function(rr){if(!rr||"[object Object]"!==ln.call(rr))return!1;var lr,or=an.call(rr,"constructor"),kr=rr.constructor&&rr.constructor.prototype&&an.call(rr.constructor.prototype,"isPrototypeOf");if(rr.constructor&&!or&&!kr)return!1;for(lr in rr);return typeof lr>"u"||an.call(rr,lr)},Ma=function(rr,or){Wr&&"__proto__"===or.name?Wr(rr,or.name,{enumerable:!0,configurable:!0,value:or.newValue,writable:!0}):rr[or.name]=or.newValue},rs=function(rr,or){if("__proto__"===or){if(!an.call(rr,or))return;if(Ms)return Ms(rr,or).value}return rr[or]};ga.exports=function Ci(){var rr,or,kr,lr,Rs,zo,xr=arguments[0],ea=1,ta=arguments.length,vi=!1;for("boolean"==typeof xr&&(vi=xr,xr=arguments[1]||{},ea=2),(null==xr||"object"!=typeof xr&&"function"!=typeof xr)&&(xr={});ea<ta;++ea)if(null!=(rr=arguments[ea]))for(or in rr)kr=rs(xr,or),xr!==(lr=rs(rr,or))&&(vi&&lr&&(At(lr)||(Rs=Ki(lr)))?(Rs?(Rs=!1,zo=kr&&Ki(kr)?kr:[]):zo=kr&&At(kr)?kr:{},Ma(xr,{name:or,newValue:Ci(vi,zo,lr)})):typeof lr<"u"&&Ma(xr,{name:or,newValue:lr}));return xr}},763:ga=>{var an=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,ln=/\n/g,Wr=/^\s*/,Ms=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,Ki=/^:\s*/,At=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,Ma=/^[;\s]*/,rs=/^\s+|\s+$/g;function zo(xr){return xr?xr.replace(rs,""):""}ga.exports=function(xr,ea){if("string"!=typeof xr)throw new TypeError("First argument must be a string");if(!xr)return[];ea=ea||{};var ta=1,vi=1;function to($r){var fr=$r.match(ln);fr&&(ta+=fr.length);var no=$r.lastIndexOf("\n");vi=~no?$r.length-no:vi+$r.length}function Ul(){var $r={line:ta,column:vi};return function(fr){return fr.position=new Cc($r),Al(),fr}}function Cc($r){this.start=$r,this.end={line:ta,column:vi},this.source=ea.source}Cc.prototype.content=xr;var wc=[];function Ss($r){var fr=new Error(ea.source+":"+ta+":"+vi+": "+$r);if(fr.reason=$r,fr.filename=ea.source,fr.line=ta,fr.column=vi,fr.source=xr,!ea.silent)throw fr;wc.push(fr)}function Cs($r){var fr=$r.exec(xr);if(fr){var no=fr[0];return to(no),xr=xr.slice(no.length),fr}}function Al(){Cs(Wr)}function Ac($r){var fr;for($r=$r||[];fr=le();)!1!==fr&&$r.push(fr);return $r}function le(){var $r=Ul();if("/"==xr.charAt(0)&&"*"==xr.charAt(1)){for(var fr=2;""!=xr.charAt(fr)&&("*"!=xr.charAt(fr)||"/"!=xr.charAt(fr+1));)++fr;if(""===xr.charAt((fr+=2)-1))return Ss("End of comment missing");var no=xr.slice(2,fr-2);return vi+=2,to(no),xr=xr.slice(fr),vi+=2,$r({type:"comment",comment:no})}}function zf(){var $r=Ul(),fr=Cs(Ms);if(fr){if(le(),!Cs(Ki))return Ss("property missing ':'");var no=Cs(At),hr=$r({type:"declaration",property:zo(fr[0].replace(an,"")),value:no?zo(no[0].replace(an,"")):""});return Cs(Ma),hr}}return Al(),function Zi(){var fr,$r=[];for(Ac($r);fr=zf();)!1!==fr&&($r.push(fr),Ac($r));return $r}()}},578:(ga,an,ln)=>{"use strict";var Ms=ln(395),Ki=ln(605);function At(b){for(var S="https://reactjs.org/docs/error-decoder.html?invariant="+b,k=1;k<arguments.length;k++)S+="&args[]="+encodeURIComponent(arguments[k]);return"Minified React error #"+b+"; visit "+S+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Ma=new Set,rs={};function Ci(b,S){rr(b,S),rr(b+"Capture",S)}function rr(b,S){for(rs[b]=S,b=0;b<S.length;b++)Ma.add(S[b])}var or=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),kr=Object.prototype.hasOwnProperty,lr=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Rs={},zo={};function vi(b,S,k,U,Y,J,ve){this.acceptsBooleans=2===S||3===S||4===S,this.attributeName=U,this.attributeNamespace=Y,this.mustUseProperty=k,this.propertyName=b,this.type=S,this.sanitizeURL=J,this.removeEmptyString=ve}var to={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(b){to[b]=new vi(b,0,!1,b,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(b){var S=b[0];to[S]=new vi(S,1,!1,b[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(b){to[b]=new vi(b,2,!1,b.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(b){to[b]=new vi(b,2,!1,b,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(b){to[b]=new vi(b,3,!1,b.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(b){to[b]=new vi(b,3,!0,b,null,!1,!1)}),["capture","download"].forEach(function(b){to[b]=new vi(b,4,!1,b,null,!1,!1)}),["cols","rows","size","span"].forEach(function(b){to[b]=new vi(b,6,!1,b,null,!1,!1)}),["rowSpan","start"].forEach(function(b){to[b]=new vi(b,5,!1,b.toLowerCase(),null,!1,!1)});var Ul=/[\-:]([a-z])/g;function Cc(b){return b[1].toUpperCase()}function wc(b,S,k,U){var Y=to.hasOwnProperty(S)?to[S]:null;(null!==Y?0!==Y.type:U||!(2<S.length)||"o"!==S[0]&&"O"!==S[0]||"n"!==S[1]&&"N"!==S[1])&&(function ta(b,S,k,U){if(null===S||typeof S>"u"||function ea(b,S,k,U){if(null!==k&&0===k.type)return!1;switch(typeof S){case"function":case"symbol":return!0;case"boolean":return!U&&(null!==k?!k.acceptsBooleans:"data-"!==(b=b.toLowerCase().slice(0,5))&&"aria-"!==b);default:return!1}}(b,S,k,U))return!0;if(U)return!1;if(null!==k)switch(k.type){case 3:return!S;case 4:return!1===S;case 5:return isNaN(S);case 6:return isNaN(S)||1>S}return!1}(S,k,Y,U)&&(k=null),U||null===Y?function xr(b){return!!kr.call(zo,b)||!kr.call(Rs,b)&&(lr.test(b)?zo[b]=!0:(Rs[b]=!0,!1))}(S)&&(null===k?b.removeAttribute(S):b.setAttribute(S,""+k)):Y.mustUseProperty?b[Y.propertyName]=null===k?3!==Y.type&&"":k:(S=Y.attributeName,U=Y.attributeNamespace,null===k?b.removeAttribute(S):(k=3===(Y=Y.type)||4===Y&&!0===k?"":""+k,U?b.setAttributeNS(U,S,k):b.setAttribute(S,k))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(b){var S=b.replace(Ul,Cc);to[S]=new vi(S,1,!1,b,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(b){var S=b.replace(Ul,Cc);to[S]=new vi(S,1,!1,b,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(b){var S=b.replace(Ul,Cc);to[S]=new vi(S,1,!1,b,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(b){to[b]=new vi(b,1,!1,b.toLowerCase(),null,!1,!1)}),to.xlinkHref=new vi("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(b){to[b]=new vi(b,1,!1,b.toLowerCase(),null,!0,!0)});var Ss=Ms.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Cs=Symbol.for("react.element"),Al=Symbol.for("react.portal"),Ac=Symbol.for("react.fragment"),le=Symbol.for("react.strict_mode"),zf=Symbol.for("react.profiler"),Zi=Symbol.for("react.provider"),$r=Symbol.for("react.context"),fr=Symbol.for("react.forward_ref"),no=Symbol.for("react.suspense"),hr=Symbol.for("react.suspense_list"),sn=Symbol.for("react.memo"),er=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var Hr=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var et=Symbol.iterator;function Lt(b){return null===b||"object"!=typeof b?null:"function"==typeof(b=et&&b[et]||b["@@iterator"])?b:null}var fi,zn=Object.assign;function mi(b){if(void 0===fi)try{throw Error()}catch(k){var S=k.stack.trim().match(/\n( *(at )?)/);fi=S&&S[1]||""}return"\n"+fi+b}var Ni=!1;function po(b,S){if(!b||Ni)return"";Ni=!0;var k=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(S)if(S=function(){throw Error()},Object.defineProperty(S.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(S,[])}catch(pt){var U=pt}Reflect.construct(b,[],S)}else{try{S.call()}catch(pt){U=pt}b.call(S.prototype)}else{try{throw Error()}catch(pt){U=pt}b()}}catch(pt){if(pt&&U&&"string"==typeof pt.stack){for(var Y=pt.stack.split("\n"),J=U.stack.split("\n"),ve=Y.length-1,De=J.length-1;1<=ve&&0<=De&&Y[ve]!==J[De];)De--;for(;1<=ve&&0<=De;ve--,De--)if(Y[ve]!==J[De]){if(1!==ve||1!==De)do{if(ve--,0>--De||Y[ve]!==J[De]){var He="\n"+Y[ve].replace(" at new "," at ");return b.displayName&&He.includes("<anonymous>")&&(He=He.replace("<anonymous>",b.displayName)),He}}while(1<=ve&&0<=De);break}}}finally{Ni=!1,Error.prepareStackTrace=k}return(b=b?b.displayName||b.name:"")?mi(b):""}function ws(b){switch(b.tag){case 5:return mi(b.type);case 16:return mi("Lazy");case 13:return mi("Suspense");case 19:return mi("SuspenseList");case 0:case 2:case 15:return po(b.type,!1);case 11:return po(b.type.render,!1);case 1:return po(b.type,!0);default:return""}}function Vo(b){if(null==b)return null;if("function"==typeof b)return b.displayName||b.name||null;if("string"==typeof b)return b;switch(b){case Ac:return"Fragment";case Al:return"Portal";case zf:return"Profiler";case le:return"StrictMode";case no:return"Suspense";case hr:return"SuspenseList"}if("object"==typeof b)switch(b.$$typeof){case $r:return(b.displayName||"Context")+".Consumer";case Zi:return(b._context.displayName||"Context")+".Provider";case fr:var S=b.render;return(b=b.displayName)||(b=""!==(b=S.displayName||S.name||"")?"ForwardRef("+b+")":"ForwardRef"),b;case sn:return null!==(S=b.displayName||null)?S:Vo(b.type)||"Memo";case er:S=b._payload,b=b._init;try{return Vo(b(S))}catch{}}return null}function Ic(b){var S=b.type;switch(b.tag){case 24:return"Cache";case 9:return(S.displayName||"Context")+".Consumer";case 10:return(S._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return b=(b=S.render).displayName||b.name||"",S.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case 7:return"Fragment";case 5:return S;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vo(S);case 8:return S===le?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"==typeof S)return S.displayName||S.name||null;if("string"==typeof S)return S}return null}function ih(b){switch(typeof b){case"boolean":case"number":case"string":case"undefined":case"object":return b;default:return""}}function UI(b){var S=b.type;return(b=b.nodeName)&&"input"===b.toLowerCase()&&("checkbox"===S||"radio"===S)}function xm(b){b._valueTracker||(b._valueTracker=function G2(b){var S=UI(b)?"checked":"value",k=Object.getOwnPropertyDescriptor(b.constructor.prototype,S),U=""+b[S];if(!b.hasOwnProperty(S)&&typeof k<"u"&&"function"==typeof k.get&&"function"==typeof k.set){var Y=k.get,J=k.set;return Object.defineProperty(b,S,{configurable:!0,get:function(){return Y.call(this)},set:function(ve){U=""+ve,J.call(this,ve)}}),Object.defineProperty(b,S,{enumerable:k.enumerable}),{getValue:function(){return U},setValue:function(ve){U=""+ve},stopTracking:function(){b._valueTracker=null,delete b[S]}}}}(b))}function Jg(b){if(!b)return!1;var S=b._valueTracker;if(!S)return!0;var k=S.getValue(),U="";return b&&(U=UI(b)?b.checked?"true":"false":b.value),(b=U)!==k&&(S.setValue(b),!0)}function Iv(b){if(typeof(b=b||(typeof document<"u"?document:void 0))>"u")return null;try{return b.activeElement||b.body}catch{return b.body}}function _k(b,S){return zn({},S,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:S.checked??b._wrapperState.initialChecked})}function tL(b,S){var k=null==S.defaultValue?"":S.defaultValue,U=null!=S.checked?S.checked:S.defaultChecked;k=ih(null!=S.value?S.value:k),b._wrapperState={initialChecked:U,initialValue:k,controlled:"checkbox"===S.type||"radio"===S.type?null!=S.checked:null!=S.value}}function nL(b,S){null!=(S=S.checked)&&wc(b,"checked",S,!1)}function zI(b,S){nL(b,S);var k=ih(S.value),U=S.type;if(null!=k)"number"===U?(0===k&&""===b.value||b.value!=k)&&(b.value=""+k):b.value!==""+k&&(b.value=""+k);else if("submit"===U||"reset"===U)return void b.removeAttribute("value");S.hasOwnProperty("value")?Ck(b,S.type,k):S.hasOwnProperty("defaultValue")&&Ck(b,S.type,ih(S.defaultValue)),null==S.checked&&null!=S.defaultChecked&&(b.defaultChecked=!!S.defaultChecked)}function Sk(b,S,k){if(S.hasOwnProperty("value")||S.hasOwnProperty("defaultValue")){var U=S.type;if(("submit"===U||"reset"===U)&&null==S.value)return;S=""+b._wrapperState.initialValue,k||S===b.value||(b.value=S),b.defaultValue=S}""!==(k=b.name)&&(b.name=""),b.defaultChecked=!!b._wrapperState.initialChecked,""!==k&&(b.name=k)}function Ck(b,S,k){("number"!==S||Iv(b.ownerDocument)!==b)&&(null==k?b.defaultValue=""+b._wrapperState.initialValue:b.defaultValue!==""+k&&(b.defaultValue=""+k))}var hb=Array.isArray;function e0(b,S,k,U){if(b=b.options,S){S={};for(var Y=0;Y<k.length;Y++)S["$"+k[Y]]=!0;for(k=0;k<b.length;k++)Y=S.hasOwnProperty("$"+b[k].value),b[k].selected!==Y&&(b[k].selected=Y),Y&&U&&(b[k].defaultSelected=!0)}else{for(k=""+ih(k),S=null,Y=0;Y<b.length;Y++){if(b[Y].value===k)return b[Y].selected=!0,void(U&&(b[Y].defaultSelected=!0));null!==S||b[Y].disabled||(S=b[Y])}null!==S&&(S.selected=!0)}}function VI(b,S){if(null!=S.dangerouslySetInnerHTML)throw Error(At(91));return zn({},S,{value:void 0,defaultValue:void 0,children:""+b._wrapperState.initialValue})}function q2(b,S){var k=S.value;if(null==k){if(k=S.children,S=S.defaultValue,null!=k){if(null!=S)throw Error(At(92));if(hb(k)){if(1<k.length)throw Error(At(93));k=k[0]}S=k}null==S&&(S=""),k=S}b._wrapperState={initialValue:ih(k)}}function rL(b,S){var k=ih(S.value),U=ih(S.defaultValue);null!=k&&((k=""+k)!==b.value&&(b.value=k),null==S.defaultValue&&b.defaultValue!==k&&(b.defaultValue=k)),null!=U&&(b.defaultValue=""+U)}function iL(b){var S=b.textContent;S===b._wrapperState.initialValue&&""!==S&&null!==S&&(b.value=S)}function oL(b){switch(b){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function HI(b,S){return null==b||"http://www.w3.org/1999/xhtml"===b?oL(S):"http://www.w3.org/2000/svg"===b&&"foreignObject"===S?"http://www.w3.org/1999/xhtml":b}var GI,b,wk=(b=function(b,S){if("http://www.w3.org/2000/svg"!==b.namespaceURI||"innerHTML"in b)b.innerHTML=S;else{for((GI=GI||document.createElement("div")).innerHTML="<svg>"+S.valueOf().toString()+"</svg>",S=GI.firstChild;b.firstChild;)b.removeChild(b.firstChild);for(;S.firstChild;)b.appendChild(S.firstChild)}},typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(S,k,U,Y){MSApp.execUnsafeLocalFunction(function(){return b(S,k)})}:b);function Ev(b,S){if(S){var k=b.firstChild;if(k&&k===b.lastChild&&3===k.nodeType)return void(k.nodeValue=S)}b.textContent=S}var W2={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ak=["Webkit","ms","Moz","O"];function Ik(b,S,k){return null==S||"boolean"==typeof S||""===S?"":k||"number"!=typeof S||0===S||W2.hasOwnProperty(b)&&W2[b]?(""+S).trim():S+"px"}function sL(b,S){for(var k in b=b.style,S)if(S.hasOwnProperty(k)){var U=0===k.indexOf("--"),Y=Ik(k,S[k],U);"float"===k&&(k="cssFloat"),U?b.setProperty(k,Y):b[k]=Y}}Object.keys(W2).forEach(function(b){Ak.forEach(function(S){S=S+b.charAt(0).toUpperCase()+b.substring(1),W2[S]=W2[b]})});var Yo=zn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Tv(b,S){if(S){if(Yo[b]&&(null!=S.children||null!=S.dangerouslySetInnerHTML))throw Error(At(137,b));if(null!=S.dangerouslySetInnerHTML){if(null!=S.children)throw Error(At(60));if("object"!=typeof S.dangerouslySetInnerHTML||!("__html"in S.dangerouslySetInnerHTML))throw Error(At(61))}if(null!=S.style&&"object"!=typeof S.style)throw Error(At(62))}}function Dv(b,S){if(-1===b.indexOf("-"))return"string"==typeof S.is;switch(b){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var mb=null;function Il(b){return(b=b.target||b.srcElement||window).correspondingUseElement&&(b=b.correspondingUseElement),3===b.nodeType?b.parentNode:b}var $2=null,t0=null,n0=null;function _m(b){if(b=ex(b)){if("function"!=typeof $2)throw Error(At(280));var S=b.stateNode;S&&(S=tx(S),$2(b.stateNode,b.type,S))}}function Pv(b){t0?n0?n0.push(b):n0=[b]:t0=b}function qI(){if(t0){var b=t0,S=n0;if(n0=t0=null,_m(b),S)for(b=0;b<S.length;b++)_m(S[b])}}function kv(b,S){return b(S)}function Ek(){}var WI=!1;function Tk(b,S,k){if(WI)return b(S,k);WI=!0;try{return kv(b,S,k)}finally{WI=!1,(null!==t0||null!==n0)&&(Ek(),qI())}}function r0(b,S){var k=b.stateNode;if(null===k)return null;var U=tx(k);if(null===U)return null;k=U[S];e:switch(S){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(U=!U.disabled)||(U=!("button"===(b=b.type)||"input"===b||"select"===b||"textarea"===b)),b=!U;break e;default:b=!1}if(b)return null;if(k&&"function"!=typeof k)throw Error(At(231,S,typeof k));return k}var oh=!1;if(or)try{var Sm={};Object.defineProperty(Sm,"passive",{get:function(){oh=!0}}),window.addEventListener("test",Sm,Sm),window.removeEventListener("test",Sm,Sm)}catch{oh=!1}function aL(b,S,k,U,Y,J,ve,De,He){var pt=Array.prototype.slice.call(arguments,3);try{S.apply(k,pt)}catch(Ot){this.onError(Ot)}}var o0=!1,Y2=null,gb=!1,$I=null,Mv={onError:function(b){o0=!0,Y2=b}};function X2(b,S,k,U,Y,J,ve,De,He){o0=!1,Y2=null,aL.apply(Mv,arguments)}function sh(b){var S=b,k=b;if(b.alternate)for(;S.return;)S=S.return;else{b=S;do{4098&(S=b).flags&&(k=S.return),b=S.return}while(b)}return 3===S.tag?k:null}function Dk(b){if(13===b.tag){var S=b.memoizedState;if(null===S&&null!==(b=b.alternate)&&(S=b.memoizedState),null!==S)return S.dehydrated}return null}function K2(b){if(sh(b)!==b)throw Error(At(188))}function YI(b){return null!==(b=function ah(b){var S=b.alternate;if(!S){if(null===(S=sh(b)))throw Error(At(188));return S!==b?null:b}for(var k=b,U=S;;){var Y=k.return;if(null===Y)break;var J=Y.alternate;if(null===J){if(null!==(U=Y.return)){k=U;continue}break}if(Y.child===J.child){for(J=Y.child;J;){if(J===k)return K2(Y),b;if(J===U)return K2(Y),S;J=J.sibling}throw Error(At(188))}if(k.return!==U.return)k=Y,U=J;else{for(var ve=!1,De=Y.child;De;){if(De===k){ve=!0,k=Y,U=J;break}if(De===U){ve=!0,U=Y,k=J;break}De=De.sibling}if(!ve){for(De=J.child;De;){if(De===k){ve=!0,k=J,U=Y;break}if(De===U){ve=!0,U=J,k=Y;break}De=De.sibling}if(!ve)throw Error(At(189))}}if(k.alternate!==U)throw Error(At(190))}if(3!==k.tag)throw Error(At(188));return k.stateNode.current===k?b:S}(b))?XI(b):null}function XI(b){if(5===b.tag||6===b.tag)return b;for(b=b.child;null!==b;){var S=XI(b);if(null!==S)return S;b=b.sibling}return null}var Ra=Ki.unstable_scheduleCallback,KI=Ki.unstable_cancelCallback,cL=Ki.unstable_shouldYield,uL=Ki.unstable_requestPaint,na=Ki.unstable_now,si=Ki.unstable_getCurrentPriorityLevel,Z2=Ki.unstable_ImmediatePriority,Ao=Ki.unstable_UserBlockingPriority,Rv=Ki.unstable_NormalPriority,is=Ki.unstable_LowPriority,Xo=Ki.unstable_IdlePriority,Q2=null,hn=null,ad=Math.clz32?Math.clz32:function J2(b){return 0===(b>>>=0)?32:31-(Xt(b)/yb|0)|0},Xt=Math.log,yb=Math.LN2,Nv=64,ZI=4194304;function eS(b){switch(b&-b){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&b;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&b;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return b}}function Fv(b,S){var k=b.pendingLanes;if(0===k)return 0;var U=0,Y=b.suspendedLanes,J=b.pingedLanes,ve=268435455&k;if(0!==ve){var De=ve&~Y;0!==De?U=eS(De):0!=(J&=ve)&&(U=eS(J))}else 0!=(ve=k&~Y)?U=eS(ve):0!==J&&(U=eS(J));if(0===U)return 0;if(0!==S&&S!==U&&!(S&Y)&&((Y=U&-U)>=(J=S&-S)||16===Y&&4194240&J))return S;if(4&U&&(U|=16&k),0!==(S=b.entangledLanes))for(b=b.entanglements,S&=U;0<S;)U|=b[k=31-ad(S)],S&=~(Y=1<<k);return U}function lh(b,S){switch(b){case 1:case 2:case 4:return S+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return S+5e3;default:return-1}}function Cm(b){return 0!=(b=-1073741825&b.pendingLanes)?b:1073741824&b?1073741824:0}function s0(){var b=Nv;return!(4194240&(Nv<<=1))&&(Nv=64),b}function tS(b){for(var S=[],k=0;31>k;k++)S.push(b);return S}function a0(b,S,k){b.pendingLanes|=S,536870912!==S&&(b.suspendedLanes=0,b.pingedLanes=0),(b=b.eventTimes)[S=31-ad(S)]=k}function Pk(b,S){var k=b.entangledLanes|=S;for(b=b.entanglements;k;){var U=31-ad(k),Y=1<<U;Y&S|b[U]&S&&(b[U]|=S),k&=~Y}}var Gn=0;function dL(b){return 1<(b&=-b)?4<b?268435455&b?16:536870912:4:1}var fL,Qi,kk,ya,nS,Mk=!1,rS=[],Vf=null,Zn=null,qd=null,El=new Map,iS=new Map,wm=[],BK="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ch(b,S){switch(b){case"focusin":case"focusout":Vf=null;break;case"dragenter":case"dragleave":Zn=null;break;case"mouseover":case"mouseout":qd=null;break;case"pointerover":case"pointerout":El.delete(S.pointerId);break;case"gotpointercapture":case"lostpointercapture":iS.delete(S.pointerId)}}function oS(b,S,k,U,Y,J){return null===b||b.nativeEvent!==J?(b={blockedOn:S,domEventName:k,eventSystemFlags:U,nativeEvent:J,targetContainers:[Y]},null!==S&&null!==(S=ex(S))&&Qi(S),b):(b.eventSystemFlags|=U,S=b.targetContainers,null!==Y&&-1===S.indexOf(Y)&&S.push(Y),b)}function pL(b){var S=ph(b.target);if(null!==S){var k=sh(S);if(null!==k)if(13===(S=k.tag)){if(null!==(S=Dk(k)))return b.blockedOn=S,void nS(b.priority,function(){kk(k)})}else if(3===S&&k.stateNode.current.memoizedState.isDehydrated)return void(b.blockedOn=3===k.tag?k.stateNode.containerInfo:null)}b.blockedOn=null}function QI(b){if(null!==b.blockedOn)return!1;for(var S=b.targetContainers;0<S.length;){var k=Fk(b.domEventName,b.eventSystemFlags,S[0],b.nativeEvent);if(null!==k)return null!==(S=ex(k))&&Qi(S),b.blockedOn=k,!1;var U=new(k=b.nativeEvent).constructor(k.type,k);mb=U,k.target.dispatchEvent(U),mb=null,S.shift()}return!0}function Rk(b,S,k){QI(b)&&k.delete(S)}function jK(){Mk=!1,null!==Vf&&QI(Vf)&&(Vf=null),null!==Zn&&QI(Zn)&&(Zn=null),null!==qd&&QI(qd)&&(qd=null),El.forEach(Rk),iS.forEach(Rk)}function Ov(b,S){b.blockedOn===S&&(b.blockedOn=null,Mk||(Mk=!0,Ki.unstable_scheduleCallback(Ki.unstable_NormalPriority,jK)))}function sS(b){function S(Y){return Ov(Y,b)}if(0<rS.length){Ov(rS[0],b);for(var k=1;k<rS.length;k++){var U=rS[k];U.blockedOn===b&&(U.blockedOn=null)}}for(null!==Vf&&Ov(Vf,b),null!==Zn&&Ov(Zn,b),null!==qd&&Ov(qd,b),El.forEach(S),iS.forEach(S),k=0;k<wm.length;k++)(U=wm[k]).blockedOn===b&&(U.blockedOn=null);for(;0<wm.length&&null===(k=wm[0]).blockedOn;)pL(k),null===k.blockedOn&&wm.shift()}var Qa=Ss.ReactCurrentBatchConfig,sr=!0;function UK(b,S,k,U){var Y=Gn,J=Qa.transition;Qa.transition=null;try{Gn=1,Nk(b,S,k,U)}finally{Gn=Y,Qa.transition=J}}function zK(b,S,k,U){var Y=Gn,J=Qa.transition;Qa.transition=null;try{Gn=4,Nk(b,S,k,U)}finally{Gn=Y,Qa.transition=J}}function Nk(b,S,k,U){if(sr){var Y=Fk(b,S,k,U);if(null===Y)uE(b,S,U,JI,k),ch(b,U);else if(function LK(b,S,k,U,Y){switch(S){case"focusin":return Vf=oS(Vf,b,S,k,U,Y),!0;case"dragenter":return Zn=oS(Zn,b,S,k,U,Y),!0;case"mouseover":return qd=oS(qd,b,S,k,U,Y),!0;case"pointerover":var J=Y.pointerId;return El.set(J,oS(El.get(J)||null,b,S,k,U,Y)),!0;case"gotpointercapture":return iS.set(J=Y.pointerId,oS(iS.get(J)||null,b,S,k,U,Y)),!0}return!1}(Y,b,S,k,U))U.stopPropagation();else if(ch(b,U),4&S&&-1<BK.indexOf(b)){for(;null!==Y;){var J=ex(Y);if(null!==J&&fL(J),null===(J=Fk(b,S,k,U))&&uE(b,S,U,JI,k),J===Y)break;Y=J}null!==Y&&U.stopPropagation()}else uE(b,S,U,null,k)}}var JI=null;function Fk(b,S,k,U){if(JI=null,null!==(b=ph(b=Il(U))))if(null===(S=sh(b)))b=null;else if(13===(k=S.tag)){if(null!==(b=Dk(S)))return b;b=null}else if(3===k){if(S.stateNode.current.memoizedState.isDehydrated)return 3===S.tag?S.stateNode.containerInfo:null;b=null}else S!==b&&(b=null);return JI=b,null}function gn(b){switch(b){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(si()){case Z2:return 1;case Ao:return 4;case Rv:case is:return 16;case Xo:return 536870912;default:return 16}default:return 16}}var l0=null,c0=null,u0=null;function Ok(){if(u0)return u0;var b,U,S=c0,k=S.length,Y="value"in l0?l0.value:l0.textContent,J=Y.length;for(b=0;b<k&&S[b]===Y[b];b++);var ve=k-b;for(U=1;U<=ve&&S[k-U]===Y[J-U];U++);return u0=Y.slice(b,1<U?1-U:void 0)}function Bv(b){var S=b.keyCode;return"charCode"in b?0===(b=b.charCode)&&13===S&&(b=13):b=S,10===b&&(b=13),32<=b||13===b?b:0}function aS(){return!0}function Lv(){return!1}function zl(b){function S(k,U,Y,J,ve){for(var De in this._reactName=k,this._targetInst=Y,this.type=U,this.nativeEvent=J,this.target=ve,this.currentTarget=null,b)b.hasOwnProperty(De)&&(this[De]=(k=b[De])?k(J):J[De]);return this.isDefaultPrevented=(null!=J.defaultPrevented?J.defaultPrevented:!1===J.returnValue)?aS:Lv,this.isPropagationStopped=Lv,this}return zn(S.prototype,{preventDefault:function(){this.defaultPrevented=!0;var k=this.nativeEvent;k&&(k.preventDefault?k.preventDefault():"unknown"!=typeof k.returnValue&&(k.returnValue=!1),this.isDefaultPrevented=aS)},stopPropagation:function(){var k=this.nativeEvent;k&&(k.stopPropagation?k.stopPropagation():"unknown"!=typeof k.cancelBubble&&(k.cancelBubble=!0),this.isPropagationStopped=aS)},persist:function(){},isPersistent:aS}),S}var Uv,zv,xb,Am={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(b){return b.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lS=zl(Am),jv=zn({},Am,{view:0,detail:0}),jn=zl(jv),_b=zn({},jv,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fi,button:0,buttons:0,relatedTarget:function(b){return void 0===b.relatedTarget?b.fromElement===b.srcElement?b.toElement:b.fromElement:b.relatedTarget},movementX:function(b){return"movementX"in b?b.movementX:(b!==xb&&(xb&&"mousemove"===b.type?(Uv=b.screenX-xb.screenX,zv=b.screenY-xb.screenY):zv=Uv=0,xb=b),Uv)},movementY:function(b){return"movementY"in b?b.movementY:zv}}),Bk=zl(_b),VK=zl(zn({},_b,{dataTransfer:0})),Lk=zl(zn({},jv,{relatedTarget:0})),tE=zl(zn({},Am,{animationName:0,elapsedTime:0,pseudoElement:0})),Vv=zn({},Am,{clipboardData:function(b){return"clipboardData"in b?b.clipboardData:window.clipboardData}}),nE=zl(Vv),iE=zl(zn({},Am,{data:0})),uh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Hv={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},jk={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tr(b){var S=this.nativeEvent;return S.getModifierState?S.getModifierState(b):!!(b=jk[b])&&!!S[b]}function Fi(){return Tr}var qK=zn({},jv,{key:function(b){if(b.key){var S=uh[b.key]||b.key;if("Unidentified"!==S)return S}return"keypress"===b.type?13===(b=Bv(b))?"Enter":String.fromCharCode(b):"keydown"===b.type||"keyup"===b.type?Hv[b.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fi,charCode:function(b){return"keypress"===b.type?Bv(b):0},keyCode:function(b){return"keydown"===b.type||"keyup"===b.type?b.keyCode:0},which:function(b){return"keypress"===b.type?Bv(b):"keydown"===b.type||"keyup"===b.type?b.keyCode:0}}),hL=zl(qK),gL=zl(zn({},_b,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),oE=zl(zn({},jv,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fi})),sE=zl(zn({},Am,{propertyName:0,elapsedTime:0,pseudoElement:0})),Uk=zn({},_b,{deltaX:function(b){return"deltaX"in b?b.deltaX:"wheelDeltaX"in b?-b.wheelDeltaX:0},deltaY:function(b){return"deltaY"in b?b.deltaY:"wheelDeltaY"in b?-b.wheelDeltaY:"wheelDelta"in b?-b.wheelDelta:0},deltaZ:0,deltaMode:0}),Uc=zl(Uk),zk=[9,13,27,32],Vk=or&&"CompositionEvent"in window,cS=null;or&&"documentMode"in document&&(cS=document.documentMode);var Gv=or&&"TextEvent"in window&&!cS,uS=or&&(!Vk||cS&&8<cS&&11>=cS),qv=" ",Hk=!1;function Gk(b,S){switch(b){case"keyup":return-1!==zk.indexOf(S.keyCode);case"keydown":return 229!==S.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qk(b){return"object"==typeof(b=b.detail)&&"data"in b?b.data:null}var d0=!1,Im={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wk(b){var S=b&&b.nodeName&&b.nodeName.toLowerCase();return"input"===S?!!Im[b.type]:"textarea"===S}function Rn(b,S,k,U){Pv(U),0<(S=CS(S,"onChange")).length&&(k=new lS("onChange","change",null,k,U),b.push({event:k,listeners:S}))}var Cb=null,qt=null;function dS(b){dd(b,0)}function wb(b){if(Jg(Dm(b)))return b}function Wv(b,S){if("change"===b)return S}var $k=!1;if(or){var aE;if(or){var lE="oninput"in document;if(!lE){var Yk=document.createElement("div");Yk.setAttribute("oninput","return;"),lE="function"==typeof Yk.oninput}aE=lE}else aE=!1;$k=aE&&(!document.documentMode||9<document.documentMode)}function $v(){Cb&&(Cb.detachEvent("onpropertychange",Xk),qt=Cb=null)}function Xk(b){if("value"===b.propertyName&&wb(qt)){var S=[];Rn(S,qt,b,Il(b)),Tk(dS,S)}}function fS(b,S,k){"focusin"===b?($v(),qt=k,(Cb=S).attachEvent("onpropertychange",Xk)):"focusout"===b&&$v()}function vL(b){if("selectionchange"===b||"keyup"===b||"keydown"===b)return wb(qt)}function f0(b,S){if("click"===b)return wb(S)}function xL(b,S){if("input"===b||"change"===b)return wb(S)}var Vl="function"==typeof Object.is?Object.is:function zc(b,S){return b===S&&(0!==b||1/b==1/S)||b!=b&&S!=S};function Ab(b,S){if(Vl(b,S))return!0;if("object"!=typeof b||null===b||"object"!=typeof S||null===S)return!1;var k=Object.keys(b),U=Object.keys(S);if(k.length!==U.length)return!1;for(U=0;U<k.length;U++){var Y=k[U];if(!kr.call(S,Y)||!Vl(b[Y],S[Y]))return!1}return!0}function Yv(b){for(;b&&b.firstChild;)b=b.firstChild;return b}function Xv(b,S){var U,k=Yv(b);for(b=0;k;){if(3===k.nodeType){if(U=b+k.textContent.length,b<=S&&U>=S)return{node:k,offset:S-b};b=U}e:{for(;k;){if(k.nextSibling){k=k.nextSibling;break e}k=k.parentNode}k=void 0}k=Yv(k)}}function pS(b,S){return!(!b||!S)&&(b===S||(!b||3!==b.nodeType)&&(S&&3===S.nodeType?pS(b,S.parentNode):"contains"in b?b.contains(S):!!b.compareDocumentPosition&&!!(16&b.compareDocumentPosition(S))))}function _L(){for(var b=window,S=Iv();S instanceof b.HTMLIFrameElement;){try{var k="string"==typeof S.contentWindow.location.href}catch{k=!1}if(!k)break;S=Iv((b=S.contentWindow).document)}return S}function hS(b){var S=b&&b.nodeName&&b.nodeName.toLowerCase();return S&&("input"===S&&("text"===b.type||"search"===b.type||"tel"===b.type||"url"===b.type||"password"===b.type)||"textarea"===S||"true"===b.contentEditable)}function WK(b){var S=_L(),k=b.focusedElem,U=b.selectionRange;if(S!==k&&k&&k.ownerDocument&&pS(k.ownerDocument.documentElement,k)){if(null!==U&&hS(k))if(S=U.start,void 0===(b=U.end)&&(b=S),"selectionStart"in k)k.selectionStart=S,k.selectionEnd=Math.min(b,k.value.length);else if((b=(S=k.ownerDocument||document)&&S.defaultView||window).getSelection){b=b.getSelection();var Y=k.textContent.length,J=Math.min(U.start,Y);U=void 0===U.end?J:Math.min(U.end,Y),!b.extend&&J>U&&(Y=U,U=J,J=Y),Y=Xv(k,J);var ve=Xv(k,U);Y&&ve&&(1!==b.rangeCount||b.anchorNode!==Y.node||b.anchorOffset!==Y.offset||b.focusNode!==ve.node||b.focusOffset!==ve.offset)&&((S=S.createRange()).setStart(Y.node,Y.offset),b.removeAllRanges(),J>U?(b.addRange(S),b.extend(ve.node,ve.offset)):(S.setEnd(ve.node,ve.offset),b.addRange(S)))}for(S=[],b=k;b=b.parentNode;)1===b.nodeType&&S.push({element:b,left:b.scrollLeft,top:b.scrollTop});for("function"==typeof k.focus&&k.focus(),k=0;k<S.length;k++)(b=S[k]).element.scrollLeft=b.left,b.element.scrollTop=b.top}}var xu=or&&"documentMode"in document&&11>=document.documentMode,Em=null,Tm=null,mS=null,gS=!1;function Wd(b,S,k){var U=k.window===k?k.document:9===k.nodeType?k:k.ownerDocument;gS||null==Em||Em!==Iv(U)||(U="selectionStart"in(U=Em)&&hS(U)?{start:U.selectionStart,end:U.selectionEnd}:{anchorNode:(U=(U.ownerDocument&&U.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:U.anchorOffset,focusNode:U.focusNode,focusOffset:U.focusOffset},mS&&Ab(mS,U)||(mS=U,0<(U=CS(Tm,"onSelect")).length&&(S=new lS("onSelect","select",null,S,k),b.push({event:S,listeners:U}),S.target=Em)))}function xi(b,S){var k={};return k[b.toLowerCase()]=S.toLowerCase(),k["Webkit"+b]="webkit"+S,k["Moz"+b]="moz"+S,k}var ld={animationend:xi("Animation","AnimationEnd"),animationiteration:xi("Animation","AnimationIteration"),animationstart:xi("Animation","AnimationStart"),transitionend:xi("Transition","TransitionEnd")},yS={},bS={};function p0(b){if(yS[b])return yS[b];if(!ld[b])return b;var k,S=ld[b];for(k in S)if(S.hasOwnProperty(k)&&k in bS)return yS[b]=S[k];return b}or&&(bS=document.createElement("div").style,"AnimationEvent"in window||(delete ld.animationend.animation,delete ld.animationiteration.animation,delete ld.animationstart.animation),"TransitionEvent"in window||delete ld.transitionend.transition);var Kv=p0("animationend"),cd=p0("animationiteration"),ud=p0("animationstart"),Kk=p0("transitionend"),vS=new Map,cE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function dh(b,S){vS.set(b,S),Ci(S,[b])}for(var h0=0;h0<cE.length;h0++){var xS=cE[h0];dh(xS.toLowerCase(),"on"+(xS[0].toUpperCase()+xS.slice(1)))}dh(Kv,"onAnimationEnd"),dh(cd,"onAnimationIteration"),dh(ud,"onAnimationStart"),dh("dblclick","onDoubleClick"),dh("focusin","onFocus"),dh("focusout","onBlur"),dh(Kk,"onTransitionEnd"),rr("onMouseEnter",["mouseout","mouseover"]),rr("onMouseLeave",["mouseout","mouseover"]),rr("onPointerEnter",["pointerout","pointerover"]),rr("onPointerLeave",["pointerout","pointerover"]),Ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Ci("onBeforeInput",["compositionend","keypress","textInput","paste"]),Ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var m0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CL=new Set("cancel close invalid load scroll toggle".split(" ").concat(m0));function Qk(b,S,k){var U=b.type||"unknown-event";b.currentTarget=k,function lL(b,S,k,U,Y,J,ve,De,He){if(X2.apply(this,arguments),o0){if(!o0)throw Error(At(198));var pt=Y2;o0=!1,Y2=null,gb||(gb=!0,$I=pt)}}(U,S,void 0,b),b.currentTarget=null}function dd(b,S){S=!!(4&S);for(var k=0;k<b.length;k++){var U=b[k],Y=U.event;U=U.listeners;e:{var J=void 0;if(S)for(var ve=U.length-1;0<=ve;ve--){var De=U[ve],He=De.instance,pt=De.currentTarget;if(De=De.listener,He!==J&&Y.isPropagationStopped())break e;Qk(Y,De,pt),J=He}else for(ve=0;ve<U.length;ve++){if(He=(De=U[ve]).instance,pt=De.currentTarget,De=De.listener,He!==J&&Y.isPropagationStopped())break e;Qk(Y,De,pt),J=He}}}if(gb)throw b=$I,gb=!1,$I=null,b}function Ko(b,S){var k=S[AS];void 0===k&&(k=S[AS]=new Set);var U=b+"__bubble";k.has(U)||(Jk(S,b,2,!1),k.add(U))}function _S(b,S,k){var U=0;S&&(U|=4),Jk(k,b,U,S)}var SS="_reactListening"+Math.random().toString(36).slice(2);function Zv(b){if(!b[SS]){b[SS]=!0,Ma.forEach(function(k){"selectionchange"!==k&&(CL.has(k)||_S(k,!1,b),_S(k,!0,b))});var S=9===b.nodeType?b:b.ownerDocument;null===S||S[SS]||(S[SS]=!0,_S("selectionchange",!1,S))}}function Jk(b,S,k,U){switch(gn(S)){case 1:var Y=UK;break;case 4:Y=zK;break;default:Y=Nk}k=Y.bind(null,S,k,b),Y=void 0,!oh||"touchstart"!==S&&"touchmove"!==S&&"wheel"!==S||(Y=!0),b.addEventListener(S,k,U?void 0===Y||{capture:!0,passive:Y}:void 0!==Y&&{passive:Y})}function uE(b,S,k,U,Y){var J=U;if(!(1&S||2&S||null===U))e:for(;;){if(null===U)return;var ve=U.tag;if(3===ve||4===ve){var De=U.stateNode.containerInfo;if(De===Y||8===De.nodeType&&De.parentNode===Y)break;if(4===ve)for(ve=U.return;null!==ve;){var He=ve.tag;if((3===He||4===He)&&((He=ve.stateNode.containerInfo)===Y||8===He.nodeType&&He.parentNode===Y))return;ve=ve.return}for(;null!==De;){if(null===(ve=ph(De)))return;if(5===(He=ve.tag)||6===He){U=J=ve;continue e}De=De.parentNode}}U=U.return}Tk(function(){var pt=J,Ot=Il(k),Wt=[];e:{var Bt=vS.get(b);if(void 0!==Bt){var yn=lS,Tn=b;switch(b){case"keypress":if(0===Bv(k))break e;case"keydown":case"keyup":yn=hL;break;case"focusin":Tn="focus",yn=Lk;break;case"focusout":Tn="blur",yn=Lk;break;case"beforeblur":case"afterblur":yn=Lk;break;case"click":if(2===k.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":yn=Bk;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":yn=VK;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":yn=oE;break;case Kv:case cd:case ud:yn=tE;break;case Kk:yn=sE;break;case"scroll":yn=jn;break;case"wheel":yn=Uc;break;case"copy":case"cut":case"paste":yn=nE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":yn=gL}var Nn=!!(4&S),sa=!Nn&&"scroll"===b,it=Nn?null!==Bt?Bt+"Capture":null:Bt;Nn=[];for(var lt,We=pt;null!==We;){var tn=(lt=We).stateNode;if(5===lt.tag&&null!==tn&&(lt=tn,null!==it&&null!=(tn=r0(We,it))&&Nn.push(Ib(We,tn,lt))),sa)break;We=We.return}0<Nn.length&&(Bt=new yn(Bt,Tn,null,k,Ot),Wt.push({event:Bt,listeners:Nn}))}}if(!(7&S)){if(yn="mouseout"===b||"pointerout"===b,(!(Bt="mouseover"===b||"pointerover"===b)||k===mb||!(Tn=k.relatedTarget||k.fromElement)||!ph(Tn)&&!Tn[Xd])&&(yn||Bt)&&(Bt=Ot.window===Ot?Ot:(Bt=Ot.ownerDocument)?Bt.defaultView||Bt.parentWindow:window,yn?(yn=pt,null!==(Tn=(Tn=k.relatedTarget||k.toElement)?ph(Tn):null)&&(Tn!==(sa=sh(Tn))||5!==Tn.tag&&6!==Tn.tag)&&(Tn=null)):(yn=null,Tn=pt),yn!==Tn)){if(Nn=Bk,tn="onMouseLeave",it="onMouseEnter",We="mouse",("pointerout"===b||"pointerover"===b)&&(Nn=gL,tn="onPointerLeave",it="onPointerEnter",We="pointer"),sa=null==yn?Bt:Dm(yn),lt=null==Tn?Bt:Dm(Tn),(Bt=new Nn(tn,We+"leave",yn,k,Ot)).target=sa,Bt.relatedTarget=lt,tn=null,ph(Ot)===pt&&((Nn=new Nn(it,We+"enter",Tn,k,Ot)).target=lt,Nn.relatedTarget=sa,tn=Nn),sa=tn,yn&&Tn)t:{for(it=Tn,We=0,lt=Nn=yn;lt;lt=Eb(lt))We++;for(lt=0,tn=it;tn;tn=Eb(tn))lt++;for(;0<We-lt;)Nn=Eb(Nn),We--;for(;0<lt-We;)it=Eb(it),lt--;for(;We--;){if(Nn===it||null!==it&&Nn===it.alternate)break t;Nn=Eb(Nn),it=Eb(it)}Nn=null}else Nn=null;null!==yn&&eM(Wt,Bt,yn,Nn,!1),null!==Tn&&null!==sa&&eM(Wt,sa,Tn,Nn,!0)}if("select"===(yn=(Bt=pt?Dm(pt):window).nodeName&&Bt.nodeName.toLowerCase())||"input"===yn&&"file"===Bt.type)var Fn=Wv;else if(Wk(Bt))if($k)Fn=xL;else{Fn=vL;var cr=fS}else(yn=Bt.nodeName)&&"input"===yn.toLowerCase()&&("checkbox"===Bt.type||"radio"===Bt.type)&&(Fn=f0);switch(Fn&&(Fn=Fn(b,pt))?Rn(Wt,Fn,k,Ot):(cr&&cr(b,Bt,pt),"focusout"===b&&(cr=Bt._wrapperState)&&cr.controlled&&"number"===Bt.type&&Ck(Bt,"number",Bt.value)),cr=pt?Dm(pt):window,b){case"focusin":(Wk(cr)||"true"===cr.contentEditable)&&(Em=cr,Tm=pt,mS=null);break;case"focusout":mS=Tm=Em=null;break;case"mousedown":gS=!0;break;case"contextmenu":case"mouseup":case"dragend":gS=!1,Wd(Wt,k,Ot);break;case"selectionchange":if(xu)break;case"keydown":case"keyup":Wd(Wt,k,Ot)}var ur;if(Vk)e:{switch(b){case"compositionstart":var Ir="onCompositionStart";break e;case"compositionend":Ir="onCompositionEnd";break e;case"compositionupdate":Ir="onCompositionUpdate";break e}Ir=void 0}else d0?Gk(b,k)&&(Ir="onCompositionEnd"):"keydown"===b&&229===k.keyCode&&(Ir="onCompositionStart");Ir&&(uS&&"ko"!==k.locale&&(d0||"onCompositionStart"!==Ir?"onCompositionEnd"===Ir&&d0&&(ur=Ok()):(c0="value"in(l0=Ot)?l0.value:l0.textContent,d0=!0)),0<(cr=CS(pt,Ir)).length&&(Ir=new iE(Ir,b,null,k,Ot),Wt.push({event:Ir,listeners:cr}),(ur||null!==(ur=qk(k)))&&(Ir.data=ur))),(ur=Gv?function Sb(b,S){switch(b){case"compositionend":return qk(S);case"keypress":return 32!==S.which?null:(Hk=!0,qv);case"textInput":return(b=S.data)===qv&&Hk?null:b;default:return null}}(b,k):function bL(b,S){if(d0)return"compositionend"===b||!Vk&&Gk(b,S)?(b=Ok(),u0=c0=l0=null,d0=!1,b):null;switch(b){case"paste":default:return null;case"keypress":if(!(S.ctrlKey||S.altKey||S.metaKey)||S.ctrlKey&&S.altKey){if(S.char&&1<S.char.length)return S.char;if(S.which)return String.fromCharCode(S.which)}return null;case"compositionend":return uS&&"ko"!==S.locale?null:S.data}}(b,k))&&0<(pt=CS(pt,"onBeforeInput")).length&&(Ot=new iE("onBeforeInput","beforeinput",null,k,Ot),Wt.push({event:Ot,listeners:pt}),Ot.data=ur)}dd(Wt,S)})}function Ib(b,S,k){return{instance:b,listener:S,currentTarget:k}}function CS(b,S){for(var k=S+"Capture",U=[];null!==b;){var Y=b,J=Y.stateNode;5===Y.tag&&null!==J&&(Y=J,null!=(J=r0(b,k))&&U.unshift(Ib(b,J,Y)),null!=(J=r0(b,S))&&U.push(Ib(b,J,Y))),b=b.return}return U}function Eb(b){if(null===b)return null;do{b=b.return}while(b&&5!==b.tag);return b||null}function eM(b,S,k,U,Y){for(var J=S._reactName,ve=[];null!==k&&k!==U;){var De=k,He=De.alternate,pt=De.stateNode;if(null!==He&&He===U)break;5===De.tag&&null!==pt&&(De=pt,Y?null!=(He=r0(k,J))&&ve.unshift(Ib(k,He,De)):Y||null!=(He=r0(k,J))&&ve.push(Ib(k,He,De))),k=k.return}0!==ve.length&&b.push({event:S,listeners:ve})}var $d=/\r\n?/g,wL=/\u0000|\uFFFD/g;function tM(b){return("string"==typeof b?b:""+b).replace($d,"\n").replace(wL,"")}function g0(b,S,k){if(S=tM(S),tM(b)!==S&&k)throw Error(At(425))}function Qv(){}var Ja=null,Hl=null;function Yr(b,S){return"textarea"===b||"noscript"===b||"string"==typeof S.children||"number"==typeof S.children||"object"==typeof S.dangerouslySetInnerHTML&&null!==S.dangerouslySetInnerHTML&&null!=S.dangerouslySetInnerHTML.__html}var ra="function"==typeof setTimeout?setTimeout:void 0,Tl="function"==typeof clearTimeout?clearTimeout:void 0,fh="function"==typeof Promise?Promise:void 0,Gl="function"==typeof queueMicrotask?queueMicrotask:typeof fh<"u"?function(b){return fh.resolve(null).then(b).catch(nM)}:ra;function nM(b){setTimeout(function(){throw b})}function wS(b,S){var k=S,U=0;do{var Y=k.nextSibling;if(b.removeChild(k),Y&&8===Y.nodeType)if("/$"===(k=Y.data)){if(0===U)return b.removeChild(Y),void sS(S);U--}else"$"!==k&&"$?"!==k&&"$!"!==k||U++;k=Y}while(k);sS(S)}function Yd(b){for(;null!=b;b=b.nextSibling){var S=b.nodeType;if(1===S||3===S)break;if(8===S){if("$"===(S=b.data)||"$!"===S||"$?"===S)break;if("/$"===S)return null}}return b}function rM(b){b=b.previousSibling;for(var S=0;b;){if(8===b.nodeType){var k=b.data;if("$"===k||"$!"===k||"$?"===k){if(0===S)return b;S--}else"/$"===k&&S++}b=b.previousSibling}return null}var Tb=Math.random().toString(36).slice(2),Vc="__reactFiber$"+Tb,Jv="__reactProps$"+Tb,Xd="__reactContainer$"+Tb,AS="__reactEvents$"+Tb,IS="__reactListeners$"+Tb,$K="__reactHandles$"+Tb;function ph(b){var S=b[Vc];if(S)return S;for(var k=b.parentNode;k;){if(S=k[Xd]||k[Vc]){if(k=S.alternate,null!==S.child||null!==k&&null!==k.child)for(b=rM(b);null!==b;){if(k=b[Vc])return k;b=rM(b)}return S}k=(b=k).parentNode}return null}function ex(b){return!(b=b[Vc]||b[Xd])||5!==b.tag&&6!==b.tag&&13!==b.tag&&3!==b.tag?null:b}function Dm(b){if(5===b.tag||6===b.tag)return b.stateNode;throw Error(At(33))}function tx(b){return b[Jv]||null}var ES=[],fd=-1;function Pm(b){return{current:b}}function No(b){0>fd||(b.current=ES[fd],ES[fd]=null,fd--)}function ho(b,S){fd++,ES[fd]=b.current,b.current=S}var km={},el=Pm(km),Dl=Pm(!1),Na=km;function Kd(b,S){var k=b.type.contextTypes;if(!k)return km;var U=b.stateNode;if(U&&U.__reactInternalMemoizedUnmaskedChildContext===S)return U.__reactInternalMemoizedMaskedChildContext;var J,Y={};for(J in k)Y[J]=S[J];return U&&((b=b.stateNode).__reactInternalMemoizedUnmaskedChildContext=S,b.__reactInternalMemoizedMaskedChildContext=Y),Y}function ql(b){return null!=b.childContextTypes}function TS(){No(Dl),No(el)}function iM(b,S,k){if(el.current!==km)throw Error(At(168));ho(el,S),ho(Dl,k)}function dE(b,S,k){var U=b.stateNode;if(S=S.childContextTypes,"function"!=typeof U.getChildContext)return k;for(var Y in U=U.getChildContext())if(!(Y in S))throw Error(At(108,Ic(b)||"Unknown",Y));return zn({},k,U)}function hh(b){return b=(b=b.stateNode)&&b.__reactInternalMemoizedMergedChildContext||km,Na=el.current,ho(el,b),ho(Dl,Dl.current),!0}function oM(b,S,k){var U=b.stateNode;if(!U)throw Error(At(169));k?(b=dE(b,S,Na),U.__reactInternalMemoizedMergedChildContext=b,No(Dl),No(el),ho(el,b)):No(Dl),ho(Dl,k)}var mh=null,DS=!1,nx=!1;function Hf(b){null===mh?mh=[b]:mh.push(b)}function Zd(){if(!nx&&null!==mh){nx=!0;var b=0,S=Gn;try{var k=mh;for(Gn=1;b<k.length;b++){var U=k[b];do{U=U(!0)}while(null!==U)}mh=null,DS=!1}catch(Y){throw null!==mh&&(mh=mh.slice(b+1)),Ra(Z2,Zd),Y}finally{Gn=S,nx=!1}}return null}var Qd=[],Db=0,PS=null,Ns=0,_u=[],pd=0,Jd=null,gh=1,yh="";function y0(b,S){Qd[Db++]=Ns,Qd[Db++]=PS,PS=b,Ns=S}function aM(b,S,k){_u[pd++]=gh,_u[pd++]=yh,_u[pd++]=Jd,Jd=b;var U=gh;b=yh;var Y=32-ad(U)-1;U&=~(1<<Y),k+=1;var J=32-ad(S)+Y;if(30<J){var ve=Y-Y%5;J=(U&(1<<ve)-1).toString(32),U>>=ve,Y-=ve,gh=1<<32-ad(S)+Y|k<<Y|U,yh=J+b}else gh=1<<J|k<<Y|U,yh=b}function fE(b){null!==b.return&&(y0(b,1),aM(b,1,0))}function pE(b){for(;b===PS;)PS=Qd[--Db],Qd[Db]=null,Ns=Qd[--Db],Qd[Db]=null;for(;b===Jd;)Jd=_u[--pd],_u[pd]=null,yh=_u[--pd],_u[pd]=null,gh=_u[--pd],_u[pd]=null}var Ec=null,Wl=null,wr=!1,Ht=null;function Wn(b,S){var k=Ua(5,null,null,0);k.elementType="DELETED",k.stateNode=S,k.return=b,null===(S=b.deletions)?(b.deletions=[k],b.flags|=16):S.push(k)}function Fs(b,S){switch(b.tag){case 5:var k=b.type;return null!==(S=1!==S.nodeType||k.toLowerCase()!==S.nodeName.toLowerCase()?null:S)&&(b.stateNode=S,Ec=b,Wl=Yd(S.firstChild),!0);case 6:return null!==(S=""===b.pendingProps||3!==S.nodeType?null:S)&&(b.stateNode=S,Ec=b,Wl=null,!0);case 13:return null!==(S=8!==S.nodeType?null:S)&&(b.memoizedState={dehydrated:S,treeContext:k=null!==Jd?{id:gh,overflow:yh}:null,retryLane:1073741824},(k=Ua(18,null,null,0)).stateNode=S,k.return=b,b.child=k,Ec=b,Wl=null,!0);default:return!1}}function Su(b){return!(!(1&b.mode)||128&b.flags)}function tl(b){if(wr){var S=Wl;if(S){var k=S;if(!Fs(b,S)){if(Su(b))throw Error(At(418));S=Yd(k.nextSibling);var U=Ec;S&&Fs(b,S)?Wn(U,k):(b.flags=-4097&b.flags|2,wr=!1,Ec=b)}}else{if(Su(b))throw Error(At(418));b.flags=-4097&b.flags|2,wr=!1,Ec=b}}}function Hc(b){for(b=b.return;null!==b&&5!==b.tag&&3!==b.tag&&13!==b.tag;)b=b.return;Ec=b}function bh(b){if(b!==Ec)return!1;if(!wr)return Hc(b),wr=!0,!1;var S;if((S=3!==b.tag)&&!(S=5!==b.tag)&&(S="head"!==(S=b.type)&&"body"!==S&&!Yr(b.type,b.memoizedProps)),S&&(S=Wl)){if(Su(b))throw Fo(),Error(At(418));for(;S;)Wn(b,S),S=Yd(S.nextSibling)}if(Hc(b),13===b.tag){if(!(b=null!==(b=b.memoizedState)?b.dehydrated:null))throw Error(At(317));e:{for(b=b.nextSibling,S=0;b;){if(8===b.nodeType){var k=b.data;if("/$"===k){if(0===S){Wl=Yd(b.nextSibling);break e}S--}else"$"!==k&&"$!"!==k&&"$?"!==k||S++}b=b.nextSibling}Wl=null}}else Wl=Ec?Yd(b.stateNode.nextSibling):null;return!0}function Fo(){for(var b=Wl;b;)b=Yd(b.nextSibling)}function Os(){Wl=Ec=null,wr=!1}function Cu(b){null===Ht?Ht=[b]:Ht.push(b)}var _r=Ss.ReactCurrentBatchConfig;function Tc(b,S){if(b&&b.defaultProps){for(var k in S=zn({},S),b=b.defaultProps)void 0===S[k]&&(S[k]=b[k]);return S}return S}var rx=Pm(null),vh=null,Io=null,b0=null;function Mm(){b0=Io=vh=null}function ef(b){var S=rx.current;No(rx),b._currentValue=S}function v0(b,S,k){for(;null!==b;){var U=b.alternate;if((b.childLanes&S)!==S?(b.childLanes|=S,null!==U&&(U.childLanes|=S)):null!==U&&(U.childLanes&S)!==S&&(U.childLanes|=S),b===k)break;b=b.return}}function x0(b,S){vh=b,b0=Io=null,null!==(b=b.dependencies)&&null!==b.firstContext&&(b.lanes&S&&(Xl=!0),b.firstContext=null)}function Fa(b){var S=b._currentValue;if(b0!==b)if(b={context:b,memoizedValue:S,next:null},null===Io){if(null===vh)throw Error(At(308));Io=b,vh.dependencies={lanes:0,firstContext:b}}else Io=Io.next=b;return S}var Gf=null;function xh(b){null===Gf?Gf=[b]:Gf.push(b)}function Ar(b,S,k,U){var Y=S.interleaved;return null===Y?(k.next=k,xh(S)):(k.next=Y.next,Y.next=k),S.interleaved=k,tf(b,U)}function tf(b,S){b.lanes|=S;var k=b.alternate;for(null!==k&&(k.lanes|=S),k=b,b=b.return;null!==b;)b.childLanes|=S,null!==(k=b.alternate)&&(k.childLanes|=S),k=b,b=b.return;return 3===k.tag?k.stateNode:null}var hd=!1;function md(b){b.updateQueue={baseState:b.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ix(b,S){S.updateQueue===(b=b.updateQueue)&&(S.updateQueue={baseState:b.baseState,firstBaseUpdate:b.firstBaseUpdate,lastBaseUpdate:b.lastBaseUpdate,shared:b.shared,effects:b.effects})}function Gc(b,S){return{eventTime:b,lane:S,tag:0,payload:null,callback:null,next:null}}function Eo(b,S,k){var U=b.updateQueue;if(null===U)return null;if(U=U.shared,2&Oi){var Y=U.pending;return null===Y?S.next=S:(S.next=Y.next,Y.next=S),U.pending=S,tf(b,k)}return null===(Y=U.interleaved)?(S.next=S,xh(U)):(S.next=Y.next,Y.next=S),U.interleaved=S,tf(b,k)}function Pb(b,S,k){if(null!==(S=S.updateQueue)&&(S=S.shared,4194240&k)){var U=S.lanes;S.lanes=k|=U&=b.pendingLanes,Pk(b,k)}}function Pl(b,S){var k=b.updateQueue,U=b.alternate;if(null===U||k!==(U=U.updateQueue))null===(b=k.lastBaseUpdate)?k.firstBaseUpdate=S:b.next=S,k.lastBaseUpdate=S;else{var Y=null,J=null;if(null!==(k=k.firstBaseUpdate)){do{var ve={eventTime:k.eventTime,lane:k.lane,tag:k.tag,payload:k.payload,callback:k.callback,next:null};null===J?Y=J=ve:J=J.next=ve,k=k.next}while(null!==k);null===J?Y=J=S:J=J.next=S}else Y=J=S;b.updateQueue=k={baseState:U.baseState,firstBaseUpdate:Y,lastBaseUpdate:J,shared:U.shared,effects:U.effects}}}function Oa(b,S,k,U){var Y=b.updateQueue;hd=!1;var J=Y.firstBaseUpdate,ve=Y.lastBaseUpdate,De=Y.shared.pending;if(null!==De){Y.shared.pending=null;var He=De,pt=He.next;He.next=null,null===ve?J=pt:ve.next=pt,ve=He;var Ot=b.alternate;null!==Ot&&(De=(Ot=Ot.updateQueue).lastBaseUpdate)!==ve&&(null===De?Ot.firstBaseUpdate=pt:De.next=pt,Ot.lastBaseUpdate=He)}if(null!==J){var Wt=Y.baseState;for(ve=0,Ot=pt=He=null,De=J;;){var Bt=De.lane,yn=De.eventTime;if((U&Bt)===Bt){null!==Ot&&(Ot=Ot.next={eventTime:yn,lane:0,tag:De.tag,payload:De.payload,callback:De.callback,next:null});e:{var Tn=b,Nn=De;switch(Bt=S,yn=k,Nn.tag){case 1:if("function"==typeof(Tn=Nn.payload)){Wt=Tn.call(yn,Wt,Bt);break e}Wt=Tn;break e;case 3:Tn.flags=-65537&Tn.flags|128;case 0:if(null==(Bt="function"==typeof(Tn=Nn.payload)?Tn.call(yn,Wt,Bt):Tn))break e;Wt=zn({},Wt,Bt);break e;case 2:hd=!0}}null!==De.callback&&0!==De.lane&&(b.flags|=64,null===(Bt=Y.effects)?Y.effects=[De]:Bt.push(De))}else yn={eventTime:yn,lane:Bt,tag:De.tag,payload:De.payload,callback:De.callback,next:null},null===Ot?(pt=Ot=yn,He=Wt):Ot=Ot.next=yn,ve|=Bt;if(null===(De=De.next)){if(null===(De=Y.shared.pending))break;De=(Bt=De).next,Bt.next=null,Y.lastBaseUpdate=Bt,Y.shared.pending=null}}if(null===Ot&&(He=Wt),Y.baseState=He,Y.firstBaseUpdate=pt,Y.lastBaseUpdate=Ot,null!==(S=Y.shared.interleaved)){Y=S;do{ve|=Y.lane,Y=Y.next}while(Y!==S)}else null===J&&(Y.shared.lanes=0);jm|=ve,b.lanes=ve,b.memoizedState=Wt}}function kS(b,S,k){if(b=S.effects,S.effects=null,null!==b)for(S=0;S<b.length;S++){var U=b[S],Y=U.callback;if(null!==Y){if(U.callback=null,U=k,"function"!=typeof Y)throw Error(At(191,Y));Y.call(U)}}}var Rm=(new Ms.Component).refs;function kb(b,S,k,U){k=null==(k=k(U,S=b.memoizedState))?S:zn({},S,k),b.memoizedState=k,0===b.lanes&&(b.updateQueue.baseState=k)}var qc={isMounted:function(b){return!!(b=b._reactInternals)&&sh(b)===b},enqueueSetState:function(b,S,k){b=b._reactInternals;var U=kc(),Y=wh(b),J=Gc(U,Y);J.payload=S,null!=k&&(J.callback=k),null!==(S=Eo(b,J,Y))&&(Tu(S,b,Y,U),Pb(S,b,Y))},enqueueReplaceState:function(b,S,k){b=b._reactInternals;var U=kc(),Y=wh(b),J=Gc(U,Y);J.tag=1,J.payload=S,null!=k&&(J.callback=k),null!==(S=Eo(b,J,Y))&&(Tu(S,b,Y,U),Pb(S,b,Y))},enqueueForceUpdate:function(b,S){b=b._reactInternals;var k=kc(),U=wh(b),Y=Gc(k,U);Y.tag=2,null!=S&&(Y.callback=S),null!==(S=Eo(b,Y,U))&&(Tu(S,b,U,k),Pb(S,b,U))}};function MS(b,S,k,U,Y,J,ve){return"function"==typeof(b=b.stateNode).shouldComponentUpdate?b.shouldComponentUpdate(U,J,ve):!(S.prototype&&S.prototype.isPureReactComponent&&Ab(k,U)&&Ab(Y,J))}function lM(b,S,k){var U=!1,Y=km,J=S.contextType;return"object"==typeof J&&null!==J?J=Fa(J):(Y=ql(S)?Na:el.current,J=(U=null!=(U=S.contextTypes))?Kd(b,Y):km),S=new S(k,J),b.memoizedState=null!=S.state?S.state:null,S.updater=qc,b.stateNode=S,S._reactInternals=b,U&&((b=b.stateNode).__reactInternalMemoizedUnmaskedChildContext=Y,b.__reactInternalMemoizedMaskedChildContext=J),S}function cM(b,S,k,U){b=S.state,"function"==typeof S.componentWillReceiveProps&&S.componentWillReceiveProps(k,U),"function"==typeof S.UNSAFE_componentWillReceiveProps&&S.UNSAFE_componentWillReceiveProps(k,U),S.state!==b&&qc.enqueueReplaceState(S,S.state,null)}function ox(b,S,k,U){var Y=b.stateNode;Y.props=k,Y.state=b.memoizedState,Y.refs=Rm,md(b);var J=S.contextType;"object"==typeof J&&null!==J?Y.context=Fa(J):(J=ql(S)?Na:el.current,Y.context=Kd(b,J)),Y.state=b.memoizedState,"function"==typeof(J=S.getDerivedStateFromProps)&&(kb(b,S,J,k),Y.state=b.memoizedState),"function"==typeof S.getDerivedStateFromProps||"function"==typeof Y.getSnapshotBeforeUpdate||"function"!=typeof Y.UNSAFE_componentWillMount&&"function"!=typeof Y.componentWillMount||(S=Y.state,"function"==typeof Y.componentWillMount&&Y.componentWillMount(),"function"==typeof Y.UNSAFE_componentWillMount&&Y.UNSAFE_componentWillMount(),S!==Y.state&&qc.enqueueReplaceState(Y,Y.state,null),Oa(b,k,Y,U),Y.state=b.memoizedState),"function"==typeof Y.componentDidMount&&(b.flags|=4194308)}function Mb(b,S,k){if(null!==(b=k.ref)&&"function"!=typeof b&&"object"!=typeof b){if(k._owner){if(k=k._owner){if(1!==k.tag)throw Error(At(309));var U=k.stateNode}if(!U)throw Error(At(147,b));var Y=U,J=""+b;return null!==S&&null!==S.ref&&"function"==typeof S.ref&&S.ref._stringRef===J?S.ref:((S=function(ve){var De=Y.refs;De===Rm&&(De=Y.refs={}),null===ve?delete De[J]:De[J]=ve})._stringRef=J,S)}if("string"!=typeof b)throw Error(At(284));if(!k._owner)throw Error(At(290,b))}return b}function RS(b,S){throw b=Object.prototype.toString.call(S),Error(At(31,"[object Object]"===b?"object with keys {"+Object.keys(S).join(", ")+"}":b))}function NS(b){return(0,b._init)(b._payload)}function AL(b){function S(it,We){if(b){var lt=it.deletions;null===lt?(it.deletions=[We],it.flags|=16):lt.push(We)}}function k(it,We){if(!b)return null;for(;null!==We;)S(it,We),We=We.sibling;return null}function U(it,We){for(it=new Map;null!==We;)it.set(null!==We.key?We.key:We.index,We),We=We.sibling;return it}function Y(it,We){return(it=Zf(it,We)).index=0,it.sibling=null,it}function J(it,We,lt){return it.index=lt,b?null!==(lt=it.alternate)?(lt=lt.index)<We?(it.flags|=2,We):lt:(it.flags|=2,We):(it.flags|=1048576,We)}function ve(it){return b&&null===it.alternate&&(it.flags|=2),it}function De(it,We,lt,tn){return null===We||6!==We.tag?((We=P0(lt,it.mode,tn)).return=it,We):((We=Y(We,lt)).return=it,We)}function He(it,We,lt,tn){var Fn=lt.type;return Fn===Ac?Ot(it,We,lt.props.children,tn,lt.key):null!==We&&(We.elementType===Fn||"object"==typeof Fn&&null!==Fn&&Fn.$$typeof===er&&NS(Fn)===We.type)?((tn=Y(We,lt.props)).ref=Mb(it,We,lt),tn.return=it,tn):((tn=rl(lt.type,lt.key,lt.props,null,it.mode,tn)).ref=Mb(it,We,lt),tn.return=it,tn)}function pt(it,We,lt,tn){return null===We||4!==We.tag||We.stateNode.containerInfo!==lt.containerInfo||We.stateNode.implementation!==lt.implementation?((We=HE(lt,it.mode,tn)).return=it,We):((We=Y(We,lt.children||[])).return=it,We)}function Ot(it,We,lt,tn,Fn){return null===We||7!==We.tag?((We=D0(lt,it.mode,tn,Fn)).return=it,We):((We=Y(We,lt)).return=it,We)}function Wt(it,We,lt){if("string"==typeof We&&""!==We||"number"==typeof We)return(We=P0(""+We,it.mode,lt)).return=it,We;if("object"==typeof We&&null!==We){switch(We.$$typeof){case Cs:return(lt=rl(We.type,We.key,We.props,null,it.mode,lt)).ref=Mb(it,null,We),lt.return=it,lt;case Al:return(We=HE(We,it.mode,lt)).return=it,We;case er:return Wt(it,(0,We._init)(We._payload),lt)}if(hb(We)||Lt(We))return(We=D0(We,it.mode,lt,null)).return=it,We;RS(it,We)}return null}function Bt(it,We,lt,tn){var Fn=null!==We?We.key:null;if("string"==typeof lt&&""!==lt||"number"==typeof lt)return null!==Fn?null:De(it,We,""+lt,tn);if("object"==typeof lt&&null!==lt){switch(lt.$$typeof){case Cs:return lt.key===Fn?He(it,We,lt,tn):null;case Al:return lt.key===Fn?pt(it,We,lt,tn):null;case er:return Bt(it,We,(Fn=lt._init)(lt._payload),tn)}if(hb(lt)||Lt(lt))return null!==Fn?null:Ot(it,We,lt,tn,null);RS(it,lt)}return null}function yn(it,We,lt,tn,Fn){if("string"==typeof tn&&""!==tn||"number"==typeof tn)return De(We,it=it.get(lt)||null,""+tn,Fn);if("object"==typeof tn&&null!==tn){switch(tn.$$typeof){case Cs:return He(We,it=it.get(null===tn.key?lt:tn.key)||null,tn,Fn);case Al:return pt(We,it=it.get(null===tn.key?lt:tn.key)||null,tn,Fn);case er:return yn(it,We,lt,(0,tn._init)(tn._payload),Fn)}if(hb(tn)||Lt(tn))return Ot(We,it=it.get(lt)||null,tn,Fn,null);RS(We,tn)}return null}return function sa(it,We,lt,tn){if("object"==typeof lt&&null!==lt&&lt.type===Ac&&null===lt.key&&(lt=lt.props.children),"object"==typeof lt&&null!==lt){switch(lt.$$typeof){case Cs:e:{for(var Fn=lt.key,cr=We;null!==cr;){if(cr.key===Fn){if((Fn=lt.type)===Ac){if(7===cr.tag){k(it,cr.sibling),(We=Y(cr,lt.props.children)).return=it,it=We;break e}}else if(cr.elementType===Fn||"object"==typeof Fn&&null!==Fn&&Fn.$$typeof===er&&NS(Fn)===cr.type){k(it,cr.sibling),(We=Y(cr,lt.props)).ref=Mb(it,cr,lt),We.return=it,it=We;break e}k(it,cr);break}S(it,cr),cr=cr.sibling}lt.type===Ac?((We=D0(lt.props.children,it.mode,tn,lt.key)).return=it,it=We):((tn=rl(lt.type,lt.key,lt.props,null,it.mode,tn)).ref=Mb(it,We,lt),tn.return=it,it=tn)}return ve(it);case Al:e:{for(cr=lt.key;null!==We;){if(We.key===cr){if(4===We.tag&&We.stateNode.containerInfo===lt.containerInfo&&We.stateNode.implementation===lt.implementation){k(it,We.sibling),(We=Y(We,lt.children||[])).return=it,it=We;break e}k(it,We);break}S(it,We),We=We.sibling}(We=HE(lt,it.mode,tn)).return=it,it=We}return ve(it);case er:return sa(it,We,(cr=lt._init)(lt._payload),tn)}if(hb(lt))return function Tn(it,We,lt,tn){for(var Fn=null,cr=null,ur=We,Ir=We=0,il=null;null!==ur&&Ir<lt.length;Ir++){ur.index>Ir?(il=ur,ur=null):il=ur.sibling;var Bi=Bt(it,ur,lt[Ir],tn);if(null===Bi){null===ur&&(ur=il);break}b&&ur&&null===Bi.alternate&&S(it,ur),We=J(Bi,We,Ir),null===cr?Fn=Bi:cr.sibling=Bi,cr=Bi,ur=il}if(Ir===lt.length)return k(it,ur),wr&&y0(it,Ir),Fn;if(null===ur){for(;Ir<lt.length;Ir++)null!==(ur=Wt(it,lt[Ir],tn))&&(We=J(ur,We,Ir),null===cr?Fn=ur:cr.sibling=ur,cr=ur);return wr&&y0(it,Ir),Fn}for(ur=U(it,ur);Ir<lt.length;Ir++)null!==(il=yn(ur,it,Ir,lt[Ir],tn))&&(b&&null!==il.alternate&&ur.delete(null===il.key?Ir:il.key),We=J(il,We,Ir),null===cr?Fn=il:cr.sibling=il,cr=il);return b&&ur.forEach(function(Qf){return S(it,Qf)}),wr&&y0(it,Ir),Fn}(it,We,lt,tn);if(Lt(lt))return function Nn(it,We,lt,tn){var Fn=Lt(lt);if("function"!=typeof Fn)throw Error(At(150));if(null==(lt=Fn.call(lt)))throw Error(At(151));for(var cr=Fn=null,ur=We,Ir=We=0,il=null,Bi=lt.next();null!==ur&&!Bi.done;Ir++,Bi=lt.next()){ur.index>Ir?(il=ur,ur=null):il=ur.sibling;var Qf=Bt(it,ur,Bi.value,tn);if(null===Qf){null===ur&&(ur=il);break}b&&ur&&null===Qf.alternate&&S(it,ur),We=J(Qf,We,Ir),null===cr?Fn=Qf:cr.sibling=Qf,cr=Qf,ur=il}if(Bi.done)return k(it,ur),wr&&y0(it,Ir),Fn;if(null===ur){for(;!Bi.done;Ir++,Bi=lt.next())null!==(Bi=Wt(it,Bi.value,tn))&&(We=J(Bi,We,Ir),null===cr?Fn=Bi:cr.sibling=Bi,cr=Bi);return wr&&y0(it,Ir),Fn}for(ur=U(it,ur);!Bi.done;Ir++,Bi=lt.next())null!==(Bi=yn(ur,it,Ir,Bi.value,tn))&&(b&&null!==Bi.alternate&&ur.delete(null===Bi.key?Ir:Bi.key),We=J(Bi,We,Ir),null===cr?Fn=Bi:cr.sibling=Bi,cr=Bi);return b&&ur.forEach(function(WL){return S(it,WL)}),wr&&y0(it,Ir),Fn}(it,We,lt,tn);RS(it,lt)}return"string"==typeof lt&&""!==lt||"number"==typeof lt?(lt=""+lt,null!==We&&6===We.tag?(k(it,We.sibling),(We=Y(We,lt)).return=it,it=We):(k(it,We),(We=P0(lt,it.mode,tn)).return=it,it=We),ve(it)):k(it,We)}}var sx=AL(!0),IL=AL(!1),FS={},_h=Pm(FS),OS=Pm(FS),BS=Pm(FS);function Rb(b){if(b===FS)throw Error(At(174));return b}function uM(b,S){switch(ho(BS,S),ho(OS,b),ho(_h,FS),b=S.nodeType){case 9:case 11:S=(S=S.documentElement)?S.namespaceURI:HI(null,"");break;default:S=HI(S=(b=8===b?S.parentNode:S).namespaceURI||null,b=b.tagName)}No(_h),ho(_h,S)}function ax(){No(_h),No(OS),No(BS)}function EL(b){Rb(BS.current);var S=Rb(_h.current),k=HI(S,b.type);S!==k&&(ho(OS,b),ho(_h,k))}function dM(b){OS.current===b&&(No(_h),No(OS))}var os=Pm(0);function lx(b){for(var S=b;null!==S;){if(13===S.tag){var k=S.memoizedState;if(null!==k&&(null===(k=k.dehydrated)||"$?"===k.data||"$!"===k.data))return S}else if(19===S.tag&&void 0!==S.memoizedProps.revealOrder){if(128&S.flags)return S}else if(null!==S.child){S.child.return=S,S=S.child;continue}if(S===b)break;for(;null===S.sibling;){if(null===S.return||S.return===b)return null;S=S.return}S.sibling.return=S.return,S=S.sibling}return null}var fM=[];function pM(){for(var b=0;b<fM.length;b++)fM[b]._workInProgressVersionPrimary=null;fM.length=0}var hE=Ss.ReactCurrentDispatcher,hM=Ss.ReactCurrentBatchConfig,_0=0,ss=null,Oo=null,Ba=null,LS=!1,cx=!1,Nb=0,mM=0;function $l(){throw Error(At(321))}function ux(b,S){if(null===S)return!1;for(var k=0;k<S.length&&k<b.length;k++)if(!Vl(b[k],S[k]))return!1;return!0}function mE(b,S,k,U,Y,J){if(_0=J,ss=S,S.memoizedState=null,S.updateQueue=null,S.lanes=0,hE.current=null===b||null===b.memoizedState?kL:ML,b=k(U,Y),cx){J=0;do{if(cx=!1,Nb=0,25<=J)throw Error(At(301));J+=1,Ba=Oo=null,S.updateQueue=null,hE.current=RL,b=k(U,Y)}while(cx)}if(hE.current=qS,S=null!==Oo&&null!==Oo.next,_0=0,Ba=Oo=ss=null,LS=!1,S)throw Error(At(300));return b}function gd(){var b=0!==Nb;return Nb=0,b}function nf(){var b={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ba?ss.memoizedState=Ba=b:Ba=Ba.next=b,Ba}function wu(){if(null===Oo){var b=ss.alternate;b=null!==b?b.memoizedState:null}else b=Oo.next;var S=null===Ba?ss.memoizedState:Ba.next;if(null!==S)Ba=S,Oo=b;else{if(null===b)throw Error(At(310));b={memoizedState:(Oo=b).memoizedState,baseState:Oo.baseState,baseQueue:Oo.baseQueue,queue:Oo.queue,next:null},null===Ba?ss.memoizedState=Ba=b:Ba=Ba.next=b}return Ba}function Fb(b,S){return"function"==typeof S?S(b):S}function gE(b){var S=wu(),k=S.queue;if(null===k)throw Error(At(311));k.lastRenderedReducer=b;var U=Oo,Y=U.baseQueue,J=k.pending;if(null!==J){if(null!==Y){var ve=Y.next;Y.next=J.next,J.next=ve}U.baseQueue=Y=J,k.pending=null}if(null!==Y){U=U.baseState;var De=ve=null,He=null,pt=J=Y.next;do{var Ot=pt.lane;if((_0&Ot)===Ot)null!==He&&(He=He.next={lane:0,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null}),U=pt.hasEagerState?pt.eagerState:b(U,pt.action);else{var Wt={lane:Ot,action:pt.action,hasEagerState:pt.hasEagerState,eagerState:pt.eagerState,next:null};null===He?(De=He=Wt,ve=U):He=He.next=Wt,ss.lanes|=Ot,jm|=Ot}pt=pt.next}while(null!==pt&&pt!==J);null===He?ve=U:He.next=De,Vl(U,S.memoizedState)||(Xl=!0),S.memoizedState=U,S.baseState=ve,S.baseQueue=He,k.lastRenderedState=U}if(null!==(b=k.interleaved)){Y=b;do{ss.lanes|=J=Y.lane,jm|=J,Y=Y.next}while(Y!==b)}else null===Y&&(k.lanes=0);return[S.memoizedState,k.dispatch]}function gM(b){var S=wu(),k=S.queue;if(null===k)throw Error(At(311));k.lastRenderedReducer=b;var U=k.dispatch,Y=k.pending,J=S.memoizedState;if(null!==Y){k.pending=null;var ve=Y=Y.next;do{J=b(J,ve.action),ve=ve.next}while(ve!==Y);Vl(J,S.memoizedState)||(Xl=!0),S.memoizedState=J,null===S.baseQueue&&(S.baseState=J),k.lastRenderedState=J}return[J,U]}function mo(){}function jS(b,S){var k=ss,U=wu(),Y=S(),J=!Vl(U.memoizedState,Y);if(J&&(U.memoizedState=Y,Xl=!0),bE(yM.bind(null,k,U=U.queue,b),[b]),U.getSnapshot!==S||J||null!==Ba&&1&Ba.memoizedState.tag){if(k.flags|=2048,dx(9,Yl.bind(null,k,U,Y,S),void 0,null),null===oa)throw Error(At(349));30&_0||Ob(k,S,Y)}return Y}function Ob(b,S,k){b.flags|=16384,b={getSnapshot:S,value:k},null===(S=ss.updateQueue)?(ss.updateQueue=S={lastEffect:null,stores:null},S.stores=[b]):null===(k=S.stores)?S.stores=[b]:k.push(b)}function Yl(b,S,k,U){S.value=k,S.getSnapshot=U,Bb(S)&&S0(b)}function yM(b,S,k){return k(function(){Bb(S)&&S0(b)})}function Bb(b){var S=b.getSnapshot;b=b.value;try{var k=S();return!Vl(b,k)}catch{return!0}}function S0(b){var S=tf(b,1);null!==S&&Tu(S,b,1,-1)}function Wc(b){var S=nf();return"function"==typeof b&&(b=b()),S.memoizedState=S.baseState=b,S.queue=b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fb,lastRenderedState:b},b=b.dispatch=PL.bind(null,ss,b),[S.memoizedState,b]}function dx(b,S,k,U){return b={tag:b,create:S,destroy:k,deps:U,next:null},null===(S=ss.updateQueue)?(ss.updateQueue=S={lastEffect:null,stores:null},S.lastEffect=b.next=b):null===(k=S.lastEffect)?S.lastEffect=b.next=b:(U=k.next,k.next=b,b.next=U,S.lastEffect=b),b}function US(){return wu().memoizedState}function zS(b,S,k,U){var Y=nf();ss.flags|=b,Y.memoizedState=dx(1|S,k,void 0,void 0===U?null:U)}function Au(b,S,k,U){var Y=wu();U=void 0===U?null:U;var J=void 0;if(null!==Oo){var ve=Oo.memoizedState;if(J=ve.destroy,null!==U&&ux(U,ve.deps))return void(Y.memoizedState=dx(S,k,J,U))}ss.flags|=b,Y.memoizedState=dx(1|S,k,J,U)}function yE(b,S){return zS(8390656,8,b,S)}function bE(b,S){return Au(2048,8,b,S)}function vE(b,S){return Au(4,2,b,S)}function VS(b,S){return Au(4,4,b,S)}function HS(b,S){return"function"==typeof S?(b=b(),S(b),function(){S(null)}):null!=S?(b=b(),S.current=b,function(){S.current=null}):void 0}function Lb(b,S,k){return k=null!=k?k.concat([b]):null,Au(4,4,HS.bind(null,S,b),k)}function jb(){}function GS(b,S){var k=wu();S=void 0===S?null:S;var U=k.memoizedState;return null!==U&&null!==S&&ux(S,U[1])?U[0]:(k.memoizedState=[b,S],b)}function Nm(b,S){var k=wu();S=void 0===S?null:S;var U=k.memoizedState;return null!==U&&null!==S&&ux(S,U[1])?U[0]:(b=b(),k.memoizedState=[b,S],b)}function yr(b,S,k){return 21&_0?(Vl(k,S)||(k=s0(),ss.lanes|=k,jm|=k,b.baseState=!0),S):(b.baseState&&(b.baseState=!1,Xl=!0),b.memoizedState=k)}function bM(b,S){var k=Gn;Gn=0!==k&&4>k?k:4,b(!0);var U=hM.transition;hM.transition={};try{b(!1),S()}finally{Gn=k,hM.transition=U}}function TL(){return wu().memoizedState}function DL(b,S,k){var U=wh(b);k={lane:U,action:k,hasEagerState:!1,eagerState:null,next:null},vM(b)?xE(S,k):null!==(k=Ar(b,S,k,U))&&(Tu(k,b,U,kc()),C0(k,S,U))}function PL(b,S,k){var U=wh(b),Y={lane:U,action:k,hasEagerState:!1,eagerState:null,next:null};if(vM(b))xE(S,Y);else{var J=b.alternate;if(0===b.lanes&&(null===J||0===J.lanes)&&null!==(J=S.lastRenderedReducer))try{var ve=S.lastRenderedState,De=J(ve,k);if(Y.hasEagerState=!0,Y.eagerState=De,Vl(De,ve)){var He=S.interleaved;return null===He?(Y.next=Y,xh(S)):(Y.next=He.next,He.next=Y),void(S.interleaved=Y)}}catch{}null!==(k=Ar(b,S,Y,U))&&(Tu(k,b,U,Y=kc()),C0(k,S,U))}}function vM(b){var S=b.alternate;return b===ss||null!==S&&S===ss}function xE(b,S){cx=LS=!0;var k=b.pending;null===k?S.next=S:(S.next=k.next,k.next=S),b.pending=S}function C0(b,S,k){if(4194240&k){var U=S.lanes;S.lanes=k|=U&=b.pendingLanes,Pk(b,k)}}var qS={readContext:Fa,useCallback:$l,useContext:$l,useEffect:$l,useImperativeHandle:$l,useInsertionEffect:$l,useLayoutEffect:$l,useMemo:$l,useReducer:$l,useRef:$l,useState:$l,useDebugValue:$l,useDeferredValue:$l,useTransition:$l,useMutableSource:$l,useSyncExternalStore:$l,useId:$l,unstable_isNewReconciler:!1},kL={readContext:Fa,useCallback:function(b,S){return nf().memoizedState=[b,void 0===S?null:S],b},useContext:Fa,useEffect:yE,useImperativeHandle:function(b,S,k){return k=null!=k?k.concat([b]):null,zS(4194308,4,HS.bind(null,S,b),k)},useLayoutEffect:function(b,S){return zS(4194308,4,b,S)},useInsertionEffect:function(b,S){return zS(4,2,b,S)},useMemo:function(b,S){var k=nf();return S=void 0===S?null:S,b=b(),k.memoizedState=[b,S],b},useReducer:function(b,S,k){var U=nf();return S=void 0!==k?k(S):S,U.memoizedState=U.baseState=S,U.queue=b={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:b,lastRenderedState:S},b=b.dispatch=DL.bind(null,ss,b),[U.memoizedState,b]},useRef:function(b){return nf().memoizedState={current:b}},useState:Wc,useDebugValue:jb,useDeferredValue:function(b){return nf().memoizedState=b},useTransition:function(){var b=Wc(!1),S=b[0];return b=bM.bind(null,b[1]),nf().memoizedState=b,[S,b]},useMutableSource:function(){},useSyncExternalStore:function(b,S,k){var U=ss,Y=nf();if(wr){if(void 0===k)throw Error(At(407));k=k()}else{if(k=S(),null===oa)throw Error(At(349));30&_0||Ob(U,S,k)}Y.memoizedState=k;var J={value:k,getSnapshot:S};return Y.queue=J,yE(yM.bind(null,U,J,b),[b]),U.flags|=2048,dx(9,Yl.bind(null,U,J,k,S),void 0,null),k},useId:function(){var b=nf(),S=oa.identifierPrefix;if(wr){var k=yh;S=":"+S+"R"+(k=(gh&~(1<<32-ad(gh)-1)).toString(32)+k),0<(k=Nb++)&&(S+="H"+k.toString(32)),S+=":"}else S=":"+S+"r"+(k=mM++).toString(32)+":";return b.memoizedState=S},unstable_isNewReconciler:!1},ML={readContext:Fa,useCallback:GS,useContext:Fa,useEffect:bE,useImperativeHandle:Lb,useInsertionEffect:vE,useLayoutEffect:VS,useMemo:Nm,useReducer:gE,useRef:US,useState:function(){return gE(Fb)},useDebugValue:jb,useDeferredValue:function(b){return yr(wu(),Oo.memoizedState,b)},useTransition:function(){return[gE(Fb)[0],wu().memoizedState]},useMutableSource:mo,useSyncExternalStore:jS,useId:TL,unstable_isNewReconciler:!1},RL={readContext:Fa,useCallback:GS,useContext:Fa,useEffect:bE,useImperativeHandle:Lb,useInsertionEffect:vE,useLayoutEffect:VS,useMemo:Nm,useReducer:gM,useRef:US,useState:function(){return gM(Fb)},useDebugValue:jb,useDeferredValue:function(b){var S=wu();return null===Oo?S.memoizedState=b:yr(S,Oo.memoizedState,b)},useTransition:function(){return[gM(Fb)[0],wu().memoizedState]},useMutableSource:mo,useSyncExternalStore:jS,useId:TL,unstable_isNewReconciler:!1};function Ub(b,S){try{var k="",U=S;do{k+=ws(U),U=U.return}while(U);var Y=k}catch(J){Y="\nError generating stack: "+J.message+"\n"+J.stack}return{value:b,source:S,stack:Y,digest:null}}function _t(b,S,k){return{value:b,source:null,stack:k??null,digest:S??null}}function ai(b,S){try{console.error(S.value)}catch(k){setTimeout(function(){throw k})}}var Sh="function"==typeof WeakMap?WeakMap:Map;function qf(b,S,k){(k=Gc(-1,k)).tag=3,k.payload={element:null};var U=S.value;return k.callback=function(){_x||(_x=!0,Um=U),ai(0,S)},k}function ro(b,S,k){(k=Gc(-1,k)).tag=3;var U=b.type.getDerivedStateFromError;if("function"==typeof U){var Y=S.value;k.payload=function(){return U(Y)},k.callback=function(){ai(0,S)}}var J=b.stateNode;return null!==J&&"function"==typeof J.componentDidCatch&&(k.callback=function(){ai(0,S),"function"!=typeof U&&(null===Eu?Eu=new Set([this]):Eu.add(this));var ve=S.stack;this.componentDidCatch(S.value,{componentStack:null!==ve?ve:""})}),k}function _E(b,S,k){var U=b.pingCache;if(null===U){U=b.pingCache=new Sh;var Y=new Set;U.set(S,Y)}else void 0===(Y=U.get(S))&&U.set(S,Y=new Set);Y.has(k)||(Y.add(k),b=XK.bind(null,b,S,k),S.then(b,b))}function zb(b){do{var S;if((S=13===b.tag)&&(S=null===(S=b.memoizedState)||null!==S.dehydrated),S)return b;b=b.return}while(null!==b);return null}function rf(b,S,k,U,Y){return 1&b.mode?(b.flags|=65536,b.lanes=Y,b):(b===S?b.flags|=65536:(b.flags|=128,k.flags|=131072,k.flags&=-52805,1===k.tag&&(null===k.alternate?k.tag=17:((S=Gc(-1,1)).tag=2,Eo(k,S,1))),k.lanes|=1),b)}var SE=Ss.ReactCurrentOwner,Xl=!1;function Dc(b,S,k,U){S.child=null===b?IL(S,null,k,U):sx(S,b.child,k,U)}function NL(b,S,k,U,Y){k=k.render;var J=S.ref;return x0(S,Y),U=mE(b,S,k,U,J,Y),k=gd(),null===b||Xl?(wr&&k&&fE(S),S.flags|=1,Dc(b,S,U,Y),S.child):(S.updateQueue=b.updateQueue,S.flags&=-2053,b.lanes&=~Y,Yf(b,S,Y))}function CE(b,S,k,U,Y){if(null===b){var J=k.type;return"function"!=typeof J||nC(J)||void 0!==J.defaultProps||null!==k.compare||void 0!==k.defaultProps?((b=rl(k.type,null,U,S,S.mode,Y)).ref=S.ref,b.return=S,S.child=b):(S.tag=15,S.type=J,Kl(b,S,J,U,Y))}return J=b.child,b.lanes&Y||!(k=null!==(k=k.compare)?k:Ab)(J.memoizedProps,U)||b.ref!==S.ref?(S.flags|=1,(b=Zf(J,U)).ref=S.ref,b.return=S,S.child=b):Yf(b,S,Y)}function Kl(b,S,k,U,Y){if(null!==b){var J=b.memoizedProps;if(Ab(J,U)&&b.ref===S.ref){if(Xl=!1,S.pendingProps=U=J,!(b.lanes&Y))return S.lanes=b.lanes,Yf(b,S,Y);131072&b.flags&&(Xl=!0)}}return Iu(b,S,k,U,Y)}function Wf(b,S,k){var U=S.pendingProps,Y=U.children,J=null!==b?b.memoizedState:null;if("hidden"===U.mode)if(1&S.mode){if(!(1073741824&k))return b=null!==J?J.baseLanes|k:k,S.lanes=S.childLanes=1073741824,S.memoizedState={baseLanes:b,cachePool:null,transitions:null},S.updateQueue=null,ho(Lm,Ql),Ql|=b,null;S.memoizedState={baseLanes:0,cachePool:null,transitions:null},U=null!==J?J.baseLanes:k,ho(Lm,Ql),Ql|=U}else S.memoizedState={baseLanes:0,cachePool:null,transitions:null},ho(Lm,Ql),Ql|=k;else null!==J?(U=J.baseLanes|k,S.memoizedState=null):U=k,ho(Lm,Ql),Ql|=U;return Dc(b,S,Y,k),S.child}function wE(b,S){var k=S.ref;(null===b&&null!==k||null!==b&&b.ref!==k)&&(S.flags|=512,S.flags|=2097152)}function Iu(b,S,k,U,Y){var J=ql(k)?Na:el.current;return J=Kd(S,J),x0(S,Y),k=mE(b,S,k,U,J,Y),U=gd(),null===b||Xl?(wr&&U&&fE(S),S.flags|=1,Dc(b,S,k,Y),S.child):(S.updateQueue=b.updateQueue,S.flags&=-2053,b.lanes&=~Y,Yf(b,S,Y))}function $f(b,S,k,U,Y){if(ql(k)){var J=!0;hh(S)}else J=!1;if(x0(S,Y),null===S.stateNode)mx(b,S),lM(S,k,U),ox(S,k,U,Y),U=!0;else if(null===b){var ve=S.stateNode,De=S.memoizedProps;ve.props=De;var He=ve.context,pt=k.contextType;pt="object"==typeof pt&&null!==pt?Fa(pt):Kd(S,pt=ql(k)?Na:el.current);var Ot=k.getDerivedStateFromProps,Wt="function"==typeof Ot||"function"==typeof ve.getSnapshotBeforeUpdate;Wt||"function"!=typeof ve.UNSAFE_componentWillReceiveProps&&"function"!=typeof ve.componentWillReceiveProps||(De!==U||He!==pt)&&cM(S,ve,U,pt),hd=!1;var Bt=S.memoizedState;ve.state=Bt,Oa(S,U,ve,Y),He=S.memoizedState,De!==U||Bt!==He||Dl.current||hd?("function"==typeof Ot&&(kb(S,k,Ot,U),He=S.memoizedState),(De=hd||MS(S,k,De,U,Bt,He,pt))?(Wt||"function"!=typeof ve.UNSAFE_componentWillMount&&"function"!=typeof ve.componentWillMount||("function"==typeof ve.componentWillMount&&ve.componentWillMount(),"function"==typeof ve.UNSAFE_componentWillMount&&ve.UNSAFE_componentWillMount()),"function"==typeof ve.componentDidMount&&(S.flags|=4194308)):("function"==typeof ve.componentDidMount&&(S.flags|=4194308),S.memoizedProps=U,S.memoizedState=He),ve.props=U,ve.state=He,ve.context=pt,U=De):("function"==typeof ve.componentDidMount&&(S.flags|=4194308),U=!1)}else{ve=S.stateNode,ix(b,S),De=S.memoizedProps,pt=S.type===S.elementType?De:Tc(S.type,De),ve.props=pt,Wt=S.pendingProps,Bt=ve.context,He="object"==typeof(He=k.contextType)&&null!==He?Fa(He):Kd(S,He=ql(k)?Na:el.current);var yn=k.getDerivedStateFromProps;(Ot="function"==typeof yn||"function"==typeof ve.getSnapshotBeforeUpdate)||"function"!=typeof ve.UNSAFE_componentWillReceiveProps&&"function"!=typeof ve.componentWillReceiveProps||(De!==Wt||Bt!==He)&&cM(S,ve,U,He),hd=!1,ve.state=Bt=S.memoizedState,Oa(S,U,ve,Y);var Tn=S.memoizedState;De!==Wt||Bt!==Tn||Dl.current||hd?("function"==typeof yn&&(kb(S,k,yn,U),Tn=S.memoizedState),(pt=hd||MS(S,k,pt,U,Bt,Tn,He)||!1)?(Ot||"function"!=typeof ve.UNSAFE_componentWillUpdate&&"function"!=typeof ve.componentWillUpdate||("function"==typeof ve.componentWillUpdate&&ve.componentWillUpdate(U,Tn,He),"function"==typeof ve.UNSAFE_componentWillUpdate&&ve.UNSAFE_componentWillUpdate(U,Tn,He)),"function"==typeof ve.componentDidUpdate&&(S.flags|=4),"function"==typeof ve.getSnapshotBeforeUpdate&&(S.flags|=1024)):("function"!=typeof ve.componentDidUpdate||De===b.memoizedProps&&Bt===b.memoizedState||(S.flags|=4),"function"!=typeof ve.getSnapshotBeforeUpdate||De===b.memoizedProps&&Bt===b.memoizedState||(S.flags|=1024),S.memoizedProps=U,S.memoizedState=Tn),ve.props=U,ve.state=Tn,ve.context=He,U=pt):("function"!=typeof ve.componentDidUpdate||De===b.memoizedProps&&Bt===b.memoizedState||(S.flags|=4),"function"!=typeof ve.getSnapshotBeforeUpdate||De===b.memoizedProps&&Bt===b.memoizedState||(S.flags|=1024),U=!1)}return AE(b,S,k,U,J,Y)}function AE(b,S,k,U,Y,J){wE(b,S);var ve=!!(128&S.flags);if(!U&&!ve)return Y&&oM(S,k,!1),Yf(b,S,J);U=S.stateNode,SE.current=S;var De=ve&&"function"!=typeof k.getDerivedStateFromError?null:U.render();return S.flags|=1,null!==b&&ve?(S.child=sx(S,b.child,null,J),S.child=sx(S,null,De,J)):Dc(b,S,De,J),S.memoizedState=U.state,Y&&oM(S,k,!0),S.child}function IE(b){var S=b.stateNode;S.pendingContext?iM(0,S.pendingContext,S.pendingContext!==S.context):S.context&&iM(0,S.context,!1),uM(b,S.containerInfo)}function xM(b,S,k,U,Y){return Os(),Cu(Y),S.flags|=256,Dc(b,S,k,U),S.child}var $S,PE,kl,Fm,EE={dehydrated:null,treeContext:null,retryLane:0};function fx(b){return{baseLanes:b,cachePool:null,transitions:null}}function WS(b,S,k){var De,U=S.pendingProps,Y=os.current,J=!1,ve=!!(128&S.flags);if((De=ve)||(De=(null===b||null!==b.memoizedState)&&!!(2&Y)),De?(J=!0,S.flags&=-129):(null===b||null!==b.memoizedState)&&(Y|=1),ho(os,1&Y),null===b)return tl(S),null!==(b=S.memoizedState)&&null!==(b=b.dehydrated)?(S.lanes=1&S.mode?"$!"===b.data?8:1073741824:1,null):(ve=U.children,b=U.fallback,J?(J=S.child,ve={mode:"hidden",children:ve},1&(U=S.mode)||null===J?J=Zb(ve,U,0,null):(J.childLanes=0,J.pendingProps=ve),b=D0(b,U,k,null),J.return=S,b.return=S,J.sibling=b,S.child=J,S.child.memoizedState=fx(k),S.memoizedState=EE,b):px(S,ve));if(null!==(Y=b.memoizedState)&&null!==(De=Y.dehydrated))return function FL(b,S,k,U,Y,J,ve){if(k)return 256&S.flags?(S.flags&=-257,w0(b,S,ve,U=_t(Error(At(422))))):null!==S.memoizedState?(S.child=b.child,S.flags|=128,null):(J=U.fallback,U=Zb({mode:"visible",children:U.children},Y=S.mode,0,null),(J=D0(J,Y,ve,null)).flags|=2,U.return=S,J.return=S,U.sibling=J,S.child=U,1&S.mode&&sx(S,b.child,null,ve),S.child.memoizedState=fx(ve),S.memoizedState=EE,J);if(!(1&S.mode))return w0(b,S,ve,null);if("$!"===Y.data){if(U=Y.nextSibling&&Y.nextSibling.dataset)var De=U.dgst;return U=De,w0(b,S,ve,U=_t(J=Error(At(419)),U,void 0))}if(De=!!(ve&b.childLanes),Xl||De){if(null!==(U=oa)){switch(ve&-ve){case 4:Y=2;break;case 16:Y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:Y=32;break;case 536870912:Y=268435456;break;default:Y=0}0!==(Y=Y&(U.suspendedLanes|ve)?0:Y)&&Y!==J.retryLane&&(J.retryLane=Y,tf(b,Y),Tu(U,b,Y,-1))}return Jl(),w0(b,S,ve,U=_t(Error(At(421))))}return"$?"===Y.data?(S.flags|=128,S.child=b.child,S=KK.bind(null,b),Y._reactRetry=S,null):(b=J.treeContext,Wl=Yd(Y.nextSibling),Ec=S,wr=!0,Ht=null,null!==b&&(_u[pd++]=gh,_u[pd++]=yh,_u[pd++]=Jd,gh=b.id,yh=b.overflow,Jd=S),(S=px(S,U.children)).flags|=4096,S)}(b,S,ve,U,De,Y,k);if(J){J=U.fallback,De=(Y=b.child).sibling;var He={mode:"hidden",children:U.children};return 1&(ve=S.mode)||S.child===Y?(U=Zf(Y,He)).subtreeFlags=14680064&Y.subtreeFlags:((U=S.child).childLanes=0,U.pendingProps=He,S.deletions=null),null!==De?J=Zf(De,J):(J=D0(J,ve,k,null)).flags|=2,J.return=S,U.return=S,U.sibling=J,S.child=U,U=J,J=S.child,ve=null===(ve=b.child.memoizedState)?fx(k):{baseLanes:ve.baseLanes|k,cachePool:null,transitions:ve.transitions},J.memoizedState=ve,J.childLanes=b.childLanes&~k,S.memoizedState=EE,U}return b=(J=b.child).sibling,U=Zf(J,{mode:"visible",children:U.children}),!(1&S.mode)&&(U.lanes=k),U.return=S,U.sibling=null,null!==b&&(null===(k=S.deletions)?(S.deletions=[b],S.flags|=16):k.push(b)),S.child=U,S.memoizedState=null,U}function px(b,S){return(S=Zb({mode:"visible",children:S},b.mode,0,null)).return=b,b.child=S}function w0(b,S,k,U){return null!==U&&Cu(U),sx(S,b.child,null,k),(b=px(S,S.pendingProps.children)).flags|=2,S.memoizedState=null,b}function TE(b,S,k){b.lanes|=S;var U=b.alternate;null!==U&&(U.lanes|=S),v0(b.return,S,k)}function hx(b,S,k,U,Y){var J=b.memoizedState;null===J?b.memoizedState={isBackwards:S,rendering:null,renderingStartTime:0,last:U,tail:k,tailMode:Y}:(J.isBackwards=S,J.rendering=null,J.renderingStartTime=0,J.last=U,J.tail=k,J.tailMode=Y)}function DE(b,S,k){var U=S.pendingProps,Y=U.revealOrder,J=U.tail;if(Dc(b,S,U.children,k),2&(U=os.current))U=1&U|2,S.flags|=128;else{if(null!==b&&128&b.flags)e:for(b=S.child;null!==b;){if(13===b.tag)null!==b.memoizedState&&TE(b,k,S);else if(19===b.tag)TE(b,k,S);else if(null!==b.child){b.child.return=b,b=b.child;continue}if(b===S)break e;for(;null===b.sibling;){if(null===b.return||b.return===S)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}U&=1}if(ho(os,U),1&S.mode)switch(Y){case"forwards":for(k=S.child,Y=null;null!==k;)null!==(b=k.alternate)&&null===lx(b)&&(Y=k),k=k.sibling;null===(k=Y)?(Y=S.child,S.child=null):(Y=k.sibling,k.sibling=null),hx(S,!1,Y,k,J);break;case"backwards":for(k=null,Y=S.child,S.child=null;null!==Y;){if(null!==(b=Y.alternate)&&null===lx(b)){S.child=Y;break}b=Y.sibling,Y.sibling=k,k=Y,Y=b}hx(S,!0,k,null,J);break;case"together":hx(S,!1,null,null,void 0);break;default:S.memoizedState=null}else S.memoizedState=null;return S.child}function mx(b,S){!(1&S.mode)&&null!==b&&(b.alternate=null,S.alternate=null,S.flags|=2)}function Yf(b,S,k){if(null!==b&&(S.dependencies=b.dependencies),jm|=S.lanes,!(k&S.childLanes))return null;if(null!==b&&S.child!==b.child)throw Error(At(153));if(null!==S.child){for(k=Zf(b=S.child,b.pendingProps),S.child=k,k.return=S;null!==b.sibling;)(k=k.sibling=Zf(b=b.sibling,b.pendingProps)).return=S;k.sibling=null}return S.child}function io(b,S){if(!wr)switch(b.tailMode){case"hidden":S=b.tail;for(var k=null;null!==S;)null!==S.alternate&&(k=S),S=S.sibling;null===k?b.tail=null:k.sibling=null;break;case"collapsed":k=b.tail;for(var U=null;null!==k;)null!==k.alternate&&(U=k),k=k.sibling;null===U?S||null===b.tail?b.tail=null:b.tail.sibling=null:U.sibling=null}}function Zl(b){var S=null!==b.alternate&&b.alternate.child===b.child,k=0,U=0;if(S)for(var Y=b.child;null!==Y;)k|=Y.lanes|Y.childLanes,U|=14680064&Y.subtreeFlags,U|=14680064&Y.flags,Y.return=b,Y=Y.sibling;else for(Y=b.child;null!==Y;)k|=Y.lanes|Y.childLanes,U|=Y.subtreeFlags,U|=Y.flags,Y.return=b,Y=Y.sibling;return b.subtreeFlags|=U,b.childLanes=k,S}function OL(b,S,k){var U=S.pendingProps;switch(pE(S),S.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zl(S),null;case 1:case 17:return ql(S.type)&&TS(),Zl(S),null;case 3:return U=S.stateNode,ax(),No(Dl),No(el),pM(),U.pendingContext&&(U.context=U.pendingContext,U.pendingContext=null),(null===b||null===b.child)&&(bh(S)?S.flags|=4:null===b||b.memoizedState.isDehydrated&&!(256&S.flags)||(S.flags|=1024,null!==Ht&&(LE(Ht),Ht=null))),PE(b,S),Zl(S),null;case 5:dM(S);var Y=Rb(BS.current);if(k=S.type,null!==b&&null!=S.stateNode)kl(b,S,k,U,Y),b.ref!==S.ref&&(S.flags|=512,S.flags|=2097152);else{if(!U){if(null===S.stateNode)throw Error(At(166));return Zl(S),null}if(b=Rb(_h.current),bh(S)){k=S.type;var J=S.memoizedProps;switch((U=S.stateNode)[Vc]=S,U[Jv]=J,b=!!(1&S.mode),k){case"dialog":Ko("cancel",U),Ko("close",U);break;case"iframe":case"object":case"embed":Ko("load",U);break;case"video":case"audio":for(Y=0;Y<m0.length;Y++)Ko(m0[Y],U);break;case"source":Ko("error",U);break;case"img":case"image":case"link":Ko("error",U),Ko("load",U);break;case"details":Ko("toggle",U);break;case"input":tL(U,J),Ko("invalid",U);break;case"select":U._wrapperState={wasMultiple:!!J.multiple},Ko("invalid",U);break;case"textarea":q2(U,J),Ko("invalid",U)}for(var ve in Tv(k,J),Y=null,J)if(J.hasOwnProperty(ve)){var De=J[ve];"children"===ve?"string"==typeof De?U.textContent!==De&&(!0!==J.suppressHydrationWarning&&g0(U.textContent,De,b),Y=["children",De]):"number"==typeof De&&U.textContent!==""+De&&(!0!==J.suppressHydrationWarning&&g0(U.textContent,De,b),Y=["children",""+De]):rs.hasOwnProperty(ve)&&null!=De&&"onScroll"===ve&&Ko("scroll",U)}switch(k){case"input":xm(U),Sk(U,J,!0);break;case"textarea":xm(U),iL(U);break;case"select":case"option":break;default:"function"==typeof J.onClick&&(U.onclick=Qv)}S.updateQueue=U=Y,null!==U&&(S.flags|=4)}else{ve=9===Y.nodeType?Y:Y.ownerDocument,"http://www.w3.org/1999/xhtml"===b&&(b=oL(k)),"http://www.w3.org/1999/xhtml"===b?"script"===k?((b=ve.createElement("div")).innerHTML="<script><\/script>",b=b.removeChild(b.firstChild)):"string"==typeof U.is?b=ve.createElement(k,{is:U.is}):(b=ve.createElement(k),"select"===k&&(ve=b,U.multiple?ve.multiple=!0:U.size&&(ve.size=U.size))):b=ve.createElementNS(b,k),b[Vc]=S,b[Jv]=U,$S(b,S,!1,!1),S.stateNode=b;e:{switch(ve=Dv(k,U),k){case"dialog":Ko("cancel",b),Ko("close",b),Y=U;break;case"iframe":case"object":case"embed":Ko("load",b),Y=U;break;case"video":case"audio":for(Y=0;Y<m0.length;Y++)Ko(m0[Y],b);Y=U;break;case"source":Ko("error",b),Y=U;break;case"img":case"image":case"link":Ko("error",b),Ko("load",b),Y=U;break;case"details":Ko("toggle",b),Y=U;break;case"input":tL(b,U),Y=_k(b,U),Ko("invalid",b);break;case"option":default:Y=U;break;case"select":b._wrapperState={wasMultiple:!!U.multiple},Y=zn({},U,{value:void 0}),Ko("invalid",b);break;case"textarea":q2(b,U),Y=VI(b,U),Ko("invalid",b)}for(J in Tv(k,Y),De=Y)if(De.hasOwnProperty(J)){var He=De[J];"style"===J?sL(b,He):"dangerouslySetInnerHTML"===J?null!=(He=He?He.__html:void 0)&&wk(b,He):"children"===J?"string"==typeof He?("textarea"!==k||""!==He)&&Ev(b,He):"number"==typeof He&&Ev(b,""+He):"suppressContentEditableWarning"!==J&&"suppressHydrationWarning"!==J&&"autoFocus"!==J&&(rs.hasOwnProperty(J)?null!=He&&"onScroll"===J&&Ko("scroll",b):null!=He&&wc(b,J,He,ve))}switch(k){case"input":xm(b),Sk(b,U,!1);break;case"textarea":xm(b),iL(b);break;case"option":null!=U.value&&b.setAttribute("value",""+ih(U.value));break;case"select":b.multiple=!!U.multiple,null!=(J=U.value)?e0(b,!!U.multiple,J,!1):null!=U.defaultValue&&e0(b,!!U.multiple,U.defaultValue,!0);break;default:"function"==typeof Y.onClick&&(b.onclick=Qv)}switch(k){case"button":case"input":case"select":case"textarea":U=!!U.autoFocus;break e;case"img":U=!0;break e;default:U=!1}}U&&(S.flags|=4)}null!==S.ref&&(S.flags|=512,S.flags|=2097152)}return Zl(S),null;case 6:if(b&&null!=S.stateNode)Fm(b,S,b.memoizedProps,U);else{if("string"!=typeof U&&null===S.stateNode)throw Error(At(166));if(k=Rb(BS.current),Rb(_h.current),bh(S)){if(k=S.memoizedProps,(U=S.stateNode)[Vc]=S,(J=U.nodeValue!==k)&&null!==(b=Ec))switch(b.tag){case 3:g0(U.nodeValue,k,!!(1&b.mode));break;case 5:!0!==b.memoizedProps.suppressHydrationWarning&&g0(U.nodeValue,k,!!(1&b.mode))}J&&(S.flags|=4)}else(U=(9===k.nodeType?k:k.ownerDocument).createTextNode(U))[Vc]=S,S.stateNode=U}return Zl(S),null;case 13:if(No(os),U=S.memoizedState,null===b||null!==b.memoizedState&&null!==b.memoizedState.dehydrated){if(wr&&null!==Wl&&1&S.mode&&!(128&S.flags))Fo(),Os(),S.flags|=98560,J=!1;else if(J=bh(S),null!==U&&null!==U.dehydrated){if(null===b){if(!J)throw Error(At(318));if(!(J=null!==(J=S.memoizedState)?J.dehydrated:null))throw Error(At(317));J[Vc]=S}else Os(),!(128&S.flags)&&(S.memoizedState=null),S.flags|=4;Zl(S),J=!1}else null!==Ht&&(LE(Ht),Ht=null),J=!0;if(!J)return 65536&S.flags?S:null}return 128&S.flags?(S.lanes=k,S):((U=null!==U)!=(null!==b&&null!==b.memoizedState)&&U&&(S.child.flags|=8192,1&S.mode&&(null===b||1&os.current?0===ja&&(ja=3):Jl())),null!==S.updateQueue&&(S.flags|=4),Zl(S),null);case 4:return ax(),PE(b,S),null===b&&Zv(S.stateNode.containerInfo),Zl(S),null;case 10:return ef(S.type._context),Zl(S),null;case 19:if(No(os),null===(J=S.memoizedState))return Zl(S),null;if(U=!!(128&S.flags),null===(ve=J.rendering))if(U)io(J,!1);else{if(0!==ja||null!==b&&128&b.flags)for(b=S.child;null!==b;){if(null!==(ve=lx(b))){for(S.flags|=128,io(J,!1),null!==(U=ve.updateQueue)&&(S.updateQueue=U,S.flags|=4),S.subtreeFlags=0,U=k,k=S.child;null!==k;)b=U,(J=k).flags&=14680066,null===(ve=J.alternate)?(J.childLanes=0,J.lanes=b,J.child=null,J.subtreeFlags=0,J.memoizedProps=null,J.memoizedState=null,J.updateQueue=null,J.dependencies=null,J.stateNode=null):(J.childLanes=ve.childLanes,J.lanes=ve.lanes,J.child=ve.child,J.subtreeFlags=0,J.deletions=null,J.memoizedProps=ve.memoizedProps,J.memoizedState=ve.memoizedState,J.updateQueue=ve.updateQueue,J.type=ve.type,J.dependencies=null===(b=ve.dependencies)?null:{lanes:b.lanes,firstContext:b.firstContext}),k=k.sibling;return ho(os,1&os.current|2),S.child}b=b.sibling}null!==J.tail&&na()>qb&&(S.flags|=128,U=!0,io(J,!1),S.lanes=4194304)}else{if(!U)if(null!==(b=lx(ve))){if(S.flags|=128,U=!0,null!==(k=b.updateQueue)&&(S.updateQueue=k,S.flags|=4),io(J,!0),null===J.tail&&"hidden"===J.tailMode&&!ve.alternate&&!wr)return Zl(S),null}else 2*na()-J.renderingStartTime>qb&&1073741824!==k&&(S.flags|=128,U=!0,io(J,!1),S.lanes=4194304);J.isBackwards?(ve.sibling=S.child,S.child=ve):(null!==(k=J.last)?k.sibling=ve:S.child=ve,J.last=ve)}return null!==J.tail?(J.rendering=S=J.tail,J.tail=S.sibling,J.renderingStartTime=na(),S.sibling=null,k=os.current,ho(os,U?1&k|2:1&k),S):(Zl(S),null);case 22:case 23:return jE(),U=null!==S.memoizedState,null!==b&&null!==b.memoizedState!==U&&(S.flags|=8192),U&&1&S.mode?1073741824&Ql&&(Zl(S),6&S.subtreeFlags&&(S.flags|=8192)):Zl(S),null;case 24:case 25:return null}throw Error(At(156,S.tag))}function BL(b,S){switch(pE(S),S.tag){case 1:return ql(S.type)&&TS(),65536&(b=S.flags)?(S.flags=-65537&b|128,S):null;case 3:return ax(),No(Dl),No(el),pM(),65536&(b=S.flags)&&!(128&b)?(S.flags=-65537&b|128,S):null;case 5:return dM(S),null;case 13:if(No(os),null!==(b=S.memoizedState)&&null!==b.dehydrated){if(null===S.alternate)throw Error(At(340));Os()}return 65536&(b=S.flags)?(S.flags=-65537&b|128,S):null;case 19:return No(os),null;case 4:return ax(),null;case 10:return ef(S.type._context),null;case 22:case 23:return jE(),null;default:return null}}$S=function(b,S){for(var k=S.child;null!==k;){if(5===k.tag||6===k.tag)b.appendChild(k.stateNode);else if(4!==k.tag&&null!==k.child){k.child.return=k,k=k.child;continue}if(k===S)break;for(;null===k.sibling;){if(null===k.return||k.return===S)return;k=k.return}k.sibling.return=k.return,k=k.sibling}},PE=function(){},kl=function(b,S,k,U){var Y=b.memoizedProps;if(Y!==U){b=S.stateNode,Rb(_h.current);var ve,J=null;switch(k){case"input":Y=_k(b,Y),U=_k(b,U),J=[];break;case"select":Y=zn({},Y,{value:void 0}),U=zn({},U,{value:void 0}),J=[];break;case"textarea":Y=VI(b,Y),U=VI(b,U),J=[];break;default:"function"!=typeof Y.onClick&&"function"==typeof U.onClick&&(b.onclick=Qv)}for(pt in Tv(k,U),k=null,Y)if(!U.hasOwnProperty(pt)&&Y.hasOwnProperty(pt)&&null!=Y[pt])if("style"===pt){var De=Y[pt];for(ve in De)De.hasOwnProperty(ve)&&(k||(k={}),k[ve]="")}else"dangerouslySetInnerHTML"!==pt&&"children"!==pt&&"suppressContentEditableWarning"!==pt&&"suppressHydrationWarning"!==pt&&"autoFocus"!==pt&&(rs.hasOwnProperty(pt)?J||(J=[]):(J=J||[]).push(pt,null));for(pt in U){var He=U[pt];if(De=Y?.[pt],U.hasOwnProperty(pt)&&He!==De&&(null!=He||null!=De))if("style"===pt)if(De){for(ve in De)!De.hasOwnProperty(ve)||He&&He.hasOwnProperty(ve)||(k||(k={}),k[ve]="");for(ve in He)He.hasOwnProperty(ve)&&De[ve]!==He[ve]&&(k||(k={}),k[ve]=He[ve])}else k||(J||(J=[]),J.push(pt,k)),k=He;else"dangerouslySetInnerHTML"===pt?(De=De?De.__html:void 0,null!=(He=He?He.__html:void 0)&&De!==He&&(J=J||[]).push(pt,He)):"children"===pt?"string"!=typeof He&&"number"!=typeof He||(J=J||[]).push(pt,""+He):"suppressContentEditableWarning"!==pt&&"suppressHydrationWarning"!==pt&&(rs.hasOwnProperty(pt)?(null!=He&&"onScroll"===pt&&Ko("scroll",b),J||De===He||(J=[])):(J=J||[]).push(pt,He))}k&&(J=J||[]).push("style",k);var pt=J;(S.updateQueue=pt)&&(S.flags|=4)}},Fm=function(b,S,k,U){k!==U&&(S.flags|=4)};var YS=!1,Ml=!1,SM="function"==typeof WeakSet?WeakSet:Set,vn=null;function Pc(b,S){var k=b.ref;if(null!==k)if("function"==typeof k)try{k(null)}catch(U){As(b,S,U)}else k.current=null}function kE(b,S,k){try{k()}catch(U){As(b,S,U)}}var gx=!1;function Om(b,S,k){var U=S.updateQueue;if(null!==(U=null!==U?U.lastEffect:null)){var Y=U=U.next;do{if((Y.tag&b)===b){var J=Y.destroy;Y.destroy=void 0,void 0!==J&&kE(S,k,J)}Y=Y.next}while(Y!==U)}}function Vb(b,S){if(null!==(S=null!==(S=S.updateQueue)?S.lastEffect:null)){var k=S=S.next;do{(k.tag&b)===b&&(k.destroy=(0,k.create)()),k=k.next}while(k!==S)}}function KS(b){var S=b.ref;null!==S&&(b=b.stateNode,"function"==typeof S?S(b):S.current=b)}function ME(b){var S=b.alternate;null!==S&&(b.alternate=null,ME(S)),b.child=null,b.deletions=null,b.sibling=null,5===b.tag&&null!==(S=b.stateNode)&&(delete S[Vc],delete S[Jv],delete S[AS],delete S[IS],delete S[$K]),b.stateNode=null,b.return=null,b.dependencies=null,b.memoizedProps=null,b.memoizedState=null,b.pendingProps=null,b.stateNode=null,b.updateQueue=null}function CM(b){return 5===b.tag||3===b.tag||4===b.tag}function A0(b){e:for(;;){for(;null===b.sibling;){if(null===b.return||CM(b.return))return null;b=b.return}for(b.sibling.return=b.return,b=b.sibling;5!==b.tag&&6!==b.tag&&18!==b.tag;){if(2&b.flags||null===b.child||4===b.tag)continue e;b.child.return=b,b=b.child}if(!(2&b.flags))return b.stateNode}}function I0(b,S,k){var U=b.tag;if(5===U||6===U)b=b.stateNode,S?8===k.nodeType?k.parentNode.insertBefore(b,S):k.insertBefore(b,S):(8===k.nodeType?(S=k.parentNode).insertBefore(b,k):(S=k).appendChild(b),null!=(k=k._reactRootContainer)||null!==S.onclick||(S.onclick=Qv));else if(4!==U&&null!==(b=b.child))for(I0(b,S,k),b=b.sibling;null!==b;)I0(b,S,k),b=b.sibling}function RE(b,S,k){var U=b.tag;if(5===U||6===U)b=b.stateNode,S?k.insertBefore(b,S):k.appendChild(b);else if(4!==U&&null!==(b=b.child))for(RE(b,S,k),b=b.sibling;null!==b;)RE(b,S,k),b=b.sibling}var La=null,sf=!1;function Bm(b,S,k){for(k=k.child;null!==k;)wM(b,S,k),k=k.sibling}function wM(b,S,k){if(hn&&"function"==typeof hn.onCommitFiberUnmount)try{hn.onCommitFiberUnmount(Q2,k)}catch{}switch(k.tag){case 5:Ml||Pc(k,S);case 6:var U=La,Y=sf;La=null,Bm(b,S,k),sf=Y,null!==(La=U)&&(sf?(k=k.stateNode,8===(b=La).nodeType?b.parentNode.removeChild(k):b.removeChild(k)):La.removeChild(k.stateNode));break;case 18:null!==La&&(sf?(k=k.stateNode,8===(b=La).nodeType?wS(b.parentNode,k):1===b.nodeType&&wS(b,k),sS(b)):wS(La,k.stateNode));break;case 4:U=La,Y=sf,La=k.stateNode.containerInfo,sf=!0,Bm(b,S,k),La=U,sf=Y;break;case 0:case 11:case 14:case 15:if(!Ml&&null!==(U=k.updateQueue)&&null!==(U=U.lastEffect)){Y=U=U.next;do{var J=Y,ve=J.destroy;J=J.tag,void 0!==ve&&(2&J||4&J)&&kE(k,S,ve),Y=Y.next}while(Y!==U)}Bm(b,S,k);break;case 1:if(!Ml&&(Pc(k,S),"function"==typeof(U=k.stateNode).componentWillUnmount))try{U.props=k.memoizedProps,U.state=k.memoizedState,U.componentWillUnmount()}catch(De){As(k,S,De)}Bm(b,S,k);break;case 21:Bm(b,S,k);break;case 22:1&k.mode?(Ml=(U=Ml)||null!==k.memoizedState,Bm(b,S,k),Ml=U):Bm(b,S,k);break;default:Bm(b,S,k)}}function LL(b){var S=b.updateQueue;if(null!==S){b.updateQueue=null;var k=b.stateNode;null===k&&(k=b.stateNode=new SM),S.forEach(function(U){var Y=ZK.bind(null,b,U);k.has(U)||(k.add(U),U.then(Y,Y))})}}function Xf(b,S){var k=S.deletions;if(null!==k)for(var U=0;U<k.length;U++){var Y=k[U];try{var J=b,ve=S,De=ve;e:for(;null!==De;){switch(De.tag){case 5:La=De.stateNode,sf=!1;break e;case 3:case 4:La=De.stateNode.containerInfo,sf=!0;break e}De=De.return}if(null===La)throw Error(At(160));wM(J,ve,Y),La=null,sf=!1;var He=Y.alternate;null!==He&&(He.return=null),Y.return=null}catch(pt){As(Y,S,pt)}}if(12854&S.subtreeFlags)for(S=S.child;null!==S;)ZS(S,b),S=S.sibling}function ZS(b,S){var k=b.alternate,U=b.flags;switch(b.tag){case 0:case 11:case 14:case 15:if(Xf(S,b),$c(b),4&U){try{Om(3,b,b.return),Vb(3,b)}catch(Nn){As(b,b.return,Nn)}try{Om(5,b,b.return)}catch(Nn){As(b,b.return,Nn)}}break;case 1:Xf(S,b),$c(b),512&U&&null!==k&&Pc(k,k.return);break;case 5:if(Xf(S,b),$c(b),512&U&&null!==k&&Pc(k,k.return),32&b.flags){var Y=b.stateNode;try{Ev(Y,"")}catch(Nn){As(b,b.return,Nn)}}if(4&U&&null!=(Y=b.stateNode)){var J=b.memoizedProps,ve=null!==k?k.memoizedProps:J,De=b.type,He=b.updateQueue;if(b.updateQueue=null,null!==He)try{"input"===De&&"radio"===J.type&&null!=J.name&&nL(Y,J),Dv(De,ve);var pt=Dv(De,J);for(ve=0;ve<He.length;ve+=2){var Ot=He[ve],Wt=He[ve+1];"style"===Ot?sL(Y,Wt):"dangerouslySetInnerHTML"===Ot?wk(Y,Wt):"children"===Ot?Ev(Y,Wt):wc(Y,Ot,Wt,pt)}switch(De){case"input":zI(Y,J);break;case"textarea":rL(Y,J);break;case"select":var Bt=Y._wrapperState.wasMultiple;Y._wrapperState.wasMultiple=!!J.multiple;var yn=J.value;null!=yn?e0(Y,!!J.multiple,yn,!1):Bt!==!!J.multiple&&(null!=J.defaultValue?e0(Y,!!J.multiple,J.defaultValue,!0):e0(Y,!!J.multiple,J.multiple?[]:"",!1))}Y[Jv]=J}catch(Nn){As(b,b.return,Nn)}}break;case 6:if(Xf(S,b),$c(b),4&U){if(null===b.stateNode)throw Error(At(162));Y=b.stateNode,J=b.memoizedProps;try{Y.nodeValue=J}catch(Nn){As(b,b.return,Nn)}}break;case 3:if(Xf(S,b),$c(b),4&U&&null!==k&&k.memoizedState.isDehydrated)try{sS(S.containerInfo)}catch(Nn){As(b,b.return,Nn)}break;case 4:default:Xf(S,b),$c(b);break;case 13:Xf(S,b),$c(b),8192&(Y=b.child).flags&&(Y.stateNode.isHidden=J=null!==Y.memoizedState,!J||null!==Y.alternate&&null!==Y.alternate.memoizedState||(Ch=na())),4&U&&LL(b);break;case 22:if(Ot=null!==k&&null!==k.memoizedState,1&b.mode?(Ml=(pt=Ml)||Ot,Xf(S,b),Ml=pt):Xf(S,b),$c(b),8192&U){if((b.stateNode.isHidden=pt=null!==b.memoizedState)&&!Ot&&1&b.mode)for(vn=b,Ot=b.child;null!==Ot;){for(Wt=vn=Ot;null!==vn;){switch(yn=(Bt=vn).child,Bt.tag){case 0:case 11:case 14:case 15:Om(4,Bt,Bt.return);break;case 1:Pc(Bt,Bt.return);var Tn=Bt.stateNode;if("function"==typeof Tn.componentWillUnmount){U=Bt,k=Bt.return;try{Tn.props=(S=U).memoizedProps,Tn.state=S.memoizedState,Tn.componentWillUnmount()}catch(Nn){As(U,k,Nn)}}break;case 5:Pc(Bt,Bt.return);break;case 22:if(null!==Bt.memoizedState){yx(Wt);continue}}null!==yn?(yn.return=Bt,vn=yn):yx(Wt)}Ot=Ot.sibling}e:for(Ot=null,Wt=b;;){if(5===Wt.tag){if(null===Ot){Ot=Wt;try{Y=Wt.stateNode,pt?"function"==typeof(J=Y.style).setProperty?J.setProperty("display","none","important"):J.display="none":(De=Wt.stateNode,ve=null!=(He=Wt.memoizedProps.style)&&He.hasOwnProperty("display")?He.display:null,De.style.display=Ik("display",ve))}catch(Nn){As(b,b.return,Nn)}}}else if(6===Wt.tag){if(null===Ot)try{Wt.stateNode.nodeValue=pt?"":Wt.memoizedProps}catch(Nn){As(b,b.return,Nn)}}else if((22!==Wt.tag&&23!==Wt.tag||null===Wt.memoizedState||Wt===b)&&null!==Wt.child){Wt.child.return=Wt,Wt=Wt.child;continue}if(Wt===b)break e;for(;null===Wt.sibling;){if(null===Wt.return||Wt.return===b)break e;Ot===Wt&&(Ot=null),Wt=Wt.return}Ot===Wt&&(Ot=null),Wt.sibling.return=Wt.return,Wt=Wt.sibling}}break;case 19:Xf(S,b),$c(b),4&U&&LL(b);case 21:}}function $c(b){var S=b.flags;if(2&S){try{e:{for(var k=b.return;null!==k;){if(CM(k)){var U=k;break e}k=k.return}throw Error(At(160))}switch(U.tag){case 5:var Y=U.stateNode;32&U.flags&&(Ev(Y,""),U.flags&=-33),RE(b,A0(b),Y);break;case 3:case 4:var ve=U.stateNode.containerInfo;I0(b,A0(b),ve);break;default:throw Error(At(161))}}catch(He){As(b,b.return,He)}b.flags&=-3}4096&S&&(b.flags&=-4097)}function jL(b,S,k){vn=b,Hb(b,S,k)}function Hb(b,S,k){for(var U=!!(1&b.mode);null!==vn;){var Y=vn,J=Y.child;if(22===Y.tag&&U){var ve=null!==Y.memoizedState||YS;if(!ve){var De=Y.alternate,He=null!==De&&null!==De.memoizedState||Ml;De=YS;var pt=Ml;if(YS=ve,(Ml=He)&&!pt)for(vn=Y;null!==vn;)He=(ve=vn).child,22===ve.tag&&null!==ve.memoizedState?UL(Y):null!==He?(He.return=ve,vn=He):UL(Y);for(;null!==J;)vn=J,Hb(J,S,k),J=J.sibling;vn=Y,YS=De,Ml=pt}QS(b)}else 8772&Y.subtreeFlags&&null!==J?(J.return=Y,vn=J):QS(b)}}function QS(b){for(;null!==vn;){var S=vn;if(8772&S.flags){var k=S.alternate;try{if(8772&S.flags)switch(S.tag){case 0:case 11:case 15:Ml||Vb(5,S);break;case 1:var U=S.stateNode;if(4&S.flags&&!Ml)if(null===k)U.componentDidMount();else{var Y=S.elementType===S.type?k.memoizedProps:Tc(S.type,k.memoizedProps);U.componentDidUpdate(Y,k.memoizedState,U.__reactInternalSnapshotBeforeUpdate)}var J=S.updateQueue;null!==J&&kS(S,J,U);break;case 3:var ve=S.updateQueue;if(null!==ve){if(k=null,null!==S.child)switch(S.child.tag){case 5:case 1:k=S.child.stateNode}kS(S,ve,k)}break;case 5:if(null===k&&4&S.flags){k=S.stateNode;var He=S.memoizedProps;switch(S.type){case"button":case"input":case"select":case"textarea":He.autoFocus&&k.focus();break;case"img":He.src&&(k.src=He.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===S.memoizedState){var pt=S.alternate;if(null!==pt){var Ot=pt.memoizedState;if(null!==Ot){var Wt=Ot.dehydrated;null!==Wt&&sS(Wt)}}}break;default:throw Error(At(163))}Ml||512&S.flags&&KS(S)}catch(Bt){As(S,S.return,Bt)}}if(S===b){vn=null;break}if(null!==(k=S.sibling)){k.return=S.return,vn=k;break}vn=S.return}}function yx(b){for(;null!==vn;){var S=vn;if(S===b){vn=null;break}var k=S.sibling;if(null!==k){k.return=S.return,vn=k;break}vn=S.return}}function UL(b){for(;null!==vn;){var S=vn;try{switch(S.tag){case 0:case 11:case 15:var k=S.return;try{Vb(4,S)}catch(He){As(S,k,He)}break;case 1:var U=S.stateNode;if("function"==typeof U.componentDidMount){var Y=S.return;try{U.componentDidMount()}catch(He){As(S,Y,He)}}var J=S.return;try{KS(S)}catch(He){As(S,J,He)}break;case 5:var ve=S.return;try{KS(S)}catch(He){As(S,ve,He)}}}catch(He){As(S,S.return,He)}if(S===b){vn=null;break}var De=S.sibling;if(null!==De){De.return=S.return,vn=De;break}vn=S.return}}var HL,AM=Math.ceil,bx=Ss.ReactCurrentDispatcher,NE=Ss.ReactCurrentOwner,ia=Ss.ReactCurrentBatchConfig,Oi=0,oa=null,Bs=null,nl=0,Ql=0,Lm=Pm(0),ja=0,Gb=null,jm=0,vx=0,JS=0,xx=null,Rl=null,Ch=0,qb=1/0,Kf=null,_x=!1,Um=null,Eu=null,Ls=!1,zm=null,Wb=0,E0=0,FE=null,Sx=-1,Vm=0;function kc(){return 6&Oi?na():-1!==Sx?Sx:Sx=na()}function wh(b){return 1&b.mode?2&Oi&&0!==nl?nl&-nl:null!==_r.transition?(0===Vm&&(Vm=s0()),Vm):(0!==(b=Gn)||(b=void 0===(b=window.event)?16:gn(b.type)),b):1}function Tu(b,S,k,U){if(50<E0)throw E0=0,FE=null,Error(At(185));a0(b,k,U),(!(2&Oi)||b!==oa)&&(b===oa&&(!(2&Oi)&&(vx|=k),4===ja&&Ah(b,nl)),Nl(b,U),1===k&&0===Oi&&!(1&S.mode)&&(qb=na()+500,DS&&Zd()))}function Nl(b,S){var k=b.callbackNode;!function bb(b,S){for(var k=b.suspendedLanes,U=b.pingedLanes,Y=b.expirationTimes,J=b.pendingLanes;0<J;){var ve=31-ad(J),De=1<<ve,He=Y[ve];-1===He?(!(De&k)||De&U)&&(Y[ve]=lh(De,S)):He<=S&&(b.expiredLanes|=De),J&=~De}}(b,S);var U=Fv(b,b===oa?nl:0);if(0===U)null!==k&&KI(k),b.callbackNode=null,b.callbackPriority=0;else if(b.callbackPriority!==(S=U&-U)){if(null!=k&&KI(k),1===S)0===b.tag?function sM(b){DS=!0,Hf(b)}(IM.bind(null,b)):Hf(IM.bind(null,b)),Gl(function(){!(6&Oi)&&Zd()}),k=null;else{switch(dL(U)){case 1:k=Z2;break;case 4:k=Ao;break;case 16:default:k=Rv;break;case 536870912:k=Xo}k=DM(k,OE.bind(null,b))}b.callbackPriority=S,b.callbackNode=k}}function OE(b,S){if(Sx=-1,Vm=0,6&Oi)throw Error(At(327));var k=b.callbackNode;if(Xb()&&b.callbackNode!==k)return null;var U=Fv(b,b===oa?nl:0);if(0===U)return null;if(30&U||U&b.expiredLanes||S)S=VE(b,U);else{S=U;var Y=Oi;Oi|=2;var J=zE();for((oa!==b||nl!==S)&&(Kf=null,qb=na()+500,$b(b,S));;)try{YK();break}catch(De){UE(b,De)}Mm(),bx.current=J,Oi=Y,null!==Bs?S=0:(oa=null,nl=0,S=ja)}if(0!==S){if(2===S&&0!==(Y=Cm(b))&&(U=Y,S=BE(b,Y)),1===S)throw k=Gb,$b(b,0),Ah(b,U),Nl(b,na()),k;if(6===S)Ah(b,U);else{if(Y=b.current.alternate,!(30&U||function zL(b){for(var S=b;;){if(16384&S.flags){var k=S.updateQueue;if(null!==k&&null!==(k=k.stores))for(var U=0;U<k.length;U++){var Y=k[U],J=Y.getSnapshot;Y=Y.value;try{if(!Vl(J(),Y))return!1}catch{return!1}}}if(k=S.child,16384&S.subtreeFlags&&null!==k)k.return=S,S=k;else{if(S===b)break;for(;null===S.sibling;){if(null===S.return||S.return===b)return!0;S=S.return}S.sibling.return=S.return,S=S.sibling}}return!0}(Y)||(S=VE(b,U),2===S&&(J=Cm(b),0!==J&&(U=J,S=BE(b,J))),1!==S)))throw k=Gb,$b(b,0),Ah(b,U),Nl(b,na()),k;switch(b.finishedWork=Y,b.finishedLanes=U,S){case 0:case 1:throw Error(At(345));case 2:case 5:Hm(b,Rl,Kf);break;case 3:if(Ah(b,U),(130023424&U)===U&&10<(S=Ch+500-na())){if(0!==Fv(b,0))break;if(((Y=b.suspendedLanes)&U)!==U){kc(),b.pingedLanes|=b.suspendedLanes&Y;break}b.timeoutHandle=ra(Hm.bind(null,b,Rl,Kf),S);break}Hm(b,Rl,Kf);break;case 4:if(Ah(b,U),(4194240&U)===U)break;for(S=b.eventTimes,Y=-1;0<U;){var ve=31-ad(U);J=1<<ve,(ve=S[ve])>Y&&(Y=ve),U&=~J}if(U=Y,10<(U=(120>(U=na()-U)?120:480>U?480:1080>U?1080:1920>U?1920:3e3>U?3e3:4320>U?4320:1960*AM(U/1960))-U)){b.timeoutHandle=ra(Hm.bind(null,b,Rl,Kf),U);break}Hm(b,Rl,Kf);break;default:throw Error(At(329))}}}return Nl(b,na()),b.callbackNode===k?OE.bind(null,b):null}function BE(b,S){var k=xx;return b.current.memoizedState.isDehydrated&&($b(b,S).flags|=256),2!==(b=VE(b,S))&&(S=Rl,Rl=k,null!==S&&LE(S)),b}function LE(b){null===Rl?Rl=b:Rl.push.apply(Rl,b)}function Ah(b,S){for(S&=~JS,b.suspendedLanes|=S&=~vx,b.pingedLanes&=~S,b=b.expirationTimes;0<S;){var k=31-ad(S),U=1<<k;b[k]=-1,S&=~U}}function IM(b){if(6&Oi)throw Error(At(327));Xb();var S=Fv(b,0);if(!(1&S))return Nl(b,na()),null;var k=VE(b,S);if(0!==b.tag&&2===k){var U=Cm(b);0!==U&&(S=U,k=BE(b,U))}if(1===k)throw k=Gb,$b(b,0),Ah(b,S),Nl(b,na()),k;if(6===k)throw Error(At(345));return b.finishedWork=b.current.alternate,b.finishedLanes=S,Hm(b,Rl,Kf),Nl(b,na()),null}function eC(b,S){var k=Oi;Oi|=1;try{return b(S)}finally{0===(Oi=k)&&(qb=na()+500,DS&&Zd())}}function T0(b){null!==zm&&0===zm.tag&&!(6&Oi)&&Xb();var S=Oi;Oi|=1;var k=ia.transition,U=Gn;try{if(ia.transition=null,Gn=1,b)return b()}finally{Gn=U,ia.transition=k,!(6&(Oi=S))&&Zd()}}function jE(){Ql=Lm.current,No(Lm)}function $b(b,S){b.finishedWork=null,b.finishedLanes=0;var k=b.timeoutHandle;if(-1!==k&&(b.timeoutHandle=-1,Tl(k)),null!==Bs)for(k=Bs.return;null!==k;){var U=k;switch(pE(U),U.tag){case 1:null!=(U=U.type.childContextTypes)&&TS();break;case 3:ax(),No(Dl),No(el),pM();break;case 5:dM(U);break;case 4:ax();break;case 13:case 19:No(os);break;case 10:ef(U.type._context);break;case 22:case 23:jE()}k=k.return}if(oa=b,Bs=b=Zf(b.current,null),nl=Ql=S,ja=0,Gb=null,JS=vx=jm=0,Rl=xx=null,null!==Gf){for(S=0;S<Gf.length;S++)if(null!==(U=(k=Gf[S]).interleaved)){k.interleaved=null;var J=k.pending;if(null!==J){var ve=J.next;J.next=U.next,U.next=ve}k.pending=U}Gf=null}return b}function UE(b,S){for(;;){var k=Bs;try{if(Mm(),hE.current=qS,LS){for(var U=ss.memoizedState;null!==U;){var Y=U.queue;null!==Y&&(Y.pending=null),U=U.next}LS=!1}if(_0=0,Ba=Oo=ss=null,cx=!1,Nb=0,NE.current=null,null===k||null===k.return){ja=1,Gb=S,Bs=null;break}e:{var J=b,ve=k.return,De=k,He=S;if(S=nl,De.flags|=32768,null!==He&&"object"==typeof He&&"function"==typeof He.then){var pt=He,Ot=De,Wt=Ot.tag;if(!(1&Ot.mode||0!==Wt&&11!==Wt&&15!==Wt)){var Bt=Ot.alternate;Bt?(Ot.updateQueue=Bt.updateQueue,Ot.memoizedState=Bt.memoizedState,Ot.lanes=Bt.lanes):(Ot.updateQueue=null,Ot.memoizedState=null)}var yn=zb(ve);if(null!==yn){yn.flags&=-257,rf(yn,ve,De,0,S),1&yn.mode&&_E(J,pt,S),He=pt;var Tn=(S=yn).updateQueue;if(null===Tn){var Nn=new Set;Nn.add(He),S.updateQueue=Nn}else Tn.add(He);break e}if(!(1&S)){_E(J,pt,S),Jl();break e}He=Error(At(426))}else if(wr&&1&De.mode){var sa=zb(ve);if(null!==sa){!(65536&sa.flags)&&(sa.flags|=256),rf(sa,ve,De,0,S),Cu(Ub(He,De));break e}}J=He=Ub(He,De),4!==ja&&(ja=2),null===xx?xx=[J]:xx.push(J),J=ve;do{switch(J.tag){case 3:J.flags|=65536,J.lanes|=S&=-S,Pl(J,qf(0,He,S));break e;case 1:De=He;var lt=J.stateNode;if(!(128&J.flags||"function"!=typeof J.type.getDerivedStateFromError&&(null===lt||"function"!=typeof lt.componentDidCatch||null!==Eu&&Eu.has(lt)))){J.flags|=65536,J.lanes|=S&=-S,Pl(J,ro(J,De,S));break e}}J=J.return}while(null!==J)}af(k)}catch(Fn){S=Fn,Bs===k&&null!==k&&(Bs=k=k.return);continue}break}}function zE(){var b=bx.current;return bx.current=qS,null===b?qS:b}function Jl(){(0===ja||3===ja||2===ja)&&(ja=4),null===oa||!(268435455&jm)&&!(268435455&vx)||Ah(oa,nl)}function VE(b,S){var k=Oi;Oi|=2;var U=zE();for((oa!==b||nl!==S)&&(Kf=null,$b(b,S));;)try{EM();break}catch(Y){UE(b,Y)}if(Mm(),Oi=k,bx.current=U,null!==Bs)throw Error(At(261));return oa=null,nl=0,ja}function EM(){for(;null!==Bs;)tC(Bs)}function YK(){for(;null!==Bs&&!cL();)tC(Bs)}function tC(b){var S=HL(b.alternate,b,Ql);b.memoizedProps=b.pendingProps,null===S?af(b):Bs=S,NE.current=null}function af(b){var S=b;do{var k=S.alternate;if(b=S.return,32768&S.flags){if(null!==(k=BL(k,S)))return k.flags&=32767,void(Bs=k);if(null===b)return ja=6,void(Bs=null);b.flags|=32768,b.subtreeFlags=0,b.deletions=null}else if(null!==(k=OL(k,S,Ql)))return void(Bs=k);if(null!==(S=S.sibling))return void(Bs=S);Bs=S=b}while(null!==S);0===ja&&(ja=5)}function Hm(b,S,k){var U=Gn,Y=ia.transition;try{ia.transition=null,Gn=1,function Yb(b,S,k,U){do{Xb()}while(null!==zm);if(6&Oi)throw Error(At(327));var Y=b.finishedLanes;if(null===(k=b.finishedWork))return null;if(b.finishedWork=null,b.finishedLanes=0,k===b.current)throw Error(At(177));b.callbackNode=null,b.callbackPriority=0;var J=k.lanes|k.childLanes;if(function vb(b,S){var k=b.pendingLanes&~S;b.pendingLanes=S,b.suspendedLanes=0,b.pingedLanes=0,b.expiredLanes&=S,b.mutableReadLanes&=S,b.entangledLanes&=S,S=b.entanglements;var U=b.eventTimes;for(b=b.expirationTimes;0<k;){var Y=31-ad(k),J=1<<Y;S[Y]=0,U[Y]=-1,b[Y]=-1,k&=~J}}(b,J),b===oa&&(Bs=oa=null,nl=0),!(2064&k.subtreeFlags)&&!(2064&k.flags)||Ls||(Ls=!0,DM(Rv,function(){return Xb(),null})),J=!!(15990&k.flags),15990&k.subtreeFlags||J){J=ia.transition,ia.transition=null;var ve=Gn;Gn=1;var De=Oi;Oi|=4,NE.current=null,function XS(b,S){if(Ja=sr,hS(b=_L())){if("selectionStart"in b)var k={start:b.selectionStart,end:b.selectionEnd};else{var U=(k=(k=b.ownerDocument)&&k.defaultView||window).getSelection&&k.getSelection();if(U&&0!==U.rangeCount){k=U.anchorNode;var Y=U.anchorOffset,J=U.focusNode;U=U.focusOffset;var ve=0,De=-1,He=-1,pt=0,Ot=0,Wt=b,Bt=null;t:for(;;){for(var yn;Wt!==k||0!==Y&&3!==Wt.nodeType||(De=ve+Y),Wt!==J||0!==U&&3!==Wt.nodeType||(He=ve+U),3===Wt.nodeType&&(ve+=Wt.nodeValue.length),null!==(yn=Wt.firstChild);)Bt=Wt,Wt=yn;for(;;){if(Wt===b)break t;if(Bt===k&&++pt===Y&&(De=ve),Bt===J&&++Ot===U&&(He=ve),null!==(yn=Wt.nextSibling))break;Bt=(Wt=Bt).parentNode}Wt=yn}k=-1===De||-1===He?null:{start:De,end:He}}else k=null}k=k||{start:0,end:0}}else k=null;for(Hl={focusedElem:b,selectionRange:k},sr=!1,vn=S;null!==vn;)if(b=(S=vn).child,1028&S.subtreeFlags&&null!==b)b.return=S,vn=b;else for(;null!==vn;){S=vn;try{var Tn=S.alternate;if(1024&S.flags)switch(S.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==Tn){var Nn=Tn.memoizedProps,sa=Tn.memoizedState,it=S.stateNode,We=it.getSnapshotBeforeUpdate(S.elementType===S.type?Nn:Tc(S.type,Nn),sa);it.__reactInternalSnapshotBeforeUpdate=We}break;case 3:var lt=S.stateNode.containerInfo;1===lt.nodeType?lt.textContent="":9===lt.nodeType&&lt.documentElement&&lt.removeChild(lt.documentElement);break;default:throw Error(At(163))}}catch(tn){As(S,S.return,tn)}if(null!==(b=S.sibling)){b.return=S.return,vn=b;break}vn=S.return}Tn=gx,gx=!1}(b,k),ZS(k,b),WK(Hl),sr=!!Ja,Hl=Ja=null,b.current=k,jL(k,b,Y),uL(),Oi=De,Gn=ve,ia.transition=J}else b.current=k;if(Ls&&(Ls=!1,zm=b,Wb=Y),0===(J=b.pendingLanes)&&(Eu=null),function OK(b){if(hn&&"function"==typeof hn.onCommitFiberRoot)try{hn.onCommitFiberRoot(Q2,b,void 0,!(128&~b.current.flags))}catch{}}(k.stateNode),Nl(b,na()),null!==S)for(U=b.onRecoverableError,k=0;k<S.length;k++)U((Y=S[k]).value,{componentStack:Y.stack,digest:Y.digest});if(_x)throw _x=!1,b=Um,Um=null,b;1&Wb&&0!==b.tag&&Xb(),1&(J=b.pendingLanes)?b===FE?E0++:(E0=0,FE=b):E0=0,Zd()}(b,S,k,U)}finally{ia.transition=Y,Gn=U}return null}function Xb(){if(null!==zm){var b=dL(Wb),S=ia.transition,k=Gn;try{if(ia.transition=null,Gn=16>b?16:b,null===zm)var U=!1;else{if(b=zm,zm=null,Wb=0,6&Oi)throw Error(At(331));var Y=Oi;for(Oi|=4,vn=b.current;null!==vn;){var J=vn,ve=J.child;if(16&vn.flags){var De=J.deletions;if(null!==De){for(var He=0;He<De.length;He++){var pt=De[He];for(vn=pt;null!==vn;){var Ot=vn;switch(Ot.tag){case 0:case 11:case 15:Om(8,Ot,J)}var Wt=Ot.child;if(null!==Wt)Wt.return=Ot,vn=Wt;else for(;null!==vn;){var Bt=(Ot=vn).sibling,yn=Ot.return;if(ME(Ot),Ot===pt){vn=null;break}if(null!==Bt){Bt.return=yn,vn=Bt;break}vn=yn}}}var Tn=J.alternate;if(null!==Tn){var Nn=Tn.child;if(null!==Nn){Tn.child=null;do{var sa=Nn.sibling;Nn.sibling=null,Nn=sa}while(null!==Nn)}}vn=J}}if(2064&J.subtreeFlags&&null!==ve)ve.return=J,vn=ve;else e:for(;null!==vn;){if(2048&(J=vn).flags)switch(J.tag){case 0:case 11:case 15:Om(9,J,J.return)}var it=J.sibling;if(null!==it){it.return=J.return,vn=it;break e}vn=J.return}}var We=b.current;for(vn=We;null!==vn;){var lt=(ve=vn).child;if(2064&ve.subtreeFlags&&null!==lt)lt.return=ve,vn=lt;else e:for(ve=We;null!==vn;){if(2048&(De=vn).flags)try{switch(De.tag){case 0:case 11:case 15:Vb(9,De)}}catch(Fn){As(De,De.return,Fn)}if(De===ve){vn=null;break e}var tn=De.sibling;if(null!==tn){tn.return=De.return,vn=tn;break e}vn=De.return}}if(Oi=Y,Zd(),hn&&"function"==typeof hn.onPostCommitFiberRoot)try{hn.onPostCommitFiberRoot(Q2,b)}catch{}U=!0}return U}finally{Gn=k,ia.transition=S}}return!1}function TM(b,S,k){b=Eo(b,S=qf(0,S=Ub(k,S),1),1),S=kc(),null!==b&&(a0(b,1,S),Nl(b,S))}function As(b,S,k){if(3===b.tag)TM(b,b,k);else for(;null!==S;){if(3===S.tag){TM(S,b,k);break}if(1===S.tag){var U=S.stateNode;if("function"==typeof S.type.getDerivedStateFromError||"function"==typeof U.componentDidCatch&&(null===Eu||!Eu.has(U))){S=Eo(S,b=ro(S,b=Ub(k,b),1),1),b=kc(),null!==S&&(a0(S,1,b),Nl(S,b));break}}S=S.return}}function XK(b,S,k){var U=b.pingCache;null!==U&&U.delete(S),S=kc(),b.pingedLanes|=b.suspendedLanes&k,oa===b&&(nl&k)===k&&(4===ja||3===ja&&(130023424&nl)===nl&&500>na()-Ch?$b(b,0):JS|=k),Nl(b,S)}function VL(b,S){0===S&&(1&b.mode?(S=ZI,!(130023424&(ZI<<=1))&&(ZI=4194304)):S=1);var k=kc();null!==(b=tf(b,S))&&(a0(b,S,k),Nl(b,k))}function KK(b){var S=b.memoizedState,k=0;null!==S&&(k=S.retryLane),VL(b,k)}function ZK(b,S){var k=0;switch(b.tag){case 13:var U=b.stateNode,Y=b.memoizedState;null!==Y&&(k=Y.retryLane);break;case 19:U=b.stateNode;break;default:throw Error(At(314))}null!==U&&U.delete(S),VL(b,k)}function DM(b,S){return Ra(b,S)}function Kb(b,S,k,U){this.tag=b,this.key=k,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=S,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=U,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ua(b,S,k,U){return new Kb(b,S,k,U)}function nC(b){return!(!(b=b.prototype)||!b.isReactComponent)}function Zf(b,S){var k=b.alternate;return null===k?((k=Ua(b.tag,S,b.key,b.mode)).elementType=b.elementType,k.type=b.type,k.stateNode=b.stateNode,k.alternate=b,b.alternate=k):(k.pendingProps=S,k.type=b.type,k.flags=0,k.subtreeFlags=0,k.deletions=null),k.flags=14680064&b.flags,k.childLanes=b.childLanes,k.lanes=b.lanes,k.child=b.child,k.memoizedProps=b.memoizedProps,k.memoizedState=b.memoizedState,k.updateQueue=b.updateQueue,k.dependencies=null===(S=b.dependencies)?null:{lanes:S.lanes,firstContext:S.firstContext},k.sibling=b.sibling,k.index=b.index,k.ref=b.ref,k}function rl(b,S,k,U,Y,J){var ve=2;if(U=b,"function"==typeof b)nC(b)&&(ve=1);else if("string"==typeof b)ve=5;else e:switch(b){case Ac:return D0(k.children,Y,J,S);case le:ve=8,Y|=8;break;case zf:return(b=Ua(12,k,S,2|Y)).elementType=zf,b.lanes=J,b;case no:return(b=Ua(13,k,S,Y)).elementType=no,b.lanes=J,b;case hr:return(b=Ua(19,k,S,Y)).elementType=hr,b.lanes=J,b;case Hr:return Zb(k,Y,J,S);default:if("object"==typeof b&&null!==b)switch(b.$$typeof){case Zi:ve=10;break e;case $r:ve=9;break e;case fr:ve=11;break e;case sn:ve=14;break e;case er:ve=16,U=null;break e}throw Error(At(130,null==b?b:typeof b,""))}return(S=Ua(ve,k,S,Y)).elementType=b,S.type=U,S.lanes=J,S}function D0(b,S,k,U){return(b=Ua(7,b,U,S)).lanes=k,b}function Zb(b,S,k,U){return(b=Ua(22,b,U,S)).elementType=Hr,b.lanes=k,b.stateNode={isHidden:!1},b}function P0(b,S,k){return(b=Ua(6,b,null,S)).lanes=k,b}function HE(b,S,k){return(S=Ua(4,null!==b.children?b.children:[],b.key,S)).lanes=k,S.stateNode={containerInfo:b.containerInfo,pendingChildren:null,implementation:b.implementation},S}function PM(b,S,k,U,Y){this.tag=S,this.containerInfo=b,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tS(0),this.expirationTimes=tS(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tS(0),this.identifierPrefix=U,this.onRecoverableError=Y,this.mutableSourceEagerHydrationData=null}function rC(b,S,k,U,Y,J,ve,De,He){return b=new PM(b,S,k,De,He),1===S?(S=1,!0===J&&(S|=8)):S=0,J=Ua(3,null,null,S),b.current=J,J.stateNode=b,J.memoizedState={element:U,isDehydrated:k,cache:null,transitions:null,pendingSuspenseBoundaries:null},md(J),b}function Cx(b){if(!b)return km;e:{if(sh(b=b._reactInternals)!==b||1!==b.tag)throw Error(At(170));var S=b;do{switch(S.tag){case 3:S=S.stateNode.context;break e;case 1:if(ql(S.type)){S=S.stateNode.__reactInternalMemoizedMergedChildContext;break e}}S=S.return}while(null!==S);throw Error(At(171))}if(1===b.tag){var k=b.type;if(ql(k))return dE(b,k,S)}return S}function sC(b,S,k,U){var Y=S.current,J=kc(),ve=wh(Y);return k=Cx(k),null===S.context?S.context=k:S.pendingContext=k,(S=Gc(J,ve)).payload={element:b},null!==(U=void 0===U?null:U)&&(S.callback=U),null!==(b=Eo(Y,S,ve))&&(Tu(b,Y,ve,J),Pb(b,Y,ve)),ve}function aC(b){return(b=b.current).child?b.child.stateNode:null}function kM(b,S){if(null!==(b=b.memoizedState)&&null!==b.dehydrated){var k=b.retryLane;b.retryLane=0!==k&&k<S?k:S}}function lC(b,S){kM(b,S),(b=b.alternate)&&kM(b,S)}HL=function(b,S,k){if(null!==b)if(b.memoizedProps!==S.pendingProps||Dl.current)Xl=!0;else{if(!(b.lanes&k||128&S.flags))return Xl=!1,function _M(b,S,k){switch(S.tag){case 3:IE(S),Os();break;case 5:EL(S);break;case 1:ql(S.type)&&hh(S);break;case 4:uM(S,S.stateNode.containerInfo);break;case 10:var U=S.type._context,Y=S.memoizedProps.value;ho(rx,U._currentValue),U._currentValue=Y;break;case 13:if(null!==(U=S.memoizedState))return null!==U.dehydrated?(ho(os,1&os.current),S.flags|=128,null):k&S.child.childLanes?WS(b,S,k):(ho(os,1&os.current),null!==(b=Yf(b,S,k))?b.sibling:null);ho(os,1&os.current);break;case 19:if(U=!!(k&S.childLanes),128&b.flags){if(U)return DE(b,S,k);S.flags|=128}if(null!==(Y=S.memoizedState)&&(Y.rendering=null,Y.tail=null,Y.lastEffect=null),ho(os,os.current),U)break;return null;case 22:case 23:return S.lanes=0,Wf(b,S,k)}return Yf(b,S,k)}(b,S,k);Xl=!!(131072&b.flags)}else Xl=!1,wr&&1048576&S.flags&&aM(S,Ns,S.index);switch(S.lanes=0,S.tag){case 2:var U=S.type;mx(b,S),b=S.pendingProps;var Y=Kd(S,el.current);x0(S,k),Y=mE(null,S,U,b,Y,k);var J=gd();return S.flags|=1,"object"==typeof Y&&null!==Y&&"function"==typeof Y.render&&void 0===Y.$$typeof?(S.tag=1,S.memoizedState=null,S.updateQueue=null,ql(U)?(J=!0,hh(S)):J=!1,S.memoizedState=null!=Y.state?Y.state:null,md(S),Y.updater=qc,S.stateNode=Y,Y._reactInternals=S,ox(S,U,b,k),S=AE(null,S,U,!0,J,k)):(S.tag=0,wr&&J&&fE(S),Dc(null,S,Y,k),S=S.child),S;case 16:U=S.elementType;e:{switch(mx(b,S),b=S.pendingProps,U=(Y=U._init)(U._payload),S.type=U,Y=S.tag=function GL(b){if("function"==typeof b)return nC(b)?1:0;if(null!=b){if((b=b.$$typeof)===fr)return 11;if(b===sn)return 14}return 2}(U),b=Tc(U,b),Y){case 0:S=Iu(null,S,U,b,k);break e;case 1:S=$f(null,S,U,b,k);break e;case 11:S=NL(null,S,U,b,k);break e;case 14:S=CE(null,S,U,Tc(U.type,b),k);break e}throw Error(At(306,U,""))}return S;case 0:return Y=S.pendingProps,Iu(b,S,U=S.type,Y=S.elementType===U?Y:Tc(U,Y),k);case 1:return Y=S.pendingProps,$f(b,S,U=S.type,Y=S.elementType===U?Y:Tc(U,Y),k);case 3:e:{if(IE(S),null===b)throw Error(At(387));U=S.pendingProps,Y=(J=S.memoizedState).element,ix(b,S),Oa(S,U,null,k);var ve=S.memoizedState;if(U=ve.element,J.isDehydrated){if(S.updateQueue.baseState=J={element:U,isDehydrated:!1,cache:ve.cache,pendingSuspenseBoundaries:ve.pendingSuspenseBoundaries,transitions:ve.transitions},S.memoizedState=J,256&S.flags){S=xM(b,S,U,k,Y=Ub(Error(At(423)),S));break e}if(U!==Y){S=xM(b,S,U,k,Y=Ub(Error(At(424)),S));break e}for(Wl=Yd(S.stateNode.containerInfo.firstChild),Ec=S,wr=!0,Ht=null,k=IL(S,null,U,k),S.child=k;k;)k.flags=-3&k.flags|4096,k=k.sibling}else{if(Os(),U===Y){S=Yf(b,S,k);break e}Dc(b,S,U,k)}S=S.child}return S;case 5:return EL(S),null===b&&tl(S),J=null!==b?b.memoizedProps:null,ve=(Y=S.pendingProps).children,Yr(U=S.type,Y)?ve=null:null!==J&&Yr(U,J)&&(S.flags|=32),wE(b,S),Dc(b,S,ve,k),S.child;case 6:return null===b&&tl(S),null;case 13:return WS(b,S,k);case 4:return uM(S,S.stateNode.containerInfo),U=S.pendingProps,null===b?S.child=sx(S,null,U,k):Dc(b,S,U,k),S.child;case 11:return Y=S.pendingProps,NL(b,S,U=S.type,Y=S.elementType===U?Y:Tc(U,Y),k);case 7:return Dc(b,S,S.pendingProps,k),S.child;case 8:case 12:return Dc(b,S,S.pendingProps.children,k),S.child;case 10:e:{if(J=S.memoizedProps,ve=(Y=S.pendingProps).value,ho(rx,(U=S.type._context)._currentValue),U._currentValue=ve,null!==J)if(Vl(J.value,ve)){if(J.children===Y.children&&!Dl.current){S=Yf(b,S,k);break e}}else for(null!==(J=S.child)&&(J.return=S);null!==J;){var De=J.dependencies;if(null!==De){ve=J.child;for(var He=De.firstContext;null!==He;){if(He.context===U){if(1===J.tag){(He=Gc(-1,k&-k)).tag=2;var pt=J.updateQueue;if(null!==pt){var Ot=(pt=pt.shared).pending;null===Ot?He.next=He:(He.next=Ot.next,Ot.next=He),pt.pending=He}}J.lanes|=k,null!==(He=J.alternate)&&(He.lanes|=k),v0(J.return,k,S),De.lanes|=k;break}He=He.next}}else if(10===J.tag)ve=J.type===S.type?null:J.child;else if(18===J.tag){if(null===(ve=J.return))throw Error(At(341));ve.lanes|=k,null!==(De=ve.alternate)&&(De.lanes|=k),v0(ve,k,S),ve=J.sibling}else ve=J.child;if(null!==ve)ve.return=J;else for(ve=J;null!==ve;){if(ve===S){ve=null;break}if(null!==(J=ve.sibling)){J.return=ve.return,ve=J;break}ve=ve.return}J=ve}Dc(b,S,Y.children,k),S=S.child}return S;case 9:return Y=S.type,U=S.pendingProps.children,x0(S,k),U=U(Y=Fa(Y)),S.flags|=1,Dc(b,S,U,k),S.child;case 14:return Y=Tc(U=S.type,S.pendingProps),CE(b,S,U,Y=Tc(U.type,Y),k);case 15:return Kl(b,S,S.type,S.pendingProps,k);case 17:return Y=S.pendingProps,Y=S.elementType===(U=S.type)?Y:Tc(U,Y),mx(b,S),S.tag=1,ql(U)?(b=!0,hh(S)):b=!1,x0(S,k),lM(S,U,Y),ox(S,U,Y,k),AE(null,S,U,!0,b,k);case 19:return DE(b,S,k);case 22:return Wf(b,S,k)}throw Error(At(156,S.tag))};"function"==typeof reportError&&reportError;function ec(b){this._internalRoot=b}function Qb(b){this._internalRoot=b}function Fl(){}function Ax(b,S,k,U,Y){var J=k._reactRootContainer;if(J){var ve=J;if("function"==typeof Y){var De=Y;Y=function(){var He=aC(ve);De.call(He)}}sC(S,ve,b,Y)}else ve=function wx(b,S,k,U,Y){if(Y){if("function"==typeof U){var J=U;U=function(){var pt=aC(ve);J.call(pt)}}var ve=function oC(b,S,k,U,Y,J,ve,De,He){return(b=rC(k,U,!0,b,0,J,0,De,He)).context=Cx(null),k=b.current,(J=Gc(U=kc(),Y=wh(k))).callback=S??null,Eo(k,J,Y),b.current.lanes=Y,a0(b,Y,U),Nl(b,U),b}(S,U,b,0,null,!1,0,"",Fl);return b._reactRootContainer=ve,b[Xd]=ve.current,Zv(8===b.nodeType?b.parentNode:b),T0(),ve}for(;Y=b.lastChild;)b.removeChild(Y);if("function"==typeof U){var De=U;U=function(){var pt=aC(He);De.call(pt)}}var He=rC(b,0,!1,null,0,!1,0,"",Fl);return b._reactRootContainer=He,b[Xd]=He.current,Zv(8===b.nodeType?b.parentNode:b),T0(function(){sC(S,He,k,U)}),He}(k,S,b,Y,U);return aC(ve)}Qb.prototype.render=ec.prototype.render=function(b){var S=this._internalRoot;if(null===S)throw Error(At(409));sC(b,S,null,null)},Qb.prototype.unmount=ec.prototype.unmount=function(){var b=this._internalRoot;if(null!==b){this._internalRoot=null;var S=b.containerInfo;T0(function(){sC(null,b,null,null)}),S[Xd]=null}},Qb.prototype.unstable_scheduleHydration=function(b){if(b){var S=ya();b={blockedOn:null,target:b,priority:S};for(var k=0;k<wm.length&&0!==S&&S<wm[k].priority;k++);wm.splice(k,0,b),0===k&&pL(b)}},fL=function(b){switch(b.tag){case 3:var S=b.stateNode;if(S.current.memoizedState.isDehydrated){var k=eS(S.pendingLanes);0!==k&&(Pk(S,1|k),Nl(S,na()),!(6&Oi)&&(qb=na()+500,Zd()))}break;case 13:T0(function(){var U=tf(b,1);if(null!==U){var Y=kc();Tu(U,b,1,Y)}}),lC(b,1)}},Qi=function(b){if(13===b.tag){var S=tf(b,134217728);null!==S&&Tu(S,b,134217728,kc()),lC(b,134217728)}},kk=function(b){if(13===b.tag){var S=wh(b),k=tf(b,S);null!==k&&Tu(k,b,S,kc()),lC(b,S)}},ya=function(){return Gn},nS=function(b,S){var k=Gn;try{return Gn=b,S()}finally{Gn=k}},$2=function(b,S,k){switch(S){case"input":if(zI(b,k),S=k.name,"radio"===k.type&&null!=S){for(k=b;k.parentNode;)k=k.parentNode;for(k=k.querySelectorAll("input[name="+JSON.stringify(""+S)+'][type="radio"]'),S=0;S<k.length;S++){var U=k[S];if(U!==b&&U.form===b.form){var Y=tx(U);if(!Y)throw Error(At(90));Jg(U),zI(U,Y)}}}break;case"textarea":rL(b,k);break;case"select":null!=(S=k.value)&&e0(b,!!k.multiple,S,!1)}},kv=eC,Ek=T0;var Ix={findFiberByHostInstance:ph,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},NM={bundleType:Ix.bundleType,version:Ix.version,rendererPackageName:Ix.rendererPackageName,rendererConfig:Ix.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Ss.ReactCurrentDispatcher,findHostInstanceByFiber:function(b){return null===(b=YI(b))?null:b.stateNode},findFiberByHostInstance:Ix.findFiberByHostInstance||function qL(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uC=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uC.isDisabled&&uC.supportsFiber)try{Q2=uC.inject(NM),hn=uC}catch{}}an.render=function(b,S,k){if(!function Jb(b){return!(!b||1!==b.nodeType&&9!==b.nodeType&&11!==b.nodeType&&(8!==b.nodeType||" react-mount-point-unstable "!==b.nodeValue))}(S))throw Error(At(200));return Ax(null,b,S,!1,k)}},46:(ga,an,ln)=>{"use strict";(function Wr(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||"function"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Wr)}catch(Ms){console.error(Ms)}})(),ga.exports=ln(578)},209:(ga,an,ln)=>{"use strict";var Wr=ln(395),Ms=Symbol.for("react.element"),Ki=Symbol.for("react.fragment"),At=Object.prototype.hasOwnProperty,Ma=Wr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rs={key:!0,ref:!0,__self:!0,__source:!0};function Ci(rr,or,kr){var lr,Rs={},zo=null,xr=null;for(lr in void 0!==kr&&(zo=""+kr),void 0!==or.key&&(zo=""+or.key),void 0!==or.ref&&(xr=or.ref),or)At.call(or,lr)&&!rs.hasOwnProperty(lr)&&(Rs[lr]=or[lr]);if(rr&&rr.defaultProps)for(lr in or=rr.defaultProps)void 0===Rs[lr]&&(Rs[lr]=or[lr]);return{$$typeof:Ms,type:rr,key:zo,ref:xr,props:Rs,_owner:Ma.current}}an.Fragment=Ki,an.jsx=Ci,an.jsxs=Ci},330:(ga,an)=>{"use strict";var ln=Symbol.for("react.element"),Wr=Symbol.for("react.portal"),Ms=Symbol.for("react.fragment"),Ki=Symbol.for("react.strict_mode"),At=Symbol.for("react.profiler"),Ma=Symbol.for("react.provider"),rs=Symbol.for("react.context"),Ci=Symbol.for("react.forward_ref"),rr=Symbol.for("react.suspense"),or=Symbol.for("react.memo"),kr=Symbol.for("react.lazy"),lr=Symbol.iterator,zo={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xr=Object.assign,ea={};function ta(et,Lt,zn){this.props=et,this.context=Lt,this.refs=ea,this.updater=zn||zo}function vi(){}function to(et,Lt,zn){this.props=et,this.context=Lt,this.refs=ea,this.updater=zn||zo}ta.prototype.isReactComponent={},ta.prototype.setState=function(et,Lt){if("object"!=typeof et&&"function"!=typeof et&&null!=et)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,et,Lt,"setState")},ta.prototype.forceUpdate=function(et){this.updater.enqueueForceUpdate(this,et,"forceUpdate")},vi.prototype=ta.prototype;var Ul=to.prototype=new vi;Ul.constructor=to,xr(Ul,ta.prototype),Ul.isPureReactComponent=!0;var Cc=Array.isArray,wc=Object.prototype.hasOwnProperty,Ss={current:null},Cs={key:!0,ref:!0,__self:!0,__source:!0};function Al(et,Lt,zn){var fi,mi={},Ni=null,po=null;if(null!=Lt)for(fi in void 0!==Lt.ref&&(po=Lt.ref),void 0!==Lt.key&&(Ni=""+Lt.key),Lt)wc.call(Lt,fi)&&!Cs.hasOwnProperty(fi)&&(mi[fi]=Lt[fi]);var ws=arguments.length-2;if(1===ws)mi.children=zn;else if(1<ws){for(var Vo=Array(ws),Ic=0;Ic<ws;Ic++)Vo[Ic]=arguments[Ic+2];mi.children=Vo}if(et&&et.defaultProps)for(fi in ws=et.defaultProps)void 0===mi[fi]&&(mi[fi]=ws[fi]);return{$$typeof:ln,type:et,key:Ni,ref:po,props:mi,_owner:Ss.current}}function le(et){return"object"==typeof et&&null!==et&&et.$$typeof===ln}var Zi=/\/+/g;function $r(et,Lt){return"object"==typeof et&&null!==et&&null!=et.key?function zf(et){var Lt={"=":"=0",":":"=2"};return"$"+et.replace(/[=:]/g,function(zn){return Lt[zn]})}(""+et.key):Lt.toString(36)}function fr(et,Lt,zn,fi,mi){var Ni=typeof et;("undefined"===Ni||"boolean"===Ni)&&(et=null);var po=!1;if(null===et)po=!0;else switch(Ni){case"string":case"number":po=!0;break;case"object":switch(et.$$typeof){case ln:case Wr:po=!0}}if(po)return mi=mi(po=et),et=""===fi?"."+$r(po,0):fi,Cc(mi)?(zn="",null!=et&&(zn=et.replace(Zi,"$&/")+"/"),fr(mi,Lt,zn,"",function(Ic){return Ic})):null!=mi&&(le(mi)&&(mi=function Ac(et,Lt){return{$$typeof:ln,type:et.type,key:Lt,ref:et.ref,props:et.props,_owner:et._owner}}(mi,zn+(!mi.key||po&&po.key===mi.key?"":(""+mi.key).replace(Zi,"$&/")+"/")+et)),Lt.push(mi)),1;if(po=0,fi=""===fi?".":fi+":",Cc(et))for(var ws=0;ws<et.length;ws++){var Vo=fi+$r(Ni=et[ws],ws);po+=fr(Ni,Lt,zn,Vo,mi)}else if(Vo=function Rs(et){return null===et||"object"!=typeof et?null:"function"==typeof(et=lr&&et[lr]||et["@@iterator"])?et:null}(et),"function"==typeof Vo)for(et=Vo.call(et),ws=0;!(Ni=et.next()).done;)po+=fr(Ni=Ni.value,Lt,zn,Vo=fi+$r(Ni,ws++),mi);else if("object"===Ni)throw Lt=String(et),Error("Objects are not valid as a React child (found: "+("[object Object]"===Lt?"object with keys {"+Object.keys(et).join(", ")+"}":Lt)+"). If you meant to render a collection of children, use an array instead.");return po}function no(et,Lt,zn){if(null==et)return et;var fi=[],mi=0;return fr(et,fi,"","",function(Ni){return Lt.call(zn,Ni,mi++)}),fi}function hr(et){if(-1===et._status){var Lt=et._result;(Lt=Lt()).then(function(zn){(0===et._status||-1===et._status)&&(et._status=1,et._result=zn)},function(zn){(0===et._status||-1===et._status)&&(et._status=2,et._result=zn)}),-1===et._status&&(et._status=0,et._result=Lt)}if(1===et._status)return et._result.default;throw et._result}var sn={current:null},er={transition:null},Hr={ReactCurrentDispatcher:sn,ReactCurrentBatchConfig:er,ReactCurrentOwner:Ss};an.Children={map:no,forEach:function(et,Lt,zn){no(et,function(){Lt.apply(this,arguments)},zn)},count:function(et){var Lt=0;return no(et,function(){Lt++}),Lt},toArray:function(et){return no(et,function(Lt){return Lt})||[]},only:function(et){if(!le(et))throw Error("React.Children.only expected to receive a single React element child.");return et}},an.Component=ta,an.Fragment=Ms,an.Profiler=At,an.PureComponent=to,an.StrictMode=Ki,an.Suspense=rr,an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hr,an.cloneElement=function(et,Lt,zn){if(null==et)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+et+".");var fi=xr({},et.props),mi=et.key,Ni=et.ref,po=et._owner;if(null!=Lt){if(void 0!==Lt.ref&&(Ni=Lt.ref,po=Ss.current),void 0!==Lt.key&&(mi=""+Lt.key),et.type&&et.type.defaultProps)var ws=et.type.defaultProps;for(Vo in Lt)wc.call(Lt,Vo)&&!Cs.hasOwnProperty(Vo)&&(fi[Vo]=void 0===Lt[Vo]&&void 0!==ws?ws[Vo]:Lt[Vo])}var Vo=arguments.length-2;if(1===Vo)fi.children=zn;else if(1<Vo){ws=Array(Vo);for(var Ic=0;Ic<Vo;Ic++)ws[Ic]=arguments[Ic+2];fi.children=ws}return{$$typeof:ln,type:et.type,key:mi,ref:Ni,props:fi,_owner:po}},an.createContext=function(et){return(et={$$typeof:rs,_currentValue:et,_currentValue2:et,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:Ma,_context:et},et.Consumer=et},an.createElement=Al,an.createFactory=function(et){var Lt=Al.bind(null,et);return Lt.type=et,Lt},an.createRef=function(){return{current:null}},an.forwardRef=function(et){return{$$typeof:Ci,render:et}},an.isValidElement=le,an.lazy=function(et){return{$$typeof:kr,_payload:{_status:-1,_result:et},_init:hr}},an.memo=function(et,Lt){return{$$typeof:or,type:et,compare:void 0===Lt?null:Lt}},an.startTransition=function(et){var Lt=er.transition;er.transition={};try{et()}finally{er.transition=Lt}},an.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},an.useCallback=function(et,Lt){return sn.current.useCallback(et,Lt)},an.useContext=function(et){return sn.current.useContext(et)},an.useDebugValue=function(){},an.useDeferredValue=function(et){return sn.current.useDeferredValue(et)},an.useEffect=function(et,Lt){return sn.current.useEffect(et,Lt)},an.useId=function(){return sn.current.useId()},an.useImperativeHandle=function(et,Lt,zn){return sn.current.useImperativeHandle(et,Lt,zn)},an.useInsertionEffect=function(et,Lt){return sn.current.useInsertionEffect(et,Lt)},an.useLayoutEffect=function(et,Lt){return sn.current.useLayoutEffect(et,Lt)},an.useMemo=function(et,Lt){return sn.current.useMemo(et,Lt)},an.useReducer=function(et,Lt,zn){return sn.current.useReducer(et,Lt,zn)},an.useRef=function(et){return sn.current.useRef(et)},an.useState=function(et){return sn.current.useState(et)},an.useSyncExternalStore=function(et,Lt,zn){return sn.current.useSyncExternalStore(et,Lt,zn)},an.useTransition=function(){return sn.current.useTransition()},an.version="18.2.0"},395:(ga,an,ln)=>{"use strict";ga.exports=ln(330)},619:(ga,an,ln)=>{"use strict";ga.exports=ln(209)},290:(ga,an)=>{"use strict";function ln(sn,er){var Hr=sn.length;sn.push(er);e:for(;0<Hr;){var et=Hr-1>>>1,Lt=sn[et];if(!(0<Ki(Lt,er)))break e;sn[et]=er,sn[Hr]=Lt,Hr=et}}function Wr(sn){return 0===sn.length?null:sn[0]}function Ms(sn){if(0===sn.length)return null;var er=sn[0],Hr=sn.pop();if(Hr!==er){sn[0]=Hr;e:for(var et=0,Lt=sn.length,zn=Lt>>>1;et<zn;){var fi=2*(et+1)-1,mi=sn[fi],Ni=fi+1,po=sn[Ni];if(0>Ki(mi,Hr))Ni<Lt&&0>Ki(po,mi)?(sn[et]=po,sn[Ni]=Hr,et=Ni):(sn[et]=mi,sn[fi]=Hr,et=fi);else{if(!(Ni<Lt&&0>Ki(po,Hr)))break e;sn[et]=po,sn[Ni]=Hr,et=Ni}}}return er}function Ki(sn,er){var Hr=sn.sortIndex-er.sortIndex;return 0!==Hr?Hr:sn.id-er.id}if("object"==typeof performance&&"function"==typeof performance.now){var At=performance;an.unstable_now=function(){return At.now()}}else{var Ma=Date,rs=Ma.now();an.unstable_now=function(){return Ma.now()-rs}}var Ci=[],rr=[],or=1,kr=null,lr=3,Rs=!1,zo=!1,xr=!1,ea="function"==typeof setTimeout?setTimeout:null,ta="function"==typeof clearTimeout?clearTimeout:null,vi=typeof setImmediate<"u"?setImmediate:null;function to(sn){for(var er=Wr(rr);null!==er;){if(null===er.callback)Ms(rr);else{if(!(er.startTime<=sn))break;Ms(rr),er.sortIndex=er.expirationTime,ln(Ci,er)}er=Wr(rr)}}function Ul(sn){if(xr=!1,to(sn),!zo)if(null!==Wr(Ci))zo=!0,no(Cc);else{var er=Wr(rr);null!==er&&hr(Ul,er.startTime-sn)}}function Cc(sn,er){zo=!1,xr&&(xr=!1,ta(Cs),Cs=-1),Rs=!0;var Hr=lr;try{for(to(er),kr=Wr(Ci);null!==kr&&(!(kr.expirationTime>er)||sn&&!le());){var et=kr.callback;if("function"==typeof et){kr.callback=null,lr=kr.priorityLevel;var Lt=et(kr.expirationTime<=er);er=an.unstable_now(),"function"==typeof Lt?kr.callback=Lt:kr===Wr(Ci)&&Ms(Ci),to(er)}else Ms(Ci);kr=Wr(Ci)}if(null!==kr)var zn=!0;else{var fi=Wr(rr);null!==fi&&hr(Ul,fi.startTime-er),zn=!1}return zn}finally{kr=null,lr=Hr,Rs=!1}}typeof navigator<"u"&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var Zi,wc=!1,Ss=null,Cs=-1,Al=5,Ac=-1;function le(){return!(an.unstable_now()-Ac<Al)}function zf(){if(null!==Ss){var sn=an.unstable_now();Ac=sn;var er=!0;try{er=Ss(!0,sn)}finally{er?Zi():(wc=!1,Ss=null)}}else wc=!1}if("function"==typeof vi)Zi=function(){vi(zf)};else if(typeof MessageChannel<"u"){var $r=new MessageChannel,fr=$r.port2;$r.port1.onmessage=zf,Zi=function(){fr.postMessage(null)}}else Zi=function(){ea(zf,0)};function no(sn){Ss=sn,wc||(wc=!0,Zi())}function hr(sn,er){Cs=ea(function(){sn(an.unstable_now())},er)}an.unstable_IdlePriority=5,an.unstable_ImmediatePriority=1,an.unstable_LowPriority=4,an.unstable_NormalPriority=3,an.unstable_Profiling=null,an.unstable_UserBlockingPriority=2,an.unstable_cancelCallback=function(sn){sn.callback=null},an.unstable_continueExecution=function(){zo||Rs||(zo=!0,no(Cc))},an.unstable_forceFrameRate=function(sn){0>sn||125<sn?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Al=0<sn?Math.floor(1e3/sn):5},an.unstable_getCurrentPriorityLevel=function(){return lr},an.unstable_getFirstCallbackNode=function(){return Wr(Ci)},an.unstable_next=function(sn){switch(lr){case 1:case 2:case 3:var er=3;break;default:er=lr}var Hr=lr;lr=er;try{return sn()}finally{lr=Hr}},an.unstable_pauseExecution=function(){},an.unstable_requestPaint=function(){},an.unstable_runWithPriority=function(sn,er){switch(sn){case 1:case 2:case 3:case 4:case 5:break;default:sn=3}var Hr=lr;lr=sn;try{return er()}finally{lr=Hr}},an.unstable_scheduleCallback=function(sn,er,Hr){var et=an.unstable_now();switch(Hr="object"==typeof Hr&&null!==Hr&&"number"==typeof(Hr=Hr.delay)&&0<Hr?et+Hr:et,sn){case 1:var Lt=-1;break;case 2:Lt=250;break;case 5:Lt=1073741823;break;case 4:Lt=1e4;break;default:Lt=5e3}return sn={id:or++,callback:er,priorityLevel:sn,startTime:Hr,expirationTime:Lt=Hr+Lt,sortIndex:-1},Hr>et?(sn.sortIndex=Hr,ln(rr,sn),null===Wr(Ci)&&sn===Wr(rr)&&(xr?(ta(Cs),Cs=-1):xr=!0,hr(Ul,Hr-et))):(sn.sortIndex=Lt,ln(Ci,sn),zo||Rs||(zo=!0,no(Cc))),sn},an.unstable_shouldYield=le,an.unstable_wrapCallback=function(sn){var er=lr;return function(){var Hr=lr;lr=er;try{return sn.apply(this,arguments)}finally{lr=Hr}}}},605:(ga,an,ln)=>{"use strict";ga.exports=ln(290)},390:function(ga,an,ln){"use strict";var Wr=this&&this.__importDefault||function(At){return At&&At.__esModule?At:{default:At}};Object.defineProperty(an,"__esModule",{value:!0});var Ms=Wr(ln(763));an.default=function Ki(At,Ma){var rs=null;if(!At||"string"!=typeof At)return rs;var Ci=(0,Ms.default)(At),rr="function"==typeof Ma;return Ci.forEach(function(or){if("declaration"===or.type){var kr=or.property,lr=or.value;rr?Ma(kr,lr,or):lr&&((rs=rs||{})[kr]=lr)}}),rs}},684:ga=>{ga.exports=XMLHttpRequest}},ga=>{ga(ga.s=273)}]);