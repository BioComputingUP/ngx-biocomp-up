<!-- Outer scaffold -->
<div class="scaffold">
  <!-- Show labels -->
  <div class="labels">
    <!-- First label is empty (index) -->
    <div class="label">Index</div>
    <!-- Second label is consensus -->
    <div class="label">Consensus</div>
    <!-- Other labels are sequences -->
    @for (label of labels; track $index) {
      <div class="label">{{ label }}</div>
    }
  </div>
  <!-- Show content -->
  <div class="positions">
    <!-- Loop through each position -->
    @for (position of first; track j; let j = $index) {
    <!-- Define position wrapper -->
    <div class="position">
      <!-- Show index -->
      <ng-container *ngTemplateOutlet="index; context: { i: 'index', j }"></ng-container>
      <!-- TODO Show consensus -->
      <!-- <ng-container *ngTemplateOutlet="residue; context: { i: 'consensus', j }"></ng-container> -->
      <!-- Show residues -->
      @for(sequence of sequences; track i; let i = $index) {
        <!-- Get amino-acid -->
        @if(sequence[j]; as aa) {
          <!-- Define residue wrapper -->
          <ng-container *ngTemplateOutlet="residue; context: { i, j }"></ng-container>
        }
      }
    </div>
    }
  </div>
</div>

<!-- Define index template -->
<ng-template let-j="j" #index>
  <div class="index">{{ j * 10 + 1 }}</div>
</ng-template>

<!-- Define cell template -->
<ng-template let-i="i" let-j="j" #residue>
  <!-- Get selection boundaries (if any) -->
  @if(styles$ | async; as styles) {
    <!-- Get style for current cell -->
    @if(styles[i][j]; as style) {
      <!-- Define residue wrapper -->
      <div class="residue" [id]="'residue-' + i + '-' + j"
        [style.background-color]="style['background-color']"
        [style.border-color]="style['border-color']"
        [style.color]="style['color']">
        {{ sequences[i][j] }}
      </div>
    }
  }
</ng-template>